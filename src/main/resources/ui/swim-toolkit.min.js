// @swim/toolkit v4.0.0-dev.20210927.1 (c) 2015-2021 Swim.inc
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime")):"function"==typeof define&&define.amd?define(["exports","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).swim=t.swim||{},t.swim,t.swim,t.swim,t.swim,t.swim,t.swim,t.swim,t.swim,t.swim,t.swim,t.swim)}(this,(function(t,e,i,n,o,s,r,l,a,h,c,d){"use strict";function u(t,e,i,n){var o,s=arguments.length,r=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,n);else for(var l=t.length-1;l>=0;l--)(o=t[l])&&(r=(s<3?o(r):s>3?o(e,i,r):o(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r}const p=function(){const t={current:null,create:function(){return{updateTime:performance.now()}}};return t}();class f extends i.Service{constructor(){super(),this.flags=0,this.modelContext=p.create(),this.updateDelay=f.MinUpdateDelay,this.analyzeTimer=0,this.refreshTimer=0,this.runAnalyzePass=this.runAnalyzePass.bind(this),this.runRefreshPass=this.runRefreshPass.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this)}setFlags(t){this.flags=t}updatedModelContext(){const t=this.modelContext;return t.updateTime=performance.now(),t}needsUpdate(t,e){return t}requestUpdate(t,e,i){e=this.needsUpdate(e,i);let n=this.flags&~e&y.UpdateMask;0!=(e&y.AnalyzeMask)&&(n|=y.NeedsAnalyze),0!=(e&y.RefreshMask)&&(n|=y.NeedsRefresh),this.setFlags(this.flags|n),i&&0==(this.flags&(y.AnalyzingFlag|y.RefreshingFlag))&&this.updateDelay<=f.MaxAnalyzeInterval?this.runImmediatePass():this.scheduleUpdate()}scheduleUpdate(){const t=this.flags;0==(t&y.AnalyzingFlag)&&0!=(t&y.AnalyzeMask)?this.scheduleAnalyzePass(this.updateDelay):0==(t&y.RefreshingFlag)&&0!=(t&y.RefreshMask)&&this.scheduleRefreshPass(f.MinAnalyzeInterval)}cancelUpdate(){this.cancelAnalyzePass(),this.cancelRefreshPass()}runImmediatePass(){0!=(this.flags&y.AnalyzeMask)&&(this.cancelUpdate(),this.runAnalyzePass(!0)),0!=(this.flags&y.RefreshMask)&&this.updateDelay<=f.MaxAnalyzeInterval&&(this.cancelUpdate(),this.runRefreshPass(!0))}scheduleAnalyzePass(t){0===this.analyzeTimer&&(this.analyzeTimer=setTimeout(this.runAnalyzePass,t))}cancelAnalyzePass(){0!==this.analyzeTimer&&(clearTimeout(this.analyzeTimer),this.analyzeTimer=0)}runAnalyzePass(t=!1){this.setFlags(this.flags&~y.AnalyzeMask|y.AnalyzingFlag);try{const e=performance.now(),i=this.roots,n=this.modelContext;n.updateTime=e;for(let t=0;t<i.length;t+=1){const e=i[t];0!=(e.flags&y.AnalyzeMask)&&e.cascadeAnalyze(0,n)}const o=performance.now();let s=Math.max(f.MinAnalyzeInterval,this.updateDelay);this.updateDelay=o-e>s?Math.min(Math.max(2,2*this.updateDelay),f.MaxUpdateDelay):Math.min(f.MinUpdateDelay,this.updateDelay/2),this.cancelAnalyzePass(),0!=(this.flags&y.RefreshMask)?this.scheduleRefreshPass(f.MinRefreshInterval):0!=(this.flags&y.AnalyzeMask)&&(t&&(s=Math.max(f.MaxAnalyzeInterval,s)),this.cancelRefreshPass(),this.scheduleAnalyzePass(s))}finally{this.setFlags(this.flags&~y.AnalyzingFlag)}}scheduleRefreshPass(t){0===this.refreshTimer&&(this.refreshTimer=setTimeout(this.runRefreshPass,t))}cancelRefreshPass(){0!==this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=0)}runRefreshPass(t=!1){this.setFlags(this.flags&~y.RefreshMask|y.RefreshingFlag);try{const e=performance.now(),i=this.modelContext;i.updateTime=e;const n=this.roots;for(let t=0;t<n.length;t+=1){const e=n[t];0!=(e.flags&y.RefreshMask)&&e.cascadeRefresh(0,i)}if(this.cancelRefreshPass(),0!=(this.flags&y.AnalyzeMask)){let e=this.updateDelay;t&&(e=Math.max(f.MaxAnalyzeInterval,e)),this.scheduleAnalyzePass(e)}else 0!=(this.flags&y.RefreshMask)&&(this.cancelAnalyzePass(),this.scheduleRefreshPass(f.MaxRefreshInterval))}finally{this.setFlags(this.flags&~y.RefreshingFlag)}}get powerFlags(){return 0}power(){const t=this.roots;for(let e=0,i=t.length;e<i;e+=1){t[e].requireUpdate(this.powerFlags)}}unpower(){this.cancelUpdate(),this.updateDelay=f.MinUpdateDelay}onAttachRoot(t){super.onAttachRoot(t),this.requestUpdate(t,t.flags&y.UpdateMask,!1)}onAttach(){super.onAttach(),this.attachEvents()}onDetach(){this.detachEvents(),super.onDetach()}attachEvents(){"undefined"!=typeof document&&document.addEventListener("visibilitychange",this.onVisibilityChange)}detachEvents(){"undefined"!=typeof document&&document.removeEventListener("visibilitychange",this.onVisibilityChange)}onVisibilityChange(){"visible"===document.visibilityState?this.power():this.unpower()}static global(){return new f}}f.MinUpdateDelay=0,f.MaxUpdateDelay=167,f.MinAnalyzeInterval=12,f.MaxAnalyzeInterval=33,f.MinRefreshInterval=4,f.MaxRefreshInterval=16,u([e.Lazy],f,"global",null);const g=function(t){const e=t.extend("RefreshProvider");return Object.defineProperty(e.prototype,"modelContext",{get(){let t=this.service;return null==t&&(t=f.global()),t.modelContext},configurable:!0}),e.prototype.updatedModelContext=function(){let t=this.service;return null==t&&(t=f.global()),t.updatedModelContext()},e.prototype.requestUpdate=function(t,e,i){let n=this.service;null==n&&(n=f.global()),n.requestUpdate(t,e,i)},e.prototype.createService=function(){return f.global()},e}(i.Provider);class v extends i.Service{constructor(){super(),this.selections=[]}isSelected(t){return this.selections.indexOf(t)>=0}select(t,e,i){const n=this.selections;if(n.indexOf(t)<0){void 0===e&&(e=null),null!==e&&e.multi||this.unselectAll(),void 0===i?i=n.length:(i<0&&(i=n.length+1+i),i=Math.min(Math.max(0,i,n.length)));const o=t.getTrait(D);this.willSelect(t,i,e),null!==o&&o.willSelect(e),n.splice(i,0,t),this.onSelect(t,i,e),null!==o&&(o.onSelect(e),o.didSelect(e)),this.didSelect(t,i,e)}}willSelect(t,e,i){const n=this.observers;for(let o=0,s=n.length;o<s;o+=1){const s=n[o];void 0!==s.serviceWillSelect&&s.serviceWillSelect(t,e,i,this)}}onSelect(t,e,i){}didSelect(t,e,i){const n=this.observers;for(let o=0,s=n.length;o<s;o+=1){const s=n[o];void 0!==s.serviceDidSelect&&s.serviceDidSelect(t,e,i,this)}}unselect(t){const e=this.selections,i=e.indexOf(t);if(i>=0){const n=t.getTrait(D);this.willUnselect(t),null!==n&&n.willUnselect(),e.splice(i,1),this.onUnselect(t),null!==n&&(n.onUnselect(),n.didUnselect()),this.didUnselect(t)}}willUnselect(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceWillUnselect&&n.serviceWillUnselect(t,this)}}onUnselect(t){}didUnselect(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceDidUnselect&&n.serviceDidUnselect(t,this)}}unselectAll(){const t=this.selections;for(;0!==t.length;)this.unselect(t[0])}toggle(t,e,i){const n=this.selections,o=n.indexOf(t);if(o<0){void 0===e&&(e=null),null!==e&&e.multi||this.unselectAll(),void 0===i?i=n.length:(i<0&&(i=n.length+1+i),i=Math.min(Math.max(0,i,n.length)));const o=t.getTrait(D);this.willSelect(t,i,e),null!==o&&o.willSelect(e),n.splice(i,0,t),this.onSelect(t,i,e),null!==o&&(o.onSelect(e),o.didSelect(e)),this.didSelect(t,i,e)}else{const e=t.getTrait(D);this.willUnselect(t),null!==e&&e.willUnselect(),n.splice(o,1),this.onUnselect(t),null!==e&&(e.onUnselect(),e.didUnselect()),this.didUnselect(t)}}static global(){return new v}}u([e.Lazy],v,"global",null);const w=function(t){const e=t.extend("SelectionProvider");return Object.defineProperty(e.prototype,"selections",{get(){let t=this.service;return null==t&&(t=v.global()),t.selections},configurable:!0}),e.prototype.select=function(t,e,i){let n=this.service;null==n&&(n=v.global()),n.select(t,e,i)},e.prototype.unselect=function(t){let e=this.service;null==e&&(e=v.global()),e.unselect(t)},e.prototype.unselectAll=function(){let t=this.service;null==t&&(t=v.global()),t.unselectAll()},e.prototype.createService=function(){return v.global()},e}(i.Provider);class y extends i.Component{constructor(){super(),this.consumers=e.Arrays.empty,this.firstTrait=null,this.lastTrait=null,this.traitMap=null}get componentType(){return y}willAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillAttachParent&&n.modelWillAttachParent(t,this)}let i=this.firstTrait;for(;null!==i;){const e=i.nextTrait;i.willAttachParent(t),i=null!==e&&e.model===this?e:null}}onAttachParent(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.onAttachParent(t),e=null!==i&&i.model===this?i:null}}didAttachParent(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.didAttachParent(t),e=null!==i&&i.model===this?i:null}const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidAttachParent&&n.modelDidAttachParent(t,this)}}willDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillDetachParent&&n.modelWillDetachParent(t,this)}let i=this.firstTrait;for(;null!==i;){const e=i.nextTrait;i.willDetachParent(t),i=null!==e&&e.model===this?e:null}}onDetachParent(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.onDetachParent(t),e=null!==i&&i.model===this?i:null}}didDetachParent(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.didDetachParent(t),e=null!==i&&i.model===this?i:null}const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidDetachParent&&n.modelDidDetachParent(t,this)}}setChild(t,e){return null!==e&&(e=y.fromAny(e)),super.setChild(t,e)}appendChild(t,e){return t=y.fromAny(t),super.appendChild(t,e)}prependChild(t,e){return t=y.fromAny(t),super.prependChild(t,e)}insertChild(t,e,i){return t=y.fromAny(t),super.insertChild(t,e,i)}replaceChild(t,e){return t=y.fromAny(t),super.replaceChild(t,e)}willInsertChild(t,e){super.willInsertChild(t,e);const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.modelWillInsertChild&&o.modelWillInsertChild(t,e,this)}let n=this.firstTrait;for(;null!==n;){const i=n.nextTrait;n.willInsertChild(t,e),n=null!==i&&i.model===this?i:null}}onInsertChild(t,e){super.onInsertChild(t,e);let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;i.onInsertChild(t,e),i=null!==n&&n.model===this?n:null}}didInsertChild(t,e){let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;i.didInsertChild(t,e),i=null!==n&&n.model===this?n:null}const n=this.observers;for(let i=0,o=n.length;i<o;i+=1){const o=n[i];void 0!==o.modelDidInsertChild&&o.modelDidInsertChild(t,e,this)}super.didInsertChild(t,e)}cascadeInsert(t,e){0!=(this.flags&y.MountedFlag)&&(void 0===t&&(t=0),0!=((t|=this.flags&y.UpdateMask)&y.AnalyzeMask)&&(void 0===e&&(e=this.superModelContext),this.cascadeAnalyze(t,e)))}willRemoveChild(t){super.willRemoveChild(t);const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillRemoveChild&&n.modelWillRemoveChild(t,this)}let i=this.firstTrait;for(;null!==i;){const e=i.nextTrait;i.willRemoveChild(t),i=null!==e&&e.model===this?e:null}}onRemoveChild(t){super.onRemoveChild(t);let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.onRemoveChild(t),e=null!==i&&i.model===this?i:null}}didRemoveChild(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.didRemoveChild(t),e=null!==i&&i.model===this?i:null}const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidRemoveChild&&n.modelDidRemoveChild(t,this)}super.didRemoveChild(t)}cascadeMount(){if(0!=(this.flags&y.MountedFlag))throw new Error("already mounted");this.willMount(),this.setFlags(this.flags|y.MountedFlag),this.onMount(),this.mountTraits(),this.mountChildren(),this.didMount()}willMount(){super.willMount();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelWillMount&&i.modelWillMount(this)}}onMount(){this.requestUpdate(this,this.flags&y.UpdateMask,!1),this.requireUpdate(this.mountFlags),null!==this.decoherent&&0!==this.decoherent.length&&this.requireUpdate(y.NeedsMutate),this.mountFasteners(),0!==this.consumers.length&&this.startConsuming()}didMount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelDidMount&&i.modelDidMount(this)}super.didMount()}cascadeUnmount(){if(0==(this.flags&y.MountedFlag))throw new Error("already unmounted");this.willUnmount(),this.setFlags(this.flags&~y.MountedFlag),this.unmountChildren(),this.unmountTraits(),this.onUnmount(),this.didUnmount()}willUnmount(){super.willUnmount();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelWillUnmount&&i.modelWillUnmount(this)}}onUnmount(){this.stopConsuming(),super.onUnmount()}didUnmount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelDidUnmount&&i.modelDidUnmount(this)}super.didUnmount()}requireUpdate(t,e=!1){const i=this.flags,n=t&~i&y.UpdateMask;0!==n&&(this.setFlags(i|n),this.requestUpdate(this,n,e))}needsUpdate(t,e){let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;t=i.needsUpdate(t,e),i=null!==n&&n.model===this?n:null}return t}requestUpdate(t,e,i){e=this.needsUpdate(e,i);let n=this.flags&~e&y.UpdateMask;if(0!=(e&y.AnalyzeMask)&&(n|=y.NeedsAnalyze),0!=(e&y.RefreshMask)&&(n|=y.NeedsRefresh),0!==n||i){this.setFlags(this.flags|n);const o=this.parent;if(null!==o)o.requestUpdate(t,e,i);else if(this.mounted){const n=this.refreshProvider.service;null!=n&&n.requestUpdate(t,e,i)}}}get updating(){return 0!=(this.flags&y.UpdatingMask)}get analyzing(){return 0!=(this.flags&y.AnalyzingFlag)}needsAnalyze(t,e){let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;t=i.needsAnalyze(t,e),i=null!==n&&n.model===this?n:null}return t}cascadeAnalyze(t,e){const i=this.extendModelContext(e),n=p.current;try{if(p.current=i,t&=~y.NeedsAnalyze,t|=this.flags&y.UpdateMask,0!=((t=this.needsAnalyze(t,i))&y.AnalyzeMask)){let e=t;this.setFlags(this.flags&~y.NeedsAnalyze|y.AnalyzingFlag|y.ContextualFlag),this.willAnalyze(e,i),0!=((this.flags|t)&y.NeedsMutate)&&(e|=y.NeedsMutate,this.setFlags(this.flags&~y.NeedsMutate),this.willMutate(i)),0!=((this.flags|t)&y.NeedsAggregate)&&(e|=y.NeedsAggregate,this.setFlags(this.flags&~y.NeedsAggregate),this.willAggregate(i)),0!=((this.flags|t)&y.NeedsCorrelate)&&(e|=y.NeedsCorrelate,this.setFlags(this.flags&~y.NeedsCorrelate),this.willCorrelate(i)),this.onAnalyze(e,i),0!=(e&y.NeedsMutate)&&this.onMutate(i),0!=(e&y.NeedsAggregate)&&this.onAggregate(i),0!=(e&y.NeedsCorrelate)&&this.onCorrelate(i),0!=(e&y.AnalyzeMask)&&(this.setFlags(this.flags&~y.ContextualFlag),this.analyzeChildren(e,i,this.analyzeChild),this.setFlags(this.flags|y.ContextualFlag)),0!=(e&y.NeedsCorrelate)&&this.didCorrelate(i),0!=(e&y.NeedsAggregate)&&this.didAggregate(i),0!=(e&y.NeedsMutate)&&this.didMutate(i),this.didAnalyze(e,i)}}finally{this.setFlags(this.flags&~(y.AnalyzingFlag|y.ContextualFlag)),p.current=n}}willAnalyze(t,e){let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;i.willAnalyze(t,e),i=null!==n&&n.model===this?n:null}}onAnalyze(t,e){let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;i.onAnalyze(t,e),i=null!==n&&n.model===this?n:null}}didAnalyze(t,e){let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;i.didAnalyze(t,e),i=null!==n&&n.model===this?n:null}}willMutate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillMutate&&n.modelWillMutate(t,this)}let i=this.firstTrait;for(;null!==i;){const e=i.nextTrait;i.willMutate(t),i=null!==e&&e.model===this?e:null}}onMutate(t){this.recohereFasteners(t.updateTime);let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.onMutate(t),e=null!==i&&i.model===this?i:null}}didMutate(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.didMutate(t),e=null!==i&&i.model===this?i:null}const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidMutate&&n.modelDidMutate(t,this)}}willAggregate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillAggregate&&n.modelWillAggregate(t,this)}let i=this.firstTrait;for(;null!==i;){const e=i.nextTrait;i.willAggregate(t),i=null!==e&&e.model===this?e:null}}onAggregate(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.onAggregate(t),e=null!==i&&i.model===this?i:null}}didAggregate(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.didAggregate(t),e=null!==i&&i.model===this?i:null}const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidAggregate&&n.modelDidAggregate(t,this)}}willCorrelate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillCorrelate&&n.modelWillCorrelate(t,this)}let i=this.firstTrait;for(;null!==i;){const e=i.nextTrait;i.willCorrelate(t),i=null!==e&&e.model===this?e:null}}onCorrelate(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.onCorrelate(t),e=null!==i&&i.model===this?i:null}}didCorrelate(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.didCorrelate(t),e=null!==i&&i.model===this?i:null}const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidCorrelate&&n.modelDidCorrelate(t,this)}}analyzeChildren(t,e,i){const n=this.firstTrait;null!==n?this.analyzeTraitChildren(n,t,e,i):this.analyzeOwnChildren(t,e,i)}analyzeTraitChildren(t,e,i,n){const o=t.nextTrait;null!==o?t.analyzeChildren(e,i,n,this.analyzeTraitChildren.bind(this,o)):t.analyzeChildren(e,i,n,this.analyzeOwnChildren)}analyzeOwnChildren(t,e,i){let n=this.firstChild;for(;null!==n;){const o=n.nextSibling;if(i.call(this,n,t,e),null!==o&&o.parent!==this)throw new Error("inconsistent analyze pass");n=o}}analyzeChild(t,e,i){t.cascadeAnalyze(e,i)}get refreshing(){return 0!=(this.flags&y.RefreshingFlag)}needsRefresh(t,e){let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;t=i.needsRefresh(t,e),i=null!==n&&n.model===this?n:null}return t}cascadeRefresh(t,e){const i=this.extendModelContext(e),n=p.current;try{if(p.current=i,t&=~y.NeedsRefresh,t|=this.flags&y.UpdateMask,0!=((t=this.needsRefresh(t,i))&y.RefreshMask)){let e=t;this.setFlags(this.flags&~y.NeedsRefresh|y.RefreshingFlag|y.ContextualFlag),this.willRefresh(e,i),0!=((this.flags|t)&y.NeedsValidate)&&(e|=y.NeedsValidate,this.setFlags(this.flags&~y.NeedsValidate),this.willValidate(i)),0!=((this.flags|t)&y.NeedsReconcile)&&(e|=y.NeedsReconcile,this.setFlags(this.flags&~y.NeedsReconcile),this.willReconcile(i)),this.onRefresh(e,i),0!=(e&y.NeedsValidate)&&this.onValidate(i),0!=(e&y.NeedsReconcile)&&this.onReconcile(i),e&y.RefreshMask&&(this.setFlags(this.flags&~y.ContextualFlag),this.refreshChildren(e,i,this.refreshChild),this.setFlags(this.flags|y.ContextualFlag)),0!=(e&y.NeedsReconcile)&&this.didReconcile(i),0!=(e&y.NeedsValidate)&&this.didValidate(i),this.didRefresh(e,i)}}finally{this.setFlags(this.flags&~(y.RefreshingFlag|y.ContextualFlag)),p.current=n}}willRefresh(t,e){let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;i.willRefresh(t,e),i=null!==n&&n.model===this?n:null}}onRefresh(t,e){let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;i.onRefresh(t,e),i=null!==n&&n.model===this?n:null}}didRefresh(t,e){let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;i.didRefresh(t,e),i=null!==n&&n.model===this?n:null}}willValidate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillValidate&&n.modelWillValidate(t,this)}let i=this.firstTrait;for(;null!==i;){const e=i.nextTrait;i.willValidate(t),i=null!==e&&e.model===this?e:null}}onValidate(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.onValidate(t),e=null!==i&&i.model===this?i:null}}didValidate(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.didValidate(t),e=null!==i&&i.model===this?i:null}const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidValidate&&n.modelDidValidate(t,this)}}willReconcile(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillReconcile&&n.modelWillReconcile(t,this)}let i=this.firstTrait;for(;null!==i;){const e=i.nextTrait;i.willReconcile(t),i=null!==e&&e.model===this?e:null}}onReconcile(t){this.recohereDownlinks(t.updateTime);let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.onReconcile(t),e=null!==i&&i.model===this?i:null}}didReconcile(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e.didReconcile(t),e=null!==i&&i.model===this?i:null}const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidReconcile&&n.modelDidReconcile(t,this)}}refreshChildren(t,e,i){const n=this.firstTrait;null!==n?this.refreshTraitChildren(n,t,e,i):this.refreshOwnChildren(t,e,i)}refreshTraitChildren(t,e,i,n){const o=t.nextTrait;null!==o?t.refreshChildren(e,i,n,this.refreshTraitChildren.bind(this,o)):t.refreshChildren(e,i,n,this.refreshOwnChildren)}refreshOwnChildren(t,e,i){let n=this.firstChild;for(;null!==n;){const o=n.nextSibling;if(i.call(this,n,t,e),null!==o&&o.parent!==this)throw new Error("inconsistent refresh pass");n=o}}refreshChild(t,e,i){t.cascadeRefresh(e,i)}setFirstTrait(t){this.firstTrait=t}setLastTrait(t){this.lastTrait=t}forEachTrait(t,e){let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;if(void 0!==t.call(e,i))break;i=null!==n&&n.model===this?n:null}}insertTraitMap(t){const e=t.key;if(void 0!==e){let i=this.traitMap;null===i&&(i={},this.traitMap=i),i[e]=t}}removeTraitMap(t){const e=t.key;if(void 0!==e){const t=this.traitMap;null!==t&&delete t[e]}}getTrait(t,e){if("string"==typeof t){const i=this.traitMap;if(null!==i){const n=i[t];if(void 0!==n&&(void 0===e||n instanceof e))return n}}else{let e=this.firstTrait;for(;null!==e;){if(e instanceof t)return e;e=e.nextTrait}}return null}setTrait(t,e){null!==e&&(e=S.fromAny(e));const i=this.getTrait(t);let n;return null!==i&&null!==e&&i!==e?(e.remove(),n=i.nextTrait,this.willRemoveTrait(i),i.detachModel(this),this.removeTraitMap(i),this.onRemoveTrait(i),this.didRemoveTrait(i),i.setKey(void 0),e.setKey(i.key),this.willInsertTrait(e,n),this.insertTraitMap(e),e.attachModel(this,n),this.onInsertTrait(e,n),this.didInsertTrait(e,n)):(e!==i||null!==e&&e.key!==t)&&(null!==i?(n=i.nextTrait,this.willRemoveTrait(i),i.detachModel(this),this.removeTraitMap(i),this.onRemoveTrait(i),this.didRemoveTrait(i),i.setKey(void 0)):n=null,null!==e&&(e.remove(),e.setKey(t),this.willInsertTrait(e,n),this.insertTraitMap(e),e.attachModel(this,n),this.onInsertTrait(e,n),this.didInsertTrait(e,n))),i}appendTrait(t,e){return(t=S.fromAny(t)).remove(),void 0!==e&&this.removeChild(e),t.setKey(e),this.willInsertTrait(t,null),this.insertTraitMap(t),t.attachModel(this,null),this.onInsertTrait(t,null),this.didInsertTrait(t,null),t}prependTrait(t,e){(t=S.fromAny(t)).remove(),void 0!==e&&this.removeChild(e);const i=this.firstTrait;return t.setKey(e),this.willInsertTrait(t,i),this.insertTraitMap(t),t.attachModel(this,i),this.onInsertTrait(t,i),this.didInsertTrait(t,i),t}insertTrait(t,e,i){if(null!==e&&e.model!==this)throw new Error("insert target is not a member trait");return(t=S.fromAny(t)).remove(),void 0!==i&&this.removeChild(i),t.setKey(i),this.willInsertTrait(t,e),this.insertTraitMap(t),t.attachModel(this,e),this.onInsertTrait(t,e),this.didInsertTrait(t,e),t}replaceTrait(t,e){if(e.model!==this)throw new Error("replacement target is not a member trait");if((t=S.fromAny(t))!==e){t.remove();const i=e.nextTrait;this.willRemoveTrait(e),e.detachModel(this),this.removeTraitMap(e),this.onRemoveTrait(e),this.didRemoveTrait(e),e.setKey(void 0),t.setKey(e.key),this.willInsertTrait(t,i),this.insertTraitMap(t),t.attachModel(this,i),this.onInsertTrait(t,i),this.didInsertTrait(t,i)}return e}get insertTraitFlags(){return this.constructor.InsertTraitFlags}willInsertTrait(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.modelWillInsertTrait&&o.modelWillInsertTrait(t,e,this)}let n=this.firstTrait;for(;null!==n;){const i=n.nextTrait;n!==t&&n.willInsertTrait(t,e),n=null!==i&&i.model===this?i:null}}onInsertTrait(t,e){this.requireUpdate(this.insertTraitFlags),this.bindTraitFasteners(t,e);let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;i!==t&&i.onInsertTrait(t,e),i=null!==n&&n.model===this?n:null}}didInsertTrait(t,e){let i=this.firstTrait;for(;null!==i;){const n=i.nextTrait;i!==t&&i.didInsertTrait(t,e),i=null!==n&&n.model===this?n:null}const n=this.observers;for(let i=0,o=n.length;i<o;i+=1){const o=n[i];void 0!==o.modelDidInsertTrait&&o.modelDidInsertTrait(t,e,this)}}removeTrait(t){let e;if("string"==typeof t){if(e=this.getTrait(t),null===e)return null}else if(e=t,e.model!==this)throw new Error("not a member trait");return this.willRemoveTrait(e),e.detachModel(this),this.removeTraitMap(e),this.onRemoveTrait(e),this.didRemoveTrait(e),e.setKey(void 0),e}get removeTraitFlags(){return this.constructor.RemoveTraitFlags}willRemoveTrait(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillRemoveTrait&&n.modelWillRemoveTrait(t,this)}let i=this.firstTrait;for(;null!==i;){const e=i.nextTrait;i!==t&&i.willRemoveTrait(t),i=null!==e&&e.model===this?e:null}}onRemoveTrait(t){this.requireUpdate(this.removeTraitFlags);let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e!==t&&e.onRemoveTrait(t),e=null!==i&&i.model===this?i:null}this.unbindTraitFasteners(t)}didRemoveTrait(t){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;e!==t&&e.didRemoveTrait(t),e=null!==i&&i.model===this?i:null}const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidRemoveTrait&&n.modelDidRemoveTrait(t,this)}}sortTraits(t){let e=this.firstTrait;if(null!==e){const i=[];do{i.push(e),e=e.nextTrait}while(null!==e);i.sort(t),e=i[0],this.setFirstTrait(e),e.setPreviousTrait(null);for(let t=1;t<i.length;t+=1){const n=i[t];e.setNextTrait(n),n.setPreviousTrait(e),e=n}e.setNextTrait(null),this.setLastTrait(e)}}mountTraits(){let t=this.firstTrait;for(;null!==t;){const e=t.nextTrait;if(t.mountTrait(),null!==e&&e.model!==this)throw new Error("inconsistent mount");t=e}}unmountTraits(){let t=this.firstTrait;for(;null!==t;){const e=t.nextTrait;if(t.unmountTrait(),null!==e&&e.model!==this)throw new Error("inconsistent unmount");t=e}}getSuperTrait(t){const e=this.parent;if(null===e)return null;{const i=e.getTrait(t);return null!==i?i:e.getSuperTrait(t)}}getBaseTrait(t){const e=this.parent;if(null===e)return null;{const i=e.getBaseTrait(t);return null!==i?i:e.getTrait(t)}}bindFastener(t){if(super.bindFastener(t),t instanceof A&&t.binds){let e=this.firstTrait;for(;null!==e;){const i=e.nextTrait;t.bindTrait(e,i),e=null!==i&&i.model===this?i:null}}t instanceof n.DownlinkFastener&&!0===t.consumed&&this.consuming&&t.consume(this)}bindChildFastener(t,e,i){super.bindChildFastener(t,e,i),(t instanceof m||t instanceof A)&&t.bindModel(e,i)}unbindChildFastener(t,e){(t instanceof m||t instanceof A)&&t.unbindModel(e),super.unbindChildFastener(t,e)}bindTraitFasteners(t,e){const i=this.fasteners;for(const n in i){const o=i[n];this.bindTraitFastener(o,t,e)}}bindTraitFastener(t,e,i){t instanceof A&&t.bindTrait(e,i)}unbindTraitFasteners(t){const e=this.fasteners;for(const i in e){const n=e[i];this.unbindTraitFastener(n,t)}}unbindTraitFastener(t,e){t instanceof A&&t.unbindTrait(e)}decohereFastener(t){super.decohereFastener(t),t instanceof n.DownlinkFastener?this.requireUpdate(y.NeedsReconcile):this.requireUpdate(y.NeedsMutate)}recohereFasteners(t){const e=this.decoherent;if(null!==e){const i=e.length;if(0!==i){void 0===t&&(t=performance.now()),this.decoherent=null;for(let o=0;o<i;o+=1){const i=e[o];i instanceof n.DownlinkFastener?this.decohereFastener(i):i.recohere(t)}}}}recohereDownlinks(t){const e=this.decoherent;if(null!==e){const i=e.length;if(0!==i){this.decoherent=null;for(let o=0;o<i;o+=1){const i=e[o];i instanceof n.DownlinkFastener?i.recohere(t):this.decohereFastener(i)}}}}consume(t){const i=this.consumers,n=e.Arrays.inserted(t,i);i!==n&&(this.willConsume(t),this.consumers=n,this.onConsume(t),this.didConsume(t),0===i.length&&this.mounted&&this.startConsuming())}willConsume(t){}onConsume(t){}didConsume(t){}unconsume(t){const i=this.consumers,n=e.Arrays.removed(t,i);i!==n&&(this.willUnconsume(t),this.consumers=n,this.onUnconsume(t),this.didUnconsume(t),0===n.length&&this.stopConsuming())}willUnconsume(t){}onUnconsume(t){}didUnconsume(t){}get consuming(){return 0!=(this.flags&y.ConsumingFlag)}get startConsumingFlags(){return this.constructor.StartConsumingFlags}startConsuming(){0==(this.flags&y.ConsumingFlag)&&(this.willStartConsuming(),this.setFlags(this.flags|y.ConsumingFlag),this.onStartConsuming(),this.didStartConsuming())}willStartConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelWillStartConsuming&&i.modelWillStartConsuming(this)}}onStartConsuming(){this.requireUpdate(this.startConsumingFlags),this.startConsumingFasteners()}didStartConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelDidStartConsuming&&i.modelDidStartConsuming(this)}}get stopConsumingFlags(){return this.constructor.StopConsumingFlags}stopConsuming(){0!=(this.flags&y.ConsumingFlag)&&(this.willStopConsuming(),this.setFlags(this.flags&~y.ConsumingFlag),this.onStopConsuming(),this.didStopConsuming())}willStopConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelWillStopConsuming&&i.modelWillStopConsuming(this)}}onStopConsuming(){this.requireUpdate(this.stopConsumingFlags),this.stopConsumingFasteners()}didStopConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelDidStopConsuming&&i.modelDidStopConsuming(this)}}startConsumingFasteners(){const t=this.fasteners;for(const e in t){const i=t[e];i instanceof n.DownlinkFastener&&!0===i.consumed&&i.consume(this)}}stopConsumingFasteners(){const t=this.fasteners;for(const e in t){const i=t[e];i instanceof n.DownlinkFastener&&!0===i.consumed&&i.unconsume(this)}}get superModelContext(){const t=this.parent;return null!==t?t.modelContext:this.refreshProvider.updatedModelContext()}extendModelContext(t){return t}get modelContext(){return 0!=(this.flags&y.ContextualFlag)?p.current:this.extendModelContext(this.superModelContext)}init(t){}static create(){return new this}static fromInit(t){let i;i=("object"==typeof t&&null!==t||"function"==typeof t)&&e.Creatable.is(t.type)?t.type:this;const n=i.create();return n.init(t),n}static fromAny(t){if(null==t)return t;if(t instanceof y){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return e.Creatable.is(t)?t.create():this.fromInit(t)}}y.uid=function(){let t=1;return function(){const e=~~t;return t+=1,e}}(),y.MountedFlag=i.Component.MountedFlag,y.RemovingFlag=i.Component.RemovingFlag,y.AnalyzingFlag=1<<i.Component.FlagShift+0,y.RefreshingFlag=1<<i.Component.FlagShift+1,y.ContextualFlag=1<<i.Component.FlagShift+2,y.ConsumingFlag=1<<i.Component.FlagShift+3,y.UpdatingMask=y.AnalyzingFlag|y.RefreshingFlag,y.StatusMask=y.MountedFlag|y.RemovingFlag|y.AnalyzingFlag|y.RefreshingFlag|y.ContextualFlag|y.ConsumingFlag,y.NeedsAnalyze=1<<i.Component.FlagShift+4,y.NeedsMutate=1<<i.Component.FlagShift+5,y.NeedsAggregate=1<<i.Component.FlagShift+6,y.NeedsCorrelate=1<<i.Component.FlagShift+7,y.AnalyzeMask=y.NeedsAnalyze|y.NeedsMutate|y.NeedsAggregate|y.NeedsCorrelate,y.NeedsRefresh=1<<i.Component.FlagShift+8,y.NeedsValidate=1<<i.Component.FlagShift+9,y.NeedsReconcile=1<<i.Component.FlagShift+10,y.RefreshMask=y.NeedsRefresh|y.NeedsValidate|y.NeedsReconcile,y.UpdateMask=y.AnalyzeMask|y.RefreshMask,y.FlagShift=i.Component.FlagShift+11,y.FlagMask=(1<<y.FlagShift)-1,y.MountFlags=0,y.InsertChildFlags=0,y.RemoveChildFlags=0,y.InsertTraitFlags=0,y.RemoveTraitFlags=0,y.StartConsumingFlags=0,y.StopConsumingFlags=0,u([i.Provider({extends:g,type:f,observes:!1,service:f.global()})],y.prototype,"refreshProvider",void 0),u([i.Provider({extends:w,type:v,observes:!1,service:v.global()})],y.prototype,"selectionProvider",void 0),u([i.Provider({extends:n.WarpProvider,type:n.WarpService,observes:!1,service:n.WarpService.global()})],y.prototype,"warpProvider",void 0),u([i.Property({type:Object,inherits:!0,value:null,updateFlags:y.NeedsReconcile})],y.prototype,"warpRef",void 0);const m=function(t){const e=t.extend("ModelRelation");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.initModel=function(t){},e.prototype.willAttachModel=function(t,e){},e.prototype.onAttachModel=function(t,e){!0===this.observes&&t.observe(this)},e.prototype.didAttachModel=function(t,e){},e.prototype.deinitModel=function(t){},e.prototype.willDetachModel=function(t){},e.prototype.onDetachModel=function(t){!0===this.observes&&t.unobserve(this)},e.prototype.didDetachModel=function(t){},Object.defineProperty(e.prototype,"parentModel",{get(){const t=this.owner;return t instanceof y?t:t instanceof S?t.model:null},configurable:!0}),e.prototype.insertChild=function(t,e,i,n){t.insertChild(e,i,n)},e.prototype.bindModel=function(t,e){},e.prototype.unbindModel=function(t){},e.prototype.detectModel=function(t){return null},e.prototype.createModel=function(){let t;const e=this.type;if(void 0!==e&&(t=e.create()),null==t){let t="Unable to create ";throw 0!==this.name.length&&(t+=this.name+" "),t+="model",new Error(t)}return t},e.prototype.fromAny=function(t){const e=this.type;return void 0!==e?e.fromAny(t):y.fromAny(t)},Object.defineProperty(e.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!0},configurable:!0}),e.construct=function(e,i,n){return i=t.construct(e,i,n)},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,null==i&&(i=this);const s=i.extend(t,e);return s.construct=function(t,e,s){return e=i.construct(t,e,s),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),e},s},e}(i.Fastener),b=function(t){const e=t.extend("ModelRef");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.onInherit=function(t){this.setModel(t.model)},e.prototype.getModel=function(){const t=this.model;if(null===t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="model",new TypeError(e)}return t},e.prototype.setModel=function(t,e,i){null!==t&&(t=this.fromAny(t));let n=this.model;if(n!==t){let o;void 0===e&&(e=null),this.binds&&(o=this.parentModel,null!==o)&&(null!==n&&n.parent===o&&(null===e&&(e=n.nextSibling),n.remove()),null!==t&&(void 0===i&&(i=this.key),this.insertChild(o,t,e,i)),n=this.model),n!==t&&(null!==n&&(this.willDetachModel(n),this.model=null,this.onDetachModel(n),this.deinitModel(n),this.didDetachModel(n)),null!==t&&(this.willAttachModel(t,e),this.model=t,this.onAttachModel(t,e),this.initModel(t),this.didAttachModel(t,e)))}return n},e.prototype.attachModel=function(t,e){const i=this.model;return(t=null!=t?this.fromAny(t):null===i?this.createModel():i)!==i&&(void 0===e&&(e=null),null!==i&&(this.willDetachModel(i),this.model=null,this.onDetachModel(i),this.deinitModel(i),this.didDetachModel(i)),this.willAttachModel(t,e),this.model=t,this.onAttachModel(t,e),this.initModel(t),this.didAttachModel(t,e)),t},e.prototype.detachModel=function(){const t=this.model;return null!==t&&(this.willDetachModel(t),this.model=null,this.onDetachModel(t),this.deinitModel(t),this.didDetachModel(t)),t},e.prototype.insertModel=function(t,e,i,n){if(null!=e)e=this.fromAny(e);else{const t=this.model;e=null===t?this.createModel():t}null==t&&(t=this.parentModel),void 0===i&&(i=null),void 0===n&&(n=this.key),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const o=this.model;return e!==o&&(null!==o&&(this.willDetachModel(o),this.model=null,this.onDetachModel(o),this.deinitModel(o),this.didDetachModel(o),o.remove()),this.willAttachModel(e,i),this.model=e,this.onAttachModel(e,i),this.initModel(e),this.didAttachModel(e,i)),e},e.prototype.removeModel=function(){const t=this.model;return null!==t&&t.remove(),t},e.prototype.deleteModel=function(){const t=this.detachModel();return null!==t&&t.remove(),t},e.prototype.bindModel=function(t,e){if(this.binds&&null===this.model){const i=this.detectModel(t);null!==i&&(this.willAttachModel(i,e),this.model=i,this.onAttachModel(i,e),this.initModel(i),this.didAttachModel(i,e))}},e.prototype.unbindModel=function(t){if(this.binds){const e=this.detectModel(t);null!==e&&this.model===e&&(this.willDetachModel(e),this.model=null,this.onDetachModel(e),this.deinitModel(e),this.didDetachModel(e))}},e.prototype.detectModel=function(t){const e=this.key;return void 0!==e&&e===t.key?t:null},e.construct=function(e,i,n){return null===i&&(delete(i=function(t,e,n){return void 0===t?i.model:(i.setModel(t,e,n),i.owner)}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).model=null,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,!0===e.key?Object.defineProperty(e,"key",{value:t,configurable:!0}):!1===e.key&&Object.defineProperty(e,"key",{value:void 0,configurable:!0}),null==i&&(i=this);const s=i.extend(t,e);return s.construct=function(t,e,s){return e=i.construct(t,e,s),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),e},s},e}(m),C=function(t){const e=t.extend("ModelSet");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.hasModel=function(t){return void 0!==this.models[t.uid]},e.prototype.addModel=function(t,e,i){let n;t=null!=t?this.fromAny(t):this.createModel(),void 0===e&&(e=null),this.binds&&(n=this.parentModel,null!==n)&&(void 0===i&&(i=this.key(t)),this.insertChild(n,t,e,i));const o=this.models;return void 0===o[t.uid]&&(this.willAttachModel(t,e),o[t.uid]=t,this.modelCount+=1,this.onAttachModel(t,e),this.initModel(t),this.didAttachModel(t,e)),t},e.prototype.attachModel=function(t,e){t=null!=t?this.fromAny(t):this.createModel();const i=this.models;return void 0===i[t.uid]&&(void 0===e&&(e=null),this.willAttachModel(t,e),i[t.uid]=t,this.modelCount+=1,this.onAttachModel(t,e),this.initModel(t),this.didAttachModel(t,e)),t},e.prototype.detachModel=function(t){const e=this.models;return void 0!==e[t.uid]?(this.willDetachModel(t),this.modelCount-=1,delete e[t.uid],this.onDetachModel(t),this.deinitModel(t),this.didDetachModel(t),t):null},e.prototype.insertModel=function(t,e,i,n){e=null!=e?this.fromAny(e):this.createModel(),null==t&&(t=this.parentModel),void 0===i&&(i=null),void 0===n&&(n=this.key(e)),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const o=this.models;return void 0===o[e.uid]&&(this.willAttachModel(e,i),o[e.uid]=e,this.modelCount+=1,this.onAttachModel(e,i),this.initModel(e),this.didAttachModel(e,i)),e},e.prototype.removeModel=function(t){return this.hasModel(t)?(t.remove(),t):null},e.prototype.deleteModel=function(t){const e=this.detachModel(t);return null!==e&&e.remove(),e},e.prototype.bindModel=function(t,e){if(this.binds){const i=this.detectModel(t),n=this.models;null!==i&&void 0===n[i.uid]&&(this.willAttachModel(i,e),n[i.uid]=i,this.modelCount+=1,this.onAttachModel(i,e),this.initModel(i),this.didAttachModel(i,e))}},e.prototype.unbindModel=function(t){if(this.binds){const e=this.detectModel(t),i=this.models;null!==e&&void 0!==i[e.uid]&&(this.willDetachModel(e),this.modelCount-=1,delete i[e.uid],this.onDetachModel(e),this.deinitModel(e),this.didDetachModel(e))}},e.prototype.detectModel=function(t){return"function"==typeof this.type&&t instanceof this.type?t:null},e.prototype.key=function(t){},Object.defineProperty(e.prototype,"sorted",{get(){return 0!=(this.flags&e.SortedFlag)},configurable:!0}),e.prototype.initInherits=function(t){this.flags=t?this.flags|e.SortedFlag:this.flags&~e.SortedFlag},e.prototype.sort=function(t){void 0===t&&(t=!0);const i=this.flags;if(t&&0==(i&e.SortedFlag)){const t=this.parentModel;this.willSort(t),this.setFlags(i|e.SortedFlag),this.onSort(t),this.didSort(t)}else t||0==(i&e.SortedFlag)||this.setFlags(i&~e.SortedFlag);return this},e.prototype.willSort=function(t){},e.prototype.onSort=function(t){null!==t&&this.sortChildren(t)},e.prototype.didSort=function(t){},e.prototype.sortChildren=function(t){t.sortChildren(this.compareChildren.bind(this))},e.prototype.compareChildren=function(t,e){const i=this.models,n=i[t.uid],o=i[e.uid];return void 0!==n&&void 0!==o?this.compare(n,o):void 0!==n?1:void 0!==o?-1:0},e.prototype.compare=function(t,e){return t.uid<e.uid?-1:t.uid>e.uid?1:0},e.construct=function(e,i,n){return null===i&&(delete(i=function(t){return i.addModel(t),i.owner}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).models={},i.modelCount=0,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits,s=e.sorted;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,delete e.sorted,null==i&&(i=this);const r=i.extend(t,e);return r.construct=function(t,e,r){return e=i.construct(t,e,r),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),void 0!==s&&e.initSorted(s),e},r},e.SortedFlag=1<<t.FlagShift+0,e.FlagShift=t.FlagShift+1,e.FlagMask=(1<<e.FlagShift)-1,e}(m);class S{constructor(){this.uid=this.constructor.uid(),this.key=void 0,this.flags=0,this.model=null,this.nextTrait=null,this.previousTrait=null,this.fasteners=null,this.decoherent=null,this.observers=e.Arrays.empty,this.consumers=e.Arrays.empty,i.FastenerContext.init(this)}setKey(t){this.key=t}setFlags(t){this.flags=t}attachModel(t,e){let i;this.willAttachModel(t),this.model=t,null!==e?(i=e.previousTrait,this.setNextTrait(e),e.setPreviousTrait(this)):(i=t.lastTrait,t.setLastTrait(this)),null!==i?(i.setNextTrait(this),this.setPreviousTrait(i)):t.setFirstTrait(this),t.mounted&&this.mountTrait(),this.onAttachModel(t),this.didAttachModel(t)}willAttachModel(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillAttachModel&&n.traitWillAttachModel(t,this)}}onAttachModel(t){this.bindModelFasteners(t)}didAttachModel(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidAttachModel&&n.traitDidAttachModel(t,this)}}detachModel(t){this.willDetachModel(t),this.mounted&&this.unmountTrait(),this.onDetachModel(t);const e=this.nextTrait,i=this.previousTrait;null!==e?(this.setNextTrait(null),e.setPreviousTrait(i)):t.setLastTrait(i),null!==i?(i.setNextTrait(e),this.setPreviousTrait(null)):t.setFirstTrait(e),this.model=null,this.didDetachModel(t)}willDetachModel(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillDetachModel&&n.traitWillDetachModel(t,this)}}onDetachModel(t){this.unbindModelFasteners(t)}didDetachModel(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidDetachModel&&n.traitDidDetachModel(t,this)}}get modelFlags(){const t=this.model;return null!==t?t.flags:0}setModelFlags(t){const e=this.model;if(null===e)throw new Error("no model");e.setFlags(t)}remove(){const t=this.model;null!==t&&t.removeTrait(this)}get parent(){const t=this.model;return null!==t?t.parent:null}willAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillAttachParent&&n.traitWillAttachParent(t,this)}}onAttachParent(t){}didAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidAttachParent&&n.traitDidAttachParent(t,this)}}willDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillDetachParent&&n.traitWillDetachParent(t,this)}}onDetachParent(t){}didDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidDetachParent&&n.traitDidDetachParent(t,this)}}get nextSibling(){const t=this.model;return null!==t?t.nextSibling:null}get previousSibling(){const t=this.model;return null!==t?t.previousSibling:null}get firstChild(){const t=this.model;return null!==t?t.firstChild:null}get lastChild(){const t=this.model;return null!==t?t.lastChild:null}forEachChild(t,e){const i=this.model;return null!==i?i.forEachChild(t,e):void 0}getChild(t,e){const i=this.model;return null!==i?i.getChild(t,e):null}setChild(t,e){const i=this.model;if(null!==i)return i.setChild(t,e);throw new Error("no model")}appendChild(t,e){const i=this.model;if(null!==i)return i.appendChild(t,e);throw new Error("no model")}prependChild(t,e){const i=this.model;if(null!==i)return i.prependChild(t,e);throw new Error("no model")}insertChild(t,e,i){const n=this.model;if(null!==n)return n.insertChild(t,e,i);throw new Error("no model")}replaceChild(t,e){const i=this.model;if(null!==i)return i.replaceChild(t,e);throw new Error("no model")}get insertChildFlags(){return this.constructor.InsertChildFlags}willInsertChild(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.traitWillInsertChild&&o.traitWillInsertChild(t,e,this)}}onInsertChild(t,e){this.requireUpdate(this.insertChildFlags),this.bindChildFasteners(t,e)}didInsertChild(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.traitDidInsertChild&&o.traitDidInsertChild(t,e,this)}}removeChild(t){const e=this.model;return null!==e?e.removeChild(t):null}get removeChildFlags(){return this.constructor.RemoveChildFlags}willRemoveChild(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillRemoveChild&&n.traitWillRemoveChild(t,this)}this.requireUpdate(this.removeChildFlags)}onRemoveChild(t){this.unbindChildFasteners(t)}didRemoveChild(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidRemoveChild&&n.traitDidRemoveChild(t,this)}}removeChildren(){const t=this.model;if(null!==t)return t.removeChildren()}sortChildren(t){const e=this.model;if(null!==e)return e.sortChildren(t)}getSuper(t){const e=this.model;return null!==e?e.getSuper(t):null}getBase(t){const e=this.model;return null!==e?e.getBase(t):null}setNextTrait(t){this.nextTrait=t}setPreviousTrait(t){this.previousTrait=t}get firstTrait(){const t=this.model;return null!==t?t.firstTrait:null}get lastTrait(){const t=this.model;return null!==t?t.lastTrait:null}forEachTrait(t,e){const i=this.model;return null!==i?i.forEachTrait(t,e):void 0}getTrait(t,e){const i=this.model;return null!==i?i.getTrait(t,e):null}setTrait(t,e){const i=this.model;if(null!==i)return i.setTrait(t,e);throw new Error("no model")}appendTrait(t,e){const i=this.model;if(null!==i)return i.appendTrait(t,e);throw new Error("no model")}prependTrait(t,e){const i=this.model;if(null!==i)return i.prependTrait(t,e);throw new Error("no model")}insertTrait(t,e,i){const n=this.model;if(null!==n)return n.insertTrait(t,e,i);throw new Error("no model")}replaceTraitt(t,e){const i=this.model;if(null!==i)return i.replaceTrait(t,e);throw new Error("no model")}get insertTraitFlags(){return this.constructor.InsertTraitFlags}willInsertTrait(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.traitWillInsertTrait&&o.traitWillInsertTrait(t,e,this)}}onInsertTrait(t,e){this.requireUpdate(this.insertTraitFlags),this.bindTraitFasteners(t,e)}didInsertTrait(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.traitDidInsertTrait&&o.traitDidInsertTrait(t,e,this)}}removeTrait(t){const e=this.model;return null!==e?e.removeTrait(t):null}get removeTraitFlags(){return this.constructor.RemoveTraitFlags}willRemoveTrait(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillRemoveTrait&&n.traitWillRemoveTrait(t,this)}}onRemoveTrait(t){this.requireUpdate(this.removeTraitFlags),this.unbindTraitFasteners(t)}didRemoveTrait(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidRemoveTrait&&n.traitDidRemoveTrait(t,this)}}sortTraits(t){const e=this.model;null!==e&&e.sortTraits(t)}getSuperTrait(t){const e=this.model;return null!==e?e.getSuperTrait(t):null}getBaseTrait(t){const e=this.model;return null!==e?e.getBaseTrait(t):null}get mounted(){return 0!=(this.flags&S.MountedFlag)}get mountFlags(){return this.constructor.MountFlags}mountTrait(){if(0!=(this.flags&S.MountedFlag))throw new Error("already mounted");this.setFlags(this.flags|S.MountedFlag),this.willMount(),this.onMount(),this.didMount()}willMount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitWillMount&&i.traitWillMount(this)}}onMount(){this.requireUpdate(this.mountFlags),null!==this.decoherent&&0!==this.decoherent.length&&this.requireUpdate(y.NeedsMutate),this.mountFasteners(),0!==this.consumers.length&&this.startConsuming()}didMount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitDidMount&&i.traitDidMount(this)}}unmountTrait(){if(0==(this.flags&S.MountedFlag))throw new Error("already unmounted");this.setFlags(this.flags&~S.MountedFlag),this.willUnmount(),this.onUnmount(),this.didUnmount()}willUnmount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitWillUnmount&&i.traitWillUnmount(this)}}onUnmount(){this.stopConsuming(),this.unmountFasteners()}didUnmount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitDidUnmount&&i.traitDidUnmount(this)}}requireUpdate(t,e=!1){const i=this.model;null!==i&&i.requireUpdate(t,e)}needsUpdate(t,e){return t}requestUpdate(t,e,i){const n=this.model;if(null===n)throw new TypeError("no model");n.requestUpdate(t,e,i)}get updating(){const t=this.model;return null!==t&&t.updating}get analyzing(){const t=this.model;return null!==t&&t.analyzing}needsAnalyze(t,e){return t}willAnalyze(t,e){}onAnalyze(t,e){}didAnalyze(t,e){}willMutate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillMutate&&n.traitWillMutate(t,this)}}onMutate(t){this.recohereFasteners(t.updateTime)}didMutate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidMutate&&n.traitDidMutate(t,this)}}willAggregate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillAggregate&&n.traitWillAggregate(t,this)}}onAggregate(t){}didAggregate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidAggregate&&n.traitDidAggregate(t,this)}}willCorrelate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillCorrelate&&n.traitWillCorrelate(t,this)}}onCorrelate(t){}didCorrelate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidCorrelate&&n.traitDidCorrelate(t,this)}}analyzeChildren(t,e,i,n){n.call(this.model,t,e,i)}get refreshing(){const t=this.model;return null!==t&&t.refreshing}needsRefresh(t,e){return t}willRefresh(t,e){}onRefresh(t,e){}didRefresh(t,e){}willValidate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillValidate&&n.traitWillValidate(t,this)}}onValidate(t){}didValidate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidValidate&&n.traitDidValidate(t,this)}}willReconcile(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillReconcile&&n.traitWillReconcile(t,this)}}onReconcile(t){this.recohereDownlinks(t.updateTime)}didReconcile(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidReconcile&&n.traitDidReconcile(t,this)}}refreshChildren(t,e,i,n){n.call(this.model,t,e,i)}hasFastener(t,e){const i=this.fasteners;if(null!==i){const n=i[t];if(void 0!==n&&(null==e||n instanceof e))return!0}return!1}getFastener(t,e){const i=this.fasteners;if(null!==i){const n=i[t];if(void 0!==n&&(null==e||n instanceof e))return n}return null}setFastener(t,e){var i;const n=this.fasteners,o=null!==n&&null!==(i=n[t])&&void 0!==i?i:null;o!==e&&(null!==o&&this.detachFastener(t,o),null!==e&&this.attachFastener(t,e))}attachFastener(t,e){let i=this.fasteners;null===i&&(i={},this.fasteners=i),this.willAttachFastener(t,e),i[t]=e,this.mounted&&e.mount(),this.onAttachFastener(t,e),this.didAttachFastener(t,e)}willAttachFastener(t,e){}onAttachFastener(t,e){this.bindFastener(e)}didAttachFastener(t,e){}detachFastener(t,e){const i=this.fasteners;this.willDetachFastener(t,e),this.onDetachFastener(t,e),this.mounted&&e.unmount(),delete i[t],this.didDetachFastener(t,e)}willDetachFastener(t,e){}onDetachFastener(t,e){}didDetachFastener(t,e){}getLazyFastener(t,e){return i.FastenerContext.getLazyFastener(this,t,e)}getSuperFastener(t,e){const i=this.model;if(null===i)return null;{const n=i.getLazyFastener(t,e);return null!==n?n:i.getSuperFastener(t,e)}}mountFasteners(){const t=this.fasteners;for(const e in t){t[e].mount()}}unmountFasteners(){const t=this.fasteners;for(const e in t){t[e].unmount()}}bindFastener(t){(t instanceof m||t instanceof A)&&t.binds&&this.forEachChild((function(e){t.bindModel(e,null)}),this),t instanceof A&&t.binds&&this.forEachTrait((function(e){t.bindTrait(e,null)}),this),t instanceof n.DownlinkFastener&&!0===t.consumed&&this.consuming&&t.consume(this)}bindModelFasteners(t){const e=this.fasteners;t.forEachChild((function(t){for(const i in e){const n=e[i];this.bindChildFastener(n,t,null)}}),this),t.forEachTrait((function(t){for(const i in e){const n=e[i];this.bindTraitFastener(n,t,null)}}),this)}unbindModelFasteners(t){const e=this.fasteners;t.forEachTrait((function(t){for(const i in e){const n=e[i];this.unbindTraitFastener(n,t)}}),this),t.forEachChild((function(t){for(const i in e){const n=e[i];this.unbindChildFastener(n,t)}}),this)}bindChildFasteners(t,e){const i=this.fasteners;for(const n in i){const o=i[n];this.bindChildFastener(o,t,e)}}bindChildFastener(t,e,i){(t instanceof m||t instanceof A)&&t.bindModel(e,i)}unbindChildFasteners(t){const e=this.fasteners;for(const i in e){const n=e[i];this.unbindChildFastener(n,t)}}unbindChildFastener(t,e){(t instanceof m||t instanceof A)&&t.unbindModel(e)}bindTraitFasteners(t,e){const i=this.fasteners;for(const n in i){const o=i[n];this.bindTraitFastener(o,t,e)}}bindTraitFastener(t,e,i){t instanceof A&&t.bindTrait(e,i)}unbindTraitFasteners(t){const e=this.fasteners;for(const i in e){const n=e[i];this.unbindTraitFastener(n,t)}}unbindTraitFastener(t,e){t instanceof A&&t.unbindTrait(e)}decohereFastener(t){let e=this.decoherent;null===e&&(e=[],this.decoherent=e),e.push(t),t instanceof n.DownlinkFastener?this.requireUpdate(y.NeedsReconcile):this.requireUpdate(y.NeedsMutate)}recohereFasteners(t){const e=this.decoherent;if(null!==e){const i=e.length;if(0!==i){void 0===t&&(t=performance.now()),this.decoherent=null;for(let o=0;o<i;o+=1){const i=e[o];i instanceof n.DownlinkFastener?this.decohereFastener(i):i.recohere(t)}}}}recohereDownlinks(t){const e=this.decoherent;if(null!==e){const i=e.length;if(0!==i){this.decoherent=null;for(let o=0;o<i;o+=1){const i=e[o];i instanceof n.DownlinkFastener?i.recohere(t):this.decohereFastener(i)}}}}observe(t){const i=this.observers,n=e.Arrays.inserted(t,i);i!==n&&(this.willObserve(t),this.observers=n,this.onObserve(t),this.didObserve(t))}willObserve(t){}onObserve(t){}didObserve(t){}unobserve(t){const i=this.observers,n=e.Arrays.removed(t,i);i!==n&&(this.willUnobserve(t),this.observers=n,this.onUnobserve(t),this.didUnobserve(t))}willUnobserve(t){}onUnobserve(t){}didUnobserve(t){}forEachObserver(t){let e;const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];if(e=t.call(this,o),void 0!==e)return e}return e}callObservers(t,...e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n],s=o[t];"function"==typeof s&&s.call(o,...e)}}consume(t){const i=this.consumers,n=e.Arrays.inserted(t,i);i!==n&&(this.willConsume(t),this.consumers=n,this.onConsume(t),this.didConsume(t),0===i.length&&this.mounted&&this.startConsuming())}willConsume(t){}onConsume(t){}didConsume(t){}unconsume(t){const i=this.consumers,n=e.Arrays.removed(t,i);i!==n&&(this.willUnconsume(t),this.consumers=n,this.onUnconsume(t),this.didUnconsume(t),0===n.length&&this.stopConsuming())}willUnconsume(t){}onUnconsume(t){}didUnconsume(t){}get consuming(){return 0!=(this.flags&S.ConsumingFlag)}get startConsumingFlags(){return this.constructor.StartConsumingFlags}startConsuming(){0==(this.flags&S.ConsumingFlag)&&(this.willStartConsuming(),this.setFlags(this.flags|S.ConsumingFlag),this.onStartConsuming(),this.didStartConsuming())}willStartConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitWillStartConsuming&&i.traitWillStartConsuming(this)}}onStartConsuming(){this.requireUpdate(this.startConsumingFlags),this.startConsumingFasteners()}didStartConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitDidStartConsuming&&i.traitDidStartConsuming(this)}}get stopConsumingFlags(){return this.constructor.StopConsumingFlags}stopConsuming(){0!=(this.flags&S.ConsumingFlag)&&(this.willStopConsuming(),this.setFlags(this.flags&~S.ConsumingFlag),this.onStopConsuming(),this.didStopConsuming())}willStopConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitWillStopConsuming&&i.traitWillStopConsuming(this)}}onStopConsuming(){this.requireUpdate(this.stopConsumingFlags),this.stopConsumingFasteners()}didStopConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitDidStopConsuming&&i.traitDidStopConsuming(this)}}startConsumingFasteners(){const t=this.fasteners;for(const e in t){const i=t[e];i instanceof n.DownlinkFastener&&!0===i.consumed&&i.consume(this)}}stopConsumingFasteners(){const t=this.fasteners;for(const e in t){const i=t[e];i instanceof n.DownlinkFastener&&!0===i.consumed&&i.unconsume(this)}}get modelContext(){const t=this.model;return null!==t?t.modelContext:null}equals(t){return this===t}hashCode(){return this.uid}init(t){}static create(){return new this}static fromInit(t){let i;i=("object"==typeof t&&null!==t||"function"==typeof t)&&e.Creatable.is(t.type)?t.type:this;const n=i.create();return n.init(t),n}static fromAny(t){if(null==t)return t;if(t instanceof S){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return e.Creatable.is(t)?t.create():this.fromInit(t)}}S.uid=function(){let t=1;return function(){const e=~~t;return t+=1,e}}(),S.MountedFlag=1,S.ConsumingFlag=2,S.FlagShift=2,S.FlagMask=(1<<S.FlagShift)-1,S.MountFlags=0,S.InsertChildFlags=0,S.RemoveChildFlags=0,S.InsertTraitFlags=0,S.RemoveTraitFlags=0,S.StartConsumingFlags=0,S.StopConsumingFlags=0,u([i.Provider({extends:n.WarpProvider,type:n.WarpService,observes:!1,service:n.WarpService.global()})],S.prototype,"warpProvider",void 0),u([i.Property({type:Object,inherits:!0,value:null,updateFlags:y.NeedsReconcile})],S.prototype,"warpRef",void 0);const A=function(t){const e=t.extend("TraitRelation");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.initTrait=function(t){},e.prototype.willAttachTrait=function(t,e){},e.prototype.onAttachTrait=function(t,e){!0===this.observes&&t.observe(this)},e.prototype.didAttachTrait=function(t,e){},e.prototype.deinitTrait=function(t){},e.prototype.willDetachTrait=function(t){},e.prototype.onDetachTrait=function(t){!0===this.observes&&t.unobserve(this)},e.prototype.didDetachTrait=function(t){},Object.defineProperty(e.prototype,"parentModel",{get(){const t=this.owner;return t instanceof y?t:t instanceof S?t.model:null},configurable:!0}),e.prototype.insertChild=function(t,e,i,n){t.insertTrait(e,i,n)},e.prototype.bindModel=function(t,e){},e.prototype.unbindModel=function(t){},e.prototype.detectModel=function(t){return null},e.prototype.bindTrait=function(t,e){},e.prototype.unbindTrait=function(t){},e.prototype.detectTrait=function(t){return null},e.prototype.createTrait=function(){const t=this.type;if(void 0!==t)return t.create();{let t="Unable to create ";throw 0!==this.name.length&&(t+=this.name+" "),t+="trait",new Error(t)}},e.prototype.fromAny=function(t){const e=this.type;return void 0!==e?e.fromAny(t):S.fromAny(t)},Object.defineProperty(e.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!0},configurable:!0}),e.construct=function(e,i,n){return i=t.construct(e,i,n)},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,null==i&&(i=this);const s=i.extend(t,e);return s.construct=function(t,e,s){return e=i.construct(t,e,s),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),e},s},e}(i.Fastener),x=function(t){const e=t.extend("TraitRef");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.onInherit=function(t){this.setTrait(t.trait)},e.prototype.getTrait=function(){const t=this.trait;if(null===t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="trait",new TypeError(e)}return t},e.prototype.setTrait=function(t,e,i){null!==t&&(t=this.fromAny(t));let n=this.trait;if(n!==t){let o;void 0===e&&(e=null),this.binds&&(o=this.parentModel,null!==o)&&(null!==n&&n.model===o&&(null===e&&(e=n.nextTrait),n.remove()),null!==t&&(void 0===i&&(i=this.key),this.insertChild(o,t,e,i)),n=this.trait),n!==t&&(null!==n&&(this.willDetachTrait(n),this.trait=null,this.onDetachTrait(n),this.deinitTrait(n),this.didDetachTrait(n)),null!==t&&(this.willAttachTrait(t,e),this.trait=t,this.onAttachTrait(t,e),this.initTrait(t),this.didAttachTrait(t,e)))}return n},e.prototype.attachTrait=function(t,e){const i=this.trait;return(t=null!=t?this.fromAny(t):null===i?this.createTrait():i)!==i&&(void 0===e&&(e=null),null!==i&&(this.willDetachTrait(i),this.trait=null,this.onDetachTrait(i),this.deinitTrait(i),this.didDetachTrait(i)),this.willAttachTrait(t,e),this.trait=t,this.onAttachTrait(t,e),this.initTrait(t),this.didAttachTrait(t,e)),t},e.prototype.detachTrait=function(){const t=this.trait;return null!==t&&(this.willDetachTrait(t),this.trait=null,this.onDetachTrait(t),this.deinitTrait(t),this.didDetachTrait(t)),t},e.prototype.insertTrait=function(t,e,i,n){if(null!=e)e=this.fromAny(e);else{const t=this.trait;e=null===t?this.createTrait():t}null==t&&(t=this.parentModel),void 0===i&&(i=null),void 0===n&&(n=this.key),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const o=this.trait;return e!==o&&(null!==o&&(this.willDetachTrait(o),this.trait=null,this.onDetachTrait(o),this.deinitTrait(o),this.didDetachTrait(o),o.remove()),this.willAttachTrait(e,i),this.trait=e,this.onAttachTrait(e,i),this.initTrait(e),this.didAttachTrait(e,i)),e},e.prototype.removeTrait=function(){const t=this.trait;return null!==t&&t.remove(),t},e.prototype.deleteTrait=function(){const t=this.detachTrait();return null!==t&&t.remove(),t},e.prototype.bindModel=function(t,e){if(this.binds&&null===this.trait){const e=this.detectModel(t);null!==e&&(this.willAttachTrait(e,null),this.trait=e,this.onAttachTrait(e,null),this.initTrait(e),this.didAttachTrait(e,null))}},e.prototype.unbindModel=function(t){if(this.binds){const e=this.detectModel(t);null!==e&&this.trait===e&&(this.willDetachTrait(e),this.trait=null,this.onDetachTrait(e),this.deinitTrait(e),this.didDetachTrait(e))}},e.prototype.detectModel=function(t){return null},e.prototype.bindTrait=function(t,e){if(this.binds&&null===this.trait){const i=this.detectTrait(t);null!==i&&(this.willAttachTrait(i,e),this.trait=i,this.onAttachTrait(i,e),this.initTrait(i),this.didAttachTrait(i,e))}},e.prototype.unbindTrait=function(t){if(this.binds){const e=this.detectTrait(t);null!==e&&this.trait===e&&(this.willDetachTrait(e),this.trait=null,this.onDetachTrait(e),this.deinitTrait(e),this.didDetachTrait(e))}},e.prototype.detectTrait=function(t){const e=this.key;return void 0!==e&&e===t.key?t:null},e.construct=function(e,i,n){return null===i&&(delete(i=function(t,e,n){return void 0===t?i.trait:(i.setTrait(t,e,n),i.owner)}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).trait=null,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,!0===e.key?Object.defineProperty(e,"key",{value:t,configurable:!0}):!1===e.key&&Object.defineProperty(e,"key",{value:void 0,configurable:!0}),null==i&&(i=this);const s=i.extend(t,e);return s.construct=function(t,e,s){return e=i.construct(t,e,s),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),e},s},e}(A),T=function(t){const e=t.extend("TraitSet");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.hasTrait=function(t){return void 0!==this.traits[t.uid]},e.prototype.addTrait=function(t,e,i){let n;t=null!=t?this.fromAny(t):this.createTrait(),void 0===e&&(e=null),this.binds&&(n=this.parentModel,null!==n)&&(void 0===i&&(i=this.key(t)),this.insertChild(n,t,e,i));const o=this.traits;return void 0===o[t.uid]&&(this.willAttachTrait(t,e),o[t.uid]=t,this.traitCount+=1,this.onAttachTrait(t,e),this.initTrait(t),this.didAttachTrait(t,e)),t},e.prototype.attachTrait=function(t,e){t=null!=t?this.fromAny(t):this.createTrait();const i=this.traits;return void 0===i[t.uid]&&(void 0===e&&(e=null),this.willAttachTrait(t,e),i[t.uid]=t,this.traitCount+=1,this.onAttachTrait(t,e),this.initTrait(t),this.didAttachTrait(t,e)),t},e.prototype.detachTrait=function(t){const e=this.traits;return void 0!==e[t.uid]?(this.willDetachTrait(t),this.traitCount-=1,delete e[t.uid],this.onDetachTrait(t),this.deinitTrait(t),this.didDetachTrait(t),t):null},e.prototype.insertTrait=function(t,e,i,n){e=null!=e?this.fromAny(e):this.createTrait(),null==t&&(t=this.parentModel),void 0===i&&(i=null),void 0===n&&(n=this.key(e)),null===t||e.model===t&&e.key===n||this.insertChild(t,e,i,n);const o=this.traits;return void 0===o[e.uid]&&(this.willAttachTrait(e,i),o[e.uid]=e,this.traitCount+=1,this.onAttachTrait(e,i),this.initTrait(e),this.didAttachTrait(e,i)),e},e.prototype.removeTrait=function(t){return this.hasTrait(t)?(t.remove(),t):null},e.prototype.deleteTrait=function(t){const e=this.detachTrait(t);return null!==e&&e.remove(),e},e.prototype.bindModel=function(t,e){if(this.binds){const e=this.detectModel(t),i=this.traits;null!==e&&void 0===i[e.uid]&&(this.willAttachTrait(e,null),i[e.uid]=e,this.traitCount+=1,this.onAttachTrait(e,null),this.initTrait(e),this.didAttachTrait(e,null))}},e.prototype.unbindModel=function(t){if(this.binds){const e=this.detectModel(t),i=this.traits;null!==e&&void 0!==i[e.uid]&&(this.willDetachTrait(e),this.traitCount-=1,delete i[e.uid],this.onDetachTrait(e),this.deinitTrait(e),this.didDetachTrait(e))}},e.prototype.detectModel=function(t){return null},e.prototype.bindTrait=function(t,e){if(this.binds){const i=this.detectTrait(t),n=this.traits;null!==i&&void 0===n[i.uid]&&(this.willAttachTrait(i,e),n[i.uid]=i,this.traitCount+=1,this.onAttachTrait(i,e),this.initTrait(i),this.didAttachTrait(i,e))}},e.prototype.unbindTrait=function(t){if(this.binds){const e=this.detectTrait(t),i=this.traits;null!==e&&void 0!==i[e.uid]&&(this.willDetachTrait(e),this.traitCount-=1,delete i[e.uid],this.onDetachTrait(e),this.deinitTrait(e),this.didDetachTrait(e))}},e.prototype.detectTrait=function(t){return"function"==typeof this.type&&t instanceof this.type?t:null},e.prototype.key=function(t){},Object.defineProperty(e.prototype,"sorted",{get(){return 0!=(this.flags&e.SortedFlag)},configurable:!0}),e.prototype.initInherits=function(t){this.flags=t?this.flags|e.SortedFlag:this.flags&~e.SortedFlag},e.prototype.sort=function(t){void 0===t&&(t=!0);const i=this.flags;if(t&&0==(i&e.SortedFlag)){const t=this.parentModel;this.willSort(t),this.setFlags(i|e.SortedFlag),this.onSort(t),this.didSort(t)}else t||0==(i&e.SortedFlag)||this.setFlags(i&~e.SortedFlag);return this},e.prototype.willSort=function(t){},e.prototype.onSort=function(t){null!==t&&this.sortChildren(t)},e.prototype.didSort=function(t){},e.prototype.sortChildren=function(t){t.sortTraits(this.compareChildren.bind(this))},e.prototype.compareChildren=function(t,e){const i=this.traits,n=i[t.uid],o=i[e.uid];return void 0!==n&&void 0!==o?this.compare(n,o):void 0!==n?1:void 0!==o?-1:0},e.prototype.compare=function(t,e){return t.uid<e.uid?-1:t.uid>e.uid?1:0},e.construct=function(e,i,n){return null===i&&(delete(i=function(t){return i.addTrait(t),i.owner}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).traits={},i.traitCount=0,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits,s=e.sorted;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,delete e.sorted,null==i&&(i=this);const r=i.extend(t,e);return r.construct=function(t,e,r){return e=i.construct(t,e,r),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),void 0!==s&&e.initSorted(s),e},r},e.SortedFlag=1<<t.FlagShift+0,e.FlagShift=t.FlagShift+1,e.FlagMask=(1<<e.FlagShift)-1,e}(A);class D extends S{constructor(){super(),this.selected=!1}select(t){if(!this.selected&&(this.selected=!0,this.mounted)){const e=this.selectionProvider.service;null!=e&&e.select(this.model,t)}}willSelect(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillSelect&&n.traitWillSelect(t,this)}}onSelect(t){this.selected=!0}didSelect(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidSelect&&n.traitDidSelect(t,this)}}unselect(){if(this.selected&&(this.selected=!1,this.mounted)){const t=this.selectionProvider.service;null!=t&&t.unselect(this.model)}}willUnselect(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitWillUnselect&&i.traitWillUnselect(this)}}onUnselect(){this.selected=!1}didUnselect(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitDidUnselect&&i.traitDidUnselect(this)}}unselectAll(){const t=this.selectionProvider.service;null!=t&&t.unselectAll()}toggle(t){this.selected?this.unselect():this.select(t)}didMount(){if(this.selected){const t=this.selectionProvider.service;null!=t&&t.select(this.model)}super.didMount()}willUnmount(){super.willUnmount();const t=this.selectionProvider.service;null!=t&&t.unselect(this.model)}}u([i.Provider({extends:w,type:v,observes:!1,service:v.global()})],D.prototype,"selectionProvider",void 0);class V extends S{}u([x({type:S,observes:!0,didAttachTrait(t){t.consuming&&this.owner.consume(t)},willDetachTrait(t){t.consuming&&this.owner.unconsume(t)},traitDidStartConsuming(t){this.owner.consume(t)},traitWillStopConsuming(t){this.owner.unconsume(t)}})],V.prototype,"driver",void 0);class P extends V{downlinkDidSet(t,e){}}u([n.ValueDownlinkFastener({lazy:!1,consumed:!0,didSet(t,e){this.owner.consuming&&this.owner.downlinkDidSet(t,e)}})],P.prototype,"downlink",void 0);class I extends V{downlinkDidUpdate(t,e,i){}downlinkDidRemove(t,e){}}u([n.MapDownlinkFastener({lazy:!1,consumed:!0,didUpdate(t,e,i){this.owner.consuming&&this.owner.downlinkDidUpdate(t,e,i)},didRemove(t,e){this.owner.consuming&&this.owner.downlinkDidRemove(t,e)}})],I.prototype,"downlink",void 0);const M=function(){const t={fromAny:function(t){return"string"!=typeof t||"large"!==t&&"larger"!==t&&"medium"!==t&&"small"!==t&&"smaller"!==t&&"x-large"!==t&&"x-small"!==t&&"xx-large"!==t&&"xx-small"!==t?o.Length.fromAny(t):t},fromValue:function(e){const i=e.stringValue(null);if(null!==i)return t.fromAny(i);{const t=o.Length.form().cast(e);return void 0!==t?t:null}}};return t}(),k=function(){const t={fromAny:function(t){return"string"==typeof t&&"normal"===t?t:o.Length.fromAny(t)},fromValue:function(e){const i=e.stringValue(null);if(null!==i)return t.fromAny(i);{const t=o.Length.form().cast(e);return void 0!==t?t:null}}};return t}(),F=function(){const t={fromValue:function(t){let e=null;return t.forEach((function(t){if(t instanceof r.Value){const i=t.stringValue(void 0);void 0!==i&&(null===e?e=i:"string"==typeof e?e=[e,i]:e.push(i))}})),e},format:function(t){const i=t.length;let n;if(i>0){n=s.Unicode.isAlpha(t.charCodeAt(0));for(let o=e.Strings.offsetByCodePoints(t,0,1);n&&o<i;o=e.Strings.offsetByCodePoints(t,o,1)){const e=t.charCodeAt(o);n=s.Unicode.isAlpha(e)||45===e}}else n=!1;if(n)return t;{let n=s.Unicode.stringOutput();n=n.write(34);for(let o=0;o<i;o=e.Strings.offsetByCodePoints(t,o,1)){const e=t.charCodeAt(o);if(10===e||34===e||39===e)n=n.write(92).write(e);else if(e>=32)n=n.write(e);else{const t=s.Base16.uppercase;n=n.write(92).write(t.encodeDigit(e>>>20&15)).write(t.encodeDigit(e>>>16&15)).write(t.encodeDigit(e>>>12&15)).write(t.encodeDigit(e>>>8&15)).write(t.encodeDigit(e>>>4&15)).write(t.encodeDigit(15&e))}}return n=n.write(34),n.toString()}}};return t}();class R extends s.Parser{constructor(t,e,i,n){super(),this.output=t,this.quote=e,this.code=i,this.step=n}feed(t){return R.parse(t,this.output,this.quote,this.code,this.step)}static parse(t,e,i=0,n=0,o=1){let r=0;if(1===o){for(;t.isCont()&&(r=t.head(),s.Unicode.isSpace(r));)t=t.step();if(t.isCont())if(s.Unicode.isAlpha(r)||45===r)e=e||s.Unicode.stringOutput(),o=2;else{if(34!==r&&(39!==r||i!==r&&0!==i))return s.Parser.error(s.Diagnostic.expected("font family",t));t=t.step(),e=e||s.Unicode.stringOutput(),i=r,o=3}else if(t.isDone())return s.Parser.error(s.Diagnostic.expected("font family",t))}if(2===o){for(;t.isCont()&&(r=t.head(),s.Unicode.isAlpha(r)||45===r);)t=t.step(),e.write(r);if(!t.isEmpty())return s.Parser.done(e.bind())}t:for(;;){if(3===o){for(;t.isCont()&&(r=t.head(),r>=32&&r!==i&&92!==r);)t=t.step(),e.write(r);if(t.isCont()){if(r===i)return t=t.step(),s.Parser.done(e.bind());if(92!==r)return s.Parser.error(s.Diagnostic.expected(i,t));t=t.step(),o=4}else if(t.isDone())return s.Parser.error(s.Diagnostic.expected(i,t))}if(4===o)if(t.isCont()){if(r=t.head(),!s.Base16.isDigit(r)){if(10===r){t.step(),o=3;continue}t.step(),e.write(r),o=3;continue}o=5}else if(t.isDone())return s.Parser.error(s.Diagnostic.expected("escape character",t));if(o>=5)for(;;){if(t.isCont()&&(r=t.head(),s.Base16.isDigit(r))){if(t=t.step(),n=16*n+s.Base16.decodeDigit(r),o<=11){o+=1;continue}if(0===n)return s.Parser.error(s.Diagnostic.message("zero escape",t));e.write(n),n=0,o=3;continue t}if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t));break}break}return new R(e,i,n,o)}}class O{constructor(t,e,i,n,o,s,r){this.style=t,this.variant=e,this.weight=i,this.stretch=n,this.size=o,this.height=s,this.family=r,this.stringValue=void 0}withStyle(t){return t===this.style?this:new O(t,this.variant,this.weight,this.stretch,this.size,this.height,this.family)}withVariant(t){return t===this.variant?this:new O(this.style,t,this.weight,this.stretch,this.size,this.height,this.family)}withWeight(t){return t===this.weight?this:new O(this.style,this.variant,t,this.stretch,this.size,this.height,this.family)}withStretch(t){return t===this.stretch?this:new O(this.style,this.variant,this.weight,t,this.size,this.height,this.family)}withSize(t){return null!==t&&(t=M.fromAny(t)),e.Values.equal(t,this.size)?this:new O(this.style,this.variant,this.weight,this.stretch,t,this.height,this.family)}withHeight(t){return null!==t&&(t=k.fromAny(t)),e.Values.equal(t,this.height)?this:new O(this.style,this.variant,this.weight,this.stretch,this.size,t,this.family)}withFamily(t){return Array.isArray(t)&&1===t.length&&(t=t[0]),e.Values.equal(t,this.family)?this:new O(this.style,this.variant,this.weight,this.stretch,this.size,this.height,t)}toAny(){return{style:this.style,variant:this.variant,weight:this.weight,stretch:this.stretch,size:this.size,height:this.height,family:Array.isArray(this.family)?this.family.slice(0):this.family}}interpolateTo(t){return t instanceof O?W(this,t):null}equivalentTo(t,i){return this===t||t instanceof O&&(this.style===t.style&&this.variant===t.variant&&this.weight===t.weight&&this.stretch===t.stretch&&e.Values.equivalent(this.size,t.size,i)&&e.Values.equivalent(this.height,t.height,i)&&e.Values.equivalent(this.family,t.family,i))}equals(t){return this===t||t instanceof O&&(this.style===t.style&&this.variant===t.variant&&this.weight===t.weight&&this.stretch===t.stretch&&e.Values.equal(this.size,t.size)&&e.Values.equal(this.height,t.height)&&e.Values.equal(this.family,t.family))}debug(t){if(t=t.write("Font").write(46).write("family").write(40),"string"==typeof this.family)t=t.debug(this.family);else if(Array.isArray(this.family)&&0!==this.family.length){t=t.debug(this.family[0]);for(let e=1;e<this.family.length;e+=1)t=t.write(", ").debug(this.family[e])}return t=t.write(41),void 0!==this.style&&(t=t.write(46).write("style").write(40).debug(this.style).write(41)),void 0!==this.variant&&(t=t.write(46).write("variant").write(40).debug(this.variant).write(41)),void 0!==this.weight&&(t=t.write(46).write("weight").write(40).debug(this.weight).write(41)),void 0!==this.stretch&&(t=t.write(46).write("stretch").write(40).debug(this.stretch).write(41)),void 0!==this.size&&(t=t.write(46).write("size").write(40).debug(this.size).write(41)),void 0!==this.height&&(t=t.write(46).write("height").write(40).debug(this.height).write(41)),t}toString(){var t,e,i;let n=this.stringValue;if(void 0===n){if(n="",void 0===this.style&&"normal"!==this.variant&&"normal"!==this.weight&&"normal"!==this.stretch||(n+=null!==(t=this.style)&&void 0!==t?t:"normal"),void 0===this.variant&&"normal"!==this.weight&&"normal"!==this.stretch||(0!==n.length&&(n+=" "),n+=null!==(e=this.variant)&&void 0!==e?e:"normal"),void 0===this.weight&&"normal"!==this.stretch||(0!==n.length&&(n+=" "),n+=null!==(i=this.weight)&&void 0!==i?i:"normal"),void 0!==this.stretch&&(0!==n.length&&(n+=" "),n+=this.stretch),null!==this.size&&(0!==n.length&&(n+=" "),n+=this.size.toString(),null!==this.height&&(n+="/",n+=this.height.toString())),"string"==typeof this.family)0!==n.length&&(n+=" "),n+=F.format(this.family);else if(Array.isArray(this.family)&&0!==this.family.length){0!==n.length&&(n+=" "),n+=F.format(this.family[0]);for(let t=1;t<this.family.length;t+=1)n+=", ",n+=F.format(this.family[t])}this.stringValue=n}return n}static style(t,e){return Array.isArray(e)&&1===e.length&&(e=e[0]),new O(t,void 0,void 0,void 0,null,null,e)}static variant(t,e){return Array.isArray(e)&&1===e.length&&(e=e[0]),new O(void 0,t,void 0,void 0,null,null,e)}static weight(t,e){return Array.isArray(e)&&1===e.length&&(e=e[0]),new O(void 0,void 0,t,void 0,null,null,e)}static stretch(t,e){return Array.isArray(e)&&1===e.length&&(e=e[0]),new O(void 0,void 0,void 0,t,null,null,e)}static size(t,e){return t=null!==t?M.fromAny(t):null,Array.isArray(e)&&1===e.length&&(e=e[0]),new O(void 0,void 0,void 0,void 0,t,null,e)}static family(t){return Array.isArray(t)&&1===t.length&&(t=t[0]),new O(void 0,void 0,void 0,void 0,null,null,t)}static create(t,e,i,n,o,s,r){return o=null!=o?M.fromAny(o):null,s=null!=s?k.fromAny(s):null,Array.isArray(r)&&1===r.length&&(r=r[0]),new O(t,e,i,n,o,s,r)}static fromInit(t){return O.create(t.style,t.variant,t.weight,t.stretch,t.size,t.height,t.family)}static fromValue(t){const e=t.header("font");if(e.isDefined()){const t=e.get("style").stringValue(void 0),i=e.get("variant").stringValue(void 0),n=e.get("weight").stringValue(void 0),o=e.get("stretch").stringValue(void 0),s=M.fromValue(e.get("size")),r=k.fromValue(e.get("height")),l=F.fromValue(e.get("family"));if(null!==l)return O.create(t,i,n,o,s,r,l)}return null}static fromAny(t){if(null==t||t instanceof O)return t;if("object"==typeof t&&null!==t)return O.fromInit(t);if("string"==typeof t)return O.parse(t);throw new TypeError(""+t)}static parse(t){let e=s.Unicode.stringInput(t);for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();let i=N.parse(e);if(i.isDone())for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=s.Parser.error(s.Diagnostic.unexpected(e))),i.bind()}static isInit(t){if("object"==typeof t&&null!==t){return void 0!==t.family}return!1}static isAny(t){return t instanceof O||O.isInit(t)}static form(t){return new E(void 0)}}u([e.Lazy],O,"form",null);const W=function(t){const i=function(t,n){const o=function(t){const e=o.styleInterpolator(t),i=o.variantInterpolator(t),n=o.weightInterpolator(t),s=o.stretchInterpolator(t),r=o.sizeInterpolator(t),l=o.heightInterpolator(t),a=o.familyInterpolator(t);return new O(e,i,n,s,r,l,a)};return Object.setPrototypeOf(o,i.prototype),o.styleInterpolator=e.Interpolator(t.style,n.style),o.variantInterpolator=e.Interpolator(t.variant,n.variant),o.weightInterpolator=e.Interpolator(t.weight,n.weight),o.stretchInterpolator=e.Interpolator(t.stretch,n.stretch),o.sizeInterpolator=e.Interpolator(t.size,n.size),o.heightInterpolator=e.Interpolator(t.height,n.height),o.familyInterpolator=e.Interpolator(t.family,n.family),o};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.styleInterpolator[0],e=this.variantInterpolator[0],i=this.weightInterpolator[0],n=this.stretchInterpolator[0],o=this.sizeInterpolator[0],s=this.heightInterpolator[0],r=this.familyInterpolator[0];return new O(t,e,i,n,o,s,r)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.styleInterpolator[1],e=this.variantInterpolator[1],i=this.weightInterpolator[1],n=this.stretchInterpolator[1],o=this.sizeInterpolator[1],s=this.heightInterpolator[1],r=this.familyInterpolator[1];return new O(t,e,i,n,o,s,r)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.styleInterpolator.equals(t.styleInterpolator)&&this.variantInterpolator.equals(t.variantInterpolator)&&this.weightInterpolator.equals(t.weightInterpolator)&&this.stretchInterpolator.equals(t.stretchInterpolator)&&this.sizeInterpolator.equals(t.sizeInterpolator)&&this.heightInterpolator.equals(t.heightInterpolator)&&this.familyInterpolator.equals(t.familyInterpolator))},i}(e.Interpolator);class E extends r.Form{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new E(t):this}mold(t){t=O.fromAny(t);const e=r.Record.create(7);if(void 0!==t.style&&e.slot("style",t.style),void 0!==t.variant&&e.slot("variant",t.variant),void 0!==t.weight&&e.slot("weight",t.weight),void 0!==t.stretch&&e.slot("stretch",t.stretch),t.size instanceof o.Length?e.slot("size",o.Length.form().mold(t.size)):void 0!==t.size&&e.slot("size",t.size),t.height instanceof o.Length?e.slot("height",o.Length.form().mold(t.height)):void 0!==t.height&&e.slot("height",t.height),Array.isArray(t.family)){const i=r.Record.create(t.family.length);for(let e=0;e<t.family.length;e+=1)i.push(t.family[e]);e.slot("family",i)}else e.slot("family",t.family);return r.Record.of(r.Attr.of("font",e))}cast(t){const e=t.toValue();let i=null;try{if(i=O.fromValue(e),null===i){const t=e.stringValue();void 0!==t&&(i=O.parse(t))}}catch(t){}return null!==i?i:void 0}}class N extends s.Parser{constructor(t,e,i,n,o,s,r,l,a,h,c){super(),this.style=t,this.variant=e,this.weight=i,this.stretch=n,this.size=o,this.height=s,this.family=r,this.identOutput=l,this.lengthParser=a,this.familyParser=h,this.step=c}feed(t){return N.parse(t,this.style,this.variant,this.weight,this.stretch,this.size,this.height,this.family,this.identOutput,this.lengthParser,this.familyParser,this.step)}static parse(t,e,i,n,r,l,a,h,c,d,u,p=1){let f=0;for(;;){if(1===p){for(;t.isCont()&&(f=t.head(),s.Unicode.isSpace(f));)t.step();if(t.isCont())p=s.Unicode.isAlpha(f)?2:34===f||39===f?11:4;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t))}if(2===p){for(c=c||s.Unicode.stringOutput();t.isCont()&&(f=t.head(),s.Unicode.isAlpha(f)||45===f);)t=t.step(),c.write(f);if(!t.isEmpty()){const o=c.bind();switch(c=void 0,o){case"italic":case"oblique":if(void 0!==e)return s.Parser.error(s.Diagnostic.message("reapeated font style: "+o,t));e=o,p=3;break;case"small-caps":if(void 0!==i)return s.Parser.error(s.Diagnostic.message("reapeated font variant: "+o,t));i=o,p=3;break;case"bold":case"bolder":case"lighter":if(void 0!==n)return s.Parser.error(s.Diagnostic.message("reapeated font weight: "+o,t));n=o,p=3;break;case"ultra-condensed":case"extra-condensed":case"semi-condensed":case"condensed":case"expanded":case"semi-expanded":case"extra-expanded":case"ultra-expanded":if(void 0!==r)return s.Parser.error(s.Diagnostic.message("reapeated font stretch: "+o,t));r=o,p=3;break;case"normal":if(void 0===e)e=o;else if(void 0===i)i=o;else if(void 0===n)n=o;else{if(void 0!==r)return s.Parser.error(s.Diagnostic.message("reapeated font property: "+o,t));r=o}p=3;break;case"large":case"larger":case"medium":case"small":case"smaller":case"x-large":case"x-small":case"xx-large":case"xx-small":l=o,p=5;break;default:h=o,p=12}}}if(3===p){if(t.isCont()){if(f=t.head(),s.Unicode.isSpace(f)){t.step(),p=1;continue}return s.Parser.error(s.Diagnostic.expected("font property, size, or family",t))}if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t))}if(4===p)if((d=void 0===d?o.LengthParser.parse(t):d.feed(t)).isDone()){const e=d.bind();if(""===e.units){const i=e.value;switch(i){case 100:case 200:case 300:case 400:case 500:case 600:case 700:case 800:case 900:if(void 0!==n)return s.Parser.error(s.Diagnostic.message("reapeated font weight: "+i,t));n=String(i);break;default:return s.Parser.error(s.Diagnostic.message("unknown font property: "+i,t))}p=3;continue}l=e,d=void 0,p=5}else if(d.isError())return d.asError();if(5===p)if(t.isCont())if(f=t.head(),s.Unicode.isSpace(f))t.step(),p=6;else{if(47!==f)return s.Parser.error(s.Diagnostic.expected("font family",t));t.step(),p=7}else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t));if(6===p){for(;t.isCont()&&(f=t.head(),s.Unicode.isSpace(f));)t.step();if(t.isCont())47===f?(t.step(),p=7):p=11;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t))}if(7===p){for(;t.isCont()&&(f=t.head(),s.Unicode.isSpace(f));)t.step();if(t.isCont())p=s.Unicode.isAlpha(f)?8:9;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t))}if(8===p){for(c=c||s.Unicode.stringOutput();t.isCont()&&(f=t.head(),s.Unicode.isAlpha(f));)t=t.step(),c.write(f);if(!t.isEmpty()){const e=c.bind();if(c=void 0,"normal"!==e)return s.Parser.error(s.Diagnostic.message("unknown line height: "+e,t));a=e,p=10}}if(9===p)if((d=void 0===d?o.LengthParser.parse(t):d.feed(t)).isDone())a=d.bind(),d=void 0,p=10;else if(d.isError())return d.asError();if(10===p)if(t.isCont()){if(f=t.head(),!s.Unicode.isSpace(f))return s.Parser.error(s.Diagnostic.expected("font family",t));t.step(),p=11}else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t));if(11===p)if((u=void 0===u?R.parse(t):u.feed(t)).isDone())Array.isArray(h)?h.push(u.bind()):h=void 0!==h?[h,u.bind()]:u.bind(),u=void 0,p=12;else if(u.isError())return u.asError();if(12===p){for(;t.isCont()&&(f=t.head(),s.Unicode.isSpace(f));)t.step();if(t.isCont()&&44===f){t.step(),p=11;continue}if(!t.isEmpty())return s.Parser.done(O.create(e,i,n,r,l,a,h))}break}return new N(e,i,n,r,l,a,h,c,d,u,p)}static parseRest(t,e,i,n,o,s,r,l){const a=void 0!==l?12:void 0!==s?5:3;return N.parse(t,e,i,n,o,s,r,l,void 0,void 0,void 0,a)}}class B{contrast(t){return this.lightness<.67?this.lighter(t):this.darker(t)}interpolateTo(t){return t instanceof B?j(this.rgb(),t.rgb()):null}static transparent(){return H.transparent()}static black(t){return H.black(t)}static white(t){return H.white(t)}static rgb(t,e,i,n){return new H(t,e,i,n)}static hsl(t,e,i,n){return"number"!=typeof t&&(t=o.Angle.fromAny(t).degValue()),new K(t,e,i,n)}static forName(t){switch(t){case"transparent":return B.transparent();case"black":return B.black();case"white":return B.white();default:return null}}static fromInit(t){if(H.isInit(t))return H.fromInit(t);if(K.isInit(t))return K.fromInit(t);throw new TypeError(""+t)}static fromAny(t){if(null==t||t instanceof B)return t;if("string"==typeof t)return B.parse(t);if(H.isInit(t))return H.fromInit(t);if(K.isInit(t))return K.fromInit(t);throw new TypeError(""+t)}static fromValue(t){let e;return e=H.fromValue(t),void 0===e&&(e=K.fromValue(t)),e}static parse(t){let e=s.Unicode.stringInput(t);for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();let i=z.parse(e);if(i.isDone())for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=s.Parser.error(s.Diagnostic.unexpected(e))),i.bind()}static isInit(t){return H.isInit(t)||K.isInit(t)}static isAny(t){return t instanceof B||B.isInit(t)||"string"==typeof t}static form(){return new U(B.transparent())}}B.Darker=.7,B.Brighter=1/B.Darker,u([e.Lazy],B,"form",null);class U extends r.Form{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new U(t):this}mold(t){return t=B.fromAny(t),r.Text.from(t.toString())}cast(t){const e=t.toValue();let i=null;try{if(i=B.fromValue(e),void 0===i){const t=e.stringValue(void 0);void 0!==t&&(i=B.parse(t))}}catch(t){}return null!==i?i:void 0}}class z extends s.Parser{constructor(t,e){super(),this.identOutput=t,this.step=e}feed(t){return z.parse(t,this.identOutput,this.step)}static parse(t,e,i=1){let n=0;if(1===i)if(t.isCont()){if(35===t.head())return Y.parse(t);i=2}else if(t.isDone())return s.Parser.error(s.Diagnostic.unexpected(t));if(2===i){for(e=e||s.Unicode.stringOutput();t.isCont()&&(n=t.head(),s.Unicode.isAlpha(n));)t=t.step(),e.write(n);if(!t.isEmpty()){const i=e.bind();switch(i){case"rgb":case"rgba":return X.parseRest(t);case"hsl":case"hsla":return _.parseRest(t);default:{const e=B.forName(i);return null!==e?s.Parser.done(e):s.Parser.error(s.Diagnostic.message("unknown color: "+i,t))}}}}return new z(e,i)}}class q{constructor(t,e){this.value=t,this.units=void 0!==e?e:""}scale(t){return"%"===this.units?this.value*t/100:this.value}}class G extends s.Parser{constructor(t,e){super(),this.valueParser=t,this.step=e}feed(t){return G.parse(t,this.valueParser,this.step)}static parse(t,e,i=1){if(1===i)if((e=void 0===e?s.Base10.parseNumber(t):e.feed(t)).isDone())i=2;else if(e.isError())return e.asError();if(2===i){if(t.isCont()&&37===t.head())return t=t.step(),s.Parser.done(new q(e.bind(),"%"));if(!t.isEmpty())return s.Parser.done(new q(e.bind()))}return new G(e,i)}}class H extends B{constructor(t,e,i,n=1){super(),this.r=t,this.g=e,this.b=i,this.a=n,this.stringValue=void 0}isDefined(){return isFinite(this.r)&&isFinite(this.g)&&isFinite(this.b)&&isFinite(this.a)}alpha(t){return void 0===t?this.a:this.a!==t?new H(this.r,this.g,this.b,t):this}get lightness(){const t=this.r/255,e=this.g/255,i=this.b/255,n=Math.min(t,e,i);return(Math.max(t,e,i)+n)/2}plus(t){return t=B.fromAny(t).rgb(),new H(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}times(t){return new H(this.r*t,this.g*t,this.b*t,this.a*t)}combine(t,e=1){return t=B.fromAny(t).rgb(),new H(this.r+t.r*e,this.g+t.g*e,this.b+t.b*e,this.a+t.a*e)}lighter(t){return 1!==(t=void 0===t?B.Brighter:Math.pow(B.Brighter,t))?new H(this.r*t,this.g*t,this.b*t,this.a):this}darker(t){return 1!==(t=void 0===t?B.Darker:Math.pow(B.Darker,t))?new H(this.r*t,this.g*t,this.b*t,this.a):this}rgb(){return this}hsl(){const t=this.r/255,e=this.g/255,i=this.b/255,n=Math.min(t,e,i),o=Math.max(t,e,i);let s=NaN,r=o-n;const l=(o+n)/2;return 0!==r?(s=t===o?(e-i)/r+6*+(e<i):e===o?(i-t)/r+2:(t-e)/r+4,r/=l<.5?o+n:2-(o+n),s*=60):r=l>0&&l<1?0:s,new K(s,r,l,this.a)}interpolateTo(t){return t instanceof H?j(this,t):super.interpolateTo(t)}equivalentTo(t,i){return this===t||t instanceof B&&(t=t.rgb(),e.Numbers.equivalent(this.r,t.r,i)&&e.Numbers.equivalent(this.g,t.g,i)&&e.Numbers.equivalent(this.b,t.b,i)&&e.Numbers.equivalent(this.a,t.a,i))}equals(t){return this===t||t instanceof H&&(this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a)}hashCode(){return e.Murmur3.mash(e.Murmur3.mix(e.Murmur3.mix(e.Murmur3.mix(e.Murmur3.mix(e.Constructors.hash(H),e.Numbers.hash(this.r)),e.Numbers.hash(this.g)),e.Numbers.hash(this.b)),e.Numbers.hash(this.a)))}debug(t){return t=t.write("Color").write(46).write("rgb").write(40).debug(this.r).write(", ").debug(this.g).write(", ").debug(this.b),1!==this.a&&(t=t.write(", ").debug(this.a)),t=t.write(41)}toHexString(){const t=Math.min(Math.max(0,Math.round(this.r||0)),255),e=Math.min(Math.max(0,Math.round(this.g||0)),255),i=Math.min(Math.max(0,Math.round(this.b||0)),255);let n="#";const o=s.Base16.lowercase.alphabet;return n+=o.charAt(t>>>4&15),n+=o.charAt(15&t),n+=o.charAt(e>>>4&15),n+=o.charAt(15&e),n+=o.charAt(i>>>4&15),n+=o.charAt(15&i),n}toRgbString(){let t=this.a;t=isNaN(t)?1:Math.max(0,Math.min(this.a,1));let e=1===t?"rgb":"rgba";return e+="(",e+=Math.max(0,Math.min(Math.round(this.r)||0,255)),e+=",",e+=Math.max(0,Math.min(Math.round(this.g)||0,255)),e+=",",e+=Math.max(0,Math.min(Math.round(this.b)||0,255)),1!==t&&(e+=",",e+=t),e+=")",e}toHslString(){return this.hsl().toHslString()}toString(){let t=this.stringValue;if(void 0===t){let e=this.a;e=isNaN(e)?1:Math.max(0,Math.min(this.a,1)),t=1===e?this.toHexString():this.toRgbString(),this.stringValue=t}return t}static transparent(){return new H(0,0,0,0)}static black(t=1){return new H(0,0,0,t)}static white(t=1){return new H(255,255,255,t)}static fromInit(t){return new H(t.r,t.g,t.b,t.a)}static fromAny(t){if(null==t||t instanceof H)return t;if("string"==typeof t)return H.parse(t);if(H.isInit(t))return H.fromInit(t);throw new TypeError(""+t)}static fromValue(t){const e=t.tag;let i,n,o,s,l;return"rgb"===e||"rgba"===e?(t=t.header(e),i=!0):i=!1,t.forEach((function(t,e){const a=t.key.stringValue();void 0!==a?"r"===a?n=t.toValue().numberValue(n):"g"===a?o=t.toValue().numberValue(o):"b"===a?s=t.toValue().numberValue(s):"a"===a&&(l=t.toValue().numberValue(l)):t instanceof r.Value&&i&&(0===e?n=t.numberValue(n):1===e?o=t.numberValue(o):2===e?s=t.numberValue(s):3===e&&(l=t.numberValue(l)))})),void 0!==n&&void 0!==o&&void 0!==s?new H(n,o,s,l):null}static parse(t){return B.parse(t).rgb()}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.r&&"number"==typeof e.g&&"number"==typeof e.b&&("number"==typeof e.a||void 0===e.a)}return!1}static isAny(t){return t instanceof H||H.isInit(t)||"string"==typeof t}}u([e.Lazy],H,"transparent",null);const j=function(t){const e=function(t,i){const n=function(t){const e=n[0],i=n[1],o=e.r+t*(i.r-e.r),s=e.g+t*(i.g-e.g),r=e.b+t*(i.b-e.b),l=e.a+t*(i.a-e.a);return new H(o,s,r,l)};return Object.setPrototypeOf(n,e.prototype),n[0]=t,n[1]=i,n};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(e.Interpolator);class Y extends s.Parser{constructor(t,e){super(),this.value=t,this.step=e}feed(t){return Y.parse(t,this.value,this.step)}static parse(t,e=0,i=1){let n=0;if(1===i)if(t.isCont()&&35===t.head())t=t.step(),i=2;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.expected("#",t));if(i>=2){for(;i<=9&&t.isCont()&&(n=t.head(),s.Base16.isDigit(n));)t=t.step(),e=e<<4|s.Base16.decodeDigit(n),i+=1;if(!t.isEmpty())return 5===i?s.Parser.done(new H(e>>8&15|e>>4&240,e>>4&15|240&e,e<<4&240|15&e)):6===i?s.Parser.done(new H(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,(e<<4&240|15&e)/255)):8===i?s.Parser.done(new H(e>>16&255,e>>8&255,255&e)):10===i?s.Parser.done(new H(e>>24&255,e>>16&255,e>>8&255,(255&e)/255)):s.Parser.error(s.Diagnostic.unexpected(t))}return new Y(e,i)}}class X extends s.Parser{constructor(t,e,i,n,o){super(),this.rParser=t,this.gParser=e,this.bParser=i,this.aParser=n,this.step=o}feed(t){return X.parse(t,this.rParser,this.gParser,this.bParser,this.aParser,this.step)}static parse(t,e,i,n,o,r){let l=0;if(1===r)if(t.isCont()&&114===t.head())t=t.step(),r=2;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.expected("r",t));if(2===r)if(t.isCont()&&103===t.head())t=t.step(),r=3;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.expected("g",t));if(3===r)if(t.isCont()&&98===t.head())t=t.step(),r=4;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.expected("b",t));if(4===r&&(t.isCont()&&97===t.head()?(t=t.step(),r=5):t.isEmpty()||(r=5)),5===r){for(;t.isCont()&&(l=t.head(),s.Unicode.isSpace(l));)t=t.step();if(t.isCont()&&40===l)t=t.step(),r=6;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.expected("(",t))}if(6===r){if(void 0===e){for(;t.isCont()&&s.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(e=G.parse(t))}else e=e.feed(t);if(void 0!==e)if(e.isDone())r=7;else if(e.isError())return e.asError()}if(7===r){for(;t.isCont()&&(l=t.head(),s.Unicode.isSpace(l));)t=t.step();if(t.isCont())44===l&&(t=t.step()),r=8;else if(t.isDone())return s.Parser.error(s.Diagnostic.unexpected(t))}if(8===r){if(void 0===i){for(;t.isCont()&&s.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(i=G.parse(t))}else i=i.feed(t);if(void 0!==i)if(i.isDone())r=9;else if(i.isError())return i.asError()}if(9===r){for(;t.isCont()&&(l=t.head(),s.Unicode.isSpace(l));)t=t.step();if(t.isCont())44===l&&(t=t.step()),r=10;else if(t.isDone())return s.Parser.error(s.Diagnostic.unexpected(t))}if(10===r){if(void 0===n){for(;t.isCont()&&s.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(n=G.parse(t))}else n=n.feed(t);if(void 0!==n)if(n.isDone())r=11;else if(n.isError())return n.asError()}if(11===r){for(;t.isCont()&&(l=t.head(),s.Unicode.isSpace(l));)t=t.step();if(t.isCont()){if(41===l)return t=t.step(),s.Parser.done(new H(e.bind().scale(255),i.bind().scale(255),n.bind().scale(255)));44!==l&&47!==l||(t=t.step()),r=12}else if(t.isDone())return s.Parser.error(s.Diagnostic.unexpected(t))}if(12===r){if(void 0===o){for(;t.isCont()&&s.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(o=G.parse(t))}else o=o.feed(t);if(void 0!==o)if(o.isDone())r=13;else if(o.isError())return o.asError()}if(13===r){for(;t.isCont()&&(l=t.head(),s.Unicode.isSpace(l));)t=t.step();if(t.isCont()&&41===l)return t=t.step(),s.Parser.done(new H(e.bind().scale(255),i.bind().scale(255),n.bind().scale(255),o.bind().scale(1)));if(!t.isEmpty())return s.Parser.error(s.Diagnostic.expected(")",t))}return new X(e,i,n,o,r)}static parseRest(t){return X.parse(t,void 0,void 0,void 0,void 0,5)}}class K extends B{constructor(t,e,i,n=1){super(),this.h=t,this.s=e,this.l=i,this.a=n,this.stringValue=void 0}isDefined(){return isFinite(this.h)&&isFinite(this.s)&&isFinite(this.l)&&isFinite(this.a)}alpha(t){return void 0===t?this.a:this.a!==t?new K(this.h,this.s,this.l,t):this}get lightness(){return this.l}plus(t){return t=B.fromAny(t).hsl(),new K(this.h+t.h,this.s+t.s,this.l+t.l,this.a+t.a)}times(t){return new K(this.h*t,this.s*t,this.l*t,this.a*t)}combine(t,e=1){return t=B.fromAny(t).hsl(),new K(this.h+t.h*e,this.s+t.s*e,this.l+t.l*e,this.a+t.a*e)}lighter(t){return 1!==(t=void 0===t?B.Brighter:Math.pow(B.Brighter,t))?new K(this.h,this.s,this.l*t,this.a):this}darker(t){return 1!==(t=void 0===t?B.Darker:Math.pow(B.Darker,t))?new K(this.h,this.s,this.l*t,this.a):this}static toRgb(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}rgb(){const t=this.h%360+360*+(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,o=2*i-n;return new H(K.toRgb(t>=240?t-240:t+120,o,n),K.toRgb(t,o,n),K.toRgb(t<120?t+240:t-120,o,n),this.a)}hsl(){return this}interpolateTo(t){return t instanceof K?Z(this,t):super.interpolateTo(t)}equivalentTo(t,i){return this===t||t instanceof B&&(t=t.hsl(),e.Numbers.equivalent(this.h,t.h,i)&&e.Numbers.equivalent(this.s,t.s,i)&&e.Numbers.equivalent(this.l,t.l,i)&&e.Numbers.equivalent(this.a,t.a,i))}equals(t){return this===t||t instanceof K&&(this.h===t.h&&this.s===t.s&&this.l===t.l&&this.a===t.a)}hashCode(){return e.Murmur3.mash(e.Murmur3.mix(e.Murmur3.mix(e.Murmur3.mix(e.Murmur3.mix(e.Constructors.hash(K),e.Numbers.hash(this.h)),e.Numbers.hash(this.s)),e.Numbers.hash(this.l)),e.Numbers.hash(this.a)))}debug(t){return t=t.write("Color").write(46).write("hsl").write(40).debug(this.h).write(", ").debug(this.s).write(", ").debug(this.l),1!==this.a&&(t=t.write(", ").debug(this.a)),t=t.write(41)}toHexString(){return this.rgb().toHexString()}toRgbString(){return this.rgb().toRgbString()}toHslString(){let t=this.a;t=isNaN(t)?1:Math.max(0,Math.min(this.a,1));let e=1===t?"hsl":"hsla";return e+="(",e+=Math.max(0,Math.min(Math.round(this.h)||0,360)),e+=",",e+=Math.max(0,Math.min(100*Math.round(this.s)||0,100))+"%",e+=",",e+=Math.max(0,Math.min(100*Math.round(this.l)||0,100))+"%",1!==t&&(e+=",",e+=t),e+=")",e}toString(){let t=this.stringValue;return void 0===t&&(t=this.toHslString(),this.stringValue=t),t}static transparent(){return new K(0,0,0,0)}static black(t=1){return new K(0,0,0,t)}static white(t=1){return new K(0,1,1,t)}static fromInit(t){const e="number"==typeof t.h?t.h:o.Angle.fromAny(t.h).degValue();return new K(e,t.s,t.l,t.a)}static fromAny(t){if(null==t||t instanceof K)return t;if("string"==typeof t)return K.parse(t);if(K.isInit(t))return K.fromInit(t);throw new TypeError(""+t)}static fromValue(t){const e=t.tag;let i,n,s,l,a;return"hsl"===e||"hsla"===e?(t=t.header(e),i=!0):i=!1,t.forEach((function(t,e){const h=t.key.stringValue();void 0!==h?"h"===h?n=t.toValue().cast(o.Angle.form(),n):"s"===h?s=t.toValue().numberValue(s):"l"===h?l=t.toValue().numberValue(l):"a"===h&&(a=t.toValue().numberValue(a)):t instanceof r.Value&&i&&(0===e?n=t.cast(o.Angle.form(),n):1===e?s=t.numberValue(s):2===e?l=t.numberValue(l):3===e&&(a=t.numberValue(a)))})),void 0!==n&&void 0!==s&&void 0!==l?new K(n.degValue(),s,l,a):null}static parse(t){return B.parse(t).hsl()}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return o.Angle.isAny(e.h)&&"number"==typeof e.s&&"number"==typeof e.l&&("number"==typeof e.a||void 0===e.a)}return!1}static isAny(t){return t instanceof K||K.isInit(t)||"string"==typeof t}}u([e.Lazy],K,"transparent",null);const Z=function(t){const e=function(t,i){const n=function(t){const e=n[0],i=n[1],o=e.h+t*(i.h-e.h),s=e.s+t*(i.s-e.s),r=e.l+t*(i.l-e.l),l=e.a+t*(i.a-e.a);return new K(o,s,r,l)};return Object.setPrototypeOf(n,e.prototype),n[0]=t,n[1]=i,n};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(e.Interpolator);class _ extends s.Parser{constructor(t,e,i,n,o){super(),this.hParser=t,this.sParser=e,this.lParser=i,this.aParser=n,this.step=o}feed(t){return _.parse(t,this.hParser,this.sParser,this.lParser,this.aParser,this.step)}static parse(t,e,i,n,r,l){let a=0;if(1===l)if(t.isCont()&&104===t.head())t=t.step(),l=2;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.expected("h",t));if(2===l)if(t.isCont()&&115===t.head())t=t.step(),l=3;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.expected("s",t));if(3===l)if(t.isCont()&&108===t.head())t=t.step(),l=4;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.expected("l",t));if(4===l&&(t.isCont()&&97===t.head()?(t=t.step(),l=5):t.isEmpty()||(l=5)),5===l){for(;t.isCont()&&(a=t.head(),s.Unicode.isSpace(a));)t=t.step();if(t.isCont()&&40===a)t=t.step(),l=6;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.expected("(",t))}if(6===l){if(void 0===e){for(;t.isCont()&&s.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(e=o.AngleParser.parse(t,"deg"))}else e=e.feed(t);if(void 0!==e)if(e.isDone())l=7;else if(e.isError())return e.asError()}if(7===l){for(;t.isCont()&&(a=t.head(),s.Unicode.isSpace(a));)t=t.step();if(t.isCont())44===a&&(t=t.step()),l=8;else if(t.isDone())return s.Parser.error(s.Diagnostic.unexpected(t))}if(8===l){if(void 0===i){for(;t.isCont()&&s.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(i=G.parse(t))}else i=i.feed(t);if(void 0!==i)if(i.isDone()){if("%"!==i.bind().units)return s.Parser.error(s.Diagnostic.expected("%",t));l=9}else if(i.isError())return i.asError()}if(9===l){for(;t.isCont()&&(a=t.head(),s.Unicode.isSpace(a));)t=t.step();if(t.isCont())44===a&&(t=t.step()),l=10;else if(t.isDone())return s.Parser.error(s.Diagnostic.unexpected(t))}if(10===l){if(void 0===n){for(;t.isCont()&&s.Unicode.isSpace(t.head());)t=t.step();t.isCont()&&(n=G.parse(t))}else n=n.feed(t);if(void 0!==n)if(n.isDone()){if("%"!==n.bind().units)return s.Parser.error(s.Diagnostic.expected("%",t));l=11}else if(n.isError())return n.asError()}if(11===l){for(;t.isCont()&&(a=t.head(),s.Unicode.isSpace(a));)t=t.step();if(t.isCont()){if(41===a)return t=t.step(),s.Parser.done(new K(e.bind().degValue(),i.bind().scale(1),n.bind().scale(1)));44!==a&&47!==a||(t=t.step()),l=12}else if(t.isDone())return s.Parser.error(s.Diagnostic.unexpected(t))}if(12===l){if(void 0===r){for(;t.isCont()&&s.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(r=G.parse(t))}else r=r.feed(t);if(void 0!==r)if(r.isDone())l=13;else if(r.isError())return r.asError()}if(13===l){for(;t.isCont()&&(a=t.head(),s.Unicode.isSpace(a));)t=t.step();if(t.isCont()&&41===a)return t=t.step(),s.Parser.done(new K(e.bind().degValue(),i.bind().scale(1),n.bind().scale(1),r.bind().scale(1)));if(!t.isEmpty())return s.Parser.error(s.Diagnostic.expected(")",t))}return new _(e,i,n,r,l)}static parseRest(t){return _.parse(t,void 0,void 0,void 0,void 0,5)}}class Q{constructor(t,e,i){this.color=t,this.stop=e,this.hint=i}withColor(t){return t=B.fromAny(t),new Q(t,this.stop,this.hint)}withStop(t){return null!==t&&(t=o.Length.fromAny(t,"%")),new Q(this.color,t,this.hint)}withHint(t){return null!==t&&(t=o.Length.fromAny(t,"%")),new Q(this.color,this.stop,t)}interpolateTo(t){return t instanceof Q?J(this,t):null}equivalentTo(t,i){return this===t||t instanceof Q&&(e.Equivalent(this.color,t.color,i)&&e.Equivalent(this.stop,t.stop,i)&&e.Equivalent(this.hint,t.hint,i))}equals(t){return this===t||t instanceof Q&&(this.color.equals(t.color)&&e.Equals(this.stop,t.stop)&&e.Equals(this.hint,t.hint))}toString(){let t="";return null!==this.hint&&(t+=this.hint.toString(),t+=", "),t+=this.color.toString(),null!==this.stop&&(t+=" ",t+=this.stop.toString()),t}static create(t,e=null,i=null){return t=B.fromAny(t),null!==e&&(e=o.Length.fromAny(e,"%")),null!==i&&(i=o.Length.fromAny(i,"%")),new Q(t,e,i)}static fromInit(t){const e=B.fromAny(t.color),i=void 0!==t.stop?o.Length.fromAny(t.stop,"%"):null,n=void 0!==t.hint?o.Length.fromAny(t.hint,"%"):null;return new Q(e,i,n)}static fromTuple(t){const e=B.fromAny(t[0]),i=null!==t[1]?o.Length.fromAny(t[1],"%"):null;return new Q(e,i,null)}static fromAny(t){if(null==t||t instanceof Q)return t;if("string"==typeof t)return Q.parse(t);if(Q.isInit(t))return Q.fromInit(t);if(Q.isTuple(t))return Q.fromTuple(t);throw new TypeError(""+t)}static parse(t){let e=s.Unicode.stringInput(t);for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();let i=$.parse(e);if(i.isDone())for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=s.Parser.error(s.Diagnostic.unexpected(e))),i.bind()}static parseHint(t){let e=s.Unicode.stringInput(t);for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();let i=$.parseHint(e);if(i.isDone())for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=s.Parser.error(s.Diagnostic.unexpected(e))),i.bind()}static parseList(t){let e=s.Unicode.stringInput(t);for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();let i=tt.parse(e);if(i.isDone())for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=s.Parser.error(s.Diagnostic.unexpected(e))),i.bind()}static isInit(t){if("object"==typeof t&&null!==t){return void 0!==t.color}return!1}static isTuple(t){return Array.isArray(t)&&2===t.length&&B.isAny(t[0])&&(null===t[1]||o.Length.isAny(t[1]))}static isAny(t){return t instanceof Q||Q.isInit(t)||Q.isTuple(t)||"string"==typeof t}}const J=function(t){const i=function(t,n){const o=function(t){const e=o.colorInterpolator(t),i=o.stopInterpolator(t),n=o.hintInterpolator(t);return new Q(e,i,n)};return Object.setPrototypeOf(o,i.prototype),o.colorInterpolator=t.color.interpolateTo(n.color),o.stopInterpolator=e.Interpolator(t.stop,n.stop),o.hintInterpolator=e.Interpolator(t.hint,n.hint),o};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.colorInterpolator[0],e=this.stopInterpolator[0],i=this.hintInterpolator[0];return new Q(t,e,i)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.colorInterpolator[1],e=this.stopInterpolator[1],i=this.hintInterpolator[1];return new Q(t,e,i)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.colorInterpolator.equals(t.colorInterpolator)&&this.stopInterpolator.equals(t.stopInterpolator)&&this.hintInterpolator.equals(t.hintInterpolator))},i}(e.Interpolator);class $ extends s.Parser{constructor(t,e,i,n){super(),this.colorParser=t,this.stopParser=e,this.hintParser=i,this.step=n}feed(t){return $.parse(t,this.colorParser,this.stopParser,this.hintParser,this.step)}static parse(t,e,i,n,r=4){let l=0;if(1===r){for(;t.isCont()&&(l=t.head(),s.Unicode.isSpace(l));)t.step();if(t.isCont())r=45===l||46===l||l>=48&&l<=57?2:7;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t))}if(2===r&&void 0!==(n=void 0===n?o.LengthParser.parse(t):n.feed(t)))if(n.isDone())r=3;else if(n.isError())return n.asError();if(3===r){for(;t.isCont()&&(l=t.head(),s.Unicode.isSpace(l));)t.step();if(t.isCont())44===l?(t.step(),r=4):(i=n,n=void 0,r=7);else if(t.isDone())return s.Parser.error(s.Diagnostic.unexpected(t))}if(4===r){for(;t.isCont()&&(l=t.head(),s.Unicode.isSpace(l));)t.step();if(t.isCont())r=45===l||46===l||l>=48&&l<=57?5:7;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t))}if(5===r&&void 0!==(i=void 0===i?o.LengthParser.parse(t):i.feed(t)))if(i.isDone())r=6;else if(i.isError())return i.asError();if(6===r)if(t.isCont()){if(!s.Unicode.isSpace(t.head()))return s.Parser.error(s.Diagnostic.expected("color",t));t.step(),r=7}else if(t.isDone())return s.Parser.error(s.Diagnostic.unexpected(t));if(7===r&&void 0!==(e=void 0===e?z.parse(t):e.feed(t)))if(e.isDone()){if(void 0!==i){const t=void 0!==n?n.bind():null;return s.Parser.done(new Q(e.bind(),i.bind(),t))}r=8}else if(e.isError())return e.asError();if(8===r)if(t.isCont()&&s.Unicode.isSpace(t.head()))t.step(),r=9;else if(!t.isEmpty()){const t=void 0!==n?n.bind():null;return s.Parser.done(new Q(e.bind(),null,t))}if(9===r&&void 0!==(i=void 0===i?o.LengthParser.parse(t):i.feed(t))){if(i.isDone()){const t=void 0!==n?n.bind():null;return s.Parser.done(new Q(e.bind(),i.bind(),t))}if(i.isError())return i.asError()}return new $(e,i,n,r)}static parseHint(t){return $.parse(t,void 0,void 0,void 0,1)}}class tt extends s.Parser{constructor(t,e,i){super(),this.stops=t,this.stopParser=e,this.step=i}feed(t){return tt.parse(t,void 0!==this.stops?this.stops.slice(0):void 0,this.stopParser,this.step)}static parse(t,e,i,n=1){let o=0;if(1===n){if(void 0===i){for(;t.isCont()&&(o=t.head(),s.Unicode.isSpace(o));)t.step();t.isEmpty()||(i=$.parse(t))}else i=i.feed(t);if(void 0!==i)if(i.isDone())void 0===e&&(e=[]),e.push(i.bind()),i=void 0,n=2;else if(i.isError())return i.asError()}for(;;){if(2===n){for(;t.isCont()&&(o=t.head(),s.Unicode.isSpace(o));)t=t.step();if(!t.isCont()||44!==o)return s.Parser.done(e);t=t.step(),n=3}if(3===n){if(void 0===i){for(;t.isCont()&&s.Unicode.isSpace(t.head());)t.step();t.isEmpty()||(i=$.parseHint(t))}else i=i.feed(t);if(void 0!==i){if(i.isDone()){e.push(i.bind()),i=void 0,n=2;continue}if(i.isError())return i.asError()}}break}return new tt(e,i,n)}}class et{constructor(t,e){this.angle=t,this.stops=e,this.stringValue=void 0}withAngle(t){return(t instanceof o.Angle||"number"==typeof t)&&(t=o.Angle.fromAny(t,"deg")),new et(t,this.stops)}withStops(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1)i[n]=Q.fromAny(t[n]);return new et(this.angle,i)}interpolateTo(t){return t instanceof et?it(this,t):null}equivalentTo(t,i){return this===t||t instanceof et&&(e.Values.equivalent(this.angle,t.angle,i)&&e.Arrays.equivalent(this.stops,t.stops,i))}equals(t){return this===t||t instanceof et&&(e.Values.equal(this.angle,t.angle)&&e.Arrays.equal(this.stops,t.stops))}toString(){let t=this.stringValue;if(void 0===t){if(t="linear-gradient(",this.angle instanceof o.Angle)t+=this.angle.toString();else if(t+="to","string"==typeof this.angle)t+=" ",t+=this.angle;else for(let e=0,i=this.angle.length;e<i;e+=1)t+=" ",t+=this.angle[e];for(let e=0,i=this.stops.length;e<i;e+=1)t+=", ",t+=this.stops[e].toString();t+=")",this.stringValue=t}return t}static create(t,...e){(t instanceof o.Angle||"number"==typeof t)&&(t=o.Angle.fromAny(t,"deg"));const i=e.length,n=new Array(i);for(let t=0;t<i;t+=1){const i=e[t];n[t]="string"==typeof i?0===t?Q.parse(i):Q.parseHint(i):Q.fromAny(e[t])}return new et(t,n)}static fromInit(t){let e=t.angle;(e instanceof o.Angle||"number"==typeof e)&&(e=o.Angle.fromAny(e,"deg"));const i=t.stops.length,n=new Array(i);for(let e=0;e<i;e+=1)n[e]=Q.fromAny(t.stops[e]);return new et(e,n)}static fromAny(t){if(null==t||t instanceof et)return t;if("string"==typeof t)return et.parse(t);if("object"==typeof t&&null!==t)return et.fromInit(t);throw new TypeError(""+t)}static parse(t){let e=s.Unicode.stringInput(t);for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();let i=ot.parse(e);if(i.isDone())for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=s.Parser.error(s.Diagnostic.unexpected(e))),i.bind()}static parseAngle(t){let e=s.Unicode.stringInput(t);for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();let i=nt.parse(e);if(i.isDone())for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=s.Parser.error(s.Diagnostic.unexpected(e))),i.bind()}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return void 0!==e.angle&&void 0!==e.stops}return!1}static isAny(t){return t instanceof et||et.isInit(t)||"string"==typeof t}}const it=function(t){const i=function(t,n){const o=function(t){const e=o.angleInterpolator(t),i=o.stopInterpolators,n=i.length,s=new Array(n);for(let e=0;e<n;e+=1)s[e]=i[e](t);return new et(e,s)};Object.setPrototypeOf(o,i.prototype),o.angleInterpolator=e.Interpolator(t.angle,n.angle);const s=t.stops,r=n.stops,l=Math.min(s.length,r.length),a=new Array(l);for(let t=0;t<l;t+=1)a[t]=s[t].interpolateTo(r[t]);return o.stopInterpolators=a,o};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.angleInterpolator[0],e=this.stopInterpolators,i=e.length,n=new Array(i);for(let t=0;t<i;t+=1)n[t]=e[t][0];return new et(t,n)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.angleInterpolator[1],e=this.stopInterpolators,i=e.length,n=new Array(i);for(let t=0;t<i;t+=1)n[t]=e[t][1];return new et(t,n)},configurable:!0}),i.prototype.equals=function(t){if(this===t)return!0;if(t instanceof i&&this.angleInterpolator.equals(t.angleInterpolator)){const e=this.stopInterpolators.length;if(e===t.stopInterpolators.length){for(let i=0;i<e;i+=1)if(!this.stopInterpolators[i].equals(t.stopInterpolators[i]))return!1;return!0}}return!1},i}(e.Interpolator);class nt extends s.Parser{constructor(t,e,i,n){super(),this.identOutput=t,this.angleParser=e,this.side=i,this.step=n}feed(t){return nt.parse(t,this.identOutput,this.angleParser,this.side,this.step)}static parse(t,e,i,n,r=1){let l=0;if(1===r){for(;t.isCont()&&(l=t.head(),s.Unicode.isSpace(l));)t.step();if(t.isCont())r=45===l||46===l||l>=48&&l<=57?2:3;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t))}if(2===r&&void 0!==(i=void 0===i?o.AngleParser.parse(t,"deg"):i.feed(t))){if(i.isDone())return i;if(i.isError())return i.asError()}if(3===r){for(void 0===e&&(e=s.Unicode.stringOutput());t.isCont()&&(l=t.head(),s.Unicode.isAlpha(l));)t=t.step(),e.write(l);if(!t.isEmpty()){const i=e.bind();if("to"!==i)return s.Parser.error(s.Diagnostic.message("unexpected "+i,t));e=void 0,r=4}}if(4===r)if(t.isCont()){if(!s.Unicode.isSpace(t.head()))return s.Parser.error(s.Diagnostic.expected("side or corner",t));t.step(),r=5}else if(t.isDone())return s.Parser.error(s.Diagnostic.unexpected(t));if(5===r){for(void 0===e&&(e=s.Unicode.stringOutput());t.isCont()&&(l=t.head(),s.Unicode.isAlpha(l));)t=t.step(),e.write(l);if(!t.isEmpty()){const i=e.bind();switch(e=void 0,i){case"left":case"right":n=i,r=6;break;case"top":case"bottom":n=i,r=7;break;default:return s.Parser.error(s.Diagnostic.message("unknown side: "+i,t))}}}if(6===r){if(void 0===e){for(;t.isCont()&&(l=t.head(),s.Unicode.isSpace(l));)t=t.step();if(t.isCont()&&s.Unicode.isAlpha(l))e=s.Unicode.stringOutput();else if(!t.isEmpty())return s.Parser.done(n)}if(void 0!==e){for(;t.isCont()&&(l=t.head(),s.Unicode.isAlpha(l));)t=t.step(),e.write(l);if(!t.isEmpty()){const i=e.bind();switch(e=void 0,i){case"top":case"bottom":return s.Parser.done([n,i]);default:return s.Parser.error(s.Diagnostic.message("unknown side: "+i,t))}}}}if(7===r){if(void 0===e){for(;t.isCont()&&(l=t.head(),s.Unicode.isSpace(l));)t=t.step();if(t.isCont()&&s.Unicode.isAlpha(l))e=s.Unicode.stringOutput();else if(!t.isEmpty())return s.Parser.done(n)}if(void 0!==e){for(;t.isCont()&&(l=t.head(),s.Unicode.isAlpha(l));)t=t.step(),e.write(l);if(!t.isEmpty()){const i=e.bind();switch(e=void 0,i){case"left":case"right":return s.Parser.done([n,i]);default:return s.Parser.error(s.Diagnostic.message("unknown side: "+i,t))}}}}return new nt(e,i,n,r)}}class ot extends s.Parser{constructor(t,e,i,n){super(),this.identOutput=t,this.angleParser=e,this.stopsParser=i,this.step=n}feed(t){return ot.parse(t,this.identOutput,this.angleParser,this.stopsParser,this.step)}static parse(t,e,i,n,o=1){let r=0;if(1===o){for(void 0===e&&(e=s.Unicode.stringOutput());t.isCont()&&(r=t.head(),s.Unicode.isAlpha(r)||45===r);)t=t.step(),e.write(r);if(!t.isEmpty()){const i=e.bind();if("linear-gradient"!==i)return s.Parser.error(s.Diagnostic.message("unexpected "+i,t));e=void 0,o=2}}if(2===o){for(;t.isCont()&&(r=t.head(),s.Unicode.isSpace(r));)t=t.step();if(t.isCont()&&40===r)t.step(),o=3;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.expected("(",t))}if(3===o&&void 0!==(i=void 0===i?nt.parse(t):i.feed(t)))if(i.isDone())o=4;else if(i.isError())return i.asError();if(4===o){for(;t.isCont()&&(r=t.head(),s.Unicode.isSpace(r));)t=t.step();if(!t.isCont()||44!==r)return s.Parser.error(s.Diagnostic.expected("color stops",t));t=t.step(),o=5}if(5===o&&void 0!==(n=void 0===n?tt.parse(t):n.feed(t)))if(n.isDone())o=6;else if(n.isError())return n.asError();if(6===o){for(;t.isCont()&&s.Unicode.isSpace(t.head());)t.step();if(t.isCont()&&41===t.head())return t.step(),s.Parser.done(new et(i.bind(),n.bind()));if(!t.isEmpty())return s.Parser.error(s.Diagnostic.expected(")",t))}return new ot(e,i,n,o)}static parseRest(t,e){return ot.parse(t,e,void 0,void 0,2)}}class st{constructor(t,e,i,n,o,s,r){this.inset=t,this.offsetX=e,this.offsetY=i,this.blurRadius=n,this.spreadRadius=o,this.color=s,this.next=r,this.stringValue=void 0}withInset(t){return t===this.inset?this:new st(t,this.offsetX,this.offsetY,this.blurRadius,this.spreadRadius,this.color,this.next)}withOffsetX(t){return(t=o.Length.fromAny(t)).equals(this.offsetX)?this:new st(this.inset,t,this.offsetY,this.blurRadius,this.spreadRadius,this.color,this.next)}withOffsetY(t){return(t=o.Length.fromAny(t)).equals(this.offsetY)?this:new st(this.inset,this.offsetX,t,this.blurRadius,this.spreadRadius,this.color,this.next)}withBlurRadius(t){return(t=o.Length.fromAny(t)).equals(this.blurRadius)?this:new st(this.inset,this.offsetX,this.offsetY,t,this.spreadRadius,this.color,this.next)}withSpreadRadius(t){return(t=o.Length.fromAny(t)).equals(this.spreadRadius)?this:new st(this.inset,this.offsetX,this.offsetY,this.blurRadius,t,this.color,this.next)}withColor(t){return(t=B.fromAny(t)).equals(this.color)?this:new st(this.inset,this.offsetX,this.offsetY,this.blurRadius,this.spreadRadius,t,this.next)}and(t,e,i,n,o,s){let r;return r=null!==this.next?this.next.and.apply(this.next,arguments):st.create.apply(st,arguments),new st(this.inset,this.offsetX,this.offsetY,this.blurRadius,this.spreadRadius,this.color,r)}interpolateTo(t){return t instanceof st?rt(this,t):null}equivalentTo(t,i){return this===t||t instanceof st&&(this.inset===t.inset&&this.offsetX.equivalentTo(t.offsetX,i)&&this.offsetY.equivalentTo(t.offsetY,i)&&this.blurRadius.equivalentTo(t.blurRadius,i)&&this.spreadRadius.equivalentTo(t.spreadRadius,i)&&this.color.equivalentTo(t.color,i)&&e.Equivalent(this.next,t.next,i))}equals(t){return this===t||t instanceof st&&(this.inset===t.inset&&this.offsetX.equals(t.offsetX)&&this.offsetY.equals(t.offsetY)&&this.blurRadius.equals(t.blurRadius)&&this.spreadRadius.equals(t.spreadRadius)&&this.color.equals(t.color)&&e.Equals(this.next,t.next))}toString(){let t=this.stringValue;return void 0===t&&(t="",this.inset&&(t+="inset",t+=" "),t+=this.offsetX.toString(),t+=" ",t+=this.offsetY.toString(),t+=" ",t+=this.blurRadius.toString(),t+=" ",t+=this.spreadRadius.toString(),t+=" ",t+=this.color.toString(),null!==this.next&&(t+=", ",t+=this.next.toString()),this.stringValue=t),t}static create(t,e,i,n,s,r){if(1===arguments.length)return st.fromAny(t);if("boolean"!=typeof t){if(3===arguments.length)r=B.fromAny(i),s=o.Length.zero(),n=o.Length.zero(),i=o.Length.fromAny(e),e=o.Length.fromAny(t);else if(4===arguments.length)r=B.fromAny(n),s=o.Length.zero(),n=o.Length.fromAny(i),i=o.Length.fromAny(e),e=o.Length.fromAny(t);else{if(5!==arguments.length)throw new Error(t+", "+e+", "+i+", "+n+", "+s+", "+r);r=B.fromAny(s),s=o.Length.fromAny(n),n=o.Length.fromAny(i),i=o.Length.fromAny(e),e=o.Length.fromAny(t)}t=!1}else if(4===arguments.length)r=B.fromAny(n),s=o.Length.zero(),n=o.Length.zero(),i=o.Length.fromAny(i),e=o.Length.fromAny(e);else if(5===arguments.length)r=B.fromAny(s),s=o.Length.zero(),n=o.Length.fromAny(n),i=o.Length.fromAny(i),e=o.Length.fromAny(e);else{if(6!==arguments.length)throw new Error(t+", "+e+", "+i+", "+n+", "+s+", "+r);r=B.fromAny(r),s=o.Length.fromAny(s),n=o.Length.fromAny(n),i=o.Length.fromAny(i),e=o.Length.fromAny(e)}return new st(t,e,i,n,s,r,null)}static fromInit(t){const e=t.inset||!1,i=void 0!==t.offsetX?o.Length.fromAny(t.offsetX):o.Length.zero(),n=void 0!==t.offsetY?o.Length.fromAny(t.offsetY):o.Length.zero(),s=void 0!==t.blurRadius?o.Length.fromAny(t.blurRadius):o.Length.zero(),r=void 0!==t.spreadRadius?o.Length.fromAny(t.spreadRadius):o.Length.zero(),l=void 0!==t.color?B.fromAny(t.color):B.black();return new st(e,i,n,s,r,l,null)}static fromArray(t){let e=st.fromAny(t[0]);for(let i=1;i<t.length;i+=1)e=e.and(t[i]);return e}static fromAny(...t){let e;if(0===arguments.length)return null;if(e=1===arguments.length?t[0]:t,null==e||e instanceof st)return e;if("string"==typeof e)return st.parse(e);if("object"==typeof e&&null!==e&&void 0===e.length)return st.fromInit(e);if("object"==typeof e&&null!==e&&e.length>0)return st.fromArray(e);throw new TypeError(""+e)}static fromValue(t){let e=null;return t.forEach((function(t,i){const n=t.header("boxShadow");if(n.isDefined()){let t,i,s,l,a,h;n.forEach((function(e,n){const c=e.key.stringValue();void 0!==c?"inset"===c?t=e.toValue().booleanValue(t):"offsetX"===c?i=e.toValue().cast(o.Length.form(),i):"offsetY"===c?s=e.toValue().cast(o.Length.form(),s):"blurRadius"===c?l=e.toValue().cast(o.Length.form(),l):"spreadRadius"===c?a=e.toValue().cast(o.Length.form(),a):"color"===c&&(h=e.toValue().cast(B.form(),h)):e instanceof r.Value&&(0===n&&e instanceof r.Text&&"inset"===e.value?t=!0:0===n||1===n&&void 0!==t?i=e.cast(o.Length.form(),i):1===n||2===n&&void 0!==t?s=e.cast(o.Length.form(),s):2===n||3===n&&void 0!==t?(l=e.cast(o.Length.form(),l),void 0===l&&(h=e.cast(B.form(),h))):(3===n||4===n&&void 0===t)&&void 0===h?(a=e.cast(o.Length.form(),a),void 0===a&&(h=e.cast(B.form(),h))):(4===n||5===n&&void 0===t)&&void 0===h&&(h=e.cast(B.form(),h)))})),t=void 0!==t&&t,i=void 0!==i?i:o.Length.zero(),s=void 0!==s?s:o.Length.zero(),l=void 0!==l?l:o.Length.zero(),a=void 0!==a?a:o.Length.zero(),h=void 0!==h?h:B.black();const c=new st(t||!1,i,s,l,a,h,null);e=null!==e?e.and(c):c}})),e}static parse(t){let e=s.Unicode.stringInput(t);for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();let i=at.parse(e);if(i.isDone())for(;e.isCont()&&s.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=s.Parser.error(s.Diagnostic.unexpected(e))),i.bind()}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return void 0!==e.offsetX&&void 0!==e.offsetY&&void 0!==e.color}return!1}static isArray(t){if(Array.isArray(t)){const e=t.length;if(0!==e){for(let i=0;i<e;i+=1)if(!st.isAny(t))return!1;return!0}}return!1}static isAny(t){return t instanceof st||st.isArray(t)||st.isInit(t)||"string"==typeof t}static form(){return new lt(null)}}u([e.Lazy],st,"form",null);const rt=function(t){const i=function(t,n){const o=function(t){const e=o.insetInterpolator(t),i=o.offsetXInterpolator(t),n=o.offsetYInterpolator(t),s=o.blurRadiusInterpolator(t),r=o.spreadRadiusInterpolator(t),l=o.colorInterpolator(t),a=o.nextInterpolator(t);return new st(e,i,n,s,r,l,a)};return Object.setPrototypeOf(o,i.prototype),o.insetInterpolator=e.Interpolator(t.inset,n.inset),o.offsetXInterpolator=t.offsetX.interpolateTo(n.offsetX),o.offsetYInterpolator=t.offsetY.interpolateTo(n.offsetY),o.blurRadiusInterpolator=t.blurRadius.interpolateTo(n.blurRadius),o.spreadRadiusInterpolator=t.spreadRadius.interpolateTo(n.spreadRadius),o.colorInterpolator=t.color.interpolateTo(n.color),o.nextInterpolator=e.Interpolator(t.next,n.next),o};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.insetInterpolator[0],e=this.offsetXInterpolator[0],i=this.offsetYInterpolator[0],n=this.blurRadiusInterpolator[0],o=this.spreadRadiusInterpolator[0],s=this.colorInterpolator[0],r=this.nextInterpolator[0];return new st(t,e,i,n,o,s,r)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.insetInterpolator[1],e=this.offsetXInterpolator[1],i=this.offsetYInterpolator[1],n=this.blurRadiusInterpolator[1],o=this.spreadRadiusInterpolator[1],s=this.colorInterpolator[1],r=this.nextInterpolator[1];return new st(t,e,i,n,o,s,r)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.insetInterpolator.equals(t.insetInterpolator)&&this.offsetXInterpolator.equals(t.offsetXInterpolator)&&this.offsetYInterpolator.equals(t.offsetYInterpolator)&&this.blurRadiusInterpolator.equals(t.blurRadiusInterpolator)&&this.spreadRadiusInterpolator.equals(t.spreadRadiusInterpolator)&&this.colorInterpolator.equals(t.colorInterpolator)&&this.nextInterpolator.equals(t.nextInterpolator))},i}(e.Interpolator);class lt extends r.Form{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new lt(t):this}mold(t){let e=st.fromAny(t);const i=r.Record.create();for(;;){const t=r.Record.create(5);if(e.inset&&t.push("inset"),t.push(o.Length.form().mold(e.offsetX)),t.push(o.Length.form().mold(e.offsetY)),t.push(o.Length.form().mold(e.blurRadius)),t.push(o.Length.form().mold(e.spreadRadius)),t.push(B.form().mold(e.color)),i.attr("boxShadow",t),null===e.next)break;e=e.next}return i}cast(t){const e=t.toValue();let i;try{if(i=st.fromValue(e),void 0===i){const t=e.stringValue();void 0!==t&&(i=st.parse(t))}}catch(t){}return i}}class at extends s.Parser{constructor(t,e,i,n,o,s,r,l){super(),this.boxShadow=t,this.identOutput=e,this.offsetXParser=i,this.offsetYParser=n,this.blurRadiusParser=o,this.spreadRadiusParser=s,this.colorParser=r,this.step=l}feed(t){return at.parse(t,this.boxShadow,this.identOutput,this.offsetXParser,this.offsetYParser,this.blurRadiusParser,this.spreadRadiusParser,this.colorParser,this.step)}static parse(t,e,i,n,r,l,a,h,c=1){let d=0;for(;;){if(1===c){for(;t.isCont()&&(d=t.head(),s.Unicode.isSpace(d));)t.step();if(t.isCont())c=s.Unicode.isAlpha(d)?2:4;else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t))}if(2===c){for(i=i||s.Unicode.stringOutput();t.isCont()&&(d=t.head(),s.Unicode.isAlpha(d));)t=t.step(),i.write(d);if(!t.isEmpty()){const e=i.bind();switch(e){case"inset":c=3;break;case"none":return s.Parser.done(null);default:return s.Parser.error(s.Diagnostic.message("unknown box-shadow: "+e,t))}}}if(3===c)if(t.isCont()){if(!s.Unicode.isSpace(t.head()))return s.Parser.error(s.Diagnostic.expected("space",t));t.step(),c=4}else if(t.isDone())return s.Parser.error(s.Diagnostic.unexpected(t));if(4===c){if(void 0===n){for(;t.isCont()&&s.Unicode.isSpace(t.head());)t.step();t.isEmpty()||(n=o.LengthParser.parse(t))}else n=n.feed(t);if(void 0!==n)if(n.isDone())c=5;else if(n.isError())return n.asError()}if(5===c)if(t.isCont()){if(!s.Unicode.isSpace(t.head()))return s.Parser.error(s.Diagnostic.expected("space",t));t.step(),c=6}else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t));if(6===c){if(void 0===r){for(;t.isCont()&&s.Unicode.isSpace(t.head());)t.step();t.isEmpty()||(r=o.LengthParser.parse(t))}else r=r.feed(t);if(void 0!==r)if(r.isDone())c=7;else if(r.isError())return r.asError()}if(7===c)if(t.isCont()){if(!s.Unicode.isSpace(t.head()))return s.Parser.error(s.Diagnostic.expected("space",t));t.step(),c=8}else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t));if(8===c){if(void 0===l){for(;t.isCont()&&(d=t.head(),s.Unicode.isSpace(d));)t.step();t.isCont()&&(45===d||d>=48&&d<=57)?l=o.LengthParser.parse(t):t.isEmpty()||(c=12)}else l=l.feed(t);if(void 0!==l)if(l.isDone())c=9;else if(l.isError())return l.asError()}if(9===c)if(t.isCont()){if(!s.Unicode.isSpace(t.head()))return s.Parser.error(s.Diagnostic.expected("space",t));t.step(),c=10}else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t));if(10===c){if(void 0===a){for(;t.isCont()&&(d=t.head(),s.Unicode.isSpace(d));)t.step();t.isCont()&&(45===d||d>=48&&d<=57)?a=o.LengthParser.parse(t):t.isEmpty()||(c=12)}else a=a.feed(t);if(void 0!==a)if(a.isDone())c=11;else if(a.isError())return a.asError()}if(11===c)if(t.isCont()){if(!s.Unicode.isSpace(t.head()))return s.Parser.error(s.Diagnostic.expected("space",t));t.step(),c=12}else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t));if(12===c){if(void 0===h){for(;t.isCont()&&s.Unicode.isSpace(t.head());)t.step();t.isEmpty()||(h=z.parse(t))}else h=h.feed(t);if(void 0!==h)if(h.isDone()){const t=void 0!==i&&"inset"===i.bind(),s=n.bind(),d=r.bind(),u=void 0!==l?l.bind():o.Length.zero(),p=void 0!==a?a.bind():o.Length.zero(),f=h.bind(),g=new st(t,s,d,u,p,f,null);e=void 0===e?g:e.and(g),i=void 0,n=void 0,r=void 0,l=void 0,a=void 0,h=void 0,c=13}else if(h.isError())return h.asError()}if(13===c){for(;t.isCont()&&(d=t.head(),s.Unicode.isSpace(d));)t.step();if(t.isCont()&&44===d){t.step(),c=1;continue}if(!t.isEmpty())return s.Parser.done(e)}break}return new at(e,i,n,r,l,a,h,c)}}const ht=function(t){const e=function(t,i){const n=function(t){const e=n[0],i=n[1],o=e.phase+t*(i.phase-e.phase),s=1!==t?e.direction:0;return ct.create(o,s)};return Object.setPrototypeOf(n,e.prototype),n[0]=t,n[1]=i,n};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(e.Interpolator);class ct{constructor(t,e){this.phase=t,this.direction=e}withPhase(t){return t!==this.phase?ct.create(t,this.direction):this}withDirection(t){return t!==this.direction?ct.create(this.phase,t):this}get unfocused(){return 0===this.phase&&0===this.direction}get focused(){return 1===this.phase&&0===this.direction}get focusing(){return this.direction>0}get unfocusing(){return this.direction<0}asFocusing(){return this.focusing?this:ct.focusing(this.phase)}asUnfocusing(){return this.unfocusing?this:ct.unfocusing(this.phase)}asToggling(){return this.direction>0||this.phase>=.5?ct.unfocusing(this.phase):this.direction<0||this.phase<.5?ct.focusing(this.phase):this}asToggled(){return this.direction>0||this.phase>=.5?ct.unfocused():this.direction<0||this.phase<.5?ct.focused():this}interpolateTo(t){return t instanceof ct?ht(this,t):null}equivalentTo(t,i){return this===t||t instanceof ct&&(e.Numbers.equivalent(this.phase,t.phase,i)&&e.Numbers.equivalent(this.direction,t.direction,i))}equals(t){return this===t||t instanceof ct&&(this.phase===t.phase&&this.direction===t.direction)}hashCode(){return e.Murmur3.mash(e.Murmur3.mix(e.Murmur3.mix(e.Constructors.hash(ct),e.Numbers.hash(this.phase)),e.Numbers.hash(this.direction)))}debug(t){return t=t.write("Focus").write(46),0===this.phase&&0===this.direction?t=t.write("unfocused").write(40):1===this.phase&&0===this.direction?t=t.write("focused").write(40):1===this.direction?(t=t.write("focusing").write(40),0!==this.phase&&(t=t.debug(this.phase))):-1===this.direction?(t=t.write("unfocusing").write(40),1!==this.phase&&(t=t.debug(this.phase))):(t=t.write("create").write(40).debug(this.phase),0!==this.direction&&(t=t.write(", ").debug(this.direction))),t=t.write(41)}toString(){return s.Format.debug(this)}static unfocused(){return new ct(0,0)}static focused(){return new ct(1,0)}static focusing(t){return void 0===t&&(t=0),new ct(t,1)}static unfocusing(t){return void 0===t&&(t=1),new ct(t,-1)}static create(t,e){return void 0===e&&(e=0),0===t&&0===e?ct.unfocused():1===t&&0===e?ct.focused():new ct(t,e)}static fromInit(t){return new ct(t.phase,t.direction)}static fromAny(t){if(null==t||t instanceof ct)return t;if(ct.isInit(t))return ct.fromInit(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.phase&&"number"==typeof e.direction}return!1}static isAny(t){return t instanceof ct||ct.isInit(t)}}u([e.Lazy],ct,"unfocused",null),u([e.Lazy],ct,"focused",null);const dt=function(t){const e=function(t,i){const n=function(t){const e=n[0],i=n[1],o=e.phase+t*(i.phase-e.phase),s=1!==t?e.direction:0;return ut.create(o,s)};return Object.setPrototypeOf(n,e.prototype),n[0]=t,n[1]=i,n};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(e.Interpolator);class ut{constructor(t,e){this.phase=t,this.direction=e}withPhase(t){return t!==this.phase?ut.create(t,this.direction):this}withDirection(t){return t!==this.direction?ut.create(this.phase,t):this}get modalState(){return 0===this.phase&&0===this.direction?"hidden":1===this.phase&&0===this.direction?"shown":this.direction>0?"showing":this.direction<0?"hiding":void 0}get dismissed(){return 0===this.phase&&0===this.direction}get presented(){return 1===this.phase&&0===this.direction}get presenting(){return this.direction>0}get dismissing(){return this.direction<0}asPresenting(){return this.presenting?this:ut.presenting(this.phase)}asDismissing(){return this.dismissing?this:ut.dismissing(this.phase)}asToggling(){return this.direction>0||this.phase>=.5?ut.dismissing(this.phase):this.direction<0||this.phase<.5?ut.presenting(this.phase):this}asToggled(){return this.direction>0||this.phase>=.5?ut.dismissed():this.direction<0||this.phase<.5?ut.presented():this}interpolateTo(t){return t instanceof ut?dt(this,t):null}equivalentTo(t,i){return this===t||t instanceof ut&&(e.Numbers.equivalent(this.phase,t.phase,i)&&e.Numbers.equivalent(this.direction,t.direction,i))}equals(t){return this===t||t instanceof ut&&(this.phase===t.phase&&this.direction===t.direction)}hashCode(){return e.Murmur3.mash(e.Murmur3.mix(e.Murmur3.mix(e.Constructors.hash(ut),e.Numbers.hash(this.phase)),e.Numbers.hash(this.direction)))}debug(t){return t=t.write("Presence").write(46),0===this.phase&&0===this.direction?t=t.write("dismissed").write(40):1===this.phase&&0===this.direction?t=t.write("presented").write(40):1===this.direction?(t=t.write("presenting").write(40),0!==this.phase&&(t=t.debug(this.phase))):-1===this.direction?(t=t.write("dismissing").write(40),1!==this.phase&&(t=t.debug(this.phase))):(t=t.write("create").write(40).debug(this.phase),0!==this.direction&&(t=t.write(", ").debug(this.direction))),t=t.write(41)}toString(){return s.Format.debug(this)}static dismissed(){return new ut(0,0)}static presented(){return new ut(1,0)}static presenting(t){return void 0===t&&(t=0),new ut(t,1)}static dismissing(t){return void 0===t&&(t=1),new ut(t,-1)}static create(t,e){return void 0===e&&(e=0),0===t&&0===e?ut.dismissed():1===t&&0===e?ut.presented():new ut(t,e)}static fromInit(t){return new ut(t.phase,t.direction)}static fromAny(t){if(null==t||t instanceof ut)return t;if(ut.isInit(t))return ut.fromInit(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.phase&&"number"==typeof e.direction}return!1}static isAny(t){return t instanceof ut||ut.isInit(t)}}u([e.Lazy],ut,"dismissed",null),u([e.Lazy],ut,"presented",null);const pt=function(t){const e=function(t,i){const n=function(t){const e=n[0],i=n[1],o=e.phase+t*(i.phase-e.phase),s=1!==t?e.direction:0;return ft.create(o,s)};return Object.setPrototypeOf(n,e.prototype),n[0]=t,n[1]=i,n};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(e.Interpolator);class ft{constructor(t,e){this.phase=t,this.direction=e}withPhase(t){return t!==this.phase?ft.create(t,this.direction):this}withDirection(t){return t!==this.direction?ft.create(this.phase,t):this}get modalState(){return 0===this.phase&&0===this.direction?"hidden":1===this.phase&&0===this.direction?"shown":this.direction>0?"showing":this.direction<0?"hiding":void 0}get collapsed(){return 0===this.phase&&0===this.direction}get expanded(){return 1===this.phase&&0===this.direction}get expanding(){return this.direction>0}get collapsing(){return this.direction<0}asExpanding(){return this.expanding?this:ft.expanding(this.phase)}asCollapsing(){return this.collapsing?this:ft.collapsing(this.phase)}asToggling(){return this.direction>0||this.phase>=.5?ft.collapsing(this.phase):this.direction<0||this.phase<.5?ft.expanding(this.phase):this}asToggled(){return this.direction>0||this.phase>=.5?ft.collapsed():this.direction<0||this.phase<.5?ft.expanded():this}interpolateTo(t){return t instanceof ft?pt(this,t):null}equivalentTo(t,i){return this===t||t instanceof ft&&(e.Numbers.equivalent(this.phase,t.phase,i)&&e.Numbers.equivalent(this.direction,t.direction,i))}equals(t){return this===t||t instanceof ft&&(this.phase===t.phase&&this.direction===t.direction)}hashCode(){return e.Murmur3.mash(e.Murmur3.mix(e.Murmur3.mix(e.Constructors.hash(ft),e.Numbers.hash(this.phase)),e.Numbers.hash(this.direction)))}debug(t){return t=t.write("Expansion").write(46),0===this.phase&&0===this.direction?t=t.write("collapsed").write(40):1===this.phase&&0===this.direction?t=t.write("expanded").write(40):1===this.direction?(t=t.write("expanding").write(40),0!==this.phase&&(t=t.debug(this.phase))):-1===this.direction?(t=t.write("collapsing").write(40),1!==this.phase&&(t=t.debug(this.phase))):(t=t.write("create").write(40).debug(this.phase),0!==this.direction&&(t=t.write(", ").debug(this.direction))),t=t.write(41)}toString(){return s.Format.debug(this)}static collapsed(){return new ft(0,0)}static expanded(){return new ft(1,0)}static expanding(t){return void 0===t&&(t=0),new ft(t,1)}static collapsing(t){return void 0===t&&(t=1),new ft(t,-1)}static create(t,e){return void 0===e&&(e=0),0===t&&0===e?ft.collapsed():1===t&&0===e?ft.expanded():new ft(t,e)}static fromInit(t){return new ft(t.phase,t.direction)}static fromAny(t){if(null==t||t instanceof ft)return t;if(ft.isInit(t))return ft.fromInit(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.phase&&"number"==typeof e.direction}return!1}static isAny(t){return t instanceof ft||ft.isInit(t)}}u([e.Lazy],ft,"collapsed",null),u([e.Lazy],ft,"expanded",null);const gt=function(){const t={fromAny:function(i){if(i instanceof l.DateTime||i instanceof o.Angle||i instanceof o.Length||i instanceof B||i instanceof O||i instanceof st||i instanceof et||i instanceof o.Transform||i instanceof e.Interpolator||"number"==typeof i||"boolean"==typeof i)return i;if(i instanceof Date||l.DateTime.isInit(i))return l.DateTime.fromAny(i);if(O.isInit(i))return O.fromAny(i);if(B.isInit(i))return B.fromAny(i);if(st.isInit(i))return st.fromAny(i);if("string"==typeof i)return t.parse(i);throw new TypeError(""+i)},parse:function(t){for("string"==typeof t&&(t=s.Unicode.stringInput(t));t.isCont()&&s.Unicode.isWhitespace(t.head());)t=t.step();let e=wt.parse(t);if(e.isDone())for(;t.isCont()&&s.Unicode.isWhitespace(t.head());)t=t.step();return t.isCont()&&!e.isError()&&(e=s.Parser.error(s.Diagnostic.unexpected(t))),e.bind()}};return Object.defineProperty(t,"form",{value:function(){const e=new vt(void 0);return Object.defineProperty(t,"form",{value:function(){return e},enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),t}();class vt extends r.Form{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new vt(t):this}mold(t){if(void 0!==t){if((t=gt.fromAny(t))instanceof l.DateTime)return l.DateTime.form().mold(t);if(t instanceof o.Angle)return o.Angle.form().mold(t);if(t instanceof o.Length)return o.Length.form().mold(t);if(t instanceof O)return O.form().mold(t);if(t instanceof B)return B.form().mold(t);if(t instanceof st)return st.form().mold(t);if(t instanceof o.Transform)return o.Transform.form().mold(t);if("number"==typeof t)return r.Num.from(t);throw new TypeError(""+t)}return r.Item.extant()}cast(t){const e=t.toValue();if(e instanceof r.Num)return e.numberValue();if(e instanceof r.Bool)return e.booleanValue();const i=e.stringValue(void 0);if(void 0!==i)try{return gt.parse(i)}catch(t){}if(e instanceof r.Record){const t=l.DateTime.fromValue(e);if(null!==t)return t;const i=o.Angle.fromValue(e);if(null!==i)return i;const n=o.Length.fromValue(e);if(null!==n)return n;const s=O.fromValue(e);if(null!==s)return s;const r=B.fromValue(e);if(null!==r)return r;const a=st.fromValue(e);if(null!==a)return a;const h=o.Transform.fromValue(e);if(null!==h)return h}}}class wt extends s.Parser{constructor(t,e,i,n){super(),this.identOutput=t,this.valueParser=e,this.unitsOutput=i,this.step=n}feed(t){return wt.parse(t,this.identOutput,this.valueParser,this.unitsOutput,this.step)}static parse(t,e,i,n,r=1){let a=0;if(1===r){for(;t.isCont()&&(a=t.head(),s.Unicode.isSpace(a));)t.step();if(t.isCont()){if(35===a)return Y.parse(t);r=s.Unicode.isAlpha(a)?2:3}else if(!t.isEmpty())return s.Parser.error(s.Diagnostic.unexpected(t))}if(2===r){for(e=e||s.Unicode.stringOutput();t.isCont()&&(a=t.head(),s.Unicode.isAlpha(a)||s.Unicode.isDigit(a)||45===a);)t=t.step(),e.write(a);if(!t.isEmpty()){const i=e.bind();switch(i){case"rgb":case"rgba":return X.parseRest(t);case"hsl":case"hsla":return _.parseRest(t);case"linear-gradient":return ot.parseRest(t,e);case"normal":case"italic":case"oblique":return N.parseRest(t,i);case"small-caps":return N.parseRest(t,void 0,i);case"bold":case"bolder":case"lighter":return N.parseRest(t,void 0,void 0,i);case"ultra-condensed":case"extra-condensed":case"semi-condensed":case"condensed":case"expanded":case"semi-expanded":case"extra-expanded":case"ultra-expanded":return N.parseRest(t,void 0,void 0,void 0,i);case"large":case"larger":case"medium":case"small":case"smaller":case"x-large":case"x-small":case"xx-large":case"xx-small":return N.parseRest(t,void 0,void 0,void 0,void 0,i);case"translate3d":case"translateX":case"translateY":case"translate":return o.TranslateTransformParser.parseRest(t,e);case"scaleX":case"scaleY":case"scale":return o.ScaleTransformParser.parseRest(t,e);case"rotate":return o.RotateTransformParser.parseRest(t,e);case"skewX":case"skewY":case"skew":return o.SkewTransformParser.parseRest(t,e);case"matrix":return o.AffineTransformParser.parseRest(t,e);case"none":return s.Parser.done(o.Transform.identity());case"true":return s.Parser.done(!0);case"false":return s.Parser.done(!1);default:{const e=B.forName(i);return null!==e?s.Parser.done(e):s.Parser.error(s.Diagnostic.message("unknown style value: "+i,t))}}}}if(3===r)if((i=void 0===i?s.Base10.parseDecimal(t):i.feed(t)).isDone())r=4;else if(i.isError())return i.asError();if(4===r){if(t.isCont()&&(a=t.head(),45===a)){t.step();const e={};return e.year=i.bind(),l.DateTimeFormat.pattern("%m-%dT%H:%M:%S.%LZ").parseDate(t,e)}t.isEmpty()||(r=5)}if(5===r){for(n=n||s.Unicode.stringOutput();t.isCont()&&(a=t.head(),s.Unicode.isAlpha(a)||37===a);)t.step(),n.push(a);t.isEmpty()||(r=6)}if(6===r&&!t.isEmpty()){const e=i.bind(),r=n.bind();let l;switch(r){case"deg":l=o.Angle.deg(e);break;case"rad":l=o.Angle.rad(e);break;case"grad":l=o.Angle.grad(e);break;case"turn":l=o.Angle.turn(e);break;case"px":l=o.Length.px(e);break;case"em":l=o.Length.em(e);break;case"rem":l=o.Length.rem(e);break;case"%":l=o.Length.pct(e);break;case"":l=e;break;default:return s.Parser.error(s.Diagnostic.message("unknown style units: "+r,t))}if(t.isCont()&&(a=t.head(),s.Unicode.isSpace(a)||47===a)){if(l instanceof o.Length)return N.parseRest(t,void 0,void 0,void 0,void 0,l);if("number"==typeof l)switch(e){case 100:case 200:case 300:case 400:case 500:case 600:case 700:case 800:case 900:return N.parseRest(t,void 0,void 0,String(e))}}return s.Parser.done(l)}return new wt(e,i,n,r)}}function yt(t){return"object"==typeof t&&null!==t?"function"==typeof t.toAttributeString?t.toAttributeString():t.toString():""+t}function mt(t){return"object"==typeof t&&null!==t?"function"==typeof t.toStyleString?t.toStyleString():t.toString():""+t}const bt=function(){let t;return t="undefined"!=typeof CSSStyleValue?function(t){return"object"==typeof t&&null!==t&&"function"==typeof t.toCssValue?t.toCssValue():"number"==typeof t?new CSSUnitValue(t,"number"):null}:mt,t}();class Ct{constructor(t,e){this.array=t,this.index=e}get size(){return this.array.length}isEmpty(){return 0===this.array.length}has(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.index[t]}get(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.index[t]);const e="number"==typeof t?this.array[t]:void 0;return void 0!==e?e[1]:void 0}getOr(t,e){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.index[t]);const i="number"==typeof t?this.array[t]:void 0;return void 0!==i?i[1]:e}updated(t,e){let i,n=this.array,o=this.index;const s=Array.isArray(t)?t.length:1;for(let r=0;r<s;r+=1){0!==r||Array.isArray(t)?[i,e]=t[r]:i=t;const s=o[i.name];if(void 0!==e&&void 0!==s){const t=n.slice(0);t[s]=[i,e],n=t}else if(void 0!==e){const t=n.slice(0),s={};for(const t in o)s[t]=o[t];s[i.name]=t.length,t.push([i,e]),n=t,o=s}else if(void 0!==s){const t=new Array,e={};let s=0;for(let o=0,r=n.length;o<r;o+=1){const r=n[o];r[0]!==i&&(t[s]=r,e[r[0].name]=s,s+=1)}n=t,o=e}}return this}copy(t,e){return Ct.fromArray(t,e)}forEach(t,e){const i=this.array;for(let n=0,o=i.length;n<o;n+=1){const o=i[n],s=t.call(e,o[1],o[0]);if(void 0!==s)return s}}equals(t){return this===t||t instanceof Ct&&e.Arrays.equal(this.array,t.array)}debug(t){const e=this.array,i=e.length;t=t.write("LookVector").write(46).write(0!==i?"of":"empty").write(40);for(let n=0;n<i;n+=1){const[i,o]=e[n];0!==n&&(t=t.write(", ")),t=t.write(91).debug(i).write(", ").debug(o).write(93)}return t=t.write(41)}toString(){return s.Format.debug(this)}static empty(){return new Ct(e.Arrays.empty,{})}static of(...t){return new Ct(t,Ct.index(t))}static fromArray(t,e){return void 0===e&&(e=Ct.index(t)),new Ct(t,e)}static fromAny(t){if(null==t||t instanceof Ct)return t;if(Array.isArray(t))return Ct.fromArray(t);throw new TypeError(""+t)}static index(t){const e={};for(let i=0,n=t.length;i<n;i+=1){e[t[i][0].name]=i}return e}}u([e.Lazy],Ct,"empty",null);class St{constructor(t){this.name=t}add(t,e){const i=t.array,n=e.array,o=new Array,s={};for(let t=0,n=i.length;t<n;t+=1){const n=i[t],r=n[0],l=e.get(r);s[r.name]=o.length,o.push(void 0===l?n:[r,r.combine(this,n[1],l)])}for(let t=0,e=n.length;t<e;t+=1){const e=n[t],i=e[0];void 0===s[i.name]&&(s[i.name]=o.length,o.push(e))}return this.fromArray(o,s)}negate(t){const e=t.array,i=e.length,n=new Array(i);for(let t=0;t<i;t+=1){const[i,o]=e[t];n[t]=[i,i.combine(this,void 0,o,-1)]}return this.fromArray(n,t.index)}subtract(t,e){const i=t.array,n=e.array,o=new Array,s={};for(let t=0,n=i.length;t<n;t+=1){const n=i[t],r=n[0],l=e.get(r);s[r.name]=o.length,o.push(void 0===l?n:[r,r.combine(this,n[1],l,-1)])}for(let t=0,e=n.length;t<e;t+=1){const[e,i]=n[t];void 0===s[e.name]&&(s[e.name]=o.length,o.push([e,e.combine(this,void 0,i,-1)]))}return this.fromArray(o,s)}multiply(t,e){const i=t.array,n=i.length,o=new Array(n);for(let t=0;t<n;t+=1){const[n,s]=i[t];o[t]=[n,n.combine(this,void 0,s,e)]}return this.fromArray(o,t.index)}dot(t,e){const i=t.array;let n;for(let t=0,o=i.length;t<o;t+=1){const[o,s]=i[t],r=e.get(o);void 0!==r&&0!==r&&(n=o.combine(this,n,s,r))}return n}dotOr(t,e,i){const n=t.array;if(0!==n.length){let t;for(let i=0,o=n.length;i<o;i+=1){const[o,s]=n[i],r=e.get(o);void 0!==r&&0!==r&&(t=o.combine(this,t,s,r))}return t}return i}empty(){return Ct.empty()}of(...t){const e=t.length,i=new Array(e),n={};for(let o=0;o<e;o+=1){const[e,s]=t[o];i[o]=[e,this.coerce(s)],n[e.name]=o}return this.fromArray(i,n)}fromArray(t,e){return Ct.fromArray(t,e)}toString(){return"Look."+this.name}}class At extends St{combine(t,e,i){return void 0!==t?void 0===i||1===i?e:0===i?t:(1-i)*t+i*e:void 0!==i&&1!==i?e*i:e}between(t,i){return e.NumberInterpolator(t,i)}coerce(t){return t}}class xt extends St{combine(t,e,i){return void 0!==t?void 0===i||1===i?e:0===i?t:o.LengthInterpolator(t,e)(i):void 0!==i&&1!==i?e.times(i):e}between(t,e){return o.LengthInterpolator(t,e)}coerce(t){return o.Length.fromAny(t)}}class Tt extends St{combine(t,e,i){return void 0!==t?void 0===i||1===i?e:0===i?t:t.interpolateTo(e)(i):void 0!==i&&1!==i?e.times(i):e}between(t,e){return t.interpolateTo(e)}coerce(t){return B.fromAny(t)}}class Dt extends St{combine(t,e,i){return void 0===i||0!==i?e:void 0!==t?t:O.family(e.family)}between(t,e){return W(t,e)}coerce(t){return O.fromAny(t)}}class Vt extends St{combine(t,e,i){return void 0===i||0!==i?e:void 0!==t?t:e}between(t,e){return rt(t,e)}coerce(t){return st.fromAny(t)}}class Pt extends St{combine(t,e,i){return void 0===i||0!==i?e:void 0!==t?t:e}between(t,i){return e.Interpolator(t,i)}coerce(t){return e.Timing.fromAny(t)}}class It{constructor(t,e){this.array=t,this.index=e}get size(){return this.array.length}isEmpty(){return 0===this.array.length}has(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.index[t]}get(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.index[t]);const e="number"==typeof t?this.array[t]:void 0;return void 0!==e?e[1]:void 0}getOr(t,e){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.index[t]);const i="number"==typeof t?this.array[t]:void 0;return void 0!==i?i[1]:e}updated(t,e){let i,n=this.array,o=this.index;const s=Array.isArray(t)?t.length:1;for(let r=0;r<s;r+=1){0!==r||Array.isArray(t)?[i,e]=t[r]:i=t;const s=o[i.name];if(void 0!==e&&void 0!==s){const t=n.slice(0);t[s]=[i,e],n=t}else if(void 0!==e){const t=n.slice(0),s={};for(const t in o)s[t]=o[t];s[i.name]=t.length,t.push([i,e]),n=t,o=s}else if(void 0!==s){const t=new Array,e={};let s=0;for(let o=0,r=n.length;o<r;o+=1){const r=n[o];r[0]!==i&&(t[s]=r,e[r[0].name]=s,s+=1)}n=t,o=e}}return this}plus(t){const e=this.array,i=t.array,n=new Array,o={};for(let i=0,s=e.length;i<s;i+=1){const s=e[i],r=s[0],l=t.get(r);o[r.name]=n.length,n.push(void 0===l?s:[r,r.combine(s[1],l)])}for(let t=0,e=i.length;t<e;t+=1){const e=i[t],s=e[0];void 0===o[s.name]&&(o[s.name]=n.length,n.push(e))}return this.copy(n,o)}negative(){const t=this.array,e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,o]=t[n];i[n]=[e,e.combine(void 0,o,-1)]}return this.copy(i,this.index)}minus(t){const e=this.array,i=t.array,n=new Array,o={};for(let i=0,s=e.length;i<s;i+=1){const s=e[i],r=s[0],l=t.get(r);o[r.name]=n.length,n.push(void 0===l?s:[r,r.combine(s[1],l,-1)])}for(let t=0,e=i.length;t<e;t+=1){const[e,s]=i[t];void 0===o[e.name]&&(o[e.name]=n.length,n.push([e,e.combine(void 0,s,-1)]))}return this.copy(n,o)}times(t){const e=this.array,i=e.length,n=new Array(i);for(let o=0;o<i;o+=1){const[i,s]=e[o];n[o]=[i,i.combine(void 0,s,t)]}return this.copy(n,this.index)}copy(t,e){return It.fromArray(t,e)}forEach(t,e){const i=this.array;for(let n=0,o=i.length;n<o;n+=1){const o=i[n],s=t.call(e,o[1],o[0]);if(void 0!==s)return s}}interpolateTo(t){return t instanceof It?Lt(this,t):null}equals(t){return this===t||t instanceof It&&e.Arrays.equal(this.array,t.array)}debug(t){const e=this.array,i=e.length;t=t.write("FeelVector").write(46).write(0!==i?"of":"empty").write(40);for(let n=0;n<i;n+=1){const[i,o]=e[n];0!==n&&(t=t.write(", ")),t=t.write(91).debug(i).write(", ").debug(o).write(93)}return t=t.write(41)}toString(){return s.Format.debug(this)}static empty(){return new It([],{})}static of(...t){const e=t.length,i=new Array(e),n={};for(let o=0;o<e;o+=1){const[e,s]=t[o];i[o]=[e,e.coerce(s)],n[e.name]=o}return new It(i,n)}static fromArray(t,e){return void 0===e&&(e=It.index(t)),new It(t,e)}static fromAny(t){if(null==t||t instanceof It)return t;if(Array.isArray(t))return It.of(...t);throw new TypeError(""+t)}static index(t){const e={};for(let i=0,n=t.length;i<n;i+=1){e[t[i][0].name]=i}return e}}u([e.Lazy],It,"empty",null);class Mt{constructor(t){this.name=t}empty(){return It.empty()}of(...t){return It.of(...t)}from(t,e){return It.fromArray(t,e)}toString(){return"Feel."+this.name}}const Lt=function(t){const i=function(t,e){const n=function(t){const e=n.interpolators,i=e.length,o=new Array(i),s=n.index;for(let n=0;n<i;n+=1){const[i,s]=e[n],r=s(t);o[n]=[i,r]}return It.fromArray(o,s)};Object.setPrototypeOf(n,i.prototype);const o=new Array,s={};return t.forEach((function(t,i){const n=e.get(i);if(void 0!==n){const e=i.between(t,n);s[i.name]=o.length,o.push([i,e])}})),n.interpolators=o,n.index=s,n};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.interpolators,e=t.length,i=new Array(e),n=this.index;for(let n=0;n<e;n+=1){const[e,o]=t[n],s=o[0];i[n]=[e,s]}return It.fromArray(i,n)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.interpolators,e=t.length,i=new Array(e),n=this.index;for(let n=0;n<e;n+=1){const[e,o]=t[n],s=o[1];i[n]=[e,s]}return It.fromArray(i,n)},configurable:!0}),i.prototype.equals=function(t){if(this===t)return!0;if(t instanceof i){const i=this.interpolators.length;if(i===t.interpolators.length){for(let n=0;n<i;n+=1)if(!e.Arrays.equal(this.interpolators[n],t.interpolators[n]))return!1;return!0}}return!1},i}(e.Interpolator);class kt extends Mt{combine(t,e,i,n){return t.combine(e,i,n)}}class Ft extends Mt{combine(t,e,i,n){if(e instanceof B&&i instanceof B){const t=void 0===n?i.alpha():i.alpha()*n;return t>=0?e.darker(t):e.lighter(-t)}return t.combine(e,i,n)}}class Rt extends Mt{combine(t,e,i,n){if(e instanceof B&&i instanceof B){if(void 0===n||1===n)return e.alpha(i.alpha());if(0===n)return e;{const t=(1-n)*e.alpha()+n*i.alpha();return e.alpha(t)}}return t.combine(e,i,n)}}const Ot={};class Wt{constructor(t,e){this.array=t,this.index=e}get size(){return this.array.length}isEmpty(){return 0===this.array.length}has(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.index[t]}get(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.index[t]);const e="number"==typeof t?this.array[t]:void 0;return void 0!==e?e[1]:void 0}getOr(t,e){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.index[t]);const i="number"==typeof t?this.array[t]:void 0;return void 0!==i?i[1]:e}updated(t,e){let i,n,o,s=this.array,r=this.index;const l=Array.isArray(t)?t.length:1;for(let a=0;a<l;a+=1){0!==a||Array.isArray(t)?[i,e]=t[a]:i=t;const l=r[i.name];if(void 0!==e&&void 0!==l)n=s.slice(0),o=r,n[l]=[i,e],s=n;else if(void 0!==e){n=s.slice(0),o={};for(const t in r)o[t]=r[t];o[i.name]=n.length,n.push([i,e]),s=n,r=o}else if(void 0!==l){n=new Array,o={};let t=0;for(let e=0,r=s.length;e<r;e+=1){const r=s[e];r[0]!==i&&(n[t]=r,o[r[0].name]=t,t+=1)}s=n,r=o}}return void 0!==n&&void 0!==o?this.copy(n,o):this}plus(t){const e=this.array,i=t.array,n=new Array,o={};for(let i=0,s=e.length;i<s;i+=1){const s=e[i],r=s[0],l=t.get(r);o[r.name]=n.length,n.push(void 0===l?s:[r,s[1]+l])}for(let t=0,e=i.length;t<e;t+=1){const e=i[t],s=e[0];void 0===o[s.name]&&(o[s.name]=n.length,n.push(e))}return this.copy(n,o)}negative(){const t=this.array,e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,o]=t[n];i[n]=[e,-o]}return this.copy(i,this.index)}minus(t){const e=this.array,i=t.array,n=new Array,o={};for(let i=0,s=e.length;i<s;i+=1){const s=e[i],r=s[0],l=t.get(r);o[r.name]=n.length,n.push(void 0===l?s:[r,s[1]-l])}for(let t=0,e=i.length;t<e;t+=1){const[e,s]=i[t];void 0===o[e.name]&&(o[e.name]=n.length,n.push([e,-s]))}return this.copy(n,o)}times(t){const e=this.array,i=e.length,n=new Array(i);for(let o=0;o<i;o+=1){const[i,s]=e[o];n[o]=[i,s*t]}return this.copy(n,this.index)}dot(t){const e=this.array;let i;for(let n=0,o=e.length;n<o;n+=1){const[o,s]=e[n],r=t.get(o);void 0!==r&&(void 0===i?i=s*r:i+=s*r)}return i}copy(t,e){return Wt.fromArray(t,e)}forEach(t,e){const i=this.array;for(let n=0,o=i.length;n<o;n+=1){const o=i[n],s=t.call(e,o[1],o[0]);if(void 0!==s)return s}}equals(t){return this===t||t instanceof Wt&&e.Arrays.equal(this.array,t.array)}debug(t){const e=this.array,i=e.length;t=t.write("MoodVector").write(46).write(0!==i?"of":"empty").write(40);for(let n=0;n<i;n+=1){const[i,o]=e[n];0!==n&&(t=t.write(", ")),t=t.write(91).debug(i).write(", ").debug(o).write(93)}return t=t.write(41)}toString(){return s.Format.debug(this)}static empty(){return new Wt([],{})}static of(...t){return new Wt(t,Wt.index(t))}static fromArray(t,e){return void 0===e&&(e=Wt.index(t)),new Wt(t,e)}static fromAny(t){if(null==t||t instanceof Wt)return t;if(Array.isArray(t))return Wt.fromArray(t);throw new TypeError(""+t)}static index(t){const e={};for(let i=0,n=t.length;i<n;i+=1){e[t[i][0].name]=i}return e}}u([e.Lazy],Wt,"empty",null);class Et{constructor(t,e,i,n){this.rowArray=t,this.rowIndex=e,this.colArray=i,this.colIndex=n}get rowCount(){return this.rowArray.length}get colCount(){return this.colArray.length}hasRow(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.rowIndex[t]}hasCol(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.colIndex[t]}getRow(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.rowIndex[t]);const e="number"==typeof t?this.rowArray[t]:void 0;return void 0!==e?e[1]:void 0}getCol(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.colIndex[t]);const e="number"==typeof t?this.colArray[t]:void 0;return void 0!==e?e[1]:void 0}plus(t){const e=this.colArray,i=t.colArray,n=new Array,o={};for(let i=0,s=e.length;i<s;i+=1){const s=e[i],r=s[0],l=t.getCol(r);o[r.name]=n.length,n.push(void 0===l?s:[r,s[1].plus(l)])}for(let t=0,e=i.length;t<e;t+=1){const e=i[t],s=e[0];void 0===o[s.name]&&(o[s.name]=n.length,n.push(e))}return Et.fromColArray(n,o)}negative(){const t=this.colArray,e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,o]=t[n];i[n]=[e,o.negative()]}return Et.fromColArray(i,this.colIndex)}minus(t){const e=this.colArray,i=t.colArray,n=new Array,o={};for(let i=0,s=e.length;i<s;i+=1){const s=e[i],r=s[0],l=t.getCol(r);o[r.name]=n.length,n.push(void 0===l?s:[r,s[1].minus(l)])}for(let t=0,e=i.length;t<e;t+=1){const[e,s]=i[t];void 0===o[e.name]&&(o[e.name]=n.length,n.push([e,s.negative()]))}return Et.fromColArray(n,o)}times(t){const e=this.colArray,i=e.length,n=new Array(i);for(let o=0;o<i;o+=1){const[i,s]=e[o];n[o]=[i,s.times(t)]}return Et.fromColArray(n,this.colIndex)}dot(t,e){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.rowIndex[t]);const i="number"==typeof t?this.rowArray[t]:void 0;if(void 0!==i){t=i[0];return i[1].dot(e)}}timesCol(t,e=!1){const i=this.rowArray,n=new Array,o={};for(let e=0,s=i.length;e<s;e+=1){const[s,r]=i[e],l=r.dot(t);void 0!==l&&(o[s.name]=n.length,n.push([s,l]))}if(e){const e=t.array;for(let t=0,i=e.length;t<i;t+=1){const i=e[t][0];this.hasRow(i)||(o[i.name]=n.length,n.push(e[t]))}}return Wt.fromArray(n,o)}timesRow(t,e=!1){const i=this.colArray,n=new Array,o={};for(let e=0,s=i.length;e<s;e+=1){const[s,r]=i[e],l=t.dot(r);void 0!==l&&(o[s.name]=n.length,n.push([s,l]))}if(e){const e=t.array;for(let t=0,i=e.length;t<i;t+=1){const i=e[t][0];this.hasCol(i)||(o[i.name]=n.length,n.push(e[t]))}}return Wt.fromArray(n,o)}transform(t,e=!0){const i=this.rowArray,n=this.colArray,o=new Array,s={},r=new Array,l={};for(let a=0,h=n.length;a<h;a+=1){const h=n[a][0];let c=t.getCol(h);if(void 0===c&&e&&(c=Wt.of([h,1])),void 0!==c)for(let t=0,e=i.length;t<e;t+=1){const[e,n]=i[t],a=n.dot(c);if(void 0!==a){const t=s[e.name];if(void 0!==t){const i=o[t][1];i.index[e.name]=i.array.length,i.array.push([h,a])}else s[e.name]=o.length,o.push([e,Wt.of([h,a])]);const i=l[h.name];if(void 0!==i){const t=r[i][1];t.index[h.name]=t.array.length,t.array.push([e,a])}else l[h.name]=r.length,r.push([h,Wt.of([e,a])])}}}return new Et(o,s,r,l)}identityFor(t){const e=this.rowArray,i=t.colArray;let n,o;for(let t=0,s=i.length;t<s;t+=1){const s=i[t][0];if(!this.hasRow(s)){if(void 0===n&&(n=e.slice(0)),void 0===o){o={};for(const t in this.rowIndex)o[t]=this.rowIndex[t]}o[s.name]=n.length,n.push([s,Wt.of([s,1])])}}return void 0!==n&&void 0!==o?Et.fromRowArray(n,o):this}row(t,e){void 0!==e&&(e=Wt.fromAny(e));const i=this.rowArray,n=this.rowIndex,o=n[t.name];if(void 0!==e&&void 0!==o){const s=i.slice(0);return s[o]=[t,e],Et.fromRowArray(s,n)}if(void 0!==e){const o=i.slice(0),s={};for(const t in n)s[t]=n[t];return s[t.name]=o.length,o.push([t,e]),Et.fromRowArray(o,s)}if(void 0!==o){const e=new Array,n={};let o=0;for(let s=0,r=i.length;s<r;s+=1){const r=i[s];r[0]!==t&&(e[o]=r,n[r[0].name]=o,o+=1)}return Et.fromRowArray(e,n)}return this}col(t,e){void 0!==e&&(e=Wt.fromAny(e));const i=this.colArray,n=this.colIndex,o=n[t.name];if(void 0!==e&&void 0!==o){const s=i.slice(0);return s[o]=[t,e],Et.fromColArray(s,n)}if(void 0!==e){const o=i.slice(0),s={};for(const t in n)s[t]=n[t];return s[t.name]=o.length,o.push([t,e]),Et.fromColArray(o,s)}if(void 0!==o){const e=new Array,n={};let o=0;for(let s=0,r=i.length;s<r;s+=1){const r=i[s];r[0]!==t&&(e[o]=r,n[r[0].name]=o,o+=1)}return Et.fromColArray(e,n)}return this}updatedRow(t,e,i){const n=this.getRow(t);let o=n;return void 0===o&&(!0===i?i=Wt.of([t,1]):!1===i&&(i=void 0),o=i=void 0!==i?Wt.fromAny(i):Wt.empty()),o=o.updated(e),o.equals(n)?this:this.row(t,o)}updatedCol(t,e,i){const n=this.getCol(t);let o=n;return void 0===o&&(!0===i?i=Wt.of([t,1]):!1===i&&(i=void 0),o=i=void 0!==i?Wt.fromAny(i):Wt.empty()),o=o.updated(e),o.equals(n)?this:this.col(t,o)}equals(t){if(this===t)return!0;if(t instanceof Et){return e.Arrays.equal(this.colArray,t.colArray)}return!1}debug(t){const e=this.colArray,i=e.length;t=t.write("MoodMatrix").write(46).write(0!==i?"forCols":"empty").write(40);for(let n=0;n<i;n+=1){const[i,o]=e[n];0!==n&&(t=t.write(", ")),t=t.write(91).debug(i).write(", ").debug(o).write(93)}return t=t.write(41)}toString(){return s.Format.debug(this)}static empty(){return new Et([],{},[],{})}static forRows(...t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,o]=t[n];i[n]=[e,Wt.fromAny(o)]}return this.fromRowArray(i)}static forCols(...t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,o]=t[n];i[n]=[e,Wt.fromAny(o)]}return this.fromColArray(i)}static fromRowArray(t,e){void 0===e&&(e=Wt.index(t));const i=new Array,n={};for(let e=0,o=t.length;e<o;e+=1){t[e][1].forEach((function(t,e){void 0===n[e.name]&&(n[e.name]=i.length,i.push([e,void 0]))}),this)}for(let e=0,n=i.length;e<n;e+=1){const n=i[e],o=n[0],s=new Array,r={};for(let e=0,i=t.length;e<i;e+=1){const[i,n]=t[e],l=n.get(o);void 0!==l&&(r[i.name]=s.length,s.push([i,l]))}const l=Wt.fromArray(s,r);n[1]=l}return new Et(t,e,i,n)}static fromColArray(t,e){void 0===e&&(e=Wt.index(t));const i=new Array,n={};for(let e=0,o=t.length;e<o;e+=1){t[e][1].forEach((function(t,e){void 0===n[e.name]&&(n[e.name]=i.length,i.push([e,void 0]))}),this)}for(let e=0,n=i.length;e<n;e+=1){const n=i[e],o=n[0],s=new Array,r={};for(let e=0,i=t.length;e<i;e+=1){const[i,n]=t[e],l=n.get(o);void 0!==l&&(r[i.name]=s.length,s.push([i,l]))}const l=Wt.fromArray(s,r);n[1]=l}return new Et(i,n,t,e)}}u([e.Lazy],Et,"empty",null);const Nt={};class Bt{constructor(t,e,i,n){this.rowArray=t,this.rowIndex=e,this.colArray=i,this.colIndex=n}get rowCount(){return this.rowArray.length}get colCount(){return this.colArray.length}hasRow(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.rowIndex[t]}hasCol(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.colIndex[t]}getRow(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.rowIndex[t]);const e="number"==typeof t?this.rowArray[t]:void 0;return void 0!==e?e[1]:void 0}getCol(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.colIndex[t]);const e="number"==typeof t?this.colArray[t]:void 0;return void 0!==e?e[1]:void 0}get(t,e){return this.dot(t,e)}getOr(t,e,i){return this.dotOr(t,e,i)}plus(t){const e=this.colArray,i=t.colArray,n=new Array,o={};for(let i=0,s=e.length;i<s;i+=1){const s=e[i],r=s[0],l=t.getCol(r);o[r.name]=n.length,n.push(void 0===l?s:[r,s[1].plus(l)])}for(let t=0,e=i.length;t<e;t+=1){const e=i[t],s=e[0];void 0===o[s.name]&&(o[s.name]=n.length,n.push(e))}return Bt.fromColArray(n,o)}negative(){const t=this.colArray,e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,o]=t[n];i[n]=[e,o.negative()]}return Bt.fromColArray(i,this.colIndex)}minus(t){const e=this.colArray,i=t.colArray,n=new Array,o={};for(let i=0,s=e.length;i<s;i+=1){const s=e[i],r=s[0],l=t.getCol(r);o[r.name]=n.length,n.push(void 0===l?s:[r,s[1].minus(l)])}for(let t=0,e=i.length;t<e;t+=1){const[e,s]=i[t];void 0===o[e.name]&&(o[e.name]=n.length,n.push([e,s.negative()]))}return Bt.fromColArray(n,o)}times(t){const e=this.colArray,i=e.length,n=new Array(i);for(let o=0;o<i;o+=1){const[i,s]=e[o];n[o]=[i,s.times(t)]}return Bt.fromColArray(n,this.colIndex)}dot(t,e){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.rowIndex[t]);const i="number"==typeof t?this.rowArray[t]:void 0;if(void 0!==i){t=i[0];const n=i[1];return t.dot(n,e)}}dotOr(t,e,i){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.rowIndex[t]);const n="number"==typeof t?this.rowArray[t]:void 0;if(void 0!==n){t=n[0];const o=n[1];return t.dotOr(o,e,i)}return i}timesCol(t){const e=this.rowArray,i=new Array,n={};for(let o=0,s=e.length;o<s;o+=1){const[s,r]=e[o],l=s.dot(r,t);void 0!==l&&(n[s.name]=i.length,i.push([s,l]))}return It.fromArray(i,n)}transform(t,e=!0){const i=this.rowArray,n=this.colArray,o=new Array,s={},r=new Array,l={};for(let a=0,h=n.length;a<h;a+=1){const h=n[a][0];let c=t.getCol(h);if(void 0===c&&e&&(c=Wt.of([h,1])),void 0!==c)for(let t=0,e=i.length;t<e;t+=1){const[e,n]=i[t],a=e.dot(n,c);if(void 0!==a){const t=s[e.name];if(void 0!==t){const i=o[t][1];i.index[e.name]=i.array.length,i.array.push([h,a])}else s[e.name]=o.length,o.push([e,Ct.of([h,a])]);const i=l[h.name];if(void 0!==i){const t=r[i][1];t.index[h.name]=t.array.length,t.array.push([e,a])}else l[h.name]=r.length,r.push([h,It.of([e,a])])}}}return new Bt(o,s,r,l)}row(t,e){void 0!==e&&(e=Ct.fromAny(e));const i=this.rowArray,n=this.rowIndex,o=n[t.name];if(void 0!==e&&void 0!==o){const s=i.slice(0);return s[o]=[t,e],Bt.fromRowArray(s,n)}if(void 0!==e){const o=i.slice(0),s={};for(const t in n)s[t]=n[t];return s[t.name]=o.length,o.push([t,e]),Bt.fromRowArray(o,s)}if(void 0!==o){const e=new Array,n={};let o=0;for(let s=0,r=i.length;s<r;s+=1){const r=i[s];r[0]!==t&&(e[o]=r,n[r[0].name]=o,o+=1)}return Bt.fromRowArray(e,n)}return this}col(t,e){void 0!==e&&(e=It.fromAny(e));const i=this.colArray,n=this.colIndex,o=n[t.name];if(void 0!==e&&void 0!==o){const s=i.slice(0);return s[o]=[t,e],Bt.fromColArray(s,n)}if(void 0!==e){const o=i.slice(0),s={};for(const t in n)s[t]=n[t];return s[t.name]=o.length,o.push([t,e]),Bt.fromColArray(o,s)}if(void 0!==o){const e=new Array,n={};let o=0;for(let s=0,r=i.length;s<r;s+=1){const r=i[s];r[0]!==t&&(e[o]=r,n[r[0].name]=o,o+=1)}return Bt.fromColArray(e,n)}return this}updatedRow(t,e,i){const n=this.getRow(t);let o=n;return void 0===o&&(o=i=void 0!==i?Ct.fromAny(i):Ct.empty()),o=o.updated(e),o.equals(n)?this:this.row(t,o)}updatedCol(t,e,i){const n=this.getCol(t);let o=n;return void 0===o&&(o=i=void 0!==i?It.fromAny(i):It.empty()),o=o.updated(e),o.equals(n)?this:this.col(t,o)}equals(t){return this===t||t instanceof Bt&&e.Arrays.equal(this.colArray,t.colArray)}debug(t){const e=this.colArray,i=e.length;t=t.write("ThemeMatrix").write(46).write(0!==i?"forCols":"empty").write(40);for(let n=0;n<i;n+=1){const[i,o]=e[n];0!==n&&(t=t.write(", ")),t=t.write(91).debug(i).write(", ").debug(o).write(93)}return t=t.write(41)}toString(){return s.Format.debug(this)}static empty(){return new Bt([],{},[],{})}static forRows(...t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,o]=t[n];i[n]=[e,Ct.fromAny(o)]}return this.fromRowArray(i)}static forCols(...t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,o]=t[n];i[n]=[e,It.fromAny(o)]}return this.fromColArray(i)}static fromRowArray(t,e){void 0===e&&(e=It.index(t));const i=new Array,n={};for(let e=0,o=t.length;e<o;e+=1){t[e][1].forEach((function(t,e){void 0===n[e.name]&&(n[e.name]=i.length,i.push([e,void 0]))}),this)}for(let e=0,n=i.length;e<n;e+=1){const n=i[e],o=n[0],s=new Array,r={};for(let e=0,i=t.length;e<i;e+=1){const[i,n]=t[e],l=n.get(o);void 0!==l&&(r[i.name]=s.length,s.push([i,l]))}const l=It.fromArray(s,r);n[1]=l}return new Bt(t,e,i,n)}static fromColArray(t,e){void 0===e&&(e=Ct.index(t));const i=new Array,n={};for(let e=0,o=t.length;e<o;e+=1){t[e][1].forEach((function(t,e){void 0===n[e.name]&&(n[e.name]=i.length,i.push([e,void 0]))}),this)}for(let e=0,n=i.length;e<n;e+=1){const n=i[e],o=n[0],s=new Array,r={};for(let e=0,i=t.length;e<i;e+=1){const[i,n]=t[e],l=n.get(o);void 0!==l&&(r[i.name]=s.length,s.push([i,l]))}const l=Ct.fromArray(s,r);n[1]=l}return new Bt(i,n,t,e)}}u([e.Lazy],Bt,"empty",null);const Ut=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){return"getLook"in t}return!1}};return t}(),zt=function(t){const n=t.extend("ThemeAnimator");return n.prototype.onSetAffinity=function(e,n){e>i.Affinity.Intrinsic&&this.setLook(null,e),t.prototype.onSetAffinity.call(this,e,n)},n.prototype.onInherit=function(e){e instanceof n?this.setLook(e.look,e.timing,i.Affinity.Reflexive):this.setLook(null,i.Affinity.Reflexive),null===this.look&&t.prototype.onInherit.call(this,e)},Object.defineProperty(n.prototype,"superLook",{get:function(){const t=this.superFastener;return t instanceof n?t.look:null},configurable:!0}),n.prototype.getSuperLook=function(){const t=this.superLook;if(null===t)throw new TypeError(t+" "+this.name+" super look");return t},n.prototype.getSuperLookOr=function(t){let e=this.superLook;return null===e&&(e=t),e},n.prototype.getLook=function(){const t=this.look;if(null===t)throw new TypeError(t+" "+this.name+" look");return t},n.prototype.getLookOr=function(t){let e=this.look;return null===e&&(e=t),e},n.prototype.setLook=function(t,n,o){if("number"==typeof n&&(o=n,n=void 0),void 0===o&&(o=i.Affinity.Extrinsic),this.minAffinity(o)){const i=this.look;t!==i&&(n=null!=n&&e.Timing.fromAny(n),this.willSetLook(t,i,n),this.look=t,this.onSetLook(t,i,n),this.didSetLook(t,i,n))}},n.prototype.willSetLook=function(t,e,i){},n.prototype.onSetLook=function(t,e,i){null!==t&&this.applyLook(t,i)},n.prototype.didSetLook=function(t,e,i){},n.prototype.applyLook=function(t,e){const n=this.owner;if(this.mounted&&Ut.is(n)){const o=n.getLook(t);void 0!==o&&(!0===e&&(e=n.getLookOr(St.timing,!0)),this.setState(o,e,i.Affinity.Reflexive))}},n.prototype.applyTheme=function(t,e,n){const o=this.look;if(null!==o){const s=t.get(o,e);void 0!==s&&(!0===n&&void 0===(n=t.get(St.timing,e))&&(n=!0),this.setState(s,n,i.Affinity.Reflexive))}},n.prototype.tweenInherited=function(e){const o=this.superFastener;o instanceof n?this.setLook(o.look,o.timing,i.Affinity.Reflexive):this.setLook(null,i.Affinity.Reflexive),null!==this.look?t.prototype.tween.call(this,e):t.prototype.tweenInherited.call(this,e)},n.prototype.onMount=function(){t.prototype.onMount.call(this);const e=this.look;null!==e&&this.applyLook(e,!1)},n.construct=function(e,i,n){return(i=t.construct(e,i,n)).look=null,i},n.specialize=function(t){return t===String?qt:t===Number?Gt:t===Boolean?Ht:t===o.Angle?jt:t===o.Length?Yt:t===o.Transform?Xt:t===B?Kt:t===O?Zt:t===ct?_t:t===ut?Qt:t===ft?Jt:null},n.define=function(t,i){let n=i.extends;const o=i.affinity,s=i.inherits,r=i.look,l=i.value,a=i.initValue;delete i.extends,delete i.implements,delete i.affinity,delete i.inherits,delete i.look,delete i.value,delete i.initValue,null==n&&(n=this.specialize(i.type)),null===n&&(n=this,void 0===i.fromAny&&e.FromAny.is(i.type)&&(i.fromAny=i.type.fromAny));const h=n.extend(t,i);return h.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==o&&e.initAffinity(o),void 0!==s&&e.initInherits(s),void 0!==r&&(e.look=r),void 0!==a?(e.value=e.fromAny(a()),e.state=e.value):void 0!==l&&(e.value=e.fromAny(l),e.state=e.value),e},h},n}(i.Animator),qt=function(t){const e=t.extend("StringThemeAnimator");return e.prototype.fromAny=function(t){return t},e.prototype.equalValues=function(t,e){return t===e},e}(zt),Gt=function(t){const e=t.extend("NumberThemeAnimator");return e.prototype.fromAny=function(t){if("string"==typeof t){const e=+t;if(isFinite(e))return e;throw new Error(t)}return t},e.prototype.equalValues=function(t,e){return t===e},e}(zt),Ht=function(t){const e=t.extend("BooleanThemeAnimator");return e.prototype.fromAny=function(t){return!!t},e.prototype.equalValues=function(t,e){return t===e},e}(zt),jt=function(t){const e=t.extend("AngleThemeAnimator");return e.prototype.fromAny=function(t){return null!=t?o.Angle.fromAny(t):t},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(zt),Yt=function(t){const e=t.extend("LengthThemeAnimator");return e.prototype.fromAny=function(t){return null!=t?o.Length.fromAny(t):null},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(zt),Xt=function(t){const e=t.extend("TransformThemeAnimator");return e.prototype.fromAny=function(t){return null!=t?o.Transform.fromAny(t):null},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(zt),Kt=function(t){const e=t.extend("ColorThemeAnimator");return e.prototype.fromAny=function(t){return null!=t?B.fromAny(t):t},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(zt),Zt=function(t){const e=t.extend("FontThemeAnimator");return e.prototype.fromAny=function(t){return null!=t?O.fromAny(t):t},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(zt),_t=function(t){const e=t.extend("FocusThemeAnimator");return Object.defineProperty(e.prototype,"phase",{get(){const t=this.value;return null!=t?t.phase:void 0},configurable:!0}),e.prototype.getPhase=function(){return this.getValue().phase},e.prototype.getPhaseOr=function(t){const e=this.value;return null!=e?e.phase:t},e.prototype.setPhase=function(t,e,i){const n=this.value;null!=n&&("number"==typeof e&&(i=e,e=void 0),this.setState(n.withPhase(t),e,i))},Object.defineProperty(e.prototype,"direction",{get(){const t=this.value;return null!=t?t.direction:0},configurable:!0}),e.prototype.setDirection=function(t,e,i){const n=this.value;null!=n&&("number"==typeof e&&(i=e,e=void 0),this.setState(n.withDirection(t),e,i))},Object.defineProperty(e.prototype,"unfocused",{get(){const t=this.value;return null!=t&&t.unfocused},configurable:!0}),Object.defineProperty(e.prototype,"focused",{get(){const t=this.value;return null!=t&&t.focused},configurable:!0}),Object.defineProperty(e.prototype,"focusing",{get(){const t=this.value;return null!=t&&t.focusing},configurable:!0}),Object.defineProperty(e.prototype,"unfocusing",{get(){const t=this.value;return null!=t&&t.unfocusing},configurable:!0}),e.prototype.focus=function(t,e){const n=this.value;if(null==n||!n.focused){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(St.timing))}null!=n&&this.setValue(n.asFocusing(),i.Affinity.Reflexive),this.setState(ct.focused(),t,e)}},e.prototype.unfocus=function(t,e){const n=this.value;if(null==n||!n.unfocused){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(St.timing))}null!=n&&this.setValue(n.asUnfocusing(),i.Affinity.Reflexive),this.setState(ct.unfocused(),t,e)}},e.prototype.toggle=function(t,e){const n=this.value;if(null!=n){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(St.timing))}this.setValue(n.asToggling(),i.Affinity.Reflexive),this.setState(n.asToggled(),t,e)}},e.prototype.onSetValue=function(e,i){t.prototype.onSetValue.call(this,e,i),null!=e&&null!=i&&(e.focusing&&!i.focusing?this.willFocus():e.focused&&!i.focused?this.didFocus():e.unfocusing&&!i.unfocusing?this.willUnfocus():e.unfocused&&!i.unfocused&&this.didUnfocus())},e.prototype.willFocus=function(){},e.prototype.didFocus=function(){},e.prototype.willUnfocus=function(){},e.prototype.didUnfocus=function(){},e.prototype.fromAny=function(t){return null!=t?ct.fromAny(t):null},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(zt),Qt=function(t){const e=t.extend("PresenceThemeAnimator");return Object.defineProperty(e.prototype,"phase",{get(){const t=this.value;return null!=t?t.phase:void 0},configurable:!0}),e.prototype.getPhase=function(){return this.getValue().phase},e.prototype.getPhaseOr=function(t){const e=this.value;return null!=e?e.phase:t},e.prototype.setPhase=function(t,e,i){const n=this.value;null!=n&&("number"==typeof e&&(i=e,e=void 0),this.setState(n.withPhase(t),e,i))},Object.defineProperty(e.prototype,"direction",{get(){const t=this.value;return null!=t?t.direction:0},configurable:!0}),e.prototype.setDirection=function(t,e,i){const n=this.value;null!=n&&("number"==typeof e&&(i=e,e=void 0),this.setState(n.withDirection(t),e,i))},Object.defineProperty(e.prototype,"modalState",{get(){const t=this.value;return null!=t?t.modalState:void 0},configurable:!0}),Object.defineProperty(e.prototype,"dismissed",{get(){const t=this.value;return null!=t&&t.dismissed},configurable:!0}),Object.defineProperty(e.prototype,"presented",{get(){const t=this.value;return null!=t&&t.presented},configurable:!0}),Object.defineProperty(e.prototype,"presenting",{get(){const t=this.value;return null!=t&&t.presenting},configurable:!0}),Object.defineProperty(e.prototype,"dismissing",{get(){const t=this.value;return null!=t&&t.dismissing},configurable:!0}),e.prototype.present=function(t,e){const n=this.value;if(null==n||!n.presented){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(St.timing))}null!=n&&this.setValue(n.asPresenting(),i.Affinity.Reflexive),this.setState(ut.presented(),t,e)}},e.prototype.dismiss=function(t,e){const n=this.value;if(null==n||!n.dismissed){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(St.timing))}null!=n&&this.setValue(n.asDismissing(),i.Affinity.Reflexive),this.setState(ut.dismissed(),t,e)}},e.prototype.toggle=function(t,e){const n=this.value;if(null!=n){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(St.timing))}this.setValue(n.asToggling(),i.Affinity.Reflexive),this.setState(n.asToggled(),t,e)}},e.prototype.onSetValue=function(e,i){t.prototype.onSetValue.call(this,e,i),null!=e&&null!=i&&(e.presenting&&!i.presenting?this.willPresent():e.presented&&!i.presented?this.didPresent():e.dismissing&&!i.dismissing?this.willDismiss():e.dismissed&&!i.dismissed&&this.didDismiss())},e.prototype.willPresent=function(){},e.prototype.didPresent=function(){},e.prototype.willDismiss=function(){},e.prototype.didDismiss=function(){},e.prototype.fromAny=function(t){return null!=t?ut.fromAny(t):null},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(zt),Jt=function(t){const e=t.extend("ExpansionThemeAnimator");return Object.defineProperty(e.prototype,"phase",{get(){const t=this.value;return null!=t?t.phase:void 0},configurable:!0}),e.prototype.getPhase=function(){return this.getValue().phase},e.prototype.getPhaseOr=function(t){const e=this.value;return null!=e?e.phase:t},e.prototype.setPhase=function(t,e,i){const n=this.value;null!=n&&("number"==typeof e&&(i=e,e=void 0),this.setState(n.withPhase(t),e,i))},Object.defineProperty(e.prototype,"direction",{get(){const t=this.value;return null!=t?t.direction:0},configurable:!0}),e.prototype.setDirection=function(t,e,i){const n=this.value;null!=n&&("number"==typeof e&&(i=e,e=void 0),this.setState(n.withDirection(t),e,i))},Object.defineProperty(e.prototype,"modalState",{get(){const t=this.value;return null!=t?t.modalState:void 0},configurable:!0}),Object.defineProperty(e.prototype,"collapsed",{get(){const t=this.value;return null!=t&&t.collapsed},configurable:!0}),Object.defineProperty(e.prototype,"expanded",{get(){const t=this.value;return null!=t&&t.expanded},configurable:!0}),Object.defineProperty(e.prototype,"expanding",{get(){const t=this.value;return null!=t&&t.expanding},configurable:!0}),Object.defineProperty(e.prototype,"collapsing",{get(){const t=this.value;return null!=t&&t.collapsing},configurable:!0}),e.prototype.expand=function(t,e){const n=this.value;if(null==n||!n.expanded){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(St.timing))}null!=n&&this.setValue(n.asExpanding(),i.Affinity.Reflexive),this.setState(ft.expanded(),t,e)}},e.prototype.collapse=function(t,e){const n=this.value;if(null==n||!n.collapsed){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(St.timing))}null!=n&&this.setValue(n.asCollapsing(),i.Affinity.Reflexive),this.setState(ft.collapsed(),t,e)}},e.prototype.toggle=function(t,e){const n=this.value;if(null!=n){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(St.timing))}this.setValue(n.asToggling(),i.Affinity.Reflexive),this.setState(n.asToggled(),t,e)}},e.prototype.onSetValue=function(e,i){t.prototype.onSetValue.call(this,e,i),null!=e&&null!=i&&(e.expanding&&!i.expanding?this.willExpand():e.expanded&&!i.expanded?this.didExpand():e.collapsing&&!i.collapsing?this.willCollapse():e.collapsed&&!i.collapsed&&this.didCollapse())},e.prototype.willExpand=function(){},e.prototype.didExpand=function(){},e.prototype.willCollapse=function(){},e.prototype.didCollapse=function(){},e.prototype.fromAny=function(t){return null!=t?ft.fromAny(t):null},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(zt),$t=function(t){const n=t.extend("ThemeConstraintAnimator");return n.prototype.isExternal=function(){return!0},n.prototype.isDummy=function(){return!1},n.prototype.isInvalid=function(){return!1},n.prototype.isConstant=function(){return!1},n.prototype.evaluateConstraintVariable=function(){},n.prototype.updateConstraintSolution=function(t){this.constrained&&this.toNumber(this.state)!==t&&this.setState(t,i.Affinity.Reflexive)},n.prototype.setStrength=function(t){this.strength=a.ConstraintStrength.fromAny(t)},Object.defineProperty(n.prototype,"coefficient",{get:()=>1,configurable:!0}),Object.defineProperty(n.prototype,"variable",{get(){return this},configurable:!0}),Object.defineProperty(n.prototype,"terms",{get(){const t=new a.ConstraintMap;return t.set(this,1),t},configurable:!0}),Object.defineProperty(n.prototype,"constant",{get:()=>0,configurable:!0}),n.prototype.plus=function(t){return this===(t=a.ConstraintExpression.fromAny(t))?a.ConstraintExpression.product(2,this):a.ConstraintExpression.sum(this,t)},n.prototype.negative=function(){return a.ConstraintExpression.product(-1,this)},n.prototype.minus=function(t){return this===(t=a.ConstraintExpression.fromAny(t))?a.ConstraintExpression.zero:a.ConstraintExpression.sum(this,t.negative())},n.prototype.times=function(t){return a.ConstraintExpression.product(t,this)},n.prototype.divide=function(t){return a.ConstraintExpression.product(1/t,this)},Object.defineProperty(n.prototype,"constrained",{get(){return 0!=(this.flags&n.ConstrainedFlag)},configurable:!0}),n.prototype.constrain=function(t){void 0===t&&(t=!0);const e=this.flags;return t&&0==(e&n.ConstrainedFlag)?(this.setFlags(e|n.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&this.stopConstraining()):t||0==(e&n.ConstrainedFlag)||(this.setFlags(e&~n.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())),this},n.prototype.addConstraintCondition=function(t,e){this.conditionCount+=1,!this.constrained&&1===this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())},n.prototype.removeConstraintCondition=function(t,e){this.conditionCount-=1,!this.constrained&&0===this.conditionCount&&this.mounted&&this.stopConstraining()},Object.defineProperty(n.prototype,"constraining",{get(){return 0!=(this.flags&n.ConstrainingFlag)},configurable:!0}),n.prototype.startConstraining=function(){0==(this.flags&n.ConstrainingFlag)&&(this.willStartConstraining(),this.setFlags(this.flags|n.ConstrainingFlag),this.onStartConstraining(),this.didStartConstraining())},n.prototype.willStartConstraining=function(){},n.prototype.onStartConstraining=function(){const t=this.owner;a.ConstraintScope.is(t)&&t.addConstraintVariable(this)},n.prototype.didStartConstraining=function(){},n.prototype.stopConstraining=function(){0!=(this.flags&n.ConstrainingFlag)&&(this.willStopConstraining(),this.setFlags(this.flags&~n.ConstrainingFlag),this.onStopConstraining(),this.didStopConstraining())},n.prototype.willStopConstraining=function(){},n.prototype.onStopConstraining=function(){const t=this.owner;a.ConstraintScope.is(t)&&t.removeConstraintVariable(this)},n.prototype.didStopConstraining=function(){},n.prototype.updateConstraintVariable=function(){const t=this.owner,e=this.value;void 0!==e&&a.ConstraintScope.is(t)&&t.setConstraintVariable(this,this.toNumber(e))},n.prototype.onSetValue=function(e,i){t.prototype.onSetValue.call(this,e,i);const n=this.owner;this.constraining&&a.ConstraintScope.is(n)&&n.setConstraintVariable(this,null!=e?this.toNumber(e):0)},n.prototype.onMount=function(){t.prototype.onMount.call(this),this.constrained||0===this.conditionCount||this.startConstraining()},n.prototype.onUnmount=function(){this.constrained||0===this.conditionCount||this.stopConstraining(),t.prototype.onUnmount.call(this)},n.prototype.fromAny=function(t){if("string"==typeof t){const e=+t;if(isFinite(e))return e}return t},n.prototype.toNumber=function(t){return null!=t?+t:0},n.construct=function(e,i,n){return(i=t.construct(e,i,n)).id=a.ConstraintId.next(),i.strength=a.ConstraintStrength.Strong,i.conditionCount=0,i},n.specialize=function(t){return t===Number?te:t===o.Length?ee:null},n.define=function(t,i){let n=i.extends;const o=i.affinity,s=i.inherits,r=void 0!==i.strength?a.ConstraintStrength.fromAny(i.strength):void 0,l=i.constrain,h=i.look,c=i.value,d=i.initValue;delete i.extends,delete i.implements,delete i.affinity,delete i.inherits,delete i.strength,delete i.constrain,delete i.look,delete i.value,delete i.initValue,null==n&&(n=this.specialize(i.type)),null===n&&(n=this,void 0===i.fromAny&&e.FromAny.is(i.type)&&(i.fromAny=i.type.fromAny));const u=n.extend(t,i);return u.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==o&&e.initAffinity(o),void 0!==s&&e.initInherits(s),void 0!==r&&(e.strength=r),void 0!==h&&(e.look=h),void 0!==d?(e.value=e.fromAny(d()),e.state=e.value):void 0!==c&&(e.value=e.fromAny(c),e.state=e.value),!0===l&&e.constrain(),e},u},n.ConstrainedFlag=1<<t.FlagShift+0,n.ConstrainingFlag=1<<t.FlagShift+1,n.FlagShift=t.FlagShift+2,n.FlagMask=(1<<n.FlagShift)-1,n}(zt),te=function(t){const e=t.extend("NumberThemeConstraintAnimator");return e.prototype.toNumber=function(t){return"number"==typeof t?t:0},e.prototype.fromAny=function(t){if("string"==typeof t){const e=+t;if(isFinite(e))return e;throw new Error(t)}return t},e.prototype.equalValues=function(t,e){return t===e},e}($t),ee=function(t){const e=t.extend("LengthThemeConstraintAnimator");return e.prototype.toNumber=function(t){try{return null!=t?t.pxValue():0}catch(t){return 0}},e.prototype.fromAny=function(t){return null!=t?o.Length.fromAny(t):null},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}($t);St.font=new Dt("font"),St.color=new Tt("color"),St.iconColor=new Tt("iconColor"),St.statusColor=new Tt("statusColor"),St.accentColor=new Tt("accentColor"),St.mutedColor=new Tt("mutedColor"),St.neutralColor=new Tt("neutralColor"),St.subduedColor=new Tt("subduedColor"),St.faintColor=new Tt("faintColor"),St.highlightColor=new Tt("highlightColor"),St.backgroundColor=new Tt("backgroundColor"),St.borderColor=new Tt("borderColor"),St.opacity=new At("opacity"),St.shadow=new Vt("shadow"),St.spacing=new xt("spacing"),St.timing=new Pt("timing"),Mt.ambient=new kt("ambient"),Mt.default=new kt("default"),Mt.primary=new kt("primary"),Mt.secondary=new kt("secondary"),Mt.unselected=new kt("unselected"),Mt.selected=new kt("selected"),Mt.disabled=new kt("disabled"),Mt.inactive=new kt("inactive"),Mt.warning=new kt("warning"),Mt.alert=new kt("alert"),Mt.darker=new Ft("darker"),Mt.lighter=new Ft("lighter"),Mt.contrasted=new Ft("contrasted"),Mt.raised=new kt("raised"),Mt.covered=new kt("covered"),Mt.opaque=new kt("opaque"),Mt.floating=new kt("floating"),Mt.transparent=new kt("transparent"),Mt.translucent=new Rt("translucent"),Mt.embossed=new Ft("embossed"),Mt.nested=new Ft("nested"),Mt.hovering=new Ft("hovering"),Mt.navigating=new kt("navigating"),Ot.ambient=Wt.of([Mt.ambient,1]),Ot.default=Wt.of([Mt.default,1]),Ot.primary=Wt.of([Mt.primary,1]),Ot.secondary=Wt.of([Mt.secondary,1]),Ot.selected=Wt.of([Mt.selected,1]),Ot.disabled=Wt.of([Mt.disabled,1]),Ot.inactive=Wt.of([Mt.inactive,1]),Ot.warning=Wt.of([Mt.warning,1]),Ot.alert=Wt.of([Mt.alert,1]),Ot.darker=Wt.of([Mt.darker,1]),Ot.lighter=Wt.of([Mt.lighter,1]),Ot.contrasted=Wt.of([Mt.contrasted,1]),Ot.raised=Wt.of([Mt.raised,1]),Ot.covered=Wt.of([Mt.covered,1]),Ot.opaque=Wt.of([Mt.opaque,1]),Ot.floating=Wt.of([Mt.floating,1]),Ot.transparent=Wt.of([Mt.transparent,1]),Ot.translucent=Wt.of([Mt.translucent,1]),Ot.embossed=Wt.of([Mt.embossed,1]),Ot.nested=Wt.of([Mt.nested,1]),Ot.hovering=Wt.of([Mt.hovering,1]),Ot.navigating=Wt.of([Mt.navigating,1]);const ie=O.parse("14px -apple-system, system-ui, sans-serif"),ne=B.parse("#d8d8d8"),oe=B.parse("#d8d8d8"),se=B.parse("#6c6d6e"),re=B.parse("#989898"),le=B.parse("#808080"),ae=B.parse("#28292a"),he=B.parse("#1f2123"),ce=B.white(.1),de=B.parse("#161719"),ue=de.lighter(2/3),pe=B.parse("#18191b"),fe=B.parse("#1e2022"),ge=B.parse("#66ffdd"),ve=B.parse("#32c5ff"),we=B.parse("#7b7c7d"),ye=B.parse("#7b7c7d"),me=B.parse("#f9f070"),be=B.parse("#f6511d"),Ce=o.Length.px(10),Se=It.of([St.font,ie],[St.color,ne],[St.iconColor,oe],[St.statusColor,ne],[St.accentColor,se],[St.mutedColor,re],[St.neutralColor,le],[St.subduedColor,ae],[St.faintColor,he],[St.highlightColor,ce],[St.backgroundColor,de],[St.borderColor,ue],[St.spacing,Ce],[St.timing,e.Easing.linear.withDuration(1e3)]),Ae=It.of([St.font,ie],[St.color,ne],[St.iconColor,oe],[St.statusColor,ne],[St.accentColor,se],[St.mutedColor,re],[St.neutralColor,le],[St.subduedColor,ae],[St.faintColor,he],[St.highlightColor,ce],[St.backgroundColor,de],[St.borderColor,ue],[St.spacing,Ce],[St.timing,e.Easing.cubicOut.withDuration(250)]),xe=It.of([St.accentColor,ge]),Te=It.of([St.accentColor,ve]),De=It.of([St.color,re],[St.iconColor,re],[St.backgroundColor,de.darker(1)]),Ve=It.of([St.color,ne],[St.iconColor,oe],[St.backgroundColor,de.darker(1)]),Pe=It.of([St.color,we],[St.iconColor,we],[St.statusColor,we],[St.accentColor,we]),Ie=It.of([St.statusColor,ye],[St.accentColor,ye]),Me=It.of([St.statusColor,me],[St.accentColor,me]),Le=It.of([St.statusColor,be],[St.accentColor,be]),ke=It.of([St.mutedColor,re.darker(1/3)],[St.neutralColor,le.darker(1/3)],[St.backgroundColor,pe]),Fe=It.of([St.mutedColor,re.darker(1/3)],[St.neutralColor,le.darker(1/3)],[St.backgroundColor,fe]),Re=It.of([St.backgroundColor,de],[St.borderColor,ue]),Oe=It.of([St.shadow,st.create(0,2,4,0,B.black(.5))]),We=It.of([St.backgroundColor,de.alpha(0)],[St.borderColor,ue.alpha(0)]),Ee=It.of([St.iconColor,B.black(.8)],[St.statusColor,B.black(.8)],[St.accentColor,B.black(.8)],[St.backgroundColor,B.black(.8)],[St.borderColor,B.black(.8)]),Ne=It.of([St.iconColor,B.black(1)],[St.statusColor,B.black(1)],[St.accentColor,B.black(1)]),Be=It.of([St.iconColor,B.black(-1)],[St.statusColor,B.black(-1)],[St.accentColor,B.black(-1)]),Ue=It.of([St.iconColor,B.black(-1)],[St.statusColor,B.black(-1)],[St.accentColor,B.black(-1)]),ze=It.of([St.iconColor,B.black(2)],[St.statusColor,B.black(2)],[St.accentColor,B.black(2)]),qe=It.of([St.backgroundColor,B.black(1/3)],[St.borderColor,B.black(1/3)]),Ge=It.of([St.statusColor,B.black(1)],[St.accentColor,B.black(1)],[St.backgroundColor,B.black(-2)]),He=It.of([St.timing,e.Easing.cubicOut.withDuration(350)]),je=Bt.forCols([Mt.ambient,Se],[Mt.default,Ae],[Mt.primary,xe],[Mt.secondary,Te],[Mt.unselected,De],[Mt.selected,Ve],[Mt.disabled,Pe],[Mt.inactive,Ie],[Mt.warning,Me],[Mt.alert,Le],[Mt.darker,Ne],[Mt.lighter,Be],[Mt.contrasted,Ue],[Mt.raised,ke],[Mt.covered,Fe],[Mt.opaque,Re],[Mt.floating,Oe],[Mt.transparent,We],[Mt.translucent,Ee],[Mt.embossed,ze],[Mt.nested,qe],[Mt.hovering,Ge],[Mt.navigating,He]);Nt.dark=je;const Ye=O.parse("14px -apple-system, system-ui, sans-serif"),Xe=B.parse("#4a4a4a"),Ke=B.parse("#4a4a4a"),Ze=B.parse("#5c5d5e"),_e=B.parse("#989898"),Qe=B.parse("#808080"),Je=B.parse("#d7d6d5"),$e=B.parse("#e0dedc"),ti=B.black(.05),ei=B.parse("#f9f8f6"),ii=ei.darker(.5),ni=B.parse("#f7f6f4"),oi=B.parse("#f1efed"),si=B.parse("#4fcfb3"),ri=B.parse("#008cc7"),li=B.parse("#7b7c7d"),ai=B.parse("#7b7c7d"),hi=B.parse("#e6de65"),ci=B.parse("#df4616"),di=o.Length.px(10),ui=It.of([St.font,Ye],[St.color,Xe],[St.iconColor,Ke],[St.statusColor,Xe],[St.accentColor,Ze],[St.mutedColor,_e],[St.neutralColor,Qe],[St.subduedColor,Je],[St.faintColor,$e],[St.highlightColor,ti],[St.backgroundColor,ei],[St.borderColor,ii],[St.spacing,di],[St.timing,e.Easing.linear.withDuration(1e3)]),pi=It.of([St.font,Ye],[St.color,Xe],[St.iconColor,Ke],[St.statusColor,Xe],[St.accentColor,Ze],[St.mutedColor,_e],[St.neutralColor,Qe],[St.subduedColor,Je],[St.faintColor,$e],[St.highlightColor,ti],[St.backgroundColor,ei],[St.borderColor,ii],[St.spacing,di],[St.timing,e.Easing.cubicOut.withDuration(250)]),fi=It.of([St.accentColor,si]),gi=It.of([St.accentColor,ri]),vi=It.of([St.color,_e],[St.iconColor,_e],[St.backgroundColor,ei.darker(.5)]),wi=It.of([St.color,Xe],[St.iconColor,Ke],[St.backgroundColor,ei.darker(.5)]),yi=It.of([St.color,li],[St.iconColor,li],[St.statusColor,li],[St.accentColor,li]),mi=It.of([St.statusColor,ai],[St.accentColor,ai]),bi=It.of([St.statusColor,hi],[St.accentColor,hi]),Ci=It.of([St.statusColor,ci],[St.accentColor,ci]),Si=It.of([St.mutedColor,_e.darker(1/3)],[St.neutralColor,Qe.darker(1/3)],[St.backgroundColor,ni]),Ai=It.of([St.mutedColor,_e.darker(1/3)],[St.neutralColor,Qe.darker(1/3)],[St.backgroundColor,oi]),xi=It.of([St.backgroundColor,ei],[St.borderColor,ii]),Ti=It.of([St.shadow,st.create(0,2,4,0,B.black(.5))]),Di=It.of([St.backgroundColor,ei.alpha(0)],[St.borderColor,ii.alpha(0)]),Vi=It.of([St.iconColor,B.black(.8)],[St.statusColor,B.black(.8)],[St.accentColor,B.black(.8)],[St.backgroundColor,B.black(.8)],[St.borderColor,B.black(.8)]),Pi=It.of([St.iconColor,B.black(1)],[St.statusColor,B.black(1)],[St.accentColor,B.black(1)]),Ii=It.of([St.iconColor,B.black(-1)],[St.statusColor,B.black(-1)],[St.accentColor,B.black(-1)]),Mi=It.of([St.iconColor,B.black(1)],[St.statusColor,B.black(1)],[St.accentColor,B.black(1)]),Li=It.of([St.iconColor,B.black(1)],[St.statusColor,B.black(1)],[St.accentColor,B.black(1)]),ki=It.of([St.backgroundColor,B.black(1/24)],[St.borderColor,B.black(1/24)]),Fi=It.of([St.statusColor,B.black(1/4)],[St.accentColor,B.black(1/4)],[St.backgroundColor,B.black(1/4)]),Ri=It.of([St.timing,e.Easing.cubicOut.withDuration(350)]),Oi=Bt.forCols([Mt.ambient,ui],[Mt.default,pi],[Mt.primary,fi],[Mt.secondary,gi],[Mt.unselected,vi],[Mt.selected,wi],[Mt.disabled,yi],[Mt.inactive,mi],[Mt.warning,bi],[Mt.alert,Ci],[Mt.darker,Pi],[Mt.lighter,Ii],[Mt.contrasted,Mi],[Mt.raised,Si],[Mt.covered,Ai],[Mt.opaque,xi],[Mt.floating,Ti],[Mt.transparent,Di],[Mt.translucent,Vi],[Mt.embossed,Li],[Mt.nested,ki],[Mt.hovering,Fi],[Mt.navigating,Ri]);Nt.light=Oi;const Wi=function(){const t={detect:function(){let t=0,e=0,i=0,n=0;const o=document.documentElement.style.width,s=document.documentElement.style.height;document.documentElement.style.width="100%",document.documentElement.style.height="100%";const r=document.createElement("div");r.style.setProperty("position","fixed"),r.style.setProperty("top","0"),r.style.setProperty("right","0"),r.style.setProperty("width",window.innerWidth===document.documentElement.offsetWidth?"100%":"100vw"),r.style.setProperty("height",window.innerHeight===document.documentElement.offsetHeight?"100%":"100vh"),r.style.setProperty("box-sizing","border-box"),r.style.setProperty("padding-top","env(safe-area-inset-top)"),r.style.setProperty("padding-right","env(safe-area-inset-right)"),r.style.setProperty("padding-bottom","env(safe-area-inset-bottom)"),r.style.setProperty("padding-left","env(safe-area-inset-left)"),r.style.setProperty("overflow","hidden"),r.style.setProperty("visibility","hidden"),document.body.appendChild(r);const l=window.getComputedStyle(r),a=parseFloat(l.getPropertyValue("width")),h=parseFloat(l.getPropertyValue("height"));let c=a,d=h,u=0,p=0,f=0,g=0,v=1;void 0!==window.visualViewport&&(c=window.visualViewport.width,d=window.visualViewport.height,u=window.visualViewport.offsetLeft,p=window.visualViewport.offsetTop,f=window.visualViewport.pageLeft,g=window.visualViewport.pageTop,v=window.visualViewport.scale);const w={width:c,height:d,offsetLeft:u,offsetTop:p,pageLeft:f,pageTop:g,scale:v};"undefined"!=typeof CSS&&"function"==typeof CSS.supports&&CSS.supports("padding-top: env(safe-area-inset-top)")&&(t=parseFloat(l.getPropertyValue("padding-top")),e=parseFloat(l.getPropertyValue("padding-right")),i=parseFloat(l.getPropertyValue("padding-bottom")),n=parseFloat(l.getPropertyValue("padding-left"))),document.body.removeChild(r),document.documentElement.style.width=o,document.documentElement.style.height=s;const y={insetTop:t,insetRight:e,insetBottom:i,insetLeft:n};let m,b=screen.msOrientation||screen.mozOrientation||(screen.orientation||{}).type;if(void 0===b)switch(window.orientation){case 0:b="portrait-primary";break;case 180:b="portrait-secondary";break;case-90:b="landscape-primary";break;case 90:b="landscape-secondary";break;default:b="landscape-primary"}return m=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":window.matchMedia("(prefers-color-scheme: light)").matches?"light":"no-preference",{width:a,height:h,visual:w,safeArea:y,orientation:b,colorScheme:m}}};return t}(),Ei=function(){const t={current:null,create:function(){const t=Wi.detect(),e=new o.R2Box(0,0,t.width,t.height);return{updateTime:performance.now(),viewportIdiom:"unspecified",viewport:t,viewFrame:e}}};return t}();class Ni extends i.Service{constructor(){super(),this.viewContext=Ei.create(),this.viewportResizeTimer=0,this.reorientationTimer=0,this.throttleScroll=this.throttleScroll.bind(this),this.throttleResize=this.throttleResize.bind(this),this.debounceViewportResize=this.debounceViewportResize.bind(this),this.throttleViewportResize=this.throttleViewportResize.bind(this),this.debounceReorientation=this.debounceReorientation.bind(this),this.throttleReorientation=this.throttleReorientation.bind(this)}get viewport(){return this.viewContext.viewport}get viewportIdiom(){return this.viewContext.viewportIdiom}detectViewportIdiom(t){return t.width<960||t.height<480?"mobile":"desktop"}updateViewportIdiom(t){let e;const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];if(void 0!==o.detectViewportIdiom&&(e=o.detectViewportIdiom(t,this),void 0!==e))break}void 0===e&&(e=this.detectViewportIdiom(t)),void 0!==e&&this.setViewportIdiom(e)}setViewportIdiom(t){const e=this.viewContext,i=e.viewportIdiom;i!==t&&(this.willSetViewportIdiom(t,i),e.viewportIdiom=t,this.onSetViewportIdiom(t,i),this.didSetViewportIdiom(t,i))}willSetViewportIdiom(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.serviceWillSetViewportIdiom&&o.serviceWillSetViewportIdiom(t,e,this)}}onSetViewportIdiom(t,e){const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(pn.NeedsLayout)}didSetViewportIdiom(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.serviceDidSetViewportIdiom&&o.serviceDidSetViewportIdiom(t,e,this)}}willReorient(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceWillReorient&&n.serviceWillReorient(t,this)}}onReorient(t){}didReorient(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceDidReorient&&n.serviceDidReorient(t,this)}}onObserve(t){super.onObserve(t),this.attached&&this.updateViewportIdiom(this.viewport)}onAttach(){super.onAttach(),this.attachEvents(),this.updateViewportIdiom(this.viewport)}onDetach(){this.detachEvents(),super.onDetach()}attachEvents(){"undefined"!=typeof window&&(window.addEventListener("scroll",this.throttleScroll,{passive:!0}),window.addEventListener("resize",this.throttleResize),window.addEventListener("orientationchange",this.debounceReorientation),void 0!==window.visualViewport&&window.visualViewport.addEventListener("resize",this.debounceViewportResize))}detachEvents(){"undefined"!=typeof window&&(window.removeEventListener("scroll",this.throttleScroll),window.removeEventListener("resize",this.throttleResize),window.removeEventListener("orientationchange",this.debounceReorientation),void 0!==window.visualViewport&&window.visualViewport.removeEventListener("resize",this.debounceViewportResize))}throttleScroll(){const t=this.roots;for(let e=0,i=t.length;e<i;e+=1)t[e].requireUpdate(pn.NeedsScroll)}throttleResize(){const t=Wi.detect(),e=new o.R2Box(0,0,t.width,t.height);this.viewContext.viewport=t,this.viewContext.viewFrame=e,this.updateViewportIdiom(t);const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(pn.NeedsResize|pn.NeedsLayout)}debounceViewportResize(){0!==this.viewportResizeTimer&&(clearTimeout(this.viewportResizeTimer),this.viewportResizeTimer=0),this.viewportResizeTimer=setTimeout(this.throttleViewportResize,Ni.ViewportResizeDelay)}throttleViewportResize(){0!==this.viewportResizeTimer&&(clearTimeout(this.viewportResizeTimer),this.viewportResizeTimer=0);const t=Wi.detect(),e=new o.R2Box(0,0,t.width,t.height);this.viewContext.viewport=t,this.viewContext.viewFrame=e,this.updateViewportIdiom(t);const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(pn.NeedsResize|pn.NeedsScroll|pn.NeedsLayout)}debounceReorientation(){0!==this.reorientationTimer&&(clearTimeout(this.reorientationTimer),this.reorientationTimer=0),this.reorientationTimer=setTimeout(this.throttleReorientation,Ni.ReorientationDelay)}throttleReorientation(){0!==this.reorientationTimer&&(clearTimeout(this.reorientationTimer),this.reorientationTimer=0);const t=Wi.detect(),e=new o.R2Box(0,0,t.width,t.height);this.viewContext.viewport=t,this.viewContext.viewFrame=e,this.willReorient(t.orientation),this.updateViewportIdiom(t),this.onReorient(t.orientation),this.didReorient(t.orientation);const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(pn.NeedsResize|pn.NeedsScroll|pn.NeedsLayout)}static global(){return new Ni}}Ni.ViewportResizeDelay=200,Ni.ReorientationDelay=100,u([e.Lazy],Ni,"global",null);const Bi=function(t){const e=t.extend("ViewportProvider");return Object.defineProperty(e.prototype,"viewContext",{get(){let t=this.service;return null==t&&(t=Ni.global()),t.viewContext},configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get(){let t=this.service;return null==t&&(t=Ni.global()),t.viewport},configurable:!0}),Object.defineProperty(e.prototype,"viewportIdiom",{get(){let t=this.service;return null==t&&(t=Ni.global()),t.viewportIdiom},configurable:!0}),e.prototype.setViewportIdiom=function(t){let e=this.service;null==e&&(e=Ni.global()),e.setViewportIdiom(t)},e.prototype.createService=function(){return Ni.global()},e}(i.Provider);class Ui extends i.Service{constructor(){super(),this.flags=0,this.updateDelay=Ui.MinUpdateDelay,this.processTimer=0,this.displayFrame=0,this.runProcessPass=this.runProcessPass.bind(this),this.runDisplayPass=this.runDisplayPass.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this)}setFlags(t){this.flags=t}updatedViewContext(t){return t.updateTime=performance.now(),t}needsUpdate(t,e){return t}requestUpdate(t,e,i){e=this.needsUpdate(e,i);let n=this.flags&~e&pn.UpdateMask;0!=(e&pn.ProcessMask)&&(n|=pn.NeedsProcess),0!=(e&pn.DisplayMask)&&(n|=pn.NeedsDisplay),this.setFlags(this.flags|n),i&&0==(this.flags&(pn.ProcessingFlag|pn.DisplayingFlag))&&this.updateDelay<=Ui.MaxProcessInterval?this.runImmediatePass():this.scheduleUpdate()}scheduleUpdate(){const t=this.flags;0==(t&pn.ProcessingFlag)&&0!=(t&pn.ProcessMask)?this.scheduleProcessPass(this.updateDelay):0==(t&pn.DisplayingFlag)&&0!=(t&pn.DisplayMask)&&this.scheduleDisplayPass()}cancelUpdate(){this.cancelProcessPass(),this.cancelDisplayPass()}runImmediatePass(){0!=(this.flags&pn.ProcessMask)&&(this.cancelUpdate(),this.runProcessPass(!0)),0!=(this.flags&pn.DisplayMask)&&this.updateDelay<=Ui.MaxProcessInterval&&(this.cancelUpdate(),this.runDisplayPass(void 0,!0))}scheduleProcessPass(t){0===this.processTimer&&(this.processTimer=setTimeout(this.runProcessPass,t))}cancelProcessPass(){0!==this.processTimer&&(clearTimeout(this.processTimer),this.processTimer=0)}runProcessPass(t=!1){this.setFlags(this.flags&~pn.ProcessMask|pn.ProcessingFlag);try{const e=performance.now(),i=this.roots;for(let t=0;t<i.length;t+=1){const n=i[t];if(0!=(n.flags&pn.ProcessMask)){const t=n.viewportProvider.viewContext;t.updateTime=e,n.cascadeProcess(0,t)}}const n=performance.now();let o=Math.max(Ui.MinProcessInterval,this.updateDelay);this.updateDelay=n-e>o?Math.min(Math.max(2,2*this.updateDelay),Ui.MaxUpdateDelay):Math.min(Ui.MinUpdateDelay,this.updateDelay/2),this.cancelProcessPass(),0!=(this.flags&pn.DisplayMask)?this.scheduleDisplayPass():0!=(this.flags&pn.ProcessMask)&&(t&&(o=Math.max(Ui.MaxProcessInterval,o)),this.cancelDisplayPass(),this.scheduleProcessPass(o))}finally{this.setFlags(this.flags&~pn.ProcessingFlag)}}scheduleDisplayPass(){0===this.displayFrame&&(this.displayFrame=requestAnimationFrame(this.runDisplayPass))}cancelDisplayPass(){0!==this.displayFrame&&(cancelAnimationFrame(this.displayFrame),this.displayFrame=0)}runDisplayPass(t,e=!1){this.setFlags(this.flags&~pn.DisplayMask|pn.DisplayingFlag);try{void 0===t&&(t=performance.now());const i=this.roots;for(let e=0;e<i.length;e+=1){const n=i[e];if(0!=(n.flags&pn.DisplayMask)){const e=n.viewportProvider.viewContext;e.updateTime=t,n.cascadeDisplay(0,e)}}if(this.cancelDisplayPass(),0!=(this.flags&pn.ProcessMask)){let t=this.updateDelay;e&&(t=Math.max(Ui.MaxProcessInterval,t)),this.scheduleProcessPass(t)}else 0!=(this.flags&pn.DisplayMask)&&(this.cancelProcessPass(),this.scheduleDisplayPass())}finally{this.setFlags(this.flags&~pn.DisplayingFlag)}}get powerFlags(){return pn.NeedsResize|pn.NeedsScroll}power(){const t=this.roots;for(let e=0,i=t.length;e<i;e+=1){t[e].requireUpdate(this.powerFlags)}}unpower(){this.cancelUpdate(),this.updateDelay=Ui.MinUpdateDelay}onAttachRoot(t){super.onAttachRoot(t),this.requestUpdate(t,t.flags&pn.UpdateMask,!1)}onAttach(){super.onAttach(),this.attachEvents()}onDetach(){this.detachEvents(),super.onDetach()}attachEvents(){"undefined"!=typeof document&&document.addEventListener("visibilitychange",this.onVisibilityChange)}detachEvents(){"undefined"!=typeof document&&document.removeEventListener("visibilitychange",this.onVisibilityChange)}onVisibilityChange(){"visible"===document.visibilityState?this.power():this.unpower()}static global(){return new Ui}}Ui.MinUpdateDelay=0,Ui.MaxUpdateDelay=167,Ui.MinProcessInterval=12,Ui.MaxProcessInterval=33,u([e.Lazy],Ui,"global",null);const zi=function(t){const e=t.extend("DisplayProvider");return e.prototype.updatedViewContext=function(t){let e=this.service;return null==e&&(e=Ui.global()),e.updatedViewContext(t)},e.prototype.requestUpdate=function(t,e,i){let n=this.service;null==n&&(n=Ui.global()),n.requestUpdate(t,e,i)},e.prototype.createService=function(){return Ui.global()},e}(i.Provider);class qi extends i.Service{constructor(){super(),this.solver=this.createSolver()}createSolver(){return new a.ConstraintSolver}activateConstraint(t){this.solver.addConstraint(t)}deactivateConstraint(t){this.solver.removeConstraint(t)}activateConstraintVariable(t){this.solver.addConstraintVariable(t)}deactivateConstraintVariable(t){this.solver.removeConstraintVariable(t)}setConstraintVariable(t,e){this.solver.setConstraintVariable(t,e)}static global(){return new qi}}u([e.Lazy],qi,"global",null);const Gi=function(t){const e=t.extend("LayoutProvider");return e.prototype.createService=function(){return qi.global()},e}(i.Provider);class Hi extends i.Service{constructor(){super(),this.mood=this.initMood(),this.theme=this.initTheme()}initMood(){return Ot.default}setMood(t){this.mood=t,this.applyTheme(this.theme,t);const e=this.roots;for(let n=0,o=e.length;n<o;n+=1){const o=e[n];o.mood.hasAffinity(i.Affinity.Intrinsic)&&(o.mood.setValue(t,i.Affinity.Intrinsic),o.requireUpdate(pn.NeedsChange))}}initTheme(){return"dark"===Wi.detect().colorScheme?Nt.dark:Nt.light}setTheme(t){this.theme=t,this.applyTheme(t,this.mood);const e=this.roots;for(let n=0,o=e.length;n<o;n+=1){const o=e[n];o.theme.hasAffinity(i.Affinity.Intrinsic)&&(o.theme.setValue(t,i.Affinity.Intrinsic),o.requireUpdate(pn.NeedsChange))}}applyTheme(t,i,n){n=void 0===n||!0===n?t.getOr(St.timing,Ot.ambient,!1):e.Timing.fromAny(n),this.willApplyTheme(t,i,n),this.onApplyTheme(t,i,n),this.didApplyTheme(t,i,n)}willApplyTheme(t,e,i){const n=this.observers;for(let o=0,s=n.length;o<s;o+=1){const s=n[o];void 0!==s.serviceWillApplyTheme&&s.serviceWillApplyTheme(t,e,i,this)}}onApplyTheme(t,e,i){}didApplyTheme(t,e,i){const n=this.observers;for(let o=0,s=n.length;o<s;o+=1){const s=n[o];void 0!==s.serviceDidApplyTheme&&s.serviceDidApplyTheme(t,e,i,this)}}static global(){return new Hi}}u([e.Lazy],Hi,"global",null);const ji=function(t){const e=t.extend("ThemeProvider");return Object.defineProperty(e.prototype,"mood",{get(){let t=this.service;return null==t&&(t=Hi.global()),t.mood},configurable:!0}),e.prototype.setMood=function(t){let e=this.service;null==e&&(e=Hi.global()),e.setMood(t)},Object.defineProperty(e.prototype,"theme",{get(){let t=this.service;return null==t&&(t=Hi.global()),t.theme},configurable:!0}),e.prototype.setTheme=function(t){let e=this.service;null==e&&(e=Hi.global()),e.setTheme(t)},e.prototype.createService=function(){return Hi.global()},e}(i.Provider),Yi=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return"modalView"in e&&"modalState"in e&&"modality"in e&&"function"==typeof e.showModal&&"function"==typeof e.hideModal}return!1}};return t}();class Xi extends i.Service{constructor(){super(),this.modals=e.Arrays.empty,this.modality=0,this.matteView=null,this.onClick=this.onClick.bind(this)}isModal(){return 0!==this.modality}setMatteView(t){this.matteView=t}insertModalView(t){const e=this.matteView;if(null!==e)e.appendChild(t);else{this.constructor.insertModalView(t)}}presentModal(t,i={}){const n=this.modals,o=e.Arrays.inserted(t,n);if(n!==o){i.multi||this.dismissModals(),this.willPresentModal(t,i),this.modals=o;const e=t.modalView;null===e||e.mounted||this.insertModalView(e),t.showModal(i,!0),this.onPresentModal(t,i),this.updateModality(),this.didPresentModal(t,i)}}willPresentModal(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.serviceWillPresentModal&&o.serviceWillPresentModal(t,e,this)}}onPresentModal(t,e){}didPresentModal(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.serviceDidPresentModal&&o.serviceDidPresentModal(t,e,this)}}dismissModal(t){const i=this.modals,n=e.Arrays.removed(t,i);i!==n&&(this.willDismissModal(t),this.modals=n,t.hideModal(!0),this.onDismissModal(t),this.updateModality(),this.didDismissModal(t))}willDismissModal(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceWillDismissModal&&n.serviceWillDismissModal(t,this)}}onDismissModal(t){}didDismissModal(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceDidDismissModal&&n.serviceDidDismissModal(t,this)}}dismissModals(){for(let t=0,e=this.modals.length;t<e;t+=1)this.dismissModal(this.modals[t])}toggleModal(t,e){const i=t.modalState;"hidden"===i||"hiding"===i?this.presentModal(t,e):"shown"!==i&&"showing"!==i||this.dismissModal(t)}updateModality(){const t=this.modality;let e=0;const i=this.modals;for(let t=0,n=i.length;t<n;t+=1){const n=+i[t].modality;e=Math.min(Math.max(e,n),1)}t!==e&&(this.willUpdateModality(e,t),this.modality=e,this.onUpdateModality(e,t),this.didUpdateModality(e,t))}willUpdateModality(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.serviceWillUpdateModality&&o.serviceWillUpdateModality(t,e,this)}}onUpdateModality(t,e){}didUpdateModality(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.serviceDidUpdateModality&&o.serviceDidUpdateModality(t,e,this)}}displaceModals(t){this.willDisplaceModals(t)||(this.onDisplaceModals(t),this.didDisplaceModals(t))}willDisplaceModals(t){let e;const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.serviceWillDisplaceModals&&(e=o.serviceWillDisplaceModals(t,this))}return void 0!==e&&e}onDisplaceModals(t){const e=this.modals;let i=0;for(;i<e.length;){const t=e[i];"shown"===t.modalState?this.dismissModal(t):i+=1}}didDisplaceModals(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceDidDisplaceModals&&n.serviceDidDisplaceModals(t,this)}}onAttachRoot(t){super.onAttachRoot(t),this.attachEvents(t)}onDetachRoot(t){super.onDetachRoot(t),this.detachEvents(t)}attachEvents(t){t.on("click",this.onClick)}detachEvents(t){t.off("click",this.onClick)}onClick(t){this.displaceModals(t)}static insertModalView(t){throw new TypeError(""+t)}static global(){return new Xi}}u([e.Lazy],Xi,"global",null);const Ki=function(t){const e=t.extend("ModalProvider");return e.prototype.presentModal=function(t,e){let i=this.service;null==i&&(i=Xi.global()),i.presentModal(t,e)},e.prototype.dismissModal=function(t){let e=this.service;null==e&&(e=Xi.global()),e.dismissModal(t)},e.prototype.dismissModals=function(){let t=this.service;null==t&&(t=Xi.global()),t.dismissModals()},e.prototype.toggleModal=function(t,e){let i=this.service;null==i&&(i=Xi.global()),i.toggleModal(t,e)},e.prototype.updateModality=function(){let t=this.service;null==t&&(t=Xi.global()),t.updateModality()},e.prototype.displaceModals=function(t){let e=this.service;null==e&&(e=Xi.global()),e.displaceModals(t)},e.prototype.createService=function(){return Xi.global()},e}(i.Provider);class Zi{constructor(t,e,i,n,o,s){this.inputId=t,this.inputType=e,this.isPrimary=i,this.target=null,this.button=0,this.buttons=0,this.altKey=!1,this.ctrlKey=!1,this.metaKey=!1,this.shiftKey=!1,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.twist=0,this.pressure=0,this.tangentialPressure=0,this.x0=n,this.y0=o,this.t0=s,this.dx=0,this.dy=0,this.dt=0,this.x=n,this.y=o,this.t=s,this.detail=void 0,this.defaultPrevented=!1}preventDefault(){this.defaultPrevented=!0}static pointerInputType(t){return"mouse"===t||"touch"===t||"pen"===t?t:"unknown"}}const _i=function(t){const e=t.extend("Gesture");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.getView=function(){const t=this.view;if(null===t)throw new TypeError("null "+this.name+" view");return t},e.prototype.setView=function(t,e){const i=this.view;return i!==t&&(null!==i&&(this.willDetachView(i),this.view=null,this.onDetachView(i),this.didDetachView(i)),null!==t&&(void 0===e&&(e=null),this.willAttachView(t,e),this.view=t,this.onAttachView(t,e),this.didAttachView(t,e))),i},e.prototype.willAttachView=function(t,e){},e.prototype.onAttachView=function(t,e){this.attachEvents(t),!0===this.observes&&t.observe(this)},e.prototype.didAttachView=function(t,e){},e.prototype.willDetachView=function(t){},e.prototype.onDetachView=function(t){this.clearInputs(),!0===this.observes&&t.unobserve(this),this.detachEvents(t)},e.prototype.didDetachView=function(t){},e.prototype.attachEvents=function(t){},e.prototype.detachEvents=function(t){},e.prototype.getInput=function(t){"number"==typeof t&&(t=""+t);const e=this.inputs[t];return void 0!==e?e:null},e.prototype.createInput=function(t,e,i,n,o,s){return new Zi(t,e,i,n,o,s)},e.prototype.getOrCreateInput=function(t,e,i,n,o,s){"number"==typeof t&&(t=""+t);const r=this.inputs;let l=r[t];return void 0===l&&(l=this.createInput(t,e,i,n,o,s),r[t]=l,this.inputCount+=1),l},e.prototype.clearInput=function(t){delete this.inputs[t.inputId],this.inputCount-=1},e.prototype.clearInputs=function(){this.inputs={},this.inputCount=0},e.prototype.bindView=function(t,e){if(this.binds&&null===this.view){const i=this.detectView(t);null!==i&&this.setView(i,e)}},e.prototype.unbindView=function(t){this.binds&&this.view===t&&this.setView(null)},e.prototype.detectView=function(t){return void 0!==this.key&&this.key===t.key?t:null},e.prototype.viewWillUnmount=function(t){this.clearInputs()},e.prototype.onMount=function(){t.prototype.onMount.call(this),!0===this.self&&this.owner instanceof pn&&this.setView(this.owner)},Object.defineProperty(e.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!0},configurable:!0}),e.construct=function(e,i,n){return null===i&&(delete(i=function(t,e){return void 0===t?i.view:(i.setView(t,e),i.owner)}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).view=null,i.inputs={},i.inputCount=0,i},e.specialize=function(t){return null},e.define=function(t,i){let n=i.extends;const o=i.affinity,s=i.inherits;let r=i.method;delete i.extends,delete i.implements,delete i.affinity,delete i.inherits,delete i.method,!0===i.key?Object.defineProperty(i,"key",{value:t,configurable:!0}):!1===i.key&&Object.defineProperty(i,"key",{value:void 0,configurable:!0}),void 0===r&&(r="auto"),null==n&&(n=e.specialize(r)),null===n&&(n=this);const l=n.extend(t,i);return l.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==o&&e.initAffinity(o),void 0!==s&&e.initInherits(s),e},l},e}(i.Fastener);class Qi extends Zi{constructor(t,e,i,n,o,s){super(t,e,i,n,o,s),this.hovering=!1,this.pressing=!1,this.holdTimer=0,this.holdDelay=400}isRunaway(){const t=this.x-this.x0,e=this.y-this.y0,i=this.t-this.t0;return"mouse"!==this.inputType&&i<100&&t*t+e*e>100}setHoldTimer(t){0!==this.holdDelay&&(this.clearHoldTimer(),this.holdTimer=setTimeout(t,this.holdDelay))}clearHoldTimer(){0!==this.holdTimer&&(clearTimeout(this.holdTimer),this.holdTimer=0)}}const Ji=function(t){const e=t.extend("PositionGesture");return e.prototype.attachEvents=function(t){_i.prototype.attachEvents.call(this,t),this.attachHoverEvents(t)},e.prototype.detachEvents=function(t){this.detachPressEvents(t),this.detachHoverEvents(t),_i.prototype.detachEvents.call(this,t)},e.prototype.attachHoverEvents=function(t){},e.prototype.detachHoverEvents=function(t){},e.prototype.attachPressEvents=function(t){},e.prototype.detachPressEvents=function(t){},e.prototype.createInput=function(t,e,i,n,o,s){return new Qi(t,e,i,n,o,s)},e.prototype.clearInput=function(t){t.hovering||t.pressing||_i.prototype.clearInput.call(this,t)},e.prototype.clearInputs=function(){_i.prototype.clearInputs.call(this),this.hoverCount=0,this.pressCount=0},Object.defineProperty(e.prototype,"hovering",{get(){return 0!==this.hoverCount},configurable:!0}),e.prototype.startHovering=function(){this.willStartHovering(),this.onStartHovering(),this.didStartHovering()},e.prototype.willStartHovering=function(){},e.prototype.onStartHovering=function(){},e.prototype.didStartHovering=function(){},e.prototype.stopHovering=function(){this.willStopHovering(),this.onStopHovering(),this.didStopHovering()},e.prototype.willStopHovering=function(){},e.prototype.onStopHovering=function(){},e.prototype.didStopHovering=function(){},e.prototype.beginHover=function(t,e){t.hovering||(this.willBeginHover(t,e),t.hovering=!0,this.hoverCount+=1,this.onBeginHover(t,e),this.didBeginHover(t,e),1===this.hoverCount&&this.startHovering())},e.prototype.willBeginHover=function(t,e){},e.prototype.onBeginHover=function(t,e){},e.prototype.didBeginHover=function(t,e){},e.prototype.endHover=function(t,e){t.hovering&&(this.willEndHover(t,e),t.hovering=!1,this.hoverCount-=1,this.onEndHover(t,e),this.didEndHover(t,e),0===this.hoverCount&&this.stopHovering(),this.clearInput(t))},e.prototype.willEndHover=function(t,e){},e.prototype.onEndHover=function(t,e){},e.prototype.didEndHover=function(t,e){},Object.defineProperty(e.prototype,"pressing",{get(){return 0!==this.pressCount},configurable:!0}),e.prototype.startPressing=function(){this.willStartPressing(),this.onStartPressing(),this.didStartPressing()},e.prototype.willStartPressing=function(){},e.prototype.onStartPressing=function(){this.attachPressEvents(this.view)},e.prototype.didStartPressing=function(){},e.prototype.stopPressing=function(){this.willStopPressing(),this.onStopPressing(),this.didStopPressing()},e.prototype.willStopPressing=function(){},e.prototype.onStopPressing=function(){this.detachPressEvents(this.view)},e.prototype.didStopPressing=function(){},e.prototype.beginPress=function(t,e){if(!t.pressing){let i=this.willBeginPress(t,e);void 0===i&&(i=!0),i&&(t.pressing=!0,t.defaultPrevented=!1,this.pressCount+=1,this.onBeginPress(t,e),t.setHoldTimer(this.longPress.bind(this,t)),this.didBeginPress(t,e),1===this.pressCount&&this.startPressing())}},e.prototype.willBeginPress=function(t,e){},e.prototype.onBeginPress=function(t,e){t.x0=t.x,t.y0=t.y,t.t0=t.t,t.dx=0,t.dy=0,t.dt=0},e.prototype.didBeginPress=function(t,e){},e.prototype.movePress=function(t,e){t.pressing&&(this.willMovePress(t,e),this.onMovePress(t,e),this.didMovePress(t,e))},e.prototype.willMovePress=function(t,e){},e.prototype.onMovePress=function(t,e){},e.prototype.didMovePress=function(t,e){},e.prototype.endPress=function(t,e){t.clearHoldTimer(),t.pressing&&(this.willEndPress(t,e),t.pressing=!1,this.pressCount-=1,this.onEndPress(t,e),this.didEndPress(t,e),0===this.pressCount&&this.stopPressing(),this.clearInput(t))},e.prototype.willEndPress=function(t,e){},e.prototype.onEndPress=function(t,e){},e.prototype.didEndPress=function(t,e){},e.prototype.cancelPress=function(t,e){t.clearHoldTimer(),t.pressing&&(this.willCancelPress(t,e),t.pressing=!1,this.pressCount-=1,this.onCancelPress(t,e),this.didCancelPress(t,e),0===this.pressCount&&this.stopPressing(),this.clearInput(t))},e.prototype.willCancelPress=function(t,e){},e.prototype.onCancelPress=function(t,e){},e.prototype.didCancelPress=function(t,e){},e.prototype.press=function(t,e){this.willPress(t,e),this.onPress(t,e),this.didPress(t,e)},e.prototype.willPress=function(t,e){},e.prototype.onPress=function(t,e){},e.prototype.didPress=function(t,e){},e.prototype.longPress=function(t){t.clearHoldTimer();performance.now()-t.t0<1.5*t.holdDelay&&t.pressing&&(this.willLongPress(t),this.onLongPress(t),this.didLongPress(t))},e.prototype.willLongPress=function(t){},e.prototype.onLongPress=function(t){const e=performance.now();t.dt=e-t.t,t.t=e},e.prototype.didLongPress=function(t){},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).hoverCount=0,i.pressCount=0,i},e.specialize=function(t){return"pointer"===t?$i:"touch"===t?tn:"mouse"===t?en:"undefined"!=typeof PointerEvent?$i:"undefined"!=typeof TouchEvent?tn:en},e.define=function(t,i){let n=i.extends;const o=i.affinity,s=i.inherits;let r=i.method;delete i.extends,delete i.implements,delete i.affinity,delete i.inherits,delete i.method,!0===i.key?Object.defineProperty(i,"key",{value:t,configurable:!0}):!1===i.key&&Object.defineProperty(i,"key",{value:void 0,configurable:!0}),void 0===r&&(r="auto"),null==n&&(n=e.specialize(r)),null===n&&(n=this);const l=n.extend(t,i);return l.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==o&&e.initAffinity(o),void 0!==s&&e.initInherits(s),e},l},e}(_i),$i=function(t){const e=t.extend("PointerPositionGesture");return e.prototype.attachHoverEvents=function(t){t.on("pointerenter",this.onPointerEnter),t.on("pointerleave",this.onPointerLeave),t.on("pointerdown",this.onPointerDown)},e.prototype.detachHoverEvents=function(t){t.off("pointerenter",this.onPointerEnter),t.off("pointerleave",this.onPointerLeave),t.off("pointerdown",this.onPointerDown)},e.prototype.attachPressEvents=function(t){document.body.addEventListener("pointermove",this.onPointerMove),document.body.addEventListener("pointerup",this.onPointerUp),document.body.addEventListener("pointercancel",this.onPointerCancel),document.body.addEventListener("pointerleave",this.onPointerLeaveDocument)},e.prototype.detachPressEvents=function(t){document.body.removeEventListener("pointermove",this.onPointerMove),document.body.removeEventListener("pointerup",this.onPointerUp),document.body.removeEventListener("pointercancel",this.onPointerCancel),document.body.removeEventListener("pointerleave",this.onPointerLeaveDocument)},e.prototype.updateInput=function(t,e){t.target=e.target,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=e.clientX-t.x,t.dy=e.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=e.clientX,t.y=e.clientY,t.t=e.timeStamp,t.width=e.width,t.height=e.height,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure},e.prototype.onPointerEnter=function(t){if("mouse"===t.pointerType&&0===t.buttons){const e=this.getOrCreateInput(t.pointerId,Zi.pointerInputType(t.pointerType),t.isPrimary,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.hovering||this.beginHover(e,t)}},e.prototype.onPointerLeave=function(t){if("mouse"===t.pointerType){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.endHover(e,t))}},e.prototype.onPointerDown=function(t){const e=this.getOrCreateInput(t.pointerId,Zi.pointerInputType(t.pointerType),t.isPrimary,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.pressing||this.beginPress(e,t),"mouse"===t.pointerType&&0!==t.button&&this.cancelPress(e,t)},e.prototype.onPointerMove=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.movePress(e,t))},e.prototype.onPointerUp=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.endPress(e,t),e.defaultPrevented||0!==t.button||this.press(e,t))},e.prototype.onPointerCancel=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.cancelPress(e,t))},e.prototype.onPointerLeaveDocument=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.cancelPress(e,t),this.endHover(e,t))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onPointerEnter=i.onPointerEnter.bind(i),i.onPointerLeave=i.onPointerLeave.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i.onPointerMove=i.onPointerMove.bind(i),i.onPointerUp=i.onPointerUp.bind(i),i.onPointerCancel=i.onPointerCancel.bind(i),i.onPointerLeaveDocument=i.onPointerLeaveDocument.bind(i),i},e}(Ji),tn=function(t){const e=t.extend("TouchPositionGesture");return e.prototype.attachHoverEvents=function(t){t.on("touchstart",this.onTouchStart)},e.prototype.detachHoverEvents=function(t){t.off("touchstart",this.onTouchStart)},e.prototype.attachPressEvents=function(t){t.on("touchmove",this.onTouchMove),t.on("touchend",this.onTouchEnd),t.on("touchcancel",this.onTouchCancel)},e.prototype.detachPressEvents=function(t){t.off("touchmove",this.onTouchMove),t.off("touchend",this.onTouchEnd),t.off("touchcancel",this.onTouchCancel)},e.prototype.updateInput=function(t,e,i){t.target=i.target,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=i.clientX-t.x,t.dy=i.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=i.clientX,t.y=i.clientY,t.t=e.timeStamp},e.prototype.onTouchStart=function(t){const e=t.targetTouches;for(let i=0;i<e.length;i+=1){const n=e[i],o=this.getOrCreateInput(n.identifier,"touch",!1,n.clientX,n.clientY,t.timeStamp);this.updateInput(o,t,n),o.pressing||this.beginPress(o,t)}},e.prototype.onTouchMove=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],o=this.getInput(n.identifier);null!==o&&(this.updateInput(o,t,n),this.movePress(o,t))}},e.prototype.onTouchEnd=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],o=this.getInput(n.identifier);null!==o&&(this.updateInput(o,t,n),this.endPress(o,t),o.defaultPrevented||this.press(o,t),this.endHover(o,t))}},e.prototype.onTouchCancel=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],o=this.getInput(n.identifier);null!==o&&(this.updateInput(o,t,n),this.cancelPress(o,t),this.endHover(o,t))}},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onTouchStart=i.onTouchStart.bind(i),i.onTouchMove=i.onTouchMove.bind(i),i.onTouchEnd=i.onTouchEnd.bind(i),i.onTouchCancel=i.onTouchCancel.bind(i),i},e}(Ji),en=function(t){const e=t.extend("MousePositionGesture");return e.prototype.attachHoverEvents=function(t){t.on("mouseenter",this.onMouseEnter),t.on("mouseleave",this.onMouseLeave),t.on("mousedown",this.onMouseDown)},e.prototype.detachHoverEvents=function(t){t.off("mouseenter",this.onMouseEnter),t.off("mouseleave",this.onMouseLeave),t.off("mousedown",this.onMouseDown)},e.prototype.attachPressEvents=function(t){document.body.addEventListener("mousemove",this.onMouseMove),document.body.addEventListener("mouseup",this.onMouseUp),document.body.addEventListener("mouseleave",this.onMouseLeaveDocument)},e.prototype.detachPressEvents=function(t){document.body.removeEventListener("mousemove",this.onMouseMove),document.body.removeEventListener("mouseup",this.onMouseUp),document.body.removeEventListener("mouseleave",this.onMouseLeaveDocument)},e.prototype.updateInput=function(t,e){t.target=e.target,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=e.clientX-t.x,t.dy=e.clientY-t.y,t.dt=e.timeStamp-t.y,t.x=e.clientX,t.y=e.clientY,t.t=e.timeStamp},e.prototype.onMouseEnter=function(t){if(0===t.buttons){const e=this.getOrCreateInput("mouse","mouse",!0,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.hovering||this.beginHover(e,t)}},e.prototype.onMouseLeave=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.endHover(e,t))},e.prototype.onMouseDown=function(t){const e=this.getOrCreateInput("mouse","mouse",!0,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.pressing||this.beginPress(e,t),0!==t.button&&this.cancelPress(e,t)},e.prototype.onMouseMove=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.movePress(e,t))},e.prototype.onMouseUp=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.endPress(e,t),e.defaultPrevented||0!==t.button||this.press(e,t))},e.prototype.onMouseLeaveDocument=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.cancelPress(e,t),this.endHover(e,t))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onMouseEnter=i.onMouseEnter.bind(i),i.onMouseLeave=i.onMouseLeave.bind(i),i.onMouseDown=i.onMouseDown.bind(i),i.onMouseMove=i.onMouseMove.bind(i),i.onMouseUp=i.onMouseUp.bind(i),i.onMouseLeaveDocument=i.onMouseLeaveDocument.bind(i),i},e}(Ji);class nn extends Qi{constructor(t,e,i,n,o,s){super(t,e,i,n,o,s),this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.path=[],this.coasting=!1}updatePosition(t){const e=this.path,i=this.x,n=this.y,o=this.t;for(e.push({x:i,y:n,t:o});e.length>1&&o-e[0].t>t;)e.shift()}deriveVelocity(t){const e=this.path[0],i=this.path[this.path.length-1];if(void 0!==i&&i!==e){const n=i.t-e.t;let o,s;if(0!==n){o=(i.x-e.x)/n,s=(i.y-e.y)/n;const r=o*o+s*s;if(t*t<r){const e=Math.sqrt(r);o=o*t/e,s=s*t/e}}else o=0,s=0;this.vx=o,this.vy=s}else void 0!==e&&(this.vx=0,this.vy=0)}integrateVelocity(t){const e=t-this.t;if(0!==e){let i,n=this.vx+this.ax*e;n<0==this.vx<0?i=this.x+this.vx*e+this.ax*e*e*.5:(i=this.x-this.vx*this.vx/(2*this.ax),n=0,this.ax=0);let o,s=this.vy+this.ay*e;s<0==this.vy<0?o=this.y+this.vy*e+this.ay*e*e*.5:(o=this.y-this.vy*this.vy/(2*this.ay),s=0,this.ay=0),this.dx=i-this.x,this.dy=o-this.y,this.dt=e,this.x=i,this.y=o,this.t=t,this.vx=n,this.vy=s}}}const on=function(t){const e=t.extend("MomentumGesture");return Object.defineProperty(e.prototype,"observes",{value:!0,enumerable:!0,configurable:!0}),e.prototype.createInput=function(t,e,i,n,o,s){return new nn(t,e,i,n,o,s)},e.prototype.clearInput=function(t){t.coasting||Ji.prototype.clearInput.call(this,t)},e.prototype.clearInputs=function(){Ji.prototype.clearInputs.call(this),this.coastCount=0},e.prototype.viewWillAnimate=function(t){this.doCoast(t.updateTime)},e.prototype.interrupt=function(t){const e=this.inputs;for(const i in e){const n=e[i];this.endCoast(n,t)}},e.prototype.cancel=function(t){const e=this.inputs;for(const i in e){const n=e[i];this.endPress(n,t),this.endCoast(n,t)}},e.prototype.startInteracting=function(){this.willStartInteracting(),this.onStartInteracting(),this.didStartInteracting()},e.prototype.willStartInteracting=function(){},e.prototype.onStartInteracting=function(){},e.prototype.didStartInteracting=function(){},e.prototype.stopInteracting=function(){this.willStopInteracting(),this.onStopInteracting(),this.didStopInteracting()},e.prototype.willStopInteracting=function(){},e.prototype.onStopInteracting=function(){},e.prototype.didStopInteracting=function(){},e.prototype.onStartPressing=function(){Ji.prototype.onStartPressing.call(this),0===this.coastCount&&this.startInteracting()},e.prototype.onStopPressing=function(){Ji.prototype.onStopPressing.call(this),0===this.coastCount&&this.stopInteracting()},e.prototype.beginPress=function(t,e){Ji.prototype.beginPress.call(this,t,e),this.interrupt(e)},e.prototype.onBeginPress=function(t,e){Ji.prototype.onBeginPress.call(this,t,e),t.updatePosition(this.hysteresis),t.deriveVelocity(this.velocityMax)},e.prototype.onMovePress=function(t,e){Ji.prototype.onMovePress.call(this,t,e),t.updatePosition(this.hysteresis),t.deriveVelocity(this.velocityMax)},e.prototype.willEndPress=function(t,e){Ji.prototype.willEndPress.call(this,t,e),this.beginCoast(t,e)},e.prototype.onEndPress=function(t,e){Ji.prototype.onEndPress.call(this,t,e),t.updatePosition(this.hysteresis),t.deriveVelocity(this.velocityMax)},e.prototype.onCancelPress=function(t,e){Ji.prototype.onCancelPress.call(this,t,e),t.updatePosition(this.hysteresis),t.deriveVelocity(this.velocityMax)},Object.defineProperty(e.prototype,"coasting",{get(){return 0!==this.coastCount},configurable:!0}),e.prototype.startCoasting=function(){this.willStartCoasting(),this.onStartCoasting(),this.didStartCoasting()},e.prototype.willStartCoasting=function(){},e.prototype.onStartCoasting=function(){0===this.pressCount&&this.startInteracting(),null!==this.view&&this.view.requireUpdate(pn.NeedsAnimate)},e.prototype.didStartCoasting=function(){},e.prototype.stopCoasting=function(){this.willStopCoasting(),this.onStopCoasting(),this.didStopCoasting()},e.prototype.willStopCoasting=function(){},e.prototype.onStopCoasting=function(){0===this.pressCount&&this.stopInteracting()},e.prototype.didStopCoasting=function(){},e.prototype.beginCoast=function(t,e){if(!t.coasting&&(0!==t.vx||0!==t.vy)){const i=Math.atan2(Math.abs(t.vy),Math.abs(t.vx)),n=this.acceleration,o=(t.vx<0?n:t.vx>0?-n:0)*Math.cos(i),s=(t.vy<0?n:t.vy>0?-n:0)*Math.sin(i);if(0!==o||0!==s){t.ax=o,t.ay=s;let i=this.willBeginCoast(t,e);void 0===i&&(i=!0),i&&(t.coasting=!0,this.coastCount+=1,this.onBeginCoast(t,e),this.didBeginCoast(t,e),1===this.coastCount&&this.startCoasting())}}},e.prototype.willBeginCoast=function(t,e){},e.prototype.onBeginCoast=function(t,e){t.x0=t.x,t.y0=t.y,t.t0=t.t,t.dx=0,t.dy=0,t.dt=0},e.prototype.didBeginCoast=function(t,e){},e.prototype.endCoast=function(t,e){t.coasting&&(this.willEndCoast(t,e),t.coasting=!1,this.coastCount-=1,this.onEndCoast(t,e),this.didEndCoast(t,e),0===this.coastCount&&this.stopCoasting(),this.clearInput(t))},e.prototype.willEndCoast=function(t,e){},e.prototype.onEndCoast=function(t,e){},e.prototype.didEndCoast=function(t,e){},e.prototype.doCoast=function(t){if(0!==this.coastCount){this.willCoast(),this.integrate(t),this.onCoast();const e=this.inputs;for(const t in e){const i=e[t];i.coasting&&0===i.ax&&0===i.ay&&this.endCoast(i,null)}this.didCoast(),0!==this.coastCount&&null!==this.view&&this.view.requireUpdate(pn.NeedsAnimate)}},e.prototype.willCoast=function(){},e.prototype.onCoast=function(){},e.prototype.didCoast=function(){},e.prototype.integrate=function(t){const e=this.inputs;for(const i in e){const n=e[i];n.coasting&&n.integrateVelocity(t)}},e.construct=function(i,n,o){return(n=t.construct(i,n,o)).coastCount=0,n.hysteresis=e.Hysteresis,n.acceleration=e.Acceleration,n.velocityMax=e.VelocityMax,n},e.specialize=function(t){return"pointer"===t?sn:"touch"===t?rn:"mouse"===t?ln:"undefined"!=typeof PointerEvent?sn:"undefined"!=typeof TouchEvent?rn:ln},e.define=function(t,i){let n=i.extends;const o=i.affinity,s=i.inherits;let r=i.method;const l=i.hysteresis,a=i.hysteresis,h=i.hysteresis;delete i.extends,delete i.implements,delete i.affinity,delete i.inherits,delete i.method,delete i.hysteresis,delete i.acceleration,delete i.velocityMax,!0===i.key?Object.defineProperty(i,"key",{value:t,configurable:!0}):!1===i.key&&Object.defineProperty(i,"key",{value:void 0,configurable:!0}),void 0===r&&(r="auto"),null==n&&(n=e.specialize(r)),null===n&&(n=this);const c=n.extend(t,i);return c.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==o&&e.initAffinity(o),void 0!==s&&e.initInherits(s),void 0!==l&&(e.hysteresis=l),void 0!==a&&(e.acceleration=a),void 0!==h&&(e.velocityMax=h),e},c},e.Hysteresis=67,e.Acceleration=.00175,e.VelocityMax=1.75,e}(Ji),sn=function(t){const e=t.extend("PointerMomentumGesture");return e.prototype.attachHoverEvents=function(t){t.on("pointerenter",this.onPointerEnter),t.on("pointerleave",this.onPointerLeave),t.on("pointerdown",this.onPointerDown)},e.prototype.detachHoverEvents=function(t){t.off("pointerenter",this.onPointerEnter),t.off("pointerleave",this.onPointerLeave),t.off("pointerdown",this.onPointerDown)},e.prototype.attachPressEvents=function(t){document.body.addEventListener("pointermove",this.onPointerMove),document.body.addEventListener("pointerup",this.onPointerUp),document.body.addEventListener("pointercancel",this.onPointerCancel),document.body.addEventListener("pointerleave",this.onPointerLeaveDocument)},e.prototype.detachPressEvents=function(t){document.body.removeEventListener("pointermove",this.onPointerMove),document.body.removeEventListener("pointerup",this.onPointerUp),document.body.removeEventListener("pointercancel",this.onPointerCancel),document.body.removeEventListener("pointerleave",this.onPointerLeaveDocument)},e.prototype.updateInput=function(t,e){t.target=e.target,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=e.clientX-t.x,t.dy=e.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=e.clientX,t.y=e.clientY,t.t=e.timeStamp,t.width=e.width,t.height=e.height,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure},e.prototype.onPointerEnter=function(t){if("mouse"===t.pointerType&&0===t.buttons){const e=this.getOrCreateInput(t.pointerId,Zi.pointerInputType(t.pointerType),t.isPrimary,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.hovering||this.beginHover(e,t)}},e.prototype.onPointerLeave=function(t){if("mouse"===t.pointerType){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.endHover(e,t))}},e.prototype.onPointerDown=function(t){const e=this.getOrCreateInput(t.pointerId,Zi.pointerInputType(t.pointerType),t.isPrimary,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.pressing||this.beginPress(e,t),"mouse"===t.pointerType&&0!==t.button&&this.cancelPress(e,t)},e.prototype.onPointerMove=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.movePress(e,t))},e.prototype.onPointerUp=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.endPress(e,t),e.defaultPrevented||0!==t.button||this.press(e,t))},e.prototype.onPointerCancel=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.cancelPress(e,t))},e.prototype.onPointerLeaveDocument=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.cancelPress(e,t),this.endHover(e,t))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onPointerEnter=i.onPointerEnter.bind(i),i.onPointerLeave=i.onPointerLeave.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i.onPointerMove=i.onPointerMove.bind(i),i.onPointerUp=i.onPointerUp.bind(i),i.onPointerCancel=i.onPointerCancel.bind(i),i.onPointerLeaveDocument=i.onPointerLeaveDocument.bind(i),i},e}(on),rn=function(t){const e=t.extend("TouchMomentumGesture");return e.prototype.attachHoverEvents=function(t){t.on("touchstart",this.onTouchStart)},e.prototype.detachHoverEvents=function(t){t.off("touchstart",this.onTouchStart)},e.prototype.attachPressEvents=function(t){t.on("touchmove",this.onTouchMove),t.on("touchend",this.onTouchEnd),t.on("touchcancel",this.onTouchCancel)},e.prototype.detachPressEvents=function(t){t.off("touchmove",this.onTouchMove),t.off("touchend",this.onTouchEnd),t.off("touchcancel",this.onTouchCancel)},e.prototype.updateInput=function(t,e,i){t.target=i.target,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=i.clientX-t.x,t.dy=i.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=i.clientX,t.y=i.clientY,t.t=e.timeStamp},e.prototype.onTouchStart=function(t){const e=t.targetTouches;for(let i=0;i<e.length;i+=1){const n=e[i],o=this.getOrCreateInput(n.identifier,"touch",!1,n.clientX,n.clientY,t.timeStamp);this.updateInput(o,t,n),o.pressing||this.beginPress(o,t)}},e.prototype.onTouchMove=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],o=this.getInput(n.identifier);null!==o&&(this.updateInput(o,t,n),this.movePress(o,t))}},e.prototype.onTouchEnd=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],o=this.getInput(n.identifier);null!==o&&(this.updateInput(o,t,n),this.endPress(o,t),o.defaultPrevented||this.press(o,t),this.endHover(o,t))}},e.prototype.onTouchCancel=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],o=this.getInput(n.identifier);null!==o&&(this.updateInput(o,t,n),this.cancelPress(o,t),this.endHover(o,t))}},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onTouchStart=i.onTouchStart.bind(i),i.onTouchMove=i.onTouchMove.bind(i),i.onTouchEnd=i.onTouchEnd.bind(i),i.onTouchCancel=i.onTouchCancel.bind(i),i},e}(on),ln=function(t){const e=t.extend("MouseMomentumGesture");return e.prototype.attachHoverEvents=function(t){t.on("mouseenter",this.onMouseEnter),t.on("mouseleave",this.onMouseLeave),t.on("mousedown",this.onMouseDown)},e.prototype.detachHoverEvents=function(t){t.off("mouseenter",this.onMouseEnter),t.off("mouseleave",this.onMouseLeave),t.off("mousedown",this.onMouseDown)},e.prototype.attachPressEvents=function(t){document.body.addEventListener("mousemove",this.onMouseMove),document.body.addEventListener("mouseup",this.onMouseUp),document.body.addEventListener("mouseleave",this.onMouseLeaveDocument)},e.prototype.detachPressEvents=function(t){document.body.removeEventListener("mousemove",this.onMouseMove),document.body.removeEventListener("mouseup",this.onMouseUp),document.body.removeEventListener("mouseleave",this.onMouseLeaveDocument)},e.prototype.updateInput=function(t,e){t.target=e.target,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=e.clientX-t.x,t.dy=e.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=e.clientX,t.y=e.clientY,t.t=e.timeStamp},e.prototype.onMouseEnter=function(t){if(0===t.buttons){const e=this.getOrCreateInput("mouse","mouse",!0,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.hovering||this.beginHover(e,t)}},e.prototype.onMouseLeave=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.endHover(e,t))},e.prototype.onMouseDown=function(t){const e=this.getOrCreateInput("mouse","mouse",!0,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.pressing||this.beginPress(e,t),0!==t.button&&this.cancelPress(e,t)},e.prototype.onMouseMove=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.movePress(e,t))},e.prototype.onMouseUp=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.endPress(e,t),e.defaultPrevented||0!==t.button||this.press(e,t))},e.prototype.onMouseLeaveDocument=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.cancelPress(e,t),this.endHover(e,t))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onMouseEnter=i.onMouseEnter.bind(i),i.onMouseLeave=i.onMouseLeave.bind(i),i.onMouseDown=i.onMouseDown.bind(i),i.onMouseMove=i.onMouseMove.bind(i),i.onMouseUp=i.onMouseUp.bind(i),i.onMouseLeaveDocument=i.onMouseLeaveDocument.bind(i),i},e}(on);class an extends nn{constructor(t,e,i,n,o,s){super(t,e,i,n,o,s),this.xCoord=void 0,this.yCoord=void 0,this.disableX=!1,this.disableY=!1}}const hn=function(t){const e=t.extend("ScaleGesture");return e.prototype.createInput=function(t,e,i,n,o,s){return new an(t,e,i,n,o,s)},e.prototype.clearInputs=function(){on.prototype.clearInputs.call(this),this.setFlags(this.flags&~e.NeedsRescale)},Object.defineProperty(e.prototype,"preserveAspectRatio",{get(){return 0!=(this.flags&e.PreserveAspectRatioFlag)},set(t){t?this.setFlags(this.flags|e.PreserveAspectRatioFlag):this.setFlags(this.flags&~e.PreserveAspectRatioFlag)},configurable:!0}),Object.defineProperty(e.prototype,"wheel",{get(){return 0!=(this.flags&e.WheelFlag)},set(t){t?this.setFlags(this.flags|e.WheelFlag):this.setFlags(this.flags&~e.WheelFlag)},configurable:!0}),e.prototype.getXScale=function(){return null},e.prototype.setXScale=function(t,e){},e.prototype.getYScale=function(){return null},e.prototype.setYScale=function(t,e){},e.prototype.clientToRangeX=function(t,e,i){const n=t-i.xMin,o=e.range;return o[0]<=o[1]?o[0]+n:i.xMax+n-o[0]},e.prototype.clientToRangeY=function(t,e,i){const n=t-i.yMin,o=e.range;return o[0]<=o[1]?o[0]+n:i.yMax+n-o[0]},e.prototype.unscaleX=function(t,e,i){return e.inverse(this.clientToRangeX(t,e,i))},e.prototype.unscaleY=function(t,e,i){return e.inverse(this.clientToRangeY(t,e,i))},e.prototype.viewWillAnimate=function(t){on.prototype.viewWillAnimate.call(this,t),0!=(this.flags&e.NeedsRescale)&&this.rescale()},e.prototype.onBeginPress=function(t,i){on.prototype.onBeginPress.call(this,t,i),this.updateInputDomain(t),this.view.requireUpdate(pn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.onMovePress=function(t,i){on.prototype.onMovePress.call(this,t,i),this.view.requireUpdate(pn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.onEndPress=function(t,i){on.prototype.onEndPress.call(this,t,i),this.updateInputDomain(t),this.view.requireUpdate(pn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.onCancelPress=function(t,i){on.prototype.onCancelPress.call(this,t,i),this.updateInputDomain(t),this.view.requireUpdate(pn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.beginCoast=function(t,e){this.coastCount<2&&on.prototype.beginCoast.call(this,t,e)},e.prototype.onBeginCoast=function(t,i){on.prototype.onBeginCoast.call(this,t,i),this.updateInputDomain(t),this.conserveMomentum(t),this.view.requireUpdate(pn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.onEndCoast=function(t,i){on.prototype.onEndCoast.call(this,t,i),t.disableX=!1,t.disableY=!1,this.view.requireUpdate(pn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.onCoast=function(){on.prototype.onCoast.call(this),this.view.requireUpdate(pn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.updateInputDomain=function(t,e,i,n){void 0===e&&(e=this.getXScale()),null!==e&&(void 0===n&&(n=this.view.clientBounds),t.xCoord=this.unscaleX(t.x0,e,n)),void 0===i&&(i=this.getYScale()),null!==i&&(void 0===n&&(n=this.view.clientBounds),t.yCoord=this.unscaleY(t.y0,i,n))},e.prototype.neutralizeX=function(){const t=this.inputs;for(const e in t){const i=t[e];i.coasting&&(i.disableX=!0,i.vx=0,i.ax=0)}},e.prototype.neutralizeY=function(){const t=this.inputs;for(const e in t){const i=t[e];i.coasting&&(i.disableY=!0,i.vy=0,i.ay=0)}},e.prototype.rescale=function(){let t,i;const n=this.inputs;for(const e in n){const o=n[e];(o.pressing||o.coasting)&&(void 0===t?t=o:void 0===i?i=o:o.t0<t.t0?t=o:o.t0<i.t0&&(i=o))}if(void 0!==t){const e=this.view.clientBounds,n=this.getXScale(),o=this.getYScale();null!==n&&null!==o?void 0!==i&&this.preserveAspectRatio?this.rescaleRadial(n,o,t,i,e):this.rescaleXY(n,o,t,i,e):null!==n?this.rescaleX(n,t,i,e):null!==o&&this.rescaleY(o,t,i,e)}this.setFlags(this.flags&~e.NeedsRescale)},e.prototype.rescaleRadial=function(t,e,i,n,o){const s=i.xCoord,r=i.yCoord,l=this.clientToRangeX(i.x0,t,o),a=this.clientToRangeY(i.y0,e,o),h=this.clientToRangeX(i.x,t,o),c=this.clientToRangeY(i.y,e,o),d=i.vx,u=i.vy,p=i.ax,f=i.ay,g=n.xCoord,v=n.yCoord,w=this.clientToRangeX(n.x0,t,o),y=this.clientToRangeY(n.y0,e,o),m=this.clientToRangeX(n.x,t,o),b=this.clientToRangeY(n.y,e,o),C=n.vx,S=n.vy,A=n.ax,x=n.ay,T=w-l,D=y-a,V=Math.max(this.distanceMin,Math.sqrt(T*T+D*D)),P=T/V,I=D/V,M=h-l,L=c-a,k=m-w,F=b-y,R=M*P+L*I,O=k*P+F*I,W=M*I+L*-P,E=k*I+F*-P,N=(W*I+E*I)/2,B=(W*-P+E*-P)/2,U=l+R*P+N,z=a+R*I+B,q=w+O*P+N,G=y+O*I+B,H=d*P+u*I,j=C*P+S*I,Y=d*I+u*-P,X=C*I+S*-P,K=(Y*I+X*I)/2,Z=(Y*-P+X*-P)/2;let _=H*P+K,Q=H*I+Z,J=j*P+K,$=j*I+Z;const tt=Math.sqrt(_*_+Q*Q),et=Math.sqrt(J*J+$*$),it=0!==tt?_/tt:0,nt=0!==tt?Q/tt:0,ot=0!==et?J/et:0,st=0!==et?$/et:0;_=it*tt,Q=nt*tt,J=ot*et,$=st*et;const rt=Math.sqrt(p*p+f*f),lt=Math.sqrt(A*A+x*x),at=rt*-it,ht=rt*-nt,ct=lt*-ot,dt=lt*-st;let ut=null;const pt=t.solveDomain(s,U,g,q);pt.equals(t)||(ut=pt,this.setXScale(ut));let ft=null;const gt=e.solveDomain(r,z,v,G);if(gt.equals(e)||(ft=gt,this.setYScale(ft)),(null!==ut||null!==ft)&&(null!==ut&&(i.x0=i.x,i.dx=0,i.vx=_,i.ax=at,i.xCoord=this.unscaleX(i.x0,ut,o),n.x0=n.x,n.dx=0,n.vx=J,n.ax=ct,n.xCoord=this.unscaleX(n.x0,ut,o)),null!==ft&&(i.y0=i.y,i.dy=0,i.vy=Q,i.ay=ht,i.yCoord=this.unscaleY(i.y0,ft,o),n.y0=n.y,n.dy=0,n.vy=$,n.ay=dt,n.yCoord=this.unscaleY(n.y0,ft,o)),this.inputCount>2)){const t=this.inputs;for(const e in t){const s=t[e];s!==i&&s!==n&&(null!==ut&&(s.x0=s.x,s.dx=0,s.xCoord=this.unscaleX(s.x0,ut,o)),null!==ft&&(s.y0=s.y,s.dy=0,s.yCoord=this.unscaleY(s.y0,ft,o)))}}},e.prototype.rescaleXY=function(t,e,i,n,o){const s=i.xCoord,r=i.yCoord;let l,a,h,c,d=this.clientToRangeX(i.x,t,o),u=this.clientToRangeY(i.y,e,o),p=i.disableX,f=i.disableY;if(void 0!==n){l=n.xCoord,a=n.yCoord,h=this.clientToRangeX(n.x,t,o),c=this.clientToRangeY(n.y,e,o),p=p||n.disableX,f=f||n.disableY;const i=Math.abs(h-d),s=Math.abs(c-u),r=this.distanceMin;if(i<r){const t=(r-i)/2;d<=h?(d-=t,h+=t):(d+=t,h-=t)}if(s<r){const t=(r-s)/2;u<=c?(u-=t,c+=t):(u+=t,c-=t)}}let g=null;p||(g=t.solveDomain(s,d,l,h),g.equals(t)||this.setXScale(g));let v=null;if(f||(v=e.solveDomain(r,u,a,c),v.equals(e)||this.setYScale(v)),(null!==g||null!==v)&&this.preserveAspectRatio){const t=this.inputs;for(const e in t){const i=t[e];null!==g&&(i.x0=i.x,i.dx=0,i.xCoord=this.unscaleX(i.x0,g,o)),null!==v&&(i.y0=i.y,i.dy=0,i.yCoord=this.unscaleY(i.y0,v,o))}}},e.prototype.rescaleX=function(t,e,i,n){const o=e.xCoord;let s,r,l=this.clientToRangeX(e.x,t,n),a=e.disableX;if(void 0!==i){r=i.xCoord,s=this.clientToRangeX(i.x,t,n),a=a||i.disableX;const e=Math.abs(s-l),o=this.distanceMin;if(e<o){const t=(o-e)/2;l<=s?(l-=t,s+=t):(l+=t,s-=t)}}if(!a){const e=t.solveDomain(o,l,r,s);e.equals(t)||this.setXScale(e)}},e.prototype.rescaleY=function(t,e,i,n){const o=e.yCoord;let s,r,l=this.clientToRangeY(e.y,t,n),a=e.disableY;if(void 0!==i){r=i.yCoord,s=this.clientToRangeY(i.y,t,n),a=a||i.disableY;const e=Math.abs(s-l),o=this.distanceMin;if(e<o){const t=(o-e)/2;l<=s?(l-=t,s+=t):(l+=t,s-=t)}}if(!a){const e=t.solveDomain(o,l,r,s);e.equals(t)||this.setYScale(e)}},e.prototype.conserveMomentum=function(t){let e;const i=this.inputs;for(const t in i){const n=i[t];n.coasting&&(void 0===e||n.t0<e.t0)&&(e=n)}if(void 0!==e){const i=this.getXScale(),n=this.getYScale();null!==i&&null!==n?this.distributeXYMomentum(t,e):null!==i?this.distributeXMomentum(t,e):null!==n&&this.distributeYMomentum(t,e)}},e.prototype.distributeXYMomentum=function(t,e){const i=t.vx,n=t.vy,o=e.vx,s=e.vy,r=Math.sqrt(i*i+n*n),l=Math.sqrt(o*o+s*s),a=0!==r?i/r:0,h=0!==r?n/r:0,c=0!==l?o/l:0,d=0!==l?s/l:0,u=(r+l)/2;t.vx=a*u,t.vy=h*u,e.vx=c*u,e.vy=d*u;const p=t.ax,f=t.ay,g=e.ax,v=e.ay,w=Math.sqrt(p*p+f*f),y=Math.sqrt(g*g+v*v),m=0!==w?p/w:0,b=0!==w?f/w:0,C=0!==y?g/y:0,S=0!==y?v/y:0,A=(w+y)/2;t.ax=m*A,t.ay=b*A,e.ax=C*A,e.ay=S*A},e.prototype.distributeXMomentum=function(t,e){const i=t.vx,n=e.vx,o=Math.abs(i),s=Math.abs(n),r=0!==o?i/o:0,l=0!==s?n/s:0,a=(o+s)/2;t.vx=r*a,e.vx=l*a;const h=t.ax,c=e.ax,d=Math.abs(h),u=Math.abs(c),p=0!==d?h/d:0,f=0!==u?c/u:0,g=(d+u)/2;t.ax=p*g,e.ax=f*g},e.prototype.distributeYMomentum=function(t,e){const i=t.vy,n=e.vy,o=Math.sqrt(i),s=Math.sqrt(n),r=0!==o?i/o:0,l=0!==s?n/s:0,a=(o+s)/2;t.vy=r*a,e.vy=l*a;const h=t.ay,c=e.ay,d=Math.sqrt(h),u=Math.sqrt(c),p=0!==d?h/d:0,f=0!==u?c/u:0,g=(d+u)/2;t.ay=p*g,e.ay=f*g},e.prototype.integrate=function(t){let e,i;const n=this.inputs;for(const o in n){const s=n[o];if(s.coasting)if(void 0===e)e=s;else if(void 0===i){i=s;const n=i.x-e.x,o=i.y-e.y,r=Math.sqrt(n*n+o*o);e.integrateVelocity(t),i.integrateVelocity(t);const l=i.x-e.x,a=i.y-e.y,h=Math.sqrt(l*l+a*a)/r;e.vx*=h,e.vy*=h,e.ax*=h,e.ay*=h,i.vx*=h,i.vy*=h,i.ax*=h,i.ay*=h}else s.integrateVelocity(t)}void 0!==e&&void 0===i&&e.integrateVelocity(t)},e.prototype.zoom=function(t,e,i,n){if(0===i)return;const o=null!==n?n.timeStamp:performance.now(),s=this.acceleration;let r=s*Math.cos(Math.PI/4),l=s*Math.sin(Math.PI/4);const a=this.velocityMax,h=.5*a*Math.cos(Math.PI/4),c=.5*a*Math.sin(Math.PI/4),d=4*h*h/r,u=4*c*c/l,p=this.inputs;let f=p.zoom0,g=p.zoom1;if(void 0!==f&&void 0!==g){const t=o-f.t;if(t>0){const e=Math.abs(g.x-f.x)/2,n=Math.abs(g.y-f.y)/2,s=(i=Math.min(Math.max(-a*t,i),a*t))*e*Math.cos(Math.PI/4)/d,h=i*n*Math.sin(Math.PI/4)/u;r=r*e/d,l=l*n/u,f.x+=s,f.y+=h,f.t=o,f.dx=s,f.dy=h,f.dt=t,f.vx=s/t,f.vy=h/t,f.ax=f.vx<0?r:f.vx>0?-r:0,f.ay=f.vy<0?l:f.vy>0?-l:0,g.x-=s,g.y-=h,g.t=o,f.dx=-s,f.dy=-h,f.dt=t,g.vx=-s/t,g.vy=-h/t,g.ax=g.vx<0?r:g.vx>0?-r:0,g.ay=g.vy<0?l:g.vy>0?-l:0}}else this.interrupt(n),i<0?(f=this.createInput("zoom0","unknown",!1,t-d,e-u,o),f.vx=-h,f.vy=-c,f.ax=r,f.ay=l,g=this.createInput("zoom1","unknown",!1,t+d,e+u,o),g.vx=h,g.vy=c,g.ax=-r,g.ay=-l):(f=this.createInput("zoom0","unknown",!1,t-d,e-u,o),f.vx=h,f.vy=c,f.ax=-r,f.ay=-l,g=this.createInput("zoom1","unknown",!1,t+d,e+u,o),g.vx=-h,g.vy=-c,g.ax=r,g.ay=l),p.zoom0=f,p.zoom1=g,this.inputCount+=2,this.beginCoast(f,n),this.beginCoast(g,n)},Object.defineProperty(e.prototype,"observes",{value:!0,enumerable:!0,configurable:!0}),e.construct=function(i,n,o){return(n=t.construct(i,n,o)).distanceMin=e.DistanceMin,n.setFlags(n.flags|e.WheelFlag),n},e.specialize=function(t){return"pointer"===t?cn:"touch"===t?dn:"mouse"===t?un:"undefined"!=typeof PointerEvent?cn:"undefined"!=typeof TouchEvent?dn:un},e.define=function(t,i){let n=i.extends;const o=i.affinity,s=i.inherits;let r=i.method;const l=i.hysteresis,a=i.hysteresis,h=i.hysteresis,c=i.distanceMin,d=i.preserveAspectRatio,u=i.wheel;delete i.extends,delete i.implements,delete i.affinity,delete i.inherits,delete i.method,delete i.hysteresis,delete i.acceleration,delete i.velocityMax,delete i.distanceMin,delete i.preserveAspectRatio,delete i.wheel,!0===i.key?Object.defineProperty(i,"key",{value:t,configurable:!0}):!1===i.key&&Object.defineProperty(i,"key",{value:void 0,configurable:!0}),void 0===r&&(r="auto"),null==n&&(n=e.specialize(r)),null===n&&(n=this);const p=n.extend(t,i);return p.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==o&&e.initAffinity(o),void 0!==s&&e.initInherits(s),void 0!==l&&(e.hysteresis=l),void 0!==a&&(e.acceleration=a),void 0!==h&&(e.velocityMax=h),void 0!==c&&(e.distanceMin=c),void 0!==d&&(e.preserveAspectRatio=d),void 0!==u&&(e.wheel=u),e},p},e.DistanceMin=10,e.PreserveAspectRatioFlag=1<<t.FlagShift+0,e.WheelFlag=1<<t.FlagShift+1,e.NeedsRescale=1<<t.FlagShift+2,e.FlagShift=t.FlagShift+3,e.FlagMask=(1<<e.FlagShift)-1,e}(on),cn=function(t){const e=t.extend("PointerScaleGesture");return e.prototype.attachHoverEvents=function(t){t.on("pointerenter",this.onPointerEnter),t.on("pointerleave",this.onPointerLeave),t.on("pointerdown",this.onPointerDown),t.on("wheel",this.onWheel)},e.prototype.detachHoverEvents=function(t){t.off("pointerenter",this.onPointerEnter),t.off("pointerleave",this.onPointerLeave),t.off("pointerdown",this.onPointerDown),t.off("wheel",this.onWheel)},e.prototype.attachPressEvents=function(t){document.body.addEventListener("pointermove",this.onPointerMove),document.body.addEventListener("pointerup",this.onPointerUp),document.body.addEventListener("pointercancel",this.onPointerCancel),document.body.addEventListener("pointerleave",this.onPointerLeaveDocument)},e.prototype.detachPressEvents=function(t){document.body.removeEventListener("pointermove",this.onPointerMove),document.body.removeEventListener("pointerup",this.onPointerUp),document.body.removeEventListener("pointercancel",this.onPointerCancel),document.body.removeEventListener("pointerleave",this.onPointerLeaveDocument)},e.prototype.updateInput=function(t,e){t.target=e.target,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=e.clientX-t.x,t.dy=e.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=e.clientX,t.y=e.clientY,t.t=e.timeStamp,t.width=e.width,t.height=e.height,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure},e.prototype.onPointerEnter=function(t){if("mouse"===t.pointerType&&0===t.buttons){const e=this.getOrCreateInput(t.pointerId,Zi.pointerInputType(t.pointerType),t.isPrimary,t.clientX,t.clientY,t.timeStamp);e.coasting||this.updateInput(e,t),e.hovering||this.beginHover(e,t)}},e.prototype.onPointerLeave=function(t){if("mouse"===t.pointerType){const e=this.getInput(t.pointerId);null!==e&&(e.coasting||this.updateInput(e,t),this.endHover(e,t))}},e.prototype.onPointerDown=function(t){const e=this.getOrCreateInput(t.pointerId,Zi.pointerInputType(t.pointerType),t.isPrimary,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.pressing||this.beginPress(e,t),"mouse"===t.pointerType&&0!==t.button&&this.cancelPress(e,t)},e.prototype.onPointerMove=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.movePress(e,t))},e.prototype.onPointerUp=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.endPress(e,t),e.defaultPrevented||0!==t.button||this.press(e,t))},e.prototype.onPointerCancel=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.cancelPress(e,t))},e.prototype.onPointerLeaveDocument=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.cancelPress(e,t),this.endHover(e,t))},e.prototype.onWheel=function(t){this.wheel&&(t.preventDefault(),this.zoom(t.clientX,t.clientY,t.deltaY,t))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onPointerEnter=i.onPointerEnter.bind(i),i.onPointerLeave=i.onPointerLeave.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i.onPointerMove=i.onPointerMove.bind(i),i.onPointerUp=i.onPointerUp.bind(i),i.onPointerCancel=i.onPointerCancel.bind(i),i.onPointerLeaveDocument=i.onPointerLeaveDocument.bind(i),i.onWheel=i.onWheel.bind(i),i},e}(hn),dn=function(t){const e=t.extend("TouchScaleGesture");return e.prototype.attachHoverEvents=function(t){t.on("touchstart",this.onTouchStart)},e.prototype.detachHoverEvents=function(t){t.off("touchstart",this.onTouchStart)},e.prototype.attachPressEvents=function(t){t.on("touchmove",this.onTouchMove),t.on("touchend",this.onTouchEnd),t.on("touchcancel",this.onTouchCancel)},e.prototype.detachPressEvents=function(t){t.off("touchmove",this.onTouchMove),t.off("touchend",this.onTouchEnd),t.off("touchcancel",this.onTouchCancel)},e.prototype.updateInput=function(t,e,i){t.target=i.target,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=i.clientX-t.x,t.dy=i.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=i.clientX,t.y=i.clientY,t.t=e.timeStamp},e.prototype.onTouchStart=function(t){const e=t.targetTouches;for(let i=0;i<e.length;i+=1){const n=e[i],o=this.getOrCreateInput(n.identifier,"touch",!1,n.clientX,n.clientY,t.timeStamp);this.updateInput(o,t,n),o.pressing||this.beginPress(o,t)}},e.prototype.onTouchMove=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],o=this.getInput(n.identifier);null!==o&&(this.updateInput(o,t,n),this.movePress(o,t))}},e.prototype.onTouchEnd=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],o=this.getInput(n.identifier);null!==o&&(this.updateInput(o,t,n),this.endPress(o,t),o.defaultPrevented||this.press(o,t),this.endHover(o,t))}},e.prototype.onTouchCancel=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],o=this.getInput(n.identifier);null!==o&&(this.updateInput(o,t,n),this.cancelPress(o,t),this.endHover(o,t))}},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onTouchStart=i.onTouchStart.bind(i),i.onTouchMove=i.onTouchMove.bind(i),i.onTouchEnd=i.onTouchEnd.bind(i),i.onTouchCancel=i.onTouchCancel.bind(i),i},e}(hn),un=function(t){const e=t.extend("MouseScaleGesture");return e.prototype.attachHoverEvents=function(t){t.on("mouseenter",this.onMouseEnter),t.on("mouseleave",this.onMouseLeave),t.on("mousedown",this.onMouseDown),t.on("wheel",this.onWheel)},e.prototype.detachHoverEvents=function(t){t.off("mouseenter",this.onMouseEnter),t.off("mouseleave",this.onMouseLeave),t.off("mousedown",this.onMouseDown),t.off("wheel",this.onWheel)},e.prototype.attachPressEvents=function(t){document.body.addEventListener("mousemove",this.onMouseMove),document.body.addEventListener("mouseup",this.onMouseUp),document.body.addEventListener("mouseleave",this.onMouseLeaveDocument)},e.prototype.detachPressEvents=function(t){document.body.removeEventListener("mousemove",this.onMouseMove),document.body.removeEventListener("mouseup",this.onMouseUp),document.body.removeEventListener("mouseleave",this.onMouseLeaveDocument)},e.prototype.updateInput=function(t,e){t.target=e.target,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=e.clientX-t.x,t.dy=e.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=e.clientX,t.y=e.clientY,t.t=e.timeStamp},e.prototype.onMouseEnter=function(t){if(0===t.buttons){const e=this.getOrCreateInput("mouse","mouse",!0,t.clientX,t.clientY,t.timeStamp);e.coasting||this.updateInput(e,t),e.hovering||this.beginHover(e,t)}},e.prototype.onMouseLeave=function(t){const e=this.getInput("mouse");null!==e&&(e.coasting||this.updateInput(e,t),this.endHover(e,t))},e.prototype.onMouseDown=function(t){const e=this.getOrCreateInput("mouse","mouse",!0,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.pressing||this.beginPress(e,t),0!==t.button&&this.cancelPress(e,t)},e.prototype.onMouseMove=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.movePress(e,t))},e.prototype.onMouseUp=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.endPress(e,t),e.defaultPrevented||0!==t.button||this.press(e,t))},e.prototype.onMouseLeaveDocument=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.cancelPress(e,t),this.endHover(e,t))},e.prototype.onWheel=function(t){this.wheel&&(t.preventDefault(),this.zoom(t.clientX,t.clientY,t.deltaY,t))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onMouseEnter=i.onMouseEnter.bind(i),i.onMouseLeave=i.onMouseLeave.bind(i),i.onMouseDown=i.onMouseDown.bind(i),i.onMouseMove=i.onMouseMove.bind(i),i.onMouseUp=i.onMouseUp.bind(i),i.onMouseLeaveDocument=i.onMouseLeaveDocument.bind(i),i.onWheel=i.onWheel.bind(i),i},e}(hn);class pn extends i.Component{constructor(){super(),this.observerCache={},this.constraints=e.Arrays.empty,this.constraintVariables=e.Arrays.empty}get componentType(){return pn}attachParent(t,e){let i;this.willAttachParent(t),this.parent=t,null!==e?(i=e.previousSibling,this.setNextSibling(e),e.setPreviousSibling(this)):(i=t.lastChild,t.setLastChild(this)),null!==i?(i.setNextSibling(this),this.setPreviousSibling(i)):t.setFirstChild(this),t.mounted&&(t.culled&&this.cascadeCull(),this.cascadeMount()),this.onAttachParent(t),this.didAttachParent(t)}willAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.viewWillAttachParent&&n.viewWillAttachParent(t,this)}}onAttachParent(t){}didAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.viewDidAttachParent&&n.viewDidAttachParent(t,this)}}willDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.viewWillDetachParent&&n.viewWillDetachParent(t,this)}}onDetachParent(t){}didDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.viewDidDetachParent&&n.viewDidDetachParent(t,this)}}setChild(t,e){return null!==e&&(e=pn.fromAny(e)),super.setChild(t,e)}appendChild(t,e){return t=pn.fromAny(t),super.appendChild(t,e)}prependChild(t,e){return t=pn.fromAny(t),super.prependChild(t,e)}insertChild(t,e,i){return t=pn.fromAny(t),super.insertChild(t,e,i)}replaceChild(t,e){return t=pn.fromAny(t),super.replaceChild(t,e)}willInsertChild(t,e){super.willInsertChild(t,e);const i=this.observerCache.viewWillInsertChildObservers;if(void 0!==i)for(let n=0,o=i.length;n<o;n+=1){i[n].viewWillInsertChild(t,e,this)}}onInsertChild(t,e){super.onInsertChild(t,e)}didInsertChild(t,e){const i=this.observerCache.viewDidInsertChildObservers;if(void 0!==i)for(let n=0,o=i.length;n<o;n+=1){i[n].viewDidInsertChild(t,e,this)}super.didInsertChild(t,e)}cascadeInsert(t,e){0!=(this.flags&pn.MountedFlag)&&(void 0===t&&(t=0),0!=((t|=this.flags&pn.UpdateMask)&pn.ProcessMask)&&(void 0===e&&(e=this.superViewContext),this.cascadeProcess(t,e)))}willRemoveChild(t){super.willRemoveChild(t);const e=this.observerCache.viewWillRemoveChildObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewWillRemoveChild(t,this)}}onRemoveChild(t){super.onRemoveChild(t)}didRemoveChild(t){const e=this.observerCache.viewDidRemoveChildObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewDidRemoveChild(t,this)}super.didRemoveChild(t)}mount(){throw new Error}willMount(){super.willMount();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewWillMount&&i.viewWillMount(this)}}onMount(){this.requestUpdate(this,this.flags&pn.UpdateMask,!1),this.requireUpdate(this.mountFlags),this.culled||null===this.decoherent||0===this.decoherent.length||this.requireUpdate(pn.NeedsChange|pn.NeedsAnimate),this.mountFasteners(),this.mountTheme(),this.updateTheme(!1)}didMount(){this.activateLayout();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidMount&&i.viewDidMount(this)}super.didMount()}unmount(){throw new Error}willUnmount(){super.willUnmount();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewWillUnmount&&i.viewWillUnmount(this)}this.deactivateLayout()}didUnmount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidUnmount&&i.viewDidUnmount(this)}super.didUnmount()}get culled(){return 0!=(this.flags&pn.CulledMask)}setCulled(t){const e=this.flags;t&&0==(e&pn.CulledFlag)?0==(e&pn.CullFlag)?(this.willCull(),this.setFlags(e|pn.CulledFlag),this.onCull(),this.cullChildren(),this.didCull()):this.setFlags(e|pn.CulledFlag):t||0==(e&pn.CulledFlag)||(0==(e&pn.CullFlag)?(this.willUncull(),this.setFlags(e&~pn.CulledFlag),this.uncullChildren(),this.onUncull(),this.didUncull()):this.setFlags(e&~pn.CulledFlag))}cascadeCull(){0==(this.flags&pn.CullFlag)&&(0==(this.flags&pn.CulledFlag)?(this.willCull(),this.setFlags(this.flags|pn.CullFlag),this.onCull(),this.cullChildren(),this.didCull()):this.setFlags(this.flags|pn.CullFlag))}willCull(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewWillCull&&i.viewWillCull(this)}}onCull(){}didCull(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidCull&&i.viewDidCull(this)}}cullChildren(){let t=this.firstChild;for(;null!==t;){const e=t.nextSibling;if(t.cascadeCull(),null!==e&&e.parent!==this)throw new Error("inconsistent cull");t=e}}cascadeUncull(){0!=(this.flags&pn.CullFlag)&&(0==(this.flags&pn.CulledFlag)?(this.willUncull(),this.setFlags(this.flags&~pn.CullFlag),this.uncullChildren(),this.onUncull(),this.didUncull()):this.setFlags(this.flags&~pn.CullFlag))}get uncullFlags(){return this.constructor.UncullFlags}willUncull(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewWillUncull&&i.viewWillUncull(this)}}onUncull(){this.requestUpdate(this,this.flags&pn.UpdateMask,!1),this.requireUpdate(this.uncullFlags),null!==this.decoherent&&0!==this.decoherent.length&&this.requireUpdate(pn.NeedsChange|pn.NeedsAnimate),this.mood.inherited&&this.mood.decohere(),this.theme.inherited&&this.theme.decohere()}didUncull(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidUncull&&i.viewDidUncull(this)}}uncullChildren(){let t=this.firstChild;for(;null!==t;){const e=t.nextSibling;if(t.cascadeUncull(),null!==e&&e.parent!==this)throw new Error("inconsistent uncull");t=e}}get hidden(){return 0!=(this.flags&pn.HiddenMask)}setHidden(t){const e=this.flags;t&&0==(e&pn.HiddenFlag)?(this.setFlags(e|pn.HiddenFlag),0==(e&pn.HideFlag)&&(this.willHide(),this.onHide(),this.hideChildren(),this.didHide())):t||0==(e&pn.HiddenFlag)||(this.setFlags(e&~pn.HiddenFlag),0==(e&pn.HideFlag)&&(this.willUnhide(),this.unhideChildren(),this.onUnhide(),this.didUnhide()))}cascadeHide(){0==(this.flags&pn.HideFlag)&&(0==(this.flags&pn.HiddenFlag)?(this.willHide(),this.setFlags(this.flags|pn.HideFlag),this.onHide(),this.hideChildren(),this.didHide()):this.setFlags(this.flags|pn.HideFlag))}willHide(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewWillHide&&i.viewWillHide(this)}}onHide(){}didHide(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidHide&&i.viewDidHide(this)}}hideChildren(){let t=this.firstChild;for(;null!==t;){const e=t.nextSibling;if(t.cascadeHide(),null!==e&&e.parent!==this)throw new Error("inconsistent hide");t=e}}cascadeUnhide(){0!=(this.flags&pn.HideFlag)&&(0==(this.flags&pn.HiddenFlag)?(this.willUnhide(),this.setFlags(this.flags&~pn.HideFlag),this.unhideChildren(),this.onUnhide(),this.didUnhide()):this.setFlags(this.flags&~pn.HideFlag))}get unhideFlags(){return this.constructor.UnhideFlags}willUnhide(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewWillUnhide&&i.viewWillUnhide(this)}}onUnhide(){this.requestUpdate(this,this.flags&pn.UpdateMask,!1),this.requireUpdate(this.uncullFlags)}didUnhide(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidUnhide&&i.viewDidUnhide(this)}}unhideChildren(){let t=this.firstChild;for(;null!==t;){const e=t.nextSibling;if(t.cascadeUnhide(),null!==e&&e.parent!==this)throw new Error("inconsistent unhide");t=e}}get unbounded(){return 0!=(this.flags&pn.UnboundedFlag)}setUnbounded(t){t!==(0!=(this.flags&pn.UnboundedFlag))&&(this.willSetUnbounded(t),t?this.setFlags(this.flags|pn.UnboundedFlag):this.setFlags(this.flags&~pn.UnboundedFlag),this.onSetUnbounded(t),this.didSetUnbounded(t))}willSetUnbounded(t){}onSetUnbounded(t){}didSetUnbounded(t){}get intangible(){return 0!=(this.flags&pn.IntangibleFlag)}setIntangible(t){t!==(0!=(this.flags&pn.IntangibleFlag))&&(this.willSetIntangible(t),t?this.setFlags(this.flags|pn.IntangibleFlag):this.setFlags(this.flags&~pn.IntangibleFlag),this.onSetIntangible(t),this.didSetIntangible(t))}willSetIntangible(t){}onSetIntangible(t){}didSetIntangible(t){}requireUpdate(t,e=!1){const i=this.flags,n=t&~i&pn.UpdateMask;0!==n&&(this.setFlags(i|n),this.requestUpdate(this,n,e))}needsUpdate(t,e){return t}requestUpdate(t,e,i){if((this.flags&pn.CulledMask)!==pn.CulledFlag){e=this.needsUpdate(e,i);let n=this.flags&~e&pn.UpdateMask;if(0!=(e&pn.ProcessMask)&&(n|=pn.NeedsProcess),0!=(e&pn.DisplayMask)&&(n|=pn.NeedsDisplay),0!==n||i){this.setFlags(this.flags|n);const o=this.parent;if(null!==o)o.requestUpdate(t,e,i);else if(this.mounted){const n=this.displayProvider.service;null!=n&&n.requestUpdate(t,e,i)}}}}get updating(){return 0!=(this.flags&pn.UpdatingMask)}get processing(){return 0!=(this.flags&pn.ProcessingFlag)}needsProcess(t,e){return t}cascadeProcess(t,e){const i=this.extendViewContext(e),n=Ei.current;try{if(Ei.current=i,t&=~pn.NeedsProcess,t|=this.flags&pn.UpdateMask,0!=((t=this.needsProcess(t,i))&pn.ProcessMask)){let e=t;this.setFlags(this.flags&~pn.NeedsProcess|pn.ProcessingFlag|pn.ContextualFlag),this.willProcess(e,i),0!=((this.flags|t)&pn.NeedsResize)&&(e|=pn.NeedsResize,this.setFlags(this.flags&~pn.NeedsResize),this.willResize(i)),0!=((this.flags|t)&pn.NeedsScroll)&&(e|=pn.NeedsScroll,this.setFlags(this.flags&~pn.NeedsScroll),this.willScroll(i)),0!=((this.flags|t)&pn.NeedsChange)&&(e|=pn.NeedsChange,this.setFlags(this.flags&~pn.NeedsChange),this.willChange(i)),0!=((this.flags|t)&pn.NeedsAnimate)&&(e|=pn.NeedsAnimate,this.setFlags(this.flags&~pn.NeedsAnimate),this.willAnimate(i)),0!=((this.flags|t)&pn.NeedsProject)&&(e|=pn.NeedsProject,this.setFlags(this.flags&~pn.NeedsProject),this.willProject(i)),this.onProcess(e,i),0!=(e&pn.NeedsResize)&&this.onResize(i),0!=(e&pn.NeedsScroll)&&this.onScroll(i),0!=(e&pn.NeedsChange)&&this.onChange(i),0!=(e&pn.NeedsAnimate)&&this.onAnimate(i),0!=(e&pn.NeedsProject)&&this.onProject(i),0!=(e&pn.ProcessMask)&&(this.setFlags(this.flags&~pn.ContextualFlag),this.processChildren(e,i,this.processChild),this.setFlags(this.flags|pn.ContextualFlag)),0!=(e&pn.NeedsProject)&&this.didProject(i),0!=(e&pn.NeedsAnimate)&&this.didAnimate(i),0!=(e&pn.NeedsChange)&&this.didChange(i),0!=(e&pn.NeedsScroll)&&this.didScroll(i),0!=(e&pn.NeedsResize)&&this.didResize(i),this.didProcess(e,i)}}finally{this.setFlags(this.flags&~(pn.ProcessingFlag|pn.ContextualFlag)),Ei.current=n}}willProcess(t,e){}onProcess(t,e){}didProcess(t,e){}willResize(t){const e=this.observerCache.viewWillResizeObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewWillResize(t,this)}this.evaluateConstraintVariables()}onResize(t){}didResize(t){const e=this.observerCache.viewDidResizeObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewDidResize(t,this)}}willScroll(t){const e=this.observerCache.viewWillScrollObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewWillScroll(t,this)}}onScroll(t){}didScroll(t){const e=this.observerCache.viewDidScrollObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewDidScroll(t,this)}}willChange(t){const e=this.observerCache.viewWillChangeObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewWillChange(t,this)}}onChange(t){this.updateTheme(),this.recohereFasteners(t.updateTime)}didChange(t){const e=this.observerCache.viewDidChangeObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewDidChange(t,this)}}willAnimate(t){const e=this.observerCache.viewWillAnimateObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewWillAnimate(t,this)}}onAnimate(t){this.recohereAnimators(t.updateTime)}didAnimate(t){const e=this.observerCache.viewDidAnimateObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewDidAnimate(t,this)}}willProject(t){const e=this.observerCache.viewWillProjectObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewWillProject(t,this)}}onProject(t){}didProject(t){const e=this.observerCache.viewDidProjectObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewDidProject(t,this)}}processChildren(t,e,i){let n=this.firstChild;for(;null!==n;){const o=n.nextSibling;if(i.call(this,n,t,e),null!==o&&o.parent!==this)throw new Error("inconsistent process pass");n=o}}processChild(t,e,i){t.cascadeProcess(e,i)}get displaying(){return 0!=(this.flags&pn.DisplayingFlag)}needsDisplay(t,e){return t}cascadeDisplay(t,e){const i=this.extendViewContext(e),n=Ei.current;try{if(Ei.current=i,t&=~pn.NeedsDisplay,t|=this.flags&pn.UpdateMask,0!=((t=this.needsDisplay(t,i))&pn.DisplayMask)){let e=t;this.setFlags(this.flags&~pn.NeedsDisplay|pn.DisplayingFlag|pn.ContextualFlag),this.willDisplay(e,i),0!=((this.flags|t)&pn.NeedsLayout)&&(e|=pn.NeedsLayout,this.setFlags(this.flags&~pn.NeedsLayout),this.willLayout(i)),0!=((this.flags|t)&pn.NeedsRender)&&(e|=pn.NeedsRender,this.setFlags(this.flags&~pn.NeedsRender),this.willRender(i)),0!=((this.flags|t)&pn.NeedsRasterize)&&(e|=pn.NeedsRasterize,this.setFlags(this.flags&~pn.NeedsRasterize),this.willRasterize(i)),0!=((this.flags|t)&pn.NeedsComposite)&&(e|=pn.NeedsComposite,this.setFlags(this.flags&~pn.NeedsComposite),this.willComposite(i)),this.onDisplay(e,i),0!=(e&pn.NeedsLayout)&&this.onLayout(i),0!=(e&pn.NeedsRender)&&this.onRender(i),0!=(e&pn.NeedsRasterize)&&this.onRasterize(i),0!=(e&pn.NeedsComposite)&&this.onComposite(i),0==(e&pn.DisplayMask)||this.hidden||this.culled||(this.setFlags(this.flags&~pn.ContextualFlag),this.displayChildren(e,i,this.displayChild),this.setFlags(this.flags|pn.ContextualFlag)),0!=(e&pn.NeedsComposite)&&this.didComposite(i),0!=(e&pn.NeedsRasterize)&&this.didRasterize(i),0!=(e&pn.NeedsRender)&&this.didRender(i),0!=(e&pn.NeedsLayout)&&this.didLayout(i),this.didDisplay(e,i)}}finally{this.setFlags(this.flags&~(pn.DisplayingFlag|pn.ContextualFlag)),Ei.current=n}}willDisplay(t,e){}onDisplay(t,e){}didDisplay(t,e){}willLayout(t){const e=this.observerCache.viewWillLayoutObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewWillLayout(t,this)}}onLayout(t){}didLayout(t){const e=this.observerCache.viewDidLayoutObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewDidLayout(t,this)}}willRender(t){const e=this.observerCache.viewWillRenderObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewWillRender(t,this)}}onRender(t){}didRender(t){const e=this.observerCache.viewDidRenderObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewDidRender(t,this)}}willRasterize(t){const e=this.observerCache.viewWillRasterizeObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewWillRasterize(t,this)}}onRasterize(t){}didRasterize(t){const e=this.observerCache.viewDidRasterizeObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewDidRasterize(t,this)}}willComposite(t){const e=this.observerCache.viewWillCompositeObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewWillComposite(t,this)}}onComposite(t){}didComposite(t){const e=this.observerCache.viewDidCompositeObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewDidComposite(t,this)}}displayChildren(t,e,i){let n=this.firstChild;for(;null!==n;){const o=n.nextSibling;if(i.call(this,n,t,e),null!==o&&o.parent!==this)throw new Error("inconsistent display pass");n=o}}displayChild(t,e,i){t.cascadeDisplay(e,i)}getLook(t,e){const i=this.theme.value;let n;return null!==i&&(null==e&&(e=this.mood.value),null!==e&&(n=i.get(t,e))),n}getLookOr(t,e,i){2===arguments.length&&(i=e,e=null);const n=this.theme.value;let o;return null!==n?(null==e&&(e=this.mood.value),o=null!==e?n.getOr(t,e,i):i):o=i,o}applyTheme(t,i,n){n=void 0===n||!0===n?t.getOr(St.timing,Ot.ambient,!1):e.Timing.fromAny(n),this.willApplyTheme(t,i,n),this.onApplyTheme(t,i,n),this.didApplyTheme(t,i,n)}willApplyTheme(t,e,i){const n=this.observers;for(let o=0,s=n.length;o<s;o+=1){const s=n[o];void 0!==s.viewWillApplyTheme&&s.viewWillApplyTheme(t,e,i,this)}}onApplyTheme(t,e,i){this.themeAnimators(t,e,i)}didApplyTheme(t,e,i){const n=this.observers;for(let o=0,s=n.length;o<s;o+=1){const s=n[o];void 0!==s.viewDidApplyTheme&&s.viewDidApplyTheme(t,e,i,this)}}themeAnimators(t,e,i){const n=this.fasteners;for(const o in n){const s=n[o];s instanceof zt&&s.applyTheme(t,e,i)}}modifyMood(t,n,o){if(this.moodModifier.hasAffinity(i.Affinity.Intrinsic)){const s=this.moodModifier.getValueOr(Et.empty()),r=s.updatedCol(t,n,!0);if(!r.equals(s))if(this.moodModifier.setValue(r,i.Affinity.Intrinsic),this.changeMood(),void 0!==o){const t=this.theme.value,i=this.mood.value;null!==t&&null!==i&&(o=!0===o?t.getOr(St.timing,i,!1):e.Timing.fromAny(o),this.applyTheme(t,i,o))}else this.requireUpdate(pn.NeedsChange)}}modifyTheme(t,n,o){if(this.themeModifier.hasAffinity(i.Affinity.Intrinsic)){const s=this.themeModifier.getValueOr(Et.empty()),r=s.updatedCol(t,n,!0);if(!r.equals(s))if(this.themeModifier.setValue(r,i.Affinity.Intrinsic),this.changeTheme(),void 0!==o){const t=this.theme.value,i=this.mood.value;null!==t&&null!==i&&(o=!0===o?t.getOr(St.timing,i,!1):e.Timing.fromAny(o),this.applyTheme(t,i,o))}else this.requireUpdate(pn.NeedsChange)}}changeMood(){const t=this.getFastener("moodModifier",i.Property);if(null!==t&&this.mood.hasAffinity(i.Affinity.Intrinsic)){const e=t.value;if(null!==e){let t=this.mood.superValue;if(null==t){const e=this.themeProvider.service;null!=e&&(t=e.mood)}if(null!=t){const n=e.timesCol(t,!0);this.mood.setValue(n,i.Affinity.Intrinsic)}}else this.mood.setAffinity(i.Affinity.Inherited)}}changeTheme(){const t=this.getFastener("themeModifier",i.Property);if(null!==t&&this.theme.hasAffinity(i.Affinity.Intrinsic)){const e=t.value;if(null!==e){let t=this.theme.superValue;if(null==t){const e=this.themeProvider.service;null!=e&&(t=e.theme)}if(null!=t){const n=t.transform(e,!0);this.theme.setValue(n,i.Affinity.Intrinsic)}}else this.theme.setAffinity(i.Affinity.Inherited)}}updateTheme(t){this.changeMood(),this.changeTheme();const e=this.theme.value,i=this.mood.value;null!==e&&null!==i&&this.applyTheme(e,i,t)}mountTheme(){}bindChildFastener(t,e,i){super.bindChildFastener(t,e,i),(t instanceof fn||t instanceof _i)&&t.bindView(e,i)}unbindChildFastener(t,e){(t instanceof fn||t instanceof _i)&&t.unbindView(e),super.unbindChildFastener(t,e)}decohereFastener(t){super.decohereFastener(t),t instanceof i.Animator?this.requireUpdate(pn.NeedsAnimate):this.requireUpdate(pn.NeedsChange)}recohereFasteners(t){const e=this.decoherent;if(null!==e){const n=e.length;if(0!==n){void 0===t&&(t=performance.now()),this.decoherent=null;for(let o=0;o<n;o+=1){const n=e[o];n instanceof i.Animator?this.decohereFastener(n):n.recohere(t)}}}}recohereAnimators(t){const e=this.decoherent;if(null!==e){const n=e.length;if(0!==n){this.decoherent=null;for(let o=0;o<n;o+=1){const n=e[o];n instanceof i.Animator?n.recohere(t):this.decohereFastener(n)}}}}constraint(t,e,i,n){t=a.ConstraintExpression.fromAny(t),void 0!==i&&(i=a.ConstraintExpression.fromAny(i));const o=void 0!==i?t.minus(i):t;n=void 0===n?a.ConstraintStrength.Required:a.ConstraintStrength.fromAny(n);const s=new a.Constraint(this,o,e,n);return this.addConstraint(s),s}hasConstraint(t){return this.constraints.indexOf(t)>=0}addConstraint(t){const i=this.constraints,n=e.Arrays.inserted(t,i);i!==n&&(this.constraints=n,this.activateConstraint(t))}removeConstraint(t){const i=this.constraints,n=e.Arrays.removed(t,i);i!==n&&(this.deactivateConstraint(t),this.constraints=n)}activateConstraint(t){const e=this.layoutProvider.service;null!=e&&(e.activateConstraint(t),this.requireUpdate(pn.NeedsLayout))}deactivateConstraint(t){const e=this.layoutProvider.service;null!=e&&(e.deactivateConstraint(t),this.requireUpdate(pn.NeedsLayout))}constraintVariable(t,e,i){void 0===e&&(e=0),i=void 0!==i?a.ConstraintStrength.fromAny(i):a.ConstraintStrength.Strong;const n=a.ConstraintProperty.create(this);return Object.defineProperty(n,"name",{value:t,configurable:!0}),void 0!==e&&n.setValue(e),n.setStrength(i),n.mount(),n}hasConstraintVariable(t){return this.constraintVariables.indexOf(t)>=0}addConstraintVariable(t){const i=this.constraintVariables,n=e.Arrays.inserted(t,i);i!==n&&(this.constraintVariables=n,this.activateConstraintVariable(t))}removeConstraintVariable(t){const i=this.constraintVariables,n=e.Arrays.removed(t,i);i!==n&&(this.deactivateConstraintVariable(t),this.constraintVariables=n)}activateConstraintVariable(t){const e=this.layoutProvider.service;null!=e&&(e.activateConstraintVariable(t),this.requireUpdate(pn.NeedsLayout))}deactivateConstraintVariable(t){const e=this.layoutProvider.service;null!=e&&(e.deactivateConstraintVariable(t),this.requireUpdate(pn.NeedsLayout))}setConstraintVariable(t,e){const i=this.layoutProvider.service;null!=i&&i.setConstraintVariable(t,e)}evaluateConstraintVariables(){const t=this.constraintVariables;for(let e=0,i=t.length;e<i;e+=1){t[e].evaluateConstraintVariable()}}activateLayout(){const t=this.layoutProvider.service;if(null!=t){const e=this.constraints;for(let i=0,n=e.length;i<n;i+=1)t.activateConstraint(e[i])}}deactivateLayout(){const t=this.layoutProvider.service;if(null!=t){const e=this.constraints;for(let i=0,n=e.length;i<n;i+=1)t.deactivateConstraint(e[i])}}setProperty(t,e,n,o){const s=this.getLazyFastener(t,i.Property);null!==s&&(s instanceof i.Animator?s.setState(e,n,o):s.setValue(e,o))}setProperties(t,e,i){"number"==typeof e&&(i=e,e=void 0);for(const n in t){const o=t[n];this.setProperty(n,o,e,i)}}get superViewContext(){const t=this.parent;if(null!==t)return t.viewContext;{const t=this.viewportProvider.viewContext;return this.displayProvider.updatedViewContext(t)}}extendViewContext(t){return t}get viewContext(){return 0!=(this.flags&pn.ContextualFlag)?Ei.current:this.extendViewContext(this.superViewContext)}get viewportIdiom(){return this.viewContext.viewportIdiom}get viewport(){return this.viewContext.viewport}get parentTransform(){return o.Transform.identity()}get pageTransform(){const t=this.parent;return null!==t?t.pageTransform.transform(this.parentTransform):o.Transform.identity()}get pageBounds(){const t=this.clientBounds,e=this.clientTransform;return t.transform(e)}get popoverFrame(){return this.pageBounds}get clientTransform(){let t;const e=window.pageXOffset,i=window.pageYOffset;t=0!==e||0!==i?o.Transform.translate(e,i):o.Transform.identity();const n=this.pageTransform;return t.transform(n)}get clientBounds(){const t=this.viewport;return new o.R2Box(0,0,t.width,t.height)}intersectsViewport(){const t=this.clientBounds,e=document.documentElement.clientWidth,i=document.documentElement.clientHeight;return(t.top<=0&&0<t.bottom||0<=t.top&&t.top<i)&&(t.left<=0&&0<t.right||0<=t.left&&t.left<e)}dispatchEvent(t){return!0}on(t,e,i){return this}off(t,e,i){return this}onObserve(t){super.onObserve(t),void 0!==t.viewWillInsertChild&&(this.observerCache.viewWillInsertChildObservers=e.Arrays.inserted(t,this.observerCache.viewWillInsertChildObservers)),void 0!==t.viewDidInsertChild&&(this.observerCache.viewDidInsertChildObservers=e.Arrays.inserted(t,this.observerCache.viewDidInsertChildObservers)),void 0!==t.viewWillRemoveChild&&(this.observerCache.viewWillRemoveChildObservers=e.Arrays.inserted(t,this.observerCache.viewWillRemoveChildObservers)),void 0!==t.viewDidRemoveChild&&(this.observerCache.viewDidRemoveChildObservers=e.Arrays.inserted(t,this.observerCache.viewDidRemoveChildObservers)),void 0!==t.viewWillResize&&(this.observerCache.viewWillResizeObservers=e.Arrays.inserted(t,this.observerCache.viewWillResizeObservers)),void 0!==t.viewDidResize&&(this.observerCache.viewDidResizeObservers=e.Arrays.inserted(t,this.observerCache.viewDidResizeObservers)),void 0!==t.viewWillScroll&&(this.observerCache.viewWillScrollObservers=e.Arrays.inserted(t,this.observerCache.viewWillScrollObservers)),void 0!==t.viewDidScroll&&(this.observerCache.viewDidScrollObservers=e.Arrays.inserted(t,this.observerCache.viewDidScrollObservers)),void 0!==t.viewWillChange&&(this.observerCache.viewWillChangeObservers=e.Arrays.inserted(t,this.observerCache.viewWillChangeObservers)),void 0!==t.viewDidChange&&(this.observerCache.viewDidChangeObservers=e.Arrays.inserted(t,this.observerCache.viewDidChangeObservers)),void 0!==t.viewWillAnimate&&(this.observerCache.viewWillAnimateObservers=e.Arrays.inserted(t,this.observerCache.viewWillAnimateObservers)),void 0!==t.viewDidAnimate&&(this.observerCache.viewDidAnimateObservers=e.Arrays.inserted(t,this.observerCache.viewDidAnimateObservers)),void 0!==t.viewWillProject&&(this.observerCache.viewWillProjectObservers=e.Arrays.inserted(t,this.observerCache.viewWillProjectObservers)),void 0!==t.viewDidProject&&(this.observerCache.viewDidProjectObservers=e.Arrays.inserted(t,this.observerCache.viewDidProjectObservers)),void 0!==t.viewWillLayout&&(this.observerCache.viewWillLayoutObservers=e.Arrays.inserted(t,this.observerCache.viewWillLayoutObservers)),void 0!==t.viewDidLayout&&(this.observerCache.viewDidLayoutObservers=e.Arrays.inserted(t,this.observerCache.viewDidLayoutObservers)),void 0!==t.viewWillRender&&(this.observerCache.viewWillRenderObservers=e.Arrays.inserted(t,this.observerCache.viewWillRenderObservers)),void 0!==t.viewDidRender&&(this.observerCache.viewDidRenderObservers=e.Arrays.inserted(t,this.observerCache.viewDidRenderObservers)),void 0!==t.viewWillRasterize&&(this.observerCache.viewWillRasterizeObservers=e.Arrays.inserted(t,this.observerCache.viewWillRasterizeObservers)),void 0!==t.viewDidRasterize&&(this.observerCache.viewDidRasterizeObservers=e.Arrays.inserted(t,this.observerCache.viewDidRasterizeObservers)),void 0!==t.viewWillComposite&&(this.observerCache.viewWillCompositeObservers=e.Arrays.inserted(t,this.observerCache.viewWillCompositeObservers)),void 0!==t.viewDidComposite&&(this.observerCache.viewDidCompositeObservers=e.Arrays.inserted(t,this.observerCache.viewDidCompositeObservers))}onUnobserve(t){super.onUnobserve(t),void 0!==t.viewWillInsertChild&&(this.observerCache.viewWillInsertChildObservers=e.Arrays.removed(t,this.observerCache.viewWillInsertChildObservers)),void 0!==t.viewDidInsertChild&&(this.observerCache.viewDidInsertChildObservers=e.Arrays.removed(t,this.observerCache.viewDidInsertChildObservers)),void 0!==t.viewWillRemoveChild&&(this.observerCache.viewWillRemoveChildObservers=e.Arrays.removed(t,this.observerCache.viewWillRemoveChildObservers)),void 0!==t.viewDidRemoveChild&&(this.observerCache.viewDidRemoveChildObservers=e.Arrays.removed(t,this.observerCache.viewDidRemoveChildObservers)),void 0!==t.viewWillResize&&(this.observerCache.viewWillResizeObservers=e.Arrays.removed(t,this.observerCache.viewWillResizeObservers)),void 0!==t.viewDidResize&&(this.observerCache.viewDidResizeObservers=e.Arrays.removed(t,this.observerCache.viewDidResizeObservers)),void 0!==t.viewWillScroll&&(this.observerCache.viewWillScrollObservers=e.Arrays.removed(t,this.observerCache.viewWillScrollObservers)),void 0!==t.viewDidScroll&&(this.observerCache.viewDidScrollObservers=e.Arrays.removed(t,this.observerCache.viewDidScrollObservers)),void 0!==t.viewWillChange&&(this.observerCache.viewWillChangeObservers=e.Arrays.removed(t,this.observerCache.viewWillChangeObservers)),void 0!==t.viewDidChange&&(this.observerCache.viewDidChangeObservers=e.Arrays.removed(t,this.observerCache.viewDidChangeObservers)),void 0!==t.viewWillAnimate&&(this.observerCache.viewWillAnimateObservers=e.Arrays.removed(t,this.observerCache.viewWillAnimateObservers)),void 0!==t.viewDidAnimate&&(this.observerCache.viewDidAnimateObservers=e.Arrays.removed(t,this.observerCache.viewDidAnimateObservers)),void 0!==t.viewWillProject&&(this.observerCache.viewWillProjectObservers=e.Arrays.removed(t,this.observerCache.viewWillProjectObservers)),void 0!==t.viewDidProject&&(this.observerCache.viewDidProjectObservers=e.Arrays.removed(t,this.observerCache.viewDidProjectObservers)),void 0!==t.viewWillLayout&&(this.observerCache.viewWillLayoutObservers=e.Arrays.removed(t,this.observerCache.viewWillLayoutObservers)),void 0!==t.viewDidLayout&&(this.observerCache.viewDidLayoutObservers=e.Arrays.removed(t,this.observerCache.viewDidLayoutObservers)),void 0!==t.viewWillRender&&(this.observerCache.viewWillRenderObservers=e.Arrays.removed(t,this.observerCache.viewWillRenderObservers)),void 0!==t.viewDidRender&&(this.observerCache.viewDidRenderObservers=e.Arrays.removed(t,this.observerCache.viewDidRenderObservers)),void 0!==t.viewWillRasterize&&(this.observerCache.viewWillRasterizeObservers=e.Arrays.removed(t,this.observerCache.viewWillRasterizeObservers)),void 0!==t.viewDidRasterize&&(this.observerCache.viewDidRasterizeObservers=e.Arrays.removed(t,this.observerCache.viewDidRasterizeObservers)),void 0!==t.viewWillComposite&&(this.observerCache.viewWillCompositeObservers=e.Arrays.removed(t,this.observerCache.viewWillCompositeObservers)),void 0!==t.viewDidComposite&&(this.observerCache.viewDidCompositeObservers=e.Arrays.removed(t,this.observerCache.viewDidCompositeObservers))}init(t){void 0!==t.mood&&this.mood(t.mood),void 0!==t.moodModifier&&this.moodModifier(t.moodModifier),void 0!==t.theme&&this.theme(t.theme),void 0!==t.themeModifier&&this.themeModifier(t.themeModifier)}static create(){return new this}static fromInit(t){let i;i=("object"==typeof t&&null!==t||"function"==typeof t)&&e.Creatable.is(t.type)?t.type:this;const n=i.create();return n.init(t),n}static fromAny(t){if(null==t)return t;if(t instanceof pn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return e.Creatable.is(t)?t.create():this.fromInit(t)}}pn.uid=function(){let t=1;return function(){const e=~~t;return t+=1,e}}(),pn.MountedFlag=i.Component.MountedFlag,pn.RemovingFlag=i.Component.RemovingFlag,pn.ProcessingFlag=1<<i.Component.FlagShift+0,pn.DisplayingFlag=1<<i.Component.FlagShift+1,pn.ContextualFlag=1<<i.Component.FlagShift+2,pn.CullFlag=1<<i.Component.FlagShift+3,pn.CulledFlag=1<<i.Component.FlagShift+4,pn.HideFlag=1<<i.Component.FlagShift+5,pn.HiddenFlag=1<<i.Component.FlagShift+6,pn.UnboundedFlag=1<<i.Component.FlagShift+7,pn.IntangibleFlag=1<<i.Component.FlagShift+8,pn.CulledMask=pn.CullFlag|pn.CulledFlag,pn.HiddenMask=pn.HideFlag|pn.HiddenFlag,pn.UpdatingMask=pn.ProcessingFlag|pn.DisplayingFlag,pn.StatusMask=pn.MountedFlag|pn.RemovingFlag|pn.ProcessingFlag|pn.DisplayingFlag|pn.ContextualFlag|pn.CullFlag|pn.CulledFlag|pn.HiddenFlag|pn.UnboundedFlag|pn.IntangibleFlag,pn.NeedsProcess=1<<i.Component.FlagShift+9,pn.NeedsResize=1<<i.Component.FlagShift+10,pn.NeedsScroll=1<<i.Component.FlagShift+11,pn.NeedsChange=1<<i.Component.FlagShift+12,pn.NeedsAnimate=1<<i.Component.FlagShift+13,pn.NeedsProject=1<<i.Component.FlagShift+14,pn.ProcessMask=pn.NeedsProcess|pn.NeedsResize|pn.NeedsScroll|pn.NeedsChange|pn.NeedsAnimate|pn.NeedsProject,pn.NeedsDisplay=1<<i.Component.FlagShift+15,pn.NeedsLayout=1<<i.Component.FlagShift+16,pn.NeedsRender=1<<i.Component.FlagShift+17,pn.NeedsRasterize=1<<i.Component.FlagShift+18,pn.NeedsComposite=1<<i.Component.FlagShift+19,pn.DisplayMask=pn.NeedsDisplay|pn.NeedsLayout|pn.NeedsRender|pn.NeedsRasterize|pn.NeedsComposite,pn.UpdateMask=pn.ProcessMask|pn.DisplayMask,pn.FlagShift=i.Component.FlagShift+20,pn.FlagMask=(1<<pn.FlagShift)-1,pn.MountFlags=i.Component.MountFlags|pn.NeedsResize|pn.NeedsChange|pn.NeedsLayout,pn.UncullFlags=pn.NeedsResize|pn.NeedsChange|pn.NeedsLayout,pn.UnhideFlags=pn.NeedsLayout,pn.InsertChildFlags=i.Component.InsertChildFlags|pn.NeedsLayout,pn.RemoveChildFlags=i.Component.RemoveChildFlags|pn.NeedsLayout,u([i.Provider({extends:Bi,type:Ni,observes:!1,service:Ni.global()})],pn.prototype,"viewportProvider",void 0),u([i.Provider({extends:zi,type:Ui,observes:!1,service:Ui.global()})],pn.prototype,"displayProvider",void 0),u([i.Provider({extends:Gi,type:qi,observes:!1,service:qi.global()})],pn.prototype,"layoutProvider",void 0),u([i.Provider({extends:ji,type:Hi,observes:!1,service:Hi.global()})],pn.prototype,"themeProvider",void 0),u([i.Provider({extends:Ki,type:Xi,observes:!1,service:Xi.global()})],pn.prototype,"modalProvider",void 0),u([i.Property({type:Wt,value:null,inherits:!0})],pn.prototype,"mood",void 0),u([i.Property({type:Bt,value:null,inherits:!0})],pn.prototype,"theme",void 0),u([i.Property({type:Et,value:null})],pn.prototype,"moodModifier",void 0),u([i.Property({type:Et,value:null})],pn.prototype,"themeModifier",void 0);const fn=function(t){const e=t.extend("ViewRelation");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.initView=function(t){},e.prototype.willAttachView=function(t,e){},e.prototype.onAttachView=function(t,e){!0===this.observes&&t.observe(this)},e.prototype.didAttachView=function(t,e){},e.prototype.deinitView=function(t){},e.prototype.willDetachView=function(t){},e.prototype.onDetachView=function(t){!0===this.observes&&t.unobserve(this)},e.prototype.didDetachView=function(t){},Object.defineProperty(e.prototype,"parentView",{get(){const t=this.owner;return t instanceof pn?t:null},configurable:!0}),e.prototype.insertChild=function(t,e,i,n){t.insertChild(e,i,n)},e.prototype.bindView=function(t,e){},e.prototype.unbindView=function(t){},e.prototype.detectView=function(t){return null},e.prototype.createView=function(){let t;const e=this.type;if(void 0!==e&&(t=e.create()),null==t){let t="Unable to create ";throw 0!==this.name.length&&(t+=this.name+" "),t+="view",new Error(t)}return t},e.prototype.fromAny=function(t){const e=this.type;return void 0!==e?e.fromAny(t):pn.fromAny(t)},Object.defineProperty(e.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!0},configurable:!0}),e.construct=function(e,i,n){return i=t.construct(e,i,n)},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,null==i&&(i=this);const s=i.extend(t,e);return s.construct=function(t,e,s){return e=i.construct(t,e,s),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),e},s},e}(i.Fastener),gn=function(t){const i=t.extend("ViewRef");return Object.defineProperty(i.prototype,"fastenerType",{get:function(){return i},configurable:!0}),i.prototype.onInherit=function(t){this.setView(t.view)},i.prototype.getView=function(){const t=this.view;if(null===t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="view",new TypeError(e)}return t},i.prototype.setView=function(t,e,i){null!==t&&(t=this.fromAny(t));let n=this.view;if(n!==t){let o;void 0===e&&(e=null),this.binds&&(o=this.parentView,null!==o)&&(null!==n&&n.parent===o&&(null===e&&(e=n.nextSibling),n.remove()),null!==t&&(void 0===i&&(i=this.key),this.insertChild(o,t,e,i)),n=this.view),n!==t&&(null!==n&&(this.deactivateLayout(),this.willDetachView(n),this.view=null,this.onDetachView(n),this.deinitView(n),this.didDetachView(n)),null!==t&&(this.willAttachView(t,e),this.view=t,this.onAttachView(t,e),this.initView(t),this.didAttachView(t,e)))}return n},i.prototype.attachView=function(t,e){const i=this.view;return(t=null!=t?this.fromAny(t):null===i?this.createView():i)!==i&&(void 0===e&&(e=null),null!==i&&(this.deactivateLayout(),this.willDetachView(i),this.view=null,this.onDetachView(i),this.deinitView(i),this.didDetachView(i)),this.willAttachView(t,e),this.view=t,this.onAttachView(t,e),this.initView(t),this.didAttachView(t,e)),t},i.prototype.detachView=function(){const t=this.view;return null!==t&&(this.deactivateLayout(),this.willDetachView(t),this.view=null,this.onDetachView(t),this.deinitView(t),this.didDetachView(t)),t},i.prototype.insertView=function(t,e,i,n){if(null!=e)e=this.fromAny(e);else{const t=this.view;e=null===t?this.createView():t}null==t&&(t=this.parentView),void 0===i&&(i=null),void 0===n&&(n=this.key),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const o=this.view;return e!==o&&(null!==o&&(this.deactivateLayout(),this.willDetachView(o),this.view=null,this.onDetachView(o),this.deinitView(o),this.didDetachView(o),o.remove()),this.willAttachView(e,i),this.view=e,this.onAttachView(e,i),this.initView(e),this.didAttachView(e,i)),e},i.prototype.removeView=function(){const t=this.view;return null!==t&&t.remove(),t},i.prototype.deleteView=function(){const t=this.detachView();return null!==t&&t.remove(),t},i.prototype.bindView=function(t,e){if(this.binds&&null===this.view){const i=this.detectView(t);null!==i&&(this.willAttachView(i,e),this.view=i,this.onAttachView(i,e),this.initView(i),this.didAttachView(i,e))}},i.prototype.unbindView=function(t){if(this.binds){const e=this.detectView(t);null!==e&&this.view===e&&(this.deactivateLayout(),this.willDetachView(e),this.view=null,this.onDetachView(e),this.deinitView(e),this.didDetachView(e))}},i.prototype.detectView=function(t){const e=this.key;return void 0!==e&&e===t.key?t:null},i.prototype.constraint=function(t,e,i,n){t=a.ConstraintExpression.fromAny(t),void 0!==i&&(i=a.ConstraintExpression.fromAny(i));const o=void 0!==i?t.minus(i):t;n=void 0===n?a.ConstraintStrength.Required:a.ConstraintStrength.fromAny(n);const s=new a.Constraint(this.owner,o,e,n);return this.addConstraint(s),s},i.prototype.hasConstraint=function(t){return this.constraints.indexOf(t)>=0},i.prototype.addConstraint=function(t){const i=this.constraints,n=e.Arrays.inserted(t,i);i!==n&&(this.constraints=n,this.activateConstraint(t))},i.prototype.removeConstraint=function(t){const i=this.constraints,n=e.Arrays.removed(t,i);i!==n&&(this.deactivateConstraint(t),this.constraints=n)},i.prototype.activateConstraint=function(t){this.owner.activateConstraint(t)},i.prototype.deactivateConstraint=function(t){this.owner.deactivateConstraint(t)},i.prototype.constraintVariable=function(t,e,i){void 0===e&&(e=0),i=void 0!==i?a.ConstraintStrength.fromAny(i):a.ConstraintStrength.Strong;const n=a.ConstraintProperty.create(this);return Object.defineProperty(n,"name",{value:t,configurable:!0}),void 0!==e&&n.setValue(e),n.setStrength(i),n.mount(),n},i.prototype.hasConstraintVariable=function(t){return this.constraintVariables.indexOf(t)>=0},i.prototype.addConstraintVariable=function(t){const i=this.constraintVariables,n=e.Arrays.inserted(t,i);i!==n&&(this.constraintVariables=n,this.activateConstraintVariable(t))},i.prototype.removeConstraintVariable=function(t){const i=this.constraintVariables,n=e.Arrays.removed(t,i);i!==n&&(this.deactivateConstraintVariable(t),this.constraintVariables=n)},i.prototype.activateConstraintVariable=function(t){this.owner.activateConstraintVariable(t)},i.prototype.deactivateConstraintVariable=function(t){this.owner.deactivateConstraintVariable(t)},i.prototype.setConstraintVariable=function(t,e){this.owner.setConstraintVariable(t,e)},i.prototype.activateLayout=function(){const t=this.constraintVariables;for(let e=0,i=t.length;e<i;e+=1)this.owner.activateConstraintVariable(t[e]);const e=this.constraints;for(let t=0,i=e.length;t<i;t+=1)this.owner.activateConstraint(e[t])},i.prototype.deactivateLayout=function(){const t=this.constraints;for(let e=0,i=t.length;e<i;e+=1)this.owner.deactivateConstraint(t[e]);const e=this.constraintVariables;for(let t=0,i=e.length;t<i;t+=1)this.owner.deactivateConstraintVariable(e[t])},i.prototype.onMount=function(){t.prototype.onMount.call(this),this.activateLayout()},i.prototype.onUnmount=function(){this.deactivateLayout(),t.prototype.onUnmount.call(this)},i.construct=function(i,n,o){return null===n&&(delete(n=function(t,e,i){return void 0===t?n.view:(n.setView(t,e,i),n.owner)}).name,Object.setPrototypeOf(n,i.prototype)),(n=t.construct(i,n,o)).view=null,n.constraints=e.Arrays.empty,n.constraintVariables=e.Arrays.empty,n},i.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,!0===e.key?Object.defineProperty(e,"key",{value:t,configurable:!0}):!1===e.key&&Object.defineProperty(e,"key",{value:void 0,configurable:!0}),null==i&&(i=this);const s=i.extend(t,e);return s.construct=function(t,e,s){return e=i.construct(t,e,s),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),e},s},i}(fn),vn=function(t){const e=t.extend("ViewSet");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.hasView=function(t){return void 0!==this.views[t.uid]},e.prototype.addView=function(t,e,i){let n;t=null!=t?this.fromAny(t):this.createView(),void 0===e&&(e=null),this.binds&&(n=this.parentView,null!==n)&&(void 0===i&&(i=this.key(t)),this.insertChild(n,t,e,i));const o=this.views;return void 0===o[t.uid]&&(this.willAttachView(t,e),o[t.uid]=t,this.viewCount+=1,this.onAttachView(t,e),this.initView(t),this.didAttachView(t,e)),t},e.prototype.attachView=function(t,e){t=null!=t?this.fromAny(t):this.createView();const i=this.views;return void 0===i[t.uid]&&(void 0===e&&(e=null),this.willAttachView(t,e),i[t.uid]=t,this.viewCount+=1,this.onAttachView(t,e),this.initView(t),this.didAttachView(t,e)),t},e.prototype.detachView=function(t){const e=this.views;return void 0!==e[t.uid]?(this.willDetachView(t),this.viewCount-=1,delete e[t.uid],this.onDetachView(t),this.deinitView(t),this.didDetachView(t),t):null},e.prototype.insertView=function(t,e,i,n){e=null!=e?this.fromAny(e):this.createView(),null==t&&(t=this.parentView),void 0===i&&(i=null),void 0===n&&(n=this.key(e)),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const o=this.views;return void 0===o[e.uid]&&(this.willAttachView(e,i),o[e.uid]=e,this.viewCount+=1,this.onAttachView(e,i),this.initView(e),this.didAttachView(e,i)),e},e.prototype.removeView=function(t){return this.hasView(t)?(t.remove(),t):null},e.prototype.deleteView=function(t){const e=this.detachView(t);return null!==e&&e.remove(),e},e.prototype.bindView=function(t,e){if(this.binds){const i=this.detectView(t),n=this.views;null!==i&&void 0===n[i.uid]&&(this.willAttachView(i,e),n[i.uid]=i,this.viewCount+=1,this.onAttachView(i,e),this.initView(i),this.didAttachView(i,e))}},e.prototype.unbindView=function(t){if(this.binds){const e=this.detectView(t),i=this.views;null!==e&&void 0!==i[e.uid]&&(this.willDetachView(e),this.viewCount-=1,delete i[e.uid],this.onDetachView(e),this.deinitView(e),this.didDetachView(e))}},e.prototype.detectView=function(t){return"function"==typeof this.type&&t instanceof this.type?t:null},e.prototype.key=function(t){},Object.defineProperty(e.prototype,"sorted",{get(){return 0!=(this.flags&e.SortedFlag)},configurable:!0}),e.prototype.initInherits=function(t){this.flags=t?this.flags|e.SortedFlag:this.flags&~e.SortedFlag},e.prototype.sort=function(t){void 0===t&&(t=!0);const i=this.flags;if(t&&0==(i&e.SortedFlag)){const t=this.parentView;this.willSort(t),this.setFlags(i|e.SortedFlag),this.onSort(t),this.didSort(t)}else t||0==(i&e.SortedFlag)||this.setFlags(i&~e.SortedFlag);return this},e.prototype.willSort=function(t){},e.prototype.onSort=function(t){null!==t&&this.sortChildren(t)},e.prototype.didSort=function(t){},e.prototype.sortChildren=function(t){t.sortChildren(this.compareChildren.bind(this))},e.prototype.compareChildren=function(t,e){const i=this.views,n=i[t.uid],o=i[e.uid];return void 0!==n&&void 0!==o?this.compare(n,o):void 0!==n?1:void 0!==o?-1:0},e.prototype.compare=function(t,e){return t.uid<e.uid?-1:t.uid>e.uid?1:0},e.construct=function(e,i,n){return null===i&&(delete(i=function(t){return i.addView(t),i.owner}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).views={},i.viewCount=0,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits,s=e.sorted;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,delete e.sorted,null==i&&(i=this);const r=i.extend(t,e);return r.construct=function(t,e,r){return e=i.construct(t,e,r),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),void 0!==s&&e.initSorted(s),e},r},e.SortedFlag=1<<t.FlagShift+0,e.FlagShift=t.FlagShift+1,e.FlagMask=(1<<e.FlagShift)-1,e}(fn);class wn extends i.Service{onAttachRoot(t){super.onAttachRoot(t),t instanceof Yn&&t.node.hasAttribute("swim-app")&&this.materializeView(t)}materializeView(t){const e=t.node.childNodes;for(let i=0;i<e.length;i+=1){const n=e[i],o=this.materializeNode(t,n);null!==o&&this.materializeView(o)}}materializeNode(t,e){return void 0!==e.view?e.view:e instanceof Element?this.materializeElement(t,e):e instanceof Text?this.materializeText(t,e):null}materializeElement(t,e){let i;const n=e.getAttribute("swim-view");if(null!==n&&(i=wn.eval(n),"function"!=typeof i))throw new TypeError(n);void 0===i&&(i=e instanceof HTMLElement?Xn:e instanceof SVGElement?_n:Yn);const o=new i(e),s=e.getAttribute("key");return t.injectChild(o,null,null!==s?s:void 0),o}materializeText(t,e){return null}static global(){return new wn}static boot(){const t=[],e=document.querySelectorAll("[swim-app]");for(let i=0;i<e.length;i+=1){const n=e[i];if(n instanceof HTMLElement){const e=wn.bootElement(n);t.push(e)}}return t}static bootElement(t){let e=t.view;if(void 0===e){let i;const n=t.getAttribute("swim-app");if(null!==n&&""!==n&&(i=wn.eval(n),"function"!=typeof i))throw new TypeError(n);if(void 0===i&&(i=t instanceof HTMLElement?Xn:t instanceof SVGElement?_n:Yn),e=new i(t),i.mount(e),void 0===e.domProvider)throw new Error("dom service not available")}return e}static eval(t){let e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0;const i=t.split(".");for(let t=0,n=i.length;"object"==typeof e&&null!==e&&t<n;t+=1){e=e[i[t]]}return e}}u([e.Lazy],wn,"global",null);const yn=function(t){const e=t.extend("DomProvider");return e.prototype.createService=function(){return wn.global()},e}(i.Provider),mn=function(t){const n=t.extend("AttributeAnimator");return Object.defineProperty(n.prototype,"attributeName",{get(){throw new Error("no attribute name")},configurable:!0}),Object.defineProperty(n.prototype,"attributeValue",{get:function(){const t=this.owner;if(t instanceof Yn){const e=t.getAttribute(this.attributeName);if(null!==e)try{return this.parse(e)}catch(t){}}},configurable:!0}),Object.defineProperty(n.prototype,"value",{get(){let t=this.ownValue;if(!this.definedValue(t)){const e=this.attributeValue;void 0!==e&&(t=e,this.setAffinity(i.Affinity.Extrinsic))}return t},set(t){this.ownValue=t},configurable:!0}),n.prototype.onSetValue=function(e,i){const n=this.owner;n instanceof Yn&&n.setAttribute(this.attributeName,e),t.prototype.onSetValue.call(this,e,i)},n.prototype.parse=function(){throw new Error},n.construct=function(e,i,n){return i=t.construct(e,i,n)},n.specialize=function(t){return t===String?bn:t===Number?Cn:t===Boolean?Sn:t===o.Length?An:t===B?xn:t===o.Transform?Tn:null},n.define=function(t,i){let n=i.extends;const o=i.affinity,s=i.inherits,r=i.look,l=i.value,a=i.initValue;delete i.extends,delete i.implements,delete i.affinity,delete i.inherits,delete i.look,delete i.value,delete i.initValue,null==n&&(n=this.specialize(i.type)),null===n&&(n=this,void 0===i.fromAny&&e.FromAny.is(i.type)&&(i.fromAny=i.type.fromAny));const h=n.extend(t,i);return h.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==o&&e.initAffinity(o),void 0!==s&&e.initInherits(s),void 0!==r&&(e.look=r),void 0!==a?(e.value=e.fromAny(a()),e.state=e.value):void 0!==l&&(e.value=e.fromAny(l),e.state=e.value),e},h},n}(zt),bn=function(t){const e=t.extend("StringAttributeAnimator");return e.prototype.parse=function(t){return t},e.prototype.fromAny=function(t){return t},e.prototype.equalValues=function(t,e){return t===e},e}(mn),Cn=function(t){const e=t.extend("NumberAttributeAnimator");return e.prototype.parse=function(t){const e=+t;return isFinite(e)?e:void 0},e.prototype.fromAny=function(t){if("number"==typeof t)return t;{const e=+t;return isFinite(e)?e:void 0}},e.prototype.equalValues=function(t,e){return t===e},e}(mn),Sn=function(t){const e=t.extend("BooleanAttributeAnimator");return e.prototype.parse=function(t){return!!t},e.prototype.fromAny=function(t){return!!t},e.prototype.equalValues=function(t,e){return t===e},e}(mn),An=function(t){const e=t.extend("LengthAttributeAnimator");return e.prototype.parse=function(t){return o.Length.parse(t)},e.prototype.fromAny=function(t){try{return o.Length.fromAny(t)}catch(t){return null}},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(mn),xn=function(t){const e=t.extend("ColorAttributeAnimator");return e.prototype.parse=function(t){return B.parse(t)},e.prototype.fromAny=function(t){try{return B.fromAny(t)}catch(t){return null}},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(mn),Tn=function(t){const e=t.extend("TransformAttributeAnimator");return e.prototype.parse=function(t){return o.Transform.parse(t)},e.prototype.fromAny=function(t){try{return o.Transform.fromAny(t)}catch(t){return null}},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(mn),Dn=function(t){const n=t.extend("StyleAnimator");return Object.defineProperty(n.prototype,"propertyNames",{get(){throw new Error("no property names")},configurable:!0}),Object.defineProperty(n.prototype,"propertyValue",{get:function(){let t;const e=this.owner;if(En.is(e)){let i=e.getStyle(this.propertyNames);if("undefined"!=typeof CSSStyleValue&&i instanceof CSSStyleValue){try{t=this.fromCssValue(i)}catch(t){}void 0===t&&(i=i.toString())}if("string"==typeof i&&0!==i.length)try{t=this.parse(i)}catch(t){}}return t},configurable:!0}),Object.defineProperty(n.prototype,"computedValue",{get:function(){let t;const e=this.owner;let i;if(En.is(e)&&(i=e.node,i instanceof Element)){const e=getComputedStyle(i),n=this.propertyNames;let o="";if("string"==typeof n)o=e.getPropertyValue(n);else for(let t=0,i=n.length;t<i&&0===o.length;t+=1)o=e.getPropertyValue(n[t]);if(0!==o.length)try{t=this.parse(o)}catch(t){}}return t},configurable:!0}),Object.defineProperty(n.prototype,"value",{get(){let t=this.ownValue;if(!this.definedValue(t)){const e=this.propertyValue;void 0!==e&&(t=e,this.setAffinity(i.Affinity.Extrinsic))}return t},set(t){this.ownValue=t},configurable:!0}),n.prototype.onSetValue=function(e,i){const n=this.owner;if(En.is(n)){const t=this.propertyNames;if("string"==typeof t)n.setStyle(t,e,this.priority);else for(let i=0,o=t.length;i<o;i+=1)n.setStyle(t[i],e,this.priority)}t.prototype.onSetValue.call(this,e,i)},n.prototype.setPriority=function(t){this.priority=t;const e=this.owner,i=this.value;if(En.is(e)&&this.definedValue(i)){const n=this.propertyNames;if("string"==typeof n)e.setStyle(n,i,t);else for(let o=0,s=n.length;o<s;o+=1)e.setStyle(n[o],i,t)}},n.prototype.parse=function(){throw new Error},n.prototype.fromCssValue=function(t){throw new Error},n.construct=function(e,i,n){return(i=t.construct(e,i,n)).priority=void 0,i},n.specialize=function(t){return t===String?Vn:t===Number?Pn:t===o.Length?In:t===B?Mn:t===F?Ln:t===st?kn:t===o.Transform?Fn:null},n.define=function(t,i){let n=i.extends;const o=i.affinity,s=i.inherits,r=i.look,l=i.value,a=i.initValue;delete i.extends,delete i.implements,delete i.affinity,delete i.inherits,delete i.look,delete i.value,delete i.initValue,null==n&&(n=this.specialize(i.type)),null===n&&(n=this,void 0===i.fromAny&&e.FromAny.is(i.type)&&(i.fromAny=i.type.fromAny));const h=n.extend(t,i);return h.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==o&&e.initAffinity(o),void 0!==s&&e.initInherits(s),void 0!==r&&(e.look=r),void 0!==a?(e.value=e.fromAny(a()),e.state=e.value):void 0!==l&&(e.value=e.fromAny(l),e.state=e.value),e},h},n}(zt),Vn=function(t){const e=t.extend("StringStyleAnimator");return e.prototype.parse=function(t){return t},e.prototype.fromCssValue=function(t){return t.toString()},e.prototype.fromAny=function(t){return t},e.prototype.equalValues=function(t,e){return t===e},e}(Dn),Pn=function(t){const e=t.extend("NumberStyleAnimator");return e.prototype.parse=function(t){const e=+t;return isFinite(e)?e:void 0},e.prototype.fromCssValue=function(t){return t instanceof CSSNumericValue?t.to("number").value:void 0},e.prototype.fromAny=function(t){if("number"==typeof t)return t;{const e=+t;return isFinite(e)?e:void 0}},e.prototype.equalValues=function(t,e){return t===e},e}(Dn),In=function(t){const e=t.extend("LengthStyleAnimator");return e.prototype.parse=function(t){return o.Length.parse(t)},e.prototype.fromCssValue=function(t){return o.Length.fromCssValue(t)},e.prototype.fromAny=function(t){try{return o.Length.fromAny(t)}catch(t){return null}},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(Dn),Mn=function(t){const e=t.extend("ColorStyleAnimator");return e.prototype.parse=function(t){return B.parse(t)},e.prototype.fromAny=function(t){try{return B.fromAny(t)}catch(t){return null}},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(Dn),Ln=function(t){const e=t.extend("FontFamilyStyleAnimator");return e.prototype.parse=function(t){return O.parse(t).family},e.prototype.fromAny=function(t){return O.family(t).family},e}(Dn),kn=function(t){const e=t.extend("BoxShadowStyleAnimator");return e.prototype.parse=function(t){return st.parse(t)},e.prototype.fromAny=function(t){return st.fromAny(t)},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(Dn),Fn=function(t){const e=t.extend("TransformStyleAnimator");return e.prototype.parse=function(t){return o.Transform.parse(t)},e.prototype.fromCssValue=function(t){return o.Transform.fromCssValue(t)},e.prototype.fromAny=function(t){try{return o.Transform.fromAny(t)}catch(t){return null}},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(Dn),Rn=function(t){const n=t.extend("StyleConstraintAnimator");return n.prototype.isExternal=function(){return!0},n.prototype.isDummy=function(){return!1},n.prototype.isInvalid=function(){return!1},n.prototype.isConstant=function(){return!1},n.prototype.evaluateConstraintVariable=function(){const t=this.owner;if(a.ConstraintScope.is(t)&&!this.constrained&&this.constraining){const e=this.constraintValue;void 0!==e&&this.definedValue(e)&&t.setConstraintVariable(this,this.toNumber(e))}},n.prototype.updateConstraintSolution=function(t){this.constrained&&this.toNumber(this.state)!==t&&this.setState(t,i.Affinity.Reflexive)},n.prototype.setStrength=function(t){this.strength=a.ConstraintStrength.fromAny(t)},Object.defineProperty(n.prototype,"coefficient",{get:()=>1,configurable:!0}),Object.defineProperty(n.prototype,"variable",{get(){return this},configurable:!0}),Object.defineProperty(n.prototype,"terms",{get(){const t=new a.ConstraintMap;return t.set(this,1),t},configurable:!0}),Object.defineProperty(n.prototype,"constant",{get:()=>0,configurable:!0}),n.prototype.plus=function(t){return this===(t=a.ConstraintExpression.fromAny(t))?a.ConstraintExpression.product(2,this):a.ConstraintExpression.sum(this,t)},n.prototype.negative=function(){return a.ConstraintExpression.product(-1,this)},n.prototype.minus=function(t){return this===(t=a.ConstraintExpression.fromAny(t))?a.ConstraintExpression.zero:a.ConstraintExpression.sum(this,t.negative())},n.prototype.times=function(t){return a.ConstraintExpression.product(t,this)},n.prototype.divide=function(t){return a.ConstraintExpression.product(1/t,this)},Object.defineProperty(n.prototype,"constrained",{get(){return 0!=(this.flags&n.ConstrainedFlag)},configurable:!0}),n.prototype.constrain=function(t){void 0===t&&(t=!0);const e=this.flags;return t&&0==(e&n.ConstrainedFlag)?(this.setFlags(e|n.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&this.stopConstraining()):t||0==(e&n.ConstrainedFlag)||(this.setFlags(e&~n.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())),this},n.prototype.addConstraintCondition=function(t,e){this.conditionCount+=1,!this.constrained&&1===this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())},n.prototype.removeConstraintCondition=function(t,e){this.conditionCount-=1,!this.constrained&&0===this.conditionCount&&this.mounted&&this.stopConstraining()},Object.defineProperty(n.prototype,"constraining",{get(){return 0!=(this.flags&n.ConstrainingFlag)},configurable:!0}),n.prototype.startConstraining=function(){0==(this.flags&n.ConstrainingFlag)&&(this.willStartConstraining(),this.setFlags(this.flags|n.ConstrainingFlag),this.onStartConstraining(),this.didStartConstraining())},n.prototype.willStartConstraining=function(){},n.prototype.onStartConstraining=function(){const t=this.owner;a.ConstraintScope.is(t)&&t.addConstraintVariable(this)},n.prototype.didStartConstraining=function(){},n.prototype.stopConstraining=function(){0!=(this.flags&n.ConstrainingFlag)&&(this.willStopConstraining(),this.setFlags(this.flags&~n.ConstrainingFlag),this.onStopConstraining(),this.didStopConstraining())},n.prototype.willStopConstraining=function(){},n.prototype.onStopConstraining=function(){const t=this.owner;a.ConstraintScope.is(t)&&t.removeConstraintVariable(this)},n.prototype.didStopConstraining=function(){},n.prototype.updateConstraintVariable=function(){const t=this.owner;if(a.ConstraintScope.is(t)){let e=this.value;this.definedValue(e)||(e=this.constraintValue),t.setConstraintVariable(this,this.toNumber(e))}},n.prototype.onSetValue=function(e,i){t.prototype.onSetValue.call(this,e,i);const n=this.owner;this.constraining&&a.ConstraintScope.is(n)&&n.setConstraintVariable(this,null!=e?this.toNumber(e):0)},n.prototype.onMount=function(){t.prototype.onMount.call(this),this.constrained||0===this.conditionCount||this.startConstraining()},n.prototype.onUnmount=function(){this.constrained||0===this.conditionCount||this.stopConstraining(),t.prototype.onUnmount.call(this)},n.prototype.fromAny=function(t){if("string"==typeof t){const e=+t;if(isFinite(e))return e}return t},n.prototype.toNumber=function(t){return null!=t?+t:0},n.construct=function(e,i,n){return(i=t.construct(e,i,n)).id=a.ConstraintId.next(),i.strength=a.ConstraintStrength.Strong,i.conditionCount=0,i},n.specialize=function(t){return t===Number?On:t===o.Length?Wn:null},n.define=function(t,i){let n=i.extends;const o=i.affinity,s=i.inherits,r=void 0!==i.strength?a.ConstraintStrength.fromAny(i.strength):void 0,l=i.constrain,h=i.look,c=i.value,d=i.initValue;delete i.extends,delete i.implements,delete i.affinity,delete i.inherits,delete i.strength,delete i.constrain,delete i.look,delete i.value,delete i.initValue,null==n&&(n=this.specialize(i.type)),null===n&&(n=this,void 0===i.fromAny&&e.FromAny.is(i.type)&&(i.fromAny=i.type.fromAny));const u=n.extend(t,i);return u.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==o&&e.initAffinity(o),void 0!==s&&e.initInherits(s),void 0!==r&&(e.strength=r),void 0!==h&&(e.look=h),void 0!==d?(e.value=e.fromAny(d()),e.state=e.value):void 0!==c&&(e.value=e.fromAny(c),e.state=e.value),!0===l&&e.constrain(),e},u},n.ConstrainedFlag=1<<t.FlagShift+0,n.ConstrainingFlag=1<<t.FlagShift+1,n.FlagShift=t.FlagShift+2,n.FlagMask=(1<<n.FlagShift)-1,n}(Dn),On=function(t){const e=t.extend("NumberStyleConstraintAnimator");return e.prototype.toNumber=function(t){return"number"==typeof t?t:0},e.prototype.parse=function(t){const e=+t;return isFinite(e)?e:void 0},e.prototype.fromCssValue=function(t){return t instanceof CSSNumericValue?t.to("number").value:void 0},e.prototype.fromAny=function(t){if("number"==typeof t)return t;{const e=+t;return isFinite(e)?e:void 0}},e.prototype.equalValues=function(t,e){return t===e},e}(Rn),Wn=function(t){const e=t.extend("LengthStyleConstraintAnimator");return e.prototype.toNumber=function(t){if(!(t instanceof o.PxLength)){const e=this.computedValue;null!=e&&(t=e)}return t instanceof o.PxLength?t.value:0},e.prototype.parse=function(t){return o.Length.parse(t)},e.prototype.fromCssValue=function(t){return o.Length.fromCssValue(t)},e.prototype.fromAny=function(t){try{return o.Length.fromAny(t)}catch(t){return null}},e.prototype.equalValues=function(t,e){return null!=t?t.equals(e):t===e},e}(Rn),En=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){return"getStyle"in t}return!1}};return t}(),Nn=function(){const t={};function i(t,i,n){if(void 0===t){const t=this.borderTopColor.value,i=this.borderRightColor.value,n=this.borderBottomColor.value,o=this.borderLeftColor.value;return e.Values.equal(t,i)&&e.Values.equal(i,n)&&e.Values.equal(n,o)?t:[t,i,n,o]}return Array.isArray(t)?(t.length>=1&&this.borderTopColor.setState(t[0],i,n),t.length>=2&&this.borderRightColor.setState(t[1],i,n),t.length>=3&&this.borderBottomColor.setState(t[2],i,n),t.length>=4&&this.borderLeftColor.setState(t[3],i,n)):(this.borderTopColor.setState(t,i,n),this.borderRightColor.setState(t,i,n),this.borderBottomColor.setState(t,i,n),this.borderLeftColor.setState(t,i,n)),this}function n(t,i,n){if(void 0===t){const t=this.borderTopLeftRadius.value,i=this.borderTopRightRadius.value,n=this.borderBottomRightRadius.value,o=this.borderBottomLeftRadius.value;return e.Equals(t,i)&&e.Equals(i,n)&&e.Equals(n,o)?t:[t,i,n,o]}return Array.isArray(t)?(t.length>=1&&this.borderTopLeftRadius.setState(t[0],i,n),t.length>=2&&this.borderTopRightRadius.setState(t[1],i,n),t.length>=3&&this.borderBottomRightRadius.setState(t[2],i,n),t.length>=4&&this.borderBottomLeftRadius.setState(t[3],i,n)):(this.borderTopLeftRadius.setState(t,i,n),this.borderTopRightRadius.setState(t,i,n),this.borderBottomRightRadius.setState(t,i,n),this.borderBottomLeftRadius.setState(t,i,n)),this}function s(t,e,i){if(void 0===t){const t=this.borderTopStyle.value,e=this.borderRightStyle.value,i=this.borderBottomStyle.value,n=this.borderLeftStyle.value;return t===e&&e===i&&i===n?t:[t,e,i,n]}return Array.isArray(t)?(t.length>=1&&this.borderTopStyle.setState(t[0],e,i),t.length>=2&&this.borderRightStyle.setState(t[1],e,i),t.length>=3&&this.borderBottomStyle.setState(t[2],e,i),t.length>=4&&this.borderLeftStyle.setState(t[3],e,i)):(this.borderTopStyle.setState(t,e,i),this.borderRightStyle.setState(t,e,i),this.borderBottomStyle.setState(t,e,i),this.borderLeftStyle.setState(t,e,i)),this}function r(t,i,n){if(void 0===t){const t=this.borderTopWidth.value,i=this.borderRightWidth.value,n=this.borderBottomWidth.value,o=this.borderLeftWidth.value;return e.Values.equal(t,i)&&e.Values.equal(i,n)&&e.Values.equal(n,o)?t:[t,i,n,o]}return Array.isArray(t)?(t.length>=1&&this.borderTopWidth.setState(t[0],i,n),t.length>=2&&this.borderRightWidth.setState(t[1],i,n),t.length>=3&&this.borderBottomWidth.setState(t[2],i,n),t.length>=4&&this.borderLeftWidth.setState(t[3],i,n)):(this.borderTopWidth.setState(t,i,n),this.borderRightWidth.setState(t,i,n),this.borderBottomWidth.setState(t,i,n),this.borderLeftWidth.setState(t,i,n)),this}function l(t,e,i){if(void 0===t){const t=this.fontStyle.value,e=this.fontVariant.value,i=this.fontWeight.value,n=this.fontStretch.value,o=this.fontSize.value,s=this.lineHeight.value,r=this.fontFamily.value;return void 0!==r?O.create(t,e,i,n,o,s,r):null}return null!==t?(void 0!==(t=O.fromAny(t)).style&&this.fontStyle.setState(t.style,e,i),void 0!==t.variant&&this.fontVariant.setState(t.variant,e,i),void 0!==t.weight&&this.fontWeight.setState(t.weight,e,i),void 0!==t.stretch&&this.fontStretch.setState(t.stretch,e,i),void 0!==t.size&&this.fontSize.setState(t.size,e,i),void 0!==t.height&&this.lineHeight.setState(t.height,e,i),this.fontFamily.setState(t.family,e,i)):(this.fontStyle.setState(void 0,e,i),this.fontVariant.setState(void 0,e,i),this.fontWeight.setState(void 0,e,i),this.fontStretch.setState(void 0,e,i),this.fontSize.setState(null,e,i),this.lineHeight.setState(null,e,i),this.fontFamily.setState(void 0,e,i)),this}function a(t,i,n){if(void 0===t){const t=this.marginTop.value,i=this.marginRight.value,n=this.marginBottom.value,o=this.marginLeft.value;return e.Values.equal(t,i)&&e.Values.equal(i,n)&&e.Values.equal(n,o)?t:[t,i,n,o]}return Array.isArray(t)?(t.length>=1&&this.marginTop.setState(t[0],i,n),t.length>=2&&this.marginRight.setState(t[1],i,n),t.length>=3&&this.marginBottom.setState(t[2],i,n),t.length>=4&&this.marginLeft.setState(t[3],i,n)):(this.marginTop.setState(t,i,n),this.marginRight.setState(t,i,n),this.marginBottom.setState(t,i,n),this.marginLeft.setState(t,i,n)),this}function h(t,e,i){if(void 0===t){const t=this.overflowX.value,e=this.overflowY.value;return t===e?t:[t,e]}return Array.isArray(t)?(t.length>=1&&this.overflowX.setState(t[0],e,i),t.length>=2&&this.overflowY.setState(t[1],e,i)):(this.overflowX.setState(t,e,i),this.overflowY.setState(t,e,i)),this}function c(t,e,i){if(void 0===t){const t=this.overscrollBehaviorX.value,e=this.overscrollBehaviorY.value;return t===e?t:[t,e]}return Array.isArray(t)?(t.length>=1&&this.overscrollBehaviorX.setState(t[0],e,i),t.length>=2&&this.overscrollBehaviorY.setState(t[1],e,i)):(this.overscrollBehaviorX.setState(t,e,i),this.overscrollBehaviorY.setState(t,e,i)),this}function d(t,i,n){if(void 0===t){const t=this.paddingTop.value,i=this.paddingRight.value,n=this.paddingBottom.value,o=this.paddingLeft.value;return e.Equals(t,i)&&e.Equals(i,n)&&e.Equals(n,o)?t:[t,i,n,o]}return Array.isArray(t)?(t.length>=1&&this.paddingTop.setState(t[0],i,n),t.length>=2&&this.paddingRight.setState(t[1],i,n),t.length>=3&&this.paddingBottom.setState(t[2],i,n),t.length>=4&&this.paddingLeft.setState(t[3],i,n)):(this.paddingTop.setState(t,i,n),this.paddingRight.setState(t,i,n),this.paddingBottom.setState(t,i,n),this.paddingLeft.setState(t,i,n)),this}return t.init=function(t,e){void 0!==e.alignContent&&(e.alignContent,t.alignContent(e.alignContent)),void 0!==e.alignItems&&t.alignItems(e.alignItems),void 0!==e.alignSelf&&t.alignSelf(e.alignSelf),void 0!==e.appearance&&t.appearance(e.appearance),void 0!==e.backdropFilter&&t.backdropFilter(e.backdropFilter),void 0!==e.backgroundClip&&t.backgroundClip(e.backgroundClip),void 0!==e.backgroundColor&&t.backgroundColor(e.backgroundColor),void 0!==e.backgroundImage&&t.backgroundImage(e.backgroundImage),void 0!==e.borderCollapse&&t.borderCollapse(e.borderCollapse),void 0!==e.borderColor&&t.borderColor(e.borderColor),void 0!==e.borderTopColor&&t.borderTopColor(e.borderTopColor),void 0!==e.borderRightColor&&t.borderRightColor(e.borderRightColor),void 0!==e.borderBottomColor&&t.borderBottomColor(e.borderBottomColor),void 0!==e.borderLeftColor&&t.borderLeftColor(e.borderLeftColor),void 0!==e.borderRadius&&t.borderRadius(e.borderRadius),void 0!==e.borderTopLeftRadius&&t.borderTopLeftRadius(e.borderTopLeftRadius),void 0!==e.borderTopRightRadius&&t.borderTopRightRadius(e.borderTopRightRadius),void 0!==e.borderBottomRightRadius&&t.borderBottomRightRadius(e.borderBottomRightRadius),void 0!==e.borderBottomLeftRadius&&t.borderBottomLeftRadius(e.borderBottomLeftRadius),void 0!==e.borderSpacing&&t.borderSpacing(e.borderSpacing),void 0!==e.borderStyle&&t.borderStyle(e.borderStyle),void 0!==e.borderTopStyle&&t.borderTopStyle(e.borderTopStyle),void 0!==e.borderRightStyle&&t.borderRightStyle(e.borderRightStyle),void 0!==e.borderBottomStyle&&t.borderBottomStyle(e.borderBottomStyle),void 0!==e.borderLeftStyle&&t.borderLeftStyle(e.borderLeftStyle),void 0!==e.borderWidth&&t.borderWidth(e.borderWidth),void 0!==e.borderTopWidth&&t.borderTopWidth(e.borderTopWidth),void 0!==e.borderRightWidth&&t.borderRightWidth(e.borderRightWidth),void 0!==e.borderBottomWidth&&t.borderBottomWidth(e.borderBottomWidth),void 0!==e.borderLeftWidth&&t.borderLeftWidth(e.borderLeftWidth),void 0!==e.bottom&&t.bottom(e.bottom),void 0!==e.boxShadow&&t.boxShadow(e.boxShadow),void 0!==e.boxSizing&&t.boxSizing(e.boxSizing),void 0!==e.color&&t.color(e.color),void 0!==e.cursor&&t.cursor(e.cursor),void 0!==e.display&&t.display(e.display),void 0!==e.filter&&t.filter(e.filter),void 0!==e.flexBasis&&t.flexBasis(e.flexBasis),void 0!==e.flexDirection&&t.flexDirection(e.flexDirection),void 0!==e.flexGrow&&t.flexGrow(e.flexGrow),void 0!==e.flexShrink&&t.flexShrink(e.flexShrink),void 0!==e.flexWrap&&t.flexWrap(e.flexWrap),void 0!==e.font&&t.font(e.font),void 0!==e.fontFamily&&t.fontFamily(e.fontFamily),void 0!==e.fontSize&&t.fontSize(e.fontSize),void 0!==e.fontStretch&&t.fontStretch(e.fontStretch),void 0!==e.fontStyle&&t.fontStyle(e.fontStyle),void 0!==e.fontVariant&&t.fontVariant(e.fontVariant),void 0!==e.fontWeight&&t.fontWeight(e.fontWeight),void 0!==e.height&&t.height(e.height),void 0!==e.justifyContent&&t.justifyContent(e.justifyContent),void 0!==e.left&&t.left(e.left),void 0!==e.lineHeight&&t.lineHeight(e.lineHeight),void 0!==e.margin&&t.margin(e.margin),void 0!==e.marginTop&&t.marginTop(e.marginTop),void 0!==e.marginRight&&t.marginRight(e.marginRight),void 0!==e.marginBottom&&t.marginBottom(e.marginBottom),void 0!==e.marginLeft&&t.marginLeft(e.marginLeft),void 0!==e.maxHeight&&t.maxHeight(e.maxHeight),void 0!==e.maxWidth&&t.maxWidth(e.maxWidth),void 0!==e.minHeight&&t.minHeight(e.minHeight),void 0!==e.minWidth&&t.minWidth(e.minWidth),void 0!==e.opacity&&t.opacity(e.opacity),void 0!==e.order&&t.order(e.order),void 0!==e.outlineColor&&t.outlineColor(e.outlineColor),void 0!==e.outlineStyle&&t.outlineStyle(e.outlineStyle),void 0!==e.outlineWidth&&t.outlineWidth(e.outlineWidth),void 0!==e.overflow&&t.overflow(e.overflow),void 0!==e.overflowX&&t.overflowX(e.overflowX),void 0!==e.overflowY&&t.overflowY(e.overflowY),void 0!==e.overflowScrolling&&t.overflowScrolling(e.overflowScrolling),void 0!==e.overscrollBehavior&&t.overscrollBehavior(e.overscrollBehavior),void 0!==e.overscrollBehaviorX&&t.overscrollBehaviorX(e.overscrollBehaviorX),void 0!==e.overscrollBehaviorY&&t.overscrollBehaviorY(e.overscrollBehaviorY),void 0!==e.padding&&t.padding(e.padding),void 0!==e.paddingTop&&t.paddingTop(e.paddingTop),void 0!==e.paddingRight&&t.paddingRight(e.paddingRight),void 0!==e.paddingBottom&&t.paddingBottom(e.paddingBottom),void 0!==e.paddingLeft&&t.paddingLeft(e.paddingLeft),void 0!==e.pointerEvents&&t.pointerEvents(e.pointerEvents),void 0!==e.position&&t.position(e.position),void 0!==e.right&&t.right(e.right),void 0!==e.textAlign&&t.textAlign(e.textAlign),void 0!==e.textDecorationColor&&t.textDecorationColor(e.textDecorationColor),void 0!==e.textDecorationLine&&t.textDecorationLine(e.textDecorationLine),void 0!==e.textDecorationStyle&&t.textDecorationStyle(e.textDecorationStyle),void 0!==e.textOverflow&&t.textOverflow(e.textOverflow),void 0!==e.textTransform&&t.textTransform(e.textTransform),void 0!==e.top&&t.top(e.top),void 0!==e.touchAction&&t.touchAction(e.touchAction),void 0!==e.transform&&t.transform(e.transform),void 0!==e.userSelect&&t.userSelect(e.userSelect),void 0!==e.verticalAlign&&t.verticalAlign(e.verticalAlign),void 0!==e.visibility&&t.visibility(e.visibility),void 0!==e.whiteSpace&&t.whiteSpace(e.whiteSpace),void 0!==e.width&&t.width(e.width),void 0!==e.zIndex&&t.zIndex(e.zIndex)},t.define=function(t){Dn({propertyNames:"align-content",type:String})(t,"alignContent"),Dn({propertyNames:"align-items",type:String})(t,"alignItems"),Dn({propertyNames:"align-self",type:String})(t,"alignSelf"),Dn({propertyNames:["appearance","-webkit-appearance"],type:String})(t,"appearance"),Dn({propertyNames:["backdrop-filter","-webkit-backdrop-filter"],type:String})(t,"backdropFilter"),Dn({propertyNames:["background-clip","-webkit-background-clip"],type:String})(t,"backgroundClip"),Dn({propertyNames:"background-color",type:B,value:null})(t,"backgroundColor"),Dn({propertyNames:"background-image",type:B,value:null,parse(t){try{return et.parse(t)}catch(e){return t}},fromAny(t){if("string"!=typeof t)return et.fromAny(t);try{return et.parse(t)}catch(e){return t}}})(t,"backgroundImage"),Dn({propertyNames:"border-collapse",type:String})(t,"borderCollapse"),t.borderColor=i,Dn({propertyNames:"border-top-color",type:B,value:null})(t,"borderTopColor"),Dn({propertyNames:"border-right-color",type:B,value:null})(t,"borderRightColor"),Dn({propertyNames:"border-bottom-color",type:B,value:null})(t,"borderBottomColor"),Dn({propertyNames:"border-left-color",type:B,value:null})(t,"borderLeftColor"),t.borderRadius=n,Dn({propertyNames:"border-top-left-radius",type:o.Length,value:null})(t,"borderTopLeftRadius"),Dn({propertyNames:"border-top-right-radius",type:o.Length,value:null})(t,"borderTopRightRadius"),Dn({propertyNames:"border-bottom-right-radius",type:o.Length,value:null})(t,"borderBottomRightRadius"),Dn({propertyNames:"border-bottom-left-radius",type:o.Length,value:null})(t,"borderBottomLeftRadius"),Dn({propertyNames:"border-spacing",type:String})(t,"borderSpacing"),t.borderStyle=s,Dn({propertyNames:"border-top-style",type:String})(t,"borderTopStyle"),Dn({propertyNames:"border-right-style",type:String})(t,"borderRightStyle"),Dn({propertyNames:"border-bottom-style",type:String})(t,"borderBottomStyle"),Dn({propertyNames:"border-left-style",type:String})(t,"borderLeftStyle"),t.borderWidth=r,Dn({propertyNames:"border-top-width",type:o.Length,value:null})(t,"borderTopWidth"),Dn({propertyNames:"border-right-width",type:o.Length,value:null})(t,"borderRightWidth"),Dn({propertyNames:"border-bottom-width",type:o.Length,value:null})(t,"borderBottomWidth"),Dn({propertyNames:"border-left-width",type:o.Length,value:null})(t,"borderLeftWidth"),Rn({propertyNames:"bottom",type:o.Length,value:null,get constraintValue(){const t=this.owner.node;if(t instanceof HTMLElement){const e=t.offsetParent,i=null!==e?e.getBoundingClientRect():t===document.body?t.getBoundingClientRect():null;if(null!==i){const e=t.getBoundingClientRect();return o.Length.px(e.bottom-i.bottom)}}return null}})(t,"bottom"),Dn({propertyNames:"box-shadow",type:st,value:null})(t,"boxShadow"),Dn({propertyNames:"box-sizing",type:String})(t,"boxSizing"),Dn({propertyNames:"color",type:B,value:null})(t,"color"),Dn({propertyNames:"cursor",type:String})(t,"cursor"),Dn({propertyNames:"display",type:String})(t,"display"),Dn({propertyNames:"filter",type:String})(t,"filter"),Dn({propertyNames:"flex-basis",type:o.Length,value:null})(t,"flexBasis"),Dn({propertyNames:"flex-direction",type:String})(t,"flexDirection"),Dn({propertyNames:"flex-grow",type:Number})(t,"flexGrow"),Dn({propertyNames:"flex-shrink",type:Number})(t,"flexShrink"),Dn({propertyNames:"flex-wrap",type:String})(t,"flexWrap"),t.font=l,Dn({propertyNames:"font-family",type:F})(t,"fontFamily"),Dn({propertyNames:"font-size",type:o.Length,value:null})(t,"fontSize"),Dn({propertyNames:"font-stretch",type:String})(t,"fontStretch"),Dn({propertyNames:"font-style",type:String})(t,"fontStyle"),Dn({propertyNames:"font-variant",type:String})(t,"fontVariant"),Dn({propertyNames:"font-weight",type:String})(t,"fontWeight"),Rn({propertyNames:"height",type:o.Length,value:null,get constraintValue(){const t=this.owner.node;return t instanceof HTMLElement?o.Length.px(t.offsetHeight):null}})(t,"height"),Dn({propertyNames:"justify-content",type:String})(t,"justifyContent"),Rn({propertyNames:"left",type:o.Length,value:null,get constraintValue(){const t=this.owner.node;return t instanceof HTMLElement?o.Length.px(t.offsetLeft):null}})(t,"left"),Dn({propertyNames:"line-height",type:o.Length,value:null})(t,"lineHeight"),t.margin=a,Rn({propertyNames:"margin-top",type:o.Length,value:null})(t,"marginTop"),Rn({propertyNames:"margin-right",type:o.Length,value:null})(t,"marginRight"),Rn({propertyNames:"margin-bottom",type:o.Length,value:null})(t,"marginBottom"),Rn({propertyNames:"margin-left",type:o.Length,value:null})(t,"marginLeft"),Dn({propertyNames:"max-height",type:o.Length,value:null})(t,"maxHeight"),Dn({propertyNames:"max-width",type:o.Length,value:null})(t,"maxWidth"),Dn({propertyNames:"min-height",type:o.Length,value:null})(t,"minHeight"),Dn({propertyNames:"min-width",type:o.Length,value:null})(t,"minWidth"),Dn({propertyNames:"opacity",type:Number})(t,"opacity"),Dn({propertyNames:"order",type:Number})(t,"order"),Dn({propertyNames:"outline-color",type:B,value:null})(t,"outlineColor"),Dn({propertyNames:"outline-style",type:String})(t,"outlineStyle"),Dn({propertyNames:"outline-width",type:o.Length,value:null})(t,"outlineWidth"),t.overflow=h,Dn({propertyNames:"overflow-x",type:String})(t,"overflowX"),Dn({propertyNames:"overflow-y",type:String})(t,"overflowY"),Dn({propertyNames:"-webkit-overflow-scrolling",type:String})(t,"overflowScrolling"),t.overscrollBehavior=c,Dn({propertyNames:"overscroll-behavior-x",type:String})(t,"overscrollBehaviorX"),Dn({propertyNames:"overscroll-behavior-y",type:String})(t,"overscrollBehaviorY"),t.padding=d,Rn({propertyNames:"padding-top",type:o.Length,value:null})(t,"paddingTop"),Rn({propertyNames:"padding-right",type:o.Length,value:null})(t,"paddingRight"),Rn({propertyNames:"padding-bottom",type:o.Length,value:null})(t,"paddingBottom"),Rn({propertyNames:"padding-left",type:o.Length,value:null})(t,"paddingLeft"),Dn({propertyNames:"pointer-events",type:String})(t,"pointerEvents"),Dn({propertyNames:"position",type:String})(t,"position"),Rn({propertyNames:"right",type:o.Length,value:null,get constraintValue(){const t=this.owner.node;if(t instanceof HTMLElement){const e=t.offsetParent,i=null!==e?e.getBoundingClientRect():t===document.body?t.getBoundingClientRect():null;if(null!==i){const e=t.getBoundingClientRect();return o.Length.px(e.right-i.right)}}return null}})(t,"right"),Dn({propertyNames:"text-align",type:String})(t,"textAlign"),Dn({propertyNames:"text-decoration-color",type:B,value:null})(t,"textDecorationColor"),Dn({propertyNames:"text-decoration-line",type:String})(t,"textDecorationLine"),Dn({propertyNames:"text-decoration-style",type:String})(t,"textDecorationStyle"),Dn({propertyNames:"text-overflow",type:String})(t,"textOverflow"),Dn({propertyNames:"text-transform",type:String})(t,"textTransform"),Rn({propertyNames:"top",type:o.Length,value:null,get constraintValue(){const t=this.owner.node;return t instanceof HTMLElement?o.Length.px(t.offsetTop):null}})(t,"top"),Dn({propertyNames:"touch-action",type:String})(t,"touchAction"),Dn({propertyNames:"transform",type:o.Transform,value:null})(t,"transform"),Dn({propertyNames:["user-select","-webkit-user-select","-moz-user-select","-ms-user-select"],type:String})(t,"userSelect"),Dn({propertyNames:"vertical-align",type:String})(t,"verticalAlign"),Dn({propertyNames:"visibility",type:String})(t,"visibility"),Dn({propertyNames:"white-space",type:String})(t,"whiteSpace"),Rn({propertyNames:"width",type:o.Length,value:null,get constraintValue(){const t=this.owner.node;return t instanceof HTMLElement?o.Length.px(t.offsetWidth):null}})(t,"width"),Dn({propertyNames:"z-index",type:Number})(t,"zIndex")},t}(),Bn=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){return"getRule"in t}return!1}};return t}(),Un=function(t){const e=t.extend("CssRule");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.hasFastener=function(t,e){const i=this.fasteners;if(null!==i){const n=i[t];if(void 0!==n&&(null==e||n instanceof e))return!0}return!1},e.prototype.getFastener=function(t,e){const i=this.fasteners;if(null!==i){const n=i[t];if(void 0!==n&&(null==e||n instanceof e))return n}return null},e.prototype.setFastener=function(t,e){let i=this.fasteners;null===i&&(i={},this.fasteners=i);const n=i[t];void 0!==n&&this.mounted&&n.unmount(),null!==e?(i[t]=e,this.mounted&&e.mount()):delete i[t]},e.prototype.getLazyFastener=function(t,e){return i.FastenerContext.getLazyFastener(this,t,e)},e.prototype.getSuperFastener=function(e,i){return 0===arguments.length?t.prototype.getSuperFastener.call(this):null},e.prototype.mountFasteners=function(){const t=this.fasteners;for(const e in t){t[e].mount()}},e.prototype.unmountFasteners=function(){const t=this.fasteners;for(const e in t){t[e].unmount()}},e.prototype.requireUpdate=function(t){const e=this.owner;i.FastenerContext.has(e,"requireUpdate")&&e.requireUpdate(t)},e.prototype.decohereFastener=function(t){let e=this.decoherent;null===e&&(e=[],this.decoherent=e),e.push(t),0==(this.flags&i.Fastener.DecoherentFlag)&&(this.setCoherent(!1),this.decohere())},e.prototype.recohereFasteners=function(t){const e=this.decoherent;if(null!==e){const i=e.length;if(0!==i){this.decoherent=null;for(let n=0;n<i;n+=1){e[n].recohere(t)}}}},e.prototype.recohere=function(t){this.recohereFasteners(t),null===this.decoherent||0===this.decoherent.length?this.setCoherent(!0):(this.setCoherent(!1),this.decohere())},e.prototype.constraint=function(t,e,i,n){return this.owner.constraint(t,e,i,n)},e.prototype.hasConstraint=function(t){return this.owner.hasConstraint(t)},e.prototype.addConstraint=function(t){this.owner.addConstraint(t)},e.prototype.removeConstraint=function(t){this.owner.removeConstraint(t)},e.prototype.constraintVariable=function(t,e,i){return this.owner.constraintVariable(t,e,i)},e.prototype.hasConstraintVariable=function(t){return this.owner.hasConstraintVariable(t)},e.prototype.addConstraintVariable=function(t){this.owner.addConstraintVariable(t)},e.prototype.removeConstraintVariable=function(t){this.owner.removeConstraintVariable(t)},e.prototype.setConstraintVariable=function(t,e){this.owner.setConstraintVariable(t,e)},e.prototype.getLook=function(t,e){const i=this.owner;return Ut.is(i)?i.getLook(t,e):void 0},e.prototype.getLookOr=function(t,e,i){const n=this.owner;return Ut.is(n)?2===arguments.length?n.getLookOr(t,e):n.getLookOr(t,e,i):2===arguments.length?e:i},e.prototype.applyTheme=function(t,e,i){},e.prototype.onMount=function(){t.prototype.onMount.call(this),this.mountFasteners()},e.prototype.onUnmount=function(){this.unmountFasteners(),t.prototype.onUnmount.call(this)},e.prototype.createRule=function(t){const e=this.owner;if(Bn.is(e)){const i=e.insertRule(t),n=e.getRule(i);if(n instanceof CSSRule)return n;throw new TypeError(""+n)}throw new Error("no css context")},e.construct=function(e,n,o){return(n=t.construct(e,n,o)).fasteners=null,n.decoherent=null,n.rule=null,i.FastenerContext.init(n),n},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;let s=e.css;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,delete e.css,null==i&&(i=this);const r=i.extend(t,e);return"function"==typeof s&&(r.prototype.initCss=s,s=void 0),r.construct=function(t,e,r){let l;if(e=i.construct(t,e,r),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),void 0!==s)l=s;else{if(void 0===e.initCss)throw new Error("undefined css");l=e.initCss()}return e.rule=e.createRule(l),void 0!==e.initRule&&e.initRule(e.rule),e},r},e}(i.Fastener),zn=function(t){const i=t.extend("StyleRule");return Object.defineProperty(i.prototype,"selector",{get:function(){return this.rule.selectorText},configurable:!0}),i.prototype.setSelector=function(t){this.rule.selectorText=t},i.prototype.getStyle=function(t){if("undefined"!=typeof CSSStyleValue){const e=this.rule.styleMap;if("string"==typeof t)return e.get(t);for(let i=0,n=t.length;i<n;i+=1){const n=e.get(t[i]);if(void 0!==n)return n}return""}{const e=this.rule.style;if("string"==typeof t)return e.getPropertyValue(t);for(let i=0,n=t.length;i<n;i+=1){const n=e.getPropertyValue(t[i]);if(0!==n.length)return n}return""}},i.prototype.setStyle=function(t,e,i){if(this.willSetStyle(t,e,i),"undefined"!=typeof CSSStyleValue)if(null!=e){const n=bt(e);if(null!==n)try{this.rule.styleMap.set(t,n)}catch(t){}else this.rule.style.setProperty(t,mt(e),i)}else this.rule.styleMap.delete(t);else null!=e?this.rule.style.setProperty(t,mt(e),i):this.rule.style.removeProperty(t);return this.onSetStyle(t,e,i),this.didSetStyle(t,e,i),this},i.prototype.willSetStyle=function(t,e,i){},i.prototype.onSetStyle=function(t,e,i){},i.prototype.didSetStyle=function(t,e,i){},i.prototype.applyTheme=function(t,i,n){n=void 0===n||!0===n?t.getOr(St.timing,Ot.ambient,!1):e.Timing.fromAny(n);const o=this.fasteners;for(const e in o){const s=o[e];s instanceof zt&&s.applyTheme(t,i,n)}},i.prototype.createRule=function(t){const e=this.owner;if(Bn.is(e)){const i=e.insertRule(t),n=e.getRule(i);if(n instanceof CSSStyleRule)return n;throw new TypeError(""+n)}throw new Error("no css context")},Nn.define(i.prototype),i.construct=function(e,i,n){return null===i&&(delete(i=function(t,e){return void 0===e?i.getStyle(t):(i.setStyle(t,e),i.owner)}).name,Object.setPrototypeOf(i,e.prototype)),i=t.construct(e,i,n)},i.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;let s=e.css;const r=e.style;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,delete e.css,delete e.style,null==i&&(i=this);const l=i.extend(t,e);return"function"==typeof s&&(l.prototype.initCss=s,s=void 0),l.construct=function(t,e,l){let a;if(e=i.construct(t,e,l),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),void 0!==s)a=s;else{if(void 0===e.initCss)throw new Error("undefined css");a=e.initCss()}return e.rule=e.createRule(a),void 0!==e.initRule&&e.initRule(e.rule),void 0!==r&&Nn.init(e,r),e},l},i}(Un),qn=function(t){const i=t.extend("MediaRule");return i.prototype.getRule=function(t){return this.rule.cssRules.item(t)},i.prototype.insertRule=function(t,e){return this.rule.insertRule(t,e)},i.prototype.removeRule=function(t){this.rule.deleteRule(t)},i.prototype.applyTheme=function(t,i,n){n=void 0===n||!0===n?t.getOr(St.timing,Ot.ambient,!1):e.Timing.fromAny(n);const o=this.fasteners;for(const e in o){const s=o[e];s instanceof Un&&s.applyTheme(t,i,n)}},i.prototype.createRule=function(t){const e=this.owner;if(Bn.is(e)){const i=e.insertRule(t),n=e.getRule(i);if(n instanceof CSSMediaRule)return n;throw new TypeError(""+n)}throw new Error("no css context")},i.construct=function(e,i,n){return i=t.construct(e,i,n)},i.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;let s=e.css;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,delete e.css,null==i&&(i=this);const r=i.extend(t,e);return"function"==typeof s&&(r.prototype.initCss=s,s=void 0),r.construct=function(t,e,r){let l;if(e=i.construct(t,e,r),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),void 0!==s)l=s;else{if(void 0===e.initCss)throw new Error("undefined css");l=e.initCss()}return e.rule=e.createRule(l),void 0!==e.initRule&&e.initRule(e.rule),e},r},i}(Un),Gn=function(t){const n=t.extend("StyleSheet");return Object.defineProperty(n.prototype,"fastenerType",{get:function(){return n},configurable:!0}),n.prototype.getRule=function(t){return this.stylesheet.cssRules.item(t)},n.prototype.insertRule=function(t,e){return this.stylesheet.insertRule(t,e)},n.prototype.removeRule=function(t){this.stylesheet.deleteRule(t)},n.prototype.hasFastener=function(t,e){const i=this.fasteners;if(null!==i){const n=i[t];if(void 0!==n&&(null==e||n instanceof e))return!0}return!1},n.prototype.getFastener=function(t,e){const i=this.fasteners;if(null!==i){const n=i[t];if(void 0!==n&&(null==e||n instanceof e))return n}return null},n.prototype.setFastener=function(t,e){let i=this.fasteners;null===i&&(i={},this.fasteners=i);const n=i[t];void 0!==n&&this.mounted&&n.unmount(),null!==e?(i[t]=e,this.mounted&&e.mount()):delete i[t]},n.prototype.getLazyFastener=function(t,e){return i.FastenerContext.getLazyFastener(this,t,e)},n.prototype.getSuperFastener=function(e,i){return 0===arguments.length?t.prototype.getSuperFastener.call(this):null},n.prototype.mountFasteners=function(){const t=this.fasteners;for(const e in t){t[e].mount()}},n.prototype.unmountFasteners=function(){const t=this.fasteners;for(const e in t){t[e].unmount()}},n.prototype.requireUpdate=function(t){const e=this.owner;i.FastenerContext.has(e,"requireUpdate")&&e.requireUpdate(t)},n.prototype.decohereFastener=function(t){let e=this.decoherent;null===e&&(e=[],this.decoherent=e),e.push(t),0==(this.flags&i.Fastener.DecoherentFlag)&&(this.setCoherent(!1),this.decohere())},n.prototype.recohereFasteners=function(t){const e=this.decoherent;if(null!==e){const i=e.length;if(0!==i){this.decoherent=null;for(let n=0;n<i;n+=1){e[n].recohere(t)}}}},n.prototype.recohere=function(t){this.recohereFasteners(t),null===this.decoherent||0===this.decoherent.length?this.setCoherent(!0):(this.setCoherent(!1),this.decohere())},n.prototype.constraint=function(t,e,i,n){return this.owner.constraint(t,e,i,n)},n.prototype.hasConstraint=function(t){return this.owner.hasConstraint(t)},n.prototype.addConstraint=function(t){this.owner.addConstraint(t)},n.prototype.removeConstraint=function(t){this.owner.removeConstraint(t)},n.prototype.constraintVariable=function(t,e,i){return this.owner.constraintVariable(t,e,i)},n.prototype.hasConstraintVariable=function(t){return this.owner.hasConstraintVariable(t)},n.prototype.addConstraintVariable=function(t){this.owner.addConstraintVariable(t)},n.prototype.removeConstraintVariable=function(t){this.owner.removeConstraintVariable(t)},n.prototype.setConstraintVariable=function(t,e){this.owner.setConstraintVariable(t,e)},n.prototype.getLook=function(t,e){const i=this.owner;return Ut.is(i)?i.getLook(t,e):void 0},n.prototype.getLookOr=function(t,e,i){const n=this.owner;return Ut.is(n)?2===arguments.length?n.getLookOr(t,e):n.getLookOr(t,e,i):2===arguments.length?e:i},n.prototype.applyTheme=function(t,i,n){n=void 0===n||!0===n?t.getOr(St.timing,Ot.ambient,!1):e.Timing.fromAny(n);const o=this.fasteners;for(const e in o){const s=o[e];s instanceof Un&&s.applyTheme(t,i,n)}},n.prototype.onMount=function(){t.prototype.onMount.call(this),this.mountFasteners()},n.prototype.onUnmount=function(){this.unmountFasteners(),t.prototype.onUnmount.call(this)},n.prototype.createStylesheet=function(){return new CSSStyleSheet},n.construct=function(e,n,o){return(n=t.construct(e,n,o)).fasteners=null,n.decoherent=null,n.stylesheet=null,i.FastenerContext.init(n),n},n.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;let s=e.css;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,delete e.css,null==i&&(i=this);const r=i.extend(t,e);return"function"==typeof s&&(r.prototype.initCss=s,s=void 0),r.construct=function(t,e,s){return e=i.construct(t,e,s),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),e.stylesheet=e.createStylesheet(),void 0!==e.initStylesheet&&e.initStylesheet(e.stylesheet),e},r},n}(i.Fastener);class Hn extends pn{constructor(t){super(),this.node=t,t.view=this}setChild(t,e){const i=this.getChild(t);let n;if(e instanceof Node?e=Hn.fromNode(e):null!==e&&(e=pn.fromAny(e)),null!==i&&null!==e&&i!==e){if(e.remove(),n=i.nextSibling,0==(i.flags&pn.RemovingFlag)&&(i.setFlags(i.flags|pn.RemovingFlag),this.willRemoveChild(i),i.detachParent(this),this.removeChildMap(i),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0),i.setFlags(i.flags&~pn.RemovingFlag)),e.setKey(i.key),this.willInsertChild(e,n),e instanceof Hn)if(i instanceof Hn)this.node.replaceChild(e.node,i.node);else if(null!==n){let t=null,i=n;do{if(i instanceof Hn){t=i.node;break}i=i.nextSibling}while(null!==i);this.node.insertBefore(e.node,t)}else this.node.appendChild(e.node);else i instanceof Hn&&this.node.removeChild(i.node);this.insertChildMap(e),e.attachParent(this,n),this.onInsertChild(e,n),this.didInsertChild(e,n),e.cascadeInsert()}else if((e!==i||null!==e&&e.key!==t)&&(null!==i?(n=i.nextSibling,0==(i.flags&pn.RemovingFlag)&&(i.setFlags(i.flags|pn.RemovingFlag),this.willRemoveChild(i),i.detachParent(this),this.removeChildMap(i),i instanceof Hn&&this.node.removeChild(i.node),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0),i.setFlags(i.flags&~pn.RemovingFlag))):n=null,null!==e)){if(e.remove(),e.setKey(t),this.willInsertChild(e,n),e instanceof Hn){let t=null;if(null!==n){let e=n;do{if(e instanceof Hn){t=e.node;break}e=e.nextSibling}while(null!==e)}this.node.insertBefore(e.node,t)}this.insertChildMap(e),e.attachParent(this,n),this.onInsertChild(e,n),this.didInsertChild(e,n),e.cascadeInsert()}return i}appendChild(t,e){return(t=t instanceof Node?Hn.fromNode(t):pn.fromAny(t)).remove(),void 0!==e&&this.removeChild(e),t.setKey(e),this.willInsertChild(t,null),t instanceof Hn&&this.node.appendChild(t.node),this.insertChildMap(t),t.attachParent(this,null),this.onInsertChild(t,null),this.didInsertChild(t,null),t.cascadeInsert(),t}prependChild(t,e){(t=t instanceof Node?Hn.fromNode(t):pn.fromAny(t)).remove(),void 0!==e&&this.removeChild(e);const i=this.firstChild;return t.setKey(e),this.willInsertChild(t,i),t instanceof Hn&&this.node.insertBefore(t.node,this.node.firstChild),this.insertChildMap(t),t.attachParent(this,i),this.onInsertChild(t,i),this.didInsertChild(t,i),t.cascadeInsert(),t}insertChild(t,e,i){if(e instanceof pn&&e.parent!==this||e instanceof Node&&e.parentNode!==this.node)throw new TypeError(""+e);let n,o;if((t=t instanceof Node?Hn.fromNode(t):pn.fromAny(t)).remove(),void 0!==i&&this.removeChild(i),e instanceof Node){n=null,o=e;let t=e;do{if(void 0!==t.view){n=t.view;break}t=t.nextSibling}while(null!==t)}else n=e,o=null;if(t.setKey(i),this.willInsertChild(t,n),t instanceof Hn){if(null===o&&null!==n){let t=n;do{if(t instanceof Hn){o=t.node;break}t=t.nextSibling}while(null!==t)}this.node.insertBefore(t.node,o)}return this.insertChildMap(t),t.attachParent(this,n),this.onInsertChild(t,n),this.didInsertChild(t,n),t.cascadeInsert(),t}injectChild(t,e,i){if(e instanceof pn&&e.parent!==this||e instanceof Node&&e.parentNode!==this.node)throw new TypeError(""+e);if(t=Hn.fromAny(t),void 0!==i&&this.removeChild(i),e instanceof Node){let t=e;e=null;do{if(void 0!==t.view){e=t.view;break}t=t.nextSibling}while(null!==t)}return t.setKey(i),this.willInsertChild(t,e),this.insertChildMap(t),t.attachParent(this,e),this.onInsertChild(t,e),this.didInsertChild(t,e),t.cascadeInsert(),t}replaceChild(t,e){if(e.parent!==this)throw new TypeError(""+e);if((t=t instanceof Node?Hn.fromNode(t):pn.fromAny(t))!==e){t.remove();const i=e.nextSibling;if(0==(e.flags&pn.RemovingFlag)&&(e.setFlags(e.flags|pn.RemovingFlag),this.willRemoveChild(e),e.detachParent(this),this.removeChildMap(e),this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0),e.setFlags(e.flags&~pn.RemovingFlag)),t.setKey(e.key),this.willInsertChild(t,i),t instanceof Hn)if(e instanceof Hn)this.node.replaceChild(t.node,e.node);else if(null!==i){let e=null,n=i;do{if(n instanceof Hn){e=n.node;break}n=n.nextSibling}while(null!==n);this.node.insertBefore(t.node,e)}else this.node.appendChild(t.node);else e instanceof Hn&&this.node.removeChild(e.node);this.insertChildMap(t),t.attachParent(this,i),this.onInsertChild(t,i),this.didInsertChild(t,i),t.cascadeInsert()}return e}removeChild(t){let e;if("string"==typeof t){if(e=this.getChild(t),null===e)return null}else if(t instanceof Node){if(t.parentNode!==this.node)throw new Error("not a child node");if(void 0===t.view)return this.node.removeChild(t),t;e=t.view}else if(e=t,e.parent!==this)throw new Error("not a child");return 0==(e.flags&pn.RemovingFlag)&&(e.setFlags(e.flags|pn.RemovingFlag),this.willRemoveChild(e),e.detachParent(this),this.removeChildMap(e),e instanceof Hn&&this.node.removeChild(e.node),this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0),e.setFlags(e.flags&~pn.RemovingFlag)),e}removeChildren(){let t;for(;t=this.lastChild,null!==t;){if(0!=(t.flags&pn.RemovingFlag))throw new Error("inconsistent removeChildren");this.willRemoveChild(t),t.detachParent(this),this.removeChildMap(t),t instanceof Hn&&this.node.removeChild(t.node),this.onRemoveChild(t),this.didRemoveChild(t),t.setKey(void 0),t.setFlags(t.flags&~pn.RemovingFlag)}}static isRootView(t){for(;;){const e=t.parentNode;if(null===e)break;if(void 0!==e.view)return!1;t=e}return!0}static isNodeMounted(t){let e=t.isConnected;if("boolean"!=typeof e){const i=t.ownerDocument;if(null!==i){e=0==(i.compareDocumentPosition(t)&t.DOCUMENT_POSITION_DISCONNECTED)}else e=!1}return e}static mount(t){if(null===t.parent){const e=t.node.parentNode,i=null!==e&&void 0!==e.view?e.view:null;if(null!==i){let e=null,n=t.node.nextSibling;for(;null!==n;){if(void 0!==n.view){e=n.view;break}n=n.nextSibling}t.attachParent(i,e),t.cascadeInsert()}else t.mount()}}mount(){!this.mounted&&Hn.isNodeMounted(this.node)&&Hn.isRootView(this.node)&&(this.cascadeMount(),this.cascadeInsert())}text(t){return 0===arguments.length?(null===(t=this.node.textContent)&&(t=void 0),t):(void 0===t&&(t=null),this.node.textContent=t,this)}get parentTransform(){return o.Transform.identity()}get clientBounds(){const t=document.createRange();t.selectNode(this.node);const e=t.getBoundingClientRect();return t.detach(),new o.R2Box(e.left,e.top,e.right,e.bottom)}get pageBounds(){const t=document.createRange();t.selectNode(this.node);const e=t.getBoundingClientRect();t.detach();const i=window.pageXOffset,n=window.pageYOffset;return new o.R2Box(e.left+i,e.top+n,e.right+i,e.bottom+n)}dispatchEvent(t){return this.node.dispatchEvent(t)}on(t,e,i){return this.node.addEventListener(t,e,i),this}off(t,e,i){return this.node.removeEventListener(t,e,i),this}init(t){super.init(t),void 0!==t.text&&this.text(t.text)}static fromNode(t){let e=t.view;if(void 0===e)t instanceof Element?e=Yn.fromNode(t):t instanceof Text?e=jn.fromNode(t):(e=new this(t),this.mount(e));else if(!(e instanceof this))throw new TypeError(e+" not an instance of "+this);return e}static fromAny(t){if(null==t)return t;if(t instanceof pn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return t instanceof Node?this.fromNode(t):e.Creatable.is(t)?t.create():this.fromInit(t)}}u([i.Provider({extends:yn,type:wn,observes:!1,service:wn.global()})],Hn.prototype,"domProvider",void 0),Xi.insertModalView=function(t){const e=document.body,i=e.view;if(void 0!==i)i.appendChild(t);else{if(!(t instanceof Hn))throw new TypeError(""+t);e.appendChild(t.node),t.mount()}};class jn extends Hn{constructor(t){super(t)}init(t){super.init(t)}static create(t){void 0===t&&(t="");return new this(document.createTextNode(t))}static fromNode(t){let e=t.view;if(void 0===e)e=new this(t);else if(!(e instanceof this))throw new TypeError(e+" not an instance of "+this);return e}static fromAny(t){if(null==t)return t;if(t instanceof pn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return t instanceof Node?this.fromNode(t):"string"==typeof t?this.create(t):e.Creatable.is(t)?t.create():this.fromInit(t)}}class Yn extends Hn{constructor(t){super(t),this.initElement(t)}initElement(t){const e=t.getAttribute("swim-theme");if(null!==e&&""!==e){let t;if("auto"===e){t="dark"===Wi.detect().colorScheme?Nt.dark:Nt.light}else t=e.indexOf(".")<0?Nt[e]:wn.eval(e);if(!(t instanceof Bt))throw new TypeError("unknown swim-theme: "+e);this.theme.setValue(t,i.Affinity.Extrinsic)}}mountTheme(){if(super.mountTheme(),Hn.isRootView(this.node)){const t=this.themeProvider.service;null!=t&&(this.mood.hasAffinity(i.Affinity.Intrinsic)&&null===this.mood.value&&this.mood.setValue(t.mood,i.Affinity.Intrinsic),this.theme.hasAffinity(i.Affinity.Intrinsic)&&null===this.theme.value&&this.theme.setValue(t.theme,i.Affinity.Intrinsic))}}getAttribute(t){return this.node.getAttribute(t)}setAttribute(t,e){return this.willSetAttribute(t,e),null!=e?this.node.setAttribute(t,yt(e)):this.node.removeAttribute(t),this.onSetAttribute(t,e),this.didSetAttribute(t,e),this}willSetAttribute(t,e){const i=this.observerCache.viewWillSetAttributeObservers;if(void 0!==i)for(let n=0,o=i.length;n<o;n+=1){i[n].viewWillSetAttribute(t,e,this)}}onSetAttribute(t,e){}didSetAttribute(t,e){const i=this.observerCache.viewDidSetAttributeObservers;if(void 0!==i)for(let n=0,o=i.length;n<o;n+=1){i[n].viewDidSetAttribute(t,e,this)}}getStyle(t){if("undefined"==typeof CSSStyleValue){const e=this.node.style;if("string"==typeof t)return e.getPropertyValue(t);for(let i=0,n=t.length;i<n;i+=1){const n=e.getPropertyValue(t[i]);if(0!==n.length)return n}return""}{const e=this.node.attributeStyleMap;if("string"!=typeof t){for(let i=0,n=t.length;i<n;i+=1){const n=e.get(t[i]);if(void 0!==n)return n}return""}try{return e.get(t)}catch(t){return}}}setStyle(t,e,i){if(this.willSetStyle(t,e,i),"undefined"!=typeof CSSStyleValue)if(null!=e){const n=bt(e);if(null!==n)try{this.node.attributeStyleMap.set(t,n)}catch(t){}else this.node.style.setProperty(t,mt(e),i)}else this.node.attributeStyleMap.delete(t);else null!=e?this.node.style.setProperty(t,mt(e),i):this.node.style.removeProperty(t);return this.onSetStyle(t,e,i),this.didSetStyle(t,e,i),this}willSetStyle(t,e,i){const n=this.observerCache.viewWillSetStyleObservers;if(void 0!==n)for(let o=0,s=n.length;o<s;o+=1){n[o].viewWillSetStyle(t,e,i,this)}}onSetStyle(t,e,i){}didSetStyle(t,e,i){const n=this.observerCache.viewDidSetStyleObservers;if(void 0!==n)for(let o=0,s=n.length;o<s;o+=1){n[o].viewDidSetStyle(t,e,i,this)}}id(t){if(0==arguments.length){const t=this.getAttribute("id");return null!==t?t:void 0}return this.setAttribute("id",t),this}className(t){if(0===arguments.length){const t=this.getAttribute("class");return null!==t?t:void 0}return this.setAttribute("class",t),this}get classList(){return this.node.classList}hasClass(t){return this.node.classList.contains(t)}addClass(...t){const e=this.node.classList;for(let i=0,n=t.length;i<n;i+=1)e.add(t[i]);return this}removeClass(...t){const e=this.node.classList;for(let i=0,n=t.length;i<n;i+=1)e.remove(t[i]);return this}toggleClass(t,e){const i=this.node.classList;return void 0===e?i.toggle(t):!0===e?i.add(t):!1===e&&i.remove(t),this}get clientBounds(){const t=this.node.getBoundingClientRect();return new o.R2Box(t.left,t.top,t.right,t.bottom)}get pageBounds(){const t=this.node.getBoundingClientRect(),e=window.pageXOffset,i=window.pageYOffset;return new o.R2Box(t.left+e,t.top+i,t.right+e,t.bottom+i)}on(t,e,i){return this.node.addEventListener(t,e,i),this}off(t,e,i){return this.node.removeEventListener(t,e,i),this}onObserve(t){super.onObserve(t),void 0!==t.viewWillSetAttribute&&(this.observerCache.viewWillSetAttributeObservers=e.Arrays.inserted(t,this.observerCache.viewWillSetAttributeObservers)),void 0!==t.viewDidSetAttribute&&(this.observerCache.viewDidSetAttributeObservers=e.Arrays.inserted(t,this.observerCache.viewDidSetAttributeObservers)),void 0!==t.viewWillSetStyle&&(this.observerCache.viewWillSetStyleObservers=e.Arrays.inserted(t,this.observerCache.viewWillSetStyleObservers)),void 0!==t.viewDidSetStyle&&(this.observerCache.viewDidSetStyleObservers=e.Arrays.inserted(t,this.observerCache.viewDidSetStyleObservers))}onUnobserve(t){super.onUnobserve(t),void 0!==t.viewWillSetAttribute&&(this.observerCache.viewWillSetAttributeObservers=e.Arrays.removed(t,this.observerCache.viewWillSetAttributeObservers)),void 0!==t.viewDidSetAttribute&&(this.observerCache.viewDidSetAttributeObservers=e.Arrays.removed(t,this.observerCache.viewDidSetAttributeObservers)),void 0!==t.viewWillSetStyle&&(this.observerCache.viewWillSetStyleObservers=e.Arrays.removed(t,this.observerCache.viewWillSetStyleObservers)),void 0!==t.viewDidSetStyle&&(this.observerCache.viewDidSetStyleObservers=e.Arrays.removed(t,this.observerCache.viewDidSetStyleObservers))}init(t){super.init(t),void 0!==t.id&&this.id(t.id),void 0!==t.classList&&this.addClass(...t.classList)}static create(){let t=this.tag;return void 0===t&&(t="div"),this.fromTag(t)}static fromTag(t,e){let i;return void 0===e&&"svg"===t&&(e=_n.namespace),i=void 0!==e?document.createElementNS(e,t):document.createElement(t),this.fromNode(i)}static fromNode(t){let e=t.view;if(void 0===e)t instanceof HTMLElement?e=Xn.fromNode(t):t instanceof SVGElement?e=_n.fromNode(t):(e=new this(t),this.mount(e));else if(!(e instanceof this))throw new TypeError(e+" not an instance of "+this);return e}static fromAny(t){if(null==t)return t;if(t instanceof pn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return t instanceof Node?this.fromNode(t):"string"==typeof t?this.fromTag(t):e.Creatable.is(t)?t.create():this.fromInit(t)}}class Xn extends Yn{constructor(t){super(t)}setChild(t,e){return"string"==typeof e&&(e=Xn.fromTag(e)),super.setChild(t,e)}appendChild(t,e){return"string"==typeof t&&(t=Xn.fromTag(t)),super.appendChild(t,e)}prependChild(t,e){return"string"==typeof t&&(t=Xn.fromTag(t)),super.prependChild(t,e)}insertChild(t,e,i){return"string"==typeof t&&(t=Xn.fromTag(t)),super.insertChild(t,e,i)}replaceChild(t,e){return"string"==typeof t&&(t=Xn.fromTag(t)),super.replaceChild(t,e)}onApplyTheme(t,e,i){super.onApplyTheme(t,e,i),this.node.hasAttribute("swim-theme")&&this.applyRootTheme(t,e,i)}applyRootTheme(t,e,n){const o=t.getOr(St.font,Ot.ambient,null);null!==o&&(void 0!==o.style&&this.fontStyle.setState(o.style,void 0,0),void 0!==o.variant&&this.fontVariant.setState(o.variant,void 0,0),void 0!==o.weight&&this.fontWeight.setState(o.weight,void 0,0),void 0!==o.stretch&&this.fontStretch.setState(o.stretch,void 0,0),null!==o.size&&this.fontSize.setState(o.size,void 0,0),null!==o.height&&this.lineHeight.setState(o.height,void 0,0),this.fontFamily.setState(o.family,void 0,0)),this.backgroundColor.setState(t.getOr(St.backgroundColor,Ot.ambient,null),n,i.Affinity.Intrinsic),this.color.setState(t.getOr(St.color,Ot.ambient,null),n,i.Affinity.Intrinsic)}static isPositioned(t){const e=window.getComputedStyle(t);return"relative"===e.position||"absolute"===e.position}isPositioned(){return Xn.isPositioned(this.node)}static parentTransform(t){if(Xn.isPositioned(t)){const e=t.offsetLeft,i=t.offsetTop;if(0!==e||0!==i)return o.Transform.translate(-e,-i)}return o.Transform.identity()}static pageTransform(t){const e=t.parentNode;return e instanceof HTMLElement?Xn.pageTransform(e).transform(Xn.parentTransform(t)):o.Transform.identity()}get parentTransform(){const t=this.transform.value;if(null!==t)return t;if(this.isPositioned()){const t=this.node.offsetLeft,e=this.node.offsetTop;if(0!==t||0!==e)return o.Transform.translate(-t,-e)}return o.Transform.identity()}get pageTransform(){const t=this.parent;if(null!==t)return t.pageTransform.transform(this.parentTransform);{const t=this.node.parentNode;return t instanceof HTMLElement?Xn.pageTransform(t).transform(this.parentTransform):o.Transform.identity()}}on(t,e,i){return this.node.addEventListener(t,e,i),this}off(t,e,i){return this.node.removeEventListener(t,e,i),this}initAttributes(t){void 0!==t.autocomplete&&this.autocomplete(t.autocomplete),void 0!==t.checked&&this.checked(t.checked),void 0!==t.colspan&&this.colspan(t.colspan),void 0!==t.disabled&&this.disabled(t.disabled),void 0!==t.placeholder&&this.placeholder(t.placeholder),void 0!==t.rowspan&&this.rowspan(t.rowspan),void 0!==t.selected&&this.selected(t.selected),void 0!==t.title&&this.title(t.title),void 0!==t.type&&this.type(t.type),void 0!==t.value&&this.value(t.value)}initStyle(t){Nn.init(this,t)}init(t){super.init(t),void 0!==t.attributes&&this.initAttributes(t.attributes),void 0!==t.style&&this.initStyle(t.style)}static create(){return this.fromTag(this.tag)}static fromTag(t){if("style"===t&&this!==Zn)return Zn.create();if("svg"===t)return _n.create();{const e=document.createElement(t);return this.fromNode(e)}}static fromNode(t){let e=t.view;if(void 0===e)e=new this(t),this.mount(e);else if(!(e instanceof this))throw new TypeError(e+" not an instance of "+this);return e}static fromAny(t){if(null==t)return t;if(t instanceof pn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return t instanceof Node?this.fromNode(t):"string"==typeof t?this.fromTag(t):e.Creatable.is(t)?t.create():this.fromInit(t)}static forTag(t){return t===this.tag?this:new Kn(this,t)}}Xn.tag="div",u([mn({attributeName:"autocomplete",type:String})],Xn.prototype,"autocomplete",void 0),u([mn({attributeName:"checked",type:Boolean})],Xn.prototype,"checked",void 0),u([mn({attributeName:"colspan",type:Number})],Xn.prototype,"colspan",void 0),u([mn({attributeName:"disabled",type:Boolean})],Xn.prototype,"disabled",void 0),u([mn({attributeName:"placeholder",type:String})],Xn.prototype,"placeholder",void 0),u([mn({attributeName:"rowspan",type:Number})],Xn.prototype,"rowspan",void 0),u([mn({attributeName:"selected",type:Boolean})],Xn.prototype,"selected",void 0),u([mn({attributeName:"title",type:String})],Xn.prototype,"title",void 0),u([mn({attributeName:"type",type:String})],Xn.prototype,"type",void 0),u([mn({attributeName:"value",type:String})],Xn.prototype,"value",void 0),Nn.define(Xn.prototype);class Kn{constructor(t,e){this.factory=t,this.tag=e}create(){return this.fromTag(this.tag)}fromTag(t){const e=document.createElement(t);return this.fromNode(e)}fromNode(t){return this.factory.fromNode(t)}fromInit(t){let e=t.type;void 0===e&&(e=this);const i=e.create();return i.init(t),i}fromAny(t){return this.factory.fromAny(t)}}class Zn extends Xn{constructor(t){super(t)}onApplyTheme(t,e,i){super.onApplyTheme(t,e,i),this.sheet.applyTheme(t,e,i)}init(t){super.init(t)}}Zn.tag="style",u([Gn({createStylesheet(){return this.owner.node.sheet}})],Zn.prototype,"sheet",void 0);class _n extends Yn{constructor(t){super(t)}setChild(t,e){return"string"==typeof e&&(e=_n.fromTag(e)),super.setChild(t,e)}appendChild(t,e){return"string"==typeof t&&(t=_n.fromTag(t)),super.appendChild(t,e)}prependChild(t,e){return"string"==typeof t&&(t=_n.fromTag(t)),super.prependChild(t,e)}insertChild(t,e,i){return"string"==typeof t&&(t=_n.fromTag(t)),super.insertChild(t,e,i)}replaceChild(t,e){return"string"==typeof t&&(t=_n.fromTag(t)),super.replaceChild(t,e)}font(t,e){if(void 0===t){const t=this.fontStyle.value,e=this.fontVariant.value,i=this.fontWeight.value,n=this.fontStretch.value,o=this.fontSize.value,s=this.lineHeight.value,r=this.fontFamily.value;return void 0!==r?O.create(t,e,i,n,o,s,r):null}return null!==t?(void 0!==(t=O.fromAny(t)).style&&this.fontStyle.setState(t.style,e),void 0!==t.variant&&this.fontVariant.setState(t.variant,e),void 0!==t.weight&&this.fontWeight.setState(t.weight,e),void 0!==t.stretch&&this.fontStretch.setState(t.stretch,e),void 0!==t.size&&this.fontSize.setState(t.size,e),void 0!==t.height&&this.lineHeight.setState(t.height,e),this.fontFamily.setState(t.family,e)):(this.fontStyle.setState(void 0,e),this.fontVariant.setState(void 0,e),this.fontWeight.setState(void 0,e),this.fontStretch.setState(void 0,e),this.fontSize.setState(null,e),this.lineHeight.setState(null,e),this.fontFamily.setState(void 0,e)),this}get parentTransform(){const t=this.transform.value;return null!==t?t:o.Transform.identity()}on(t,e,i){return this.node.addEventListener(t,e,i),this}off(t,e,i){return this.node.removeEventListener(t,e,i),this}initAttributes(t){void 0!==t.alignmentBaseline&&this.alignmentBaseline(t.alignmentBaseline),void 0!==t.clipPath&&this.clipPath(t.clipPath),void 0!==t.cursor&&this.cursor(t.cursor),void 0!==t.cx&&this.cx(t.cx),void 0!==t.cy&&this.cy(t.cy),void 0!==t.cy&&this.cy(t.cy),void 0!==t.d&&this.d(t.d),void 0!==t.dx&&this.dx(t.dx),void 0!==t.dy&&this.dy(t.dy),void 0!==t.edgeMode&&this.edgeMode(t.edgeMode),void 0!==t.fill&&this.fill(t.fill),void 0!==t.fillRule&&this.fillRule(t.fillRule),void 0!==t.floodColor&&this.floodColor(t.floodColor),void 0!==t.floodOpacity&&this.floodOpacity(t.floodOpacity),void 0!==t.height&&this.height(t.height),void 0!==t.in&&this.in(t.in),void 0!==t.in2&&this.in2(t.in2),void 0!==t.lengthAdjust&&this.lengthAdjust(t.lengthAdjust),void 0!==t.mode&&this.mode(t.mode),void 0!==t.opacity&&this.opacity(t.opacity),void 0!==t.pointerEvents&&this.pointerEvents(t.pointerEvents),void 0!==t.points&&this.points(t.points),void 0!==t.preserveAspectRatio&&this.preserveAspectRatio(t.preserveAspectRatio),void 0!==t.r&&this.r(t.r),void 0!==t.result&&this.result(t.result),void 0!==t.stdDeviation&&this.stdDeviation(t.stdDeviation),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeDasharray&&this.strokeDasharray(t.strokeDasharray),void 0!==t.strokeDashoffset&&this.strokeDashoffset(t.strokeDashoffset),void 0!==t.strokeLinecap&&this.strokeLinecap(t.strokeLinecap),void 0!==t.strokeLinejoin&&this.strokeLinejoin(t.strokeLinejoin),void 0!==t.strokeMiterlimit&&this.strokeMiterlimit(t.strokeMiterlimit),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth),void 0!==t.textAnchor&&this.textAnchor(t.textAnchor),void 0!==t.textLength&&this.textLength(t.textLength),void 0!==t.transform&&this.transform(t.transform),void 0!==t.type&&this.type(t.type),void 0!==t.values&&this.values(t.values),void 0!==t.viewBox&&this.viewBox(t.viewBox),void 0!==t.width&&this.width(t.width),void 0!==t.x&&this.x(t.x),void 0!==t.x1&&this.x1(t.x1),void 0!==t.x2&&this.x2(t.x2),void 0!==t.y&&this.y(t.y),void 0!==t.y1&&this.y1(t.y1),void 0!==t.y2&&this.y2(t.y2)}initStyle(t){void 0!==t.cssTransform&&this.cssTransform(t.cssTransform),void 0!==t.filter&&this.filter(t.filter),void 0!==t.fontFamily&&this.fontFamily(t.fontFamily),void 0!==t.fontSize&&this.fontSize(t.fontSize),void 0!==t.fontStretch&&this.fontStretch(t.fontStretch),void 0!==t.fontStyle&&this.fontStyle(t.fontStyle),void 0!==t.fontVariant&&this.fontVariant(t.fontVariant),void 0!==t.fontWeight&&this.fontWeight(t.fontWeight),void 0!==t.lineHeight&&this.lineHeight(t.lineHeight),void 0!==t.touchAction&&this.touchAction(t.touchAction)}init(t){super.init(t),void 0!==t.attributes&&this.initAttributes(t.attributes),void 0!==t.style&&this.initStyle(t.style)}static create(){return this.fromTag(this.tag)}static fromTag(t){const e=document.createElementNS(this.namespace,t);return this.fromNode(e)}static fromNode(t){let e=t.view;if(void 0===e)e=new this(t),this.mount(e);else if(!(e instanceof this))throw new TypeError(e+" not an instance of "+this);return e}static fromAny(t){if(null==t)return t;if(t instanceof pn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return t instanceof Node?this.fromNode(t):"string"==typeof t?this.fromTag(t):e.Creatable.is(t)?t.create():this.fromInit(t)}static forTag(t){return t===this.tag?this:new Qn(this,t)}}_n.tag="svg",_n.namespace="http://www.w3.org/2000/svg",u([mn({attributeName:"alignment-baseline",type:String})],_n.prototype,"alignmentBaseline",void 0),u([mn({attributeName:"clip-path",type:String})],_n.prototype,"clipPath",void 0),u([mn({attributeName:"cursor",type:String})],_n.prototype,"cursor",void 0),u([mn({attributeName:"cx",type:Number})],_n.prototype,"cx",void 0),u([mn({attributeName:"cy",type:Number})],_n.prototype,"cy",void 0),u([mn({attributeName:"d",type:String})],_n.prototype,"d",void 0),u([mn({attributeName:"dx",type:o.Length,value:null})],_n.prototype,"dx",void 0),u([mn({attributeName:"dy",type:o.Length,value:null})],_n.prototype,"dy",void 0),u([mn({attributeName:"edgeMode",type:String})],_n.prototype,"edgeMode",void 0),u([mn({attributeName:"fill",type:B,value:null})],_n.prototype,"fill",void 0),u([mn({attributeName:"fill-rule",type:String})],_n.prototype,"fillRule",void 0),u([mn({attributeName:"flood-color",type:B,value:null})],_n.prototype,"floodColor",void 0),u([mn({attributeName:"flood-opacity",type:Number})],_n.prototype,"floodOpacity",void 0),u([mn({attributeName:"height",type:o.Length,value:null})],_n.prototype,"height",void 0),u([mn({attributeName:"in",type:String})],_n.prototype,"in",void 0),u([mn({attributeName:"in2",type:String})],_n.prototype,"in2",void 0),u([mn({attributeName:"lengthAdjust",type:String})],_n.prototype,"lengthAdjust",void 0),u([mn({attributeName:"mode",type:String})],_n.prototype,"mode",void 0),u([mn({attributeName:"opacity",type:Number})],_n.prototype,"opacity",void 0),u([mn({attributeName:"pointer-events",type:String})],_n.prototype,"pointerEvents",void 0),u([mn({attributeName:"points",type:String})],_n.prototype,"points",void 0),u([mn({attributeName:"preserveAspectRatio",type:Boolean})],_n.prototype,"preserveAspectRatio",void 0),u([mn({attributeName:"r",type:Number})],_n.prototype,"r",void 0),u([mn({attributeName:"result",type:String})],_n.prototype,"result",void 0),u([mn({attributeName:"stdDeviation",type:Number})],_n.prototype,"stdDeviation",void 0),u([mn({attributeName:"stroke",type:B,value:null})],_n.prototype,"stroke",void 0),u([mn({attributeName:"stroke-dasharray",type:String})],_n.prototype,"strokeDasharray",void 0),u([mn({attributeName:"stroke-dashoffset",type:Number})],_n.prototype,"strokeDashoffset",void 0),u([mn({attributeName:"stroke-linecap",type:String})],_n.prototype,"strokeLinecap",void 0),u([mn({attributeName:"stroke-linejoin",type:String})],_n.prototype,"strokeLinejoin",void 0),u([mn({attributeName:"stroke-miterlimit",type:Number})],_n.prototype,"strokeMiterlimit",void 0),u([mn({attributeName:"stroke-width",type:Number})],_n.prototype,"strokeWidth",void 0),u([mn({attributeName:"text-anchor",type:String})],_n.prototype,"textAnchor",void 0),u([mn({attributeName:"textLength",type:o.Length,value:null})],_n.prototype,"textLength",void 0),u([mn({attributeName:"transform",type:o.Transform,value:null})],_n.prototype,"transform",void 0),u([mn({attributeName:"type",type:String})],_n.prototype,"type",void 0),u([mn({attributeName:"values",type:String})],_n.prototype,"values",void 0),u([mn({attributeName:"viewBox",type:String})],_n.prototype,"viewBox",void 0),u([mn({attributeName:"width",type:o.Length,value:null})],_n.prototype,"width",void 0),u([mn({attributeName:"x",type:Number})],_n.prototype,"x",void 0),u([mn({attributeName:"x1",type:Number})],_n.prototype,"x1",void 0),u([mn({attributeName:"x2",type:Number})],_n.prototype,"x2",void 0),u([mn({attributeName:"y",type:Number})],_n.prototype,"y",void 0),u([mn({attributeName:"y1",type:Number})],_n.prototype,"y1",void 0),u([mn({attributeName:"y2",type:Number})],_n.prototype,"y2",void 0),u([Dn({propertyNames:"transform",type:o.Transform,value:null})],_n.prototype,"cssTransform",void 0),u([Dn({propertyNames:"filter",type:String})],_n.prototype,"filter",void 0),u([Dn({propertyNames:"font-family",type:F})],_n.prototype,"fontFamily",void 0),u([Dn({propertyNames:"font-size",type:o.Length,value:null})],_n.prototype,"fontSize",void 0),u([Dn({propertyNames:"font-stretch",type:String})],_n.prototype,"fontStretch",void 0),u([Dn({propertyNames:"font-style",type:String})],_n.prototype,"fontStyle",void 0),u([Dn({propertyNames:"font-variant",type:String})],_n.prototype,"fontVariant",void 0),u([Dn({propertyNames:"font-weight",type:String})],_n.prototype,"fontWeight",void 0),u([Dn({propertyNames:"line-height",type:o.Length,value:null})],_n.prototype,"lineHeight",void 0),u([Dn({propertyNames:"touch-action",type:String})],_n.prototype,"touchAction",void 0);class Qn{constructor(t,e){this.factory=t,this.tag=e}get namespace(){return _n.namespace}create(){return this.fromTag(this.tag)}fromTag(t){const e=document.createElementNS(this.namespace,t);return this.fromNode(e)}fromNode(t){return this.factory.fromNode(t)}fromInit(t){let e=t.type;void 0===e&&(e=this);const i=e.create();return i.init(t),i}fromAny(t){return this.factory.fromAny(t)}}class Jn{constructor(t,e,i){this.sheet=t,this.rowIndex=e,this.colIndex=i}get width(){return this.sheet.spriteWidth}get height(){return this.sheet.spriteHeight}get pixelRatio(){return this.sheet.pixelRatio}getRenderer(){return this.sheet.getSpriteRenderer(this.rowIndex,this.colIndex)}clear(){return this.sheet.clearSprite(this.rowIndex,this.colIndex)}draw(t,e){this.sheet.drawSprite(t,e,this.rowIndex,this.colIndex)}release(){this.sheet.releaseSprite(this)}}class $n{constructor(t,e,i,n,s){const r=Math.floor(n/e),l=Math.floor(i/t),a=r*l,h=new Array(a),c=new Array(a),d=document.createElement("canvas");d.width=i*s,d.height=n*s,d.style.width=i+"px",d.style.height=n+"px";const u=d.getContext("2d"),p=new ho(u,o.Transform.identity(),s);this.spriteWidth=t,this.spriteHeight=e,this.sprites=h,this.freeSprites=c,this.canvas=d,this.renderer=p,this.nextSheet=null,this.createSprites(h,r,l);for(let t=0;t<a;t+=1)c[t]=h[a-t-1]}createSprites(t,e,i){let n=0;for(let o=0;o<e;o+=1)for(let e=0;e<i;e+=1){const i=this.createSprite(o,e);t[n]=i,n+=1}}createSprite(t,e){return new Jn(this,t,e)}get pixelRatio(){return this.renderer.pixelRatio}get canvasWidth(){return this.canvas.width/this.pixelRatio}get canvasHeight(){return this.canvas.height/this.pixelRatio}get rowCount(){return Math.floor(this.canvasHeight/this.spriteHeight)}get colCount(){return Math.floor(this.canvasWidth/this.spriteWidth)}get spriteCount(){return this.rowCount*this.colCount}get freeCount(){return this.freeSprites.length}static acquireNextFreeSheet(t){for(;;){const e=t.nextSheet;if(null===e)return null;if(0!==e.freeCount)return t.nextSheet=e.nextSheet,e.nextSheet=null,e;t=e}}acquireSprite(){const t=this.freeSprites.pop();return void 0!==t?t:null}releaseSprite(t){this.clearSprite(t.rowIndex,t.colIndex),this.freeSprites.push(t)}clearSprite(t,e){this.getSpriteRenderer(t,e).context.clearRect(0,0,this.spriteWidth,this.spriteHeight)}getSpriteRenderer(t,e){const i=this.renderer,n=i.context,s=i.pixelRatio,r=t*this.spriteWidth*s,l=e*this.spriteHeight*s;return n.setTransform(s,0,0,s,r,l),i.setTransform(o.Transform.affine(s,0,0,s,r,l)),i}drawSprite(t,e,i,n){const o=this.renderer.pixelRatio,s=this.spriteWidth*o,r=this.spriteHeight*o,l=i*s,a=n*r;t.drawImage(this.canvas,l,a,s,r,e.x,e.y,this.spriteWidth,this.spriteHeight)}}class to{constructor(t,e,i,n,o){void 0===i&&(i=window.devicePixelRatio||1),void 0===t&&(t=Math.floor(to.TextureWidth/i)),void 0===e&&(e=Math.floor(to.TextureHeight/i)),void 0===o&&(o=Math.floor(Math.log2(Math.min(t,e)/4))),void 0===n&&(n=Math.min(4,o)),this.canvasWidth=t,this.canvasHeight=e,this.minSizeClass=n,this.maxSizeClass=o,this.pixelRatio=i;const s=o-n+1,r=new Array(s);for(let t=0;t<s;t+=1)r[t]=null;this.slabs=r}createSlab(t){const e=1<<t;return new $n(e,e,this.canvasWidth,this.canvasHeight,this.pixelRatio)}getFreeSlab(t){if((t=Math.max(this.minSizeClass,t))<=this.maxSizeClass){const e=t-this.minSizeClass,i=this.slabs;let n=i[e];if(null===n)n=this.createSlab(t),i[e]=n;else if(0===n.freeCount){let o=$n.acquireNextFreeSheet(n);null===o&&(o=this.createSlab(t)),o.nextSheet=n,n=o,i[e]=n}return n}return null}createSheet(t,e){return new $n(t,e,t,e,this.pixelRatio)}getFreeSheet(t,e){const i=Math.ceil(Math.log2(t)),n=Math.ceil(Math.log2(e)),o=Math.max(i,n);let s=this.getFreeSlab(o);return null===s&&(s=this.createSheet(t,e)),s}acquireSprite(t,e){return this.getFreeSheet(t,e).acquireSprite()}static global(){return new to}}to.TextureWidth=512,to.TextureHeight=512,u([e.Lazy],to,"global",null);class eo{}class io extends pn{constructor(){super(),this.ownViewFrame=null,this.eventHandlers=null,this.hoverSet=null}needsProcess(t,e){return 0==(this.flags&pn.NeedsAnimate)&&(t&=~pn.NeedsAnimate),t}renderViewOutline(t,e,i,n){if(t.isDefined()){const o=e.lineWidth,s=e.strokeStyle;e.beginPath(),e.moveTo(t.xMin,t.yMin),e.lineTo(t.xMin,t.yMax),e.lineTo(t.xMax,t.yMax),e.lineTo(t.xMax,t.yMin),e.closePath(),e.lineWidth=n,e.strokeStyle=i.toString(),e.stroke(),e.lineWidth=o,e.strokeStyle=s}}get viewFrame(){let t=this.ownViewFrame;return null===t&&(t=this.deriveViewFrame()),t}setViewFrame(t){this.ownViewFrame=t}deriveViewFrame(){const t=this.parent;return t instanceof io||t instanceof uo?t.viewFrame:o.R2Box.undefined()}cullViewFrame(t=this.viewFrame){this.setCulled(!t.intersects(this.viewBounds))}get ownViewBounds(){return null}deriveViewBounds(){let t,e=this.firstChild;for(;null!==e;){if(e instanceof io&&!e.hidden&&!e.unbounded){const i=e.viewBounds;i.isDefined()&&(t=void 0!==t?t.union(i):i)}e=e.nextSibling}return void 0===t&&(t=this.viewFrame),t}get hitBounds(){return this.viewBounds}deriveHitBounds(){let t,e=this.firstChild;for(;null!==e;){if(e instanceof io&&!e.hidden&&!e.intangible){const i=e.hitBounds;t=void 0===t?i:t.union(i)}e=e.nextSibling}return void 0===t&&(t=this.viewBounds),t}cascadeHitTest(t,e,i){if(!this.hidden&&!this.culled&&!this.intangible){if(this.hitBounds.contains(t,e)){const n=this.extendViewContext(i);let o=this.hitTestChildren(t,e,n);if(null===o){const i=Ei.current;try{Ei.current=n,this.setFlags(this.flags|pn.ContextualFlag),o=this.hitTest(t,e,n)}finally{this.setFlags(this.flags&~pn.ContextualFlag),Ei.current=i}}return o}}return null}hitTest(t,e,i){return null}hitTestChildren(t,e,i){let n=this.firstChild;for(;null!==n;){if(n instanceof io){const o=this.hitTestChild(n,t,e,i);if(null!==o)return o}n=n.nextSibling}return null}hitTestChild(t,e,i,n){return t.cascadeHitTest(e,i,n)}get parentTransform(){return o.Transform.identity()}get clientBounds(){const t=this.clientTransform.inverse();return this.viewBounds.transform(t)}get popoverFrame(){const t=this.pageTransform.inverse();return this.viewBounds.transform(t)}on(t,e,i){let n=this.eventHandlers;null===n&&(n={},this.eventHandlers=n);let o=n[t];const s="boolean"==typeof i?i:"object"==typeof i&&null!==i&&i.capture||!1,r=i&&"object"==typeof i&&i.passive||!1,l=i&&"object"==typeof i&&i.once||!1;let a;if(void 0===o)a={listener:e,capture:s,passive:r,once:l},o=[a],n[t]=o;else{const t=o.length;let i=0;for(;i<t&&(a=o[i],a.listener!==e||a.capture!==s);)i+=1;i<t?(a.passive=r,a.once=l):(a={listener:e,capture:s,passive:r,once:l},o.push(a))}return this}off(t,e,i){const n=this.eventHandlers;if(null!==n){const o=n[t];if(void 0!==o){const s="boolean"==typeof i?i:"object"==typeof i&&null!==i&&i.capture||!1,r=o.length;let l=0;for(;l<r;){const i=o[l];if(i.listener===e&&i.capture===s){o.splice(l,1),0===o.length&&delete n[t];break}l+=1}}}return this}handleEvent(t){const e=t.type,i=this.eventHandlers;if(null!==i){const n=i[e];if(void 0!==n){let o=0;for(;o<n.length;){const e=n[o];if(!e.capture){const i=e.listener;if("function"==typeof i?i.call(this,t):"object"==typeof i&&null!==i&&i.handleEvent(t),e.once){n.splice(o,1);continue}}o+=1}0===n.length&&delete i[e]}}"mouseover"===e?this.onMouseOver(t):"mouseout"===e?this.onMouseOut(t):"pointerover"===e?this.onPointerOver(t):"pointerout"===e&&this.onPointerOut(t)}bubbleEvent(t){let e;if(this.handleEvent(t),t.bubbles&&!t.cancelBubble){const i=this.parent;e=i instanceof io||i instanceof uo?i.bubbleEvent(t):i}else e=null;return e}dispatchEvent(t){t.targetView=this;const e=this.bubbleEvent(t);return null!==e?e.dispatchEvent(t):!t.cancelBubble}isHovering(){const t=this.hoverSet;return null!==t&&0!==Object.keys(t).length}onMouseOver(t){let e=this.hoverSet;if(null===e&&(e={},this.hoverSet=e),void 0===e.mouse){e.mouse=null;const i=this.eventHandlers;if(null!==i&&void 0!==i.mouseenter){const e=new MouseEvent("mouseenter",{bubbles:!1,button:t.button,buttons:t.buttons,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,clientX:t.clientX,clientY:t.clientY,screenX:t.screenX,screenY:t.screenY,movementX:t.movementX,movementY:t.movementY,view:t.view,detail:t.detail,relatedTarget:t.relatedTarget});e.targetView=this,e.relatedTargetView=t.relatedTargetView,this.handleEvent(e)}}}onMouseOut(t){const e=this.hoverSet;if(null!==e&&void 0!==e.mouse){delete e.mouse;const i=this.eventHandlers;if(null!==i&&void 0!==i.mouseleave){const e=new MouseEvent("mouseleave",{bubbles:!1,button:t.button,buttons:t.buttons,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,clientX:t.clientX,clientY:t.clientY,screenX:t.screenX,screenY:t.screenY,movementX:t.movementX,movementY:t.movementY,view:t.view,detail:t.detail,relatedTarget:t.relatedTarget});e.targetView=this,e.relatedTargetView=t.relatedTargetView,this.handleEvent(e)}}}onPointerOver(t){let e=this.hoverSet;null===e&&(e={},this.hoverSet=e);const i=""+t.pointerId;if(void 0===e[i]){e[i]=null;const n=this.eventHandlers;if(null!==n&&void 0!==n.pointerenter){const e=new PointerEvent("pointerenter",{bubbles:!1,pointerId:t.pointerId,pointerType:t.pointerType,isPrimary:t.isPrimary,button:t.button,buttons:t.buttons,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,clientX:t.clientX,clientY:t.clientY,screenX:t.screenX,screenY:t.screenY,movementX:t.movementX,movementY:t.movementY,tiltX:t.tiltX,tiltY:t.tiltY,twist:t.twist,width:t.width,height:t.height,pressure:t.pressure,tangentialPressure:t.tangentialPressure,view:t.view,detail:t.detail,relatedTarget:t.relatedTarget});e.targetView=this,e.relatedTargetView=t.relatedTargetView,this.handleEvent(e)}}}onPointerOut(t){const e=this.hoverSet;if(null!==e){const i=""+t.pointerId;if(void 0!==e[i]){delete e[i];const n=this.eventHandlers;if(null!==n&&void 0!==n.pointerleave){const e=new PointerEvent("pointerleave",{bubbles:!1,pointerId:t.pointerId,pointerType:t.pointerType,isPrimary:t.isPrimary,button:t.button,buttons:t.buttons,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,clientX:t.clientX,clientY:t.clientY,screenX:t.screenX,screenY:t.screenY,movementX:t.movementX,movementY:t.movementY,tiltX:t.tiltX,tiltY:t.tiltY,twist:t.twist,width:t.width,height:t.height,pressure:t.pressure,tangentialPressure:t.tangentialPressure,view:t.view,detail:t.detail,relatedTarget:t.relatedTarget});e.targetView=this,e.relatedTargetView=t.relatedTargetView,this.handleEvent(e)}}}}init(t){super.init(t),void 0!==t.hidden&&this.setHidden(t.hidden)}}io.UncullFlags=pn.UncullFlags|pn.NeedsRender,io.UnhideFlags=pn.UnhideFlags|pn.NeedsRender,io.InsertChildFlags=pn.InsertChildFlags|pn.NeedsRender,io.RemoveChildFlags=pn.RemoveChildFlags|pn.NeedsRender,u([i.Provider({type:to,observes:!1,service:to.global()})],io.prototype,"spriteProvider",void 0),Object.defineProperty(io.prototype,"renderer",{get(){const t=this.parent;return t instanceof io||t instanceof uo?t.renderer:null},configurable:!0}),Object.defineProperty(io.prototype,"viewBounds",{get(){return this.viewFrame},configurable:!0});class no extends eo{}class oo{constructor(){this.precision=-1,this.x0=NaN,this.y0=NaN,this.x1=NaN,this.y1=NaN,this.d=""}setPrecision(t){this.precision=t}get anglePrecision(){const t=this.precision;return t>0?Math.max(5,t):t}moveTo(t,e){this.d+="M"+s.Format.decimal(t,this.precision)+","+s.Format.decimal(e,this.precision),this.x0=t,this.y0=e,this.x1=t,this.y1=e}lineTo(t,e){this.d+="L"+s.Format.decimal(t,this.precision)+","+s.Format.decimal(e,this.precision),this.x1=t,this.y1=e}quadraticCurveTo(t,e,i,n){this.d+="Q"+s.Format.decimal(t,this.precision)+","+s.Format.decimal(e,this.precision)+","+s.Format.decimal(i,this.precision)+","+s.Format.decimal(n,this.precision),this.x1=i,this.y1=n}bezierCurveTo(t,e,i,n,o,r){this.d+="C"+s.Format.decimal(t,this.precision)+","+s.Format.decimal(e,this.precision)+","+s.Format.decimal(i,this.precision)+","+s.Format.decimal(n,this.precision)+","+s.Format.decimal(o,this.precision)+","+s.Format.decimal(r,this.precision),this.x1=o,this.y1=r}arcTo(t,e,i,n,o){const r=this.x1,l=this.y1,a=i-t,h=n-e,c=r-t,d=l-e,u=c*c+d*d;if(o<0)throw new Error("negative radius: "+o);if(isNaN(this.x1))this.d+="M"+s.Format.decimal(t,this.precision)+","+s.Format.decimal(e,this.precision),this.x1=t,this.y1=e;else if(u>oo.Epsilon)if(Math.abs(d*a-h*c)>oo.Epsilon&&0!==o){const p=i-r,f=n-l,g=a*a+h*h,v=p*p+f*f,w=Math.sqrt(g),y=Math.sqrt(u),m=o*Math.tan((Math.PI-Math.acos((g+u-v)/(2*w*y)))/2),b=m/y,C=m/w;Math.abs(b-1)>oo.Epsilon&&(this.d+="L"+s.Format.decimal(t+b*c,this.precision)+","+s.Format.decimal(e+b*d,this.precision)),t+=C*a,e+=C*h;const S=s.Format.decimal(o,this.precision);this.d+="A"+S+","+S+",0,0,"+(d*p>c*f?"1":"0")+","+s.Format.decimal(t,this.precision)+","+s.Format.decimal(e,this.precision),this.x1=t,this.y1=e}else this.d+="L"+s.Format.decimal(t,this.precision)+","+s.Format.decimal(e,this.precision),this.x1=t,this.y1=e;else;}arc(t,e,i,n,o,r=!1){const l=t+i*Math.cos(n),a=e+i*Math.sin(n),h=1^+r;let c=r?n-o:o-n;if(i<0)throw new Error("negative radius: "+i);if(isNaN(this.x1)?this.d+="M"+s.Format.decimal(l,this.precision)+","+s.Format.decimal(a,this.precision):(Math.abs(this.x1-l)>oo.Epsilon||Math.abs(this.y1-a)>oo.Epsilon)&&(this.d+="L"+s.Format.decimal(l,this.precision)+","+s.Format.decimal(a,this.precision)),0===i)return;c<0&&(c=c%(2*Math.PI)+2*Math.PI);const d=s.Format.decimal(i,this.precision);if(c>2*Math.PI-oo.Epsilon)this.d+="A"+d+","+d+",0,1,"+(h?"1":"0")+","+s.Format.decimal(l,this.precision)+","+s.Format.decimal(a,this.precision),this.x1=l,this.y1=a;else if(c>oo.Epsilon){const n=t+i*Math.cos(o),r=e+i*Math.sin(o);this.d+="A"+d+","+d+",0,"+(c>=Math.PI?"1":"0")+","+(h?"1":"0")+","+s.Format.decimal(n,this.precision)+","+s.Format.decimal(r,this.precision),this.x1=n,this.y1=r}}rect(t,e,i,n){this.d+="M"+s.Format.decimal(t,this.precision)+","+s.Format.decimal(e,this.precision)+"h"+s.Format.decimal(i,this.precision)+"v"+s.Format.decimal(n,this.precision)+"h"+s.Format.decimal(-i,this.precision)+"Z",this.x0=t,this.y0=e,this.x1=t,this.y1=e}ellipse(t,e,i,n,o,r,l,a=!1){const h=Math.cos(o),c=Math.sin(o),d=Math.cos(l),u=Math.sin(l),p=h*i*d-c*n*u+t,f=c*i*d+h*n*u+e,g=l-r,v=Math.abs(g)>Math.PI,w=!a;this.d+="A"+s.Format.decimal(i,this.precision)+","+s.Format.decimal(n,this.precision)+","+s.Format.decimal(o,this.anglePrecision)+","+(v?"1":"0")+","+(w?"1":"0")+","+s.Format.decimal(p,this.precision)+","+s.Format.decimal(f,this.precision),this.x1=p,this.y1=f}closePath(){isNaN(this.x1)||(this.d+="Z",this.x1=this.x0,this.y1=this.y0)}toString(){return this.d}}oo.Epsilon=1e-6;class so extends no{constructor(t){super(),this.context=t}get transform(){return o.Transform.identity()}get pixelRatio(){return 1}}class ro extends no{}class lo{constructor(t){this.view=t,this.precision=-1,this.pathContext=null,this.pathView=null,this.pathFlags=0,this.fillStyle="",this.strokeStyle="",this.lineWidth=1,this.lineCap="butt",this.lineJoin="miter",this.miterLimit=10,this.lineDashOffset=0,this.lineDash=[]}setPrecision(t){this.precision=t}getPathContext(){const t=this.pathContext;if(null==t)throw new Error("no path");return t}getOrCreatePathContext(){let t=this.pathContext;if(null===t){if(t=this.createPathContext(),this.pathContext=t,null===this.pathView||0!==this.pathFlags){this.finalizePath();const t=this.nextPathView();this.setPathView(t)}this.setPathFlags(0)}return t}createPathContext(){const t=new oo;return t.setPrecision(this.precision),t}setPathView(t){this.pathView=t}nextPathView(){let t=this.pathView;if(null!==t){let e=t.node.nextSibling;for(t=null;null!==e;){if(e instanceof SVGPathElement){t=_n.fromNode(e);break}e=e.nextSibling}}return t}finalizePath(){const t=this.pathView;if(null!==t){const e=this.pathFlags;if(0==(e&lo.FillFlag)){const e=t.getFastener("fill",i.Property);null!==e&&e.setValue(null,i.Affinity.Intrinsic)}if(0==(e&lo.FillRuleFlag)){const e=t.getFastener("fillRule",i.Property);null!==e&&e.setValue(void 0,i.Affinity.Intrinsic)}if(0==(e&lo.StrokeFlag)){const e=t.getFastener("stroke",i.Property);null!==e&&e.setValue(null,i.Affinity.Intrinsic)}if(0==(e&lo.PathFlag)){const e=t.getFastener("d",i.Property);null!==e&&e.setValue(void 0,i.Affinity.Intrinsic)}}}setPathFlags(t){this.pathFlags=t}getLineDash(){return this.lineDash}setLineDash(t){this.lineDash=t}beginPath(){this.pathContext=null}moveTo(t,e){this.getOrCreatePathContext().moveTo(t,e)}lineTo(t,e){this.getPathContext().lineTo(t,e)}quadraticCurveTo(t,e,i,n){this.getPathContext().quadraticCurveTo(t,e,i,n)}bezierCurveTo(t,e,i,n,o,s){this.getPathContext().bezierCurveTo(t,e,i,n,o,s)}arcTo(t,e,i,n,o){this.getPathContext().arcTo(t,e,i,n,o)}arc(t,e,i,n,o,s){this.getOrCreatePathContext().arc(t,e,i,n,o,s)}ellipse(t,e,i,n,o,s,r,l){this.getOrCreatePathContext().ellipse(t,e,i,n,o,s,r,l)}rect(t,e,i,n){this.getOrCreatePathContext().rect(t,e,i,n)}closePath(){const t=this.pathContext;null!==t&&t.closePath()}fill(t){const e=this.fillStyle;if("string"!=typeof e)throw new Error("unsupported fill style: "+e);{let n=this.pathView;null!==n&&0!=(this.pathFlags&lo.FillFlag)&&(this.finalizePath(),n=this.nextPathView(),this.setPathView(n));let o=!1;if(null===n&&(n=_n.fromTag("path"),this.setPathView(n),o=!0),n.fill.setState(e,i.Affinity.Intrinsic),this.setPathFlags(this.pathFlags|lo.FillFlag),void 0!==t&&(n.fillRule.setState(t,i.Affinity.Intrinsic),this.setPathFlags(this.pathFlags|lo.FillRuleFlag)),0==(this.pathFlags&lo.PathFlag)){const t=this.getPathContext().toString();n.d.setState(t,i.Affinity.Intrinsic),this.setPathFlags(this.pathFlags|lo.PathFlag)}o&&this.view.appendChild(n)}}stroke(){const t=this.strokeStyle,e=this.lineWidth;if("string"!=typeof t||0===e||!isFinite(e))throw new Error("unsupported stroke style: "+t);{let n=this.pathView;null!==n&&0!=(this.pathFlags&lo.StrokeFlag)&&(this.finalizePath(),n=this.nextPathView(),this.setPathView(n));let o=!1;if(null===n&&(n=_n.fromTag("path"),this.setPathView(n),o=!0),n.stroke.setState(t,i.Affinity.Intrinsic),n.strokeWidth.setState(e,i.Affinity.Intrinsic),n.strokeLinecap.setState(this.lineCap,i.Affinity.Intrinsic),n.strokeLinejoin.setState(this.lineJoin,i.Affinity.Intrinsic),"miter"===this.lineJoin?n.strokeMiterlimit.setState(this.miterLimit,i.Affinity.Intrinsic):n.strokeMiterlimit.setState(void 0,i.Affinity.Intrinsic),0!==this.lineDash.length){let t="";for(let e=0;e<this.lineDash.length;e+=1)0!==e&&(t+=" "),t+=this.lineDash[e];n.strokeDasharray.setState(t,i.Affinity.Intrinsic),0!==this.lineDashOffset?n.strokeDashoffset.setState(this.lineDashOffset,i.Affinity.Intrinsic):n.strokeDashoffset.setState(void 0,i.Affinity.Intrinsic)}else n.strokeDasharray.setState(void 0,i.Affinity.Intrinsic),n.strokeDashoffset.setState(void 0,i.Affinity.Intrinsic);if(this.setPathFlags(this.pathFlags|lo.StrokeFlag),0==(this.pathFlags&lo.PathFlag)){const t=this.getPathContext().toString();n.d.setState(t,i.Affinity.Intrinsic),this.setPathFlags(this.pathFlags|lo.PathFlag)}o&&this.view.appendChild(n)}}beginSvg(){let t=null,e=this.view.node.firstChild;for(;null!==e;){if(e instanceof SVGPathElement){t=_n.fromNode(e);break}e=e.nextSibling}this.setPathView(t),this.setPathFlags(0)}finalizeSvg(){let t=this.pathView;if(null!==t){let e=t.node.nextSibling;for(null===t.fill.state&&null===t.stroke.state&&(this.pathView=null,t.remove()),t=null;null!==e;){const t=e.view;e=e.nextSibling,void 0!==t&&t.remove()}}}}lo.FillFlag=1,lo.FillRuleFlag=2,lo.StrokeFlag=4,lo.PathFlag=8;class ao extends ro{constructor(t){super(),this.context=t}get transform(){return o.Transform.identity()}get pixelRatio(){return 1}}class ho extends ro{constructor(t,e,i){super(),this.context=t,this.transform=e,this.pixelRatio=i}setTransform(t){this.transform=t}}class co extends eo{constructor(t,e){super(),this.context=t,this.pixelRatio=void 0!==e?e:window.devicePixelRatio||1}}class uo extends Xn{constructor(t){super(t),Object.defineProperty(this,"renderer",{value:this.createRenderer(),writable:!0,enumerable:!0,configurable:!0}),this.viewFrame=o.R2Box.undefined(),this.canvasFlags=uo.ClickEventsFlag,this.eventNode=t,this.mouse=null,this.pointers=null,this.touches=null,this.onClick=this.onClick.bind(this),this.onDblClick=this.onDblClick.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onPointerEnter=this.onPointerEnter.bind(this),this.onPointerLeave=this.onPointerLeave.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerCancel=this.onPointerCancel.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchCancel=this.onTouchCancel.bind(this),this.initCanvas()}initCanvas(){this.position.setState("absolute",i.Affinity.Intrinsic)}onMount(){super.onMount(),this.attachEvents(this.eventNode)}onUnmount(){this.detachEvents(this.eventNode),super.onUnmount()}needsUpdate(t,e){return t=super.needsUpdate(t,e),t|=pn.NeedsRender|pn.NeedsComposite,this.setFlags(this.flags|pn.NeedsRender|pn.NeedsComposite),t}needsProcess(t,e){return 0!=(t&pn.ProcessMask)&&this.requireUpdate(pn.NeedsRender|pn.NeedsComposite),t}onResize(t){super.onResize(t),this.resizeCanvas(this.node),this.resetRenderer(),this.requireUpdate(pn.NeedsLayout|pn.NeedsRender|pn.NeedsComposite)}onScroll(t){super.onScroll(t),this.setCulled(!this.intersectsViewport())}didDisplay(t,e){this.detectHitTargets(),super.didDisplay(t,e)}onRender(t){this.clearCanvas()}needsDisplay(t,e){return t|=pn.NeedsRender|pn.NeedsComposite}get pixelRatio(){return window.devicePixelRatio||1}setRenderer(t){"string"==typeof t&&(t=this.createRenderer(t)),this.renderer=t,this.resetRenderer()}createRenderer(t="canvas"){if("canvas"===t){const t=this.node.getContext("2d");if(null!==t){const e=this.pixelRatio,i=o.Transform.affine(e,0,0,e,0,0);return new ho(t,i,e)}throw new Error("Failed to create canvas rendering context")}if("webgl"===t){const t=this.node.getContext("webgl");if(null!==t)return new co(t,this.pixelRatio);throw new Error("Failed to create webgl rendering context")}throw new Error("Failed to create "+t+" renderer")}setCanvasFlags(t){this.canvasFlags=t}extendViewContext(t){const e=Object.create(t);return e.viewFrame=this.viewFrame,e.renderer=this.renderer,e}setViewFrame(t){}get viewBounds(){return this.viewFrame}get hitBounds(){return this.viewFrame}cascadeHitTest(t,e,i){if(!this.hidden&&!this.culled&&!this.intangible){if(this.hitBounds.contains(t,e)){void 0===i&&(i=this.superViewContext);const n=this.extendViewContext(i);let o=this.hitTestChildren(t,e,n);if(null===o){const i=Ei.current;try{Ei.current=n,this.setFlags(this.flags|pn.ContextualFlag),o=this.hitTest(t,e,n)}finally{this.setFlags(this.flags&~pn.ContextualFlag),Ei.current=i}}return o}}return null}hitTest(t,e,i){return null}hitTestChildren(t,e,i){let n=this.firstChild;for(;null!==n;){if(n instanceof io){const o=this.hitTestChild(n,t,e,i);if(null!==o)return o}n=n.nextSibling}return null}hitTestChild(t,e,i,n){return t.cascadeHitTest(e,i,n)}detectHitTargets(t){if(0!=(this.canvasFlags&uo.MouseEventsFlag)){const e=this.mouse;null!==e&&(void 0===t&&(t=this.clientBounds),this.detectMouseTarget(e,this.clientBounds))}if(0!=(this.canvasFlags&uo.PointerEventsFlag)){const e=this.pointers;for(const i in e){const n=e[i];void 0===t&&(t=this.clientBounds),this.detectPointerTarget(n,t)}}}setEventNode(t){null===t&&(t=this.node);const e=this.eventNode;e!==t&&(this.detachEvents(e),this.eventNode=t,this.attachEvents(t))}clickEventsEnabled(t){const e=0!=(this.canvasFlags&uo.ClickEventsFlag);return void 0===t?e:(t&&!e?(this.setCanvasFlags(this.canvasFlags|uo.ClickEventsFlag),this.attachClickEvents(this.eventNode)):!t&&e&&(this.setCanvasFlags(this.canvasFlags&~uo.ClickEventsFlag),this.detachClickEvents(this.eventNode)),this)}wheelEventsEnabled(t){const e=0!=(this.canvasFlags&uo.WheelEventsFlag);return void 0===t?e:(t&&!e?(this.setCanvasFlags(this.canvasFlags|uo.WheelEventsFlag),this.attachWheelEvents(this.eventNode)):!t&&e&&(this.setCanvasFlags(this.canvasFlags&~uo.WheelEventsFlag),this.detachWheelEvents(this.eventNode)),this)}mouseEventsEnabled(t){const e=0!=(this.canvasFlags&uo.MouseEventsFlag);return void 0===t?e:(t&&!e?(this.setCanvasFlags(this.canvasFlags|uo.MouseEventsFlag),this.attachPassiveMouseEvents(this.eventNode)):!t&&e&&(this.setCanvasFlags(this.canvasFlags&~uo.MouseEventsFlag),this.detachPassiveMouseEvents(this.eventNode)),this)}pointerEventsEnabled(t){const e=0!=(this.canvasFlags&uo.PointerEventsFlag);return void 0===t?e:(t&&!e?(this.setCanvasFlags(this.canvasFlags|uo.PointerEventsFlag),this.attachPassivePointerEvents(this.eventNode)):!t&&e&&(this.setCanvasFlags(this.canvasFlags&~uo.PointerEventsFlag),this.detachPassivePointerEvents(this.eventNode)),this)}touchEventsEnabled(t){const e=0!=(this.canvasFlags&uo.TouchEventsFlag);return void 0===t?e:(t&&!e?(this.setCanvasFlags(this.canvasFlags|uo.TouchEventsFlag),this.attachPassiveTouchEvents(this.eventNode)):!t&&e&&(this.setCanvasFlags(this.canvasFlags&~uo.TouchEventsFlag),this.detachPassiveTouchEvents(this.eventNode)),this)}handleEvent(t){}bubbleEvent(t){return this.handleEvent(t),this}attachEvents(t){0!=(this.canvasFlags&uo.ClickEventsFlag)&&this.attachClickEvents(t),0!=(this.canvasFlags&uo.WheelEventsFlag)&&this.attachWheelEvents(t),0!=(this.canvasFlags&uo.MouseEventsFlag)&&this.attachPassiveMouseEvents(t),0!=(this.canvasFlags&uo.PointerEventsFlag)&&this.attachPassivePointerEvents(t),0!=(this.canvasFlags&uo.TouchEventsFlag)&&this.attachPassiveTouchEvents(t)}detachEvents(t){this.detachClickEvents(t),this.detachWheelEvents(t),this.detachPassiveMouseEvents(t),this.detachActiveMouseEvents(t),this.detachPassivePointerEvents(t),this.detachActivePointerEvents(t),this.detachPassiveTouchEvents(t),this.detachActiveTouchEvents(t)}fireEvent(t,e,i){const n=this.clientBounds;if(n.contains(e,i)){const o=e-n.x,s=i-n.y,r=this.cascadeHitTest(o,s);if(null!==r)return t.targetView=r,r.bubbleEvent(t),r}return null}attachClickEvents(t){t.addEventListener("click",this.onClick),t.addEventListener("dblclick",this.onDblClick),t.addEventListener("contextmenu",this.onContextMenu)}detachClickEvents(t){t.removeEventListener("click",this.onClick),t.removeEventListener("dblclick",this.onDblClick),t.removeEventListener("contextmenu",this.onContextMenu)}attachWheelEvents(t){t.addEventListener("wheel",this.onWheel)}detachWheelEvents(t){t.removeEventListener("wheel",this.onWheel)}attachPassiveMouseEvents(t){t.addEventListener("mouseenter",this.onMouseEnter),t.addEventListener("mouseleave",this.onMouseLeave),t.addEventListener("mousedown",this.onMouseDown)}detachPassiveMouseEvents(t){t.removeEventListener("mouseenter",this.onMouseEnter),t.removeEventListener("mouseleave",this.onMouseLeave),t.removeEventListener("mousedown",this.onMouseDown)}attachActiveMouseEvents(t){document.body.addEventListener("mousemove",this.onMouseMove),document.body.addEventListener("mouseup",this.onMouseUp)}detachActiveMouseEvents(t){document.body.removeEventListener("mousemove",this.onMouseMove),document.body.removeEventListener("mouseup",this.onMouseUp)}updateMouse(t,e){t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.clientX=e.clientX,t.clientY=e.clientY,t.screenX=e.screenX,t.screenY=e.screenY,t.movementX=e.movementX,t.movementY=e.movementY,t.view=e.view,t.detail=e.detail,t.relatedTarget=e.relatedTarget}fireMouseEvent(t){return this.fireEvent(t,t.clientX,t.clientY)}onClick(t){const e=this.mouse;null!==e&&this.updateMouse(e,t),this.fireMouseEvent(t)}onDblClick(t){const e=this.mouse;null!==e&&this.updateMouse(e,t),this.fireMouseEvent(t)}onContextMenu(t){const e=this.mouse;null!==e&&this.updateMouse(e,t),this.fireMouseEvent(t)}onWheel(t){const e=this.mouse;null!==e&&this.updateMouse(e,t),this.fireMouseEvent(t)}onMouseEnter(t){let e=this.mouse;null===e&&(this.attachActiveMouseEvents(this.eventNode),e={},this.mouse=e),this.updateMouse(e,t)}onMouseLeave(t){null!==this.mouse&&(this.mouse=null,this.detachActiveMouseEvents(this.eventNode))}onMouseDown(t){let e=this.mouse;null===e&&(this.attachActiveMouseEvents(this.eventNode),e={},this.mouse=e),this.updateMouse(e,t),this.fireMouseEvent(t)}onMouseMove(t){let e=this.mouse;null===e&&(e={},this.mouse=e),this.updateMouse(e,t);const i=e.targetView;let n=this.fireMouseEvent(t);null===n&&(n=void 0),n!==i&&this.onMouseTargetChange(e,n,i)}onMouseUp(t){const e=this.mouse;null!==e&&this.updateMouse(e,t),this.fireMouseEvent(t)}onMouseTargetChange(t,e,i){if(t.bubbles=!0,void 0!==i){const n=new MouseEvent("mouseout",t);n.targetView=i,n.relatedTargetView=e,i.bubbleEvent(n)}if(t.targetView=e,void 0!==e){const n=new MouseEvent("mouseover",t);n.targetView=e,n.relatedTargetView=i,e.bubbleEvent(n)}}detectMouseTarget(t,e){const i=t.clientX,n=t.clientY;if(e.contains(i,n)){const o=i-e.x,s=n-e.y,r=t.targetView;let l=this.cascadeHitTest(o,s);null===l&&(l=void 0),l!==r&&this.onMouseTargetChange(t,l,r)}}attachPassivePointerEvents(t){t.addEventListener("pointerenter",this.onPointerEnter),t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerdown",this.onPointerDown)}detachPassivePointerEvents(t){t.removeEventListener("pointerenter",this.onPointerEnter),t.removeEventListener("pointerleave",this.onPointerLeave),t.removeEventListener("pointerdown",this.onPointerDown)}attachActivePointerEvents(t){document.body.addEventListener("pointermove",this.onPointerMove),document.body.addEventListener("pointerup",this.onPointerUp),document.body.addEventListener("pointercancel",this.onPointerCancel)}detachActivePointerEvents(t){document.body.removeEventListener("pointermove",this.onPointerMove),document.body.removeEventListener("pointerup",this.onPointerUp),document.body.removeEventListener("pointercancel",this.onPointerCancel)}updatePointer(t,e){t.pointerId=e.pointerId,t.pointerType=e.pointerType,t.isPrimary=e.isPrimary,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.clientX=e.clientX,t.clientY=e.clientY,t.screenX=e.screenX,t.screenY=e.screenY,t.movementX=e.movementX,t.movementY=e.movementY,t.width=e.width,t.height=e.height,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.view=e.view,t.detail=e.detail,t.relatedTarget=e.relatedTarget}firePointerEvent(t){return this.fireEvent(t,t.clientX,t.clientY)}onPointerEnter(t){const e=""+t.pointerId;let i=this.pointers;null===i&&(i={},this.pointers=i);let n=i[e];void 0===n&&(0===Object.keys(i).length&&this.attachActivePointerEvents(this.eventNode),n={},i[e]=n),this.updatePointer(n,t)}onPointerLeave(t){const e=""+t.pointerId;let i=this.pointers;null===i&&(i={},this.pointers=i);const n=i[e];void 0!==n&&(void 0!==n.targetView&&this.onPointerTargetChange(n,void 0,n.targetView),delete i[e],0===Object.keys(i).length&&this.detachActivePointerEvents(this.eventNode))}onPointerDown(t){const e=""+t.pointerId;let i=this.pointers;null===i&&(i={},this.pointers=i);let n=i[e];void 0===n&&(0===Object.keys(i).length&&this.attachActivePointerEvents(this.eventNode),n={},i[e]=n),this.updatePointer(n,t),this.firePointerEvent(t)}onPointerMove(t){const e=""+t.pointerId;let i=this.pointers;null===i&&(i={},this.pointers=i);let n=i[e];void 0===n&&(0===Object.keys(i).length&&this.attachActivePointerEvents(this.eventNode),n={},i[e]=n),this.updatePointer(n,t);const o=n.targetView;let s=this.firePointerEvent(t);null===s&&(s=void 0),s!==o&&this.onPointerTargetChange(n,s,o)}onPointerUp(t){const e=""+t.pointerId;let i=this.pointers;null===i&&(i={},this.pointers=i);const n=i[e];void 0!==n&&this.updatePointer(n,t),this.firePointerEvent(t),void 0!==n&&"mouse"!==t.pointerType&&(void 0!==n.targetView&&this.onPointerTargetChange(n,void 0,n.targetView),delete i[e],0===Object.keys(i).length&&this.detachActivePointerEvents(this.eventNode))}onPointerCancel(t){const e=""+t.pointerId;let i=this.pointers;null===i&&(i={},this.pointers=i);const n=i[e];void 0!==n&&this.updatePointer(n,t),this.firePointerEvent(t),void 0!==n&&"mouse"!==t.pointerType&&(void 0!==n.targetView&&this.onPointerTargetChange(n,void 0,n.targetView),delete i[e],0===Object.keys(i).length&&this.detachActivePointerEvents(this.eventNode))}onPointerTargetChange(t,e,i){if(t.bubbles=!0,void 0!==i){const n=new PointerEvent("pointerout",t);n.targetView=i,n.relatedTargetView=e,i.bubbleEvent(n)}if(t.targetView=e,void 0!==e){const n=new PointerEvent("pointerover",t);n.targetView=e,n.relatedTargetView=i,e.bubbleEvent(n)}}detectPointerTarget(t,e){const i=t.clientX,n=t.clientY;if(e.contains(i,n)){const o=i-e.x,s=n-e.y,r=t.targetView;let l=this.cascadeHitTest(o,s);null===l&&(l=void 0),l!==r&&this.onPointerTargetChange(t,l,r)}}attachPassiveTouchEvents(t){t.addEventListener("touchstart",this.onTouchStart)}detachPassiveTouchEvents(t){t.removeEventListener("touchstart",this.onTouchStart)}attachActiveTouchEvents(t){t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("touchend",this.onTouchEnd),t.addEventListener("touchcancel",this.onTouchCancel)}detachActiveTouchEvents(t){t.removeEventListener("touchmove",this.onTouchMove),t.removeEventListener("touchend",this.onTouchEnd),t.removeEventListener("touchcancel",this.onTouchCancel)}updateTouch(t,e){t.clientX=e.clientX,t.clientY=e.clientY,t.screenX=e.screenX,t.screenY=e.screenY,t.pageX=e.pageX,t.pageY=e.pageY,t.radiusX=e.radiusX,t.radiusY=e.radiusY,t.rotationAngle=e.rotationAngle,t.force=e.force}fireTouchEvent(t,e){const i=e.changedTouches,n=[];for(let o=0,s=i.length;o<s;o+=1){const r=i[o],l=r.targetView;if(void 0!==l&&n.indexOf(l)<0){const a=new TouchEvent(t,{changedTouches:i,targetTouches:e.targetTouches,touches:e.touches,bubbles:!0});a.targetView=l;const h=[r];for(let t=o+1;t<s;t+=1){const e=i[t];e.targetView===l&&h.push(e)}void 0!==document.createTouchList?a.targetViewTouches=document.createTouchList(...h):(h.item=function(t){return h[t]},a.targetViewTouches=h),l.bubbleEvent(a),n.push(l)}}}onTouchStart(t){let e,i=this.touches;null===i&&(i={},this.touches=i);const n=t.changedTouches;for(let t=0,o=n.length;t<o;t+=1){const o=n[t],s=""+o.identifier;let r=i[s];void 0===r&&(0===Object.keys(i).length&&this.attachActiveTouchEvents(this.eventNode),r={identifier:o.identifier,target:o.target},i[s]=r),this.updateTouch(r,o);const l=r.clientX,a=r.clientY;if(void 0===e&&(e=this.clientBounds),e.contains(l,a)){const t=l-e.x,i=a-e.y,n=this.cascadeHitTest(t,i);null!==n&&(r.targetView=n,o.targetView=n)}}this.fireTouchEvent("touchstart",t)}onTouchMove(t){let e=this.touches;null===e&&(e={},this.touches=e);const i=t.changedTouches;for(let t=0,n=i.length;t<n;t+=1){const n=i[t],o=""+n.identifier;let s=e[o];void 0===s&&(s={identifier:n.identifier,target:n.target},e[o]=s),this.updateTouch(s,n),n.targetView=s.targetView}this.fireTouchEvent("touchmove",t)}onTouchEnd(t){let e=this.touches;null===e&&(e={},this.touches=e);const i=t.changedTouches,n=i.length;for(let t=0;t<n;t+=1){const n=i[t],o=""+n.identifier;let s=e[o];void 0===s&&(s={identifier:n.identifier,target:n.target},e[o]=s),this.updateTouch(s,n),n.targetView=s.targetView}this.fireTouchEvent("touchend",t);for(let t=0;t<n;t+=1){delete e[""+i[t].identifier],0===Object.keys(e).length&&this.detachActiveTouchEvents(this.eventNode)}}onTouchCancel(t){let e=this.touches;null===e&&(e={},this.touches=e);const i=t.changedTouches,n=i.length;for(let t=0;t<n;t+=1){const n=i[t],o=""+n.identifier;let s=e[o];void 0===s&&(s={identifier:n.identifier,target:n.target},e[o]=s),this.updateTouch(s,n),n.targetView=s.targetView}this.fireTouchEvent("touchcancel",t);for(let t=0;t<n;t+=1){delete e[""+i[t].identifier],0===Object.keys(e).length&&this.detachActiveTouchEvents(this.eventNode)}}resizeCanvas(t){let e,i,n,s=t.parentNode;if(s instanceof HTMLElement){do{if(e=Math.floor(s.offsetWidth),i=Math.floor(s.offsetHeight),0!==e&&0!==i)break;0!==e&&0!==i||!Xn.isPositioned(s)||this.requireUpdate(pn.NeedsResize),s=s.parentNode}while(s instanceof HTMLElement);n=this.pixelRatio,t.width=e*n,t.height=i*n,t.style.width=e+"px",t.style.height=i+"px"}else e=Math.floor(t.width),i=Math.floor(t.height),n=1;this.viewFrame=new o.R2Box(0,0,e,i)}clearCanvas(){const t=this.renderer;if(t instanceof ho){const e=this.viewFrame;t.context.clearRect(0,0,e.width,e.height)}else if(t instanceof co){const e=t.context;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}}resetRenderer(){const t=this.renderer;if(t instanceof ho){const e=this.pixelRatio;t.context.setTransform(e,0,0,e,0,0)}else if(t instanceof co){const e=this.viewFrame;t.context.viewport(0,0,e.width,e.height)}}onObserve(t){super.onObserve(t),void 0!==t.viewWillRender&&(this.observerCache.viewWillRenderObservers=e.Arrays.inserted(t,this.observerCache.viewWillRenderObservers)),void 0!==t.viewDidRender&&(this.observerCache.viewDidRenderObservers=e.Arrays.inserted(t,this.observerCache.viewDidRenderObservers)),void 0!==t.viewWillRasterize&&(this.observerCache.viewWillRasterizeObservers=e.Arrays.inserted(t,this.observerCache.viewWillRasterizeObservers)),void 0!==t.viewDidRasterize&&(this.observerCache.viewDidRasterizeObservers=e.Arrays.inserted(t,this.observerCache.viewDidRasterizeObservers)),void 0!==t.viewWillComposite&&(this.observerCache.viewWillCompositeObservers=e.Arrays.inserted(t,this.observerCache.viewWillCompositeObservers)),void 0!==t.viewDidComposite&&(this.observerCache.viewDidCompositeObservers=e.Arrays.inserted(t,this.observerCache.viewDidCompositeObservers))}onUnobserve(t){super.onUnobserve(t),void 0!==t.viewWillRender&&(this.observerCache.viewWillRenderObservers=e.Arrays.removed(t,this.observerCache.viewWillRenderObservers)),void 0!==t.viewDidRender&&(this.observerCache.viewDidRenderObservers=e.Arrays.removed(t,this.observerCache.viewDidRenderObservers)),void 0!==t.viewWillRasterize&&(this.observerCache.viewWillRasterizeObservers=e.Arrays.removed(t,this.observerCache.viewWillRasterizeObservers)),void 0!==t.viewDidRasterize&&(this.observerCache.viewDidRasterizeObservers=e.Arrays.removed(t,this.observerCache.viewDidRasterizeObservers)),void 0!==t.viewWillComposite&&(this.observerCache.viewWillCompositeObservers=e.Arrays.removed(t,this.observerCache.viewWillCompositeObservers)),void 0!==t.viewDidComposite&&(this.observerCache.viewDidCompositeObservers=e.Arrays.removed(t,this.observerCache.viewDidCompositeObservers))}init(t){super.init(t),void 0!==t.renderer&&this.setRenderer(t.renderer),void 0!==t.clickEventsEnabled&&this.clickEventsEnabled(t.clickEventsEnabled),void 0!==t.wheelEventsEnabled&&this.wheelEventsEnabled(t.wheelEventsEnabled),void 0!==t.mouseEventsEnabled&&this.mouseEventsEnabled(t.mouseEventsEnabled),void 0!==t.pointerEventsEnabled&&this.pointerEventsEnabled(t.pointerEventsEnabled),void 0!==t.touchEventsEnabled&&this.touchEventsEnabled(t.touchEventsEnabled)}}uo.tag="canvas",uo.ClickEventsFlag=1,uo.WheelEventsFlag=2,uo.MouseEventsFlag=4,uo.PointerEventsFlag=8,uo.TouchEventsFlag=16,uo.EventsMask=uo.ClickEventsFlag|uo.WheelEventsFlag|uo.MouseEventsFlag|uo.PointerEventsFlag|uo.TouchEventsFlag,uo.UncullFlags=Xn.UncullFlags|pn.NeedsRender|pn.NeedsComposite,uo.UnhideFlags=Xn.UnhideFlags|pn.NeedsRender|pn.NeedsComposite,u([i.Provider({type:to,observes:!1,service:to.global()})],uo.prototype,"spriteProvider",void 0);class po extends io{constructor(){super(),this.canvas=this.createCanvas(),Object.defineProperty(this,"renderer",{value:this.createRenderer(),writable:!0,enumerable:!0,configurable:!0}),this.ownRasterFrame=null}get pixelRatio(){return window.devicePixelRatio||1}get compositor(){const t=this.parent;return t instanceof io||t instanceof uo?t.renderer:null}setRenderer(t){"string"==typeof t&&(t=this.createRenderer(t)),this.renderer=t,this.requireUpdate(pn.NeedsRender|pn.NeedsComposite)}createRenderer(t="canvas"){if("canvas"===t){const t=this.canvas.getContext("2d");if(null!==t)return new ho(t,o.Transform.identity(),this.pixelRatio);throw new Error("Failed to create canvas rendering context")}if("webgl"===t){const t=this.canvas.getContext("webgl");if(null!==t)return new co(t,this.pixelRatio);throw new Error("Failed to create webgl rendering context")}throw new Error("Failed to create "+t+" renderer")}needsUpdate(t,e){const i=(t=super.needsUpdate(t,e))&(pn.NeedsRender|pn.NeedsComposite);return 0!==i&&(t|=pn.NeedsComposite,this.setFlags(this.flags|pn.NeedsDisplay|pn.NeedsComposite|i)),t}needsProcess(t,e){return 0==(this.flags&pn.ProcessMask)&&0==(t&pn.NeedsResize)&&(t=0),t}onResize(t){super.onResize(t),this.requireUpdate(pn.NeedsRender|pn.NeedsComposite)}needsDisplay(t,e){return 0!=(this.flags&pn.DisplayMask)?t|=pn.NeedsComposite:t=0!=(t&pn.NeedsComposite)?pn.NeedsDisplay|pn.NeedsComposite:0,t}onRender(t){const e=this.rasterFrame;this.resizeCanvas(this.canvas,e),this.resetRenderer(e),this.clearCanvas(e),super.onRender(t)}didComposite(t){this.compositeImage(t),super.didComposite(t)}extendViewContext(t){const e=Object.create(t);return e.compositor=t.renderer,e.renderer=this.renderer,e}get rasterFrame(){let t=this.ownRasterFrame;return null===t&&(t=this.deriveRasterFrame()),t}setRasterFrame(t){this.ownRasterFrame=t}deriveRasterFrame(){return this.viewBounds}createCanvas(){return document.createElement("canvas")}resizeCanvas(t,e){const i=this.pixelRatio,n=e.width,o=e.height,s=n*i,r=o*i,l=t.width,a=t.height;s===l&&r===a||(t.width=s,t.height=r,t.style.width=n+"px",t.style.height=o+"px")}clearCanvas(t){const e=this.renderer;if(e instanceof ho)e.context.clearRect(0,0,t.xMax,t.yMax);else if(e instanceof co){const t=e.context;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}}resetRenderer(t){const e=this.renderer;if(e instanceof ho){const i=this.pixelRatio,n=t.xMin*i,s=t.yMin*i;e.context.setTransform(i,0,0,i,-n,-s),e.setTransform(o.Transform.affine(i,0,0,i,-n,-s))}else e instanceof co&&e.context.viewport(t.x,t.y,t.xMax,t.yMax)}compositeImage(t){const e=t.compositor;if(e instanceof ho){const t=e.context,i=this.rasterFrame,n=this.canvas;if(i.isDefined()&&0!==i.width&&0!==i.height&&0!==n.width&&0!==n.height){const e=t.globalAlpha,o=t.globalCompositeOperation;t.globalAlpha=this.opacity.getValue(),t.globalCompositeOperation=this.compositeOperation.getValue(),t.drawImage(n,i.x,i.y,i.width,i.height),t.globalAlpha=e,t.globalCompositeOperation=o}}}init(t){super.init(t),void 0!==t.opacity&&this.opacity(t.opacity),void 0!==t.compositeOperation&&this.compositeOperation(t.compositeOperation)}}po.MountFlags=io.MountFlags|pn.NeedsComposite,po.UncullFlags=io.UncullFlags|pn.NeedsComposite,po.UnhideFlags=io.UnhideFlags|pn.NeedsComposite,u([$t({type:Number,value:1,updateFlags:pn.NeedsComposite})],po.prototype,"opacity",void 0),u([i.Property({type:String,value:"source-over",updateFlags:pn.NeedsComposite})],po.prototype,"compositeOperation",void 0),Object.defineProperty(po.prototype,"viewBounds",{get(){return this.deriveViewBounds()},configurable:!0});const fo=function(){const t={init:function(t,e){void 0!==e.fill&&t.fill(e.fill)},is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof io&&"fill"in e}return!1}};return t}(),go=function(){const t={init:function(t,e){void 0!==e.stroke&&t.stroke(e.stroke),void 0!==e.strokeWidth&&t.strokeWidth(e.strokeWidth)},is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof io&&"stroke"in e&&"strokeWidth"in e}return!1}};return t}();class vo{constructor(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}withX(t){return t=o.Length.fromAny(t),this.x.equals(t)?this:this.copy(t,this.y,this.width,this.height)}withY(t){return t=o.Length.fromAny(t),this.y.equals(t)?this:this.copy(this.x,t,this.width,this.height)}withWidth(t){return t=o.Length.fromAny(t),this.width.equals(t)?this:this.copy(this.x,this.y,t,this.height)}withHeight(t){return t=o.Length.fromAny(t),this.height.equals(t)?this:this.copy(this.x,this.y,this.width,t)}render(t,e){if(void 0===t){const t=new oo;return t.setPrecision(3),this.draw(t,e),t.toString()}t instanceof so&&this.draw(t.context,e)}draw(t,e=null){this.renderRect(t,e)}renderRect(t,e){t.rect(this.x.pxValue(),this.y.pxValue(),this.width.pxValue(),this.height.pxValue())}copy(t,e,i,n){return new vo(t,e,i,n)}toAny(){return{x:this.x,y:this.y,width:this.width,height:this.height}}equals(t){return this===t||t instanceof vo&&(this.x.equals(t.x)&&this.y.equals(t.y)&&this.width.equals(t.width)&&this.height.equals(t.height))}debug(t){return t=t.write("Rect").write(46).write("create").write(40).debug(this.x).write(", ").debug(this.y).write(", ").debug(this.width).write(", ").debug(this.height).write(41)}toString(){return s.Format.debug(this)}static create(t,e,i,n){return t=o.Length.fromAny(t),e=o.Length.fromAny(e),i=o.Length.fromAny(i),n=o.Length.fromAny(n),new vo(t,e,i,n)}static fromAny(t){if(t instanceof vo)return t;if("object"==typeof t&&null!==t)return vo.create(t.x,t.y,t.width,t.height);throw new TypeError(""+t)}}class wo extends io{get value(){return new vo(this.x.getValue(),this.y.getValue(),this.width.getValue(),this.height.getValue())}get state(){return new vo(this.x.getState(),this.y.getState(),this.width.getState(),this.height.getState())}setState(t,e){t instanceof vo&&(t=t.toAny()),void 0!==t.x&&this.x(t.x,e),void 0!==t.y&&this.y(t.y,e),void 0!==t.width&&this.width(t.width,e),void 0!==t.height&&this.height(t.height,e),void 0!==t.fill&&this.fill(t.fill,e),void 0!==t.stroke&&this.stroke(t.stroke,e),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth,e)}onRender(t){super.onRender(t);const e=t.renderer;e instanceof ro&&!this.hidden&&!this.culled&&this.renderRect(e.context,this.viewFrame)}renderRect(t,e){const i=this.x.getValue().pxValue(e.width),n=this.y.getValue().pxValue(e.height),o=this.width.getValue().pxValue(e.width),s=this.height.getValue().pxValue(e.height),r=t.fillStyle,l=t.lineWidth,a=t.strokeStyle;t.beginPath(),t.rect(i,n,o,s);const h=this.fill.value;null!==h&&(t.fillStyle=h.toString(),t.fill());const c=this.stroke.value;if(null!==c){const i=this.strokeWidth.value;if(null!==i){const n=Math.min(e.width,e.height);t.lineWidth=i.pxValue(n)}t.strokeStyle=c.toString(),t.stroke()}t.fillStyle=r,t.lineWidth=l,t.strokeStyle=a}hitTest(t,e,i){const n=i.renderer;if(n instanceof ho){const i=n.transform.transform(t,e);return this.hitTestRect(i.x,i.y,n.context,this.viewFrame)}return null}hitTestRect(t,e,i,n){const o=this.x.getValue().pxValue(n.width),s=this.y.getValue().pxValue(n.height),r=this.width.getValue().pxValue(n.width),l=this.height.getValue().pxValue(n.height);if(i.beginPath(),i.rect(o,s,r,l),null!==this.fill.value&&i.isPointInPath(t,e))return this;if(null!==this.stroke.value){const o=this.strokeWidth.value;if(null!==o){const s=i.lineWidth,r=Math.min(n.width,n.height);i.lineWidth=o.pxValue(r);const l=i.isPointInStroke(t,e);if(i.lineWidth=s,l)return this}}return null}init(t){t instanceof vo||super.init(t),this.setState(t)}}u([zt({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsRender})],wo.prototype,"x",void 0),u([zt({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsRender})],wo.prototype,"y",void 0),u([zt({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsRender})],wo.prototype,"width",void 0),u([zt({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsRender})],wo.prototype,"height",void 0),u([zt({type:B,value:null,inherits:!0,updateFlags:pn.NeedsRender})],wo.prototype,"fill",void 0),u([zt({type:B,value:null,inherits:!0,updateFlags:pn.NeedsRender})],wo.prototype,"stroke",void 0),u([zt({type:o.Length,value:null,inherits:!0,updateFlags:pn.NeedsRender})],wo.prototype,"strokeWidth",void 0),Object.defineProperty(wo.prototype,"viewBounds",{get(){const t=this.viewFrame,e=this.x.getValue().pxValue(t.width),i=this.y.getValue().pxValue(t.height),n=this.width.getValue().pxValue(t.width),s=this.height.getValue().pxValue(t.height);return new o.R2Box(e,i,e+n,i+s)},configurable:!0});class yo{constructor(t,e,i,n,o,s,r,l){this.center=t,this.innerRadius=e,this.outerRadius=i,this.startAngle=n,this.sweepAngle=o,this.padAngle=s,this.padRadius=r,this.cornerRadius=l}withCenter(t){return t=o.R2Point.fromAny(t),this.center.equals(t)?this:this.copy(t,this.innerRadius,this.outerRadius,this.startAngle,this.sweepAngle,this.padAngle,this.padRadius,this.cornerRadius)}withInnerRadius(t){return t=o.Length.fromAny(t),this.innerRadius.equals(t)?this:this.copy(this.center,t,this.outerRadius,this.startAngle,this.sweepAngle,this.padAngle,this.padRadius,this.cornerRadius)}withOuterRadius(t){return t=o.Length.fromAny(t),this.outerRadius.equals(t)?this:this.copy(this.center,this.innerRadius,t,this.startAngle,this.sweepAngle,this.padAngle,this.padRadius,this.cornerRadius)}withStartAngle(t){return t=o.Angle.fromAny(t),this.startAngle.equals(t)?this:this.copy(this.center,this.innerRadius,this.outerRadius,t,this.sweepAngle,this.padAngle,this.padRadius,this.cornerRadius)}withSweepAngle(t){return t=o.Angle.fromAny(t),this.sweepAngle.equals(t)?this:this.copy(this.center,this.innerRadius,this.outerRadius,this.startAngle,t,this.padAngle,this.padRadius,this.cornerRadius)}withPadAngle(t){return t=o.Angle.fromAny(t),this.padAngle.equals(t)?this:this.copy(this.center,this.innerRadius,this.outerRadius,this.startAngle,this.sweepAngle,t,this.padRadius,this.cornerRadius)}withPadRadius(t){return null!==t&&(t=o.Length.fromAny(t)),e.Equals(this.padRadius,t)?this:this.copy(this.center,this.innerRadius,this.outerRadius,this.startAngle,this.sweepAngle,this.padAngle,t,this.cornerRadius)}withCornerRadius(t){return t=o.Length.fromAny(t),this.cornerRadius.equals(t)?this:this.copy(this.center,this.innerRadius,this.outerRadius,this.startAngle,this.sweepAngle,this.padAngle,this.padRadius,t)}render(t,e){if(void 0===t){const t=new oo;return t.setPrecision(3),this.draw(t,e),t.toString()}t instanceof so&&this.draw(t.context,e)}draw(t,e){this.renderArc(t,e)}renderArc(t,e){let i;void 0!==e&&(i=Math.min(e.width,e.height));const n=this.center,o=n.x,s=n.y;let r=this.innerRadius.pxValue(i),l=this.outerRadius.pxValue(i);const a=this.startAngle.radValue(),h=this.sweepAngle.radValue(),c=a+h,d=h>=0;if(l<r){const t=l;l=r,r=t}if(l>yo.Epsilon)if(h>2*Math.PI-yo.Epsilon)t.moveTo(o+l*Math.cos(a),s+l*Math.sin(a)),t.arc(o,s,l,a,c,!d),r>yo.Epsilon&&(t.moveTo(o+r*Math.cos(c),s+r*Math.sin(c)),t.arc(o,s,r,c,a,d));else{let e=a,n=c,u=a,p=c,f=h,g=h;const v=this.padAngle.radValue()/2,w=+(v>yo.Epsilon)&&(null!==this.padRadius?this.padRadius.pxValue(i):Math.sqrt(r*r+l*l)),y=Math.min(Math.abs(l-r)/2,this.cornerRadius.pxValue(i));let m,b,C=y,S=y;if(w>yo.Epsilon){let t=Math.asin(w/r*Math.sin(v)),i=Math.asin(w/l*Math.sin(v));(f-=2*t)>yo.Epsilon?(t*=d?1:-1,u+=t,p-=t):(f=0,u=p=(a+c)/2),(g-=2*i)>yo.Epsilon?(i*=d?1:-1,e+=i,n-=i):(g=0,e=n=(a+c)/2)}const A=l*Math.cos(e),x=l*Math.sin(e),T=r*Math.cos(p),D=r*Math.sin(p);let V,P;if(y>yo.Epsilon&&(V=l*Math.cos(n),P=l*Math.sin(n),m=r*Math.cos(u),b=r*Math.sin(u),h<Math.PI)){const t=f>yo.Epsilon?yo.intersect(A,x,m,b,V,P,T,D):[T,D],e=A-t[0],i=x-t[1],n=V-t[0],o=P-t[1],s=1/Math.sin(.5*Math.acos((e*n+i*o)/(Math.sqrt(e*e+i*i)*Math.sqrt(n*n+o*o)))),a=Math.sqrt(t[0]*t[0]+t[1]*t[1]);C=Math.min(y,(r-a)/(s-1)),S=Math.min(y,(l-a)/(s+1))}if(g>yo.Epsilon)if(S>yo.Epsilon){const e=yo.cornerTangents(m,b,A,x,l,S,d),i=yo.cornerTangents(V,P,T,D,l,S,d);t.moveTo(o+e.cx+e.x01,s+e.cy+e.y01),S<y?t.arc(o+e.cx,s+e.cy,S,Math.atan2(e.y01,e.x01),Math.atan2(i.y01,i.x01),!d):(t.arc(o+e.cx,s+e.cy,S,Math.atan2(e.y01,e.x01),Math.atan2(e.y11,e.x11),!d),t.arc(o,s,l,Math.atan2(e.cy+e.y11,e.cx+e.x11),Math.atan2(i.cy+i.y11,i.cx+i.x11),!d),t.arc(o+i.cx,s+i.cy,S,Math.atan2(i.y11,i.x11),Math.atan2(i.y01,i.x01),!d))}else t.moveTo(o+A,s+x),t.arc(o,s,l,e,n,!d);else t.moveTo(o+A,s+x);if(r>yo.Epsilon&&f>yo.Epsilon)if(C>yo.Epsilon){const e=yo.cornerTangents(T,D,V,P,r,-C,d),i=yo.cornerTangents(A,x,m,b,r,-C,d);t.lineTo(o+e.cx+e.x01,s+e.cy+e.y01),C<y?t.arc(o+e.cx,s+e.cy,C,Math.atan2(e.y01,e.x01),Math.atan2(i.y01,i.x01),!d):(t.arc(o+e.cx,s+e.cy,C,Math.atan2(e.y01,e.x01),Math.atan2(e.y11,e.x11),!d),t.arc(o,s,r,Math.atan2(e.cy+e.y11,e.cx+e.x11),Math.atan2(i.cy+i.y11,i.cx+i.x11),d),t.arc(o+i.cx,s+i.cy,C,Math.atan2(i.y11,i.x11),Math.atan2(i.y01,i.x01),!d))}else t.arc(o,s,r,p,u,d);else t.lineTo(o+T,s+D)}else t.moveTo(o,s);t.closePath()}copy(t,e,i,n,o,s,r,l){return new yo(t,e,i,n,o,s,r,l)}toAny(){return{center:this.center,innerRadius:this.innerRadius,outerRadius:this.outerRadius,startAngle:this.startAngle,sweepAngle:this.sweepAngle,padAngle:this.padAngle,padRadius:this.padRadius,cornerRadius:this.cornerRadius}}equals(t){return this===t||t instanceof yo&&(this.center.equals(t.center)&&this.innerRadius.equals(t.innerRadius)&&this.outerRadius.equals(t.outerRadius)&&this.startAngle.equals(t.startAngle)&&this.sweepAngle.equals(t.sweepAngle)&&this.padAngle.equals(t.padAngle)&&e.Equals(this.padRadius,t.padRadius)&&this.cornerRadius.equals(t.cornerRadius))}debug(t){return t=t.write("Arc").write(46).write("create").write(40).write(41),this.center.isDefined()&&(t=t.write(46).write("center").write(40).debug(this.center).write(41)),this.innerRadius.isDefined()&&(t=t.write(46).write("innerRadius").write(40).debug(this.innerRadius).write(41)),this.outerRadius.isDefined()&&(t=t.write(46).write("outerRadius").write(40).debug(this.outerRadius).write(41)),this.startAngle.isDefined()&&(t=t.write(46).write("startAngle").write(40).debug(this.startAngle).write(41)),this.sweepAngle.isDefined()&&(t=t.write(46).write("sweepAngle").write(40).debug(this.sweepAngle).write(41)),this.padAngle.isDefined()&&(t=t.write(46).write("padAngle").write(40).debug(this.padAngle).write(41)),null!==this.padRadius&&(t=t.write(46).write("padRadius").write(40).debug(this.padRadius).write(41)),this.cornerRadius.isDefined()&&(t=t.write(46).write("cornerRadius").write(40).debug(this.cornerRadius).write(41)),t}toString(){return s.Format.debug(this)}static create(t=o.R2Point.origin(),e=o.Length.zero(),i=o.Length.zero(),n=o.Angle.zero(),s=o.Angle.zero(),r=o.Angle.zero(),l=null,a=o.Length.zero()){return t=o.R2Point.fromAny(t),e=o.Length.fromAny(e),i=o.Length.fromAny(i),n=o.Angle.fromAny(n),s=o.Angle.fromAny(s),r=o.Angle.fromAny(r),l=null!==l?o.Length.fromAny(l):null,a=o.Length.fromAny(a),new yo(t,e,i,n,s,r,l,a)}static fromAny(t){if(t instanceof yo)return t;if("object"==typeof t&&null!==t)return yo.create(t.center,t.innerRadius,t.outerRadius,t.startAngle,t.sweepAngle,t.padAngle,t.padRadius,t.cornerRadius);throw new TypeError(""+t)}static intersect(t,e,i,n,o,s,r,l){const a=i-t,h=n-e,c=r-o,d=l-s,u=(c*(e-s)-d*(t-o))/(d*a-c*h);return[t+u*a,e+u*h]}static cornerTangents(t,e,i,n,o,s,r){const l=t-i,a=e-n,h=(r?s:-s)/Math.sqrt(l*l+a*a),c=h*a,d=-h*l,u=t+c,p=e+d,f=i+c,g=n+d,v=(u+f)/2,w=(p+g)/2,y=f-u,m=g-p,b=y*y+m*m,C=o-s,S=u*g-f*p,A=(m<0?-1:1)*Math.sqrt(Math.max(0,C*C*b-S*S));let x=(S*m-y*A)/b,T=(-S*y-m*A)/b;const D=(S*m+y*A)/b,V=(-S*y+m*A)/b,P=x-v,I=T-w,M=D-v,L=V-w;return P*P+I*I>M*M+L*L&&(x=D,T=V),{cx:x,cy:T,x01:-c,y01:-d,x11:x*(o/C-1),y11:T*(o/C-1)}}}yo.Epsilon=1e-12;class mo extends io{get value(){return new yo(this.center.value,this.innerRadius.value,this.outerRadius.value,this.startAngle.value,this.sweepAngle.value,this.padAngle.value,this.padRadius.value,this.cornerRadius.value)}get state(){return new yo(this.center.state,this.innerRadius.state,this.outerRadius.state,this.startAngle.state,this.sweepAngle.state,this.padAngle.state,this.padRadius.state,this.cornerRadius.state)}setState(t,e){t instanceof yo&&(t=t.toAny()),void 0!==t.center&&this.center(t.center,e),void 0!==t.innerRadius&&this.innerRadius(t.innerRadius,e),void 0!==t.outerRadius&&this.outerRadius(t.outerRadius,e),void 0!==t.startAngle&&this.startAngle(t.startAngle,e),void 0!==t.sweepAngle&&this.sweepAngle(t.sweepAngle,e),void 0!==t.padAngle&&this.padAngle(t.padAngle,e),void 0!==t.padRadius&&this.padRadius(t.padRadius,e),void 0!==t.cornerRadius&&this.cornerRadius(t.cornerRadius,e),void 0!==t.fill&&this.fill(t.fill,e),void 0!==t.stroke&&this.stroke(t.stroke,e),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth,e)}layoutArc(){if(this.center.hasAffinity(i.Affinity.Intrinsic)){const t=this.viewFrame,e=t.xMin+t.width*this.xAlign.getValue(),n=t.yMin+t.height*this.yAlign.getValue();this.center.setState(new o.R2Point(e,n),i.Affinity.Intrinsic)}}onRender(t){super.onRender(t);const e=t.renderer;e instanceof ro&&!this.hidden&&!this.culled&&(this.layoutArc(),this.renderArc(e.context,this.viewFrame))}renderArc(t,e){const i=t.fillStyle,n=t.lineWidth,o=t.strokeStyle,s=this.value;t.beginPath(),s.draw(t,e);const r=this.fill.value;null!==r&&(t.fillStyle=r.toString(),t.fill());const l=this.stroke.value;if(null!==l){const i=this.strokeWidth.value;if(null!==i){const n=Math.min(e.width,e.height);t.lineWidth=i.pxValue(n)}t.strokeStyle=l.toString(),t.stroke()}t.fillStyle=i,t.lineWidth=n,t.strokeStyle=o}get popoverFrame(){const t=this.viewFrame,e=Math.min(t.width,t.height),i=this.pageTransform.inverse(),n=this.center.getValue(),s=i.transformX(n.x,n.y),r=i.transformY(n.x,n.y),l=(this.innerRadius.getValue().pxValue(e)+this.outerRadius.getValue().pxValue(e))/2,a=this.startAngle.getValue().radValue()+this.sweepAngle.getValue().radValue()/2,h=s+l*Math.cos(a),c=r+l*Math.sin(a);return new o.R2Box(h,c,h,c)}hitTest(t,e,i){const n=i.renderer;if(n instanceof ho){const i=n.transform.transform(t,e);return this.layoutArc(),this.hitTestArc(i.x,i.y,n.context,this.viewFrame)}return null}hitTestArc(t,e,i,n){const o=this.value;if(i.beginPath(),o.draw(i,n),null!==this.fill.value&&i.isPointInPath(t,e))return this;if(null!==this.stroke.value){const o=this.strokeWidth.value;if(null!==o){const s=i.lineWidth,r=Math.min(n.width,n.height);i.lineWidth=o.pxValue(r);const l=i.isPointInStroke(t,e);if(i.lineWidth=s,l)return this}}return null}init(t){t instanceof yo||super.init(t),this.setState(t)}static fromArc(t){const e=new mo;return e.setState(t),e}}u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsRender})],mo.prototype,"xAlign",void 0),u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsRender})],mo.prototype,"yAlign",void 0),u([i.Animator({type:o.R2Point,value:o.R2Point.origin(),updateFlags:pn.NeedsRender})],mo.prototype,"center",void 0),u([zt({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsRender})],mo.prototype,"innerRadius",void 0),u([zt({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsRender})],mo.prototype,"outerRadius",void 0),u([zt({type:o.Angle,value:o.Angle.zero(),updateFlags:pn.NeedsRender})],mo.prototype,"startAngle",void 0),u([zt({type:o.Angle,value:o.Angle.zero(),updateFlags:pn.NeedsRender})],mo.prototype,"sweepAngle",void 0),u([zt({type:o.Angle,value:o.Angle.zero(),updateFlags:pn.NeedsRender})],mo.prototype,"padAngle",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsRender})],mo.prototype,"padRadius",void 0),u([zt({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsRender})],mo.prototype,"cornerRadius",void 0),u([zt({type:B,value:null,inherits:!0,updateFlags:pn.NeedsRender})],mo.prototype,"fill",void 0),u([zt({type:B,value:null,inherits:!0,updateFlags:pn.NeedsRender})],mo.prototype,"stroke",void 0),u([zt({type:o.Length,value:null,inherits:!0,updateFlags:pn.NeedsRender})],mo.prototype,"strokeWidth",void 0),Object.defineProperty(mo.prototype,"viewBounds",{get(){const t=this.viewFrame,e=Math.min(t.width,t.height),i=this.center.getValue(),n=this.outerRadius.getValue().pxValue(e);return new o.R2Box(i.x-n,i.y-n,i.x+n,i.y+n)},configurable:!0});const bo=function(){const t={init:function(t,e){void 0!==e.font&&t.font(e.font),void 0!==e.textAlign&&t.textAlign(e.textAlign),void 0!==e.textBaseline&&t.textBaseline(e.textBaseline),void 0!==e.textOrigin&&t.textOrigin(e.textOrigin),void 0!==e.textColor&&t.textColor(e.textColor)},is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof io&&"font"in e&&"textAlign"in e&&"textBaseline"in e&&"textOrigin"in e&&"textColor"in e}return!1}};return t}();class Co{constructor(t,e,i,n,o,s){this.text=t,this.font=e,this.textAlign=i,this.textBaseline=n,this.textOrigin=o,this.textColor=s}withText(t){return this.text===t?this:this.copy(t,this.font,this.textAlign,this.textBaseline,this.textOrigin,this.textColor)}withFont(t){return null!==t&&(t=O.fromAny(t)),this.font===t?this:this.copy(this.text,t,this.textAlign,this.textBaseline,this.textOrigin,this.textColor)}withTextAlign(t){return this.textAlign===t?this:this.copy(this.text,this.font,t,this.textBaseline,this.textOrigin,this.textColor)}withTextBaseline(t){return this.textBaseline===t?this:this.copy(this.text,this.font,this.textAlign,t,this.textOrigin,this.textColor)}withTextOrigin(t){return null!==t&&(t=o.R2Point.fromAny(t)),e.Equals(this.textOrigin,t)?this:this.copy(this.text,this.font,this.textAlign,this.textBaseline,t,this.textColor)}withTextColor(t){return null!==t&&(t=B.fromAny(t)),e.Equals(this.textColor,t)?this:this.copy(this.text,this.font,this.textAlign,this.textBaseline,this.textOrigin,t)}render(t,e){t instanceof ho&&this.draw(t.context,e)}draw(t,e){this.renderText(t,e)}renderText(t,e){const i=t.font,n=t.textAlign,s=t.textBaseline,r=t.fillStyle;null!==this.font&&(t.font=this.font.toString()),null!==this.textAlign&&(t.textAlign=this.textAlign),null!==this.textBaseline&&(t.textBaseline=this.textBaseline),null!==this.textColor&&(t.fillStyle=this.textColor.toString());let l=this.textOrigin;null===l&&(l=o.R2Point.origin()),t.fillText(this.text,l.x,l.y),t.font=i,t.textAlign=n,t.textBaseline=s,t.fillStyle=r}copy(t,e,i,n,o,s){return new Co(t,e,i,n,o,s)}toAny(){const t={text:this.text};return t.text=this.text,null!==this.font&&(t.font=this.font),null!==this.font&&(t.font=this.font),null!==this.textAlign&&(t.textAlign=this.textAlign),null!==this.textBaseline&&(t.textBaseline=this.textBaseline),null!==this.textOrigin&&(t.textOrigin=this.textOrigin),null!==this.textColor&&(t.textColor=this.textColor),t}equals(t){return this===t||t instanceof Co&&(this.text===t.text&&e.Equals(this.font,t.font)&&this.textAlign===t.textAlign&&this.textBaseline===t.textBaseline&&e.Equals(this.textOrigin,t.textOrigin)&&e.Equals(this.textColor,t.textColor))}debug(t){return t=t.write("TextRun").write(46).write("create").write(40).debug(this.text).write(41),null!==this.font&&(t=t.write(46).write("font").write(40).debug(this.font).write(41)),null!==this.textAlign&&(t=t.write(46).write("textAlign").write(40).debug(this.textAlign).write(41)),null!==this.textBaseline&&(t=t.write(46).write("textBaseline").write(40).debug(this.textBaseline).write(41)),null!==this.textOrigin&&(t=t.write(46).write("textOrigin").write(40).debug(this.textOrigin).write(41)),null!==this.textColor&&(t=t.write(46).write("textColor").write(40).debug(this.textColor).write(41)),t}toString(){return s.Format.debug(this)}static create(t,e=null,i=null,n=null,s=null,r=null){return null!==e&&(e=O.fromAny(e)),null!==s&&(s=o.R2Point.fromAny(s)),null!==r&&(r=B.fromAny(r)),new Co(t,e,i,n,s,r)}static fromAny(t){if(t instanceof Co)return t;if("string"==typeof t)return Co.create(t);if("object"==typeof t&&null!==t)return Co.create(t.text,t.font,t.textAlign,t.textBaseline,t.textOrigin,t.textColor);throw new TypeError(""+t)}}class So extends io{get value(){return new Co(this.text.getValue(),this.font.getValue(),this.textAlign.getValue(),this.textBaseline.getValue(),this.textOrigin.getValue(),this.textColor.getValue())}get state(){return new Co(this.text.getState(),this.font.getState(),this.textAlign.getState(),this.textBaseline.getState(),this.textOrigin.getState(),this.textColor.getState())}setState(t,e){"string"==typeof t?this.text(t,e):(t instanceof Co&&(t=t.toAny()),void 0!==t.text&&this.text(t.text,e),void 0!==t.font&&this.font(t.font,e),void 0!==t.textAlign&&this.textAlign(t.textAlign,e),void 0!==t.textBaseline&&this.textBaseline(t.textBaseline,e),void 0!==t.textOrigin&&this.textOrigin(t.textOrigin,e),void 0!==t.textColor&&this.textColor(t.textColor,e))}onRender(t){super.onRender(t);const e=t.renderer;e instanceof ho&&!this.hidden&&!this.culled&&this.renderText(e.context)}renderText(t){const e=t.font,i=t.textAlign,n=t.textBaseline,s=t.fillStyle,r=this.font.value;null!==r&&(t.font=r.toString());const l=this.textAlign.value;void 0!==l&&(t.textAlign=l);const a=this.textBaseline.value;void 0!==a&&(t.textBaseline=a);const h=this.textColor.value;null!==h&&(t.fillStyle=h.toString());let c=this.textOrigin.value;null===c&&(c=o.R2Point.origin()),t.fillText(this.text.getValue(),c.x,c.y),t.font=e,t.textAlign=i,t.textBaseline=n,t.fillStyle=s}init(t){"string"!=typeof t?(t instanceof Co||super.init(t),this.setState(t)):this.text(t)}}u([zt({type:String,value:"",updateFlags:pn.NeedsRender})],So.prototype,"text",void 0),u([zt({type:O,value:null,inherits:!0,updateFlags:pn.NeedsRender})],So.prototype,"font",void 0),u([zt({type:String,inherits:!0,updateFlags:pn.NeedsRender})],So.prototype,"textAlign",void 0),u([zt({type:String,inherits:!0,updateFlags:pn.NeedsRender})],So.prototype,"textBaseline",void 0),u([zt({type:o.R2Point,value:null,inherits:!0,updateFlags:pn.NeedsRender})],So.prototype,"textOrigin",void 0),u([zt({type:B,value:null,inherits:!0,updateFlags:pn.NeedsRender})],So.prototype,"textColor",void 0);const Ao=function(){const t={fromAny:function(t){if(null==t)return t;return{iconWidth:o.Length.fromAny(t.iconWidth),iconHeight:o.Length.fromAny(t.iconHeight),xAlign:t.xAlign,yAlign:t.yAlign}},is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){const e=t;return"iconWidth"in e&&"iconHeight"in e}return!1}};return t}();class xo{}class To extends xo{}class Do extends To{constructor(t,e,i,n,o){super(),this.path=t,this.fillRule=e,this.fillColor=i,this.fillLook=n,this.moodModifier=o}withFillRule(t){return e.Equals(this.fillRule,t)?this:this.copy(this.path,t,this.fillColor,this.fillLook,this.moodModifier)}withFillColor(t){return e.Equals(this.fillColor,t)?this:this.copy(this.path,this.fillRule,t,this.fillLook,this.moodModifier)}withFillLook(t){return this.fillLook===t?this:this.copy(this.path,this.fillRule,this.fillColor,t,this.moodModifier)}withMoodModifier(t){return e.Equals(this.moodModifier,t)?this:this.copy(this.path,this.fillRule,this.fillColor,this.fillLook,t)}modifyMood(t,e){let i=this.moodModifier;null===i&&(i=Et.empty());const n=i.updatedCol(t,e,!0);return n.equals(i)?this:this.withMoodModifier(n)}isThemed(){return null!==this.fillColor}withTheme(t,e){const i=this.fillLook;if(null!==i){const n=this.moodModifier;return null!==n&&(e=n.timesCol(e,!0)),this.withFillColor(t.getOr(i,e,null))}return this}render(t,e){t instanceof ro?this.paint(t.context,e):t instanceof no&&this.draw(t.context,e)}paint(t,e){const i=t.fillStyle;t.beginPath(),this.draw(t,e),null!==this.fillColor&&(t.fillStyle=this.fillColor.toString()),t.fill(this.fillRule),t.fillStyle=i}draw(t,e){const i=o.Transform.scale(e.width,e.height).translate(e.x,e.y);this.path.transformDraw(t,i)}copy(t,e,i,n,o){return new Do(t,e,i,n,o)}interpolateTo(t){return t instanceof Do?Vo(this,t):null}equivalentTo(t,i){return this===t||t instanceof Do&&(this.path.equivalentTo(t.path,i)&&this.fillRule===t.fillRule&&e.Equivalent(this.fillColor,t.fillColor,i)&&this.fillLook===t.fillLook&&e.Equivalent(this.moodModifier,t.moodModifier,i))}equals(t){return this===t||t instanceof Do&&(this.path.equals(t.path)&&this.fillRule===t.fillRule&&e.Equals(this.fillColor,t.fillColor)&&this.fillLook===t.fillLook&&e.Equals(this.moodModifier,t.moodModifier))}debug(t){return t=t.write("new").write(32).write("VectorIcon").write(40).debug(this.path).write(", ").debug(this.fillRule).write(", ").debug(this.fillColor).write(", ").debug(this.fillLook).write(", ").debug(this.moodModifier).write(41)}toString(){return s.Format.debug(this)}static create(t,e,i,n){return i=o.R2Path.fromAny(i),1===t&&1===e||(i=i.transform(o.Transform.scale(1/t,1/e))),void 0===n&&(n="nonzero"),new Do(i,n,null,St.iconColor,null)}}const Vo=function(t){const i=function(t,n){const o=function(t){const e=o.path,i=o.fillRule,n=o.fillColorInterpolator(t),s=o.fillLook,r=o.moodModifier;return new Do(e,i,n,s,r)};return Object.setPrototypeOf(o,i.prototype),o.path=n.path,o.fillRule=n.fillRule,o.fillColorInterpolator=e.Interpolator(t.fillColor,n.fillColor),o.fillLook=n.fillLook,o.moodModifier=n.moodModifier,o};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.path,e=this.fillRule,i=this.fillColorInterpolator[0],n=this.fillLook,o=this.moodModifier;return new Do(t,e,i,n,o)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.path,e=this.fillRule,i=this.fillColorInterpolator[1],n=this.fillLook,o=this.moodModifier;return new Do(t,e,i,n,o)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.path.equals(t.path)&&this.fillRule===t.fillRule&&this.fillColorInterpolator.equals(t.fillColorInterpolator)&&this.fillLook===t.fillLook&&e.Equals(this.moodModifier,t.moodModifier))},i}(e.Interpolator);class Po extends To{constructor(t,e,i){super(),this.fillColor=t,this.fillLook=e,this.moodModifier=i}withFillColor(t){return e.Equals(this.fillColor,t)?this:this.copy(t,this.fillLook,this.moodModifier)}withFillLook(t){return this.fillLook===t?this:this.copy(this.fillColor,t,this.moodModifier)}withMoodModifier(t){return e.Equals(this.moodModifier,t)?this:this.copy(this.fillColor,this.fillLook,t)}modifyMood(t,e){let i=this.moodModifier;null===i&&(i=Et.empty());const n=i.updatedCol(t,e,!0);return n.equals(i)?this:this.withMoodModifier(n)}isThemed(){return null!==this.fillColor}withTheme(t,e){const i=this.fillLook;if(null!==i){const n=this.moodModifier;return null!==n&&(e=n.timesCol(e,!0)),this.withFillColor(t.getOr(i,e,null))}return this}render(t,e){t instanceof ro?this.paint(t.context,e):t instanceof no&&this.draw(t.context,e)}paint(t,e){const i=t.fillStyle;t.beginPath(),this.draw(t,e),null!==this.fillColor&&(t.fillStyle=this.fillColor.toString()),t.fill(),t.fillStyle=i}draw(t,e){const i=(e.xMin+e.xMax)/2,n=(e.yMin+e.yMax)/2,o=e.width,s=e.height,r=Math.min(o,s)/2;t.arc(i,n,r,0,2*Math.PI),t.closePath()}copy(t,e,i){return new Po(t,e,i)}interpolateTo(t){return t instanceof Po?Io(this,t):null}equivalentTo(t,i){return this===t||t instanceof Po&&(e.Equivalent(this.fillColor,t.fillColor,i)&&this.fillLook===t.fillLook&&e.Equivalent(this.moodModifier,t.moodModifier,i))}equals(t){return this===t||t instanceof Po&&(e.Equals(this.fillColor,t.fillColor)&&this.fillLook===t.fillLook&&e.Equals(this.moodModifier,t.moodModifier))}debug(t){return t=t.write("new").write(32).write("CircleIcon").write(40).debug(this.fillColor).write(", ").debug(this.fillLook).write(", ").debug(this.moodModifier).write(41)}toString(){return s.Format.debug(this)}static create(){return new Po(null,St.accentColor,null)}}u([e.Lazy],Po,"create",null);const Io=function(t){const i=function(t,n){const o=function(t){const e=o.fillColorInterpolator(t),i=o.fillLook,n=o.moodModifier;return new Po(e,i,n)};return Object.setPrototypeOf(o,i.prototype),o.fillColorInterpolator=e.Interpolator(t.fillColor,n.fillColor),o.fillLook=n.fillLook,o.moodModifier=n.moodModifier,o};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.fillColorInterpolator[0],e=this.fillLook,i=this.moodModifier;return new Po(t,e,i)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.fillColorInterpolator[1],e=this.fillLook,i=this.moodModifier;return new Po(t,e,i)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.fillColorInterpolator.equals(t.fillColorInterpolator)&&this.fillLook===t.fillLook&&e.Equals(this.moodModifier,t.moodModifier))},i}(e.Interpolator);class Mo extends To{constructor(t,e,i,n,o){super(),this.sides=t,this.rotation=e,this.fillColor=i,this.fillLook=n,this.moodModifier=o}withFillColor(t){return e.Equals(this.fillColor,t)?this:this.copy(this.sides,this.rotation,t,this.fillLook,this.moodModifier)}withFillLook(t){return this.fillLook===t?this:this.copy(this.sides,this.rotation,this.fillColor,t,this.moodModifier)}withMoodModifier(t){return e.Equals(this.moodModifier,t)?this:this.copy(this.sides,this.rotation,this.fillColor,this.fillLook,t)}modifyMood(t,e){let i=this.moodModifier;null===i&&(i=Et.empty());const n=i.updatedCol(t,e,!0);return n.equals(i)?this:this.withMoodModifier(n)}isThemed(){return null!==this.fillColor}withTheme(t,e){const i=this.fillLook;if(null!==i){const n=this.moodModifier;return null!==n&&(e=n.timesCol(e,!0)),this.withFillColor(t.getOr(i,e,null))}return this}render(t,e){t instanceof ro?this.paint(t.context,e):t instanceof no&&this.draw(t.context,e)}paint(t,e){const i=t.fillStyle;t.beginPath(),this.draw(t,e),null!==this.fillColor&&(t.fillStyle=this.fillColor.toString()),t.fill(),t.fillStyle=i}draw(t,e){const i=this.sides;if(i>=3){const n=(e.xMin+e.xMax)/2,o=(e.yMin+e.yMax)/2,s=e.width,r=e.height,l=Math.min(s,r)/2,a=2*Math.PI/i;let h=this.rotation.radValue();t.moveTo(n+l*Math.cos(h),o+l*Math.sin(h)),h+=a;for(let e=1;e<i;e+=1)t.lineTo(n+l*Math.cos(h),o+l*Math.sin(h)),h+=a;t.closePath()}}copy(t,e,i,n,o){return new Mo(t,e,i,n,o)}interpolateTo(t){return t instanceof Mo?Lo(this,t):null}equivalentTo(t,i){return this===t||t instanceof Mo&&(this.sides===t.sides&&this.rotation.equivalentTo(t.rotation,i)&&e.Equivalent(this.fillColor,t.fillColor,i)&&this.fillLook===t.fillLook&&e.Equivalent(this.moodModifier,t.moodModifier,i))}equals(t){return this===t||t instanceof Mo&&(this.sides===t.sides&&this.rotation.equals(t.rotation)&&e.Equals(this.fillColor,t.fillColor)&&this.fillLook===t.fillLook&&e.Equals(this.moodModifier,t.moodModifier))}debug(t){return t=t.write("new").write(32).write("PolygonIcon").write(40).debug(this.sides).write(", ").debug(this.rotation).write(", ").debug(this.fillColor).write(", ").debug(this.fillLook).write(", ").debug(this.moodModifier).write(41)}toString(){return s.Format.debug(this)}static create(t,e){return e=void 0!==e?o.Angle.fromAny(e):o.Angle.zero(),new Mo(t,e,null,St.accentColor,null)}}const Lo=function(t){const i=function(t,n){const o=function(t){const e=o.sides,i=o.rotationInterpolator(t),n=o.fillColorInterpolator(t),s=o.fillLook,r=o.moodModifier;return new Mo(e,i,n,s,r)};return Object.setPrototypeOf(o,i.prototype),o.sides=n.sides,o.rotationInterpolator=t.rotation.interpolateTo(n.rotation),o.fillColorInterpolator=e.Interpolator(t.fillColor,n.fillColor),o.fillLook=n.fillLook,o.moodModifier=n.moodModifier,o};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.sides,e=this.rotationInterpolator[0],i=this.fillColorInterpolator[0],n=this.fillLook,o=this.moodModifier;return new Mo(t,e,i,n,o)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.sides,e=this.rotationInterpolator[1],i=this.fillColorInterpolator[1],n=this.fillLook,o=this.moodModifier;return new Mo(t,e,i,n,o)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.sides===t.sides&&this.rotationInterpolator.equals(t.rotationInterpolator)&&this.fillColorInterpolator.equals(t.fillColorInterpolator)&&this.fillLook===t.fillLook&&e.Equals(this.moodModifier,t.moodModifier))},i}(e.Interpolator);class ko extends xo{constructor(t,e,i,n,o,s){super(),this.outer=t,this.inner=e,this.innerScale=i,this.moodModifier=n,this.outerMoodModifier=o,this.innerMoodModifier=s}withOuter(t){return this.outer===t?this:this.copy(t,this.inner,this.innerScale,this.moodModifier,this.outerMoodModifier,this.innerMoodModifier)}withInner(t){return this.inner===t?this:this.copy(this.outer,t,this.innerScale,this.moodModifier,this.outerMoodModifier,this.innerMoodModifier)}withInnerScale(t){return this.innerScale===t?this:this.copy(this.outer,this.inner,t,this.moodModifier,this.outerMoodModifier,this.innerMoodModifier)}withMoodModifier(t){return e.Equals(this.moodModifier,t)?this:this.copy(this.outer,this.inner,this.innerScale,t,this.outerMoodModifier,this.innerMoodModifier)}modifyMood(t,e){let i=this.moodModifier;null===i&&(i=Et.empty());const n=i.updatedCol(t,e,!0);return n.equals(i)?this:this.withMoodModifier(n)}withOuterMoodModifier(t){return e.Equals(this.outerMoodModifier,t)?this:this.copy(this.outer,this.inner,this.innerScale,this.moodModifier,t,this.innerMoodModifier)}modifyOuterMood(t,e){let i=this.outerMoodModifier;null===i&&(i=Et.empty());const n=i.updatedCol(t,e,!0);return n.equals(i)?this:this.withOuterMoodModifier(n)}withInnerMoodModifier(t){return e.Equals(this.innerMoodModifier,t)?this:this.copy(this.outer,this.inner,this.innerScale,this.moodModifier,this.outerMoodModifier,t)}modifyInnerMood(t,e){let i=this.innerMoodModifier;null===i&&(i=Et.empty());const n=i.updatedCol(t,e,!0);return n.equals(i)?this:this.withInnerMoodModifier(n)}isThemed(){const t=this.outer,e=this.inner;return(null===t||t.isThemed())&&(null===e||e.isThemed())}withTheme(t,e){const i=this.moodModifier,n=this.outerMoodModifier,o=this.innerMoodModifier;let s=e;null!==i&&(s=i.timesCol(s,!0));const r=this.outer;let l;if(null!==r){let e=s;null!==n&&(e=n.timesCol(e,!0)),l=r.withTheme(t,e)}else l=null;const a=this.inner;let h;if(null!==a){let e=s;null!==o&&(e=o.timesCol(e,!0)),h=a.withTheme(t,e)}else h=null;return r!==l||a!==h?this.copy(l,h,this.innerScale,i,n,o):this}render(t,e){t instanceof ro?this.paint(t.context,e):t instanceof no&&this.draw(t.context,e)}paint(t,e){const i=this.outer;null!==i&&i.paint(t,this.outerFrame(e));const n=this.inner;null!==n&&n.paint(t,this.innerFrame(e))}draw(t,e){const i=this.outer;null!==i&&i.draw(t,this.outerFrame(e));const n=this.inner;null!==n&&n.draw(t,this.innerFrame(e))}outerFrame(t){return t}innerFrame(t){let{xMin:e,xMax:i,yMin:n,yMax:s}=t,r=i-e,l=s-n;const a=this.innerScale;if(1!==a){const t=(e+i)/2,o=(n+s)/2;r*=a,l*=a,e=t-r/2,n=o-l/2,i=t+r/2,s=o+l/2}if(r>l){const t=(r-l)/2;e+=t,i-=t}else if(r<l){const t=(l-r)/2;n+=t,s-=t}return r!==l||1!==a?new o.R2Box(e,n,i,s):t}copy(t,e,i,n,o,s){return new ko(t,e,i,n,o,s)}interpolateTo(t){return t instanceof ko?Fo(this,t):null}equivalentTo(t,i){return this===t||t instanceof ko&&(e.Equivalent(this.outer,t.outer,i)&&e.Equivalent(this.inner,t.inner,i)&&e.Equivalent(this.innerScale,t.innerScale,i)&&e.Equivalent(this.moodModifier,t.moodModifier,i)&&e.Equivalent(this.outerMoodModifier,t.outerMoodModifier,i)&&e.Equivalent(this.innerMoodModifier,t.innerMoodModifier,i))}equals(t){return this===t||t instanceof ko&&(e.Equals(this.outer,t.outer)&&e.Equals(this.inner,t.inner)&&e.Equals(this.innerScale,t.innerScale)&&e.Equals(this.moodModifier,t.moodModifier)&&e.Equals(this.outerMoodModifier,t.outerMoodModifier)&&e.Equals(this.innerMoodModifier,t.innerMoodModifier))}debug(t){return t=t.write("new").write(32).write("EnclosedIcon").write(40).debug(this.outer).write(", ").debug(this.inner).write(", ").debug(this.innerScale).write(", ").debug(this.moodModifier).write(", ").debug(this.outerMoodModifier).write(", ").debug(this.innerMoodModifier).write(41)}toString(){return s.Format.debug(this)}static create(t,e){return new ko(t,e,1,null,null,null)}static embossed(t,e){return new ko(t,e,1,null,null,ko.embossedMoodModifier)}static get embossedMoodModifier(){return Et.empty().updatedCol(Mt.default,[[Mt.embossed,1]],!0)}}u([e.Lazy],ko,"embossedMoodModifier",null);const Fo=function(t){const i=function(t,n){const o=function(t){const e=o.outerInterpolator(t),i=o.innerInterpolator(t),n=o.innerScaleInterpolator(t),s=o.moodModifier,r=o.outerMoodModifier,l=o.innerMoodModifier;return new ko(e,i,n,s,r,l)};return Object.setPrototypeOf(o,i.prototype),o.outerInterpolator=e.Interpolator(t.outer,n.outer),o.innerInterpolator=e.Interpolator(t.inner,n.inner),o.innerScaleInterpolator=e.Interpolator(t.innerScale,n.innerScale),o.moodModifier=n.moodModifier,o.outerMoodModifier=n.outerMoodModifier,o.innerMoodModifier=n.innerMoodModifier,o};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.outerInterpolator[0],e=this.innerInterpolator[0],i=this.innerScaleInterpolator[0],n=this.moodModifier,o=this.outerMoodModifier,s=this.innerMoodModifier;return new ko(t,e,i,n,o,s)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.outerInterpolator[1],e=this.innerInterpolator[1],i=this.innerScaleInterpolator[1],n=this.moodModifier,o=this.outerMoodModifier,s=this.innerMoodModifier;return new ko(t,e,i,n,o,s)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.outerInterpolator.equals(t.outerInterpolator)&&this.innerInterpolator.equals(t.innerInterpolator)&&this.innerScaleInterpolator.equals(t.innerScaleInterpolator)&&e.Equals(this.moodModifier,t.moodModifier)&&e.Equals(this.outerMoodModifier,t.outerMoodModifier)&&e.Equals(this.innerMoodModifier,t.innerMoodModifier))},i}(e.Interpolator),Ro=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof Wo||e instanceof Eo||e instanceof No||e instanceof pn&&"xAlign"in e&&"yAlign"in e&&"iconWidth"in e&&"iconHeight"in e&&"iconColor"in e&&"graphics"in e}return!1},init:function(t,e){void 0!==e.xAlign&&t.xAlign(e.xAlign),void 0!==e.yAlign&&t.yAlign(e.yAlign),void 0!==e.iconWidth&&t.iconWidth(e.iconWidth),void 0!==e.iconHeight&&t.iconHeight(e.iconHeight),void 0!==e.iconColor&&t.iconColor(e.iconColor),void 0!==e.graphics&&t.graphics(e.graphics)}};return t}(),Oo=function(t){const e=t.extend("IconGraphicsAnimator");return e.prototype.transformState=function(t){const e=this.owner;if(Ro.is(e)&&t instanceof xo){const i=e.iconColor.state;if(null!==i&&t instanceof To)t=t.withFillColor(i);else{const i=e.theme.value,n=e.mood.value;null!==i&&null!==n&&(t=t.withTheme(i,n))}}return t},e}(zt);class Wo extends io{onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),!this.graphics.inherited){const o=this.graphics.value;if(o instanceof xo){const s=o.withTheme(t,e);this.graphics.setState(s,!!o.isThemed()&&n,i.Affinity.Reflexive)}}}onRender(t){super.onRender(t);const e=t.renderer;e instanceof ro&&!this.hidden&&!this.culled&&this.renderIcon(e,this.viewBounds)}renderIcon(t,e){const i=this.graphics.value;if(null!==i){t.context.beginPath(),i.render(t,e)}}hitTest(t,e,i){const n=i.renderer;return n instanceof ho?this.hitTestIcon(t,e,n,this.viewBounds):null}hitTestIcon(t,e,i,n){return this.hitBounds.contains(t,e)?this:null}init(t){super.init(t),Ro.init(this,t)}}u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsRender})],Wo.prototype,"xAlign",void 0),u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsRender})],Wo.prototype,"yAlign",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsRender})],Wo.prototype,"iconWidth",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsRender})],Wo.prototype,"iconHeight",void 0),u([zt({type:B,value:null,updateFlags:pn.NeedsRender,didSetValue(t,e){if(null!==t){const e=this.owner.graphics.value;if(e instanceof To){const n=e.withFillColor(t);this.owner.graphics.setState(n,i.Affinity.Reflexive)}}}})],Wo.prototype,"iconColor",void 0),u([zt({extends:Oo,type:Object,value:null,updateFlags:pn.NeedsRender})],Wo.prototype,"graphics",void 0),Object.defineProperty(Wo.prototype,"viewBounds",{get(){const t=this.viewFrame,e=t.width,i=t.height,n=Math.min(e,i);let s=this.iconWidth.value;s=s instanceof o.Length?s.pxValue(n):n;let r=this.iconHeight.value;r=r instanceof o.Length?r.pxValue(n):n;const l=t.x+(e-s)*this.xAlign.getValue(),a=t.y+(i-r)*this.yAlign.getValue();return new o.R2Box(l,a,l+s,a+r)},configurable:!0});class Eo extends _n{constructor(t){super(t)}onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),!this.graphics.inherited){const o=this.graphics.value;if(o instanceof xo){const s=o.withTheme(t,e);this.graphics.setState(s,!!o.isThemed()&&n,i.Affinity.Reflexive)}}}onResize(t){super.onResize(t),this.requireUpdate(pn.NeedsLayout)}needsDisplay(t,e){return 0==(this.flags&pn.NeedsLayout)&&(t&=~pn.NeedsLayout),t}onLayout(t){super.onLayout(t),this.renderIcon()}renderIcon(){const t=new lo(this);t.setPrecision(3),t.beginSvg();const e=this.graphics.value;if(null!==e){const i=this.iconBounds;if(i.isDefined()&&i.width>0&&i.height>0){t.beginPath();const n=new ao(t);e.render(n,i)}}t.finalizeSvg()}get iconBounds(){let t=this.node.viewportElement;if(null===t&&(t=this.node),t instanceof SVGSVGElement){const e=t.viewBox.animVal,i=e.width,n=e.height,s=Math.min(i,n);let r=this.iconWidth.value;r=r instanceof o.Length?r.pxValue(s):s;let l=this.iconHeight.value;l=l instanceof o.Length?l.pxValue(s):s;const a=e.x+(i-r)*this.xAlign.getValue(),h=e.y+(n-l)*this.yAlign.getValue();return new o.R2Box(a,h,a+r,h+l)}return o.R2Box.undefined()}init(t){super.init(t),Ro.init(this,t)}}Eo.MountFlags=_n.MountFlags|pn.NeedsAnimate,u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsLayout})],Eo.prototype,"xAlign",void 0),u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsLayout})],Eo.prototype,"yAlign",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsLayout})],Eo.prototype,"iconWidth",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsLayout})],Eo.prototype,"iconHeight",void 0),u([zt({type:B,value:null,updateFlags:pn.NeedsLayout,didSetValue(t,e){if(null!==t){const e=this.owner.graphics.value;if(e instanceof To){const n=e.withFillColor(t);this.owner.graphics.setState(n,i.Affinity.Reflexive)}}}})],Eo.prototype,"iconColor",void 0),u([zt({extends:Oo,type:Object,value:null,updateFlags:pn.NeedsLayout})],Eo.prototype,"graphics",void 0);class No extends Xn{constructor(t){super(t),this.initIcon()}initIcon(){this.position.setState("relative",i.Affinity.Intrinsic);const t=this.createSvgView();null!==t&&this.setChild("svg",t)}createSvgView(){return Eo.create()}get svgView(){const t=this.getChild("svg");return t instanceof Eo?t:null}onInsertChild(t,e){super.onInsertChild(t,e),"svg"===t.key&&t instanceof Eo&&this.onInsertSvg(t)}onInsertSvg(t){t.xAlign.setInherits(!0),t.yAlign.setInherits(!0),t.iconWidth.setInherits(!0),t.iconHeight.setInherits(!0),t.iconColor.setInherits(!0),t.graphics.setInherits(!0),t.setStyle("position","absolute")}onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),!this.graphics.inherited){const o=this.graphics.value;if(o instanceof xo){const s=o.withTheme(t,e);this.graphics.setState(s,!!o.isThemed()&&n,i.Affinity.Reflexive)}}}onResize(t){super.onResize(t),this.requireUpdate(pn.NeedsLayout)}needsDisplay(t,e){return 0==(this.flags&pn.NeedsLayout)&&(t&=~pn.NeedsLayout),t}onLayout(t){super.onLayout(t),this.layoutIcon()}layoutIcon(){const t=this.svgView;if(null!==t&&(t.width.hasAffinity(i.Affinity.Intrinsic)||t.height.hasAffinity(i.Affinity.Intrinsic)||t.viewBox.hasAffinity(i.Affinity.Intrinsic))){let e=this.width.value;e=e instanceof o.Length?e.pxValue():this.node.offsetWidth;let n=this.height.value;n=n instanceof o.Length?n.pxValue():this.node.offsetHeight,t.width.setState(e,i.Affinity.Intrinsic),t.height.setState(n,i.Affinity.Intrinsic),t.viewBox.setState("0 0 "+e+" "+n,i.Affinity.Intrinsic)}}init(t){super.init(t),Ro.init(this,t)}}u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsLayout})],No.prototype,"xAlign",void 0),u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsLayout})],No.prototype,"yAlign",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsLayout})],No.prototype,"iconWidth",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsLayout})],No.prototype,"iconHeight",void 0),u([zt({type:B,value:null,updateFlags:pn.NeedsLayout,didSetValue(t,e){if(null!==t){const e=this.owner.graphics.value;if(e instanceof To){const n=e.withFillColor(t);this.owner.graphics.setState(n,i.Affinity.Reflexive)}}}})],No.prototype,"iconColor",void 0),u([zt({extends:Oo,type:Object,value:null,updateFlags:pn.NeedsLayout})],No.prototype,"graphics",void 0);const Bo=function(){const t={current:null,create:function(){return{updateTime:performance.now()}}};return t}();class Uo extends i.Service{constructor(){super(),this.flags=0,this.controllerContext=Bo.create(),this.updateDelay=Uo.MinUpdateDelay,this.compileTimer=0,this.executeTimer=0,this.runCompilePass=this.runCompilePass.bind(this),this.runExecutePass=this.runExecutePass.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this)}setFlags(t){this.flags=t}updatedControllerContext(){const t=this.controllerContext;return t.updateTime=performance.now(),t}needsUpdate(t,e){return t}requestUpdate(t,e,i){e=this.needsUpdate(e,i);let n=this.flags&~e&Zo.UpdateMask;0!=(e&Zo.CompileMask)&&(n|=Zo.NeedsCompile),0!=(e&Zo.ExecuteMask)&&(n|=Zo.NeedsExecute),this.setFlags(this.flags|n),i&&0==(this.flags&(Zo.CompilingFlag|Zo.ExecutingFlag))&&this.updateDelay<=Uo.MaxCompileInterval?this.runImmediatePass():this.scheduleUpdate()}scheduleUpdate(){const t=this.flags;0==(t&Zo.CompilingFlag)&&0!=(t&Zo.CompileMask)?this.scheduleCompilePass(this.updateDelay):0==(t&Zo.ExecutingFlag)&&0!=(t&Zo.ExecuteMask)&&this.scheduleExecutePass(Uo.MinExecuteInterval)}cancelUpdate(){this.cancelCompilePass(),this.cancelExecutePass()}runImmediatePass(){0!=(this.flags&Zo.CompileMask)&&(this.cancelUpdate(),this.runCompilePass(!0)),0!=(this.flags&Zo.ExecuteMask)&&this.updateDelay<=Uo.MaxCompileInterval&&(this.cancelUpdate(),this.runExecutePass(!0))}scheduleCompilePass(t){0===this.compileTimer&&(this.compileTimer=setTimeout(this.runCompilePass,t))}cancelCompilePass(){0!==this.compileTimer&&(clearTimeout(this.compileTimer),this.compileTimer=0)}runCompilePass(t=!1){this.setFlags(this.flags&~Zo.CompileMask|Zo.CompilingFlag);try{const e=performance.now(),i=this.roots,n=this.controllerContext;n.updateTime=e;for(let t=0;t<i.length;t+=1){const e=i[t];0!=(e.flags&Zo.CompileMask)&&e.cascadeCompile(0,n)}const o=performance.now();let s=Math.max(Uo.MinCompileInterval,this.updateDelay);this.updateDelay=o-e>s?Math.min(Math.max(2,2*this.updateDelay),Uo.MaxUpdateDelay):Math.min(Uo.MinUpdateDelay,this.updateDelay/2),this.cancelCompilePass(),0!=(this.flags&Zo.ExecuteMask)?this.scheduleExecutePass(Uo.MinExecuteInterval):0!=(this.flags&Zo.CompileMask)&&(t&&(s=Math.max(Uo.MaxCompileInterval,s)),this.cancelExecutePass(),this.scheduleCompilePass(s))}finally{this.setFlags(this.flags&~Zo.CompilingFlag)}}scheduleExecutePass(t){0===this.executeTimer&&(this.executeTimer=setTimeout(this.runExecutePass,t))}cancelExecutePass(){0!==this.executeTimer&&(clearTimeout(this.executeTimer),this.executeTimer=0)}runExecutePass(t=!1){this.setFlags(this.flags&~Zo.ExecuteMask|Zo.ExecutingFlag);try{const e=performance.now(),i=this.controllerContext;i.updateTime=e;const n=this.roots;for(let t=0;t<n.length;t+=1){const e=n[t];0!=(e.flags&Zo.ExecuteMask)&&e.cascadeExecute(0,i)}if(this.cancelExecutePass(),0!=(this.flags&Zo.CompileMask)){let e=this.updateDelay;t&&(e=Math.max(Uo.MaxCompileInterval,e)),this.scheduleCompilePass(e)}else 0!=(this.flags&Zo.ExecuteMask)&&(this.cancelCompilePass(),this.scheduleExecutePass(Uo.MaxExecuteInterval))}finally{this.setFlags(this.flags&~Zo.ExecutingFlag)}}get powerFlags(){return 0}power(){const t=this.roots;for(let e=0,i=t.length;e<i;e+=1){t[e].requireUpdate(this.powerFlags)}}unpower(){this.cancelUpdate(),this.updateDelay=Uo.MinUpdateDelay}onAttachRoot(t){super.onAttachRoot(t),this.requestUpdate(t,t.flags&Zo.UpdateMask,!1)}onAttach(){super.onAttach(),this.attachEvents()}onDetach(){this.detachEvents(),super.onDetach()}attachEvents(){"undefined"!=typeof document&&document.addEventListener("visibilitychange",this.onVisibilityChange)}detachEvents(){"undefined"!=typeof document&&document.removeEventListener("visibilitychange",this.onVisibilityChange)}onVisibilityChange(){"visible"===document.visibilityState?this.power():this.unpower()}static global(){return new Uo}}Uo.MinUpdateDelay=0,Uo.MaxUpdateDelay=167,Uo.MinCompileInterval=12,Uo.MaxCompileInterval=33,Uo.MinExecuteInterval=4,Uo.MaxExecuteInterval=16,u([e.Lazy],Uo,"global",null);const zo=function(t){const e=t.extend("ExecuteProvider");return Object.defineProperty(e.prototype,"controllerContext",{get(){let t=this.service;return null==t&&(t=Uo.global()),t.controllerContext},configurable:!0}),e.prototype.updatedControllerContext=function(){let t=this.service;return null==t&&(t=Uo.global()),t.updatedControllerContext()},e.prototype.requestUpdate=function(t,e,i){let n=this.service;null==n&&(n=Uo.global()),n.requestUpdate(t,e,i)},e.prototype.createService=function(){return Uo.global()},e}(i.Provider),qo=function(){const t={empty:function(){return{fragment:void 0,permanent:{},ephemeral:{}}},current:function(){try{return t.fromUri(window.location.href)}catch(t){return console.error(t),{fragment:void 0,permanent:{},ephemeral:{}}}},updated:function(e,i){void 0===i&&(i=t.current()),"fragment"in e&&(i.fragment=e.fragment);for(const t in e.permanent){const n=e.permanent[t];void 0!==n?i.permanent[t]=n:delete i.permanent[t]}for(const t in e.ephemeral){const n=e.ephemeral[t];void 0!==n?i.ephemeral[t]=n:delete i.ephemeral[t]}return i},cloned:function(t){const e={fragment:t.fragment,permanent:{},ephemeral:{}};for(const i in t.permanent)e.permanent[i]=t.permanent[i];for(const i in t.ephemeral)e.ephemeral[i]=t.ephemeral[i];return e},fromUri:function(e){const i=(e=h.Uri.fromAny(e)).fragment;return i.isDefined()?t.fromUriFragment(i):t.empty()},fromUriFragment:function(t){let e=void 0!==(t=h.UriFragment.fromAny(t)).identifier?h.UriQuery.parse(t.identifier):h.UriQuery.undefined();const i={fragment:void 0,permanent:{},ephemeral:{}};for(;!e.isEmpty();){const t=e.key,n=e.value;void 0!==t?i.permanent[t]=n:i.fragment=n,e=e.tail()}return i},toUri:function(t){const e=h.UriQuery.builder();void 0!==t.fragment&&e.add(void 0,t.fragment);for(const i in t.permanent){const n=t.permanent[i];e.add(i,n)}return h.Uri.fragment(h.UriFragment.create(e.bind().toString()))}};return t}();class Go extends i.Service{constructor(){super(),this.historyState=qo.current(),this.popHistory=this.popHistory.bind(this)}get historyUri(){return qo.toUri(this.historyState)}pushHistory(t){const e=this.historyState,i=qo.updated(t,qo.cloned(e)),n=qo.toUri(i);this.willPushHistory(i,e),this.historyState=i,window.history.pushState(i.ephemeral,"",n.toString()),this.onPushHistory(i,e),this.didPushHistory(i,e)}willPushHistory(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.serviceWillPushHistory&&o.serviceWillPushHistory(t,e,this)}}onPushHistory(t,e){const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(Zo.NeedsRevise)}didPushHistory(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.serviceDidPushHistory&&o.serviceDidPushHistory(t,e,this)}}replaceHistory(t){const i=this.historyState,n=qo.updated(t,qo.cloned(i));if(!e.Objects.equal(i,n)){const t=qo.toUri(n);this.willReplaceHistory(n,i),this.historyState=n,window.history.replaceState(n.ephemeral,"",t.toString()),this.onReplaceHistory(n,i),this.didReplaceHistory(n,i)}}willReplaceHistory(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.serviceWillReplaceHistory&&o.serviceWillReplaceHistory(t,e,this)}}onReplaceHistory(t,e){const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(Zo.NeedsRevise)}didReplaceHistory(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.serviceDidReplaceHistory&&o.serviceDidReplaceHistory(t,e,this)}}popHistory(t){const e={};"object"==typeof t.state&&null!==t.state&&(e.ephemeral=t.state);const i=qo.current(),n=qo.updated(e,i);this.willPopHistory(n,i),this.historyState=n,this.onPopHistory(n,i),this.didPopHistory(n,i)}willPopHistory(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.serviceWillPopHistory&&o.serviceWillPopHistory(t,e,this)}}onPopHistory(t,e){const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(Zo.NeedsRevise)}didPopHistory(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.serviceDidPopHistory&&o.serviceDidPopHistory(t,e,this)}}onAttach(){super.onAttach(),this.attachEvents()}onDetach(){this.detachEvents(),super.onDetach()}attachEvents(){"undefined"!=typeof window&&window.addEventListener("popstate",this.popHistory)}detachEvents(){"undefined"!=typeof window&&window.removeEventListener("popstate",this.popHistory)}static global(){return new Go}}u([e.Lazy],Go,"global",null);const Ho=function(t){const e=t.extend("HistoryProvider");return Object.defineProperty(e.prototype,"historyState",{get(){let t=this.service;return null==t&&(t=Go.global()),t.historyState},configurable:!0}),e.prototype.pushHistory=function(t){let e=this.service;null==e&&(e=Go.global()),e.pushHistory(t)},e.prototype.replaceHistory=function(t){let e=this.service;null==e&&(e=Go.global()),e.replaceHistory(t)},e.prototype.createService=function(){return Go.global()},e}(i.Provider);class jo extends i.Service{willSet(t,e,i){const n=this.observers;for(let o=0,s=n.length;o<s;o+=1){const s=n[o];void 0!==s.serviceWillStore&&s.serviceWillStore(t,e,i,this)}}onSet(t,e,i){const n=this.roots;for(let t=0,e=n.length;t<e;t+=1)n[t].requireUpdate(Zo.NeedsRevise)}didSet(t,e,i){const n=this.observers;for(let o=0,s=n.length;o<s;o+=1){const s=n[o];void 0!==s.serviceDidStore&&s.serviceDidStore(t,e,i,this)}}willClear(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.serviceWillClear&&i.serviceWillClear(this)}}onClear(){const t=this.roots;for(let e=0,i=t.length;e<i;e+=1)t[e].requireUpdate(Zo.NeedsRevise)}didClear(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.serviceDidClear&&i.serviceDidClear(this)}}static global(){let t=Yo.local();return null===t&&(t=new Xo),t}}u([e.Lazy],jo,"global",null);class Yo extends jo{constructor(t){super(),this.storage=t,this.onStorage=this.onStorage.bind(this)}get(t){const e=this.storage.getItem(t);return null!==e?e:void 0}set(t,e){let i=this.storage.getItem(t);return null===i&&(i=void 0),e!==i&&(this.willSet(t,e,i),void 0!==e?this.storage.setItem(t,e):this.storage.removeItem(t),this.onSet(t,e,i),this.didSet(t,e,i)),i}clear(){this.willClear(),this.storage.clear(),this.onClear(),this.didClear()}onStorage(t){if(t.storageArea===this.storage){const e=t.key;if(null!==e){let i=t.newValue;null===i&&(i=void 0);let n=t.oldValue;null===n&&(n=void 0),i!==n&&(this.willSet(e,i,n),this.onSet(e,i,n),this.didSet(e,i,n))}else this.willClear(),this.onClear(),this.didClear()}}onAttach(){super.onAttach(),this.attachEvents()}onDetach(){this.detachEvents(),super.onDetach()}attachEvents(){"undefined"!=typeof window&&window.addEventListener("storage",this.onStorage)}detachEvents(){"undefined"!=typeof window&&window.removeEventListener("storage",this.onStorage)}static local(){try{return new Yo(window.localStorage)}catch(t){return null}}static session(){try{return new Yo(window.sessionStorage)}catch(t){return null}}}u([e.Lazy],Yo,"local",null),u([e.Lazy],Yo,"session",null);class Xo extends jo{constructor(t){super(),void 0===t&&(t={}),this.storage=t}get(t){return this.storage[t]}set(t,e){const i=this.storage,n=i[t];return e!==n&&(this.willSet(t,e,n),void 0!==e?i[t]=e:delete i[t],this.onSet(t,e,n),this.didSet(t,e,n)),n}clear(){this.willClear(),this.storage={},this.onClear(),this.didClear()}}const Ko=function(t){const e=t.extend("StorageProvider");return e.prototype.get=function(t){let e=this.service;return null==e&&(e=jo.global()),e.get(t)},e.prototype.set=function(t,e){let i=this.service;return null==i&&(i=jo.global()),i.set(t,e)},e.prototype.clear=function(){let t=this.service;null==t&&(t=jo.global()),t.clear()},e.prototype.createService=function(){return jo.global()},e}(i.Provider);class Zo extends i.Component{get componentType(){return Zo}willAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillAttachParent&&n.controllerWillAttachParent(t,this)}}onAttachParent(t){}didAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidAttachParent&&n.controllerDidAttachParent(t,this)}}willDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillDetachParent&&n.controllerWillDetachParent(t,this)}}onDetachParent(t){}didDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidDetachParent&&n.controllerDidDetachParent(t,this)}}setChild(t,e){return null!==e&&(e=Zo.fromAny(e)),super.setChild(t,e)}appendChild(t,e){return t=Zo.fromAny(t),super.appendChild(t,e)}prependChild(t,e){return t=Zo.fromAny(t),super.prependChild(t,e)}insertChild(t,e,i){return t=Zo.fromAny(t),super.insertChild(t,e,i)}replaceChild(t,e){return t=Zo.fromAny(t),super.replaceChild(t,e)}willInsertChild(t,e){super.willInsertChild(t,e);const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.controllerWillInsertChild&&o.controllerWillInsertChild(t,e,this)}}onInsertChild(t,e){super.onInsertChild(t,e)}didInsertChild(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.controllerDidInsertChild&&o.controllerDidInsertChild(t,e,this)}super.didInsertChild(t,e)}cascadeInsert(t,e){0!=(this.flags&Zo.MountedFlag)&&(void 0===t&&(t=0),0!=((t|=this.flags&Zo.UpdateMask)&Zo.CompileMask)&&(void 0===e&&(e=this.superControllerContext),this.cascadeCompile(t,e)))}willRemoveChild(t){super.willRemoveChild(t);const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillRemoveChild&&n.controllerWillRemoveChild(t,this)}}onRemoveChild(t){super.onRemoveChild(t)}didRemoveChild(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidRemoveChild&&n.controllerDidRemoveChild(t,this)}super.didRemoveChild(t)}willMount(){super.willMount();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.controllerWillMount&&i.controllerWillMount(this)}}onMount(){this.requestUpdate(this,this.flags&Zo.UpdateMask,!1),this.requireUpdate(this.mountFlags),null!==this.decoherent&&0!==this.decoherent.length&&this.requireUpdate(Zo.NeedsRevise),this.mountFasteners()}didMount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.controllerDidMount&&i.controllerDidMount(this)}super.didMount()}willUnmount(){super.willUnmount();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.controllerWillUnmount&&i.controllerWillUnmount(this)}}didUnmount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.controllerDidUnmount&&i.controllerDidUnmount(this)}super.didUnmount()}requireUpdate(t,e=!1){const i=this.flags,n=t&~i&Zo.UpdateMask;0!==n&&(this.setFlags(i|n),this.requestUpdate(this,n,e))}needsUpdate(t,e){return t}requestUpdate(t,e,i){e=this.needsUpdate(e,i);let n=this.flags&~e&Zo.UpdateMask;if(0!=(e&Zo.CompileMask)&&(n|=Zo.NeedsCompile),0!=(e&Zo.ExecuteMask)&&(n|=Zo.NeedsExecute),0!==n||i){this.setFlags(this.flags|n);const o=this.parent;if(null!==o)o.requestUpdate(t,e,i);else if(this.mounted){const n=this.executeProvider.service;null!=n&&n.requestUpdate(t,e,i)}}}get updating(){return 0!=(this.flags&Zo.UpdatingMask)}get compiling(){return 0!=(this.flags&Zo.CompilingFlag)}needsCompile(t,e){return t}cascadeCompile(t,e){const i=this.extendControllerContext(e),n=Bo.current;try{if(Bo.current=i,t&=~Zo.NeedsCompile,t|=this.flags&Zo.UpdateMask,0!=((t=this.needsCompile(t,i))&Zo.CompileMask)){let e=t;this.setFlags(this.flags&~Zo.NeedsCompile|Zo.CompilingFlag|Zo.ContextualFlag),this.willCompile(e,i),0!=((this.flags|t)&Zo.NeedsResolve)&&(e|=Zo.NeedsResolve,this.setFlags(this.flags&~Zo.NeedsResolve),this.willResolve(i)),0!=((this.flags|t)&Zo.NeedsGenerate)&&(e|=Zo.NeedsGenerate,this.setFlags(this.flags&~Zo.NeedsGenerate),this.willGenerate(i)),0!=((this.flags|t)&Zo.NeedsAssemble)&&(e|=Zo.NeedsAssemble,this.setFlags(this.flags&~Zo.NeedsAssemble),this.willAssemble(i)),this.onCompile(e,i),0!=(e&Zo.NeedsResolve)&&this.onResolve(i),0!=(e&Zo.NeedsGenerate)&&this.onGenerate(i),0!=(e&Zo.NeedsAssemble)&&this.onAssemble(i),0!=(e&Zo.CompileMask)&&(this.setFlags(this.flags&~Zo.ContextualFlag),this.compileChildren(e,i,this.compileChild),this.setFlags(this.flags|Zo.ContextualFlag)),0!=(e&Zo.NeedsAssemble)&&this.didAssemble(i),0!=(e&Zo.NeedsGenerate)&&this.didGenerate(i),0!=(e&Zo.NeedsResolve)&&this.didResolve(i),this.didCompile(e,i)}}finally{this.setFlags(this.flags&~(Zo.CompilingFlag|Zo.ContextualFlag)),Bo.current=n}}willCompile(t,e){}onCompile(t,e){}didCompile(t,e){}willResolve(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillResolve&&n.controllerWillResolve(t,this)}}onResolve(t){}didResolve(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidResolve&&n.controllerDidResolve(t,this)}}willGenerate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillGenerate&&n.controllerWillGenerate(t,this)}}onGenerate(t){}didGenerate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidGenerate&&n.controllerDidGenerate(t,this)}}willAssemble(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillAssemble&&n.controllerWillAssemble(t,this)}}onAssemble(t){}didAssemble(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidAssemble&&n.controllerDidAssemble(t,this)}}compileChildren(t,e,i){let n=this.firstChild;for(;null!==n;){const o=n.nextSibling;if(i.call(this,n,t,e),null!==o&&o.parent!==this)throw new Error("inconsistent compile pass");n=o}}compileChild(t,e,i){t.cascadeCompile(e,i)}get executing(){return 0!=(this.flags&Zo.ExecutingFlag)}needsExecute(t,e){return t}cascadeExecute(t,e){const i=this.extendControllerContext(e),n=Bo.current;try{if(Bo.current=i,t&=~Zo.NeedsExecute,t|=this.flags&Zo.UpdateMask,0!=((t=this.needsExecute(t,i))&Zo.ExecuteMask)){let e=t;this.setFlags(this.flags&~Zo.NeedsExecute|Zo.ExecutingFlag|Zo.ContextualFlag),this.willExecute(e,i),0!=((this.flags|t)&Zo.NeedsRevise)&&(e|=Zo.NeedsRevise,this.setFlags(this.flags&~Zo.NeedsRevise),this.willRevise(i)),0!=((this.flags|t)&Zo.NeedsCompute)&&(e|=Zo.NeedsCompute,this.setFlags(this.flags&~Zo.NeedsCompute),this.willCompute(i)),this.onExecute(e,i),0!=(e&Zo.NeedsRevise)&&this.onRevise(i),0!=(e&Zo.NeedsCompute)&&this.onCompute(i),0!=(e&Zo.ExecuteMask)&&(this.setFlags(this.flags&~Zo.ContextualFlag),this.executeChildren(e,i,this.executeChild),this.setFlags(this.flags|Zo.ContextualFlag)),0!=(e&Zo.NeedsCompute)&&this.didCompute(i),0!=(e&Zo.NeedsRevise)&&this.didRevise(i),this.didExecute(e,i)}}finally{this.setFlags(this.flags&~(Zo.ExecutingFlag|Zo.ContextualFlag)),Bo.current=n}}willExecute(t,e){}onExecute(t,e){}didExecute(t,e){}willRevise(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillRevise&&n.controllerWillRevise(t,this)}}onRevise(t){this.recohereFasteners(t.updateTime)}didRevise(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidRevise&&n.controllerDidRevise(t,this)}}willCompute(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillCompute&&n.controllerWillCompute(t,this)}}onCompute(t){}didCompute(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidCompute&&n.controllerDidCompute(t,this)}}executeChildren(t,e,i){let n=this.firstChild;for(;null!==n;){const o=n.nextSibling;if(i.call(this,n,t,e),null!==o&&o.parent!==this)throw new Error("inconsistent execute pass");n=o}}executeChild(t,e,i){t.cascadeExecute(e,i)}bindChildFastener(t,e,i){super.bindChildFastener(t,e,i),t instanceof _o&&t.bindController(e,i)}unbindChildFastener(t,e){t instanceof _o&&t.unbindController(e),super.unbindChildFastener(t,e)}decohereFastener(t){super.decohereFastener(t),this.requireUpdate(Zo.NeedsRevise)}get superControllerContext(){const t=this.parent;return null!==t?t.controllerContext:this.executeProvider.updatedControllerContext()}extendControllerContext(t){return t}get controllerContext(){return 0!=(this.flags&Zo.ContextualFlag)?Bo.current:this.extendControllerContext(this.superControllerContext)}init(t){}static create(){return new this}static fromInit(t){let i;i=("object"==typeof t&&null!==t||"function"==typeof t)&&e.Creatable.is(t.type)?t.type:this;const n=i.create();return n.init(t),n}static fromAny(t){if(null==t)return t;if(t instanceof Zo){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return e.Creatable.is(t)?t.create():this.fromInit(t)}}Zo.uid=function(){let t=1;return function(){const e=~~t;return t+=1,e}}(),Zo.MountedFlag=i.Component.MountedFlag,Zo.RemovingFlag=i.Component.RemovingFlag,Zo.CompilingFlag=1<<i.Component.FlagShift+0,Zo.ExecutingFlag=1<<i.Component.FlagShift+1,Zo.ContextualFlag=1<<i.Component.FlagShift+2,Zo.UpdatingMask=Zo.CompilingFlag|Zo.ExecutingFlag,Zo.StatusMask=Zo.MountedFlag|Zo.RemovingFlag|Zo.CompilingFlag|Zo.ExecutingFlag|Zo.ContextualFlag,Zo.NeedsCompile=1<<i.Component.FlagShift+3,Zo.NeedsResolve=1<<i.Component.FlagShift+4,Zo.NeedsGenerate=1<<i.Component.FlagShift+5,Zo.NeedsAssemble=1<<i.Component.FlagShift+6,Zo.CompileMask=Zo.NeedsCompile|Zo.NeedsResolve|Zo.NeedsGenerate|Zo.NeedsAssemble,Zo.NeedsExecute=1<<i.Component.FlagShift+7,Zo.NeedsRevise=1<<i.Component.FlagShift+8,Zo.NeedsCompute=1<<i.Component.FlagShift+9,Zo.ExecuteMask=Zo.NeedsExecute|Zo.NeedsRevise|Zo.NeedsCompute,Zo.UpdateMask=Zo.CompileMask|Zo.ExecuteMask,Zo.FlagShift=i.Component.FlagShift+10,Zo.FlagMask=(1<<Zo.FlagShift)-1,Zo.MountFlags=0,Zo.InsertChildFlags=0,Zo.RemoveChildFlags=0,u([i.Provider({extends:zo,type:Uo,observes:!1,service:Uo.global()})],Zo.prototype,"executeProvider",void 0),u([i.Provider({extends:Ho,type:Go,observes:!1,service:Go.global()})],Zo.prototype,"historyProvider",void 0),u([i.Provider({extends:Ko,type:jo,observes:!1,service:jo.global()})],Zo.prototype,"storageProvider",void 0);const _o=function(t){const e=t.extend("ControllerRelation");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.initController=function(t){},e.prototype.willAttachController=function(t,e){},e.prototype.onAttachController=function(t,e){!0===this.observes&&t.observe(this)},e.prototype.didAttachController=function(t,e){},e.prototype.deinitController=function(t){},e.prototype.willDetachController=function(t){},e.prototype.onDetachController=function(t){!0===this.observes&&t.unobserve(this)},e.prototype.didDetachController=function(t){},Object.defineProperty(e.prototype,"parentController",{get(){const t=this.owner;return t instanceof Zo?t:null},configurable:!0}),e.prototype.insertChild=function(t,e,i,n){t.insertChild(e,i,n)},e.prototype.bindController=function(t,e){},e.prototype.unbindController=function(t){},e.prototype.detectController=function(t){return null},e.prototype.createController=function(){let t;const e=this.type;if(void 0!==e&&(t=e.create()),null==t){let t="Unable to create ";throw 0!==this.name.length&&(t+=this.name+" "),t+="controller",new Error(t)}return t},e.prototype.fromAny=function(t){const e=this.type;return void 0!==e?e.fromAny(t):Zo.fromAny(t)},Object.defineProperty(e.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!0},configurable:!0}),e.construct=function(e,i,n){return i=t.construct(e,i,n)},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,null==i&&(i=this);const s=i.extend(t,e);return s.construct=function(t,e,s){return e=i.construct(t,e,s),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),e},s},e}(i.Fastener),Qo=function(t){const e=t.extend("ControllerRef");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.onInherit=function(t){this.setController(t.controller)},e.prototype.getController=function(){const t=this.controller;if(null===t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="controller",new TypeError(e)}return t},e.prototype.setController=function(t,e,i){null!==t&&(t=this.fromAny(t));let n=this.controller;if(n!==t){let o;void 0===e&&(e=null),this.binds&&(o=this.parentController,null!==o)&&(null!==n&&n.parent===o&&(null===e&&(e=n.nextSibling),n.remove()),null!==t&&(void 0===i&&(i=this.key),this.insertChild(o,t,e,i)),n=this.controller),n!==t&&(null!==n&&(this.willDetachController(n),this.controller=null,this.onDetachController(n),this.deinitController(n),this.didDetachController(n)),null!==t&&(this.willAttachController(t,e),this.controller=t,this.onAttachController(t,e),this.initController(t),this.didAttachController(t,e)))}return n},e.prototype.attachController=function(t,e){const i=this.controller;return(t=null!=t?this.fromAny(t):null===i?this.createController():i)!==i&&(void 0===e&&(e=null),null!==i&&(this.willDetachController(i),this.controller=null,this.onDetachController(i),this.deinitController(i),this.didDetachController(i)),this.willAttachController(t,e),this.controller=t,this.onAttachController(t,e),this.initController(t),this.didAttachController(t,e)),t},e.prototype.detachController=function(){const t=this.controller;return null!==t&&(this.willDetachController(t),this.controller=null,this.onDetachController(t),this.deinitController(t),this.didDetachController(t)),t},e.prototype.insertController=function(t,e,i,n){if(null!=e)e=this.fromAny(e);else{const t=this.controller;e=null===t?this.createController():t}null==t&&(t=this.parentController),void 0===i&&(i=null),void 0===n&&(n=this.key),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const o=this.controller;return e!==o&&(null!==o&&(this.willDetachController(o),this.controller=null,this.onDetachController(o),this.deinitController(o),this.didDetachController(o),o.remove()),this.willAttachController(e,i),this.controller=e,this.onAttachController(e,i),this.initController(e),this.didAttachController(e,i)),e},e.prototype.removeController=function(){const t=this.controller;return null!==t&&t.remove(),t},e.prototype.deleteController=function(){const t=this.detachController();return null!==t&&t.remove(),t},e.prototype.bindController=function(t,e){if(this.binds&&null===this.controller){const i=this.detectController(t);null!==i&&(this.willAttachController(i,e),this.controller=i,this.onAttachController(i,e),this.initController(i),this.didAttachController(i,e))}},e.prototype.unbindController=function(t){if(this.binds){const e=this.detectController(t);null!==e&&this.controller===e&&(this.willDetachController(e),this.controller=null,this.onDetachController(e),this.deinitController(e),this.didDetachController(e))}},e.prototype.detectController=function(t){const e=this.key;return void 0!==e&&e===t.key?t:null},e.construct=function(e,i,n){return null===i&&(delete(i=function(t,e,n){return void 0===t?i.controller:(i.setController(t,e,n),i.owner)}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).key=void 0,i.controller=null,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,!0===e.key?Object.defineProperty(e,"key",{value:t,configurable:!0}):!1===e.key&&Object.defineProperty(e,"key",{value:void 0,configurable:!0}),null==i&&(i=this);const s=i.extend(t,e);return s.construct=function(t,e,s){return e=i.construct(t,e,s),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),e},s},e}(_o),Jo=function(t){const e=t.extend("ControllerSet");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.hasController=function(t){return void 0!==this.controllers[t.uid]},e.prototype.addController=function(t,e,i){let n;t=null!=t?this.fromAny(t):this.createController(),void 0===e&&(e=null),this.binds&&(n=this.parentController,null!==n)&&(void 0===i&&(i=this.key(t)),this.insertChild(n,t,e,i));const o=this.controllers;return void 0===o[t.uid]&&(this.willAttachController(t,e),o[t.uid]=t,this.controllerCount+=1,this.onAttachController(t,e),this.initController(t),this.didAttachController(t,e)),t},e.prototype.attachController=function(t,e){t=null!=t?this.fromAny(t):this.createController();const i=this.controllers;return void 0===i[t.uid]&&(void 0===e&&(e=null),this.willAttachController(t,e),i[t.uid]=t,this.controllerCount+=1,this.onAttachController(t,e),this.initController(t),this.didAttachController(t,e)),t},e.prototype.detachController=function(t){const e=this.controllers;return void 0!==e[t.uid]?(this.willDetachController(t),this.controllerCount-=1,delete e[t.uid],this.onDetachController(t),this.deinitController(t),this.didDetachController(t),t):null},e.prototype.insertController=function(t,e,i,n){e=null!=e?this.fromAny(e):this.createController(),null==t&&(t=this.parentController),void 0===i&&(i=null),void 0===n&&(n=this.key(e)),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const o=this.controllers;return void 0===o[e.uid]&&(this.willAttachController(e,i),o[e.uid]=e,this.controllerCount+=1,this.onAttachController(e,i),this.initController(e),this.didAttachController(e,i)),e},e.prototype.removeController=function(t){return this.hasController(t)?(t.remove(),t):null},e.prototype.deleteController=function(t){const e=this.detachController(t);return null!==e&&e.remove(),e},e.prototype.bindController=function(t,e){if(this.binds){const i=this.detectController(t),n=this.controllers;null!==i&&void 0===n[i.uid]&&(this.willAttachController(i,e),n[i.uid]=i,this.controllerCount+=1,this.onAttachController(i,e),this.initController(i),this.didAttachController(i,e))}},e.prototype.unbindController=function(t){if(this.binds){const e=this.detectController(t),i=this.controllers;null!==e&&void 0!==i[e.uid]&&(this.willDetachController(e),this.controllerCount-=1,delete i[e.uid],this.onDetachController(e),this.deinitController(e),this.didDetachController(e))}},e.prototype.detectController=function(t){return"function"==typeof this.type&&t instanceof this.type?t:null},e.prototype.key=function(t){},Object.defineProperty(e.prototype,"sorted",{get(){return 0!=(this.flags&e.SortedFlag)},configurable:!0}),e.prototype.initInherits=function(t){this.flags=t?this.flags|e.SortedFlag:this.flags&~e.SortedFlag},e.prototype.sort=function(t){void 0===t&&(t=!0);const i=this.flags;if(t&&0==(i&e.SortedFlag)){const t=this.parentController;this.willSort(t),this.setFlags(i|e.SortedFlag),this.onSort(t),this.didSort(t)}else t||0==(i&e.SortedFlag)||this.setFlags(i&~e.SortedFlag);return this},e.prototype.willSort=function(t){},e.prototype.onSort=function(t){null!==t&&this.sortChildren(t)},e.prototype.didSort=function(t){},e.prototype.sortChildren=function(t){t.sortChildren(this.compareChildren.bind(this))},e.prototype.compareChildren=function(t,e){const i=this.controllers,n=i[t.uid],o=i[e.uid];return void 0!==n&&void 0!==o?this.compare(n,o):void 0!==n?1:void 0!==o?-1:0},e.prototype.compare=function(t,e){return t.uid<e.uid?-1:t.uid>e.uid?1:0},e.construct=function(e,i,n){return null===i&&(delete(i=function(t){return i.addController(t),i.owner}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).controllers={},i.controllerCount=0,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits,s=e.sorted;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,delete e.sorted,null==i&&(i=this);const r=i.extend(t,e);return r.construct=function(t,e,r){return e=i.construct(t,e,r),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),void 0!==s&&e.initSorted(s),e},r},e.SortedFlag=1<<t.FlagShift+0,e.FlagShift=t.FlagShift+1,e.FlagMask=(1<<e.FlagShift)-1,e}(_o),$o=function(t){const e=t.extend("TraitViewRef");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.onInherit=function(t){this.setTrait(t.trait),this.setView(t.view)},e.prototype.getTrait=function(){const t=this.trait;if(null===t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="trait",new TypeError(e)}return t},e.prototype.setTrait=function(t,e,i){null!==t&&(t=this.fromAnyTrait(t));let n=this.trait;if(n!==t){let o;void 0===e&&(e=null),this.bindsTrait&&(o=this.parentModel,null!==o)&&(null!==n&&n.model===o&&(null===e&&(e=n.nextTrait),n.remove()),null!==t&&(void 0===i&&(i=this.traitKey),this.insertChildTrait(o,t,e,i)),n=this.trait),n!==t&&(null!==n&&(this.willDetachTrait(n),this.trait=null,this.onDetachTrait(n),this.deinitTrait(n),this.didDetachTrait(n)),null!==t&&(this.willAttachTrait(t,e),this.trait=t,this.onAttachTrait(t,e),this.initTrait(t),this.didAttachTrait(t,e)))}return n},e.prototype.attachTrait=function(t,e){const i=this.trait;return(t=null!=t?this.fromAnyTrait(t):null===i?this.createTrait():i)!==i&&(void 0===e&&(e=null),null!==i&&(this.willDetachTrait(i),this.trait=null,this.onDetachTrait(i),this.deinitTrait(i),this.didDetachTrait(i)),this.willAttachTrait(t,e),this.trait=t,this.onAttachTrait(t,e),this.initTrait(t),this.didAttachTrait(t,e)),t},e.prototype.detachTrait=function(){const t=this.trait;return null!==t&&(this.willDetachTrait(t),this.trait=null,this.onDetachTrait(t),this.deinitTrait(t),this.didDetachTrait(t)),t},e.prototype.initTrait=function(t){},e.prototype.willAttachTrait=function(t,e){},e.prototype.onAttachTrait=function(t,e){!0===this.observesTrait&&t.observe(this)},e.prototype.didAttachTrait=function(t,e){},e.prototype.deinitTrait=function(t){},e.prototype.willDetachTrait=function(t){},e.prototype.onDetachTrait=function(t){!0===this.observesTrait&&t.unobserve(this)},e.prototype.didDetachTrait=function(t){},e.prototype.insertTrait=function(t,e,i,n){if(null!=e)e=this.fromAnyTrait(e);else{const t=this.trait;e=null===t?this.createTrait():t}null==t&&(t=this.parentModel),void 0===i&&(i=null),void 0===n&&(n=this.traitKey),null===t||e.parent===t&&e.key===n||this.insertChildTrait(t,e,i,n);const o=this.trait;return e!==o&&(null!==o&&(this.willDetachTrait(o),this.trait=null,this.onDetachTrait(o),this.deinitTrait(o),this.didDetachTrait(o),o.remove()),this.willAttachTrait(e,i),this.trait=e,this.onAttachTrait(e,i),this.initTrait(e),this.didAttachTrait(e,i)),e},e.prototype.removeTrait=function(){const t=this.trait;return null!==t&&t.remove(),t},e.prototype.deleteTrait=function(){const t=this.detachTrait();return null!==t&&t.remove(),t},Object.defineProperty(e.prototype,"parentModel",{get(){const t=this.owner;return t instanceof y?t:t instanceof S?t.model:null},configurable:!0}),e.prototype.insertChildTrait=function(t,e,i,n){t.insertTrait(e,i,n)},e.prototype.bindModel=function(t,e){if(this.bindsTrait&&null===this.trait){const e=this.detectModel(t);null!==e&&(this.willAttachTrait(e,null),this.trait=e,this.onAttachTrait(e,null),this.initTrait(e),this.didAttachTrait(e,null))}},e.prototype.unbindModel=function(t){if(this.bindsTrait){const e=this.detectModel(t);null!==e&&this.trait===e&&(this.willDetachTrait(e),this.trait=null,this.onDetachTrait(e),this.deinitTrait(e),this.didDetachTrait(e))}},e.prototype.detectModel=function(t){return null},e.prototype.bindTrait=function(t,e){if(this.bindsTrait&&null===this.trait){const i=this.detectTrait(t);null!==i&&(this.willAttachTrait(i,e),this.trait=i,this.onAttachTrait(i,e),this.initTrait(i),this.didAttachTrait(i,e))}},e.prototype.unbindTrait=function(t){if(this.bindsTrait){const e=this.detectTrait(t);null!==e&&this.trait===e&&(this.willDetachTrait(e),this.trait=null,this.onDetachTrait(e),this.deinitTrait(e),this.didDetachTrait(e))}},e.prototype.detectTrait=function(t){const e=this.traitKey;return void 0!==e&&e===t.key?t:null},e.prototype.createTrait=function(){let t;const e=this.traitType;if(void 0!==e&&(t=e.create()),null==t){let t="Unable to create ";throw 0!==this.name.length&&(t+=this.name+" "),t+="trait",new Error(t)}return t},e.prototype.fromAnyTrait=function(t){const e=this.traitType;return void 0!==e?e.fromAny(t):S.fromAny(t)},e.prototype.getView=function(){const t=this.view;if(null===t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="view",new TypeError(e)}return t},e.prototype.setView=function(t,e,i){null!==t&&(t=this.fromAnyView(t));let n=this.view;if(n!==t){let o;void 0===e&&(e=null),this.bindsView&&(o=this.parentView,null!==o)&&(null!==n&&n.parent===o&&(null===e&&(e=n.nextSibling),n.remove()),null!==t&&(void 0===i&&(i=this.viewKey),this.insertChildView(o,t,e,i)),n=this.view),n!==t&&(null!==n&&(this.willDetachView(n),this.view=null,this.onDetachView(n),this.deinitView(n),this.didDetachView(n)),null!==t&&(this.willAttachView(t,e),this.view=t,this.onAttachView(t,e),this.initView(t),this.didAttachView(t,e)))}return n},e.prototype.attachView=function(t,e){const i=this.view;return(t=null!=t?this.fromAnyView(t):null===i?this.createView():i)!==i&&(void 0===e&&(e=null),null!==i&&(this.willDetachView(i),this.view=null,this.onDetachView(i),this.deinitView(i),this.didDetachView(i)),this.willAttachView(t,e),this.view=t,this.onAttachView(t,e),this.initView(t),this.didAttachView(t,e)),t},e.prototype.detachView=function(){const t=this.view;return null!==t&&(this.willDetachView(t),this.view=null,this.onDetachView(t),this.deinitView(t),this.didDetachView(t)),t},e.prototype.initView=function(t){},e.prototype.willAttachView=function(t,e){},e.prototype.onAttachView=function(t,e){!0===this.observesView&&t.observe(this)},e.prototype.didAttachView=function(t,e){},e.prototype.deinitView=function(t){},e.prototype.willDetachView=function(t){},e.prototype.onDetachView=function(t){!0===this.observesView&&t.unobserve(this)},e.prototype.didDetachView=function(t){},e.prototype.insertView=function(t,e,i,n){if(null!=e)e=this.fromAnyView(e);else{const t=this.view;e=null===t?this.createView():t}null==t&&(t=this.parentView),void 0===i&&(i=null),void 0===n&&(n=this.viewKey),null===t||e.parent===t&&e.key===n||this.insertChildView(t,e,i,n);const o=this.view;return e!==o&&(null!==o&&(this.willDetachView(o),this.view=null,this.onDetachView(o),this.deinitView(o),this.didDetachView(o),o.remove()),this.willAttachView(e,i),this.view=e,this.onAttachView(e,i),this.initView(e),this.didAttachView(e,i)),e},e.prototype.removeView=function(){const t=this.view;return null!==t&&t.remove(),t},e.prototype.deleteView=function(){const t=this.detachView();return null!==t&&t.remove(),t},Object.defineProperty(e.prototype,"parentView",{get(){const t=this.owner;return t instanceof pn?t:null},configurable:!0}),e.prototype.insertChildView=function(t,e,i,n){t.insertChild(e,i,n)},e.prototype.bindView=function(t,e){if(this.bindsView&&null===this.view){const i=this.detectView(t);null!==i&&(this.willAttachView(i,e),this.view=i,this.onAttachView(i,e),this.initView(i),this.didAttachView(i,e))}},e.prototype.unbindView=function(t){if(this.bindsView){const e=this.detectView(t);null!==e&&this.view===e&&(this.willDetachView(e),this.view=null,this.onDetachView(e),this.deinitView(e),this.didDetachView(e))}},e.prototype.detectView=function(t){const e=this.viewKey;return void 0!==e&&e===t.key?t:null},e.prototype.createView=function(){let t;const e=this.viewType;if(void 0!==e&&(t=e.create()),null==t){let t="Unable to create ";throw 0!==this.name.length&&(t+=this.name+" "),t+="view",new Error(t)}return t},e.prototype.fromAnyView=function(t){const e=this.viewType;return void 0!==e?e.fromAny(t):pn.fromAny(t)},Object.defineProperty(e.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!0},configurable:!0}),e.construct=function(e,i,n){return(i=t.construct(e,i,n)).trait=null,i.view=null,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,!0===e.traitKey?Object.defineProperty(e,"traitKey",{value:t,configurable:!0}):!1===e.traitKey&&Object.defineProperty(e,"traitKey",{value:void 0,configurable:!0}),!0===e.viewKey?Object.defineProperty(e,"viewKey",{value:t,configurable:!0}):!1===e.viewKey&&Object.defineProperty(e,"viewKey",{value:void 0,configurable:!0}),null==i&&(i=this);const s=i.extend(t,e);return s.construct=function(t,e,s){return e=i.construct(t,e,s),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),e},s},e}(i.Fastener),ts=function(t){const e=t.extend("TraitControllerRef");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.getTraitRef=function(t){throw new Error("abstract")},Object.defineProperty(e.prototype,"trait",{get:function(){const t=this.controller;if(null!==t){return this.getTraitRef(t).trait}return null},configurable:!0}),e.prototype.setTrait=function(t,e,i){let n=this.controller;if(null!==t){null===n&&(n=this.createController(t));this.getTraitRef(n).setTrait(t,e,i),this.setController(n,null,i)}else if(null!==n){this.getTraitRef(n).setTrait(null)}return n},e.prototype.removeTrait=function(t){const e=this.controller;if(null!==e){if(this.getTraitRef(e).trait===t)return e.remove(),e}return null},e.prototype.deleteTrait=function(t){const e=this.controller;if(null!==e){if(this.getTraitRef(e).trait===t)return e.remove(),this.setController(null),e}return null},e.construct=function(e,i,n){return i=t.construct(e,i,n)},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,!0===e.key?Object.defineProperty(e,"key",{value:t,configurable:!0}):!1===e.key&&Object.defineProperty(e,"key",{value:void 0,configurable:!0}),null==i&&(i=this);const s=i.extend(t,e);return s.construct=function(t,e,s){return e=i.construct(t,e,s),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),e},s},e}(Qo),es=function(t){const e=t.extend("TraitControllerSet");return e.prototype.getTraitRef=function(t){throw new Error("missing implementation")},e.prototype.hasTraitController=function(t){return void 0!==this.traitControllers[t.uid]},e.prototype.addTraitController=function(t,e,i){const n=this.traitControllers;let o=n[t.uid];if(void 0===o){o=this.createController(t);this.getTraitRef(o).setTrait(t,e,i);const s=null!=e?n[e.uid]:void 0;this.addController(o,s,i)}return o},e.prototype.removeTraitController=function(t){const e=this.controllers;for(const i in e){const n=e[i];if(this.getTraitRef(n).trait===t)return this.removeController(n),n}return null},e.prototype.deleteTraitController=function(t){const e=this.controllers;for(const i in e){const n=e[i];if(this.getTraitRef(n).trait===t)return this.deleteController(n),n}return null},e.prototype.attachControllerTrait=function(t,e,i){const n=this.traitControllers;let o=n[e.uid];return void 0===o&&(o=t,void 0===i&&(i=null),this.willAttachControllerTrait(o,e,i),n[e.uid]=o,this.controllerCount+=1,this.onAttachControllerTrait(o,e,i),this.initControllerTrait(o,e),this.didAttachControllerTrait(o,e,i)),o},e.prototype.detachControllerTrait=function(t,e){const i=this.traitControllers,n=i[e.uid];return void 0!==n?(this.willDetachControllerTrait(n,e),this.controllerCount-=1,delete i[e.uid],this.onDetachControllerTrait(n,e),this.deinitControllerTrait(n,e),this.didDetachControllerTrait(n,e),n):null},e.prototype.initControllerTrait=function(t,e){},e.prototype.willAttachControllerTrait=function(t,e,i){},e.prototype.onAttachControllerTrait=function(t,e,i){},e.prototype.didAttachControllerTrait=function(t,e,i){},e.prototype.deinitControllerTrait=function(t,e){},e.prototype.willDetachControllerTrait=function(t,e){},e.prototype.onDetachControllerTrait=function(t,e){},e.prototype.didDetachControllerTrait=function(t,e){},e.prototype.onAttachController=function(t,e){const i=this.getTraitRef(t).trait;if(null!==i){const n=null!==e&&this.hasController(e)?this.getTraitRef(e).trait:null;this.attachControllerTrait(t,i,n)}Jo.prototype.onAttachController.call(this,t,e)},e.prototype.onDetachController=function(t){Jo.prototype.onDetachController.call(this,t);const e=this.getTraitRef(t).trait;null!==e&&this.detachControllerTrait(t,e)},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).traitControllers={},i},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits,s=e.sorted;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,delete e.sorted,null==i&&(i=this);const r=i.extend(t,e);return r.construct=function(t,e,r){return e=i.construct(t,e,r),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),void 0!==s&&e.initSorted(s),e},r},e}(Jo),is=function(t){const e=t.extend("TraitViewControllerRef");return Object.defineProperty(e.prototype,"fastenerType",{get:function(){return e},configurable:!0}),e.prototype.getTraitViewRef=function(t){throw new Error("abstract")},Object.defineProperty(e.prototype,"trait",{get:function(){const t=this.controller;if(null!==t){return this.getTraitViewRef(t).trait}return null},configurable:!0}),e.prototype.setTrait=function(t,e,i){let n=this.controller;if(null!==t){null===n&&(n=this.createController(t));const o=this.getTraitViewRef(n);if(o.setTrait(t,e,i),this.setController(n,null,i),null===o.view){const t=o.createView();o.insertView(this.parentView,t,null,i)}}else if(null!==n){this.getTraitViewRef(n).setTrait(null)}return n},e.prototype.removeTrait=function(t){const e=this.controller;if(null!==e){if(this.getTraitViewRef(e).trait===t)return e.remove(),e}return null},e.prototype.deleteTrait=function(t){const e=this.controller;if(null!==e){if(this.getTraitViewRef(e).trait===t)return e.remove(),this.setController(null),e}return null},Object.defineProperty(e.prototype,"view",{get:function(){const t=this.controller;if(null!==t){return this.getTraitViewRef(t).view}return null},configurable:!0}),Object.defineProperty(e.prototype,"parentView",{get:function(){return null},configurable:!0}),e.construct=function(e,i,n){return i=t.construct(e,i,n)},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,!0===e.key?Object.defineProperty(e,"key",{value:t,configurable:!0}):!1===e.key&&Object.defineProperty(e,"key",{value:void 0,configurable:!0}),null==i&&(i=this);const s=i.extend(t,e);return s.construct=function(t,e,s){return e=i.construct(t,e,s),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),e},s},e}(Qo),ns=function(t){const e=t.extend("TraitViewControllerSet");return e.prototype.getTraitViewRef=function(t){throw new Error("missing implementation")},e.prototype.hasTraitController=function(t){return void 0!==this.traitControllers[t.uid]},e.prototype.addTraitController=function(t,e,i){const n=this.traitControllers;let o=n[t.uid];if(void 0===o){o=this.createController(t);const s=this.getTraitViewRef(o);s.setTrait(t,e,i);const r=null!=e?n[e.uid]:void 0;if(this.addController(o,r,i),null===s.view){const t=s.createView(),e=void 0!==r?this.getTraitViewRef(r).view:null;s.insertView(this.parentView,t,e,i)}}return o},e.prototype.removeTraitController=function(t){const e=this.controllers;for(const i in e){const n=e[i];if(this.getTraitViewRef(n).trait===t)return this.removeController(n),n}return null},e.prototype.deleteTraitController=function(t){const e=this.controllers;for(const i in e){const n=e[i];if(this.getTraitViewRef(n).trait===t)return this.deleteController(n),n}return null},e.prototype.attachControllerTrait=function(t,e,i){const n=this.traitControllers;let o=n[e.uid];return void 0===o&&(o=t,void 0===i&&(i=null),this.willAttachControllerTrait(o,e,i),n[e.uid]=o,this.controllerCount+=1,this.onAttachControllerTrait(o,e,i),this.initControllerTrait(o,e),this.didAttachControllerTrait(o,e,i)),o},e.prototype.detachControllerTrait=function(t,e){const i=this.traitControllers,n=i[e.uid];return void 0!==n?(this.willDetachControllerTrait(n,e),this.controllerCount-=1,delete i[e.uid],this.onDetachControllerTrait(n,e),this.deinitControllerTrait(n,e),this.didDetachControllerTrait(n,e),n):null},e.prototype.initControllerTrait=function(t,e){},e.prototype.willAttachControllerTrait=function(t,e,i){},e.prototype.onAttachControllerTrait=function(t,e,i){},e.prototype.didAttachControllerTrait=function(t,e,i){},e.prototype.deinitControllerTrait=function(t,e){},e.prototype.willDetachControllerTrait=function(t,e){},e.prototype.onDetachControllerTrait=function(t,e){},e.prototype.didDetachControllerTrait=function(t,e){},e.prototype.onAttachController=function(t,e){const i=this.getTraitViewRef(t).trait;if(null!==i){const n=null!==e&&this.hasController(e)?this.getTraitViewRef(e).trait:null;this.attachControllerTrait(t,i,n)}Jo.prototype.onAttachController.call(this,t,e)},e.prototype.onDetachController=function(t){Jo.prototype.onDetachController.call(this,t);const e=this.getTraitViewRef(t).trait;null!==e&&this.detachControllerTrait(t,e)},Object.defineProperty(e.prototype,"parentView",{get:function(){return null},configurable:!0}),e.construct=function(e,i,n){return(i=t.construct(e,i,n)).traitControllers={},i},e.define=function(t,e){let i=e.extends;const n=e.affinity,o=e.inherits,s=e.sorted;delete e.extends,delete e.implements,delete e.affinity,delete e.inherits,delete e.sorted,null==i&&(i=this);const r=i.extend(t,e);return r.construct=function(t,e,r){return e=i.construct(t,e,r),void 0!==n&&e.initAffinity(n),void 0!==o&&e.initInherits(o),void 0!==s&&e.initSorted(s),e},r},e}(Jo);class os extends Xn{constructor(t){super(t),this.glowState="ready",this.glowTimer=0,this.initGlow()}initGlow(){this.addClass("button-glow"),this.position.setState("absolute",i.Affinity.Intrinsic),this.width.setState(o.Length.zero(),i.Affinity.Intrinsic),this.height.setState(o.Length.zero(),i.Affinity.Intrinsic),this.borderTopLeftRadius.setState(o.Length.pct(50),i.Affinity.Intrinsic),this.borderTopRightRadius.setState(o.Length.pct(50),i.Affinity.Intrinsic),this.borderBottomLeftRadius.setState(o.Length.pct(50),i.Affinity.Intrinsic),this.borderBottomRightRadius.setState(o.Length.pct(50),i.Affinity.Intrinsic),this.pointerEvents.setState("none",i.Affinity.Intrinsic)}didMount(){if(this.backgroundColor.hasAffinity(i.Affinity.Intrinsic)){let t=this.getLookOr(St.highlightColor,null);null!==t&&(t=t.alpha(1)),this.backgroundColor.setState(t,i.Affinity.Intrinsic)}super.didMount()}onUnmount(){this.glowState="ready",this.cancelGlow(),this.remove(),super.onUnmount()}onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),this.backgroundColor.hasAffinity(i.Affinity.Intrinsic)){let n=t.getOr(St.highlightColor,e,null);null!==n&&(n=n.alpha(1)),this.backgroundColor.setState(n,i.Affinity.Intrinsic)}}glow(t,n,o,s=0){if("ready"===this.glowState)if(this.cancelGlow(),0!==s){const e=this.glow.bind(this,t,n,o,i.Affinity.Intrinsic);this.glowTimer=setTimeout(e,s)}else{o=void 0===o||!0===o?this.getLookOr(St.timing,!1):e.Timing.fromAny(o),this.willGlow();const s=this.node.offsetParent;if(null!==s){const e=s.getBoundingClientRect(),r=t-e.left,l=n-e.top,a=Math.max(r,e.width-r),h=Math.max(l,e.height-l),c=Math.sqrt(a*a+h*h),d=this.getLook(St.highlightColor),u=void 0!==d?d.alpha():.1;this.opacity.setState(u,i.Affinity.Intrinsic),!1!==o?(this.left.setState(r,i.Affinity.Intrinsic),this.top.setState(l,i.Affinity.Intrinsic),this.left.setState(r-c,o,i.Affinity.Intrinsic),this.top.setState(l-c,o,i.Affinity.Intrinsic),this.width.setState(2*c,o,i.Affinity.Intrinsic),this.height.setState(2*c,o,i.Affinity.Intrinsic)):(this.left.setState(r-c,i.Affinity.Intrinsic),this.top.setState(l-c,i.Affinity.Intrinsic),this.width.setState(2*c,i.Affinity.Intrinsic),this.height.setState(2*c,i.Affinity.Intrinsic),this.didGlow()),this.glowState="glowing"}}}willGlow(){}didGlow(){}cancelGlow(){0!==this.glowTimer&&(clearTimeout(this.glowTimer),this.glowTimer=0)}pulse(t,n,o){o=void 0===o||!0===o?this.getLookOr(St.timing,!1):e.Timing.fromAny(o),"ready"===this.glowState&&this.glow(t,n,o),"glowing"===this.glowState&&(this.willPulse(),!1!==o?this.opacity.setState(0,o,i.Affinity.Intrinsic):(this.opacity.setState(0,i.Affinity.Intrinsic),this.didPulse()),this.glowState="pulsing")}willPulse(){}didPulse(){this.remove()}fade(t,n,o){"ready"===this.glowState?(this.cancelGlow(),this.didFade()):"glowing"===this.glowState&&(o=void 0===o||!0===o?this.getLookOr(St.timing,!1):e.Timing.fromAny(o),this.willFade(),!1!==o?this.opacity.setState(0,o,i.Affinity.Intrinsic):(this.opacity.setState(0,i.Affinity.Intrinsic),this.didFade())),this.glowState="fading"}willFade(){}didFade(){this.remove()}}u([Rn({propertyNames:"left",type:o.Length,value:null,get constraintValue(){const t=this.owner.node;return t instanceof HTMLElement?o.Length.px(t.offsetLeft):null},didTransition(){this.owner.didGlow()}})],os.prototype,"left",void 0),u([Dn({propertyNames:"opacity",type:Number,didTransition(t){"pulsing"===this.owner.glowState&&0===t?this.owner.didPulse():"fading"===this.owner.glowState&&0===t&&this.owner.didFade()}})],os.prototype,"opacity",void 0);class ss extends Xn{constructor(t){super(t),this.initMembrane(t)}initMembrane(t){this.addClass("membrane")}glow(t){if(t.detail instanceof os&&(t.detail.fade(t.x,t.y),t.detail=void 0),void 0===t.detail){const e="mouse"===t.inputType?0:100;t.detail=this.prependChild(os),t.detail.glow(t.x,t.y,void 0,e)}}init(t){super.init(t)}}u([i.Property({type:Boolean,inherits:!0,value:!0})],ss.prototype,"glows",void 0),u([Ji({self:!0,didBeginPress(t,e){this.owner.glows.value&&this.owner.glow(t)},didMovePress(t,e){t.isRunaway()?this.cancelPress(t,e):this.owner.clientBounds.contains(t.x,t.y)||(t.clearHoldTimer(),this.beginHover(t,e),t.detail instanceof os&&(t.detail.fade(t.x,t.y),t.detail=void 0))},didEndPress(t,e){this.owner.clientBounds.contains(t.x,t.y)?t.detail instanceof os&&t.detail.pulse(t.x,t.y):(this.endHover(t,e),t.detail instanceof os&&(t.detail.fade(t.x,t.y),t.detail=void 0))},didCancelPress(t,e){this.owner.clientBounds.contains(t.x,t.y)||this.endHover(t,e),t.detail instanceof os&&(t.detail.fade(t.x,t.y),t.detail=void 0)}})],ss.prototype,"gesture",void 0);class rs extends ss{constructor(t){super(t),this.buttonType="regular",this.iconCount=0,this.icon=null,this.initButton()}initButton(){this.addClass("floating-button"),this.position.setState("relative",i.Affinity.Intrinsic),"regular"===this.buttonType?(this.width.setState(56,i.Affinity.Intrinsic),this.height.setState(56,i.Affinity.Intrinsic)):"mini"===this.buttonType&&(this.width.setState(40,i.Affinity.Intrinsic),this.height.setState(40,i.Affinity.Intrinsic)),this.borderTopLeftRadius.setState(o.Length.pct(50),i.Affinity.Intrinsic),this.borderTopRightRadius.setState(o.Length.pct(50),i.Affinity.Intrinsic),this.borderBottomLeftRadius.setState(o.Length.pct(50),i.Affinity.Intrinsic),this.borderBottomRightRadius.setState(o.Length.pct(50),i.Affinity.Intrinsic),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic),this.userSelect.setState("none",i.Affinity.Intrinsic),this.cursor.setState("pointer",i.Affinity.Intrinsic)}setButtonType(t){this.buttonType!==t&&(this.buttonType=t,"regular"===t?(this.width.setState(56,i.Affinity.Intrinsic),this.height.setState(56,i.Affinity.Intrinsic)):"mini"===t&&(this.width.setState(40,i.Affinity.Intrinsic),this.height.setState(40,i.Affinity.Intrinsic)))}pushIcon(t,n){n=void 0===n||!0===n?this.getLookOr(St.timing,!1):e.Timing.fromAny(n);const s=this.iconCount,r="icon"+s,l=this.getFastener(r,gn),a=null!==l?l.view:null;null!==a&&(!1!==n?(a.opacity.setState(0,n,i.Affinity.Intrinsic),a.transform.setState(o.Transform.rotate(o.Angle.deg(90)),n,i.Affinity.Intrinsic)):a.remove());const h=s+1,c="icon"+h,d=rs.IconRef.create(this);Object.defineProperty(d,"name",{value:c,enumerable:!0,configurable:!0}),d.iconIndex=h;const u=No.create();u.position.setState("absolute",i.Affinity.Intrinsic),u.left.setState(0,i.Affinity.Intrinsic),u.top.setState(0,i.Affinity.Intrinsic),u.width.setState(this.width.state,i.Affinity.Intrinsic),u.height.setState(this.height.state,i.Affinity.Intrinsic),u.opacity.setState(0,i.Affinity.Intrinsic),u.opacity.setState(1,n,i.Affinity.Intrinsic),u.transform.setState(o.Transform.rotate(o.Angle.deg(-90)),i.Affinity.Intrinsic),u.transform.setState(o.Transform.rotate(o.Angle.deg(0)),n,i.Affinity.Intrinsic),u.pointerEvents.setState("none",i.Affinity.Intrinsic),u.iconWidth.setState(24,i.Affinity.Intrinsic),u.iconHeight.setState(24,i.Affinity.Intrinsic),u.iconColor.setAffinity(i.Affinity.Extrinsic),u.graphics.setState(t,i.Affinity.Intrinsic),d.setView(u),this.setFastener(c,d),this.appendChild(u,c),this.iconCount=h,this.icon=d}popIcon(t){t=void 0===t||!0===t?this.getLookOr(St.timing,!1):e.Timing.fromAny(t);const n=this.iconCount,s="icon"+n,r=this.getFastener(s,gn),l=null!==r?r.view:null;null!==l&&(!1!==t?(l.opacity.setState(0,t,i.Affinity.Intrinsic),l.transform.setState(o.Transform.rotate(o.Angle.deg(-90)),t,i.Affinity.Intrinsic)):l.remove());const a=n-1,h="icon"+a,c=this.getFastener(h,gn),d=null!==c?c.view:null;null!==d&&(d.opacity.setState(1,t,i.Affinity.Intrinsic),d.transform.setState(o.Transform.rotate(o.Angle.deg(0)),t,i.Affinity.Intrinsic),this.appendChild(d,h)),this.iconCount=a,this.icon=c}onApplyTheme(t,e,n){super.onApplyTheme(t,e,n),this.backgroundColor.setState(t.getOr(St.accentColor,e,null),n,i.Affinity.Intrinsic);let o=t.getOr(St.shadow,Ot.floating,null);if(null!==o){const t=o.color,e=this.disclosure.getPhaseOr(1);o=o.withColor(t.alpha(t.alpha()*e))}this.boxShadow.setState(o,n,i.Affinity.Intrinsic)}onLayout(t){super.onLayout(t);let e=this.getLookOr(St.shadow,Ot.floating,null);if(null!==e){const t=e.color,i=this.disclosure.getPhaseOr(1);e=e.withColor(t.alpha(t.alpha()*i))}this.boxShadow.setState(e,i.Affinity.Intrinsic)}}rs.IconRef=gn.define("IconRef",{implements:!0,type:No,observes:!0,init(){this.iconIndex=0},viewDidApplyTheme(t,e,i,n){const o=t.getOr(St.backgroundColor,e,null);n.iconColor.setState(o,i)},viewDidAnimate(t,e){e.opacity.tweening||this.iconIndex===this.owner.iconCount||(e.remove(),this.iconIndex>this.owner.iconCount&&this.owner.setFastener(this.key,null))}}),u([Ji({extends:!0,didStartHovering(){if(this.owner.modifyMood(Mt.default,[[Mt.hovering,1]]),this.owner.backgroundColor.hasAffinity(i.Affinity.Intrinsic)){const t=this.owner.getLook(St.timing);this.owner.backgroundColor.setState(this.owner.getLookOr(St.accentColor,null),t,i.Affinity.Intrinsic)}},didStopHovering(){if(this.owner.modifyMood(Mt.default,[[Mt.hovering,void 0]]),this.owner.backgroundColor.hasAffinity(i.Affinity.Intrinsic)){const t=this.owner.getLook(St.timing);this.owner.backgroundColor.setState(this.owner.getLookOr(St.accentColor,null),t,i.Affinity.Intrinsic)}},didMovePress(t,e){}})],rs.prototype,"gesture",void 0),u([zt({type:ft,inherits:!0})],rs.prototype,"disclosure",void 0);class ls extends Xn{constructor(t){super(t),this.initButtonItem()}initButtonItem(){this.addClass("button-item"),this.position.setState("relative",i.Affinity.Intrinsic);const t=this.createButton();null!==t&&this.setChild("button",t)}createButton(){const t=rs.create();return t.setButtonType("mini"),t}get button(){const t=this.getChild("button");return t instanceof rs?t:null}get icon(){const t=this.button,e=null!==t?t.icon:null;return null!==e?e.view:null}get label(){const t=this.getChild("label");return t instanceof Xn?t:null}onApplyTheme(t,e,n){super.onApplyTheme(t,e,n);const o=this.label;null!==o&&o.color.hasAffinity(i.Affinity.Intrinsic)&&o.color.setState(t.getOr(St.mutedColor,e,null),n,i.Affinity.Intrinsic)}onLayout(t){super.onLayout(t);const e=this.disclosure.getPhaseOr(1),n=this.button;null!==n&&(this.width.setState(n.width.state,i.Affinity.Intrinsic),this.height.setState(n.height.state,i.Affinity.Intrinsic));const o=this.label;null!==o&&o.opacity.setState(e,i.Affinity.Intrinsic)}onInsertChild(t,e){super.onInsertChild(t,e);const i=t.key;"button"===i&&t instanceof rs?this.onInsertButton(t):"label"===i&&t instanceof Xn&&this.onInsertLabel(t)}onRemoveChild(t){const e=t.key;"button"===e&&t instanceof rs?this.onRemoveButton(t):"label"===e&&t instanceof Xn&&this.onRemoveLabel(t),super.onRemoveChild(t)}onInsertButton(t){}onRemoveButton(t){}onInsertLabel(t){t.display.setState("block",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.right.setState(56,i.Affinity.Intrinsic),t.bottom.setState(0,i.Affinity.Intrinsic),t.fontSize.setState(17,i.Affinity.Intrinsic),t.fontWeight.setState("500",i.Affinity.Intrinsic),t.lineHeight.setState(40,i.Affinity.Intrinsic),t.whiteSpace.setState("nowrap",i.Affinity.Intrinsic),t.opacity.setState(this.disclosure.getPhaseOr(0),i.Affinity.Intrinsic)}onRemoveLabel(t){}}u([zt({type:ft,inherits:!0})],ls.prototype,"disclosure",void 0);class as extends Xn{constructor(t){super(t),this.stackHeight=0,this.onClick=this.onClick.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.initButtonStack(),this.initButton()}initButtonStack(){this.addClass("button-stack"),this.display.setState("block",i.Affinity.Intrinsic),this.position.setState("relative",i.Affinity.Intrinsic),this.width.setState(56,i.Affinity.Intrinsic),this.height.setState(56,i.Affinity.Intrinsic),this.opacity.setState(1,i.Affinity.Intrinsic),this.userSelect.setState("none",i.Affinity.Intrinsic),this.cursor.setState("pointer",i.Affinity.Intrinsic)}initButton(){const t=this.createButton();null!==t&&this.appendChild(t,"button")}createButton(){return rs.create()}get modalView(){return null}get modalState(){return this.disclosure.modalState}get modality(){return this.disclosure.phase}showModal(t,e){this.disclosure.expand(e)}hideModal(t){this.disclosure.collapse(t)}get button(){const t=this.getChild("button");return t instanceof Xn?t:null}get closeIcon(){return as.closeIcon}get items(){const t=this.node.childNodes,e=[];for(let i=0,n=t.length;i<n;i+=1){const n=t[i].view;n instanceof ls&&e.push(n)}return e}insertItem(t,e,i){void 0===e&&(e=this.node.childNodes.length-1),this.insertChild(t.node,this.node.childNodes[1+e]||null,i)}removeItems(){const t=this.node.childNodes;for(let e=t.length-1;e>=0;e-=1){const i=t[e].view;i instanceof ls&&this.removeChild(i)}}onMount(){super.onMount(),this.on("click",this.onClick),this.on("contextmenu",this.onContextMenu)}onUnmount(){this.off("click",this.onClick),this.off("contextmenu",this.onContextMenu),super.onUnmount()}onLayout(t){super.onLayout(t),this.layoutStack();const e=this.modalProvider.service;null!=e&&e.updateModality()}layoutStack(){const t=this.disclosure.getPhase(),e=this.node.childNodes,n=e.length,s=this.button;let r,l=n-1,a=0,h=0;if(null!==s){s.zIndex.setState(n,i.Affinity.Intrinsic);const t=null!==s?s.height.value:void 0;r=t instanceof o.Length?t.pxValue():s.node.offsetHeight}else r=0;const c=this.buttonSpacing.value,d=this.itemSpacing.value;for(let s=0;s<n;s+=1){const n=e[s].view;if(n instanceof ls){0===a?(h+=c,r+=c):(h+=d,r+=d);const e=n.height.value,s=e instanceof o.Length?e.pxValue():n.node.offsetHeight;n.display.setState(0===t?"none":"flex",i.Affinity.Intrinsic),n.bottom.setState(t*r,i.Affinity.Intrinsic),n.zIndex.setState(l,i.Affinity.Intrinsic),r+=s,h+=s,a+=1,l-=1}}this.stackHeight=h}onInsertChild(t,e){super.onInsertChild(t,e);"button"===t.key&&t instanceof Xn?this.onInsertButton(t):t instanceof ls&&this.onInsertItem(t)}onRemoveChild(t){"button"===t.key&&t instanceof Xn?this.onRemoveButton(t):t instanceof ls&&this.onRemoveItem(t),super.onRemoveChild(t)}onInsertButton(t){this.gesture.setView(t),t instanceof rs&&(t.disclosure.setState(ft.expanded(),i.Affinity.Intrinsic),(this.disclosure.expanded||this.disclosure.expanding)&&t.pushIcon(this.closeIcon)),t.zIndex.setState(0,i.Affinity.Intrinsic)}onRemoveButton(t){this.gesture.setView(null)}onInsertItem(t){t.position.setState("absolute",i.Affinity.Intrinsic),t.right.setState(8,i.Affinity.Intrinsic),t.bottom.setState(8,i.Affinity.Intrinsic),t.left.setState(8,i.Affinity.Intrinsic),t.zIndex.setState(0,i.Affinity.Intrinsic)}onRemoveItem(t){}willExpand(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackWillExpand&&i.buttonStackWillExpand(this)}}onExpand(){const t=this.button;if(t instanceof rs){const e=this.disclosure.timing;t.pushIcon(this.closeIcon,null!==e?e:void 0)}this.modalProvider.presentModal(this)}didExpand(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackDidExpand&&i.buttonStackDidExpand(this)}}willCollapse(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackWillCollapse&&i.buttonStackWillCollapse(this)}}onCollapse(){this.modalProvider.dismissModal(this);const t=this.button;if(t instanceof rs&&t.iconCount>1){const e=this.disclosure.timing;t.popIcon(null!==e?e:void 0)}}didCollapse(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackDidCollapse&&i.buttonStackDidCollapse(this)}}show(t){1!==this.opacity.state&&(t=void 0===t||!0===t?this.getLookOr(St.timing,!1):e.Timing.fromAny(t),this.willShowStack(),!1!==t?this.opacity.setState(1,t,i.Affinity.Intrinsic):(this.opacity.setState(1,i.Affinity.Intrinsic),this.didShowStack()))}willShowStack(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackWillShow&&i.buttonStackWillShow(this)}this.display("block")}didShowStack(){this.requireUpdate(pn.NeedsLayout);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackDidShow&&i.buttonStackDidShow(this)}}hide(t){0!==this.opacity.state&&(t=void 0===t||!0===t?this.getLookOr(St.timing,!1):e.Timing.fromAny(t),this.willHideStack(),!1!==t?this.opacity.setState(0,t,i.Affinity.Intrinsic):(this.opacity.setState(0,i.Affinity.Intrinsic),this.didHideStack()))}willHideStack(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackWillHide&&i.buttonStackWillHide(this)}}didHideStack(){this.display("none"),this.requireUpdate(pn.NeedsLayout);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackDidHide&&i.buttonStackDidHide(this)}}onClick(t){var e;t.target===(null===(e=this.button)||void 0===e?void 0:e.node)&&t.stopPropagation()}onContextMenu(t){t.preventDefault()}static get closeIcon(){return Do.create(24,24,"M19,6.4L17.6,5L12,10.6L6.4,5L5,6.4L10.6,12L5,17.6L6.4,19L12,13.4L17.6,19L19,17.6L13.4,12Z")}}u([Ji({didMovePress(t,e){if(!t.defaultPrevented&&!this.owner.disclosure.expanded){const e=this.owner.stackHeight,i=Math.min(Math.max(0,-(t.y-t.y0)/(.5*e)),1);this.owner.disclosure.setPhase(i),i>.1&&(t.clearHoldTimer(),this.owner.disclosure.expanding||this.owner.disclosure.setState(this.owner.disclosure.value.asExpanding()))}},didEndPress(t,e){if(!t.defaultPrevented){const e=this.owner.disclosure.getPhase();t.t-t.t0<t.holdDelay?e<.1||this.owner.disclosure.expanded?this.owner.disclosure.collapse():this.owner.disclosure.expand():e<.5?this.owner.disclosure.collapse():e>=.5&&this.owner.disclosure.expand()}},didCancelPress(t,e){if(2===t.buttons)this.owner.disclosure.toggle();else{this.owner.disclosure.getPhase()<.1||this.owner.disclosure.expanded?this.owner.disclosure.collapse():this.owner.disclosure.expand()}},didLongPress(t){t.preventDefault(),this.owner.disclosure.toggle()}})],as.prototype,"gesture",void 0),u([zt({type:ft,value:ft.collapsed(),updateFlags:pn.NeedsLayout,willExpand(){this.owner.willExpand(),this.owner.onExpand()},didExpand(){this.owner.didExpand()},willCollapse(){this.owner.willCollapse(),this.owner.onCollapse()},didCollapse(){this.owner.didCollapse()}})],as.prototype,"disclosure",void 0),u([zt({type:Number,value:28,updateFlags:pn.NeedsLayout})],as.prototype,"buttonSpacing",void 0),u([zt({type:Number,value:20,updateFlags:pn.NeedsLayout})],as.prototype,"itemSpacing",void 0),u([Dn({propertyNames:"opacity",type:Number,didTransition(t){1===t?this.owner.didShowStack():0===t&&this.owner.didHideStack()}})],as.prototype,"opacity",void 0),u([e.Lazy],as,"closeIcon",null);class hs extends ss{constructor(t){super(t),this.iconCount=0,this.icon=null,this.onClick=this.onClick.bind(this),this.initButton(),this.initTheme()}initButton(){this.addClass("icon-button"),this.position.setState("relative",i.Affinity.Intrinsic),this.width.setState(44,i.Affinity.Intrinsic),this.height.setState(44,i.Affinity.Intrinsic),this.display.setState("flex",i.Affinity.Intrinsic),this.justifyContent.setState("center",i.Affinity.Intrinsic),this.alignItems.setState("center",i.Affinity.Intrinsic),this.borderTopLeftRadius.setState(4,i.Affinity.Intrinsic),this.borderTopRightRadius.setState(4,i.Affinity.Intrinsic),this.borderBottomLeftRadius.setState(4,i.Affinity.Intrinsic),this.borderBottomRightRadius.setState(4,i.Affinity.Intrinsic),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic),this.userSelect.setState("none",i.Affinity.Intrinsic),this.cursor.setState("pointer",i.Affinity.Intrinsic)}initTheme(){this.modifyTheme(Mt.default,[[Mt.translucent,1]])}pushIcon(t,n){const s=this.iconCount,r=s+1;this.iconCount=r,n=(void 0!==n||0!==s)&&(void 0===n||!0===n?this.getLookOr(St.timing,!1):e.Timing.fromAny(n));const l="icon"+s,a=this.getFastener(l,gn),h=null!==a?a.view:null;null!==h&&(!1!==n?(h.opacity.setState(0,n,i.Affinity.Intrinsic),h.cssTransform.setState(o.Transform.rotate(o.Angle.deg(90)),n,i.Affinity.Intrinsic)):h.remove());const c="icon"+r,d=hs.IconRef.create(this);Object.defineProperty(d,"name",{value:c,enumerable:!0,configurable:!0}),d.iconIndex=r,this.icon=d;const u=Eo.create();u.setStyle("position","absolute"),u.setStyle("left","0"),u.setStyle("top","0"),u.opacity.setState(0,i.Affinity.Intrinsic),u.opacity.setState(1,n,i.Affinity.Intrinsic),u.cssTransform.setState(o.Transform.rotate(o.Angle.deg(-90)),i.Affinity.Intrinsic),u.cssTransform.setState(o.Transform.rotate(o.Angle.deg(0)),n,i.Affinity.Intrinsic),u.pointerEvents.setState("none",i.Affinity.Intrinsic),u.xAlign.setInherits(!0),u.yAlign.setInherits(!0),u.iconWidth.setInherits(!0),u.iconHeight.setInherits(!0),u.iconColor.setInherits(!0),u.graphics.setState(t,i.Affinity.Intrinsic),d.setView(u),this.setFastener(c,d),this.appendChild(u,c)}popIcon(t){const n=this.iconCount,s=n-1;this.iconCount=s,t=void 0===t||!0===t?this.getLookOr(St.timing,!1):e.Timing.fromAny(t);const r="icon"+n,l=this.getFastener(r,gn),a=null!==l?l.view:null;null!==a&&(!1!==t?(a.opacity.setState(0,t,i.Affinity.Intrinsic),a.cssTransform.setState(o.Transform.rotate(o.Angle.deg(-90)),t,i.Affinity.Intrinsic)):(a.remove(),this.setFastener(r,null)));const h="icon"+s,c=this.getFastener(h,gn);this.icon=c;const d=null!==c?c.view:null;return null!==d&&(d.opacity.setState(1,t,i.Affinity.Intrinsic),d.cssTransform.setState(o.Transform.rotate(o.Angle.deg(0)),t,i.Affinity.Intrinsic),this.appendChild(d,h)),a}onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),this.backgroundColor.hasAffinity(i.Affinity.Intrinsic)){let t=this.getLookOr(St.backgroundColor,null);!this.gesture.hovering&&t instanceof B&&(t=t.alpha(0)),this.backgroundColor.setState(t,n,i.Affinity.Intrinsic)}if(!this.graphics.inherited){const o=this.graphics.value;if(o instanceof xo){const s=o.withTheme(t,e);this.graphics.setState(s,!!o.isThemed()&&n,i.Affinity.Reflexive)}}}onResize(t){super.onResize(t),this.requireUpdate(pn.NeedsLayout)}needsDisplay(t,e){return 0==(this.flags&pn.NeedsLayout)&&(t&=~pn.NeedsLayout),t}onLayout(t){super.onLayout(t),this.layoutIcon()}layoutIcon(){const t=this.fasteners;if(null!==t){let e=this.width.value;e=e instanceof o.Length?e.pxValue():this.node.offsetWidth;let n=this.height.value;n=n instanceof o.Length?n.pxValue():this.node.offsetHeight;for(const o in t){const s=t[o];if(s instanceof hs.IconRef){const t=s.view;null!==t&&(t.width.setState(e,i.Affinity.Intrinsic),t.height.setState(n,i.Affinity.Intrinsic),t.viewBox.setState("0 0 "+e+" "+n,i.Affinity.Intrinsic))}}}}onMount(){super.onMount(),this.on("click",this.onClick)}onUnmount(){this.off("click",this.onClick),super.onUnmount()}get hovers(){return!0}setHovers(t){this.hovers!==t&&Object.defineProperty(this,"hovers",{value:t,configurable:!0})}onClick(t){t.stopPropagation();const e=this.observers;for(let t=0,i=e.length;t<i;t+=1){const i=e[t];void 0!==i.buttonDidPress&&i.buttonDidPress(this)}}init(t){super.init(t),Ro.init(this,t)}}hs.IconRef=gn.define("IconRef",{implements:!0,type:Eo,observes:!0,init(){this.iconIndex=0},viewDidAnimate(t,e){e.opacity.tweening||this.iconIndex===this.owner.iconCount||(e.remove(),this.iconIndex>this.owner.iconCount&&this.owner.setFastener(this.name,null))}}),u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsLayout})],hs.prototype,"xAlign",void 0),u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsLayout})],hs.prototype,"yAlign",void 0),u([zt({type:o.Length,value:o.Length.px(24),updateFlags:pn.NeedsLayout})],hs.prototype,"iconWidth",void 0),u([zt({type:o.Length,value:o.Length.px(24),updateFlags:pn.NeedsLayout})],hs.prototype,"iconHeight",void 0),u([zt({type:B,value:null,updateFlags:pn.NeedsLayout,didSetValue(t,e){if(null!==t){const e=this.owner.graphics.value;if(e instanceof To){const n=e.withFillColor(t);this.owner.graphics.setState(n,i.Affinity.Reflexive)}}}})],hs.prototype,"iconColor",void 0),u([zt({extends:Oo,value:null,type:Object,updateFlags:pn.NeedsLayout})],hs.prototype,"graphics",void 0),u([Ji({extends:!0,didStartHovering(){if(this.owner.hovers){this.owner.modifyMood(Mt.default,[[Mt.hovering,1]]);const t=this.owner.getLook(St.timing);this.owner.backgroundColor.hasAffinity(i.Affinity.Intrinsic)&&this.owner.backgroundColor.setState(this.owner.getLookOr(St.backgroundColor,null),t,i.Affinity.Intrinsic)}},didStopHovering(){this.owner.modifyMood(Mt.default,[[Mt.hovering,void 0]]);const t=this.owner.getLook(St.timing);if(this.owner.backgroundColor.hasAffinity(i.Affinity.Intrinsic)){let e=this.owner.getLookOr(St.backgroundColor,null);null!==e&&(e=e.alpha(0)),this.owner.backgroundColor.setState(e,t,i.Affinity.Intrinsic)}}})],hs.prototype,"gesture",void 0);class cs extends Xn{constructor(t){super(t),this.initDisclosureButton()}initDisclosureButton(){this.addClass("disclosure-button"),this.display.setState("flex",i.Affinity.Intrinsic),this.justifyContent.setState("center",i.Affinity.Intrinsic),this.alignItems.setState("center",i.Affinity.Intrinsic),this.flexGrow.setState(1,i.Affinity.Intrinsic),this.flexShrink.setState(0,i.Affinity.Intrinsic),this.cursor.setState("pointer",i.Affinity.Intrinsic);const t=this.appendChild(_n,"icon");t.width.setState(24,i.Affinity.Intrinsic),t.height.setState(24,i.Affinity.Intrinsic),t.viewBox.setState("0 0 24 24",i.Affinity.Intrinsic);const e=t.appendChild("polygon","arrow");e.points.setState("0 4 -6 -2 -4.59 -3.41 0 1.17 4.59 -3.41 6 -2",i.Affinity.Intrinsic),e.transform.setState(o.Transform.translate(12,12).rotate(o.Angle.deg(0)),i.Affinity.Intrinsic)}get icon(){return this.getChild("icon")}get arrow(){return this.icon.getChild("arrow")}needsDisplay(t,e){return 0==(this.flags&pn.NeedsLayout)&&(t&=~pn.NeedsLayout),t}onLayout(t){super.onLayout(t);const e=this.disclosure.getPhase(),n=this.collapsedColor.value,s=this.expandedColor.value;if(null!==n&&null!==s&&this.arrow.fill.hasAffinity(i.Affinity.Intrinsic)){const t=n.interpolateTo(s);this.arrow.fill.setState(t(e),i.Affinity.Intrinsic)}const r=o.Transform.translate(12,12).rotate(o.Angle.deg(-180*e));this.arrow.transform.setState(r,i.Affinity.Intrinsic)}}u([zt({type:ft,inherits:!0,updateFlags:pn.NeedsLayout})],cs.prototype,"disclosure",void 0),u([zt({type:B,inherits:!0,look:St.color,updateFlags:pn.NeedsLayout})],cs.prototype,"collapsedColor",void 0),u([zt({type:B,inherits:!0,look:St.accentColor,updateFlags:pn.NeedsLayout})],cs.prototype,"expandedColor",void 0);class ds extends Xn{constructor(t){super(t),this.tokenState="expanded",this.onClickHead=this.onClickHead.bind(this),this.onClickBody=this.onClickBody.bind(this),this.onClickFoot=this.onClickFoot.bind(this),this.initToken()}initToken(){this.addClass("token"),this.position.setState("relative",i.Affinity.Intrinsic),this.height.setState(32,i.Affinity.Intrinsic),this.boxSizing.setState("content-box",i.Affinity.Intrinsic),this.userSelect.setState("none",i.Affinity.Intrinsic),this.shape.insertView()}initShape(t){t.addClass("shape"),t.setStyle("position","absolute"),t.setStyle("top","0"),t.setStyle("left","0"),this.head.insertView(t),this.headIcon.attachView(),this.body.insertView(t),this.foot.insertView(t),this.footIcon.attachView()}initHead(t){t.addClass("head"),t.fillRule.setState("evenodd",i.Affinity.Intrinsic),t.pointerEvents.setState("bounding-box",i.Affinity.Intrinsic),t.cursor.setState("pointer",i.Affinity.Intrinsic)}initHeadIcon(t){t.addClass("head-icon"),t.pointerEvents.setState("none",i.Affinity.Intrinsic)}initBody(t){t.addClass("body"),t.pointerEvents.setState("fill",i.Affinity.Intrinsic),t.cursor.setState("pointer",i.Affinity.Intrinsic)}initFoot(t){t.addClass("foot"),t.fillRule.setState("evenodd",i.Affinity.Intrinsic),t.pointerEvents.setState("bounding-box",i.Affinity.Intrinsic),t.cursor.setState("pointer",i.Affinity.Intrinsic)}initFootIcon(t){t.addClass("foot-icon"),t.pointerEvents.setState("none",i.Affinity.Intrinsic)}initLabelContainer(t){t.addClass("label"),t.display.setState("block",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.overflowX.setState("hidden",i.Affinity.Intrinsic),t.overflowY.setState("hidden",i.Affinity.Intrinsic),t.pointerEvents.setState("none",i.Affinity.Intrinsic)}initLabel(t){t.position.setState("absolute",i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.bottom.setState(0,i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic)}get expanded(){return"expanded"===this.tokenState||"expanding"===this.tokenState}get collapsed(){return"collapsed"===this.tokenState||"collapsing"===this.tokenState}get fillLook(){return St.accentColor}needsProcess(t,e){return 0!=(t&pn.NeedsLayout)&&(t|=pn.NeedsAnimate),t}onLayout(t){super.onLayout(t),this.layoutToken()}layoutToken(){const t=this.paddingTop.getStateOr(o.Length.zero()).pxValue(),e=this.paddingRight.getStateOr(o.Length.zero()).pxValue(),n=this.paddingBottom.getStateOr(o.Length.zero()).pxValue(),s=this.paddingLeft.getStateOr(o.Length.zero()).pxValue(),r=this.node.clientHeight,l=r-t-n,a=l/2,h=Math.sqrt(4+2*a*2),c=Math.asin(h/(a+2)),d=a/2,u=a,p=a/2,f=this.expandedPhase.value,g=this.icon.value,v=this.accessory.value;let w=0,y=0;const m=this.label.view;null!==m&&(w=m.node.clientWidth,y+=d+w+u);let b=0,C=0;null!==v&&(b=2*a,C+=b+p);let S=l;0!==f&&0!==y&&(S+=2+f*y);const A=S;0!==f&&0!==C&&(S+=2+f*C);const x=S+s+e,T=r;this.width.setState(S,i.Affinity.Intrinsic);const D=this.labelContainer.view;null!==D&&(D.display.setState(0!==f?"block":"none",i.Affinity.Intrinsic),D.left.setState(s+l+2+d,i.Affinity.Intrinsic),D.top.setState(t,i.Affinity.Intrinsic),D.width.setState(f*w,i.Affinity.Intrinsic),D.height.setState(l,i.Affinity.Intrinsic));const V=this.shape.view;null!==V&&(V.width.setState(x,i.Affinity.Intrinsic),V.height.setState(T,i.Affinity.Intrinsic),V.viewBox.setState("0 0 "+x+" "+T,i.Affinity.Intrinsic));const P=this.head.view;if(null!==P){const e=new oo;if(e.setPrecision(3),e.arc(s+a,t+a,a,-Math.PI/2,Math.PI/2*3),e.closePath(),null!==g&&!this.icon.embossed){const i=new so(e),n=new o.R2Box(s,t,s+l,t+l);g.render(i,n),this.headIcon.removeView()}P.d.setState(e.toString(),i.Affinity.Intrinsic)}const I=this.headIcon.view;if(null!==I)if(null!==g&&this.icon.embossed){const e=new oo;e.setPrecision(3);const n=new so(e),r=new o.R2Box(s,t,s+l,t+l);g.render(n,r),I.d.setState(e.toString(),i.Affinity.Intrinsic),this.headIcon.insertView()}else this.headIcon.removeView();const M=this.body.view;if(null!==M){const e=new oo;if(e.setPrecision(3),0!==f){const i=1-f;e.arc(s+a,t+a,a+2,-Math.PI/2+c,Math.PI/2-c),e.arc(s+A-a-2*i,t+a,a+2*i,Math.PI/2-i*c,-Math.PI/2+i*c,!0),e.closePath()}M.d.setState(e.toString(),i.Affinity.Intrinsic)}const L=this.foot.view;if(null!==L&&null!==v){const e=new oo;if(e.setPrecision(3),0!==f){const i=1-f;if(e.arc(s+A-a,t+a,a+2,-Math.PI/2+c,Math.PI/2-c),e.arc(s+S-a-2*i,t+a,a+2*i,Math.PI/2-i*c,-Math.PI/2+i*c,!0),e.closePath(),null!==v&&!this.accessory.embossed){const i=new so(e),n=new o.R2Box(s+A+2,t,s+A+2+2*a,t+2*a);v.render(i,n),this.headIcon.removeView()}}L.d.setState(e.toString(),i.Affinity.Intrinsic)}const k=this.footIcon.view;if(null!==k)if(null!==v&&this.accessory.embossed){const e=new oo;if(e.setPrecision(3),0!==f){const i=new so(e),n=new o.R2Box(s+A+2,t,s+A+2+l,t+l);v.render(i,n)}k.d.setState(e.toString(),i.Affinity.Intrinsic),this.footIcon.insertView()}else this.footIcon.removeView()}expand(t){"expanded"===this.tokenState&&1===this.expandedPhase.value||(t=void 0===t||!0===t?this.getLookOr(St.timing,!1):e.Timing.fromAny(t),"expanding"!==this.tokenState&&(this.willExpand(),this.onExpand()),!1!==t?1!==this.expandedPhase.value?this.expandedPhase.setState(1,t,i.Affinity.Intrinsic):setTimeout(this.didExpand.bind(this)):(this.expandedPhase.setState(1,i.Affinity.Intrinsic),this.didExpand()))}willExpand(){this.tokenState="expanding";const t=this.labelContainer.view;null!==t&&t.display.setState("block",i.Affinity.Intrinsic);const e=this.observers;for(let t=0,i=e.length;t<i;t+=1){const i=e[t];void 0!==i.tokenWillExpand&&i.tokenWillExpand(this)}}onExpand(){}didExpand(){this.tokenState="expanded",this.requireUpdate(pn.NeedsLayout);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.tokenDidExpand&&i.tokenDidExpand(this)}}collapse(t){"collapsed"===this.tokenState&&0===this.expandedPhase.value||(t=void 0===t||!0===t?this.getLookOr(St.timing,!1):e.Timing.fromAny(t),"collapsing"!==this.tokenState&&(this.willCollapse(),this.onCollapse()),!1!==t?0!==this.expandedPhase.value?this.expandedPhase.setState(0,t,i.Affinity.Intrinsic):setTimeout(this.didCollapse.bind(this)):(this.expandedPhase.setState(0,i.Affinity.Intrinsic),this.didCollapse()))}willCollapse(){this.tokenState="collapsing";const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.tokenWillCollapse&&i.tokenWillCollapse(this)}}onCollapse(){const t=this.label.view;null!==t&&t.node.blur()}didCollapse(){this.tokenState="collapsed",this.requireUpdate(pn.NeedsLayout);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.tokenDidCollapse&&i.tokenDidCollapse(this)}}toggle(t){const e=this.tokenState;"collapsed"===e||"collapsing"===e?this.expand(t):"expanded"!==e&&"expanding"!==e||this.collapse(t)}onClickHead(t){this.toggle();const e=this.label.view;null!==e&&this.expanded&&e.node.focus(),this.didPressHead()}didPressHead(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.tokenDidPressHead&&i.tokenDidPressHead(this)}}onClickBody(t){this.didPressBody()}didPressBody(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.tokenDidPressBody&&i.tokenDidPressBody(this)}}onClickFoot(t){this.didPressFoot()}didPressFoot(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.tokenDidPressFoot&&i.tokenDidPressFoot(this)}}init(t){super.init(t)}}u([i.Animator({type:Number,value:1,updateFlags:pn.NeedsLayout,didTransition(t){const e=this.owner.tokenState;"expanding"===e&&1===t?this.owner.didExpand():"collapsing"===e&&0===t&&this.owner.didCollapse()}})],ds.prototype,"expandedPhase",void 0),u([gn({key:!0,type:_n,binds:!0,didAttachView(t){this.owner.initShape(t)}})],ds.prototype,"shape",void 0),u([gn({key:!0,type:_n.forTag("path"),observes:!0,didAttachView(t){this.owner.initHead(t),this.owner.headGesture.setView(t)},willDetachView(t){this.owner.headGesture.setView(null)},viewDidMount(t){t.on("click",this.owner.onClickHead)},viewWillUnmount(t){t.off("click",this.owner.onClickHead)},viewDidApplyTheme(t,e,n,o){o.fill.setState(t.getOr(this.owner.fillLook,e,null),n,i.Affinity.Intrinsic);const s=this.owner.headIcon.view;if(null!==s&&s.fill.hasAffinity(i.Affinity.Intrinsic)){const o=t.getOr(this.owner.fillLook,e.updated(Mt.embossed,1),null);s.fill.setState(o,n,i.Affinity.Intrinsic)}}})],ds.prototype,"head",void 0),u([Ji({didStartHovering(){const t=this.view;t.modifyMood(Mt.default,[[Mt.hovering,1]]);const e=t.getLook(St.timing);t.fill.setState(t.getLookOr(this.owner.fillLook,null),e,i.Affinity.Intrinsic);const n=this.owner.headIcon.view;if(null!==n&&n.fill.hasAffinity(i.Affinity.Intrinsic)){const o=t.getLookOr(this.owner.fillLook,t.mood.getValue().updated(Mt.embossed,1),null);n.fill.setState(o,e,i.Affinity.Intrinsic)}},didStopHovering(){const t=this.view;t.modifyMood(Mt.default,[[Mt.hovering,void 0]]);const e=t.getLook(St.timing);t.fill.setState(t.getLookOr(this.owner.fillLook,null),e,i.Affinity.Intrinsic);const n=this.owner.headIcon.view;if(null!==n&&n.fill.hasAffinity(i.Affinity.Intrinsic)){const o=t.getLookOr(this.owner.fillLook,t.mood.getValue().updated(Mt.embossed,1),null);n.fill.setState(o,e,i.Affinity.Intrinsic)}},didBeginPress(t,e){"mouse"!==t.inputType&&this.beginHover(t,e)},didMovePress(t,e){t.isRunaway()&&this.cancelPress(t,e)},didEndPress(t,e){"mouse"===t.inputType&&this.view.clientBounds.contains(t.x,t.y)||this.endHover(t,e)},didCancelPress(t,e){"mouse"===t.inputType&&this.view.clientBounds.contains(t.x,t.y)||this.endHover(t,e)}})],ds.prototype,"headGesture",void 0),u([gn({key:!0,type:_n.forTag("path"),didAttachView(t){this.owner.initHeadIcon(t)},insertChild(t,e,i,n){const o=this.owner.shape.view;null!==o&&o.insertChild(e,this.owner.body.view,n)}})],ds.prototype,"headIcon",void 0),u([i.Property({implements:!0,type:Object,value:null,updateFlags:pn.NeedsLayout,embossed:!0})],ds.prototype,"icon",void 0),u([gn({key:!0,type:_n.forTag("path"),observes:!0,didAttachView(t){this.owner.initBody(t),this.owner.bodyGesture.setView(t)},willDetachView(t){this.owner.bodyGesture.setView(null)},viewDidMount(t){t.on("click",this.owner.onClickBody)},viewWillUnmount(t){t.off("click",this.owner.onClickBody)},viewDidApplyTheme(t,e,n,o){o.fill.setState(t.getOr(this.owner.fillLook,e,null),n,i.Affinity.Intrinsic);const s=this.owner.label.view;null!==s&&s.color.hasAffinity(i.Affinity.Intrinsic)&&s.color.setState(t.getOr(St.backgroundColor,e,null),n,i.Affinity.Intrinsic)}})],ds.prototype,"body",void 0),u([Ji({didStartHovering(){const t=this.view;t.modifyMood(Mt.default,[[Mt.hovering,1]]);const e=t.getLook(St.timing);t.fill.setState(t.getLookOr(this.owner.fillLook,null),e,i.Affinity.Intrinsic);const n=this.owner.label.view;null!==n&&n.color.hasAffinity(i.Affinity.Intrinsic)&&n.color.setState(t.getLookOr(St.backgroundColor,null),e,i.Affinity.Intrinsic)},didStopHovering(){const t=this.view;t.modifyMood(Mt.default,[[Mt.hovering,void 0]]);const e=t.getLook(St.timing);t.fill.setState(t.getLookOr(this.owner.fillLook,null),e,i.Affinity.Intrinsic);const n=this.owner.label.view;null!==n&&n.color.hasAffinity(i.Affinity.Intrinsic)&&n.color.setState(t.getLookOr(St.backgroundColor,null),e,i.Affinity.Intrinsic)},didBeginPress(t,e){"mouse"!==t.inputType&&this.beginHover(t,e)},didMovePress(t,e){t.isRunaway()&&this.cancelPress(t,e)},didEndPress(t,e){"mouse"===t.inputType&&this.view.clientBounds.contains(t.x,t.y)||this.endHover(t,e)},didCancelPress(t,e){"mouse"===t.inputType&&this.view.clientBounds.contains(t.x,t.y)||this.endHover(t,e)}})],ds.prototype,"bodyGesture",void 0),u([gn({key:!0,type:_n.forTag("path"),observes:!0,didAttachView(t){this.owner.initFoot(t),this.owner.footGesture.setView(t)},willDetachView(t){this.owner.footGesture.setView(null)},viewDidMount(t){t.on("click",this.owner.onClickFoot)},viewWillUnmount(t){t.off("click",this.owner.onClickFoot)},viewDidApplyTheme(t,e,n,o){o.fill.setState(t.getOr(this.owner.fillLook,e,null),n,i.Affinity.Intrinsic);const s=this.owner.footIcon.view;if(null!==s&&s.fill.hasAffinity(i.Affinity.Intrinsic)){const o=t.getOr(this.owner.fillLook,e.updated(Mt.embossed,1),null);s.fill.setState(o,n,i.Affinity.Intrinsic)}}})],ds.prototype,"foot",void 0),u([Ji({didStartHovering(){const t=this.view;t.modifyMood(Mt.default,[[Mt.hovering,1]]);const e=t.getLook(St.timing);t.fill.setState(t.getLookOr(this.owner.fillLook,null),e,i.Affinity.Intrinsic);const n=this.owner.footIcon.view;if(null!==n&&n.fill.hasAffinity(i.Affinity.Intrinsic)){const o=t.getLookOr(this.owner.fillLook,t.mood.getValue().updated(Mt.embossed,1),null);n.fill.setState(o,e,i.Affinity.Intrinsic)}},didStopHovering(){const t=this.view;t.modifyMood(Mt.default,[[Mt.hovering,void 0]]);const e=t.getLook(St.timing);t.fill.setState(t.getLookOr(this.owner.fillLook,null),e,i.Affinity.Intrinsic);const n=this.owner.footIcon.view;if(null!==n&&n.fill.hasAffinity(i.Affinity.Intrinsic)){const o=t.getLookOr(this.owner.fillLook,t.mood.getValue().updated(Mt.embossed,1),null);n.fill.setState(o,e,i.Affinity.Intrinsic)}},didBeginPress(t,e){"mouse"!==t.inputType&&this.beginHover(t,e)},didMovePress(t,e){t.isRunaway()&&this.cancelPress(t,e)},didEndPress(t,e){"mouse"===t.inputType&&this.view.clientBounds.contains(t.x,t.y)||this.endHover(t,e)},didCancelPress(t,e){"mouse"===t.inputType&&this.view.clientBounds.contains(t.x,t.y)||this.endHover(t,e)}})],ds.prototype,"footGesture",void 0),u([gn({key:!0,type:_n.forTag("path"),didAttachView(t){this.owner.initFootIcon(t)},insertChild(t,e,i,n){const o=this.owner.shape.view;null!==o&&o.appendChild(e,n)}})],ds.prototype,"footIcon",void 0),u([i.Property({implements:!0,type:Object,value:null,updateFlags:pn.NeedsLayout,init(){this.embossed=!0}})],ds.prototype,"accessory",void 0),u([gn({key:!0,type:Xn,binds:!0,didAttachView(t){this.owner.initLabelContainer(t)}})],ds.prototype,"labelContainer",void 0),u([gn({key:!0,type:Xn,didAttachView(t){if(null===t.parent){this.owner.labelContainer.insertView();const e=this.owner.labelContainer.view;null!==e&&e.appendChild(t)}this.owner.initLabel(t)}})],ds.prototype,"label",void 0);class us extends ds{constructor(t){super(t),this.onInputUpdate=this.onInputUpdate.bind(this),this.onInputChange=this.onInputChange.bind(this),this.onInputKey=this.onInputKey.bind(this)}initToken(){this.stylesheet.insertView(),super.initToken(),this.addClass("input-token"),this.label.attachView()}initStylesheet(t){const e=t.sheet;if(null!==e){const t=us.PlaceholderRule.create(e);e.setFastener("placeholder",t)}}initLabel(t){super.initLabel(t),t.paddingTop.setState(0,i.Affinity.Intrinsic),t.paddingRight.setState(0,i.Affinity.Intrinsic),t.paddingBottom.setState(0,i.Affinity.Intrinsic),t.paddingLeft.setState(0,i.Affinity.Intrinsic),t.borderTopStyle.setState("none",i.Affinity.Intrinsic),t.borderRightStyle.setState("none",i.Affinity.Intrinsic),t.borderBottomStyle.setState("none",i.Affinity.Intrinsic),t.borderLeftStyle.setState("none",i.Affinity.Intrinsic),t.boxSizing.setState("border-box",i.Affinity.Intrinsic),t.backgroundColor.setState(B.transparent(),i.Affinity.Intrinsic),t.appearance.setState("none",i.Affinity.Intrinsic),t.outlineStyle.setState("none",i.Affinity.Intrinsic),t.pointerEvents.setState("auto",i.Affinity.Intrinsic)}get placeholderLook(){return St.neutralColor}onApplyTheme(t,e,n){super.onApplyTheme(t,e,n);const o=this.stylesheet.view;if(null!==o){const s=o.getFastener("placeholder",zn);null!==s&&s.color.setState(t.getOr(this.placeholderLook,e,null),n,i.Affinity.Intrinsic)}const s=this.label.view;null!==s&&s.font(t.getOr(St.font,e,null),!1,i.Affinity.Intrinsic)}onInputUpdate(t){const e=this.label.view;null!==e&&this.didUpdateInput(e)}didUpdateInput(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.tokenDidUpdateInput&&n.tokenDidUpdateInput(t,this)}}onInputChange(t){const e=this.label.view;null!==e&&this.didChangeInput(e)}didChangeInput(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.tokenDidChangeInput&&n.tokenDidChangeInput(t,this)}}onInputKey(t){const e=this.label.view;null!==e&&"Enter"===t.key&&this.didAcceptInput(e)}didAcceptInput(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.tokenDidAcceptInput&&n.tokenDidAcceptInput(t,this)}}init(t){super.init(t)}}us.PlaceholderRule=zn.define("PlaceholderRule",{css:"::placeholder {}"}),u([gn({key:!0,type:Zn,binds:!0,observes:!0,viewDidMount(t){this.owner.initStylesheet(t)}})],us.prototype,"stylesheet",void 0),u([gn({type:Xn.forTag("input"),observes:!0,didAttachView(t){if(null===t.parent){this.owner.labelContainer.insertView();const e=this.owner.labelContainer.view;null!==e&&e.appendChild(t)}this.owner.initLabel(t)},viewDidMount(t){t.on("input",this.owner.onInputUpdate),t.on("change",this.owner.onInputChange),t.on("keydown",this.owner.onInputKey)},viewWillUnmount(t){t.off("input",this.owner.onInputUpdate),t.off("change",this.owner.onInputChange),t.off("keydown",this.owner.onInputKey)}})],us.prototype,"label",void 0);class ps{constructor(t,e,i,n,o,s,r,l,a,h,c){this.key=t,this.grow=e,this.shrink=i,this.basis=n,this.optional=o,this.persistent=s,this.textColor=r,this.width=l,this.left=a,this.right=h,this.hidden=c}withFlex(t,e,i){return i=void 0!==i?o.Length.fromAny(i):this.basis,this.copy(this.key,t,e,i,this.optional,this.persistent,this.textColor,this.width,this.left,this.right,this.hidden)}asOptional(t){return this.copy(this.key,this.grow,this.shrink,this.basis,t,this.persistent,this.textColor,this.width,this.left,this.right,this.hidden)}asPersistent(t){return this.copy(this.key,this.grow,this.shrink,this.basis,this.optional,t,this.textColor,this.width,this.left,this.right,this.hidden)}withTextColor(t){return null===t||t instanceof St||(t=B.fromAny(t)),this.copy(this.key,this.grow,this.shrink,this.basis,this.optional,this.persistent,t,this.width,this.left,this.right,this.hidden)}asHidden(t){return this.copy(this.key,this.grow,this.shrink,this.basis,this.optional,this.persistent,this.textColor,this.width,this.left,this.right,t)}resized(t,e,i,n){return null!==t&&(t=o.Length.fromAny(t)),null!==e&&(e=o.Length.fromAny(e)),null!==i&&(i=o.Length.fromAny(i)),void 0===n&&(n=this.hidden),this.copy(this.key,this.grow,this.shrink,this.basis,this.optional,this.persistent,this.textColor,t,e,i,n)}copy(t,e,i,n,o,s,r,l,a,h,c){return new ps(t,e,i,n,o,s,r,l,a,h,c)}equivalentTo(t,i){return this===t||t instanceof ps&&(this.key===t.key&&this.grow===t.grow&&this.shrink===t.shrink&&this.basis.equivalentTo(t.basis,i)&&this.optional===t.optional&&this.persistent===t.persistent&&e.Equivalent(this.textColor,t.textColor,i))}equals(t){return this===t||t instanceof ps&&(this.key===t.key&&this.grow===t.grow&&this.shrink===t.shrink&&this.basis.equals(t.basis)&&this.optional===t.optional&&this.persistent===t.persistent&&e.Equals(this.textColor,t.textColor)&&e.Equals(this.width,t.width)&&e.Equals(this.left,t.left)&&e.Equals(this.right,t.right)&&this.hidden===t.hidden)}debug(t){return t=t.write("ColLayout").write(46).write("create").write(40).debug(this.key).write(", ").debug(this.grow).write(", ").debug(this.shrink).write(", ").debug(this.basis).write(41),this.optional&&(t=t.write(46).write("asOptional").write(40).debug(this.optional).write(41)),this.persistent&&(t=t.write(46).write("asPersistent").write(40).debug(this.persistent).write(41)),this.textColor&&(t=t.write(46).write("withTextColor").write(40).debug(this.textColor).write(41)),(null!==this.width||null!==this.left||null!==this.right||this.hidden)&&(t=t.write(46).write("resized").write(40).debug(this.width).write(", ").debug(this.left).write(", ").debug(this.right).write(", ").debug(this.hidden).write(41)),t}toString(){return s.Format.debug(this)}static create(t,e,i,n,s,r,l){return void 0===e&&(e=0),void 0===i&&(i=1),n=void 0!==n?o.Length.fromAny(n):o.Length.zero(),void 0===s&&(s=!1),void 0===r&&(r=!1),void 0===l&&(l=null),null===l||l instanceof St||(l=B.fromAny(l)),new ps(t,e,i,n,s,r,l,null,null,null,!1)}static fromAny(t){if(null==t||t instanceof ps)return t;if("object"==typeof t&&null!==t)return ps.fromInit(t);throw new TypeError(""+t)}static fromInit(t){let e=t.key;void 0===e&&(e="");let i=t.grow;void 0===i&&(i=0);let n=t.shrink;void 0===n&&(n=1);let s=t.basis;s=void 0!==s?o.Length.fromAny(s):o.Length.zero();let r=t.optional;void 0===r&&(r=!1);let l=t.persistent;void 0===l&&(l=!1);let a=t.textColor;void 0===a&&(a=null),null===a||a instanceof St||(a=B.fromAny(a));let h=t.width;h=null!=h?o.Length.fromAny(h):null;let c=t.left;c=null!=c?o.Length.fromAny(c):null;let d=t.right;d=null!=d?o.Length.fromAny(d):null;let u=t.hidden;return void 0===u&&(u=!1),new ps(e,i,n,s,r,l,a,h,c,d,u)}}class fs{constructor(t,e,i,n,o){this.width=t,this.left=e,this.right=i,this.colSpacing=n,this.cols=o}getCol(t){const e=this.cols;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];if(t===n.key)return n}return null}resized(t,i,n,s){if(t=o.Length.fromAny(t),void 0===i?i=this.left:null!==i&&(i=o.Length.fromAny(i)),void 0===n?n=this.right:null!==n&&(n=o.Length.fromAny(n)),void 0===s?s=this.colSpacing:null!==s&&(s=o.Length.fromAny(s)),e.Equals(this.width,t)&&e.Equals(this.left,i)&&e.Equals(this.right,n)&&e.Equals(this.colSpacing,s))return this;{const e=this.cols,o=e.length,r=new Array(o),l=t.pxValue(),a=null!==i?i.pxValue(l):0,h=null!==n?n.pxValue(l):0,c=null!==s?s.pxValue(l):0;let d=0,u=0,p=0,f=a+h,g=a;for(let t=0;t<o;t+=1){0!==t&&(f+=c,g+=c);const i=e[t],n=i.basis.pxValue(l);r[t]=i.resized(n,g,l-n-g,!1),d+=i.grow,u+=i.shrink,i.optional&&(p+=1),f+=n,g+=n}if(f>l&&p>0){let t=o-1;for(;t>=0&&p>0;){const e=r[t],i=e.width.pxValue();if(e.optional&&(r[t]=e.resized(0,g,l-g,!0),d-=e.grow,u-=e.shrink,p-=1,f-=i),g-=i,0!==t&&(f-=c,g-=c),f<=l)break;t-=1}for(t+=1;t<o;){const e=r[t];if(!e.optional){f+=c,g+=c;const i=e.basis.pxValue(l);r[t]=e.resized(i,g,l-i-g),g+=i}t+=1}}if(f<l&&d>0){const t=l-f;let e=a,i=0;for(let n=0;n<o;n+=1){const o=r[n];if(o.hidden)r[n]=o.resized(0,e+c,l-e-c);else{0!==i&&(e+=c);const s=o.basis.pxValue(l)+t*(o.grow/d);r[n]=o.resized(s,e,l-s-e),e+=s,i+=1}}}else if(f>l&&u>0){const t=f-l;let e=a,i=0;for(let n=0;n<o;n+=1){const o=r[n];if(o.hidden)r[n]=o.resized(0,e+c,l-e-c);else{0!==i&&(e+=c);const s=o.basis.pxValue(l)-t*(o.shrink/u);r[n]=o.resized(s,e,l-s-e),e+=s,i+=1}}}return new fs(t,i,n,s,r)}}equivalentTo(t,e){if(this===t)return!0;if(t instanceof fs){const i=this.cols,n=t.cols,o=i.length;if(o===n.length){for(let t=0;t<o;t+=1)if(!i[t].equivalentTo(n[t],e))return!1;return!0}}return!1}equals(t){return this===t||t instanceof fs&&(e.Equals(this.width,t.width)&&e.Equals(this.left,t.left)&&e.Equals(this.right,t.right)&&e.Equals(this.colSpacing,t.colSpacing)&&e.Arrays.equal(this.cols,t.cols))}debug(t){t=t.write("TableLayout").write(46).write("of").write(40);for(let e=0,i=this.cols.length;e<i;e+=1)0!==e&&(t=t.write(", ")),t=t.debug(this.cols[e]);return t=t.write(41),null===this.width&&null===this.left&&null===this.right&&null===this.colSpacing||(t=t.write(46).write("resized").write(40).debug(this.width).write(", ").debug(this.left).write(", ").debug(this.right).write(", ").debug(this.colSpacing).write(41)),t}toString(){return s.Format.debug(this)}static of(...t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1)i[n]=ps.fromAny(t[n]);return new fs(null,null,null,null,i)}static create(t){return new fs(null,null,null,null,t)}static fromAny(t){if(null==t||t instanceof fs)return t;if("object"==typeof t&&null!==t)return fs.fromInit(t);throw new TypeError(""+t)}static fromInit(t){let e=t.width;e=null!=e?o.Length.fromAny(e):null;let i=t.left;i=null!=i?o.Length.fromAny(i):null;let n=t.right;n=null!=n?o.Length.fromAny(n):null;let s=t.colSpacing;s=null!=s?o.Length.fromAny(s):null;const r=t.cols.length,l=new Array(r);for(let e=0;e<r;e+=1)l[e]=ps.fromAny(t.cols[e]);return new fs(e,i,n,s,l)}}class gs extends Xn{constructor(t){super(t),this.initCell()}initCell(){this.addClass("cell"),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic)}onPress(t,e){}didPress(t,e){this.callObservers("viewDidPress",t,e,this)}onLongPress(t){}didLongPress(t){this.callObservers("viewDidLongPress",t,this)}}class vs extends gs{initCell(){super.initCell(),this.addClass("cell-text")}}u([gn({implements:!0,key:!0,type:Xn,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachContent",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachContent",t,this.owner)},create(t){const e=Xn.fromTag("span");return e.alignSelf.setState("center",i.Affinity.Intrinsic),e.whiteSpace.setState("nowrap",i.Affinity.Intrinsic),e.textOverflow.setState("ellipsis",i.Affinity.Intrinsic),e.overflowX.setState("hidden",i.Affinity.Intrinsic),e.overflowY.setState("hidden",i.Affinity.Intrinsic),void 0!==t&&e.text(t),e},fromAny(t){return"string"==typeof t?this.create(t):Xn.fromAny(t)}})],vs.prototype,"content",void 0);class ws extends gs{constructor(t){super(t),this.initSvg()}initCell(){super.initCell(),this.addClass("cell-icon")}initSvg(){const t=this.createSvgView();null!==t&&this.setChild("svg",t)}createSvgView(){return Eo.create()}get svgView(){const t=this.getChild("svg");return t instanceof Eo?t:null}onInsertChild(t,e){super.onInsertChild(t,e),"svg"===t.key&&t instanceof Eo&&this.onInsertSvg(t)}onInsertSvg(t){t.xAlign.setInherits(!0),t.yAlign.setInherits(!0),t.iconWidth.setInherits(!0),t.iconHeight.setInherits(!0),t.iconColor.setInherits(!0),t.graphics.setInherits(!0),t.setStyle("position","absolute")}onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),!this.graphics.inherited){const o=this.graphics.value;if(o instanceof xo){const s=o.withTheme(t,e);this.graphics.setState(s,!!o.isThemed()&&n,i.Affinity.Reflexive)}}}onResize(t){super.onResize(t),this.requireUpdate(pn.NeedsLayout)}needsDisplay(t,e){return 0==(this.flags&pn.NeedsLayout)&&(t&=~pn.NeedsLayout),t}onLayout(t){super.onLayout(t),this.layoutIcon()}layoutIcon(){const t=this.svgView;if(null!==t&&(t.width.hasAffinity(i.Affinity.Intrinsic)||t.height.hasAffinity(i.Affinity.Intrinsic)||t.viewBox.hasAffinity(i.Affinity.Intrinsic))){let e=this.width.value;e=e instanceof o.Length?e.pxValue():this.node.offsetWidth;let n=this.height.value;n=n instanceof o.Length?n.pxValue():this.node.offsetHeight,t.width.setState(e,i.Affinity.Intrinsic),t.height.setState(n,i.Affinity.Intrinsic),t.viewBox.setState("0 0 "+e+" "+n,i.Affinity.Intrinsic)}}}u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsLayout})],ws.prototype,"xAlign",void 0),u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsLayout})],ws.prototype,"yAlign",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsLayout})],ws.prototype,"iconWidth",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsLayout})],ws.prototype,"iconHeight",void 0),u([zt({type:B,value:null,updateFlags:pn.NeedsLayout,didSetValue(t,e){if(null!==t){const e=this.owner.graphics.value;if(e instanceof To){const n=e.withFillColor(t);this.owner.graphics.setState(n,i.Affinity.Reflexive)}}}})],ws.prototype,"iconColor",void 0),u([zt({extends:Oo,type:Object,value:null,updateFlags:pn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetGraphics",t,e,this.owner)},didSetValue(t,e){this.owner.requireUpdate(pn.NeedsRasterize|pn.NeedsComposite),this.owner.callObservers("viewDidSetGraphics",t,e,this.owner)}})],ws.prototype,"graphics",void 0);class ys extends gs{initCell(){super.initCell(),this.addClass("cell-disclosure"),this.button.insertView()}didPress(t,e){t.preventDefault();const i=this.disclosure.superFastener;i instanceof Jt&&i.toggle(),super.didPress(t,e)}}u([zt({type:ft,inherits:!0})],ys.prototype,"disclosure",void 0),u([gn({key:!0,type:cs,binds:!0})],ys.prototype,"button",void 0);class ms extends S{}class bs extends ms{}u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetContent",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetContent",t,e,this.owner)}})],bs.prototype,"content",void 0);class Cs extends ms{}u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetIcon",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetIcon",t,e,this.owner)}})],Cs.prototype,"icon",void 0);class Ss extends Zo{static fromTrait(t){return t instanceof bs?new As:t instanceof Cs?new xs:new Ss}}u([$o({traitType:ms,willAttachTrait(t){this.owner.callObservers("controllerWillAttachCellTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachCellTrait",t,this.owner)},viewType:gs,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachCellView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachCellView",t,this.owner)},viewDidPress(t,e,i){this.owner.callObservers("controllerDidPressCellView",t,e,i,this.owner)},viewDidLongPress(t,e){this.owner.callObservers("controllerDidLongPressCellView",t,e,this.owner)}})],Ss.prototype,"cell",void 0);class As extends Ss{createContentView(t,e){return"function"==typeof t?t(e):t}setContentView(t,e){const i=this.cell.view;if(null!==i){const n=null!==t?this.createContentView(t,e):null;i.content.setView(n)}}}u([$o({extends:!0,traitType:bs,observesTrait:!0,initTrait(t){this.owner.setContentView(t.content.value,t)},deinitTrait(t){this.owner.setContentView(null,t)},traitDidSetContent(t,e,i){this.owner.setContentView(t,i)},viewType:vs,observesView:!0,initView(t){this.owner.content.setView(t.content.view);const e=this.trait;null!==e&&this.owner.setContentView(e.content.value,e)},deinitView(t){this.owner.content.setView(null)},viewWillAttachContent(t){this.owner.content.setView(t)},viewDidDetachContent(t){this.owner.content.setView(null)}})],As.prototype,"cell",void 0),u([gn({type:Xn,willAttachView(t){this.owner.callObservers("controllerWillAttachCellContentView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachCellContentView",t,this.owner)}})],As.prototype,"content",void 0);class xs extends Ss{setIcon(t){const e=this.cell.view;null!==e&&e.graphics.setState(t)}}u([$o({extends:!0,traitType:Cs,observesTrait:!0,initTrait(t){this.owner.setIcon(t.icon.value)},deinitTrait(t){this.owner.setIcon(null)},traitDidSetIcon(t,e){this.owner.setIcon(t)},viewType:ws,observesView:!0,initView(t){const e=this.trait;null!==e&&this.owner.setIcon(e.icon.value)},viewWillSetGraphics(t,e){this.owner.callObservers("controllerWillSetCellIcon",t,e,this.owner)},viewDidSetGraphics(t,e){this.owner.callObservers("controllerDidSetCellIcon",t,e,this.owner)}})],xs.prototype,"cell",void 0);class Ts extends Xn{constructor(t){super(t),this.initLeaf()}initLeaf(){this.addClass("leaf"),this.position.setState("relative",i.Affinity.Intrinsic),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic);const t=this.highlight.getPhase(),e=this.hover.getPhase(),n=Math.max(t,e);this.modifyMood(Mt.default,[[Mt.transparent,1-n],[Mt.hovering,e*(1-t)],[Mt.selected,t]],!1)}getCell(t,e){void 0===e&&(e=gs);const i=this.getChild(t);return i instanceof e?i:null}getOrCreateCell(t,e){let i=this.getChild(t,e);return null===i&&(i=e.create(),this.setChild(t,i)),i}setCell(t,e){this.setChild(t,e)}onLayout(t){super.onLayout(t),this.layoutLeaf()}layoutLeaf(){const t=this.rowHeight.value;null!==t&&this.height.setState(t,i.Affinity.Intrinsic)}displayChildren(t,e,i){0!=(t&pn.NeedsLayout)?this.layoutChildViews(t,e,i):super.displayChildren(t,e,i)}layoutChildViews(t,e,n){const o=this.layout.value,s=this.height.state,r=this.stretch.getPhaseOr(1);super.displayChildren(t,e,(function(t,e,l){if(t instanceof gs){const e=t.key,n=null!==o&&void 0!==e?o.getCol(e):null;if(null!==n){t.display.setState(n.hidden?"none":"flex",i.Affinity.Intrinsic),t.left.setState(n.left,i.Affinity.Intrinsic),t.width.setState(n.width,i.Affinity.Intrinsic),t.height.setState(s,i.Affinity.Intrinsic);const e=n.textColor;e instanceof St?t.color.setLook(e,i.Affinity.Intrinsic):t.color.setState(e,i.Affinity.Intrinsic),n.persistent||t.opacity.setState(r,i.Affinity.Intrinsic)}else t.display.setState("none",i.Affinity.Intrinsic),t.left.setState(null,i.Affinity.Intrinsic),t.width.setState(null,i.Affinity.Intrinsic),t.height.setState(null,i.Affinity.Intrinsic)}n.call(this,t,e,l)}))}glow(t){if(t.detail instanceof os&&(t.detail.fade(t.x,t.y),t.detail=void 0),void 0===t.detail){const e="mouse"===t.inputType?0:100;t.detail=this.prependChild(os),t.detail.glow(t.x,t.y,void 0,e)}}}u([i.Property({type:fs,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Ts.prototype,"layout",void 0),u([i.Property({type:Number,inherits:!0,value:0,updateFlags:pn.NeedsLayout})],Ts.prototype,"depth",void 0),u([$t({type:o.Length,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Ts.prototype,"rowSpacing",void 0),u([$t({type:o.Length,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Ts.prototype,"rowHeight",void 0),u([zt({type:ft,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Ts.prototype,"stretch",void 0),u([i.Property({type:Boolean,inherits:!0,value:!1})],Ts.prototype,"hovers",void 0),u([zt({type:ct,value:ct.unfocused(),didSetValue(t,e){const n=this.owner.highlight.getPhase(),o=t.phase,s=Math.max(n,o);this.owner.modifyMood(Mt.default,[[Mt.transparent,1-s],[Mt.hovering,o*(1-n)],[Mt.selected,n]],!1),0!==s?this.owner.backgroundColor.setLook(St.backgroundColor,i.Affinity.Intrinsic):(this.owner.backgroundColor.setLook(null,i.Affinity.Intrinsic),this.owner.backgroundColor.setState(null,i.Affinity.Intrinsic))}})],Ts.prototype,"hover",void 0),u([zt({type:ct,value:ct.unfocused(),willFocus(){this.owner.callObservers("viewWillHighlight",this.owner)},didFocus(){this.owner.callObservers("viewDidHighlight",this.owner)},willUnfocus(){this.owner.callObservers("viewWillUnhighlight",this.owner)},didUnfocus(){this.owner.callObservers("viewDidUnhighlight",this.owner)},didSetValue(t,e){const n=t.phase,o=this.owner.hover.getPhase(),s=Math.max(n,o);this.owner.modifyMood(Mt.default,[[Mt.transparent,1-s],[Mt.hovering,o*(1-n)],[Mt.selected,n]],!1),0!==s?this.owner.backgroundColor.setLook(St.backgroundColor,i.Affinity.Intrinsic):(this.owner.backgroundColor.setLook(null,i.Affinity.Intrinsic),this.owner.backgroundColor.setState(null,i.Affinity.Intrinsic))}})],Ts.prototype,"highlight",void 0),u([vn({type:gs,binds:!0,initView(t){t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.width.setState(0,i.Affinity.Intrinsic),t.height.setState(this.owner.height.state,i.Affinity.Intrinsic)},willAttachView(t,e){this.owner.callObservers("viewWillAttachCell",t,e,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachCell",t,this.owner)}})],Ts.prototype,"cells",void 0),u([i.Property({type:Boolean,inherits:!0,value:!0})],Ts.prototype,"glows",void 0),u([Ji({self:!0,didBeginPress(t,e){this.owner.glows.value&&this.owner.glow(t)},didMovePress(t,e){t.isRunaway()?this.cancelPress(t,e):this.owner.clientBounds.contains(t.x,t.y)||(t.clearHoldTimer(),this.beginHover(t,e),t.detail instanceof os&&(t.detail.fade(t.x,t.y),t.detail=void 0))},didEndPress(t,e){this.owner.clientBounds.contains(t.x,t.y)?t.detail instanceof os&&t.detail.pulse(t.x,t.y):(this.endHover(t,e),t.detail instanceof os&&(t.detail.fade(t.x,t.y),t.detail=void 0))},didCancelPress(t,e){this.owner.clientBounds.contains(t.x,t.y)||this.endHover(t,e),t.detail instanceof os&&(t.detail.fade(t.x,t.y),t.detail=void 0)},didStartHovering(){this.owner.hovers.value&&this.owner.hover.focus(!1),this.owner.callObservers("viewDidEnter",this.owner)},didStopHovering(){this.owner.hovers.value&&this.owner.hover.unfocus(),this.owner.callObservers("viewDidLeave",this.owner)},didPress(t,e){if(this.owner.clientBounds.contains(t.x,t.y)){if(!t.defaultPrevented){let i=t.target;for(;null!==i&&i!==this.owner.node;){const n=i.view;if(n instanceof gs){n.onPress(t,e),n.didPress(t,e);break}i=i instanceof Node?i.parentNode:null}}t.defaultPrevented||this.owner.callObservers("viewDidPress",t,e,this.owner)}},didLongPress(t){if(!t.defaultPrevented){let e=t.target;for(;null!==e&&e!==this.owner.node;){const i=e.view;if(i instanceof gs){i.onLongPress(t),i.didLongPress(t);break}e=e instanceof Node?e.parentNode:null}}t.defaultPrevented||this.owner.callObservers("viewDidLongPress",t,this.owner)}})],Ts.prototype,"gesture",void 0);class Ds extends S{getCell(t,e){void 0===e&&(e=ms);const i=this.getTrait(t);return i instanceof e?i:null}getOrCreateCell(t,e){let i=this.getTrait(t,e);return null===i&&(i=e.create(),this.setTrait(t,i)),i}setCell(t,e){this.setTrait(t,e)}startConsumingCells(){const t=this.cells.traits;for(const e in t){t[e].consume(this)}}stopConsumingCells(){const t=this.cells.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingCells()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingCells()}}u([T({type:ms,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachCell",t,e,this.owner)},didAttachTrait(t,e){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachCell",t,this.owner)},detectModel:t=>t.getTrait(ms)})],Ds.prototype,"cells",void 0);class Vs extends Zo{getCellTrait(t,e){const i=this.leaf.trait;return null!==i?i.getCell(t,e):null}getOrCreateCellTrait(t,e){const i=this.leaf.trait;if(null===i)throw new Error("no leaf trait");return i.getOrCreateCell(t,e)}setCellTrait(t,e){const i=this.leaf.trait;if(null===i)throw new Error("no leaf trait");i.setCell(t,e)}getCellView(t,e){const i=this.leaf.view;return null!==i?i.getCell(t,e):null}getOrCreateCellView(t,e){let i=this.leaf.view;if(null===i){if(i=this.leaf.createView(),null===i)throw new Error("no leaf view");this.leaf.setView(i)}return i.getOrCreateCell(t,e)}setCellView(t,e){let i=this.leaf.view;if(null===i){if(i=this.leaf.createView(),null===i)throw new Error("no leaf view");this.leaf.setView(i)}i.setCell(t,e)}}u([$o({traitType:Ds,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachLeafTrait",t,this.owner)},didAttachTrait(t){const e=t.cells.traits;for(const t in e){const i=e[t];this.owner.cells.addTraitController(i)}},willDetachTrait(t){const e=t.cells.traits;for(const t in e){const i=e[t];this.owner.cells.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachLeafTrait",t,this.owner)},traitWillAttachCell(t,e){this.owner.cells.addTraitController(t,e)},traitDidDetachCell(t){this.owner.cells.deleteTraitController(t)},viewType:Ts,observesView:!0,initView(t){const e=this.owner.cells.controllers;for(const i in e){const n=e[i],o=n.cell.view;if(null!==o&&null===o.parent){const e=n.cell.trait;null!==e&&n.cell.insertView(t,void 0,void 0,e.key)}}},willAttachView(t){this.owner.callObservers("controllerWillAttachLeafView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachLeafView",t,this.owner)},viewWillHighlight(t){this.owner.callObservers("controllerWillHighlightLeafView",t,this.owner)},viewDidHighlight(t){this.owner.callObservers("controllerDidHighlightLeafView",t,this.owner)},viewWillUnhighlight(t){this.owner.callObservers("controllerWillUnhighlightLeafView",t,this.owner)},viewDidUnhighlight(t){this.owner.callObservers("controllerDidUnhighlightLeafView",t,this.owner)},viewDidEnter(t){this.owner.callObservers("controllerDidEnterLeafView",t,this.owner)},viewDidLeave(t){this.owner.callObservers("controllerDidLeaveLeafView",t,this.owner)},viewDidPress(t,e,i){this.owner.callObservers("controllerDidPressLeafView",t,e,i,this.owner)},viewDidLongPress(t,e){this.owner.callObservers("controllerDidLongPressLeafView",t,e,this.owner)}})],Vs.prototype,"leaf",void 0),u([ns({implements:!0,type:Ss,binds:!0,observes:!0,get parentView(){return this.owner.leaf.view},getTraitViewRef:t=>t.cell,willAttachController(t){this.owner.callObservers("controllerWillAttachCell",t,this.owner)},didAttachController(t){const e=t.cell.trait;null!==e&&this.attachCellTrait(e,t);const i=t.cell.view;null!==i&&this.attachCellView(i,t)},willDetachController(t){const e=t.cell.view;null!==e&&this.detachCellView(e,t);const i=t.cell.trait;null!==i&&this.detachCellTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachCell",t,this.owner)},controllerWillAttachCellTrait(t,e){this.owner.callObservers("controllerWillAttachCellTrait",t,e,this.owner),this.attachCellTrait(t,e)},controllerDidDetachCellTrait(t,e){this.detachCellTrait(t,e),this.owner.callObservers("controllerDidDetachCellTrait",t,e,this.owner)},attachCellTrait(t,e){},detachCellTrait(t,e){},controllerWillAttachCellView(t,e){this.owner.callObservers("controllerWillAttachCellView",t,e,this.owner),this.attachCellView(t,e)},controllerDidDetachCellView(t,e){this.detachCellView(t,e),this.owner.callObservers("controllerDidDetachCellView",t,e,this.owner)},attachCellView(t,e){if(t instanceof vs){const i=t.content.view;null!==i&&this.attachCellContentView(i,e)}},detachCellView(t,e){if(t instanceof vs){const i=t.content.view;null!==i&&this.detachCellContentView(i,e)}t.remove()},controllerDidPressCellView(t,e,i,n){this.owner.callObservers("controllerDidPressCellView",t,e,i,n,this.owner)},controllerDidLongPressCellView(t,e,i){this.owner.callObservers("controllerDidLongPressCellView",t,e,i,this.owner)},controllerWillAttachCellContentView(t,e){this.attachCellContentView(t,e),this.owner.callObservers("controllerWillAttachCellContentView",t,e,this.owner)},controllerDidDetachCellContentView(t,e){this.owner.callObservers("controllerDidDetachCellContentView",t,e,this.owner),this.detachCellContentView(t,e)},attachCellContentView(t,e){},detachCellContentView(t,e){},controllerWillSetCellIcon(t,e,i){this.owner.callObservers("controllerWillSetCellIcon",t,e,i,this.owner)},controllerDidSetCellIcon(t,e,i){this.owner.callObservers("controllerDidSetCellIcon",t,e,i,this.owner)},createController(t){return void 0!==t?Ss.fromTrait(t):ns.prototype.createController.call(this)}})],Vs.prototype,"cells",void 0);class Ps extends Xn{constructor(t){super(t),this.visibleFrame=new o.R2Box(0,0,window.innerWidth,window.innerHeight),this.initRow()}initRow(){this.addClass("row"),this.position.setState("relative",i.Affinity.Intrinsic)}getCell(t,e){const i=this.leaf.view;return null!==i?i.getCell(t,e):null}getOrCreateCell(t,e){const i=this.leaf.insertView();if(null===i)throw new Error("no leaf view");return i.getOrCreateCell(t,e)}setCell(t,e){const i=this.leaf.insertView();if(null===i)throw new Error("no leaf view");i.setCell(t,e)}detectVisibleFrame(t){const e=this.rowHeight.getValueOr(o.Length.zero()).pxValue(),i=t.visibleFrame;if(void 0!==i){let t=this.left.state;t=t instanceof o.Length?t.pxValue():0;let n=this.top.state;return n=n instanceof o.Length?n.pxValue():0,new o.R2Box(i.xMin-t-0,i.yMin-n-e,i.xMax-t+0,i.yMax-n+e)}{const t=this.node.getBoundingClientRect(),i=-t.x-0,n=-t.y-e,s=window.innerWidth-t.x+0,r=window.innerHeight-t.y+e;return new o.R2Box(i,n,s,r)}}extendViewContext(t){const e=Object.create(t);return e.visibleFrame=this.visibleFrame,e}onProcess(t,e){super.onProcess(t,e);const i=this.detectVisibleFrame(Object.getPrototypeOf(e));this.visibleFrame=i,e.visibleFrame=this.visibleFrame}needsProcess(t,e){return 0!=(t&pn.NeedsResize)&&(t|=pn.NeedsScroll),t}onDisplay(t,e){super.onDisplay(t,e);const i=this.detectVisibleFrame(Object.getPrototypeOf(e));this.visibleFrame=i,e.visibleFrame=this.visibleFrame}onLayout(t){super.onLayout(t),this.resizeRow();const e=this.leaf.view;null!==e&&this.layoutLeaf(e)}resizeRow(){const t=this.layout.inherited?null:this.layout.value;if(null!==t){const e=this.layout.superValue;let i=null;null!=e&&null!==e.width&&(i=e.width.pxValue()),null===i&&(i=this.width.state,i=i instanceof o.Length?i.pxValue():this.node.offsetWidth);const n=t.resized(i,0,0);this.layout.setValue(n)}}layoutLeaf(t){const e=this.layout.value,n=null!==e?e.width:null,o=this.getLook(St.timing);t.top.setState(0,o,i.Affinity.Intrinsic),t.width.setState(n,i.Affinity.Intrinsic)}didLayout(t){this.layoutRow(),super.didLayout(t)}layoutRow(){const t=this.layout.value,e=null!==t?t.width:null,n=this.rowSpacing.getValueOr(o.Length.zero()).pxValue(),s=this.disclosure.getValue(),r=this.disclosing.getPhaseOr(1);let l=0,a=0;const h=this.leaf.view;null!==h&&(h.width.setState(e,i.Affinity.Intrinsic),h.display.setState("flex",i.Affinity.Intrinsic),l=h.height.value,l=l instanceof o.Length?l.pxValue():h.node.offsetHeight,a=h.height.state,a=a instanceof o.Length?a.pxValue():l);const c=this.head.view;null!==c&&(s.collapsed?c.display.setState("none",i.Affinity.Intrinsic):(c.top.setState(l,i.Affinity.Intrinsic),c.width.setState(e,i.Affinity.Intrinsic),c.height.setState(n*r,i.Affinity.Intrinsic),c.opacity.setState(r,i.Affinity.Intrinsic),c.display.setState("block",i.Affinity.Intrinsic)));let d=0,u=0;const p=this.tree.view;null!==p&&(s.collapsed?p.display.setState("none",i.Affinity.Intrinsic):(p.top.setState((l+n)*r,i.Affinity.Intrinsic),p.width.setState(e,i.Affinity.Intrinsic),p.display.setState("block",i.Affinity.Intrinsic),d=p.height.value,d=d instanceof o.Length?d.pxValue():p.node.offsetHeight,d+=n,u=p.height.state,u=u instanceof o.Length?u.pxValue():d,u+=n));const f=this.foot.view;if(null!==f&&(s.collapsed?f.display.setState("none",i.Affinity.Intrinsic):(f.top.setState(l+d,i.Affinity.Intrinsic),f.width.setState(e,i.Affinity.Intrinsic),f.height.setState(n*r,i.Affinity.Intrinsic),f.opacity.setState(r,i.Affinity.Intrinsic),f.display.setState("block",i.Affinity.Intrinsic))),this.height.hasAffinity(i.Affinity.Intrinsic)){const t=l+d*r,e=a+u;this.height.setInterpolatedValue(o.Length.px(t),o.Length.px(e))}}onCull(){super.onCull(),this.display.setState("none",i.Affinity.Intrinsic)}onUncull(){super.onUncull(),this.display.setState("block",i.Affinity.Intrinsic)}}u([i.Property({type:fs,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Ps.prototype,"layout",void 0),u([i.Property({type:Number,inherits:!0,value:0,updateFlags:pn.NeedsLayout,didSetValue(t,e){const n=this.owner.tree.view;null!==n&&n.depth.setValue(t+1,i.Affinity.Intrinsic)}})],Ps.prototype,"depth",void 0),u([$t({type:o.Length,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Ps.prototype,"rowSpacing",void 0),u([$t({type:o.Length,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Ps.prototype,"rowHeight",void 0),u([i.Property({type:Boolean,inherits:!0,value:!1})],Ps.prototype,"hovers",void 0),u([i.Property({type:Boolean,inherits:!0,value:!0})],Ps.prototype,"glows",void 0),u([gn({key:!0,type:Ts,binds:!0,observes:!0,initView(t){t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic);const e=this.owner.layout.value;t.width.setState(null!==e?e.width:null,i.Affinity.Intrinsic),t.zIndex.setState(1,i.Affinity.Intrinsic)},willAttachView(t){this.owner.callObservers("viewWillAttachLeaf",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachLeaf",t,this.owner)},viewWillHighlight(t){this.owner.callObservers("viewWillHighlightLeaf",t,this.owner)},viewDidHighlight(t){this.owner.callObservers("viewDidHighlightLeaf",t,this.owner)},viewWillUnhighlight(t){this.owner.callObservers("viewWillUnhighlightLeaf",t,this.owner)},viewDidUnhighlight(t){this.owner.callObservers("viewDidUnhighlightLeaf",t,this.owner)},viewDidEnter(t){this.owner.callObservers("viewDidEnterLeaf",t,this.owner)},viewDidLeave(t){this.owner.callObservers("viewDidLeaveLeaf",t,this.owner)},viewDidPress(t,e,i){this.owner.callObservers("viewDidPressLeaf",t,e,i,this.owner)},viewDidLongPress(t,e){this.owner.callObservers("viewDidLongPressLeaf",t,e,this.owner)}})],Ps.prototype,"leaf",void 0),u([gn({key:!0,type:Xn,binds:!0,initView(t){t.addClass("head"),t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(this.owner.rowHeight.state,i.Affinity.Intrinsic);const e=this.owner.layout.value;t.width.setState(null!==e?e.width:null,i.Affinity.Intrinsic),t.height.setState(this.owner.rowSpacing.state,i.Affinity.Intrinsic),t.backgroundColor.setLook(St.accentColor,i.Affinity.Intrinsic),t.opacity.setState(this.owner.disclosing.phase,i.Affinity.Intrinsic),t.zIndex.setState(1,i.Affinity.Intrinsic)}})],Ps.prototype,"head",void 0),u([gn({key:!0,binds:!0,initView(t){t.addClass("tree"),t.display.setState(this.owner.disclosure.collapsed?"none":"block",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic);const e=this.owner.layout.value;t.width.setState(null!==e?e.width:null,i.Affinity.Intrinsic),t.zIndex.setState(0,i.Affinity.Intrinsic),t.depth.setValue(this.owner.depth.value+1,i.Affinity.Intrinsic)},willAttachView(t){this.owner.callObservers("viewWillAttachTree",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachTree",t,this.owner)},createView:()=>Es.create()})],Ps.prototype,"tree",void 0),u([gn({key:!0,type:Xn,binds:!0,initView(t){t.addClass("foot"),t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(this.owner.rowHeight.state,i.Affinity.Intrinsic);const e=this.owner.layout.value;t.width.setState(null!==e?e.width:null,i.Affinity.Intrinsic),t.height.setState(this.owner.rowSpacing.state,i.Affinity.Intrinsic),t.backgroundColor.setLook(St.borderColor,i.Affinity.Intrinsic),t.opacity.setState(this.owner.disclosing.phase,i.Affinity.Intrinsic),t.zIndex.setState(1,i.Affinity.Intrinsic)}})],Ps.prototype,"foot",void 0),u([zt({type:ft,value:ft.collapsed(),willExpand(){this.owner.callObservers("viewWillExpand",this.owner);const t=this.owner.tree.view;null!==t&&t.display.setState("block",i.Affinity.Intrinsic)},didExpand(){this.owner.callObservers("viewDidExpand",this.owner)},willCollapse(){this.owner.callObservers("viewWillCollapse",this.owner)},didCollapse(){const t=this.owner.tree.view;null!==t&&t.display.setState("none",i.Affinity.Intrinsic),this.owner.callObservers("viewDidCollapse",this.owner)},didSetValue(t,e){0!==t.direction?this.owner.disclosing.setState(t,i.Affinity.Intrinsic):(this.owner.disclosing.setState(null,i.Affinity.Intrinsic),this.owner.disclosing.setAffinity(i.Affinity.Transient));const n=this.owner.getBase(Es);null!==n&&n.requireUpdate(pn.NeedsLayout)}})],Ps.prototype,"disclosure",void 0),u([zt({type:ft,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Ps.prototype,"disclosing",void 0);class Is extends Ds{}u([x({binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachTree",t,this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachTree",t,this.owner)},detectModel:t=>t.getTrait(Ns),detectTrait:t=>t instanceof Ns?t:null,createTrait:()=>Ns.create()})],Is.prototype,"tree",void 0);class Ms extends Vs{}u([$o({traitType:Is,observesTrait:!0,initTrait(t){null===this.owner.leaf.trait&&this.owner.leaf.setTrait(t);const e=t.tree.trait;null!==e&&this.owner.tree.setTrait(e)},deinitTrait(t){const e=t.tree.trait;null!==e&&this.owner.tree.deleteTrait(e),this.owner.leaf.trait===t&&this.owner.leaf.setTrait(null)},willAttachTrait(t){this.owner.callObservers("controllerWillAttachRowTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachRowTrait",t,this.owner)},traitWillAttachTree(t){this.owner.tree.setTrait(t)},traitDidDetachTree(t){this.owner.tree.deleteTrait(t)},viewType:Ps,observesView:!0,initView(t){if(null===this.owner.leaf.view){const e=t.leaf.insertView();this.owner.leaf.setView(e)}const e=this.owner.tree.controller;null!==e&&e.table.insertView(t)},willAttachView(t){this.owner.callObservers("controllerWillAttachRowView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachRowView",t,this.owner)},viewWillExpand(t){this.owner.callObservers("controllerWillExpandRowView",t,this.owner)},viewDidExpand(t){this.owner.callObservers("controllerDidExpandRowView",t,this.owner)},viewWillCollapse(t){this.owner.callObservers("controllerWillCollapseRowView",t,this.owner)},viewDidCollapse(t){this.owner.callObservers("controllerDidCollapseRowView",t,this.owner)},viewWillAttachTree(t){const e=this.owner.tree.controller;null!==e&&e.table.setView(t)}})],Ms.prototype,"row",void 0),u([is({implements:!0,binds:!0,observes:!0,get parentView(){return this.owner.row.view},getTraitViewRef:t=>t.table,initController(t){const e=t.table.trait;null!==e&&this.attachTreeTrait(e,t);const i=t.table.view;null!==i&&this.attachTreeView(i,t);const n=this.owner.row.trait;if(null!==n){const e=n.tree.trait;null!==e&&t.table.setTrait(e)}},deinitController(t){const e=t.table.trait;null!==e&&this.detachTreeTrait(e,t);const i=t.table.view;null!==i&&this.detachTreeView(i,t)},willAttachController(t){this.owner.callObservers("controllerWillAttachTree",t,this.owner)},didDetachController(t){this.owner.callObservers("controllerDidDetachTree",t,this.owner)},controllerWillAttachTreeTrait(t,e){this.owner.callObservers("controllerWillAttachTreeTrait",t,e,this.owner),this.attachTreeTrait(t,e)},controllerDidDetachTreeTrait(t,e){this.detachTreeTrait(t,e),this.owner.callObservers("controllerDidDetachTreeTrait",t,e,this.owner)},attachTreeTrait(t,e){},detachTreeTrait(t,e){},controllerWillAttachTableView(t,e){this.owner.callObservers("controllerWillAttachTreeView",t,e,this.owner),this.attachTreeView(t,e)},controllerDidDetachTableView(t,e){this.detachTreeView(t,e),this.owner.callObservers("controllerDidDetachTreeView",t,e,this.owner)},attachTreeView(t,e){},detachTreeView(t,e){t.remove()},detectController:t=>t instanceof Bs?t:null,createController:()=>Bs.create()})],Ms.prototype,"tree",void 0);class Ls extends Xn{constructor(t){super(t),this.initCol()}initCol(){this.addClass("col"),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic)}}u([gn({implements:!0,key:!0,type:Xn,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachLabel",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachLabel",t,this.owner)},createView(t){const e=Xn.fromTag("span");return e.alignSelf.setState("center",i.Affinity.Intrinsic),e.whiteSpace.setState("nowrap",i.Affinity.Intrinsic),e.textOverflow.setState("ellipsis",i.Affinity.Intrinsic),e.overflowX.setState("hidden",i.Affinity.Intrinsic),e.overflowY.setState("hidden",i.Affinity.Intrinsic),e.color.setLook(St.neutralColor,i.Affinity.Intrinsic),void 0!==t&&e.text(t),e},fromAny(t){return"string"==typeof t?this.createView(t):Xn.fromAny(t)}})],Ls.prototype,"label",void 0);class ks extends S{}u([i.Property({type:ps,value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetLayout",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetLayout",t,e,this.owner)}})],ks.prototype,"layout",void 0),u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetLabel",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetLabel",t,e,this.owner)}})],ks.prototype,"label",void 0);class Fs extends Zo{createLabelView(t,e){return"function"==typeof t?t(e):t}setLabelView(t,e){const i=this.col.view;if(null!==i){const n=null!==t?this.createLabelView(t,e):null;i.label.setView(n)}}}u([$o({traitType:ks,observesTrait:!0,initTrait(t){null!==this.view&&this.owner.setLabelView(t.label.value,t)},deinitTrait(t){null!==this.view&&this.owner.setLabelView(null,t)},willAttachTrait(t){this.owner.callObservers("controllerWillAttachColTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachColTrait",t,this.owner)},traitWillSetLayout(t,e){this.owner.callObservers("controllerWillSetColLayout",t,e,this.owner)},traitDidSetLayout(t,e){this.owner.callObservers("controllerDidSetColLayout",t,e,this.owner)},traitDidSetLabel(t,e,i){this.owner.setLabelView(t,i)},viewType:Ls,observesView:!0,initView(t){this.owner.label.setView(t.label.view);const e=this.trait;null!==e&&this.owner.setLabelView(e.label.value,e)},deinitView(t){this.owner.label.setView(null)},willAttachView(t){this.owner.callObservers("controllerWillAttachColView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachColView",t,this.owner)},viewWillAttachLabel(t){this.owner.label.setView(t)},viewDidDetachLabel(t){this.owner.label.setView(null)}})],Fs.prototype,"col",void 0),u([gn({type:Xn,willAttachView(t){this.owner.callObservers("controllerWillAttachColLabelView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachColLabelView",t,this.owner)}})],Fs.prototype,"label",void 0);class Rs extends Xn{constructor(t){super(t),this.initHeader()}initHeader(){this.addClass("header"),this.position.setState("relative",i.Affinity.Intrinsic),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic)}getCol(t,e){void 0===e&&(e=Ls);const i=this.getChild(t);return i instanceof e?i:null}getOrCreateCol(t,e){void 0===e&&(e=Ls);let i=this.getChild(t);return i instanceof e||(i=e.create(),this.setChild(t,i)),i}setCol(t,e){this.setChild(t,e)}onLayout(t){super.onLayout(t),this.layoutHeader()}layoutHeader(){const t=this.rowHeight.value;null!==t&&this.height.setState(t,i.Affinity.Intrinsic)}displayChildren(t,e,i){0!=(t&pn.NeedsLayout)?this.layoutChildViews(t,e,i):super.displayChildren(t,e,i)}layoutChildViews(t,e,n){const o=this.layout.value,s=this.height.state,r=this.stretch.getPhaseOr(1);super.displayChildren(t,e,(function(t,e,l){if(t instanceof Ls){const e=t.key,n=null!==o&&void 0!==e?o.getCol(e):null;if(null!==n){t.display.setState(n.hidden?"none":"flex",i.Affinity.Intrinsic),t.left.setState(n.left,i.Affinity.Intrinsic),t.width.setState(n.width,i.Affinity.Intrinsic),t.height.setState(s,i.Affinity.Intrinsic);const e=n.textColor;e instanceof St?t.color.setLook(e,i.Affinity.Intrinsic):t.color.setState(e,i.Affinity.Intrinsic),n.persistent||t.opacity.setState(r,i.Affinity.Intrinsic)}else t.display.setState("none",i.Affinity.Intrinsic),t.left.setState(null,i.Affinity.Intrinsic),t.width.setState(null,i.Affinity.Intrinsic),t.height.setState(null,i.Affinity.Intrinsic)}n.call(this,t,e,l)}))}}u([i.Property({type:fs,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Rs.prototype,"layout",void 0),u([i.Property({type:Number,inherits:!0,value:0,updateFlags:pn.NeedsLayout})],Rs.prototype,"depth",void 0),u([$t({type:o.Length,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Rs.prototype,"rowSpacing",void 0),u([$t({type:o.Length,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Rs.prototype,"rowHeight",void 0),u([zt({type:ft,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Rs.prototype,"stretch",void 0),u([vn({type:Ls,binds:!0,initView(t){t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.width.setState(0,i.Affinity.Intrinsic),t.height.setState(this.owner.height.state,i.Affinity.Intrinsic)},willAttachView(t,e){this.owner.callObservers("viewWillAttachCol",t,e,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachCol",t,this.owner)}})],Rs.prototype,"cols",void 0);class Os extends S{getCol(t,e){void 0===e&&(e=ks);const i=this.getTrait(t);return i instanceof e?i:null}getOrCreateCol(t,e){void 0===e&&(e=ks);let i=this.getTrait(t);return i instanceof e||(i=new e,this.setTrait(t,i)),i}setCol(t,e){this.setTrait(t,e)}startConsumingCols(){const t=this.cols.traits;for(const e in t){t[e].consume(this)}}stopConsumingCols(){const t=this.cols.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingCols()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingCols()}}u([T({type:ks,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachCol",t,e,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachCol",t,this.owner)},detectModel:t=>t.getTrait(ks)})],Os.prototype,"cols",void 0);class Ws extends Zo{getColTrait(t,e){const i=this.header.trait;return null!==i?i.getCol(t,e):null}getOrCreateColTrait(t,e){const i=this.header.trait;if(null===i)throw new Error("no header trait");return i.getOrCreateCol(t,e)}setColTrait(t,e){const i=this.header.trait;if(null===i)throw new Error("no header trait");i.setCol(t,e)}getColView(t,e){const i=this.header.view;return null!==i?i.getCol(t,e):null}getOrCreateColView(t,e){let i=this.header.view;if(null===i){if(i=this.header.createView(),null===i)throw new Error("no header view");this.header.setView(i)}return i.getOrCreateCol(t,e)}setColView(t,e){let i=this.header.view;if(null===i){if(i=this.header.createView(),null===i)throw new Error("no header view");this.header.setView(i)}i.setCol(t,e)}}u([$o({traitType:Os,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachHeaderTrait",t,this.owner)},didAttachTrait(t){const e=t.cols.traits;for(const t in e){const i=e[t];this.owner.cols.addTraitController(i)}},willDetachTrait(t){const e=t.cols.traits;for(const t in e){const i=e[t];this.owner.cols.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachHeaderTrait",t,this.owner)},traitWillAttachCol(t,e){this.owner.cols.addTraitController(t,e)},traitDidDetachCol(t){this.owner.cols.deleteTraitController(t)},viewType:Rs,observesView:!0,initView(t){const e=this.owner.cols.controllers;for(const i in e){const n=e[i],o=n.col.view;if(null!==o&&null===o.parent){const e=n.col.trait;null!==e&&n.col.insertView(t,void 0,void 0,e.key)}}},willAttachView(t){this.owner.callObservers("controllerWillAttachHeaderView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachHeaderView",t,this.owner)},insertChildView(t,e,i,n){t.prependChild(e,n)}})],Ws.prototype,"header",void 0),u([ns({implements:!0,type:Fs,binds:!0,observes:!0,get parentView(){return this.owner.header.view},getTraitViewRef:t=>t.col,willAttachController(t){this.owner.callObservers("controllerWillAttachCol",t,this.owner)},didAttachController(t){const e=t.col.trait;null!==e&&this.attachColTrait(e,t);const i=t.col.view;null!==i&&this.attachColView(i,t)},willDetachController(t){const e=t.col.view;null!==e&&this.detachColView(e,t);const i=t.col.trait;null!==i&&this.detachColTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachCol",t,this.owner)},controllerWillAttachColTrait(t,e){this.owner.callObservers("controllerWillAttachColTrait",t,e,this.owner),this.attachColTrait(t,e)},controllerDidDetachColTrait(t,e){this.detachColTrait(t,e),this.owner.callObservers("controllerDidDetachColTrait",t,e,this.owner)},attachColTrait(t,e){},detachColTrait(t,e){},controllerWillAttachColView(t,e){this.owner.callObservers("controllerWillAttachColView",t,e,this.owner),this.attachColView(t,e)},controllerDidDetachColView(t,e){this.detachColView(t,e),this.owner.callObservers("controllerDidDetachColView",t,e,this.owner)},attachColView(t,e){const i=t.label.view;null!==i&&this.attachColLabelView(i,e)},detachColView(t,e){const i=t.label.view;null!==i&&this.detachColLabelView(i,e),t.remove()},controllerWillSetColLayout(t,e,i){this.owner.callObservers("controllerWillSetColLayout",t,e,i,this.owner)},controllerDidSetColLayout(t,e,i){this.owner.callObservers("controllerDidSetColLayout",t,e,i,this.owner)},controllerWillAttachColLabelView(t,e){this.owner.callObservers("controllerWillAttachColLabelView",t,e,this.owner),this.attachColLabelView(t,e)},controllerDidDetachColLabelView(t,e){this.detachColLabelView(t,e),this.owner.callObservers("controllerDidDetachColLabelView",t,e,this.owner)},attachColLabelView(t,e){},detachColLabelView(t,e){}})],Ws.prototype,"cols",void 0);class Es extends Xn{constructor(t){super(t),this.visibleViews=[],this.visibleFrame=new o.R2Box(0,0,window.innerWidth,window.innerHeight),this.initTable()}initTable(){this.addClass("table"),this.position.setState("relative",i.Affinity.Intrinsic),this.backgroundColor.setLook(St.backgroundColor,i.Affinity.Intrinsic)}detectVisibleFrame(t){const e=this.rowHeight.getValueOr(o.Length.zero()).pxValue(),i=t.visibleFrame;if(void 0!==i){let t=this.left.state;t=t instanceof o.Length?t.pxValue():0;let n=this.top.state;return n=n instanceof o.Length?n.pxValue():0,new o.R2Box(i.xMin-t-0,i.yMin-n-e,i.xMax-t+0,i.yMax-n+e)}{const t=this.node.getBoundingClientRect(),i=-t.x-0,n=-t.y-e,s=window.innerWidth-t.x+0,r=window.innerHeight-t.y+e;return new o.R2Box(i,n,s,r)}}extendViewContext(t){const e=Object.create(t);return e.visibleFrame=this.visibleFrame,e}needsProcess(t,e){return 0!=(t&pn.NeedsResize)&&(t|=pn.NeedsScroll),t}onResize(t){super.onResize(t),this.resizeTable()}resizeTable(){const t=this.layout.inherited?null:this.layout.value;if(null!==t){const e=this.layout.superValue;let i=null;null!=e&&null!==e.width&&(i=e.width.pxValue()),null===i&&(i=this.width.state,i=i instanceof o.Length?i.pxValue():this.node.offsetWidth);const n=this.edgeInsets.value;let s=this.paddingLeft.state;s=s instanceof o.Length?s.pxValue(i):0;let r=this.paddingRight.state;r=r instanceof o.Length?r.pxValue(i):0;let l=null!==n?n.insetLeft:0;l+=s;let a=null!==n?n.insetRight:0;a+=r;const h=t.resized(i,l,a);this.layout.setValue(h)}}processVisibleViews(t,e,i){const n=this.visibleViews;let o=0;for(;o<n.length;){const s=n[o];i.call(this,s,t,e),0==(s.flags&pn.RemovingFlag)?o+=1:(s.setFlags(s.flags&~pn.RemovingFlag),this.removeChild(s))}}processChildren(t,e,i){this.culled||(0!=(t&pn.NeedsScroll)?this.scrollChildViews(t,e,i):this.processVisibleViews(t,e,i))}scrollChildViews(t,e,n){const s=this.visibleViews;s.length=0;const r=this.detectVisibleFrame(Object.getPrototypeOf(e));e.visibleFrame=r,this.visibleFrame=r,super.processChildren(t,e,(function(t,e,l){let a;if(t instanceof Xn){const e=t.top.state,n=t.height.state;if(e instanceof o.Length&&n instanceof o.Length){const o=r.yMin,s=r.yMax,l=e.pxValue();a=o<=l+n.pxValue()&&l<=s,t.display.setState(a?"flex":"none",i.Affinity.Intrinsic),t.setCulled(!a)}else a=!0}else a=!0;a&&(s.push(t),n.call(this,t,e,l))}))}displayVisibleViews(t,e,i){const n=this.visibleViews;let o=0;for(;o<n.length;){const s=n[o];i.call(this,s,t,e),0==(s.flags&pn.RemovingFlag)?o+=1:(s.setFlags(s.flags&~pn.RemovingFlag),this.removeChild(s))}}displayChildren(t,e,i){0!=(t&pn.NeedsLayout)?this.layoutChildViews(t,e,i):this.displayVisibleViews(t,e,i)}layoutChildViews(t,e,n){this.resizeTable();const s=this.layout.value,r=null!==s?s.width:null,l=this.rowHeight.getValue(),a=this.rowSpacing.getValue().pxValue(l.pxValue()),h=this.disclosing.getPhaseOr(1),c=this.visibleViews;c.length=0;const d=this.detectVisibleFrame(Object.getPrototypeOf(e));e.visibleFrame=d,this.visibleFrame=d;let u=0,p=0,f=0;super.displayChildren(t,e,(function(t,e,s){let l;if((t instanceof Ps||t instanceof Rs)&&(0!==f&&(u+=a*h,p+=a),t.top.hasAffinity(i.Affinity.Intrinsic)&&t.top.setInterpolatedValue(o.Length.px(u),o.Length.px(p)),t.width.setState(r,i.Affinity.Intrinsic)),t instanceof Xn){const e=t.top.state,n=t.height.state;if(e instanceof o.Length&&n instanceof o.Length){const t=d.yMin,i=d.yMax,o=e.pxValue();l=t<=o+n.pxValue()&&o<=i}else l=!0;t.display.setState(l?"flex":"none",i.Affinity.Intrinsic),t.setCulled(!l)}else l=!0;if(l&&c.push(t),n.call(this,t,e,s),t instanceof Ps||t instanceof Rs){let e=t.height.value;e=e instanceof o.Length?e.pxValue():t.node.offsetHeight;let i=t.height.state;i=i instanceof o.Length?i.pxValue():e,u+=e*h,p+=i,f+=1}})),this.height.hasAffinity(i.Affinity.Intrinsic)&&this.height.setInterpolatedValue(o.Length.px(u),o.Length.px(p));const g=this.disclosure.getPhaseOr(1);this.opacity.setState(g,i.Affinity.Intrinsic)}}u([i.Property({type:fs,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Es.prototype,"layout",void 0),u([i.Property({type:Object,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Es.prototype,"edgeInsets",void 0),u([i.Property({type:Number,inherits:!0,value:0,updateFlags:pn.NeedsLayout,didSetValue(t,e){this.owner.modifyTheme(Mt.default,[[Mt.nested,0!==t?1:void 0]],!1)}})],Es.prototype,"depth",void 0),u([$t({type:o.Length,inherits:!0,value:o.Length.zero(),updateFlags:pn.NeedsLayout})],Es.prototype,"rowSpacing",void 0),u([$t({type:o.Length,inherits:!0,value:o.Length.px(24),updateFlags:pn.NeedsLayout})],Es.prototype,"rowHeight",void 0),u([i.Property({type:Boolean,inherits:!0,value:!1})],Es.prototype,"hovers",void 0),u([i.Property({type:Boolean,inherits:!0,value:!0})],Es.prototype,"glows",void 0),u([zt({type:ft,inherits:!0,value:null})],Es.prototype,"disclosure",void 0),u([zt({type:ft,inherits:!0,value:null})],Es.prototype,"disclosing",void 0),u([zt({type:ft,inherits:!0,value:null,updateFlags:pn.NeedsLayout})],Es.prototype,"stretch",void 0),u([gn({key:!0,type:Rs,binds:!0,initView(t){t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(null,i.Affinity.Intrinsic);const e=this.owner.layout.value;t.width.setState(null!==e?e.width:null,i.Affinity.Intrinsic),t.setCulled(!0)},willAttachView(t){this.owner.callObservers("viewWillAttachHeader",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachHeader",t,this.owner)},insertChild(t,e,i,n){t.prependChild(e,n)}})],Es.prototype,"header",void 0),u([vn({type:Ps,binds:!0,observes:!0,initView(t){t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(null,i.Affinity.Intrinsic);const e=this.owner.layout.value;t.width.setState(null!==e?e.width:null,i.Affinity.Intrinsic),t.setCulled(!0)},willAttachView(t,e){this.owner.callObservers("viewWillAttachRow",t,e,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachRow",t,this.owner)},viewWillAttachLeaf(t,e){this.owner.callObservers("viewWillAttachLeaf",t,e)},viewDidDetachLeaf(t,e){this.owner.callObservers("viewDidDetachLeaf",t,e)},viewDidEnterLeaf(t,e){this.owner.callObservers("viewDidEnterLeaf",t,e)},viewDidLeaveLeaf(t,e){this.owner.callObservers("viewDidLeaveLeaf",t,e)},viewDidPressLeaf(t,e,i,n){this.owner.callObservers("viewDidPressLeaf",t,e,i,n)},viewDidLongPressLeaf(t,e,i){this.owner.callObservers("viewDidLongPressLeaf",t,e,i)},viewWillAttachTree(t,e){this.owner.callObservers("viewWillAttachTree",t,e)},viewDidDetachTree(t,e){this.owner.callObservers("viewDidDetachTree",t,e)},viewWillHighlightLeaf(t,e){this.owner.callObservers("viewWillHighlightLeaf",t,e)},viewDidHighlightLeaf(t,e){this.owner.callObservers("viewDidHighlightLeaf",t,e)},viewWillUnhighlightLeaf(t,e){this.owner.callObservers("viewWillUnhighlightLeaf",t,e)},viewDidUnhighlightLeaf(t,e){this.owner.callObservers("viewDidUnhighlightLeaf",t,e)},viewWillExpand(t){this.owner.callObservers("viewWillExpandRow",t)},viewDidExpand(t){this.owner.callObservers("viewDidExpandRow",t)},viewWillCollapse(t){this.owner.callObservers("viewWillCollapseRow",t)},viewDidCollapse(t){this.owner.callObservers("viewDidCollapseRow",t)}})],Es.prototype,"rows",void 0);class Ns extends S{createLayout(){const t=[],e=this.cols.traits;for(const i in e){const n=e[i].layout.value;null!==n&&t.push(n)}const i=this.colSpacing.value;return new fs(null,null,null,i,t)}updateLayout(){const t=this.createLayout();this.layout.setValue(t,i.Affinity.Intrinsic)}startConsumingCols(){const t=this.cols.traits;for(const e in t){t[e].consume(this)}}stopConsumingCols(){const t=this.cols.traits;for(const e in t){t[e].unconsume(this)}}startConsumingRows(){const t=this.rows.traits;for(const e in t){t[e].consume(this)}}stopConsumingRows(){const t=this.rows.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingCols(),this.startConsumingRows()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingRows(),this.stopConsumingCols()}}u([i.Property({type:fs,value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetTableLayout",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetTableLayout",t,e,this.owner)}})],Ns.prototype,"layout",void 0),u([i.Property({type:o.Length,value:null,didSetValue(t,e){this.owner.updateLayout()}})],Ns.prototype,"colSpacing",void 0),u([x({type:Os,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachHeader",t,this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachHeader",t,this.owner)},detectTrait:t=>t instanceof Os?t:null})],Ns.prototype,"header",void 0),u([T({type:ks,binds:!0,observes:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachCol",t,e,this.owner)},didAttachTrait(t){this.owner.updateLayout(),this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.updateLayout(),this.owner.callObservers("traitDidDetachCol",t,this.owner)},traitDidSetLayout(t,e){this.owner.updateLayout()},detectModel:t=>t.getTrait(ks)})],Ns.prototype,"cols",void 0),u([T({type:Is,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachRow",t,e,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachRow",t,this.owner)},detectModel:t=>t.getTrait(Is),detectTrait:t=>null})],Ns.prototype,"rows",void 0);class Bs extends Zo{layoutTable(t,e){e.layout.setValue(t,i.Affinity.Intrinsic)}}u([$o({traitType:Ns,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachTableTrait",t,this.owner)},didAttachTrait(t){const e=t.header.trait;null!==e&&this.owner.header.setTrait(e);const i=t.cols.traits;for(const t in i){const e=i[t];this.owner.cols.addTraitController(e,null,e.key)}const n=t.rows.traits;for(const t in n){const e=n[t];this.owner.rows.addTraitController(e)}const o=this.view;if(null!==o){const e=t.layout.value;null!==e&&this.owner.layoutTable(e,o)}},willDetachTrait(t){const e=t.rows.traits;for(const t in e){const i=e[t];this.owner.rows.deleteTraitController(i)}const i=t.cols.traits;for(const t in i){const e=i[t];this.owner.cols.deleteTraitController(e)}const n=t.header.trait;null!==n&&this.owner.header.deleteTrait(n)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachTableTrait",t,this.owner)},traitWillSetTableLayout(t,e){this.owner.callObservers("controllerWillSetTableLayout",t,e,this.owner)},traitDidSetTableLayout(t,e){this.owner.callObservers("controllerDidSetTableLayout",t,e,this.owner)},traitWillAttachHeader(t){this.owner.header.setTrait(t)},traitDidDetachHeader(t){this.owner.header.deleteTrait(t)},traitWillAttachCol(t,e){this.owner.cols.addTraitController(t,e,t.key)},traitDidDetachCol(t){this.owner.cols.deleteTraitController(t)},traitWillAttachRow(t,e){this.owner.rows.addTraitController(t,e)},traitDidDetachRow(t){this.owner.rows.deleteTraitController(t)},viewType:Es,observesView:!0,initView(t){const e=this.owner.header.controller;null!==e&&(e.header.insertView(t),null===t.header.view&&t.header.setView(e.header.view));const i=this.owner.rows.controllers;for(const e in i){const n=i[e],o=n.row.view;null!==o&&null===o.parent&&n.row.insertView(t)}const n=this.trait;if(null!==n){const e=n.layout.value;null!==e&&this.owner.layoutTable(e,t)}},willAttachView(t){this.owner.callObservers("controllerWillAttachTableView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachTableView",t,this.owner)},viewWillAttachHeader(t){const e=this.owner.header.controller;null!==e&&e.header.setView(t)},viewDidDetachHeader(t){const e=this.owner.header.controller;null!==e&&e.header.setView(null)}})],Bs.prototype,"table",void 0),u([is({implements:!0,type:Ws,binds:!0,observes:!0,get parentView(){return this.owner.table.view},getTraitViewRef:t=>t.header,initController(t){const e=this.owner.table.trait;if(null!==e){const i=e.header.trait;null!==i&&t.header.setTrait(i)}},willAttachController(t){this.owner.callObservers("controllerWillAttachHeader",t,this.owner)},didAttachController(t){const e=t.header.trait;null!==e&&this.attachHeaderTrait(e,t);const i=t.header.view;null!==i&&this.attachHeaderView(i,t)},willDetachController(t){const e=t.header.view;null!==e&&this.detachHeaderView(e,t);const i=t.header.trait;null!==i&&this.detachHeaderTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachHeader",t,this.owner)},controllerWillAttachHeaderTrait(t,e){this.owner.callObservers("controllerWillAttachHeaderTrait",t,this.owner),this.attachHeaderTrait(t,e)},controllerDidDetachHeaderTrait(t,e){this.detachHeaderTrait(t,e),this.owner.callObservers("controllerDidDetachHeaderTrait",t,this.owner)},attachHeaderTrait(t,e){},detachHeaderTrait(t,e){},controllerWillAttachHeaderView(t,e){this.owner.callObservers("controllerWillAttachHeaderView",t,this.owner),this.attachHeaderView(t,e)},controllerDidDetachHeaderView(t,e){this.detachHeaderView(t,e),this.owner.callObservers("controllerDidDetachHeaderView",t,this.owner)},attachHeaderView(t,e){},detachHeaderView(t,e){t.remove()},detectController:t=>t instanceof Ws?t:null})],Bs.prototype,"header",void 0),u([ns({implements:!0,type:Fs,binds:!0,observes:!0,getTraitViewRef:t=>t.col,willAttachController(t){this.owner.callObservers("controllerWillAttachCol",t,this.owner)},didAttachController(t){const e=t.col.trait;null!==e&&this.attachColTrait(e,t);const i=t.col.view;null!==i&&this.attachColView(i,t)},willDetachController(t){const e=t.col.trait;null!==e&&this.detachColTrait(e,t);const i=t.col.view;null!==i&&this.detachColView(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachCol",t,this.owner)},controllerWillAttachColTrait(t,e){this.owner.callObservers("controllerWillAttachColTrait",t,e,this.owner),this.attachColTrait(t,e)},controllerDidDetachColTrait(t,e){this.detachColTrait(t,e),this.owner.callObservers("controllerDidDetachColTrait",t,e,this.owner)},attachColTrait(t,e){},detachColTrait(t,e){},controllerWillSetColLayout(t,e,i){this.owner.callObservers("controllerWillSetColLayout",t,e,i,this.owner)},controllerDidSetColLayout(t,e,i){this.owner.callObservers("controllerDidSetColLayout",t,e,i,this.owner)},controllerWillAttachColView(t,e){this.owner.callObservers("controllerWillAttachColView",t,e,this.owner),this.attachColView(t,e)},controllerDidDetachColView(t,e){this.detachColView(t,e),this.owner.callObservers("controllerDidDetachColView",t,e,this.owner)},attachColView(t,e){const i=t.label.view;null!==i&&this.attachColLabelView(i,e)},detachColView(t,e){const i=t.label.view;null!==i&&this.detachColLabelView(i,e),t.remove()},controllerWillAttachColLabelView(t,e){this.owner.callObservers("controllerWillAttachColLabelView",t,e,this.owner),this.attachColLabelView(t,e)},controllerDidDetachColLabelView(t,e){this.detachColLabelView(t,e),this.owner.callObservers("controllerDidDetachColLabelView",t,e,this.owner)},attachColLabelView(t,e){},detachColLabelView(t,e){}})],Bs.prototype,"cols",void 0),u([ns({implements:!0,type:Ms,binds:!0,observes:!0,get parentView(){return this.owner.table.view},getTraitViewRef:t=>t.row,willAttachController(t){this.owner.callObservers("controllerWillAttachRow",t,this.owner)},didAttachController(t){const e=t.row.trait;null!==e&&this.attachRowTrait(e,t);const i=t.row.view;null!==i&&this.attachRowView(i,t)},willDetachController(t){const e=t.row.view;null!==e&&this.detachRowView(e,t);const i=t.row.trait;null!==i&&this.detachRowTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachRow",t,this.owner)},controllerWillAttachRowTrait(t,e){this.owner.callObservers("controllerWillAttachRowTrait",t,e,this.owner),this.attachRowTrait(t,e)},controllerDidDetachRowTrait(t,e){this.detachRowTrait(t,e),this.owner.callObservers("controllerDidDetachRowTrait",t,e,this.owner)},attachRowTrait(t,e){},detachRowTrait(t,e){},controllerWillAttachRowView(t,e){this.owner.callObservers("controllerWillAttachRowView",t,e,this.owner),this.attachRowView(t,e)},controllerDidDetachRowView(t,e){this.detachRowView(t,e),this.owner.callObservers("controllerDidDetachRowView",t,e,this.owner)},attachRowView(t,e){},detachRowView(t,e){t.remove()},controllerWillAttachLeafTrait(t,e){this.owner.callObservers("controllerWillAttachLeafTrait",t,e,this.owner),this.attachLeafTrait(t,e)},controllerDidDetachLeafTrait(t,e){this.detachLeafTrait(t,e),this.owner.callObservers("controllerDidDetachLeafTrait",t,e,this.owner)},attachLeafTrait(t,e){},detachLeafTrait(t,e){},controllerWillAttachLeafView(t,e){this.owner.callObservers("controllerWillAttachLeafView",t,e,this.owner),this.attachLeafView(t,e)},controllerDidDetachLeafView(t,e){this.detachLeafView(t,e),this.owner.callObservers("controllerDidDetachLeafView",t,e,this.owner)},attachLeafView(t,e){},detachLeafView(t,e){},controllerWillAttachCell(t,e){this.owner.callObservers("controllerWillAttachCell",t,e,this.owner),this.attachCell(t,e)},controllerDidDetachCell(t,e){this.detachCell(t,e),this.owner.callObservers("controllerDidDetachCell",t,e,this.owner)},attachCell(t,e){const i=t.cell.trait;null!==i&&this.attachCellTrait(i,t,e);const n=t.cell.view;null!==n&&this.attachCellView(n,t,e)},detachCell(t,e){const i=t.cell.trait;null!==i&&this.detachCellTrait(i,t,e);const n=t.cell.view;null!==n&&this.detachCellView(n,t,e)},controllerWillAttachCellTrait(t,e,i){this.owner.callObservers("controllerWillAttachCellTrait",t,e,i,this.owner),this.attachCellTrait(t,e,i)},controllerDidDetachCellTrait(t,e,i){this.detachCellTrait(t,e,i),this.owner.callObservers("controllerDidDetachCellTrait",t,e,i,this.owner)},attachCellTrait(t,e,i){},detachCellTrait(t,e,i){},controllerWillAttachCellView(t,e,i){this.owner.callObservers("controllerWillAttachCellView",t,e,i,this.owner),this.attachCellView(t,e,i)},controllerDidDetachCellView(t,e,i){this.detachCellView(t,e,i),this.owner.callObservers("controllerDidDetachCellView",t,e,i,this.owner)},attachCellView(t,e,i){if(t instanceof vs){const n=t.content.view;null!==n&&this.attachCellContentView(n,e,i)}},detachCellView(t,e,i){if(t instanceof vs){const n=t.content.view;null!==n&&this.detachCellContentView(n,e,i)}},controllerWillAttachCellContentView(t,e,i){this.owner.callObservers("controllerWillAttachCellContentView",t,e,i,this.owner),this.attachCellContentView(t,e,i)},controllerDidDetachCellContentView(t,e,i){this.detachCellContentView(t,e,i),this.owner.callObservers("controllerDidDetachCellContentView",t,e,i,this.owner)},attachCellContentView(t,e,i){},detachCellContentView(t,e,i){},controllerWillSetCellIcon(t,e,i,n){this.owner.callObservers("controllerWillSetCellIcon",t,e,i,n,this.owner)},controllerDidSetCellIcon(t,e,i,n){this.owner.callObservers("controllerDidSetCellIcon",t,e,i,n,this.owner)},controllerWillAttachTree(t,e){this.owner.callObservers("controllerWillAttachTree",t,e,this.owner),this.attachTree(t,e)},controllerDidDetachTree(t,e){this.detachTree(t,e),this.owner.callObservers("controllerDidDetachTree",t,e,this.owner)},attachTree(t,e){const i=t.table.trait;null!==i&&this.attachTreeTrait(i,t,e);const n=t.table.view;null!==n&&this.attachTreeView(n,t,e)},detachTree(t,e){const i=t.table.trait;null!==i&&this.detachTreeTrait(i,t,e);const n=t.table.view;null!==n&&this.detachTreeView(n,t,e)},controllerWillAttachTreeTrait(t,e,i){this.owner.callObservers("controllerWillAttachTreeTrait",t,e,i,this.owner),this.attachTreeTrait(t,e,i)},controllerDidDetachTreeTrait(t,e,i){this.detachTreeTrait(t,e,i),this.owner.callObservers("controllerDidDetachTreeTrait",t,e,i,this.owner)},attachTreeTrait(t,e,i){},detachTreeTrait(t,e,i){},controllerWillAttachTreeView(t,e,i){this.owner.callObservers("controllerWillAttachTreeView",t,e,i,this.owner),this.attachTreeView(t,e,i)},controllerDidDetachTreeView(t,e,i){this.detachTreeView(t,e,i),this.owner.callObservers("controllerDidDetachTreeView",t,e,i,this.owner)},attachTreeView(t,e,i){},detachTreeView(t,e,i){},controllerWillExpandRowView(t,e){this.owner.callObservers("controllerWillExpandRowView",t,e,this.owner)},controllerDidExpandRowView(t,e){this.owner.callObservers("controllerDidExpandRowView",t,e,this.owner)},controllerWillCollapseRowView(t,e){this.owner.callObservers("controllerWillCollapseRowView",t,e,this.owner)},controllerDidCollapseRowView(t,e){this.owner.callObservers("controllerDidCollapseRowView",t,e,this.owner)}})],Bs.prototype,"rows",void 0);class Us extends Xn{constructor(t){super(t),this.displayState=Us.HiddenState,this.onClick=this.onClick.bind(this),"undefined"!=typeof PointerEvent?(this.onSyntheticClick=this.onSyntheticClick.bind(this),this.on("pointerup",this.onClick),this.on("click",this.onSyntheticClick)):"undefined"!=typeof TouchEvent?(this.onSyntheticClick=this.onSyntheticClick.bind(this),this.on("touchend",this.onClick),this.on("click",this.onSyntheticClick)):this.on("click",this.onClick),this.initScrim()}initScrim(){this.addClass("scrim"),this.display.setState("none",i.Affinity.Intrinsic),this.position.setState("absolute",i.Affinity.Intrinsic),this.top.setState(0,i.Affinity.Intrinsic),this.right.setState(0,i.Affinity.Intrinsic),this.bottom.setState(0,i.Affinity.Intrinsic),this.left.setState(0,i.Affinity.Intrinsic),this.pointerEvents.setState("auto",i.Affinity.Intrinsic),this.cursor.setState("pointer",i.Affinity.Intrinsic),this.backgroundColor.setState(B.black(0),i.Affinity.Intrinsic)}setDisplayState(t){this.displayState=t}isShown(){switch(this.displayState){case Us.ShownState:case Us.ShowingState:case Us.ShowState:return!0;default:return!1}}isHidden(){switch(this.displayState){case Us.HiddenState:case Us.HidingState:case Us.HideState:return!0;default:return!1}}show(t,n){this.isHidden()&&(n=void 0===n||!0===n?this.getLookOr(St.timing,!1):e.Timing.fromAny(n),this.setDisplayState(Us.ShowState),!1!==n?(this.backgroundColor.setState(B.black(0),i.Affinity.Intrinsic),this.backgroundColor.setState(B.black(t),n,i.Affinity.Intrinsic)):(this.willShowScrim(),this.backgroundColor.setState(B.black(t),i.Affinity.Intrinsic),this.didShowScrim()))}willShowScrim(){this.setDisplayState(Us.ShowingState),this.display.setState("block",i.Affinity.Intrinsic)}didShowScrim(){this.setDisplayState(Us.ShownState)}hide(t){this.isShown()&&(t=void 0===t||!0===t?this.getLookOr(St.timing,!1):e.Timing.fromAny(t),this.setDisplayState(Us.HideState),!1!==t?this.backgroundColor.setState(B.black(0),t,i.Affinity.Intrinsic):(this.willHideScrim(),this.backgroundColor.setState(B.black(0),i.Affinity.Intrinsic),this.didHideScrim()))}willHideScrim(){this.setDisplayState(Us.HidingState)}didHideScrim(){this.setDisplayState(Us.HiddenState),this.display.setState("none",i.Affinity.Intrinsic)}onMount(){super.onMount();const t=this.modalProvider.service;null!=t&&(t.observe(this),this.serviceDidUpdateModality(t.modality,0,t))}onUnmount(){const t=this.modalProvider.service;null!=t&&t.unobserve(this),this.hide(!1),super.onUnmount()}serviceDidUpdateModality(t,e,n){if(0!==t){const n=.5*t;0===e?this.show(n):(this.backgroundColor.setState(B.black(n),i.Affinity.Intrinsic),this.displayState===Us.ShowingState&&this.didShowScrim())}else this.hide()}onClick(t){const e=this.modalProvider.service;null!=e&&e.displaceModals(t)}onSyntheticClick(t){t.preventDefault(),t.stopPropagation()}}Us.HiddenState=0,Us.HidingState=1,Us.HideState=2,Us.ShownState=3,Us.ShowingState=4,Us.ShowState=5,u([Dn({propertyNames:"background-color",type:B,value:null,willTransition(){const t=this.owner.displayState;t===Us.ShowState?this.owner.willShowScrim():t===Us.HideState&&this.owner.willHideScrim()},didTransition(){const t=this.owner.displayState;t===Us.ShowingState?this.owner.didShowScrim():t===Us.HidingState&&this.owner.didHideScrim()}})],Us.prototype,"backgroundColor",void 0);class zs extends Xn{constructor(t){super(t),this.sourceFrame=null,this.displayState=zs.HiddenState,this.modality=!1,this.allowedPlacement=["top","bottom","right","left"],this.currentPlacement="none",this.onClick=this.onClick.bind(this),this.initArrow()}initArrow(){const t=this.createArrow();null!==t&&this.prependChild(t,"arrow")}createArrow(){const t=Xn.fromTag("div");return t.addClass("popover-arrow"),t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.width.setState(0,i.Affinity.Intrinsic),t.height.setState(0,i.Affinity.Intrinsic),t}setDisplayState(t){this.displayState=t}setSource(t){this.source.setView(t)}get modalView(){return this}get modalState(){switch(this.displayState){case zs.HiddenState:return"hidden";case zs.HidingState:case zs.HideState:return"hiding";case zs.ShownState:return"shown";case zs.ShowingState:case zs.ShowState:return"showing";default:throw new Error(""+this.displayState)}}isShown(){switch(this.displayState){case zs.ShownState:case zs.ShowingState:case zs.ShowState:return!0;default:return!1}}isHidden(){switch(this.displayState){case zs.HiddenState:case zs.HidingState:case zs.HideState:return!0;default:return!1}}showModal(t,i){this.isHidden()&&(i=void 0===i||!0===i?this.getLookOr(St.timing,!1):e.Timing.fromAny(i),void 0!==t.modal&&(this.modality=t.modal),this.setDisplayState(zs.ShowState),!1!==i?this.displayPhase.setState(1,i):(this.willShowPopover(),this.didShowPopover()))}willShowPopover(){this.setDisplayState(zs.ShowingState);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.popoverWillShow&&i.popoverWillShow(this)}this.place(),this.visibility.setState("visible",i.Affinity.Intrinsic)}didShowPopover(){this.setDisplayState(zs.ShownState),this.pointerEvents.setState("auto",i.Affinity.Intrinsic),this.marginTop.setState(null,i.Affinity.Intrinsic),this.opacity.setState(void 0,i.Affinity.Intrinsic);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.popoverDidShow&&i.popoverDidShow(this)}}hideModal(t){this.isShown()&&(t=void 0===t||!0===t?this.getLookOr(St.timing,!1):e.Timing.fromAny(t),this.setDisplayState(zs.HideState),!1!==t?this.displayPhase.setState(0,t):(this.willHidePopover(),this.didHidePopover()))}willHidePopover(){this.setDisplayState(zs.HidingState);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.popoverWillHide&&i.popoverWillHide(this)}this.pointerEvents.setState("none",i.Affinity.Intrinsic)}didHidePopover(){this.setDisplayState(zs.HiddenState),this.visibility.setState("hidden",i.Affinity.Intrinsic),this.marginTop.setState(null,i.Affinity.Intrinsic),this.opacity.setState(void 0,i.Affinity.Intrinsic);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.popoverDidHide&&i.popoverDidHide(this)}}placement(t){return void 0===t?this.allowedPlacement:(e.Arrays.equal(this.allowedPlacement,t)||(this.allowedPlacement.length=0,this.allowedPlacement.push(...t),this.place()),this)}onMount(){super.onMount(),this.attachEvents()}onUnmount(){super.onUnmount(),this.detachEvents()}attachEvents(){this.on("click",this.onClick)}detachEvents(){this.off("click",this.onClick)}needsProcess(t,e){return 0!=(t&(pn.NeedsScroll|pn.NeedsAnimate))&&this.requireUpdate(pn.NeedsLayout),t}onAnimate(t){super.onAnimate(t);const e=this.displayState;e===zs.ShowState?this.willShowPopover():e===zs.HideState?this.willHidePopover():e!==zs.ShowingState||this.displayPhase.tweening?e!==zs.HidingState||this.displayPhase.tweening||this.didHidePopover():this.didShowPopover(),this.displayPhase.tweening&&this.applyDisplayPhase(this.displayPhase.value)}applyDisplayPhase(t){const e=this.currentPlacement;"above"===e?(this.opacity.setState(void 0,i.Affinity.Intrinsic),this.marginTop.setState((1-t)*-this.node.clientHeight,i.Affinity.Intrinsic)):"below"===e?(this.opacity.setState(void 0,i.Affinity.Intrinsic),this.marginTop.setState((1-t)*this.node.clientHeight,i.Affinity.Intrinsic)):(this.marginTop.setState(null,i.Affinity.Intrinsic),this.opacity.setState(t,i.Affinity.Intrinsic))}onLayout(t){super.onLayout(t),this.place()}place(t=!1){const e=this.source.view,i=this.sourceFrame,n=null!==e?e.popoverFrame:null;if(null===n||0===this.allowedPlacement.length||!t&&n.equals(i))return"none";{this.sourceFrame=null;const t=this.placePopover(e,n),i=this.getChild("arrow");return i instanceof Xn&&this.placeArrow(e,n,i,t),t}}placePopover(t,e){const n=this.node,s=n.offsetParent;if(null===s)return"none";const r=n.clientWidth,l=n.clientHeight,a=s.getBoundingClientRect(),h=a.left,c=a.top,d=e.left-window.pageXOffset-h,u=e.right-window.pageXOffset-h,p=e.top-window.pageYOffset-c,f=e.bottom-window.pageYOffset-c,g=e.width,v=e.height,w=d+g/2,y=p+v/2,m=this.placementFrame.value,b=null!==m?m.left:0,C=(null!==m?m.right:window.innerWidth)-h,S=null!==m?m.top:0,A=(null!==m?m.bottom:window.innerHeight)-c,x=d-b-window.pageXOffset,T=C-d-g,D=p-S-window.pageYOffset,V=A-p-v,P=this.dropdown.value,I=this.arrowHeight.getValue().pxValue(),M=this.placementGap.getValue().pxValue();let L;const k=this.allowedPlacement;for(let t=0,e=k.length;t<e;t+=1){const e=k[t];if("above"===e||"below"===e||"over"===e){L=e;break}if("top"===e&&l+I+M<=D){L=e;break}if("bottom"===e&&l+I+M<=V){L=e;break}if("left"===e&&r+I+M<=x){L=e;break}if("right"===e&&r+I+M<=T){L=e;break}}if(void 0===L){L="none";for(let t=0,e=k.length;t<e;t+=1){const e=k[t];if("top"===e&&D>=V){L=e;break}if("bottom"===e&&V>=D){L=e;break}if("left"===e&&x>=T){L=e;break}if("right"===e&&T>=x){L=e;break}}}let F=n.offsetLeft,R=n.offsetTop,O=null,W=null,E=this.width.state;E=E instanceof o.Length?E.pxValue():null;let N=this.height.state;N=N instanceof o.Length?N.pxValue():null;let B=E,U=N,z=this.maxWidth.state;z=z instanceof o.Length?z.pxValue():null;let q=this.maxHeight.state;q=q instanceof o.Length?q.pxValue():null;let G=z,H=q;return"above"===L?(F=Math.round(b),R=Math.round(S),O=Math.round((null!==m?m.width:window.innerWidth)-C),B=Math.round(Math.max(0,C-b)),U=null,G=null,H=Math.round(Math.max(0,A-S))):"below"===L?(F=Math.round(b),R=Math.round(A-l),O=Math.round(C-(null!==m?m.width:window.innerWidth)),B=Math.round(Math.max(0,C-b)),U=null,G=null,H=Math.round(Math.max(0,A-S))):"over"===L?(F=Math.round(b),R=Math.round(S),O=Math.round(C-(null!==m?m.width:window.innerWidth)),W=Math.round(A-(null!==m?m.height:window.innerHeight)),B=Math.round(Math.max(0,C-b)),U=Math.round(Math.max(0,A-S)),G=null,H=null):"top"!==L||P?"bottom"!==L||P?"left"!==L||P?"right"!==L||P?"top"===L&&P?(F=Math.max(b,d),R=Math.round(Math.max(S,p-(l+M))),B=Math.round(Math.max(0,Math.min(g,C-d))),U=null,G=Math.round(Math.max(0,C-b)),H=Math.round(Math.max(0,f-S))):"bottom"===L&&P?(F=Math.max(b,d),R=Math.round(Math.max(S,f+M)),B=Math.round(Math.max(0,Math.min(g,C-d))),U=null,G=Math.round(Math.max(0,C-b)),H=Math.round(Math.max(0,A-p))):"left"===L&&P?(F=Math.round(Math.max(b,d-(r+M))),R=Math.max(S,p),B=null,U=Math.round(Math.max(0,Math.min(v,A-p))),G=Math.round(Math.max(0,u-b)),H=Math.round(Math.max(0,A-S))):"right"===L&&P&&(F=Math.round(Math.max(b,u+M)),R=Math.max(S,p),B=null,U=Math.round(Math.max(0,Math.min(v,A-p))),G=Math.round(Math.max(0,C-d)),H=Math.round(Math.max(0,A-S))):(F=Math.round(Math.max(b,u+I+M)),R=y-l/2<=S?Math.round(S):y+l/2>=A?Math.round(A-l):Math.round(y-l/2),G=Math.round(Math.max(0,C-d)),H=Math.round(Math.max(0,A-S))):(F=Math.round(Math.max(b,d-(r+I+M))),R=y-l/2<=S?Math.round(S):y+l/2>=A?Math.round(A-l):Math.round(y-l/2),G=Math.round(Math.max(0,u-b)),H=Math.round(Math.max(0,A-S))):(F=w-r/2<=b?Math.round(b):w+r/2>=C?Math.round(C-r):Math.round(w-r/2),R=Math.round(Math.max(S,f+I+M)),G=Math.round(Math.max(0,C-b)),H=Math.round(Math.max(0,A-p))):(F=w-r/2<=b?Math.round(b):w+r/2>=C?Math.round(C-r):Math.round(w-r/2),R=Math.round(Math.max(S,p-(l+I+M))),G=Math.round(Math.max(0,C-b)),H=Math.round(Math.max(0,f-S))),"none"!==L&&(F!==n.offsetLeft&&this.left.hasAffinity(i.Affinity.Intrinsic)||R!==n.offsetTop&&this.top.hasAffinity(i.Affinity.Intrinsic)||B!==E&&this.width.hasAffinity(i.Affinity.Intrinsic)||U!==N&&this.height.hasAffinity(i.Affinity.Intrinsic)||G!==z&&this.maxWidth.hasAffinity(i.Affinity.Intrinsic)||H!==q&&this.maxHeight.hasAffinity(i.Affinity.Intrinsic))&&(this.willPlacePopover(L),this.position.setState("absolute",i.Affinity.Intrinsic),this.left.setState(F,i.Affinity.Intrinsic),this.right.setState(O,i.Affinity.Intrinsic),this.top.setState(R,i.Affinity.Intrinsic),this.bottom.setState(W,i.Affinity.Intrinsic),this.width.setState(B,i.Affinity.Intrinsic),this.height.setState(U,i.Affinity.Intrinsic),this.maxWidth.setState(G,i.Affinity.Intrinsic),this.maxHeight.setState(H,i.Affinity.Intrinsic),this.onPlacePopover(L),this.didPlacePopover(L)),this.currentPlacement=L,L}willPlacePopover(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.popoverWillPlace&&n.popoverWillPlace(t,this)}}onPlacePopover(t){}didPlacePopover(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.popoverDidPlace&&n.popoverDidPlace(t,this)}}placeArrow(t,e,n,s){const r=this.node,l=r.offsetParent;if(null===l)return;const a=l.getBoundingClientRect(),h=a.left,c=a.top,d=e.left-window.pageXOffset-h,u=e.top-window.pageYOffset-c,p=d+e.width/2,f=u+e.height/2,g=r.offsetLeft,v=g+r.clientWidth,w=r.offsetTop,y=w+r.clientHeight;let m=this.backgroundColor.value;null===m&&(m=B.transparent());const b=this.borderRadius(),C=b instanceof o.Length?b.pxValue():0,S=this.arrowWidth.getValue().pxValue(),A=this.arrowHeight.getValue().pxValue(),x=g+C+S/2,T=v-C-S/2,D=w+C+S/2,V=y-C-S/2;n.top.setState(null,i.Affinity.Intrinsic),n.right.setState(null,i.Affinity.Intrinsic),n.bottom.setState(null,i.Affinity.Intrinsic),n.left.setState(null,i.Affinity.Intrinsic),n.borderLeftWidth.setState(null,i.Affinity.Intrinsic),n.borderLeftStyle.setState(void 0,i.Affinity.Intrinsic),n.borderLeftColor.setState(null,i.Affinity.Intrinsic),n.borderRightWidth.setState(null,i.Affinity.Intrinsic),n.borderRightStyle.setState(void 0,i.Affinity.Intrinsic),n.borderRightColor.setState(null,i.Affinity.Intrinsic),n.borderTopWidth.setState(null,i.Affinity.Intrinsic),n.borderTopStyle.setState(void 0,i.Affinity.Intrinsic),n.borderTopColor.setState(null,i.Affinity.Intrinsic),n.borderBottomWidth.setState(null,i.Affinity.Intrinsic),n.borderBottomStyle.setState(void 0,i.Affinity.Intrinsic),n.borderBottomColor.setState(null,i.Affinity.Intrinsic),n.zIndex.setState(100,i.Affinity.Intrinsic),"none"===s||"above"===s||"below"===s||"over"===s?n.display.setState("none",i.Affinity.Intrinsic):Math.round(f)<=Math.round(w-A)&&x<=p&&p<=T?(n.display.setState("block",i.Affinity.Intrinsic),n.top.setState(Math.round(-A),i.Affinity.Intrinsic),n.left.setState(Math.round(p-g-S/2),i.Affinity.Intrinsic),n.borderLeftWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderLeftStyle.setState("solid",i.Affinity.Intrinsic),n.borderLeftColor.setState(B.transparent(),i.Affinity.Intrinsic),n.borderRightWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderRightStyle.setState("solid",i.Affinity.Intrinsic),n.borderRightColor.setState(B.transparent(),i.Affinity.Intrinsic),n.borderBottomWidth.setState(Math.round(A),i.Affinity.Intrinsic),n.borderBottomStyle.setState("solid",i.Affinity.Intrinsic),n.borderBottomColor.setState(m,i.Affinity.Intrinsic)):Math.round(y+A)<=Math.round(f)&&x<=p&&p<=T?(n.display.setState("block",i.Affinity.Intrinsic),n.bottom.setState(Math.round(-A),i.Affinity.Intrinsic),n.left.setState(Math.round(p-g-S/2),i.Affinity.Intrinsic),n.borderLeftWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderLeftStyle.setState("solid",i.Affinity.Intrinsic),n.borderLeftColor.setState(B.transparent(),i.Affinity.Intrinsic),n.borderRightWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderRightStyle.setState("solid",i.Affinity.Intrinsic),n.borderRightColor.setState(B.transparent(),i.Affinity.Intrinsic),n.borderTopWidth.setState(Math.round(A),i.Affinity.Intrinsic),n.borderTopStyle.setState("solid",i.Affinity.Intrinsic),n.borderTopColor.setState(m,i.Affinity.Intrinsic)):Math.round(p)<=Math.round(g-A)&&D<=f&&f<=V?(n.display.setState("block"),n.left.setState(Math.round(-A),i.Affinity.Intrinsic),n.top.setState(Math.round(f-w-S/2),i.Affinity.Intrinsic),n.borderTopWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderTopStyle.setState("solid",i.Affinity.Intrinsic),n.borderTopColor.setState(B.transparent(),i.Affinity.Intrinsic),n.borderBottomWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderBottomStyle.setState("solid",i.Affinity.Intrinsic),n.borderBottomColor.setState(B.transparent(),i.Affinity.Intrinsic),n.borderRightWidth.setState(Math.round(A),i.Affinity.Intrinsic),n.borderRightStyle.setState("solid",i.Affinity.Intrinsic),n.borderRightColor.setState(m,i.Affinity.Intrinsic)):Math.round(v+A)<=Math.round(p)&&D<=f&&f<=V?(n.display.setState("block",i.Affinity.Intrinsic),n.right.setState(Math.round(-A),i.Affinity.Intrinsic),n.top.setState(Math.round(f-w-S/2),i.Affinity.Intrinsic),n.borderTopWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderTopStyle.setState("solid",i.Affinity.Intrinsic),n.borderTopColor.setState(B.transparent(),i.Affinity.Intrinsic),n.borderBottomWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderBottomStyle.setState("solid",i.Affinity.Intrinsic),n.borderBottomColor.setState(B.transparent(),i.Affinity.Intrinsic),n.borderLeftWidth.setState(Math.round(A),i.Affinity.Intrinsic),n.borderLeftStyle.setState("solid",i.Affinity.Intrinsic),n.borderLeftColor.setState(m,i.Affinity.Intrinsic)):n.display.setState("none",i.Affinity.Intrinsic)}onClick(t){t.stopPropagation()}init(t){super.init(t),void 0!==t.source&&this.source.setView(t.source),void 0!==t.placement&&this.placement(t.placement),void 0!==t.placementFrame&&this.placementFrame(t.placementFrame),void 0!==t.arrowWidth&&this.arrowWidth(t.arrowWidth),void 0!==t.arrowHeight&&this.arrowHeight(t.arrowHeight)}}zs.HiddenState=0,zs.HidingState=1,zs.HideState=2,zs.ShownState=3,zs.ShowingState=4,zs.ShowState=5,u([Dn({propertyNames:"background-color",type:B,value:null,didSetValue(t,e){this.owner.place()}})],zs.prototype,"backgroundColor",void 0),u([zt({type:Number,value:0})],zs.prototype,"displayPhase",void 0),u([zt({type:o.Length,value:o.Length.zero()})],zs.prototype,"placementGap",void 0),u([zt({type:o.Length,value:o.Length.px(10)})],zs.prototype,"arrowWidth",void 0),u([zt({type:o.Length,value:o.Length.px(8)})],zs.prototype,"arrowHeight",void 0),u([gn({implements:!0,observes:!0,willAttachView(t){this.owner.callObservers("popoverWillAttachSource",t,this.owner)},didAttachView(t){this.owner.requireUpdate(pn.NeedsLayout)},didDetachView(t){this.owner.callObservers("popoverDidDetachSource",t,this.owner)},viewDidMount(t){this.owner.place()},viewDidResize(t,e){this.owner.place()},viewDidScroll(t,e){this.owner.place()},viewDidAnimate(t,e){this.owner.place()},viewDidLayout(t,e){this.owner.place()},viewDidProject(t,e){this.owner.place()},viewDidSetAttribute(t,e,i){this.owner.place()},viewDidSetStyle(t,e,i,n){this.owner.place()}})],zs.prototype,"source",void 0),u([i.Property({type:o.R2Box,value:null,didSetValue(t){this.owner.place()},fromAny:t=>null!==t?o.R2Box.fromAny(t):null})],zs.prototype,"placementFrame",void 0),u([i.Property({type:Boolean,value:!1,didSetValue(t){this.owner.place()}})],zs.prototype,"dropdown",void 0);class qs extends Xn{constructor(t){super(t),this.modality=!0,this.initDrawer()}initDrawer(){this.addClass("drawer"),this.display.setState("flex",i.Affinity.Intrinsic),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("auto",i.Affinity.Intrinsic),this.overscrollBehaviorY.setState("contain",i.Affinity.Intrinsic),this.overflowScrolling.setState("touch",i.Affinity.Intrinsic)}isHorizontal(){return"top"===this.placement.value||"bottom"===this.placement.value}isVertical(){return"left"===this.placement.value||"right"===this.placement.value}willSetPlacement(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.viewWillSetPlacement&&o.viewWillSetPlacement(t,e,this)}}onSetPlacement(t,e){}didSetPlacement(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.viewDidSetPlacement&&o.viewDidSetPlacement(t,e,this)}}willPresent(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewWillPresent&&i.viewWillPresent(this)}}didPresent(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidPresent&&i.viewDidPresent(this)}}willDismiss(){const t=this.modalProvider.service;null!=t&&t.dismissModal(this);const e=this.observers;for(let t=0,i=e.length;t<i;t+=1){const i=e[t];void 0!==i.viewWillDismiss&&i.viewWillDismiss(this)}}didDismiss(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidDismiss&&i.viewDidDismiss(this)}}willExpand(){const t=this.modalProvider.service;null!=t&&t.dismissModal(this);const e=this.observers;for(let t=0,i=e.length;t<i;t+=1){const i=e[t];void 0!==i.viewWillExpand&&i.viewWillExpand(this)}}didExpand(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidExpand&&i.viewDidExpand(this)}}willCollapse(){const t=this.modalProvider.service;null!=t&&t.dismissModal(this);const e=this.observers;for(let t=0,i=e.length;t<i;t+=1){const i=e[t];void 0!==i.viewWillCollapse&&i.viewWillCollapse(this)}}didCollapse(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidCollapse&&i.viewDidCollapse(this)}}onLayout(t){super.onLayout(t),this.display.setState(this.slide.dismissed?"none":"flex",i.Affinity.Intrinsic),this.layoutDrawer(t),"mobile"===t.viewportIdiom?this.boxShadow.setState(this.getLookOr(St.shadow,Ot.floating,null),i.Affinity.Intrinsic):this.boxShadow.setState(this.getLookOr(St.shadow,null),i.Affinity.Intrinsic)}layoutDrawer(t){const e=this.placement.value;"top"===e?this.layoutDrawerTop(t):"right"===e?this.layoutDrawerRight(t):"bottom"===e?this.layoutDrawerBottom(t):"left"===e&&this.layoutDrawerLeft(t)}layoutDrawerTop(t){const e=this.slide.getPhase();this.addClass("drawer-top").removeClass("drawer-right").removeClass("drawer-bottom").removeClass("drawer-left"),this.position.setState("fixed",i.Affinity.Intrinsic),this.width.setState(null,i.Affinity.Intrinsic),this.height.setState(null,i.Affinity.Intrinsic),this.left.setState(o.Length.zero(),i.Affinity.Intrinsic),this.right.setState(o.Length.zero(),i.Affinity.Intrinsic),this.bottom.setState(null,i.Affinity.Intrinsic);let n=this.height.value;null===n&&(n=o.Length.px(this.node.offsetHeight)),this.top.setState(n.times(e-1),i.Affinity.Intrinsic),this.effectiveWidth.setValue(this.width.value),this.effectiveHeight.setValue(n.times(e),i.Affinity.Intrinsic);let s=this.edgeInsets.superValue;null==s&&(s=t.viewport.safeArea),this.edgeInsets.setValue({insetTop:0,insetRight:s.insetRight,insetBottom:0,insetLeft:s.insetLeft},i.Affinity.Intrinsic),this.stretch.collapsed&&this.expand()}layoutDrawerRight(t){const e=this.stretch.getPhase(),n=this.slide.getPhase();let s;if(this.removeClass("drawer-top").addClass("drawer-right").removeClass("drawer-bottom").removeClass("drawer-left"),this.position.setState("fixed",i.Affinity.Intrinsic),this.height.setState(null,i.Affinity.Intrinsic),this.top.setState(o.Length.zero(),i.Affinity.Intrinsic),this.bottom.setState(o.Length.zero(),i.Affinity.Intrinsic),this.left.setState(null,i.Affinity.Intrinsic),this.width.hasAffinity(i.Affinity.Intrinsic)){const t=this.collapsedWidth.getValue(),i=this.expandedWidth.getValue();s=t.times(1-e).plus(i.times(e))}else s=this.width.value,null===s&&(s=o.Length.px(this.node.offsetWidth));this.width.setState(s,i.Affinity.Intrinsic),this.right.setState(s.times(n-1),i.Affinity.Intrinsic),this.effectiveWidth.setValue(s.times(n),i.Affinity.Intrinsic),this.effectiveHeight.setValue(this.height.value,i.Affinity.Intrinsic);let r=this.edgeInsets.superValue;null!=r&&null!==r||(r=t.viewport.safeArea),this.paddingTop.setState(o.Length.px(r.insetTop),i.Affinity.Intrinsic),this.paddingBottom.setState(o.Length.px(r.insetBottom),i.Affinity.Intrinsic),this.edgeInsets.setValue({insetTop:0,insetRight:r.insetRight,insetBottom:0,insetLeft:0},i.Affinity.Intrinsic)}layoutDrawerBottom(t){const e=this.slide.getPhase();this.removeClass("drawer-top").removeClass("drawer-right").addClass("drawer-bottom").removeClass("drawer-left"),this.position.setState("fixed",i.Affinity.Intrinsic),this.width.setState(null,i.Affinity.Intrinsic),this.height.setState(null,i.Affinity.Intrinsic),this.left.setState(o.Length.zero(),i.Affinity.Intrinsic),this.right.setState(o.Length.zero(),i.Affinity.Intrinsic),this.top.setState(null,i.Affinity.Intrinsic);let n=this.height.value;null===n&&(n=o.Length.px(this.node.offsetHeight)),this.bottom.setState(n.times(e-1),i.Affinity.Intrinsic),this.effectiveWidth.setValue(this.width.value,i.Affinity.Intrinsic),this.effectiveHeight.setValue(n.times(e),i.Affinity.Intrinsic);let s=this.edgeInsets.superValue;null!=s&&null!==s||(s=t.viewport.safeArea),this.edgeInsets.setValue({insetTop:0,insetRight:s.insetRight,insetBottom:0,insetLeft:s.insetLeft},i.Affinity.Intrinsic),this.stretch.collapsed&&this.expand()}layoutDrawerLeft(t){const e=this.stretch.getPhase(),n=this.slide.getPhase();let s;if(this.removeClass("drawer-top").removeClass("drawer-right").removeClass("drawer-bottom").addClass("drawer-left"),this.position.setState("fixed",i.Affinity.Intrinsic),this.height.setState(null,i.Affinity.Intrinsic),this.top.setState(o.Length.zero(),i.Affinity.Intrinsic),this.bottom.setState(o.Length.zero(),i.Affinity.Intrinsic),this.right.setState(null,i.Affinity.Intrinsic),this.width.hasAffinity(i.Affinity.Intrinsic)){const t=this.collapsedWidth.getValue(),i=this.expandedWidth.getValue();s=t.times(1-e).plus(i.times(e))}else s=this.width.value,null===s&&(s=o.Length.px(this.node.offsetWidth));this.width.setState(s,i.Affinity.Intrinsic),this.left.setState(s.times(n-1),i.Affinity.Intrinsic),this.effectiveWidth.setValue(s.times(n),i.Affinity.Intrinsic),this.effectiveHeight.setValue(this.height.value,i.Affinity.Intrinsic);let r=this.edgeInsets.superValue;null!=r&&null!==r||(r=t.viewport.safeArea),this.paddingTop.setState(o.Length.px(r.insetTop),i.Affinity.Intrinsic),this.paddingBottom.setState(o.Length.px(r.insetBottom),i.Affinity.Intrinsic),this.edgeInsets.setValue({insetTop:0,insetRight:0,insetBottom:0,insetLeft:r.insetLeft},i.Affinity.Intrinsic)}get modalView(){return this}get modalState(){return this.slide.modalState}showModal(t,e){void 0!==t.modal&&(this.modality=t.modal),this.present(e)}hideModal(t){this.dismiss(t)}present(t){t=void 0===t||!0===t?this.getLookOr(St.timing,!1):e.Timing.fromAny(t),this.slide.present(t)}dismiss(t){t=void 0===t||!0===t?this.getLookOr(St.timing,!1):e.Timing.fromAny(t),this.slide.dismiss(t)}expand(t){t=void 0===t||!0===t?this.getLookOr(St.timing,!1):e.Timing.fromAny(t),this.stretch.expand(t)}collapse(t){t=void 0===t||!0===t?this.getLookOr(St.timing,!1):e.Timing.fromAny(t),this.stretch.collapse(t)}toggle(t){if(t=void 0===t||!0===t?this.getLookOr(St.timing,!1):e.Timing.fromAny(t),"mobile"===this.viewportIdiom||this.isHorizontal())if(this.slide.presented)this.slide.dismiss(t);else{this.stretch.expand(t),this.slide.present(t);const e=this.modalProvider.service;null!=e&&e.presentModal(this,{modal:!0})}else this.stretch.toggle(t),this.slide.present(t)}init(t){super.init(t),void 0!==t.placement&&this.placement(t.placement),void 0!==t.collapsedWidth&&this.collapsedWidth(t.collapsedWidth),void 0!==t.expandedWidth&&this.expandedWidth(t.expandedWidth)}}u([$t({type:o.Length,value:o.Length.px(60)})],qs.prototype,"collapsedWidth",void 0),u([$t({type:o.Length,value:o.Length.px(200)})],qs.prototype,"expandedWidth",void 0),u([a.ConstraintProperty({type:o.Length,value:null,toNumber:t=>null!==t?t.pxValue():0})],qs.prototype,"effectiveWidth",void 0),u([a.ConstraintProperty({type:o.Length,value:null,toNumber:t=>null!==t?t.pxValue():0})],qs.prototype,"effectiveHeight",void 0),u([i.Property({type:String,value:"left",updateFlags:pn.NeedsResize|pn.NeedsLayout,willSetValue(t,e){this.owner.willSetPlacement(t,e)},didSetValue(t,e){this.owner.onSetPlacement(t,e),this.owner.didSetPlacement(t,e)}})],qs.prototype,"placement",void 0),u([zt({type:ut,value:ut.presented(),updateFlags:pn.NeedsLayout,willPresent(){this.owner.willPresent()},didPresent(){this.owner.didPresent()},willDismiss(){this.owner.willDismiss()},didDismiss(){this.owner.didDismiss()}})],qs.prototype,"slide",void 0),u([zt({type:ft,value:ft.expanded(),updateFlags:pn.NeedsResize|pn.NeedsLayout,willExpand(){this.owner.willExpand()},didExpand(){this.owner.didExpand()},willCollapse(){this.owner.willCollapse()},didCollapse(){this.owner.didCollapse()}})],qs.prototype,"stretch",void 0),u([i.Property({type:Object,inherits:!0,value:null})],qs.prototype,"edgeInsets",void 0);class Gs extends hs{constructor(t){super(t),this.drawerView=null,this.initIcon()}initButton(){super.initButton(),this.addClass("drawer-button")}initIcon(){this.pushIcon(Gs.hamburgerIcon)}setDrawerView(t){this.drawerView=t}onClick(t){super.onClick(t);const e=this.drawerView;null!==e&&e.toggle()}static get hamburgerIcon(){return Do.create(24,24,"M21,17L21,19L3,19L3,17L21,17ZM21,11L21,13L3,13L3,11L21,11ZM3,5L3,7L21,7L21,5L3,5Z")}}u([e.Lazy],Gs,"hamburgerIcon",null);class Hs{constructor(t,e,i,n,o,s,r){this.key=t,this.grow=e,this.shrink=i,this.basis=n,this.width=o,this.left=s,this.right=r}withGrow(t){return this.copy(this.key,t,this.shrink,this.basis,this.width,this.left,this.right)}withShrink(t){return this.copy(this.key,this.grow,t,this.basis,this.width,this.left,this.right)}withBasis(t){return t=o.Length.fromAny(t),this.copy(this.key,this.grow,this.shrink,t,this.width,this.left,this.right)}resized(t,e,i){return null!==t&&(t=o.Length.fromAny(t)),null!==e&&(e=o.Length.fromAny(e)),null!==i&&(i=o.Length.fromAny(i)),this.copy(this.key,this.grow,this.shrink,this.basis,t,e,i)}copy(t,e,i,n,o,s,r){return new Hs(t,e,i,n,o,s,r)}equivalentTo(t,e){return this===t||t instanceof Hs&&(this.key===t.key&&this.grow===t.grow&&this.shrink===t.shrink&&this.basis.equivalentTo(t.basis,e))}equals(t){return this===t||t instanceof Hs&&(this.key===t.key&&this.grow===t.grow&&this.shrink===t.shrink&&this.basis.equals(t.basis)&&e.Equals(this.width,t.width)&&e.Equals(this.left,t.left)&&e.Equals(this.right,t.right))}debug(t){return t=t.write("DeckPost").write(46).write("create").write(40).debug(this.key).write(", ").debug(this.grow).write(", ").debug(this.shrink).write(", ").debug(this.basis).write(41),null===this.width&&null===this.left&&null===this.right||(t=t.write(46).write("resized").write(40).debug(this.width).write(", ").debug(this.left).write(", ").debug(this.right).write(", ").write(41)),t}toString(){return s.Format.debug(this)}static create(t,e,i,n){return void 0===e&&(e=0),void 0===i&&(i=1),n=void 0!==n?o.Length.fromAny(n):o.Length.zero(),new Hs(t,e,i,n,null,null,null)}static fromAny(t){if(null==t||t instanceof Hs)return t;if("object"==typeof t&&null!==t)return Hs.fromInit(t);throw new TypeError(""+t)}static fromInit(t){let e=t.key;void 0===e&&(e="");let i=t.grow;void 0===i&&(i=0);let n=t.shrink;void 0===n&&(n=1);let s=t.basis;s=void 0!==s?o.Length.fromAny(s):o.Length.zero();let r=t.width;r=null!=r?o.Length.fromAny(r):null;let l=t.left;l=null!=l?o.Length.fromAny(l):null;let a=t.right;return a=null!=a?o.Length.fromAny(a):null,new Hs(e,i,n,s,r,l,a)}}class js{constructor(t,e,i,n,o){this.width=t,this.left=e,this.right=i,this.spacing=n,this.posts=o}lookupPost(t){const e=this.posts;for(let i=0,n=e.length;i<n;i+=1){if(t===e[i].key)return i}}getPost(t){const e=this.posts;if("number"==typeof t){const i=e[t];if(void 0!==i)return i}else if("string"==typeof t)for(let i=0,n=e.length;i<n;i+=1){const n=e[i];if(t===n.key)return n}return null}resized(t,i,n,s){if(t=o.Length.fromAny(t),void 0===i?i=this.left:null!==i&&(i=o.Length.fromAny(i)),void 0===n?n=this.right:null!==n&&(n=o.Length.fromAny(n)),void 0===s?s=this.spacing:null!==s&&(s=o.Length.fromAny(s)),e.Equals(this.width,t)&&e.Equals(this.left,i)&&e.Equals(this.right,n)&&e.Equals(this.spacing,s))return this;{const e=this.posts,o=e.length,r=new Array(o),l=t.pxValue(),a=null!==i?i.pxValue(l):0,h=null!==n?n.pxValue(l):0,c=null!==s?s.pxValue(l):0;let d=0,u=0,p=a+h,f=a;for(let t=0;t<o;t+=1){0!==t&&(p+=c,f+=c);const i=e[t],n=i.basis.pxValue(l);r[t]=i.resized(n,f,l-n-f),d+=i.grow,u+=i.shrink,p+=n,f+=n}if(p<l&&d>0){const t=l-p;let e=a,i=0;for(let n=0;n<o;n+=1){const o=r[n];0!==i&&(p+=c,e+=c);const s=o.basis.pxValue(l)+t*(o.grow/d);r[n]=o.resized(s,e,l-s-e),e+=s,i+=1}}else if(p>l&&u>0){const t=p-l;let e=a,i=0;for(let n=0;n<o;n+=1){const o=r[n];0!==i&&(p+=c,e+=c);const s=o.basis.pxValue(l)-t*(o.shrink/u);r[n]=o.resized(s,e,l-s-e),e+=s,i+=1}}return new js(t,i,n,s,r)}}equivalentTo(t,e){if(this===t)return!0;if(t instanceof js){const i=this.posts,n=t.posts,o=i.length;if(o===n.length){for(let t=0;t<o;t+=1)if(!i[t].equivalentTo(n[t],e))return!1;return!0}}return!1}equals(t){return this===t||t instanceof js&&(e.Equals(this.width,t.width)&&e.Equals(this.left,t.left)&&e.Equals(this.right,t.right)&&e.Equals(this.spacing,t.spacing)&&e.Arrays.equal(this.posts,t.posts))}debug(t){t=t.write("DeckRail").write(46).write("of").write(40);for(let e=0,i=this.posts.length;e<i;e+=1)0!==e&&(t=t.write(", ")),t=t.debug(this.posts[e]);return t=t.write(41),null===this.width&&null===this.left&&null===this.right&&null===this.spacing||(t=t.write(46).write("resized").write(40).debug(this.width).write(", ").debug(this.left).write(", ").debug(this.right).write(", ").debug(this.spacing).write(41)),t}toString(){return s.Format.debug(this)}static of(...t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1)i[n]=Hs.fromAny(t[n]);return new js(null,null,null,null,i)}static create(t){return new js(null,null,null,null,t)}static fromAny(t){if(null==t||t instanceof js)return t;if("object"==typeof t&&null!==t)return js.fromInit(t);throw new TypeError(""+t)}static fromInit(t){let e=t.width;e=null!=e?o.Length.fromAny(e):null;let i=t.left;i=null!=i?o.Length.fromAny(i):null;let n=t.right;n=null!=n?o.Length.fromAny(n):null;let s,r=t.spacing;if(r=null!=r?o.Length.fromAny(r):null,void 0!==t.posts){const e=t.posts.length;s=new Array(e);for(let i=0;i<e;i+=1)s[i]=Hs.fromAny(t.posts[i])}else s=[];return new js(e,i,n,r,s)}}class Ys extends Xn{constructor(t){super(t),this.initSlot()}initSlot(){this.addClass("deck-slot")}}u([i.Property({type:Hs,value:null,inherits:!0})],Ys.prototype,"post",void 0),u([i.Property({type:Hs,value:null})],Ys.prototype,"nextPost",void 0),u([i.Property({type:Hs,value:null})],Ys.prototype,"prevPost",void 0);class Xs extends Ys{constructor(t){super(t),this.itemCount=0,this.item=null,this.initSlider()}initSlider(){this.addClass("deck-slider"),this.position.setState("relative",i.Affinity.Intrinsic)}get colorLook(){return St.color}createItem(t){const e=Xn.fromTag("span");return e.display.setState("flex",i.Affinity.Intrinsic),e.alignItems.setState("center",i.Affinity.Intrinsic),e.whiteSpace.setState("nowrap",i.Affinity.Intrinsic),e.text(t),e}pushItem(t,i){"string"==typeof t&&(t=this.createItem(t));const n=this.itemCount,o=n+1;this.itemCount=o;const s="item"+n,r=this.getFastener(s,gn),l=null!==r?r.view:null,a="item"+o,h=Zs.create(this);Object.defineProperty(h,"name",{value:a,configurable:!0}),h.itemIndex=o,this.willPushItem(t,l),this.item=h,this.setFastener(a,h),h.setView(t),h.insertView(),!1===(i=(void 0!==i||0!==n)&&(void 0===i||!0===i?this.getLookOr(St.timing,Ot.navigating,!1):e.Timing.fromAny(i)))&&this.didPushItem(t,l)}willPushItem(t,e){this.forEachObserver((function(i){void 0!==i.deckSliderWillPushItem&&i.deckSliderWillPushItem(t,e,this)}))}didPushItem(t,e){null!==e&&e.parent===this&&e.remove(),this.forEachObserver((function(i){void 0!==i.deckSliderDidPushItem&&i.deckSliderDidPushItem(t,e,this)}))}popItem(t){const i=this.itemCount,n=i-1;this.itemCount=n;const o="item"+i,s=this.getFastener(o,gn),r=null!==s?s.view:null;if(null!==r){const i="item"+n,o=this.getFastener(i,gn),s=null!==o?o.view:null;this.willPopItem(s,r),this.item=o,null!==o&&o.insertView(),!1===(t=void 0===t||!0===t?this.getLookOr(St.timing,Ot.navigating,!1):e.Timing.fromAny(t))&&this.didPopItem(s,r)}return r}willPopItem(t,e){this.forEachObserver((function(i){void 0!==i.deckSliderWillPopItem&&i.deckSliderWillPopItem(t,e,this)}))}didPopItem(t,e){const i=e.key;if(e.remove(),void 0!==i){const t=this.getFastener(i,gn);null!==t&&t.itemIndex>this.itemCount&&this.setFastener(i,null)}this.forEachObserver((function(i){void 0!==i.deckSliderDidPopItem&&i.deckSliderDidPopItem(t,e,this)}))}didLayout(t){if(!this.deckPhase.tweening){const t=this.deckPhase.value;if(void 0!==t){const e="item"+Math.round(t+1),i=this.getFastener(e,gn),n=null!==i?i.view:null;if(null!==n)this.didPopItem(null!==this.item?this.item.view:null,n);else if(null!==this.item&&null!==this.item.view&&Math.round(t)>0){const e="item"+Math.round(t-1),i=this.getFastener(e,gn),n=null!==i?i.view:null;this.didPushItem(this.item.view,n)}}}super.didLayout(t)}}u([zt({type:Number,inherits:!0,updateFlags:pn.NeedsLayout})],Xs.prototype,"deckPhase",void 0),u([zt({type:Number,value:.5})],Xs.prototype,"slotAlign",void 0);const Ks=function(t){const e=t.extend("DeckSliderItem");return e.prototype.didAttachView=function(t){this.initItem(t)},e.prototype.insertChild=function(t,e,i,n){const o="item"+(this.itemIndex+1);i=t.getChild(o),t.insertChild(e,i,n)},e.prototype.viewDidApplyTheme=function(t,e,n,o){o.color.hasAffinity(i.Affinity.Intrinsic)&&o.color.setState(t.getOr(this.owner.colorLook,e,null),n,i.Affinity.Intrinsic)},e.prototype.viewDidLayout=function(t,e){this.layoutItem(e)},e.prototype.initItem=function(t){t.position.setState("absolute",i.Affinity.Intrinsic)},e.prototype.layoutItem=function(t){const e=this.itemIndex,n=this.owner.slotAlign.getValue();let s=this.owner.width.state;s=s instanceof o.Length?s.pxValue():this.owner.node.offsetWidth;let r=this.owner.height.state;r=r instanceof o.Length?r.pxValue():this.owner.node.offsetHeight;const l=this.owner.deckPhase.getValueOr(0),a=Math.max(this.owner.itemCount,Math.ceil(l)),h=a-1,c=l-h;let d=t.width.state;this.itemWidth=d,d instanceof o.Length?d=d.pxValue(s):(d=t.node.offsetWidth,this.owner.deckPhase.tweening?t.width.setState(d,i.Affinity.Intrinsic):t.width.setState(this.itemWidth,i.Affinity.Intrinsic));const u=s-d;e<h||e===h&&1===c?(t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.height.setState(r,i.Affinity.Intrinsic),t.opacity.setState(0,i.Affinity.Intrinsic),t.setCulled(!0)):e===h?(t.left.setState(u*n*(1-c),i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.height.setState(r,i.Affinity.Intrinsic),t.opacity.setState(1-c,i.Affinity.Intrinsic),t.setCulled(!1)):e===a?(t.left.setState(u*(1-c)+u*n*c,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.height.setState(r,i.Affinity.Intrinsic),t.opacity.setState(c,i.Affinity.Intrinsic),t.setCulled(!1)):(t.left.setState(u,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.height.setState(r,i.Affinity.Intrinsic),t.opacity.setState(0,i.Affinity.Intrinsic),t.setCulled(!0))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).itemIndex=0,i.itemWidth=null,i},e}(gn),Zs=gn.define("DeckSliderItemRef",{extends:Ks,key:!0,type:Xn,observes:!0});class _s extends Ys{constructor(t){super(t),this.labelCount=0,this.label=null,this.initButton()}initButton(){this.addClass("deck-button"),this.position.setState("relative",i.Affinity.Intrinsic),this.userSelect.setState("none",i.Affinity.Intrinsic),this.cursor.setState("pointer",i.Affinity.Intrinsic)}get colorLook(){return St.accentColor}createLabel(t){const e=Xn.fromTag("span");return e.display.setState("flex",i.Affinity.Intrinsic),e.alignItems.setState("center",i.Affinity.Intrinsic),e.whiteSpace.setState("nowrap",i.Affinity.Intrinsic),e.text(t),e}pushLabel(t,i){"string"==typeof t&&(t=this.createLabel(t));const n=this.labelCount,o=n+1;this.labelCount=o;const s="label"+n,r=this.getFastener(s,gn),l=null!==r?r.view:null,a="label"+o,h=tr.create(this);Object.defineProperty(h,"name",{value:a,configurable:!0}),h.labelIndex=o,this.willPushLabel(t,l),this.label=h,this.setFastener(a,h),h.setView(t),h.insertView(),!1===(i=(void 0!==i||0!==n)&&(void 0===i||!0===i?this.getLookOr(St.timing,Ot.navigating,!1):e.Timing.fromAny(i)))&&this.didPushLabel(t,l)}willPushLabel(t,e){this.forEachObserver((function(i){void 0!==i.deckButtonWillPushLabel&&i.deckButtonWillPushLabel(t,e,this)}))}didPushLabel(t,e){null!==e&&e.parent===this&&e.remove(),this.forEachObserver((function(i){void 0!==i.deckButtonDidPushLabel&&i.deckButtonDidPushLabel(t,e,this)}))}popLabel(t){const i=this.labelCount,n=i-1;this.labelCount=n;const o="label"+i,s=this.getFastener(o,gn),r=null!==s?s.view:null;if(null!==r){const i="label"+n,o=this.getFastener(i,gn),s=null!==o?o.view:null;this.willPopLabel(s,r),this.label=o,null!==o&&o.insertView(),!1===(t=void 0===t||!0===t?this.getLookOr(St.timing,Ot.navigating,!1):e.Timing.fromAny(t))&&this.didPopLabel(s,r)}return r}willPopLabel(t,e){this.forEachObserver((function(i){void 0!==i.deckButtonWillPopLabel&&i.deckButtonWillPopLabel(t,e,this)}))}didPopLabel(t,e){const i=e.key;if(e.remove(),void 0!==i){const t=this.getFastener(i,gn);null!==t&&t.labelIndex>this.labelCount&&this.setFastener(i,null)}this.forEachObserver((function(i){void 0!==i.deckButtonDidPopLabel&&i.deckButtonDidPopLabel(t,e,this)}))}didLayout(t){if(!this.deckPhase.tweening){const t=this.deckPhase.value;if(void 0!==t){const e="label"+Math.round(t+1),i=this.getFastener(e,gn),n=null!==i?i.view:null;if(null!==n)this.didPopLabel(null!==this.label?this.label.view:null,n);else if(null!==this.label&&null!==this.label.view&&Math.round(t)>0){const e="label"+Math.round(t-1),i=this.getFastener(e,gn),n=null!==i?i.view:null;this.didPushLabel(this.label.view,n)}}}super.didLayout(t)}}u([i.Property({type:o.Length,value:o.Length.px(12)})],_s.prototype,"iconPadding",void 0),u([zt({type:Number,inherits:!0,updateFlags:pn.NeedsLayout})],_s.prototype,"deckPhase",void 0),u([zt({type:Number,value:0})],_s.prototype,"slotAlign",void 0);const Qs=function(t){const e=t.extend("DeckButtonCloseIcon");return e.prototype.didAttachView=function(t){this.initIcon(t)},e.prototype.insertChild=function(t,e,i,n){t.prependChild(e,n)},e.prototype.viewDidLayout=function(t,e){this.layoutIcon(e)},e.prototype.initIcon=function(t){t.addClass("close-icon"),t.setStyle("position","absolute"),t.pointerEvents.setState("none",i.Affinity.Intrinsic)},e.prototype.layoutIcon=function(t){const e=this.owner.slotAlign.getValue();let n=this.owner.width.state;n=n instanceof o.Length?n.pxValue():this.owner.node.offsetWidth;let s=this.owner.height.state;s=s instanceof o.Length?s.pxValue():this.owner.node.offsetHeight;const r=this.owner.iconPadding.getValue().pxValue(n);let l=t.width.state;l=l instanceof o.Length?l.pxValue():0;let a=t.height.state;a=a instanceof o.Length?a.pxValue():0;const h=this.owner.deckPhase.getValueOr(0),c=Math.min(Math.max(0,h-1),1),d=r+(n-l-r)*e,u=(s-a)/2;t.setStyle("left",d+"px"),t.setStyle("top",u+"px"),t.viewBox.setState("0 0 "+l+" "+a,i.Affinity.Intrinsic),t.opacity.setState(1-c,i.Affinity.Intrinsic)},e}(gn);gn({extends:Qs,key:!0,type:Eo,observes:!0})(_s.prototype,"closeIcon");const Js=function(t){const e=t.extend("DeckButtonBackIcon");return e.prototype.didAttachView=function(t){this.initIcon(t)},e.prototype.insertChild=function(t,e,i,n){t.prependChild(e,n)},e.prototype.viewDidLayout=function(t,e){this.layoutIcon(e)},e.prototype.initIcon=function(t){t.addClass("back-icon"),t.setStyle("position","absolute"),t.pointerEvents.setState("none",i.Affinity.Intrinsic)},e.prototype.layoutIcon=function(t){const e=this.owner.slotAlign.getValue();let n=this.owner.width.state;n=n instanceof o.Length?n.pxValue():this.owner.node.offsetWidth;let s=this.owner.height.state;s=s instanceof o.Length?s.pxValue():this.owner.node.offsetHeight;const r=this.owner.iconPadding.getValue().pxValue(n);let l=t.width.state;l=l instanceof o.Length?l.pxValue():0;let a=t.height.state;a=a instanceof o.Length?a.pxValue():0;const h=this.owner.deckPhase.getValueOr(0),c=Math.max(this.owner.labelCount,Math.ceil(h)),d="label"+c,u=this.owner.getChild(d);let p=r+(n-l-r)*e;const f=(s-a)/2;let g;if(h<=1)g=0,t.iconColor.setState(null,i.Affinity.Intrinsic);else if(null!==u&&h<2){const s=this.owner.parent,r=this.owner.nextPost.value,a=null!==s&&null!==r?s.getChild(r.key):null;let d,f;if(a instanceof Ys){d=a.slotAlign.value,f=a.width.state,f=f instanceof o.Length?f.pxValue():a.node.offsetWidth;let t=a.left.state;t=t instanceof o.Length?t.pxValue():a.node.offsetLeft;let e=this.owner.left.state;e=e instanceof o.Length?e.pxValue():this.owner.node.offsetLeft;f+=t-(e+n)}else d=0,f=0;const v=h-(c-1);let w=u.width.state;w=w instanceof o.Length?w.pxValue(n):u.node.offsetWidth;const y=n-p-l+(f-w)*d;p+=y*(1-v)+y*e*v,g=v;const m=a instanceof Ys?a.getLookOr(a.colorLook,null):null,b=this.owner.getLookOr(this.owner.colorLook,null);null!==m&&null!==b?t.iconColor.setState(m.interpolateTo(b)(v),i.Affinity.Intrinsic):t.iconColor.setState(b,i.Affinity.Intrinsic)}t.setStyle("left",p+"px"),t.setStyle("top",f+"px"),t.viewBox.setState("0 0 "+l+" "+a,i.Affinity.Intrinsic),t.opacity.setState(g,i.Affinity.Intrinsic)},e}(gn);gn({extends:Js,key:!0,type:Eo,observes:!0})(_s.prototype,"backIcon");const $s=function(t){const e=t.extend("DeckButtonLabel");return e.prototype.didAttachView=function(t){this.initLabel(t)},e.prototype.insertChild=function(t,e,i,n){const o="label"+(this.labelIndex+1);i=t.getChild(o),t.insertChild(e,i,n)},e.prototype.viewDidApplyTheme=function(t,e,n,o){o.color.hasAffinity(i.Affinity.Intrinsic)&&o.color.setState(t.getOr(this.owner.colorLook,e,null),n,i.Affinity.Intrinsic)},e.prototype.viewDidLayout=function(t,e){this.layoutLabel(e)},e.prototype.initLabel=function(t){t.position.setState("absolute",i.Affinity.Intrinsic),t.pointerEvents.setState("none",i.Affinity.Intrinsic)},e.prototype.layoutLabel=function(t){const e=this.labelIndex,n=this.owner.slotAlign.getValue();let s=this.owner.width.state;s=s instanceof o.Length?s.pxValue():this.owner.node.offsetWidth;let r=this.owner.height.state;r=r instanceof o.Length?r.pxValue():this.owner.node.offsetHeight;const l=this.owner.parent,a=this.owner.nextPost.value,h=null!==l&&null!==a?l.getChild(a.key):null;let c,d;if(h instanceof Ys){c=h.slotAlign.value,d=h.width.state,d=d instanceof o.Length?d.pxValue():h.node.offsetWidth;let t=h.left.state;t=t instanceof o.Length?t.pxValue():h.node.offsetLeft;let e=this.owner.left.state;e=e instanceof o.Length?e.pxValue():this.owner.node.offsetLeft;d+=t-(e+s)}else c=0,d=0;const u=this.owner.iconPadding.getValue().pxValue(s);let p,f;const g=this.owner.backIcon.view;null!==g?(p=g.width.state,p=p instanceof o.Length?p.pxValue():0,f=g.height.state,f=f instanceof o.Length?f.pxValue():0):(p=0,f=0);const v=this.owner.deckPhase.getValueOr(0),w=Math.max(this.owner.labelCount,Math.ceil(v)),y=w-1,m=v-y;let b=t.width.state;this.labelWidth=b,b instanceof o.Length?b=b.pxValue(s):(b=t.node.offsetWidth,this.owner.deckPhase.tweening?t.width.setState(b,i.Affinity.Intrinsic):t.width.setState(this.labelWidth,i.Affinity.Intrinsic));const C=u+(s-p-u)*n,S=(r-f)/2,A=s-C-p+(d-b)*c;if(e<y||e===y&&1===m)t.left.setState(C+p,i.Affinity.Intrinsic),t.top.setState(S,i.Affinity.Intrinsic),t.height.setState(f,i.Affinity.Intrinsic),t.opacity.setState(0,i.Affinity.Intrinsic),t.setCulled(!0);else if(e===y)t.left.setState(C+p+A*n*(1-m),i.Affinity.Intrinsic),t.top.setState(S,i.Affinity.Intrinsic),t.height.setState(f,i.Affinity.Intrinsic),t.opacity.setState(1-m,i.Affinity.Intrinsic),t.setCulled(!1);else if(e===w){t.left.setState(C+p+(A*(1-m)+A*n*m),i.Affinity.Intrinsic),t.top.setState(S,i.Affinity.Intrinsic),t.height.setState(f,i.Affinity.Intrinsic);const e=h instanceof Ys?h.getLookOr(h.colorLook,null):null,o=this.owner.getLookOr(this.owner.colorLook,null);null!==e&&null!==o?t.color.setState(e.interpolateTo(o)(m),i.Affinity.Intrinsic):t.color.setState(o,i.Affinity.Intrinsic),t.opacity.setState(1,i.Affinity.Intrinsic),t.setCulled(!1)}else t.left.setState(C+p+A,i.Affinity.Intrinsic),t.top.setState(S,i.Affinity.Intrinsic),t.height.setState(f,i.Affinity.Intrinsic),t.opacity.setState(0,i.Affinity.Intrinsic),t.setCulled(!0);this.layoutWidth=C+p+b+u},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).labelIndex=0,i.labelWidth=null,i.layoutWidth=0,i},e}(gn),tr=gn.define("DeckButtonLabelRef",{extends:$s,key:!0,type:Xn,observes:!0});class er extends Xn{constructor(t){super(t),this.initBar(),this.initTheme()}initBar(){this.addClass("deck-bar"),this.position.setState("relative",i.Affinity.Intrinsic),this.height.setState(this.barHeight.value,i.Affinity.Intrinsic),this.userSelect.setState("none",i.Affinity.Intrinsic),this.edgeInsets.setValue({insetTop:0,insetRight:0,insetBottom:0,insetLeft:0},i.Affinity.Intrinsic)}initTheme(){this.modifyTheme(Mt.default,[[Mt.translucent,1],[Mt.primary,1]])}onApplyTheme(t,e,n){super.onApplyTheme(t,e,n),this.backgroundColor.hasAffinity(i.Affinity.Intrinsic)&&this.backgroundColor.setState(t.getOr(St.backgroundColor,e,null),n,i.Affinity.Intrinsic)}onInsertChild(t,e){super.onInsertChild(t,e),t instanceof Ys&&this.onInsertSlot(t)}onInsertSlot(t){t.position.setState("absolute",i.Affinity.Intrinsic)}onResize(t){super.onResize(t),this.resizeBar(t)}resizeBar(t){const e=this.rail.inherited?null:this.rail.value;if(null!=e){const n=this.rail.superValue;let s=null;if(null!=n&&null!==n.width&&(s=n.width.pxValue()),null===s){const t=this.parent;t instanceof Xn&&(s=t.width.state,s=s instanceof o.Length?s.pxValue():t.node.offsetWidth)}null===s&&(s=this.width.state,s=s instanceof o.Length?s.pxValue():this.node.offsetWidth);let r=this.edgeInsets.superValue;null==r&&this.edgeInsets.hasAffinity(i.Affinity.Intrinsic)&&(r=t.viewport.safeArea);const l=null!=r?r.insetTop:0,a=null!=r?r.insetLeft:0,h=null!=r?r.insetRight:0,c=this.itemSpacing.getValueOr(o.Length.zero()).pxValue(s),d=e.resized(s,a,h,c);this.rail.setValue(d),this.height.setState(this.barHeight.value.plus(l),i.Affinity.Intrinsic)}}onLayout(t){super.onLayout(t),this.layoutBar(t)}layoutBar(t){let e=this.edgeInsets.superValue;null==e&&this.edgeInsets.hasAffinity(i.Affinity.Intrinsic)&&(e=t.viewport.safeArea);const n=null!=e?e.insetTop:0;this.height.setState(this.barHeight.value.plus(n),i.Affinity.Intrinsic)}displayChildren(t,e,i){0!=(t&pn.NeedsLayout)?this.layoutChildViews(t,e,i):super.displayChildren(t,e,i)}layoutChildViews(t,e,n){const s=this.rail.value;let r=this.edgeInsets.superValue;null==r&&this.edgeInsets.hasAffinity(i.Affinity.Intrinsic)&&(r=e.viewport.safeArea);let l=this.height.state;l=l instanceof o.Length?l.pxValue():this.node.offsetHeight;const a=null!=r?r.insetTop:0,h=this.barHeight.value;super.displayChildren(t,e,(function(t,e,o){if(t instanceof Ys){const e=t.key,n=null!==s&&void 0!==e?s.lookupPost(e):void 0;if(void 0!==n){const e=s.getPost(n),o=s.getPost(n+1),r=s.getPost(n-1);t.display.setState("flex",i.Affinity.Intrinsic),t.left.setState(e.left,i.Affinity.Intrinsic),t.top.setState(a,i.Affinity.Intrinsic),t.width.setState(e.width,i.Affinity.Intrinsic),t.height.setState(h,i.Affinity.Intrinsic),t.post.setValue(e,i.Affinity.Intrinsic),t.nextPost.setValue(o,i.Affinity.Intrinsic),t.prevPost.setValue(r,i.Affinity.Intrinsic)}else t.display.setState("none",i.Affinity.Intrinsic),t.left.setState(null,i.Affinity.Intrinsic),t.top.setState(null,i.Affinity.Intrinsic),t.width.setState(null,i.Affinity.Intrinsic),t.height.setState(null,i.Affinity.Intrinsic),t.post.setValue(null,i.Affinity.Intrinsic),t.nextPost.setValue(null,i.Affinity.Intrinsic),t.prevPost.setValue(null,i.Affinity.Intrinsic)}n.call(this,t,e,o)}))}didPressBackButton(t){this.forEachObserver((function(e){void 0!==e.deckBarDidPressBackButton&&e.deckBarDidPressBackButton(t,this)}))}didPressCloseButton(t){this.forEachObserver((function(e){void 0!==e.deckBarDidPressCloseButton&&e.deckBarDidPressCloseButton(t,this)}))}}u([i.Property({type:js,value:null})],er.prototype,"rail",void 0),u([zt({type:Number,inherits:!0})],er.prototype,"deckPhase",void 0),u([i.Property({type:o.Length,value:o.Length.px(48),updateFlags:pn.NeedsLayout})],er.prototype,"barHeight",void 0),u([i.Property({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsResize})],er.prototype,"itemSpacing",void 0),u([i.Property({type:Object,inherits:!0,value:null,updateFlags:pn.NeedsResize})],er.prototype,"edgeInsets",void 0);class ir extends Xn{constructor(t){super(t),this.initCard()}initCard(){this.addClass("deck-card"),this.position.setState("relative",i.Affinity.Intrinsic),this.overflowX.setState("auto",i.Affinity.Intrinsic),this.overflowY.setState("auto",i.Affinity.Intrinsic),this.overflowScrolling.setState("touch",i.Affinity.Intrinsic)}onApplyTheme(t,e,n){super.onApplyTheme(t,e,n),this.backgroundColor.hasAffinity(i.Affinity.Intrinsic)&&this.backgroundColor.setState(t.getOr(St.backgroundColor,e,null),n,i.Affinity.Intrinsic)}}u([i.Property({type:Object,inherits:!0,value:null})],ir.prototype,"edgeInsets",void 0),u([i.Property({type:String})],ir.prototype,"cardTitle",void 0),u([gn({type:Xn})],ir.prototype,"backItem",void 0),u([gn({type:Xn})],ir.prototype,"titleView",void 0),u([gn({type:Xn})],ir.prototype,"leftItem",void 0),u([gn({type:Xn})],ir.prototype,"rightItem",void 0);class nr extends Xn{constructor(t){super(t),this.cardCount=0,this.card=null,this.initDeck()}initDeck(){this.addClass("deck"),this.position.setState("relative",i.Affinity.Intrinsic),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic)}pushCard(t,i){if(this.deckPhase.tweening)return;const n=this.cardCount,o=n+1;this.cardCount=o;const s="card"+n,r=this.getFastener(s,gn),l=null!==r?r.view:null,a="card"+o,h=rr.create(this);Object.defineProperty(h,"name",{value:a,configurable:!0}),h.cardIndex=o,this.willPushCard(t,l),this.card=h,this.setFastener(a,h),h.setView(t),h.insertView(),i=(void 0!==i||0!==n)&&(void 0===i||!0===i?this.getLookOr(St.timing,Ot.navigating,!1):e.Timing.fromAny(i)),this.deckPhase.setState(o,i),this.onPushCard(t,l),!1===i&&this.didPushCard(t,l)}willPushCard(t,e){this.forEachObserver((function(i){void 0!==i.deckWillPushCard&&i.deckWillPushCard(t,e,this)}))}onPushCard(t,e){}didPushCard(t,e){null!==e&&e.parent===this&&e.remove(),this.forEachObserver((function(i){void 0!==i.deckDidPushCard&&i.deckDidPushCard(t,e,this)}))}popCard(t){if(this.deckPhase.tweening)return null;const i=this.cardCount,n=i-1;this.cardCount=n;const o="card"+i,s=this.getFastener(o,gn),r=null!==s?s.view:null;if(null!==r){const i="card"+n,o=this.getFastener(i,gn),s=null!==o?o.view:null;this.willPopCard(s,r),this.card=o,null!==o&&o.insertView(),t=void 0===t||!0===t?this.getLookOr(St.timing,Ot.navigating,!1):e.Timing.fromAny(t),this.deckPhase.setState(n,t),this.onPopCard(s,r),!1===t&&this.didPopCard(s,r)}return r}willPopCard(t,e){this.forEachObserver((function(i){void 0!==i.deckWillPopCard&&i.deckWillPopCard(t,e,this)}))}onPopCard(t,e){}didPopCard(t,e){const i=e.key;if(e.remove(),void 0!==i){const t=this.getFastener(i,gn);null!==t&&t.cardIndex>this.cardCount&&this.setFastener(i,null)}this.forEachObserver((function(i){void 0!==i.deckDidPopCard&&i.deckDidPopCard(t,e,this)}))}didLayout(t){if(!this.deckPhase.tweening){const t=this.deckPhase.value;if(void 0!==t){const e="card"+Math.round(t+1),i=this.getFastener(e,gn),n=null!==i?i.view:null;if(null!==n)this.didPopCard(null!==this.card?this.card.view:null,n);else if(null!==this.card&&null!==this.card.view&&Math.round(t)>0){const e="card"+Math.round(t-1),i=this.getFastener(e,gn),n=null!==i?i.view:null;this.didPushCard(this.card.view,n)}}}super.didLayout(t)}didPressBackButton(t){this.forEachObserver((function(e){void 0!==e.deckDidPressBackButton&&e.deckDidPressBackButton(t,this)}))}didPressCloseButton(t){this.forEachObserver((function(e){void 0!==e.deckDidPressCloseButton&&e.deckDidPressCloseButton(t,this)}))}}u([zt({type:Number,value:0,updateFlags:pn.NeedsLayout})],nr.prototype,"deckPhase",void 0),u([i.Property({type:Number,value:1})],nr.prototype,"inAlign",void 0),u([i.Property({type:Number,value:1/3})],nr.prototype,"outAlign",void 0),u([i.Property({type:Object,inherits:!0,value:null,updateFlags:pn.NeedsResize})],nr.prototype,"edgeInsets",void 0);const or=function(t){const e=t.extend("DeckSliderItem");return e.prototype.didAttachView=function(t){this.initBar(t)},e.prototype.insertChild=function(t,e,i,n){t.prependChild(e,n)},e.prototype.viewDidResize=function(t,e){this.resizeBar(e)},e.prototype.initBar=function(t){let e=this.owner.width.state;e=e instanceof o.Length?e:o.Length.px(this.owner.node.offsetWidth),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.width.setState(e,i.Affinity.Intrinsic),t.zIndex.setState(1,i.Affinity.Intrinsic)},e.prototype.resizeBar=function(t){let e=this.owner.width.state;e=e instanceof o.Length?e:o.Length.px(this.owner.node.offsetWidth),t.width.setState(e,i.Affinity.Intrinsic)},e.prototype.deckBarDidPressBackButton=function(t){this.owner.didPressBackButton(t)},e.prototype.deckBarDidPressCloseButton=function(t){this.owner.didPressCloseButton(t)},e}(gn);gn({extends:or,key:!0,type:er,binds:!0,observes:!0})(nr.prototype,"bar");const sr=function(t){const e=t.extend("DeckSliderItem");return e.prototype.didAttachView=function(t){this.initCard(t)},e.prototype.insertChild=function(t,e,i,n){const o="card"+(this.cardIndex+1);i=t.getChild(o),t.insertChild(e,i,n)},e.prototype.viewDidResize=function(t,e){this.resizeCard(e,t)},e.prototype.viewDidLayout=function(t,e){this.layoutCard(e,t)},e.prototype.initCard=function(t){let e=this.owner.edgeInsets.value;void 0===e&&this.owner.edgeInsets.hasAffinity(i.Affinity.Intrinsic)&&(e=this.owner.viewport.safeArea);let n=this.owner.width.state;n=n instanceof o.Length?n:o.Length.px(this.owner.node.offsetWidth);let s=this.owner.height.state;s=s instanceof o.Length?s:o.Length.px(this.owner.node.offsetHeight);let r=null;const l=this.owner.bar.view;null!==l&&(r=l.height.state,r=r instanceof o.Length?r:o.Length.px(l.node.offsetHeight),null!==e&&(e={insetTop:0,insetRight:e.insetRight,insetBottom:e.insetBottom,insetLeft:e.insetLeft})),t.edgeInsets.setValue(e,i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(n,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.width.setState(n,i.Affinity.Intrinsic),t.height.setState(s,i.Affinity.Intrinsic),t.paddingTop.setState(r,i.Affinity.Intrinsic),t.boxSizing.setState("border-box",i.Affinity.Intrinsic),t.zIndex.setState(0,i.Affinity.Intrinsic),t.visibility.setState("hidden",i.Affinity.Intrinsic)},e.prototype.resizeCard=function(t,e){let n=this.owner.edgeInsets.value;void 0===n&&this.owner.edgeInsets.hasAffinity(i.Affinity.Intrinsic)&&(n=e.viewport.safeArea);let s=this.owner.width.state;s=s instanceof o.Length?s:o.Length.px(this.owner.node.offsetWidth);let r=this.owner.height.state;r=r instanceof o.Length?r:o.Length.px(this.owner.node.offsetHeight);let l=null;const a=this.owner.bar.view;null!==a&&(l=a.height.state,l=l instanceof o.Length?l:o.Length.px(a.node.offsetHeight),null!==n&&(n={insetTop:0,insetRight:n.insetRight,insetBottom:n.insetBottom,insetLeft:n.insetLeft})),t.edgeInsets.setValue(n,i.Affinity.Intrinsic),t.width.setState(s,i.Affinity.Intrinsic),t.height.setState(r,i.Affinity.Intrinsic),t.paddingTop.setState(l,i.Affinity.Intrinsic)},e.prototype.layoutCard=function(t,e){let n=t.width.state;n=n instanceof o.Length?n:o.Length.px(t.node.offsetWidth);const s=this.owner.inAlign.value,r=this.owner.outAlign.value,l=this.owner.deckPhase.getValue(),a=Math.max(this.owner.cardCount,Math.ceil(l)),h=a-1,c=l-h,d=this.cardIndex;d<h||d===h&&1===c?(t.left.setState(-n.pxValue()*r,i.Affinity.Intrinsic),t.visibility.setState("hidden",i.Affinity.Intrinsic),t.setCulled(!0)):d===h?(t.left.setState(-n.pxValue()*r*c,i.Affinity.Intrinsic),t.visibility.setState(void 0,i.Affinity.Intrinsic),t.setCulled(!1)):d===a?(t.left.setState(n.pxValue()*s*(1-c),i.Affinity.Intrinsic),t.visibility.setState(void 0,i.Affinity.Intrinsic),t.setCulled(!1)):(t.left.setState(n.pxValue()*s,i.Affinity.Intrinsic),t.visibility.setState("hidden",i.Affinity.Intrinsic),t.setCulled(!0))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).cardIndex=0,i},e}(gn),rr=gn.define("DeckViewCardRef",{extends:sr,key:!0,type:ir,observes:!0});class lr extends er{constructor(t){super(t),this.onBackButtonClick=this.onBackButtonClick.bind(this),this.initRail()}initRail(){const t=Hs.create("backButton",0,0,48),e=Hs.create("titleSlider",1,1),n=Hs.create("moreSlider",0,0,48),o=js.create([t,e,n]);this.rail.setValue(o,i.Affinity.Intrinsic),this.backMembrane.insertView(),this.backButton.insertView(),this.titleSlider.insertView(),this.moreSlider.insertView()}get closeIcon(){return lr.closeIcon}createCloseIcon(){const t=Eo.create();return t.width.setState(24,i.Affinity.Intrinsic),t.height.setState(24,i.Affinity.Intrinsic),t.iconWidth.setState(24,i.Affinity.Intrinsic),t.iconHeight.setState(24,i.Affinity.Intrinsic),t.graphics.setState(this.closeIcon,i.Affinity.Intrinsic),t}initBackMembrane(t){t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.borderTopLeftRadius.setState(4,i.Affinity.Intrinsic),t.borderTopRightRadius.setState(4,i.Affinity.Intrinsic),t.borderBottomLeftRadius.setState(4,i.Affinity.Intrinsic),t.borderBottomRightRadius.setState(4,i.Affinity.Intrinsic),t.overflowX.setState("hidden",i.Affinity.Intrinsic),t.overflowY.setState("hidden",i.Affinity.Intrinsic),t.cursor.setState("pointer",i.Affinity.Intrinsic)}get backIcon(){return lr.backIcon}createBackIcon(){const t=Eo.create();return t.width.setState(24,i.Affinity.Intrinsic),t.height.setState(24,i.Affinity.Intrinsic),t.iconWidth.setState(24,i.Affinity.Intrinsic),t.iconHeight.setState(24,i.Affinity.Intrinsic),t.graphics.setState(this.backIcon,i.Affinity.Intrinsic),t}createBackButton(){const t=_s.create();return t.backIcon.setView(this.createBackIcon()),t.backIcon.insertView(),t}initBackButton(t){t.pointerEvents.setState("none",i.Affinity.Intrinsic)}initTitleSlider(t){t.pointerEvents.setState("none",i.Affinity.Intrinsic)}initMoreSlider(t){}pushTitle(t,e){const i=this.titleSlider.view,n=this.backButton.view;if(null!==i&&null!==n){const o=i.item;let s=null;null!==o&&(s=o.view,o.setView(null),i.item=null),i.pushItem(t,e),null!==s?n.pushLabel(s,e):n.labelCount=i.itemCount}}popTitle(t){const e=this.titleSlider.view,i=this.backButton.view;null!==e&&null!==i&&(e.popItem(t),i.popLabel(t))}didPopBackButton(t,e,i){const n=i.getFastener(e.key,gn);null!==n&&(n.setView(null),i.setFastener(n.key,null));const o=this.titleSlider.view;if(null!==o){const t="item"+o.itemCount,i=o.getFastener(t,gn);null!==i&&i.setView(e),o.item=i,o.appendChild(e,t)}}didLayout(t){const e=this.backMembrane.view,n=this.backButton.view;if(null!==e&&null!==n){if(e.width.hasAffinity(i.Affinity.Intrinsic)){let t=n.left.state;if(t=t instanceof o.Length?t.pxValue():n.node.offsetLeft,null!==n.label)e.width.setState(t+n.label.layoutWidth,i.Affinity.Intrinsic);else{let s=n.height.state;s=s instanceof o.Length?s.pxValue():n.node.offsetWidth,e.width.setState(t+s,i.Affinity.Intrinsic)}}if(e.height.hasAffinity(i.Affinity.Intrinsic)){let t=n.top.state;t=t instanceof o.Length?t.pxValue():n.node.offsetTop;let s=n.height.state;s=s instanceof o.Length?s.pxValue():n.node.offsetHeight,e.height.setState(t+s,i.Affinity.Intrinsic)}if(null!==n.backIcon.view){const t=n.closeIcon.view,o=n.deckPhase.getValueOr(0),s=Math.min(Math.max(0,o-1),1);e.display.setState(null===t&&0===s?"none":"block",i.Affinity.Intrinsic)}}super.didLayout(t)}onBackButtonClick(t){t.stopPropagation();this.deckPhase.getStateOr(0)>1?this.didPressBackButton(t):this.didPressCloseButton(t)}static get closeIcon(){return Do.create(24,24,"M19,6.4L17.6,5L12,10.6L6.4,5L5,6.4L10.6,12L5,17.6L6.4,19L12,13.4L17.6,19L19,17.6L13.4,12Z")}static get backIcon(){return Do.create(24,24,"M11.7,3.9L9.9,2.1L0,12L9.9,21.9L11.7,20.1L3.5,12Z").withFillLook(St.accentColor)}}u([gn({key:!0,type:ss,binds:!0,didAttachView(t){this.owner.initBackMembrane(t),t.on("click",this.owner.onBackButtonClick)},willDetachView(t){t.off("click",this.owner.onBackButtonClick)}})],lr.prototype,"backMembrane",void 0),u([gn({key:!0,type:_s,binds:!0,observes:!0,didAttachView(t){this.owner.initBackButton(t)},createView(){return this.owner.createBackButton()},deckButtonDidPopLabel(t,e,i){this.owner.didPopBackButton(t,e,i)}})],lr.prototype,"backButton",void 0),u([gn({key:!0,type:Xs,binds:!0,didAttachView(t){this.owner.initTitleSlider(t)}})],lr.prototype,"titleSlider",void 0),u([gn({key:!0,type:Xs,binds:!0,didAttachView(t){this.owner.initMoreSlider(t)}})],lr.prototype,"moreSlider",void 0),u([e.Lazy],lr,"closeIcon",null),u([e.Lazy],lr,"backIcon",null);class ar extends io{onLayout(t){super.onLayout(t),this.center.recohere(t.updateTime)}onRender(t){super.onRender(t);const e=t.renderer;if(e instanceof ho&&!this.hidden&&!this.culled){const t=e.context;t.save(),this.renderDial(t,this.viewFrame),t.restore()}}renderDial(t,n){const s=n.width,r=n.height,l=Math.min(s,r),a=this.value.getValue(),h=this.limit.getValue(),c=0!==h?a/h:0,d=this.center.getValue(),u=this.innerRadius.getValue().px(l),p=this.outerRadius.getValue().px(l),f=p.value-u.value,g=this.startAngle.getValue().rad(),v=this.sweepAngle.getValue().rad(),w=this.cornerRadius.getValue().px(f),y=new yo(d,u,p,g,v,o.Angle.zero(),null,w),m=y.withSweepAngle(v.times(c));t.save(),t.beginPath();const b=this.dialColor.value;null!==b&&(t.fillStyle=b.toString()),y.draw(t,n),null!==b&&t.fill(),t.clip();const C=this.meterColor.value;null!==C&&(t.beginPath(),t.fillStyle=C.toString(),m.draw(t,n),t.fill()),t.restore();const S=this.label.view;if(null!==S&&!S.hidden){const t=(u.value+p.value)/2,n=t*Math.cos(g.value+e.Equivalent.Epsilon),s=t*Math.sin(g.value+e.Equivalent.Epsilon);let r;r=n>=0?s>=0?"start":"end":s<0?"end":"start";const l=g.value-Math.PI/2,a=this.labelPadding.getValue().pxValue(f),h=a*Math.cos(l),c=a*Math.sin(l);bo.is(S)&&(S.textAlign.setState(r,i.Affinity.Intrinsic),S.textBaseline.setState("middle",i.Affinity.Intrinsic),S.textOrigin.setState(new o.R2Point(d.x+n+h,d.y+s+c),i.Affinity.Intrinsic))}const A=this.legend.view;if(null!==A&&!A.hidden){const n=this.tickAlign.getValue(),r=g.value+v.value*c*n,a=this.tickRadius.getValue().pxValue(l),h=this.tickLength.getValue().pxValue(s),u=this.tickWidth.getValue().pxValue(l),f=this.tickColor.value,w=d.x,y=d.y,m=p.value*Math.cos(r+e.Equivalent.Epsilon),b=p.value*Math.sin(r+e.Equivalent.Epsilon),C=a*Math.cos(r+e.Equivalent.Epsilon),S=a*Math.sin(r+e.Equivalent.Epsilon);let x,T=0;if(null!==f&&(t.beginPath(),t.lineWidth=u,t.strokeStyle=f.toString(),t.moveTo(w+m,y+b),t.lineTo(w+C,y+S),0!==h&&(C>=0?(t.lineTo(w+h,y+S),T=h-C):C<0&&(t.lineTo(w-h,y+S),T=h+C)),t.stroke()),C>=0?x="end":(T=-T,x="start"),bo.is(A)){const t=this.tickPadding.getValue().pxValue(l);fo.is(A)&&A.fill.setState(f,i.Affinity.Intrinsic),A.textAlign.setState(x,i.Affinity.Intrinsic),A.textBaseline.setState("alphabetic",i.Affinity.Intrinsic),A.textOrigin.setState(new o.R2Point(w+C+T,y+S-t),i.Affinity.Intrinsic)}}}hitTest(t,e,i){const n=i.renderer;if(n instanceof ho){const i=n.transform.transform(t,e);return this.hitTestDial(i.x,i.y,n.context,this.viewFrame)}return null}hitTestDial(t,e,i,n){const s=Math.min(n.width,n.height),r=this.center.getValue(),l=this.innerRadius.getValue().px(s),a=this.outerRadius.getValue().px(s),h=a.value-l.value,c=this.startAngle.getValue(),d=this.sweepAngle.getValue(),u=this.cornerRadius.getValue().px(h),p=new yo(r,l,a,c,d,o.Angle.zero(),null,u);return i.beginPath(),p.draw(i,n),i.isPointInPath(t,e)?this:null}init(t){super.init(t),void 0!==t.value&&this.value(t.value),void 0!==t.limit&&this.limit(t.limit),void 0!==t.center&&this.center(t.center),void 0!==t.innerRadius&&this.innerRadius(t.innerRadius),void 0!==t.outerRadius&&this.outerRadius(t.outerRadius),void 0!==t.startAngle&&this.startAngle(t.startAngle),void 0!==t.sweepAngle&&this.sweepAngle(t.sweepAngle),void 0!==t.cornerRadius&&this.cornerRadius(t.cornerRadius),void 0!==t.dialColor&&this.dialColor(t.dialColor),void 0!==t.meterColor&&this.meterColor(t.meterColor),void 0!==t.labelPadding&&this.labelPadding(t.labelPadding),void 0!==t.tickAlign&&this.tickAlign(t.tickAlign),void 0!==t.tickRadius&&this.tickRadius(t.tickRadius),void 0!==t.tickLength&&this.tickLength(t.tickLength),void 0!==t.tickWidth&&this.tickWidth(t.tickWidth),void 0!==t.tickPadding&&this.tickPadding(t.tickPadding),void 0!==t.tickColor&&this.tickColor(t.tickColor),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor),void 0!==t.arrangement&&this.arrangement(t.arrangement),void 0!==t.label&&this.label(t.label),void 0!==t.legend&&this.legend(t.legend)}}u([i.Animator({type:Number,value:0,updateFlags:pn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetDialValue",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetDialValue",t,e,this.owner)}})],ar.prototype,"value",void 0),u([i.Animator({type:Number,value:1,updateFlags:pn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetDialLimit",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetDialLimit",t,e,this.owner)}})],ar.prototype,"limit",void 0),u([i.Animator({type:o.R2Point,inherits:!0,value:o.R2Point.origin(),updateFlags:pn.NeedsRender})],ar.prototype,"center",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.pct(30),updateFlags:pn.NeedsRender})],ar.prototype,"innerRadius",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.pct(40),updateFlags:pn.NeedsRender})],ar.prototype,"outerRadius",void 0),u([zt({type:o.Angle,inherits:!0,value:o.Angle.rad(-Math.PI/2),updateFlags:pn.NeedsRender})],ar.prototype,"startAngle",void 0),u([zt({type:o.Angle,inherits:!0,value:o.Angle.rad(2*Math.PI),updateFlags:pn.NeedsRender})],ar.prototype,"sweepAngle",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.pct(50),updateFlags:pn.NeedsRender})],ar.prototype,"cornerRadius",void 0),u([zt({type:B,inherits:!0,value:null,look:St.subduedColor,updateFlags:pn.NeedsRender})],ar.prototype,"dialColor",void 0),u([zt({type:B,inherits:!0,value:null,look:St.accentColor,updateFlags:pn.NeedsRender})],ar.prototype,"meterColor",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.pct(25),updateFlags:pn.NeedsRender})],ar.prototype,"labelPadding",void 0),u([zt({type:Number,inherits:!0,value:1,updateFlags:pn.NeedsRender})],ar.prototype,"tickAlign",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.pct(45),updateFlags:pn.NeedsRender})],ar.prototype,"tickRadius",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.pct(50),updateFlags:pn.NeedsRender})],ar.prototype,"tickLength",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.px(1),updateFlags:pn.NeedsRender})],ar.prototype,"tickWidth",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.px(2),updateFlags:pn.NeedsRender})],ar.prototype,"tickPadding",void 0),u([zt({type:B,inherits:!0,value:null,look:St.neutralColor,updateFlags:pn.NeedsRender})],ar.prototype,"tickColor",void 0),u([zt({type:O,inherits:!0,updateFlags:pn.NeedsRender})],ar.prototype,"font",void 0),u([zt({type:B,inherits:!0,look:St.mutedColor,updateFlags:pn.NeedsRender})],ar.prototype,"textColor",void 0),u([gn({key:!0,type:So,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachDialLabel",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachDialLabel",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof So?(this.view.text(t),this.view):So.fromAny(t):io.fromAny(t)}})],ar.prototype,"label",void 0),u([gn({key:!0,type:So,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachDialLegend",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachDialLegend",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof So?(this.view.text(t),this.view):So.fromAny(t):io.fromAny(t)}})],ar.prototype,"legend",void 0),u([i.Property({type:String,value:"auto"})],ar.prototype,"arrangement",void 0);class hr extends S{formatLabel(t,e){}formatLegend(t,e){}}u([i.Property({type:Number,value:0,willSetValue(t,e){this.owner.callObservers("traitWillSetDialValue",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetDialValue",t,e,this.owner)}})],hr.prototype,"value",void 0),u([i.Property({type:Number,value:1,willSetValue(t,e){this.owner.callObservers("traitWillSetDialLimit",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetDialLimit",t,e,this.owner)}})],hr.prototype,"limit",void 0),u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetDialColor",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetDialColor",t,e,this.owner)},fromAny:t=>(null===t||t instanceof St||(t=B.fromAny(t)),t)})],hr.prototype,"dialColor",void 0),u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetMeterColor",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetMeterColor",t,e,this.owner)},fromAny:t=>(null===t||t instanceof St||(t=B.fromAny(t)),t)})],hr.prototype,"meterColor",void 0),u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetDialLabel",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetDialLabel",t,e,this.owner)}})],hr.prototype,"label",void 0),u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetDialLegend",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetDialLegend",t,e,this.owner)}})],hr.prototype,"legend",void 0);class cr extends Zo{updateLabel(t,e,n){if(n.label.hasAffinity(i.Affinity.Intrinsic)){const o=n.formatLabel(t,e);void 0!==o&&n.label.setValue(o,i.Affinity.Intrinsic)}}updateLegend(t,e,n){if(n.legend.hasAffinity(i.Affinity.Intrinsic)){const o=n.formatLegend(t,e);void 0!==o&&n.legend.setValue(o,i.Affinity.Intrinsic)}}setValue(t,n){const o=this.dial.view;null!==o&&o.value.hasAffinity(i.Affinity.Intrinsic)&&(void 0===n||!0===n?!0===(n=this.dialTiming.value)&&(n=o.getLook(St.timing,Ot.ambient)):n=e.Timing.fromAny(n),o.value.setState(t,n,i.Affinity.Intrinsic))}setLimit(t,n){const o=this.dial.view;null!==o&&o.limit.hasAffinity(i.Affinity.Intrinsic)&&(void 0===n||!0===n?!0===(n=this.dialTiming.value)&&(n=o.getLook(St.timing,Ot.ambient)):n=e.Timing.fromAny(n),o.limit.setState(t,n,i.Affinity.Intrinsic))}setDialColor(t,n){const o=this.dial.view;null!==o&&(void 0===n||!0===n?!0===(n=this.dialTiming.value)&&(n=o.getLook(St.timing,Ot.ambient)):n=e.Timing.fromAny(n),t instanceof St?o.dialColor.setLook(t,n,i.Affinity.Intrinsic):o.dialColor.setState(t,n,i.Affinity.Intrinsic))}setMeterColor(t,n){const o=this.dial.view;null!==o&&(void 0===n||!0===n?!0===(n=this.dialTiming.value)&&(n=o.getLook(St.timing,Ot.ambient)):n=e.Timing.fromAny(n),t instanceof St?o.meterColor.setLook(t,n,i.Affinity.Intrinsic):o.meterColor.setState(t,n,i.Affinity.Intrinsic))}createLabelView(t){return"function"==typeof t?t(this.dial.trait):t}setLabelView(t){const e=this.dial.view;if(null!==e){const i=null!==t?this.createLabelView(t):null;e.label.setView(i)}}createLegendView(t){return"function"==typeof t?t(this.dial.trait):t}setLegendView(t){const e=this.dial.view;if(null!==e){const i=null!==t?this.createLegendView(t):null;e.legend.setView(i)}}}u([i.Property({type:e.Timing,inherits:!0})],cr.prototype,"dialTiming",void 0),u([$o({traitType:hr,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachDialTrait",t,this.owner)},didAttachTrait(t){if(null!==this.view){this.owner.setValue(t.value.value),this.owner.setLimit(t.limit.value);const e=t.dialColor.value;null!==e&&this.owner.setDialColor(e);const i=t.meterColor.value;null!==i&&this.owner.setMeterColor(i),this.owner.setLabelView(t.label.value),this.owner.setLegendView(t.legend.value)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachDialTrait",t,this.owner)},traitDidSetDialValue(t,e){this.owner.setValue(t)},traitDidSetDialLimit(t,e){this.owner.setLimit(t)},traitDidSetDialColor(t,e){this.owner.setDialColor(t)},traitDidSetMeterColor(t,e){this.owner.setMeterColor(t)},traitDidSetDialLabel(t,e){this.owner.setLabelView(t)},traitDidSetDialLegend(t,e){this.owner.setLegendView(t)},viewType:ar,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachDialView",t,this.owner)},didAttachView(t){const e=this.trait;if(null!==e){const t=e.dialColor.value;null!==t&&this.owner.setDialColor(t);const i=e.meterColor.value;null!==i&&this.owner.setMeterColor(i)}if(this.owner.label.setView(t.label.view),this.owner.legend.setView(t.legend.view),null!==e){const i=t.value.value,n=t.limit.value;this.owner.updateLabel(i,n,e),this.owner.updateLegend(i,n,e),this.owner.setValue(e.value.value),this.owner.setLimit(e.limit.value),this.owner.setLabelView(e.label.value),this.owner.setLegendView(e.legend.value)}},willDetachView(t){this.owner.label.setView(null),this.owner.legend.setView(null)},didDetachView(t){this.owner.callObservers("controllerDidDetachDialView",t,this.owner)},viewWillSetDialValue(t,e,i){this.owner.callObservers("controllerWillSetDialValue",t,e,this.owner)},viewDidSetDialValue(t,e,i){const n=this.trait;if(null!==n){const e=i.limit.value;this.owner.updateLabel(t,e,n),this.owner.updateLegend(t,e,n)}this.owner.callObservers("controllerDidSetDialValue",t,e,this.owner)},viewWillSetDialLimit(t,e,i){this.owner.callObservers("controllerWillSetDialLimit",t,e,this.owner)},viewDidSetDialLimit(t,e,i){const n=this.trait;if(null!==n){const e=i.value.value;this.owner.updateLabel(e,t,n),this.owner.updateLegend(e,t,n)}this.owner.callObservers("controllerDidSetDialLimit",t,e,this.owner)},viewWillAttachDialLabel(t){this.owner.label.setView(t)},viewDidDetachDialLabel(t){this.owner.label.setView(null)},viewWillAttachDialLegend(t){this.owner.legend.setView(t)},viewDidDetachDialLegend(t){this.owner.legend.setView(null)}})],cr.prototype,"dial",void 0),u([gn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachDialLabelView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachDialLabelView",t,this.owner)}})],cr.prototype,"label",void 0),u([gn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachDialLegendView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachDialLegendView",t,this.owner)}})],cr.prototype,"legend",void 0);class dr extends io{onLayout(t){super.onLayout(t),this.layoutGauge(this.viewFrame)}layoutGauge(t){if(this.center.hasAffinity(i.Affinity.Intrinsic)){const e=(t.xMin+t.xMax)/2,n=(t.yMin+t.yMax)/2;this.center.setState(new o.R2Point(e,n),i.Affinity.Intrinsic)}const e=this.dials.views;let n=0;for(const t in e){"auto"===e[t].arrangement.value&&(n+=1)}const s=Math.min(t.width,t.height),r=this.limit.getValue(),l=this.startAngle.getValue(),a=this.sweepAngle.getValue();let h=this.innerRadius.getValue().pxValue(s);const c=this.outerRadius.getValue().pxValue(s),d=this.dialSpacing.getValue().pxValue(s),u=n>1?(c-h-d*(n-1))/n:c-h;for(const t in e){const n=e[t];if("auto"===n.arrangement.value){if(isFinite(r)){const t=n.limit.getValue();n.limit.setState(Math.max(t,r),i.Affinity.Intrinsic)}n.startAngle.setState(l,i.Affinity.Intrinsic),n.sweepAngle.setState(a,i.Affinity.Intrinsic),n.innerRadius.setState(o.Length.px(h),i.Affinity.Intrinsic),n.outerRadius.setState(o.Length.px(h+u),i.Affinity.Intrinsic),h=h+u+d}}const p=this.title.view;bo.is(p)&&p.textOrigin.setState(this.center.state,i.Affinity.Intrinsic)}init(t){super.init(t),void 0!==t.limit&&this.limit(t.limit),void 0!==t.innerRadius&&this.innerRadius(t.innerRadius),void 0!==t.outerRadius&&this.outerRadius(t.outerRadius),void 0!==t.startAngle&&this.startAngle(t.startAngle),void 0!==t.sweepAngle&&this.sweepAngle(t.sweepAngle),void 0!==t.cornerRadius&&this.cornerRadius(t.cornerRadius),void 0!==t.dialSpacing&&this.dialSpacing(t.dialSpacing),void 0!==t.dialColor&&this.dialColor(t.dialColor),void 0!==t.meterColor&&this.meterColor(t.meterColor),void 0!==t.labelPadding&&this.labelPadding(t.labelPadding),void 0!==t.tickAlign&&this.tickAlign(t.tickAlign),void 0!==t.tickRadius&&this.tickRadius(t.tickRadius),void 0!==t.tickLength&&this.tickLength(t.tickLength),void 0!==t.tickWidth&&this.tickWidth(t.tickWidth),void 0!==t.tickPadding&&this.tickPadding(t.tickPadding),void 0!==t.tickColor&&this.tickColor(t.tickColor),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor),void 0!==t.title&&this.title(t.title);const e=t.dials;if(void 0!==e)for(let t=0,i=e.length;t<i;t+=1){const i=e[t];this.appendChild(ar.fromAny(i),i.key)}}}u([i.Animator({type:Number,value:0,updateFlags:pn.NeedsLayout})],dr.prototype,"limit",void 0),u([i.Animator({type:o.R2Point,value:o.R2Point.origin(),updateFlags:pn.NeedsLayout})],dr.prototype,"center",void 0),u([zt({type:o.Length,value:o.Length.pct(30),updateFlags:pn.NeedsLayout})],dr.prototype,"innerRadius",void 0),u([zt({type:o.Length,value:o.Length.pct(40),updateFlags:pn.NeedsLayout})],dr.prototype,"outerRadius",void 0),u([zt({type:o.Angle,value:o.Angle.rad(-Math.PI/2),updateFlags:pn.NeedsLayout})],dr.prototype,"startAngle",void 0),u([zt({type:o.Angle,value:o.Angle.rad(2*Math.PI),updateFlags:pn.NeedsLayout})],dr.prototype,"sweepAngle",void 0),u([zt({type:o.Length,value:o.Length.pct(50)})],dr.prototype,"cornerRadius",void 0),u([zt({type:o.Length,value:o.Length.px(1),updateFlags:pn.NeedsLayout})],dr.prototype,"dialSpacing",void 0),u([zt({type:B,value:null,look:St.subduedColor})],dr.prototype,"dialColor",void 0),u([zt({type:B,value:null,look:St.accentColor})],dr.prototype,"meterColor",void 0),u([zt({type:o.Length,value:o.Length.pct(25)})],dr.prototype,"labelPadding",void 0),u([zt({type:Number,value:1})],dr.prototype,"tickAlign",void 0),u([zt({type:o.Length,value:o.Length.pct(45)})],dr.prototype,"tickRadius",void 0),u([zt({type:o.Length,value:o.Length.pct(50)})],dr.prototype,"tickLength",void 0),u([zt({type:o.Length,value:o.Length.px(1)})],dr.prototype,"tickWidth",void 0),u([zt({type:o.Length,value:o.Length.px(2)})],dr.prototype,"tickPadding",void 0),u([zt({type:B,value:null,look:St.neutralColor})],dr.prototype,"tickColor",void 0),u([zt({type:O,value:null,inherits:!0})],dr.prototype,"font",void 0),u([zt({type:B,value:null,look:St.mutedColor})],dr.prototype,"textColor",void 0),u([gn({key:!0,type:So,binds:!0,initView(t){bo.is(t)&&(t.textAlign.setState("center",i.Affinity.Intrinsic),t.textBaseline.setState("middle",i.Affinity.Intrinsic),t.textOrigin.setState(this.owner.center.state,i.Affinity.Intrinsic))},willAttachView(t){this.owner.callObservers("viewWillAttachGaugeTitle",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachGaugeTitle",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof So?(this.view.text(t),this.view):So.fromAny(t):io.fromAny(t)}})],dr.prototype,"title",void 0),u([vn({implements:!0,type:ar,binds:!0,observes:!0,willAttachView(t,e){this.owner.callObservers("viewWillAttachDial",t,e,this.owner)},didAttachView(t){const e=t.label.view;null!==e&&this.attachLabelView(e);const i=t.legend.view;null!==i&&this.attachLegendView(i)},willDetachView(t){const e=t.legend.view;null!==e&&this.detachLegendView(e);const i=t.label.view;null!==i&&this.detachLabelView(i)},didDetachView(t){this.owner.callObservers("viewDidDetachDial",t,this.owner)},viewDidSetDialValue(t,e){this.owner.requireUpdate(pn.NeedsLayout)},viewWillAttachDialLabel(t){this.attachLabelView(t)},viewDidDetachDialLabel(t){this.detachLabelView(t)},attachLabelView(t){},detachLabelView(t){},viewWillAttachDialLegend(t){this.attachLegendView(t)},viewDidDetachDialLegend(t){this.detachLegendView(t)},attachLegendView(t){},detachLegendView(t){}})],dr.prototype,"dials",void 0);class ur extends S{startConsumingDials(){const t=this.dials.traits;for(const e in t){t[e].consume(this)}}stopConsumingDials(){const t=this.dials.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingDials()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingDials()}}u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetGaugeTitle",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetGaugeTitle",t,e,this.owner)}})],ur.prototype,"title",void 0),u([i.Property({value:0,willSetValue(t,e){this.owner.callObservers("traitWillSetGaugeLimit",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetGaugeLimit",t,e,this.owner)}})],ur.prototype,"limit",void 0),u([T({type:hr,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachDial",t,e,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachDial",t,this.owner)},detectModel:t=>t.getTrait(hr)})],ur.prototype,"dials",void 0);class pr extends Zo{createTitleView(t,e){return"function"==typeof t?t(e):t}setTitleView(t,e){const i=this.gauge.view;if(null!==i){const n=null!==t?this.createTitleView(t,e):null;i.title.setView(n)}}setLimit(t){const e=this.gauge.view;null!==e&&e.limit.setState(t)}}u([$o({traitType:ur,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachGaugeTrait",t,this.owner)},didAttachTrait(t){const e=t.dials.traits;for(const t in e){const i=e[t];this.owner.dials.addTraitController(i)}null!==this.view&&(this.owner.setTitleView(t.title.value,t),this.owner.setLimit(t.limit.value))},willDetachTrait(t){null!==this.view&&(this.owner.setTitleView(null,t),this.owner.setLimit(0));const e=t.dials.traits;for(const t in e){const i=e[t];this.owner.dials.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachGaugeTrait",t,this.owner)},traitDidSetGaugeTitle(t,e,i){this.owner.setTitleView(t,i)},traitDidSetGaugeLimit(t,e,i){this.owner.setLimit(t)},traitWillAttachDial(t,e){this.owner.dials.addTraitController(t,e)},traitDidDetachDial(t){this.owner.dials.deleteTraitController(t)},viewType:dr,observesView:!0,initView(t){const e=this.owner.dials.controllers;for(const i in e){const n=e[i],o=n.dial.view;null!==o&&null===o.parent&&n.dial.insertView(t)}this.owner.title.setView(t.title.view);const i=this.trait;null!==i&&(this.owner.setTitleView(i.title.value,i),this.owner.setLimit(i.limit.value))},deinitView(t){this.owner.title.setView(null)},willAttachView(t){this.owner.callObservers("controllerWillAttachGaugeView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachGaugeView",t,this.owner)},viewWillAttachGaugeTitle(t){this.owner.title.setView(t)},viewDidDetachGaugeTitle(t){this.owner.title.setView(null)}})],pr.prototype,"gauge",void 0),u([gn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachGaugeTitleView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachGaugeTitleView",t,this.owner)}})],pr.prototype,"title",void 0),u([i.Property({type:e.Timing,value:!0})],pr.prototype,"dialTiming",void 0),u([ns({implements:!0,type:cr,binds:!0,observes:!0,get parentView(){return this.owner.gauge.view},getTraitViewRef:t=>t.dial,willAttachController(t){this.owner.callObservers("controllerWillAttachDial",t,this.owner)},didAttachController(t){const e=t.dial.trait;null!==e&&this.attachDialTrait(e,t);const i=t.dial.view;null!==i&&this.attachDialView(i,t)},willDetachController(t){const e=t.dial.view;null!==e&&this.detachDialView(e,t);const i=t.dial.trait;null!==i&&this.detachDialTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachDial",t,this.owner)},controllerWillAttachDialTrait(t,e){this.owner.callObservers("controllerWillAttachDialTrait",t,e,this.owner),this.attachDialTrait(t,e)},controllerDidDetachDialTrait(t,e){this.detachDialTrait(t,e),this.owner.callObservers("controllerDidDetachDialTrait",t,e,this.owner)},attachDialTrait(t,e){},detachDialTrait(t,e){},controllerWillAttachDialView(t,e){this.owner.callObservers("controllerWillAttachDialView",t,e,this.owner),this.attachDialView(t,e)},controllerDidDetachDialView(t,e){this.detachDialView(t,e),this.owner.callObservers("controllerDidDetachDialView",t,e,this.owner)},attachDialView(t,e){const i=t.label.view;null!==i&&this.attachDialLabelView(i,e);const n=t.legend.view;null!==n&&this.attachDialLegendView(n,e)},detachDialView(t,e){const i=t.legend.view;null!==i&&this.detachDialLegendView(i,e);const n=t.label.view;null!==n&&this.detachDialLabelView(n,e),t.remove()},controllerWillSetDialValue(t,e,i){this.owner.callObservers("controllerWillSetDialValue",t,e,i,this.owner)},controllerDidSetDialValue(t,e,i){this.owner.callObservers("controllerDidSetDialValue",t,e,i,this.owner)},controllerWillSetDialLimit(t,e,i){this.owner.callObservers("controllerWillSetDialLimit",t,e,i,this.owner)},controllerDidSetDialLimit(t,e,i){this.owner.callObservers("controllerDidSetDialLimit",t,e,i,this.owner)},controllerWillAttachDialLabelView(t,e){this.owner.callObservers("controllerWillAttachDialLabelView",t,e,this.owner),this.attachDialLabelView(t,e)},controllerDidDetachDialLabelView(t,e){this.detachDialLabelView(t,e),this.owner.callObservers("controllerDidDetachDialLabelView",t,e,this.owner)},attachDialLabelView(t,e){},detachDialLabelView(t,e){},controllerWillAttachDialLegendView(t,e){this.owner.callObservers("controllerWillAttachDialLegendView",t,e,this.owner),this.attachDialLegendView(t,e)},controllerDidDetachDialLegendView(t,e){this.detachDialLegendView(t,e),this.owner.callObservers("controllerDidDetachDialLegendView",t,e,this.owner)},attachDialLegendView(t,e){},detachDialLegendView(t,e){}})],pr.prototype,"dials",void 0);class fr extends io{onLayout(t){super.onLayout(t),this.center.recohere(t.updateTime)}onRender(t){super.onRender(t);const e=t.renderer;e instanceof ro&&!this.hidden&&!this.culled&&this.renderSlice(e.context,this.viewFrame)}renderSlice(t,n){const s=n.width,r=n.height,l=Math.min(s,r),a=this.value.getValue(),h=this.total.getValue(),c=0!==h?a/h:0,d=this.center.getValue(),u=this.innerRadius.getValue().px(l),p=this.outerRadius.getValue().px(l),f=p.value-u.value,g=this.phaseAngle.getValue().rad(),v=o.Angle.rad(2*Math.PI*c),w=this.padAngle.getValue(),y=this.padRadius.getValueOr(null),m=this.cornerRadius.getValue().px(f),b=new yo(d,u,p,g,v,w,y,m),C=this.sliceColor.value;if(null!==C){const e=t.fillStyle;t.beginPath(),t.fillStyle=C.toString(),b.draw(t,n),t.fill(),t.fillStyle=e}const S=this.label.view;if(null!==S&&!S.hidden){const t=this.labelRadius.getValue().pxValue(f),e=g.value+v.value/2,n=u.value+t,s=n*Math.cos(e),r=n*Math.sin(e);bo.is(S)&&(S.textAlign.setState("center",i.Affinity.Intrinsic),S.textBaseline.setState("middle",i.Affinity.Intrinsic),S.textOrigin.setState(new o.R2Point(d.x+s,d.y+r),i.Affinity.Intrinsic))}const A=this.legend.view;if(null!==A&&!A.hidden){const n=this.tickAlign.getValue(),r=g.value+v.value*n,a=this.tickRadius.getValue().pxValue(l),h=this.tickLength.getValue().pxValue(s),c=this.tickWidth.getValue().pxValue(l),u=this.tickColor.value,f=d.x,w=d.y,y=p.value*Math.cos(r+e.Equivalent.Epsilon),m=p.value*Math.sin(r+e.Equivalent.Epsilon),b=a*Math.cos(r+e.Equivalent.Epsilon),C=a*Math.sin(r+e.Equivalent.Epsilon);let S,x=0;if(null!==u&&0!==c){const e=t.lineWidth,i=t.strokeStyle;t.beginPath(),t.lineWidth=c,t.strokeStyle=u.toString(),t.moveTo(f+y,w+m),t.lineTo(f+b,w+C),0!==h&&(b>=0?(t.lineTo(f+h,w+C),x=h-b):b<0&&(t.lineTo(f-h,w+C),x=h+b)),t.stroke(),t.lineWidth=e,t.strokeStyle=i}if(b>=0?S="end":(x=-x,S="start"),bo.is(A)){const t=this.tickPadding.getValue().pxValue(l);fo.is(A)&&A.fill.setState(u,i.Affinity.Intrinsic),A.textAlign.setState(S,i.Affinity.Intrinsic),A.textBaseline.setState("alphabetic",i.Affinity.Intrinsic),A.textOrigin.setState(new o.R2Point(f+b+x,w+C-t),i.Affinity.Intrinsic)}}}hitTest(t,e,i){const n=i.renderer;if(n instanceof ho){const i=n.transform.transform(t,e);return this.hitTestSlice(i.x,i.y,n.context,this.viewFrame)}return null}hitTestSlice(t,e,i,n){const s=Math.min(n.width,n.height),r=this.value.getValue(),l=this.total.getValue(),a=0!==l?r/l:0,h=this.center.getValue(),c=this.innerRadius.getValue().px(s),d=this.outerRadius.getValue().px(s),u=d.value-c.value,p=this.phaseAngle.getValue().rad(),f=o.Angle.rad(2*Math.PI*a),g=this.padAngle.getValue(),v=this.padRadius.getValueOr(null),w=this.cornerRadius.getValue().px(u),y=new yo(h,c,d,p,f,g,v,w);return i.beginPath(),y.draw(i,n),i.isPointInPath(t,e)?this:null}init(t){super.init(t),void 0!==t.value&&this.value(t.value),void 0!==t.total&&this.total(t.total),void 0!==t.center&&this.center(t.center),void 0!==t.innerRadius&&this.innerRadius(t.innerRadius),void 0!==t.outerRadius&&this.outerRadius(t.outerRadius),void 0!==t.phaseAngle&&this.phaseAngle(t.phaseAngle),void 0!==t.padAngle&&this.padAngle(t.padAngle),void 0!==t.padRadius&&this.padRadius(t.padRadius),void 0!==t.cornerRadius&&this.cornerRadius(t.cornerRadius),void 0!==t.labelRadius&&this.labelRadius(t.labelRadius),void 0!==t.sliceColor&&this.sliceColor(t.sliceColor),void 0!==t.tickAlign&&this.tickAlign(t.tickAlign),void 0!==t.tickRadius&&this.tickRadius(t.tickRadius),void 0!==t.tickLength&&this.tickLength(t.tickLength),void 0!==t.tickWidth&&this.tickWidth(t.tickWidth),void 0!==t.tickPadding&&this.tickPadding(t.tickPadding),void 0!==t.tickColor&&this.tickColor(t.tickColor),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor),void 0!==t.label&&this.label(t.label),void 0!==t.legend&&this.legend(t.legend)}}u([i.Animator({type:Number,value:0,updateFlags:pn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetSliceValue",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetSliceValue",t,e,this.owner)}})],fr.prototype,"value",void 0),u([i.Animator({type:Number,value:1,updateFlags:pn.NeedsRender})],fr.prototype,"total",void 0),u([i.Animator({type:o.R2Point,inherits:!0,value:o.R2Point.origin(),updateFlags:pn.NeedsRender})],fr.prototype,"center",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.pct(3),updateFlags:pn.NeedsRender})],fr.prototype,"innerRadius",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.pct(25),updateFlags:pn.NeedsRender})],fr.prototype,"outerRadius",void 0),u([zt({type:o.Angle,value:o.Angle.zero(),updateFlags:pn.NeedsRender})],fr.prototype,"phaseAngle",void 0),u([zt({type:o.Angle,inherits:!0,value:o.Angle.deg(2),updateFlags:pn.NeedsRender})],fr.prototype,"padAngle",void 0),u([zt({type:o.Length,inherits:!0,value:null,updateFlags:pn.NeedsRender})],fr.prototype,"padRadius",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.zero(),updateFlags:pn.NeedsRender})],fr.prototype,"cornerRadius",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.pct(50),updateFlags:pn.NeedsRender})],fr.prototype,"labelRadius",void 0),u([zt({type:B,inherits:!0,value:null,look:St.accentColor,updateFlags:pn.NeedsRender})],fr.prototype,"sliceColor",void 0),u([zt({type:Number,inherits:!0,value:.5,updateFlags:pn.NeedsRender})],fr.prototype,"tickAlign",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.pct(30),updateFlags:pn.NeedsRender})],fr.prototype,"tickRadius",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.pct(50),updateFlags:pn.NeedsRender})],fr.prototype,"tickLength",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.px(1),updateFlags:pn.NeedsRender})],fr.prototype,"tickWidth",void 0),u([zt({type:o.Length,inherits:!0,value:o.Length.px(2),updateFlags:pn.NeedsRender})],fr.prototype,"tickPadding",void 0),u([zt({type:B,inherits:!0,value:null,look:St.neutralColor,updateFlags:pn.NeedsRender})],fr.prototype,"tickColor",void 0),u([zt({type:O,inherits:!0,value:null,updateFlags:pn.NeedsRender})],fr.prototype,"font",void 0),u([zt({type:B,inherits:!0,value:null,look:St.mutedColor,updateFlags:pn.NeedsRender})],fr.prototype,"textColor",void 0),u([gn({key:!0,type:So,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachSliceLabel",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachSliceLabel",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof So?(this.view.text(t),this.view):So.fromAny(t):io.fromAny(t)}})],fr.prototype,"label",void 0),u([gn({key:!0,type:So,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachSliceLegend",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachSliceLegend",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof So?(this.view.text(t),this.view):So.fromAny(t):io.fromAny(t)}})],fr.prototype,"legend",void 0);class gr extends S{formatLabel(t){}formatLegend(t){}}u([i.Property({type:Number,value:0,willSetValue(t,e){this.owner.callObservers("traitWillSetSliceValue",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetSliceValue",t,e,this.owner)}})],gr.prototype,"value",void 0),u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetSliceColor",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetSliceColor",t,e,this.owner)},fromAny:t=>(null===t||t instanceof St||(t=B.fromAny(t)),t)})],gr.prototype,"sliceColor",void 0),u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetSliceLabel",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetSliceLabel",t,e,this.owner)}})],gr.prototype,"label",void 0),u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetSliceLegend",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetSliceLegend",t,e,this.owner)}})],gr.prototype,"legend",void 0);class vr extends Zo{updateLabel(t,e){if(e.label.hasAffinity(i.Affinity.Intrinsic)){const n=e.formatLabel(t);void 0!==n&&e.label.setValue(n,i.Affinity.Intrinsic)}}updateLegend(t,e){if(e.legend.hasAffinity(i.Affinity.Intrinsic)){const n=e.formatLegend(t);void 0!==n&&e.legend.setValue(n,i.Affinity.Intrinsic)}}setValue(t,n){const o=this.slice.view;null!==o&&o.value.hasAffinity(i.Affinity.Intrinsic)&&(void 0===n||!0===n?!0===(n=this.sliceTiming.value)&&(n=o.getLook(St.timing,Ot.ambient)):n=e.Timing.fromAny(n),o.value.setState(t,n,i.Affinity.Intrinsic))}setSliceColor(t,n){const o=this.slice.view;null!==o&&(void 0===n||!0===n?!0===(n=this.sliceTiming.value)&&(n=o.getLook(St.timing,Ot.ambient)):n=e.Timing.fromAny(n),t instanceof St?o.sliceColor.setLook(t,n,i.Affinity.Intrinsic):o.sliceColor.setState(t,n,i.Affinity.Intrinsic))}createLabelView(t){return"function"==typeof t?t(this.slice.trait):t}setLabelView(t){const e=this.slice.view;if(null!==e){const i=null!==t?this.createLabelView(t):null;e.label.setView(i)}}createLegendView(t){return"function"==typeof t?t(this.slice.trait):t}setLegendView(t){const e=this.slice.view;if(null!==e){const i=null!==t?this.createLegendView(t):null;e.legend.setView(i)}}}u([i.Property({type:e.Timing,inherits:!0})],vr.prototype,"sliceTiming",void 0),u([$o({traitType:gr,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachSliceTrait",t,this.owner)},didAttachTrait(t){if(null!==this.view){this.owner.setValue(t.value.value);const e=t.sliceColor.value;null!==e&&this.owner.setSliceColor(e),this.owner.setLabelView(t.label.value),this.owner.setLegendView(t.legend.value)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachSliceTrait",t,this.owner)},traitDidSetSliceValue(t,e){this.owner.setValue(t)},traitDidSetSliceColor(t,e){this.owner.setSliceColor(t)},traitDidSetSliceLabel(t,e){this.owner.setLabelView(t)},traitDidSetSliceLegend(t,e){this.owner.setLegendView(t)},viewType:fr,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachSliceView",t,this.owner)},didAttachView(t){const e=this.trait;if(null!==e){const t=e.sliceColor.value;null!==t&&this.owner.setSliceColor(t)}this.owner.label.setView(t.label.view),this.owner.legend.setView(t.legend.view);const i=t.value.value;t.setHidden(0===i),null!==e&&(this.owner.updateLabel(i,e),this.owner.updateLegend(i,e),this.owner.setValue(e.value.value),this.owner.setLabelView(e.label.value),this.owner.setLegendView(e.legend.value))},willDetachView(t){this.owner.label.setView(null),this.owner.legend.setView(null)},didDetachView(t){this.owner.callObservers("controllerDidDetachSliceView",t,this.owner)},viewWillSetSliceValue(t,e,i){this.owner.callObservers("controllerWillSetSliceValue",t,e,this.owner)},viewDidSetSliceValue(t,e,i){i.setHidden(0===t);const n=this.trait;null!==n&&(this.owner.updateLabel(t,n),this.owner.updateLegend(t,n)),this.owner.callObservers("controllerDidSetSliceValue",t,e,this.owner)},viewWillAttachSliceLabel(t){this.owner.label.setView(t)},viewDidDetachSliceLabel(t){this.owner.label.setView(null)},viewWillAttachSliceLegend(t){this.owner.legend.setView(t)},viewDidDetachSliceLegend(t){this.owner.legend.setView(null)}})],vr.prototype,"slice",void 0),u([gn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachSliceLabelView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachSliceLabelView",t,this.owner)}})],vr.prototype,"label",void 0),u([gn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachSliceLegendView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachSliceLegendView",t,this.owner)}})],vr.prototype,"legend",void 0);class wr extends io{onLayout(t){super.onLayout(t),this.layoutPie(this.viewFrame)}layoutPie(t){if(this.center.hasAffinity(i.Affinity.Intrinsic)){const e=(t.xMin+t.xMax)/2,n=(t.yMin+t.yMax)/2;this.center.setState(new o.R2Point(e,n),i.Affinity.Intrinsic)}const e=this.slices.views;let n=0;for(const t in e){const i=e[t].value.getValue();isFinite(i)&&(n+=i)}n=Math.max(n,this.limit.getValue());let s=this.baseAngle.getValue().rad();for(const t in e){const r=e[t];r.total.setState(n,i.Affinity.Intrinsic),r.phaseAngle.setState(s,i.Affinity.Intrinsic);const l=r.value.getValue();if(isFinite(l)){const t=0!==n?l/n:0;s=o.Angle.rad(s.value+2*Math.PI*t)}}const r=this.title.view;bo.is(r)&&r.textOrigin.setState(this.center.value,i.Affinity.Intrinsic)}init(t){super.init(t),void 0!==t.limit&&this.limit(t.limit),void 0!==t.center&&this.center(t.center),void 0!==t.baseAngle&&this.baseAngle(t.baseAngle),void 0!==t.innerRadius&&this.innerRadius(t.innerRadius),void 0!==t.outerRadius&&this.outerRadius(t.outerRadius),void 0!==t.padAngle&&this.padAngle(t.padAngle),void 0!==t.padRadius&&this.padRadius(t.padRadius),void 0!==t.cornerRadius&&this.cornerRadius(t.cornerRadius),void 0!==t.labelRadius&&this.labelRadius(t.labelRadius),void 0!==t.sliceColor&&this.sliceColor(t.sliceColor),void 0!==t.tickAlign&&this.tickAlign(t.tickAlign),void 0!==t.tickRadius&&this.tickRadius(t.tickRadius),void 0!==t.tickLength&&this.tickLength(t.tickLength),void 0!==t.tickWidth&&this.tickWidth(t.tickWidth),void 0!==t.tickPadding&&this.tickPadding(t.tickPadding),void 0!==t.tickColor&&this.tickColor(t.tickColor),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor),void 0!==t.title&&this.title(t.title);const e=t.slices;if(void 0!==e)for(let t=0,i=e.length;t<i;t+=1){const i=e[t];this.appendChild(fr.fromAny(i),i.key)}}}u([i.Animator({type:Number,value:0,updateFlags:pn.NeedsLayout})],wr.prototype,"limit",void 0),u([i.Animator({type:o.R2Point,value:o.R2Point.origin(),updateFlags:pn.NeedsLayout})],wr.prototype,"center",void 0),u([zt({type:o.Angle,value:o.Angle.rad(-Math.PI/2),updateFlags:pn.NeedsLayout})],wr.prototype,"baseAngle",void 0),u([zt({type:o.Length,value:o.Length.pct(3)})],wr.prototype,"innerRadius",void 0),u([zt({type:o.Length,value:o.Length.pct(25)})],wr.prototype,"outerRadius",void 0),u([zt({type:o.Angle,value:o.Angle.deg(2)})],wr.prototype,"padAngle",void 0),u([zt({type:o.Length,value:null})],wr.prototype,"padRadius",void 0),u([zt({type:o.Length,value:o.Length.zero()})],wr.prototype,"cornerRadius",void 0),u([zt({type:o.Length,value:o.Length.pct(50)})],wr.prototype,"labelRadius",void 0),u([zt({type:B,value:null,look:St.accentColor})],wr.prototype,"sliceColor",void 0),u([zt({type:Number,value:.5})],wr.prototype,"tickAlign",void 0),u([zt({type:o.Length,value:o.Length.pct(30)})],wr.prototype,"tickRadius",void 0),u([zt({type:o.Length,value:o.Length.pct(50)})],wr.prototype,"tickLength",void 0),u([zt({type:o.Length,value:o.Length.px(1)})],wr.prototype,"tickWidth",void 0),u([zt({type:o.Length,value:o.Length.px(2)})],wr.prototype,"tickPadding",void 0),u([zt({type:B,value:null,look:St.neutralColor})],wr.prototype,"tickColor",void 0),u([zt({type:O,value:null,inherits:!0})],wr.prototype,"font",void 0),u([zt({type:B,value:null,look:St.mutedColor})],wr.prototype,"textColor",void 0),u([gn({key:!0,type:So,binds:!0,initView(t){bo.is(t)&&(t.textAlign.setState("center",i.Affinity.Intrinsic),t.textBaseline.setState("middle",i.Affinity.Intrinsic),t.textOrigin.setState(this.owner.center.state,i.Affinity.Intrinsic))},willAttachView(t){this.owner.callObservers("viewWillAttachPieTitle",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachPieTitle",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof So?(this.view.text(t),this.view):So.fromAny(t):io.fromAny(t)}})],wr.prototype,"title",void 0),u([vn({implements:!0,type:fr,binds:!0,observes:!0,willAttachView(t,e){this.owner.callObservers("viewWillAttachSlice",t,e,this.owner)},didAttachView(t){const e=t.label.view;null!==e&&this.attachLabelView(e);const i=t.legend.view;null!==i&&this.attachLegendView(i)},willDetachView(t){const e=t.legend.view;null!==e&&this.detachLegendView(e);const i=t.label.view;null!==i&&this.detachLabelView(i)},didDetachView(t){this.owner.callObservers("viewDidDetachSlice",t,this.owner)},viewDidSetSliceValue(t,e){this.owner.requireUpdate(pn.NeedsLayout)},viewWillAttachSliceLabel(t){this.attachLabelView(t)},viewDidDetachSliceLabel(t){this.detachLabelView(t)},attachLabelView(t){},detachLabelView(t){},viewWillAttachSliceLegend(t){this.attachLegendView(t)},viewDidDetachSliceLegend(t){this.detachLegendView(t)},attachLegendView(t){},detachLegendView(t){}})],wr.prototype,"slices",void 0);class yr extends S{startConsumingSlices(){const t=this.slices.traits;for(const e in t){t[e].consume(this)}}stopConsumingSlices(){const t=this.slices.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingSlices()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingSlices()}}u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetPieTitle",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetPieTitle",t,e,this.owner)}})],yr.prototype,"title",void 0),u([T({type:gr,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachSlice",t,e,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachSlice",t,this.owner)},detectModel:t=>t.getTrait(gr)})],yr.prototype,"slices",void 0);class mr extends Zo{createTitleView(t,e){return"function"==typeof t?t(e):t}setTitleView(t,e){const i=this.pie.view;if(null!==i){const n=null!==t?this.createTitleView(t,e):null;i.title.setView(n)}}}u([$o({traitType:yr,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachPieTrait",t,this.owner)},didAttachTrait(t){const e=t.slices.traits;for(const t in e){const i=e[t];this.owner.slices.addTraitController(i)}null!==this.view&&this.owner.setTitleView(t.title.value,t)},willDetachTrait(t){null!==this.view&&this.owner.setTitleView(t.title.value,t);const e=t.slices.traits;for(const t in e){const i=e[t];this.owner.slices.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachPieTrait",t,this.owner)},traitDidSetPieTitle(t,e,i){this.owner.setTitleView(t,i)},traitWillAttachSlice(t,e){this.owner.slices.addTraitController(t)},traitDidDetachSlice(t){this.owner.slices.deleteTraitController(t)},viewType:wr,observesView:!0,initView(t){const e=this.owner.slices.controllers;for(const i in e){const n=e[i],o=n.slice.view;null!==o&&null===o.parent&&n.slice.insertView(t)}this.owner.title.setView(t.title.view);const i=this.trait;null!==i&&this.owner.setTitleView(i.title.value,i)},deinitView(t){this.owner.title.setView(null)},willAttachView(t){this.owner.callObservers("controllerWillAttachPieView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachPieView",t,this.owner)},viewWillAttachPieTitle(t){this.owner.title.setView(t)},viewDidDetachPieTitle(t){this.owner.title.setView(t)}})],mr.prototype,"pie",void 0),u([gn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachPieTitleView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachPieTitleView",t,this.owner)}})],mr.prototype,"title",void 0),u([i.Property({type:e.Timing,value:!0})],mr.prototype,"sliceTiming",void 0),u([ns({implements:!0,type:vr,binds:!0,observes:!0,get parentView(){return this.owner.pie.view},getTraitViewRef:t=>t.slice,willAttachController(t){this.owner.callObservers("controllerWillAttachSlice",t,this.owner)},didAttachController(t){const e=t.slice.trait;null!==e&&this.attachSliceTrait(e,t);const i=t.slice.view;null!==i&&this.attachSliceView(i,t)},willDetachController(t){const e=t.slice.view;null!==e&&this.detachSliceView(e,t);const i=t.slice.trait;null!==i&&this.detachSliceTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachSlice",t,this.owner)},controllerWillAttachSliceTrait(t,e){this.owner.callObservers("controllerWillAttachSliceTrait",t,e,this.owner),this.attachSliceTrait(t,e)},controllerDidDetachSliceTrait(t,e){this.detachSliceTrait(t,e),this.owner.callObservers("controllerDidDetachSliceTrait",t,e,this.owner)},attachSliceTrait(t,e){},detachSliceTrait(t,e){},controllerWillAttachSliceView(t,e){this.owner.callObservers("controllerWillAttachSliceView",t,e,this.owner),this.attachSliceView(t,e)},controllerDidDetachSliceView(t,e){this.detachSliceView(t,e),this.owner.callObservers("controllerDidDetachSliceView",t,e,this.owner)},attachSliceView(t,e){const i=t.label.view;null!==i&&this.attachSliceLabelView(i,e);const n=t.legend.view;null!==n&&this.attachSliceLegendView(n,e)},detachSliceView(t,e){const i=t.legend.view;null!==i&&this.detachSliceLegendView(i,e);const n=t.label.view;null!==n&&this.detachSliceLabelView(n,e),t.remove()},controllerWillSetSliceValue(t,e,i){this.owner.callObservers("controllerWillSetSliceValue",t,e,i,this.owner)},controllerDidSetSliceValue(t,e,i){this.owner.callObservers("controllerDidSetSliceValue",t,e,i,this.owner)},controllerWillAttachSliceLabelView(t,e){this.owner.callObservers("controllerWillAttachSliceLabelView",t,e,this.owner),this.attachSliceLabelView(t,e)},controllerDidDetachSliceLabelView(t,e){this.detachSliceLabelView(t,e),this.owner.callObservers("controllerDidDetachSliceLabelView",t,e,this.owner)},attachSliceLabelView(t,e){},detachSliceLabelView(t,e){},controllerWillAttachSliceLegendView(t,e){this.owner.callObservers("controllerWillAttachSliceLegendView",t,e,this.owner),this.attachSliceLegendView(t,e)},controllerDidDetachSliceLegendView(t,e){this.detachSliceLegendView(t,e),this.owner.callObservers("controllerDidDetachSliceLegendView",t,e,this.owner)},attachSliceLegendView(t,e){},detachSliceLegendView(t,e){}})],mr.prototype,"slices",void 0);class br extends io{constructor(){super(),this.xCoord=NaN,this.yCoord=NaN,this.y2Coord=void 0,this.gradientStop=!1}setXCoord(t){this.xCoord=t}setYCoord(t){this.yCoord=t}setY2Coord(t){this.y2Coord=t}setState(t,e){void 0!==t.x&&this.x(t.x,e),void 0!==t.y&&this.y(t.y,e),void 0!==t.y2&&this.y2(t.y2,e),void 0!==t.radius&&this.radius(t.radius,e),void 0!==t.hitRadius&&this.hitRadius(t.hitRadius),void 0!==t.color&&this.color(t.color,e),void 0!==t.opacity&&this.opacity(t.opacity,e),void 0!==t.font&&this.font(t.font,e),void 0!==t.textColor&&this.textColor(t.textColor,e),void 0!==t.category&&this.category(t.category),void 0!==t.labelPadding&&this.labelPadding(t.labelPadding,e),void 0!==t.labelPlacement&&this.labelPlacement(t.labelPlacement),void 0!==t.label&&this.label(t.label)}isGradientStop(){return this.gradientStop}updateGradientStop(){this.gradientStop=null!==this.color.value||void 0!==this.opacity.value}onLayout(t){super.onLayout(t),this.layoutDataPoint(this.viewFrame)}layoutDataPoint(t){const e=this.label.view;null!==e&&this.layoutLabel(e,t)}layoutLabel(t,e){let n=this.labelPlacement.value;if("above"!==n&&"below"!==n&&"middle"!==n){const t=this.category.value;n="increasing"===t||"maxima"===t?"above":"decreasing"===t||"minima"===t?"below":"above"}const s=this.xCoord;let r=this.yCoord;"above"===n?r-=this.labelPadding.getValue().pxValue(Math.min(e.width,e.height)):"below"===n&&(r+=this.labelPadding.getValue().pxValue(Math.min(e.width,e.height))),bo.is(t)&&(t.textAlign.setState("center",i.Affinity.Intrinsic),"above"===n?t.textBaseline.setState("bottom",i.Affinity.Intrinsic):"below"===n?t.textBaseline.setState("top",i.Affinity.Intrinsic):"middle"===n&&t.textBaseline.setState("middle",i.Affinity.Intrinsic),t.textOrigin.setState(new o.R2Point(s,r),i.Affinity.Intrinsic))}hitTest(t,e,i){const n=i.renderer;return n instanceof ho?this.hitTestPoint(t,e,n.context,this.viewFrame):null}hitTestPoint(t,e,i,n){let o=this.hitRadius.value;const s=this.radius.value;if(null!==s){const t=Math.min(n.width,n.height);o=Math.max(o,s.pxValue(t))}const r=this.xCoord-t,l=this.yCoord-e;return r*r+l*l<o*o?this:null}init(t){super.init(t),this.setState(t)}static fromAny(t){return super.fromAny(t)}}u([i.Animator({willSetValue(t,e){this.owner.callObservers("viewWillSetDataPointX",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetDataPointX",t,e,this.owner)}})],br.prototype,"x",void 0),u([i.Animator({willSetValue(t,e){this.owner.callObservers("viewWillSetDataPointY",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetDataPointY",t,e,this.owner)}})],br.prototype,"y",void 0),u([i.Animator({willSetValue(t,e){this.owner.callObservers("viewWillSetDataPointY2",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetDataPointY2",t,e,this.owner)}})],br.prototype,"y2",void 0),u([zt({type:o.Length,value:null,willSetValue(t,e){this.owner.callObservers("viewWillSetDataPointRadius",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetDataPointRadius",t,e,this.owner)}})],br.prototype,"radius",void 0),u([i.Property({type:Number,value:5})],br.prototype,"hitRadius",void 0),u([zt({type:B,value:null,willSetValue(t,e){this.owner.callObservers("viewWillSetDataPointColor",t,e,this.owner)},didSetValue(t,e){this.owner.updateGradientStop(),this.owner.callObservers("viewDidSetDataPointColor",t,e,this.owner)}})],br.prototype,"color",void 0),u([zt({type:Number,willSetValue(t,e){this.owner.callObservers("viewWillSetDataPointOpacity",t,e,this.owner)},didSetValue(t,e){this.owner.updateGradientStop(),this.owner.callObservers("viewDidSetDataPointOpacity",t,e,this.owner)}})],br.prototype,"opacity",void 0),u([zt({type:O,inherits:!0})],br.prototype,"font",void 0),u([zt({type:B,inherits:!0})],br.prototype,"textColor",void 0),u([i.Property({type:String})],br.prototype,"category",void 0),u([zt({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsLayout})],br.prototype,"labelPadding",void 0),u([gn({key:!0,type:So,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachDataPointLabel",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachDataPointLabel",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof So?(this.view.text(t),this.view):So.fromAny(t):io.fromAny(t)}})],br.prototype,"label",void 0),u([i.Property({type:String,value:"auto"})],br.prototype,"labelPlacement",void 0);class Cr extends S{constructor(t,e){super(),this.x.setValue(t),this.y.setValue(e)}formatLabel(t,e){}}u([i.Property({willSetValue(t,e){this.owner.callObservers("traitWillSetDataPointX",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetDataPointX",t,e,this.owner)}})],Cr.prototype,"x",void 0),u([i.Property({willSetValue(t,e){this.owner.callObservers("traitWillSetDataPointY",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetDataPointY",t,e,this.owner)}})],Cr.prototype,"y",void 0),u([i.Property({willSetValue(t,e){this.owner.callObservers("traitWillSetDataPointY2",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetDataPointY2",t,e,this.owner)}})],Cr.prototype,"y2",void 0),u([i.Property({type:o.Length,value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetDataPointRadius",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetDataPointRadius",t,e,this.owner)}})],Cr.prototype,"radius",void 0),u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetDataPointColor",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetDataPointColor",t,e,this.owner)},fromAny:t=>(null===t||t instanceof St||(t=B.fromAny(t)),t)})],Cr.prototype,"color",void 0),u([i.Property({type:Number,willSetValue(t,e){this.owner.callObservers("traitWillSetDataPointOpacity",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetDataPointOpacity",t,e,this.owner)}})],Cr.prototype,"opacity",void 0),u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetDataPointLabel",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetDataPointLabel",t,e,this.owner)}})],Cr.prototype,"label",void 0);class Sr extends S{startConsumingDataPoints(){const t=this.dataPoints.traits;for(const e in t){t[e].consume(this)}}stopConsumingDataPoints(){const t=this.dataPoints.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingDataPoints()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingDataPoints()}}u([T({type:Cr,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachDataPoint",t,e,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachDataPoint",t,this.owner)},detectModel:t=>t.getTrait(Cr)})],Sr.prototype,"dataPoints",void 0);class Ar extends Zo{updateLabel(t,e,n){const o=n.formatLabel(t,e);void 0!==o&&n.label.setValue(o,i.Affinity.Intrinsic)}setX(t,n,o){const s=this.dataPoint.view;null!==s&&(void 0===o||!0===o?!0===(o=this.dataPointTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),s.x.setState(t,o,i.Affinity.Intrinsic))}setY(t,n,o){const s=this.dataPoint.view;null!==s&&(void 0===o||!0===o?!0===(o=this.dataPointTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),s.y.setState(t,o,i.Affinity.Intrinsic))}setY2(t,n,o){const s=this.dataPoint.view;null!==s&&(void 0===o||!0===o?!0===(o=this.dataPointTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),s.y2.setState(t,o,i.Affinity.Intrinsic))}setRadius(t,n,o){const s=this.dataPoint.view;null!==s&&(void 0===o||!0===o?!0===(o=this.dataPointTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),s.radius.setState(t,o,i.Affinity.Intrinsic))}setColor(t,n,o){const s=this.dataPoint.view;null!==s&&(void 0===o||!0===o?!0===(o=this.dataPointTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),t instanceof St?s.color.setLook(t,o,i.Affinity.Intrinsic):s.color.setState(t,o,i.Affinity.Intrinsic))}setOpacity(t,n,o){const s=this.dataPoint.view;null!==s&&(void 0===o||!0===o?!0===(o=this.dataPointTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),s.opacity.setState(t,o,i.Affinity.Intrinsic))}createLabelView(t,e){return"function"==typeof t?t(e):t}setLabelView(t,e){const i=this.dataPoint.view;if(null!==i){const n=null!==t?this.createLabelView(t,e):null;i.label.setView(n)}}}u([i.Property({type:e.Timing,inherits:!0})],Ar.prototype,"dataPointTiming",void 0),u([$o({traitType:Cr,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachDataPointTrait",t,this.owner)},didAttachTrait(t){null!==this.view&&(this.owner.setX(t.x.value,t),this.owner.setY(t.y.value,t),this.owner.setY2(t.y2.value,t),this.owner.setRadius(t.radius.value,t),this.owner.setColor(t.color.value,t),this.owner.setOpacity(t.opacity.value,t),this.owner.setLabelView(t.label.value,t))},willDetachTrait(t){null!==this.view&&this.owner.setLabelView(null,t)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachDataPointTrait",t,this.owner)},traitDidSetDataPointX(t,e,i){this.owner.setX(t,i)},traitDidSetDataPointY(t,e,i){this.owner.setY(t,i)},traitDidSetDataPointY2(t,e,i){this.owner.setY2(t,i)},traitDidSetDataPointRadius(t,e,i){this.owner.setRadius(t,i)},traitDidSetDataPointColor(t,e,i){this.owner.setColor(t,i)},traitDidSetDataPointOpacity(t,e,i){this.owner.setOpacity(t,i)},traitDidSetDataPointLabel(t,e,i){this.owner.setLabelView(t,i)},viewType:br,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachDataPointView",t,this.owner)},didAttachView(t){this.owner.label.setView(t.label.view);const e=this.trait;if(null!==e){this.owner.setX(e.x.value,e),this.owner.setY(e.y.value,e),this.owner.setY2(e.y2.value,e),this.owner.setRadius(e.radius.value,e),this.owner.setColor(e.color.value,e),this.owner.setOpacity(e.opacity.value,e),this.owner.setLabelView(e.label.value,e);const i=t.x.value,n=t.y.value;this.owner.updateLabel(i,n,e)}},willDetachView(t){this.owner.label.setView(null)},didDetachView(t){this.owner.callObservers("controllerDidDetachDataPointView",t,this.owner)},viewWillSetDataPointX(t,e,i){this.owner.callObservers("controllerWillSetDataPointX",t,e,this.owner)},viewDidSetDataPointX(t,e,i){const n=this.trait;if(null!==n){const e=i.y.value;this.owner.updateLabel(t,e,n)}this.owner.callObservers("controllerDidSetDataPointX",t,e,this.owner)},viewWillSetDataPointY(t,e,i){this.owner.callObservers("controllerWillSetDataPointY",t,e,this.owner)},viewDidSetDataPointY(t,e,i){const n=this.trait;if(null!==n){const e=i.x.value;this.owner.updateLabel(e,t,n)}this.owner.callObservers("controllerDidSetDataPointY",t,e,this.owner)},viewWillSetDataPointY2(t,e,i){this.owner.callObservers("controllerWillSetDataPointY2",t,e,this.owner)},viewDidSetDataPointY2(t,e,i){this.owner.callObservers("controllerDidSetDataPointY2",t,e,this.owner)},viewWillSetDataPointRadius(t,e,i){this.owner.callObservers("controllerWillSetDataPointRadius",t,e,this.owner)},viewDidSetDataPointRadius(t,e,i){this.owner.callObservers("controllerDidSetDataPointRadius",t,e,this.owner)},viewWillSetDataPointColor(t,e,i){this.owner.callObservers("controllerWillSetDataPointColor",t,e,this.owner)},viewDidSetDataPointColor(t,e,i){this.owner.callObservers("controllerDidSetDataPointColor",t,e,this.owner)},viewWillSetDataPointOpacity(t,e,i){this.owner.callObservers("controllerWillSetDataPointOpacity",t,e,this.owner)},viewDidSetDataPointOpacity(t,e,i){this.owner.callObservers("controllerDidSetDataPointOpacity",t,e,this.owner)},viewWillAttachDataPointLabel(t){this.owner.label.setView(t)},viewDidDetachDataPointLabel(t){this.owner.label.setView(null)},createView(){const t=new br,e=this.trait;return null!==e&&(t.x.setState(e.x.value,i.Affinity.Intrinsic),t.y.setState(e.y.value,i.Affinity.Intrinsic),t.y2.setState(e.y2.value,i.Affinity.Intrinsic),t.radius.setState(e.radius.value,i.Affinity.Intrinsic)),t}})],Ar.prototype,"dataPoint",void 0),u([gn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachDataPointLabelView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachDataPointLabelView",t,this.owner)}})],Ar.prototype,"label",void 0);class xr extends Zo{}u([x({type:Sr,observes:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachDataSetTrait",t,this.owner)},didAttachTrait(t){const e=t.dataPoints.traits;for(const t in e){const i=e[t];this.owner.dataPoints.addTraitController(i)}},willDetachTrait(t){const e=t.dataPoints.traits;for(const t in e){const i=e[t];this.owner.dataPoints.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachDataSetTrait",t,this.owner)},traitWillAttachDataPoint(t,e){this.owner.dataPoints.addTraitController(t,e)},traitDidDetachDataPoint(t){this.owner.dataPoints.deleteTraitController(t)}})],xr.prototype,"dataSet",void 0),u([i.Property({type:e.Timing,value:!0})],xr.prototype,"dataPointTiming",void 0),u([ns({implements:!0,type:Ar,binds:!0,observes:!0,getTraitViewRef:t=>t.dataPoint,willAttachController(t){this.owner.callObservers("controllerWillAttachDataPoint",t,this.owner)},didAttachController(t){const e=t.dataPoint.trait;null!==e&&this.attachDataPointTrait(e,t);const i=t.dataPoint.view;null!==i&&this.attachDataPointView(i,t);const n=this.parentView;null!==n&&t.dataPoint.insertView(n)},willDetachController(t){const e=t.dataPoint.view;null!==e&&this.detachDataPointView(e,t);const i=t.dataPoint.trait;null!==i&&this.detachDataPointTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachDataPoint",t,this.owner)},controllerWillAttachDataPointTrait(t,e){this.owner.callObservers("controllerWillAttachDataPointTrait",t,e,this.owner),this.attachDataPointTrait(t,e)},controllerDidDetachDataPointTrait(t,e){this.detachDataPointTrait(t,e),this.owner.callObservers("controllerDidDetachDataPointTrait",t,e,this.owner)},attachDataPointTrait(t,e){},detachDataPointTrait(t,e){},controllerWillAttachDataPointView(t,e){this.owner.callObservers("controllerWillAttachDataPointView",t,e,this.owner),this.attachDataPointView(t,e)},controllerDidDetachDataPointView(t,e){this.detachDataPointView(t,e),this.owner.callObservers("controllerDidDetachDataPointView",t,e,this.owner)},attachDataPointView(t,e){const i=t.label.view;null!==i&&this.attachDataPointLabelView(i,e)},detachDataPointView(t,e){const i=t.label.view;null!==i&&this.detachDataPointLabelView(i,e),t.remove()},controllerWillSetDataPointX(t,e,i){this.owner.callObservers("controllerWillSetDataPointX",t,e,i,this.owner)},controllerDidSetDataPointX(t,e,i){this.owner.callObservers("controllerDidSetDataPointX",t,e,i,this.owner)},controllerWillSetDataPointY(t,e,i){this.owner.callObservers("controllerWillSetDataPointY",t,e,i,this.owner)},controllerDidSetDataPointY(t,e,i){this.owner.callObservers("controllerDidSetDataPointY",t,e,i,this.owner)},controllerWillSetDataPointY2(t,e,i){this.owner.callObservers("controllerWillSetDataPointY2",t,e,i,this.owner)},controllerDidSetDataPointY2(t,e,i){this.owner.callObservers("controllerDidSetDataPointY2",t,e,i,this.owner)},controllerWillSetDataPointRadius(t,e,i){this.owner.callObservers("controllerWillSetDataPointRadius",t,e,i,this.owner)},controllerDidSetDataPointRadius(t,e,i){this.owner.callObservers("controllerDidSetDataPointRadius",t,e,i,this.owner)},controllerWillSetDataPointColor(t,e,i){this.owner.callObservers("controllerWillSetDataPointColor",t,e,i,this.owner)},controllerDidSetDataPointColor(t,e,i){this.owner.callObservers("controllerDidSetDataPointColor",t,e,i,this.owner)},controllerWillSetDataPointOpacity(t,e,i){this.owner.callObservers("controllerWillSetDataPointOpacity",t,e,i,this.owner)},controllerDidSetDataPointOpacity(t,e,i){this.owner.callObservers("controllerDidSetDataPointOpacity",t,e,i,this.owner)},controllerWillAttachDataPointLabelView(t,e){this.owner.callObservers("controllerWillAttachDataPointLabelView",t,e,this.owner),this.attachDataPointLabelView(t,e)},controllerDidDetachDataPointLabelView(t,e){this.detachDataPointLabelView(t,e),this.owner.callObservers("controllerDidDetachDataPointLabelView",t,e,this.owner)},attachDataPointLabelView(t,e){},detachDataPointLabelView(t,e){}})],xr.prototype,"dataPoints",void 0);const Tr=function(t){const n=t.extend("ContinuousScaleAnimator");return n.prototype.setScale=function(t,n,o,s,r){"string"==typeof t&&(t=Ir.parseScale(t).domain),t instanceof e.Domain&&(r=o,n instanceof e.Domain&&(s=n[1],o=n[0]),n=t[1],t=t[0]);const l=this.state;let a;if(null!=l){if(a=l.withDomain(t,n),void 0!==o&&void 0!==s&&(a=a.overRange(o,s)),(null==r||!1===r)&&0!=(this.flags&i.Animator.TweeningFlag)){const e=this.getValue().withDomain(t,n);this.setValue(e,i.Affinity.Extrinsic),r=!0}}else a=Ir.createScale(t,n,o,s);this.setState(a,r,i.Affinity.Extrinsic)},n.prototype.setDomain=function(t,n,o){"string"==typeof t&&(t=Ir.parseScale(t).domain),t instanceof e.Domain&&(o=n,n=t[1],t=t[0]);const s=this.state;let r;if(null!=s){if(r=s.withDomain(t,n),(null==o||!1===o)&&0!=(this.flags&i.Animator.TweeningFlag)){const e=this.getValue().withDomain(t,n);this.setValue(e,i.Affinity.Extrinsic),o=!0}}else r=Ir.createScale(t,n,0,1);this.setState(r,o,i.Affinity.Extrinsic)},n.prototype.setRange=function(t,n,o){const s=this.state;if(null!=s){t instanceof e.Range&&(o=n,n=t[1],t=t[0]);const r=s.overRange(t,n);if((null==o||!1===o)&&0!=(this.flags&i.Animator.TweeningFlag)){const e=this.getValue().overRange(t,n);this.setValue(e,i.Affinity.Extrinsic),o=!0}this.setState(r,o,i.Affinity.Extrinsic)}},n.prototype.setBaseScale=function(t,e,i,o,s){this.inherited&&this.superFastener instanceof n?this.superFastener.setBaseScale(t,e,i,o,s):this.setScale(t,e,i,o,s)},n.prototype.setBaseDomain=function(t,e,i){this.inherited&&this.superFastener instanceof n?this.superFastener.setBaseDomain(t,e,i):this.setDomain(t,e,i)},n.prototype.setBaseRange=function(t,e,i){this.inherited&&this.superFastener instanceof n?this.superFastener.setBaseRange(t,e,i):this.setRange(t,e,i)},n.prototype.fromAny=function(t){return"string"==typeof t&&(t=Ir.parseScale(t)),t},n}(i.Animator),Dr=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof Ir||e instanceof io&&"xScale"in e}return!1}};return t}(),Vr=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof Ir||e instanceof io&&"yScale"in e}return!1}};return t}(),Pr=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof Ir||e instanceof io&&"xScale"in e&&"yScale"in e}return!1}};return t}();class Ir extends io{constructor(){super(),this.scaledFlags=0,this.xDataDomain=null,this.yDataDomain=null,this.xDataRange=null,this.yDataRange=null,this.xDataDomainPadded=null,this.yDataDomainPadded=null}setScaledFlags(t){this.scaledFlags=t}xDomain(t,i,n){if(void 0===t){const t=this.xScale.value;return null!==t?t.domain:null}{(t instanceof e.Domain||"string"==typeof t)&&(n=i),!0===n&&(n=this.rescaleTransition.value);const o=this.xRange();return t instanceof e.Domain||"string"==typeof t?null!==o?this.xScale.setBaseScale(t,o,n):this.xScale.setBaseDomain(t,n):null!==o?this.xScale.setBaseScale(t,i,o[0],o[1],n):this.xScale.setBaseDomain(t,i,n),this}}yDomain(t,i,n){if(void 0===t){const t=this.yScale.value;return null!==t?t.domain:null}{(t instanceof e.Domain||"string"==typeof t)&&(n=i),!0===n&&(n=this.rescaleTransition.value);const o=this.yRange();return t instanceof e.Domain||"string"==typeof t?null!==o?this.yScale.setBaseScale(t,o,n):this.yScale.setBaseDomain(t,n):null!==o?this.yScale.setBaseScale(t,i,o[0],o[1],n):this.yScale.setBaseDomain(t,i,n),this}}xRange(){const t=this.viewFrame.width;if(isFinite(t)){const i=this.xRangePadding.value,n=i[0],o=t-i[1];return e.LinearRange(n,o)}return null}yRange(){const t=this.viewFrame.height;if(isFinite(t)){const i=this.yRangePadding.value,n=i[0],o=t-i[1];return e.LinearRange(o,n)}return null}setXDataDomain(t){const i=this.xDataDomain;e.Equals(t,i)||(this.willSetXDataDomain(t,i),this.xDataDomain=t,this.onSetXDataDomain(t,i),this.didSetXDataDomain(t,i))}willSetXDataDomain(t,e){this.callObservers("viewWillSetXDataDomain",t,e,this)}onSetXDataDomain(t,e){this.updateXDataRange(),this.updateXDataDomainPadded(),this.requireUpdate(pn.NeedsLayout)}didSetXDataDomain(t,e){this.callObservers("viewDidSetXDataDomain",t,e,this)}updateXDataDomain(t){let i=this.xDataDomain;null===i||1===this.scaled.viewCount?i=t:null!==t&&(e.Values.compare(t[0],i[0])<0&&(i=e.Domain(t[0],i[1])),e.Values.compare(i[1],t[1])<0&&(i=e.Domain(i[0],t[1]))),this.setXDataDomain(i)}setYDataDomain(t){const i=this.yDataDomain;e.Equals(t,i)||(this.willSetYDataDomain(t,i),this.yDataDomain=t,this.onSetYDataDomain(t,i),this.didSetYDataDomain(t,i))}willSetYDataDomain(t,e){this.callObservers("viewWillSetYDataDomain",t,e,this)}onSetYDataDomain(t,e){this.updateYDataRange(),this.updateYDataDomainPadded(),this.requireUpdate(pn.NeedsLayout)}didSetYDataDomain(t,e){this.callObservers("viewDidSetYDataDomain",t,e,this)}updateYDataDomain(t){let i=this.yDataDomain;null===i||1===this.scaled.viewCount?i=t:null!==t&&(e.Values.compare(t[0],i[0])<0&&(i=e.Domain(t[0],i[1])),e.Values.compare(i[1],t[1])<0&&(i=e.Domain(i[0],t[1]))),this.setYDataDomain(i)}setXDataRange(t){this.xDataRange=t}updateXDataRange(){const t=this.xDataDomain;if(null!==t){const i=this.xScale.value;null!==i?this.setXDataRange(e.LinearRange(i(t[0]),i(t[1]))):this.setXDataRange(null)}}setYDataRange(t){this.yDataRange=t}updateYDataRange(){const t=this.yDataDomain;if(null!==t){const i=this.yScale.value;null!==i?this.setYDataRange(e.LinearRange(i(t[0]),i(t[1]))):this.setYDataRange(null)}}setXDataDomainPadded(t){this.xDataDomainPadded=t}updateXDataDomainPadded(){let t;const i=this.xDataDomain;if(null!==i){let n=i[0],o=i[1];const s=this.xDomainPadding.value;"boolean"!=typeof s[0]&&(n=+n-+s[0]),"boolean"!=typeof s[1]&&(o=+o+ +s[1]),t=e.Domain(n,o)}else t=null;this.setXDataDomainPadded(t)}setYDataDomainPadded(t){this.yDataDomainPadded=t}updateYDataDomainPadded(){let t;const i=this.yDataDomain;if(null!==i){let n=i[0],o=i[1];const s=this.yDomainPadding.value;"boolean"!=typeof s[0]&&(n=+n-+s[0]),"boolean"!=typeof s[1]&&(o=+o+ +s[1]),t=e.Domain(n,o)}else t=null;this.setYDataDomainPadded(t)}updateXRangePadding(t){if(this.xRangePadding.hasAffinity(i.Affinity.Intrinsic)){let e=this.xRangePadding.value;null===e||1===this.scaled.viewCount?e=t:null!==t&&(e=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]),this.xRangePadding.setValue(e,i.Affinity.Intrinsic)}}updateYRangePadding(t){if(this.yRangePadding.hasAffinity(i.Affinity.Intrinsic)){let e=this.yRangePadding.value;null===e||1===this.scaled.viewCount?e=t:null!==t&&(e=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]),this.yRangePadding.setValue(e,i.Affinity.Intrinsic)}}xFitAlign(t){const e=this.fitAlign.value;return void 0===t?e[0]:(this.fitAlign.setValue([t,e[1]]),this)}yFitAlign(t){const e=this.fitAlign.value;return void 0===t?e[0]:(this.fitAlign.setValue([e[0],t]),this)}preserveAspectRatio(t){return void 0===t?this.gesture.preserveAspectRatio:(this.gesture.preserveAspectRatio=t,this)}domainTracking(t,e){return void 0===t?[0!=(this.scaledFlags&Ir.XDomainTrackingFlag),0!=(this.scaledFlags&Ir.YDomainTrackingFlag)]:(Array.isArray(t)?(e=t[1],t=t[0]):void 0===e&&(e=t),t?this.setScaledFlags(this.scaledFlags|Ir.XDomainTrackingFlag):this.setScaledFlags(this.scaledFlags&~Ir.XDomainTrackingFlag),e?this.setScaledFlags(this.scaledFlags|Ir.YDomainTrackingFlag):this.setScaledFlags(this.scaledFlags&~Ir.YDomainTrackingFlag),this)}xDomainTracking(t){return void 0===t?0!=(this.scaledFlags&Ir.XDomainTrackingFlag):(t?this.setScaledFlags(this.scaledFlags|Ir.XDomainTrackingFlag):this.setScaledFlags(this.scaledFlags&~Ir.XDomainTrackingFlag),this)}yDomainTracking(t){return void 0===t?0!=(this.scaledFlags&Ir.YDomainTrackingFlag):(t?this.setScaledFlags(this.scaledFlags|Ir.YDomainTrackingFlag):this.setScaledFlags(this.scaledFlags&~Ir.YDomainTrackingFlag),this)}scaleGestures(t,e){return void 0===t?[0!=(this.scaledFlags&Ir.XScaleGesturesFlag),0!=(this.scaledFlags&Ir.YScaleGesturesFlag)]:(Array.isArray(t)?(e=t[1],t=t[0]):void 0===e&&(e=t),t?this.setScaledFlags(this.scaledFlags|Ir.XScaleGesturesFlag):this.setScaledFlags(this.scaledFlags&~Ir.XScaleGesturesFlag),e?this.setScaledFlags(this.scaledFlags|Ir.YScaleGesturesFlag):this.setScaledFlags(this.scaledFlags&~Ir.YScaleGesturesFlag),this)}xScaleGestures(t){return void 0===t?0!=(this.scaledFlags&Ir.XScaleGesturesFlag):(t?this.setScaledFlags(this.scaledFlags|Ir.XScaleGesturesFlag):this.setScaledFlags(this.scaledFlags&~Ir.XScaleGesturesFlag),this)}yScaleGestures(t){return void 0===t?0!=(this.scaledFlags&Ir.YScaleGesturesFlag):(t?this.setScaledFlags(this.scaledFlags|Ir.YScaleGesturesFlag):this.setScaledFlags(this.scaledFlags&~Ir.YScaleGesturesFlag),this)}fitX(t=!1){this.setScaledFlags(this.scaledFlags|Ir.XFitFlag),!0===t&&this.setScaledFlags(this.scaledFlags|Ir.XFitTweenFlag),this.requireUpdate(pn.NeedsLayout)}fitY(t=!1){this.setScaledFlags(this.scaledFlags|Ir.YFitFlag),!0===t&&this.setScaledFlags(this.scaledFlags|Ir.YFitTweenFlag),this.requireUpdate(pn.NeedsLayout)}fit(t=!1){this.setScaledFlags(this.scaledFlags|Ir.XFitFlag|Ir.YFitFlag),!0===t&&this.setScaledFlags(this.scaledFlags|Ir.FitTweenMask),this.requireUpdate(pn.NeedsLayout)}onLayout(t){super.onLayout(t),this.xScale.recohere(t.updateTime),this.yScale.recohere(t.updateTime),this.resizeScales(),this.updateScales()}resizeScales(){let t;const e=this.xRange();if(null!==e)if(t=this.xScale.inherited?null:this.xScale.state,null!==t)t.range.equals(e)||(this.xScale.setRange(e),this.setScaledFlags(this.scaledFlags|Ir.RescaleFlag));else if(null===this.xScale.superFastener||null===this.xScale.superValue){const i=this.xDataDomainPadded;null!==i&&(t=Ir.createScale(i[0],i[1],e[0],e[1]),this.xScale.setState(t),this.setScaledFlags(this.scaledFlags|Ir.XFitFlag))}let i;const n=this.yRange();if(null!==n)if(i=this.yScale.inherited?null:this.yScale.state,null!==i)i.range.equals(n)||(this.yScale.setRange(n),this.setScaledFlags(this.scaledFlags|Ir.RescaleFlag));else if(null===this.yScale.superFastener||null===this.yScale.superValue){const t=this.yDataDomainPadded;null!==t&&(i=Ir.createScale(t[0],t[1],n[0],n[1]),this.yScale.setState(i),this.setScaledFlags(this.scaledFlags|Ir.YFitFlag))}}updateScales(){const t=this.xScale.inherited?null:this.xScale.state,e=this.yScale.inherited?null:this.yScale.state;if(null!==t&&null!==e){if(!this.gesture.pressing){const i=this.gesture.coasting;this.boundScales(t,e,i)}}}boundScales(t,i,n){const o=t.domain,s=i.domain;let r=o,a=s;const h=this.xDataDomainPadded;null!==h&&0!=(this.scaledFlags&Ir.XFitFlag)?(r=h,this.setScaledFlags(this.scaledFlags|Ir.XInRangeMask)):r=o;const c=this.yDataDomainPadded;null!==c&&0!=(this.scaledFlags&Ir.YFitFlag)?(a=c,this.setScaledFlags(this.scaledFlags|Ir.YInRangeMask)):a=s;const d=null!==h?h:o,u=this.xDomainBounds.value,p=!1===u[0]?void 0:!0===u[0]?d[0]:u[0],f=!1===u[1]?void 0:!0===u[1]?d[1]:u[1],g=this.xZoomBounds.value;let v=g[0],w=g[1];!0===v?v=t instanceof e.LinearScale?Ir.LinearZoomMin:t instanceof l.TimeScale?Ir.TimeZoomMin:void 0:!1===v&&(v=void 0),!0===w?w=t instanceof e.LinearScale?Ir.LinearZoomMax:t instanceof l.TimeScale?Ir.TimeZoomMax:void 0:!1===w&&(w=void 0),r=t.clampDomain(p,f,v,w).domain;const y=null!==c?c:s,m=this.yDomainBounds.value,b=!1===m[0]?void 0:!0===m[0]?y[0]:m[0],C=!1===m[1]?void 0:!0===m[1]?y[1]:m[1],S=this.yZoomBounds.value;let A=S[0],x=S[1];if(!0===A?A=i instanceof e.LinearScale?Ir.LinearZoomMin:i instanceof l.TimeScale?Ir.TimeZoomMin:void 0:!1===A&&(A=void 0),!0===x?x=i instanceof e.LinearScale?Ir.LinearZoomMax:i instanceof l.TimeScale?Ir.TimeZoomMax:void 0:!1===x&&(x=void 0),a=i.clampDomain(b,C,A,x).domain,null!==h&&!n&&0!=(this.scaledFlags&Ir.XDomainTrackingFlag)&&0!=(this.scaledFlags&Ir.XInRangeMask))if((this.scaledFlags&Ir.XInRangeMask)===Ir.XInRangeMask)r=h;else{const t=+r[1]-+r[0];r=0!=(this.scaledFlags&Ir.XMinInRangeFlag)?e.Domain(h[0],+h[0]+ +t):e.Domain(+h[1]-+t,h[1])}if(null!==c&&!n&&0!=(this.scaledFlags&Ir.YDomainTrackingFlag)&&0!=(this.scaledFlags&Ir.YInRangeMask))if((this.scaledFlags&Ir.YInRangeMask)===Ir.YInRangeMask)a=c;else{const t=+a[1]-+a[0];a=0!=(this.scaledFlags&Ir.YMinInRangeFlag)?e.Domain(c[0],+c[0]+ +t):e.Domain(+c[1]-+t,c[1])}const T=this.fitAspectRatio.value;if(void 0!==T&&(this.gesture.preserveAspectRatio||0!=(this.scaledFlags&Ir.FitMask))){const n=t.range,o=i.range,s=+r[1]-+r[0],l=+a[1]-+a[0],h=s/l,c=(n[1]-n[0])/(o[0]-o[1]),d=Math.abs(T*c);if(!e.Equivalent(h,d)){const t=this.fitAlign.value;if(T<0&&h<d||T>0&&h>d){const i=l*d-s;r=e.Domain(+r[0]-i*t[0],+r[1]+i*(1-t[0]))}else{const i=s/d-l;a=e.Domain(+a[0]-i*t[1],+a[1]+i*(1-t[1]))}}}if(0==(this.scaledFlags&Ir.XBoundingFlag)&&!e.Equivalent(r,o)){let e;0!=(this.scaledFlags&(Ir.XFitFlag|Ir.RescaleFlag))&&0==(this.scaledFlags&Ir.XFitTweenFlag)||(e=0!=(this.scaledFlags&Ir.InteractingMask)?this.reboundTransition.value:this.rescaleTransition.value,void 0!==e&&!1!==e&&this.setScaledFlags(this.scaledFlags|Ir.XBoundingFlag)),this.willReboundX(t),this.xDomain(r,e),void 0===e&&!1!==e&&this.didReboundX(this.xScale.getState()),null!==h&&0!=(this.scaledFlags&Ir.XFitFlag)&&this.setScaledFlags(this.scaledFlags&~Ir.XFitFlag)}if(0==(this.scaledFlags&Ir.YBoundingFlag)&&!e.Equivalent(a,s)){let t;0!=(this.scaledFlags&(Ir.YFitFlag|Ir.RescaleFlag))&&0==(this.scaledFlags&Ir.YFitTweenFlag)||(t=0!=(this.scaledFlags&Ir.InteractingMask)?this.reboundTransition.value:this.rescaleTransition.value,void 0!==t&&!1!==t&&this.setScaledFlags(this.scaledFlags|Ir.YBoundingFlag)),this.willReboundY(i),this.yDomain(a,t),void 0===t&&!1!==t&&this.didReboundY(this.yScale.getState()),null!==c&&0!=(this.scaledFlags&Ir.YFitFlag)&&this.setScaledFlags(this.scaledFlags&~Ir.YFitFlag)}this.setScaledFlags(this.scaledFlags&~(Ir.InteractedFlag|Ir.RescaleFlag))}displayChildren(t,e,i){let n,o;0!=(t&pn.NeedsLayout)&&(n=this.xScale.value,null!==n)&&(o=this.yScale.value,null!==o)?this.layoutChildViews(n,o,t,e,i):super.displayChildren(t,e,i)}layoutChildViews(t,n,o,s,r){let l,a,h,c,d=0,u=0,p=0,f=0,g=0,v=0;super.displayChildren(o,s,(function(t,i,n){if(r.call(this,t,i,n),Dr.is(t)&&t.xScale.inherited){const i=t.xDataDomain;if(null!==i){0!==g?(e.Values.compare(i[0],l)<0&&(l=i[0]),e.Values.compare(a,i[1])<0&&(a=i[1])):(l=i[0],a=i[1]);const n=t.xRangePadding();d=Math.max(n[0],d),u=Math.max(n[1],u),g+=1}}if(Vr.is(t)&&t.yScale.inherited){const i=t.yDataDomain;if(null!==i){0!==v?(e.Values.compare(i[0],h)<0&&(h=i[0]),e.Values.compare(c,i[1])<0&&(c=i[1])):(h=i[0],c=i[1]);const n=t.yRangePadding();p=Math.max(n[0],p),f=Math.max(n[1],f),v+=1}}})),this.setXDataDomain(0!==g?e.Domain(l,a):null),this.setYDataDomain(0!==v?e.Domain(h,c):null),this.xRangePadding.setValue([d,u],i.Affinity.Intrinsic),this.yRangePadding.setValue([p,f],i.Affinity.Intrinsic)}onBeginBoundingXScale(t){}onEndBoundingXScale(t){this.setScaledFlags(this.scaledFlags&~Ir.XBoundingFlag),this.didReboundX(t)}onInterruptBoundingXScale(t){this.setScaledFlags(this.scaledFlags&~Ir.XBoundingFlag),this.didReboundX(t)}onBeginBoundingYScale(t){}onEndBoundingYScale(t){this.setScaledFlags(this.scaledFlags&~Ir.YBoundingFlag),this.didReboundY(t)}onInterruptBoundingYScale(t){this.setScaledFlags(this.scaledFlags&~Ir.YBoundingFlag),this.didReboundY(t)}willReboundX(t){this.gesture.neutralizeX()}didReboundX(t){}willReboundY(t){this.gesture.neutralizeY()}didReboundY(t){}init(t){super.init(t),void 0!==t.xScale&&this.xScale(t.xScale),void 0!==t.yScale&&this.yScale(t.yScale),void 0!==t.xDomainBounds&&this.xDomainBounds(t.xDomainBounds),void 0!==t.yDomainBounds&&this.yDomainBounds(t.yDomainBounds),void 0!==t.xZoomBounds&&this.xZoomBounds(t.xZoomBounds),void 0!==t.yZoomBounds&&this.yZoomBounds(t.yZoomBounds),void 0!==t.xDomainPadding&&this.xDomainPadding(t.xDomainPadding),void 0!==t.yDomainPadding&&this.yDomainPadding(t.yDomainPadding),void 0!==t.xRangePadding&&this.xRangePadding(t.xRangePadding),void 0!==t.yRangePadding&&this.yRangePadding(t.yRangePadding),void 0!==t.fitAlign&&this.fitAlign(t.fitAlign),void 0!==t.xFitAlign&&this.xFitAlign(t.xFitAlign),void 0!==t.yFitAlign&&this.yFitAlign(t.yFitAlign),void 0!==t.fitAspectRatio&&this.fitAspectRatio(t.fitAspectRatio),void 0!==t.preserveAspectRatio&&this.preserveAspectRatio(t.preserveAspectRatio),void 0!==t.domainTracking&&this.domainTracking(t.domainTracking),void 0!==t.xDomainTracking&&this.xDomainTracking(t.xDomainTracking),void 0!==t.yDomainTracking&&this.yDomainTracking(t.yDomainTracking),void 0!==t.scaleGestures&&this.scaleGestures(t.scaleGestures),void 0!==t.xScaleGestures&&this.xScaleGestures(t.xScaleGestures),void 0!==t.yScaleGestures&&this.yScaleGestures(t.yScaleGestures),void 0!==t.rescaleTransition&&this.rescaleTransition.setValue(t.rescaleTransition),void 0!==t.reboundTransition&&this.reboundTransition.setValue(t.reboundTransition)}static createScale(t,i,n,o){let s;if(s="number"==typeof n&&"number"==typeof o?e.LinearRange(n,o):e.LinearRange(0,1),"number"==typeof t&&"number"==typeof i)return e.LinearScale(e.LinearDomain(t,i),s);if(t instanceof l.DateTime&&i instanceof l.DateTime)return l.TimeScale(l.TimeDomain(t,i),s);throw new TypeError(t+", "+i+", "+n+", "+o)}static parseScale(t){if("linear"===t)return e.LinearScale(e.LinearDomain(0,1),e.LinearRange(0,1));if("time"===t){const t=l.DateTime.current(),i=t.withDay(t.day-1);return l.TimeScale(l.TimeDomain(i,t),e.LinearRange(0,1))}{const i=t.split("..."),n=+i[0],o=+i[1];if(isFinite(n)&&isFinite(o))return e.LinearScale(e.LinearDomain(n,o),e.LinearRange(0,1));{const t=l.DateTime.parse(i[0]),n=l.DateTime.parse(i[1]);return l.TimeScale(l.TimeDomain(t,n),e.LinearRange(0,1))}}}}Ir.XDomainTrackingFlag=1,Ir.YDomainTrackingFlag=2,Ir.XScaleGesturesFlag=4,Ir.YScaleGesturesFlag=8,Ir.XMinInRangeFlag=16,Ir.XMaxInRangeFlag=32,Ir.YMinInRangeFlag=64,Ir.YMaxInRangeFlag=128,Ir.InteractingFlag=256,Ir.InteractedFlag=512,Ir.XBoundingFlag=1024,Ir.YBoundingFlag=2048,Ir.XFitFlag=4096,Ir.YFitFlag=8192,Ir.XFitTweenFlag=16384,Ir.YFitTweenFlag=32768,Ir.RescaleFlag=65536,Ir.DomainTrackingMask=Ir.XDomainTrackingFlag|Ir.YDomainTrackingFlag,Ir.ScaleGesturesMask=Ir.XScaleGesturesFlag|Ir.YScaleGesturesFlag,Ir.XInRangeMask=Ir.XMinInRangeFlag|Ir.XMaxInRangeFlag,Ir.YInRangeMask=Ir.YMinInRangeFlag|Ir.YMaxInRangeFlag,Ir.InteractingMask=Ir.InteractingFlag|Ir.InteractedFlag,Ir.BoundingMask=Ir.XBoundingFlag|Ir.YBoundingFlag,Ir.FitMask=Ir.XFitFlag|Ir.YFitFlag,Ir.FitTweenMask=Ir.XFitTweenFlag|Ir.YFitTweenFlag,Ir.LinearZoomMin=1e6,Ir.LinearZoomMax=.001,Ir.TimeZoomMin=864e5,Ir.TimeZoomMax=1,Ir.InsertChildFlags=io.InsertChildFlags|pn.NeedsResize,u([i.Animator({extends:Tr,type:e.ContinuousScale,inherits:!0,value:null,updateFlags:pn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetXScale",t,e,this.owner)},didSetValue(t,e){this.owner.updateXDataRange(),this.owner.callObservers("viewDidSetXScale",t,e,this.owner)},willTransition(t){0!=(this.owner.scaledFlags&Ir.XBoundingFlag)&&this.owner.onBeginBoundingXScale(t)},didTransition(t){0!=(this.owner.scaledFlags&Ir.XBoundingFlag)&&this.owner.onEndBoundingXScale(t)},didInterrupt(t){0!=(this.owner.scaledFlags&Ir.XBoundingFlag)&&this.owner.onInterruptBoundingXScale(t)}})],Ir.prototype,"xScale",void 0),u([i.Animator({extends:Tr,type:e.ContinuousScale,inherits:!0,value:null,updateFlags:pn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetYScale",t,e,this.owner)},didSetValue(t,e){this.owner.updateYDataRange(),this.owner.callObservers("viewDidSetYScale",t,e,this.owner)},willTransition(t){0!=(this.owner.scaledFlags&Ir.YBoundingFlag)&&this.owner.onBeginBoundingYScale(t)},didTransition(t){0!=(this.owner.scaledFlags&Ir.YBoundingFlag)&&this.owner.onEndBoundingYScale(t)},didInterrupt(t){0!=(this.owner.scaledFlags&Ir.YBoundingFlag)&&this.owner.onInterruptBoundingYScale(t)}})],Ir.prototype,"yScale",void 0),u([i.Property({updateFlags:pn.NeedsLayout,initValue:()=>[!0,!0],equalValues:(t,i)=>e.Arrays.equal(t,i)})],Ir.prototype,"xDomainBounds",void 0),u([i.Property({updateFlags:pn.NeedsLayout,initValue:()=>[!0,!0],equalValues:(t,i)=>e.Arrays.equal(t,i)})],Ir.prototype,"yDomainBounds",void 0),u([i.Property({updateFlags:pn.NeedsLayout,initValue:()=>[!0,!0],equalValues:(t,i)=>e.Arrays.equal(t,i)})],Ir.prototype,"xZoomBounds",void 0),u([i.Property({updateFlags:pn.NeedsLayout,initValue:()=>[!0,!0],equalValues:(t,i)=>e.Arrays.equal(t,i)})],Ir.prototype,"yZoomBounds",void 0),u([i.Property({updateFlags:pn.NeedsLayout,initValue:()=>[!1,!1],equalValues:(t,i)=>e.Arrays.equal(t,i)})],Ir.prototype,"xDomainPadding",void 0),u([i.Property({updateFlags:pn.NeedsLayout,initValue:()=>[!1,!1],equalValues:(t,i)=>e.Arrays.equal(t,i)})],Ir.prototype,"yDomainPadding",void 0),u([i.Property({updateFlags:pn.NeedsLayout,initValue:()=>[0,0],willSetValue(t,e){this.owner.callObservers("viewWillSetXRangePadding",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetXRangePadding",t,e,this.owner)},equalValues:(t,i)=>e.Arrays.equal(t,i)})],Ir.prototype,"xRangePadding",void 0),u([i.Property({updateFlags:pn.NeedsLayout,initValue:()=>[0,0],willSetValue(t,e){this.owner.callObservers("viewWillSetYRangePadding",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetYRangePadding",t,e,this.owner)},equalValues:(t,i)=>e.Arrays.equal(t,i)})],Ir.prototype,"yRangePadding",void 0),u([i.Property({type:Object,initValue:()=>[1,.5],equalValues:(t,i)=>e.Arrays.equal(t,i),fromAny:t=>"number"==typeof t?[t,t]:t})],Ir.prototype,"fitAlign",void 0),u([i.Property({type:Number})],Ir.prototype,"fitAspectRatio",void 0),u([i.Property({type:e.Timing,inherits:!0,initValue:()=>e.Easing.linear.withDuration(250)})],Ir.prototype,"rescaleTransition",void 0),u([i.Property({type:e.Timing,inherits:!0,initValue:()=>e.Easing.cubicOut.withDuration(250)})],Ir.prototype,"reboundTransition",void 0),u([vn({binds:!0,observes:!0,willAttachView(t,e){this.owner.callObservers("viewWillAttachScaled",t,e,this.owner)},didAttachView(t){Dr.is(t)&&this.owner.updateXDataDomain(t.xDataDomain),Vr.is(t)&&this.owner.updateYDataDomain(t.yDataDomain)},didDetachView(t){this.owner.callObservers("viewDidDetachScaled",t,this.owner)},viewDidSetXRangePadding(t,e){this.owner.updateXRangePadding(t)},viewDidSetYRangePadding(t,e){this.owner.updateYRangePadding(t)},viewDidSetXDataDomain(t,e){this.owner.updateXDataDomain(t),this.owner.requireUpdate(pn.NeedsLayout)},viewDidSetYDataDomain(t,e){this.owner.updateYDataDomain(t),this.owner.requireUpdate(pn.NeedsLayout)},detectView:t=>Dr.is(t)||Vr.is(t)?t:null})],Ir.prototype,"scaled",void 0),u([hn({self:!0,getXScale(){return 0!=(this.owner.scaledFlags&Ir.XScaleGesturesFlag)?this.owner.xScale():null},setXScale(t,e){0!=(this.owner.scaledFlags&Ir.XScaleGesturesFlag)&&this.owner.xScale(t,e)},getYScale(){return 0!=(this.owner.scaledFlags&Ir.YScaleGesturesFlag)?this.owner.yScale():null},setYScale(t,e){0!=(this.owner.scaledFlags&Ir.YScaleGesturesFlag)&&this.owner.yScale(t,e)},willStartInteracting(){this.owner.setScaledFlags(this.owner.scaledFlags&~Ir.BoundingMask|Ir.InteractingFlag)},didStopInteracting(){const t=this.owner.xScale.value,e=this.owner.xDataDomain;if(null!==t&&null!==e){const i=t.domain;i.contains(e[0])?this.owner.setScaledFlags(this.owner.scaledFlags|Ir.XMinInRangeFlag):this.owner.setScaledFlags(this.owner.scaledFlags&~Ir.XMinInRangeFlag),i.contains(e[1])?this.owner.setScaledFlags(this.owner.scaledFlags|Ir.XMaxInRangeFlag):this.owner.setScaledFlags(this.owner.scaledFlags&~Ir.XMaxInRangeFlag)}const i=this.owner.yScale.value,n=this.owner.yDataDomain;if(null!==i&&null!==n){const t=i.domain;t.contains(n[0])?this.owner.setScaledFlags(this.owner.scaledFlags|Ir.YMinInRangeFlag):this.owner.setScaledFlags(this.owner.scaledFlags&~Ir.YMinInRangeFlag),t.contains(n[1])?this.owner.setScaledFlags(this.owner.scaledFlags|Ir.YMaxInRangeFlag):this.owner.setScaledFlags(this.owner.scaledFlags&~Ir.YMaxInRangeFlag)}this.owner.setScaledFlags(this.owner.scaledFlags&~Ir.InteractingFlag|Ir.InteractedFlag)},didStopPressing(){this.owner.requireUpdate(pn.NeedsLayout)},willBeginCoast(t,e){0==(this.owner.scaledFlags&Ir.XScaleGesturesFlag)&&(t.disableX=!0,t.vx=0,t.ax=0),0==(this.owner.scaledFlags&Ir.YScaleGesturesFlag)&&(t.disableY=!0,t.vy=0,t.ay=0)}})],Ir.prototype,"gesture",void 0);class Mr extends io{constructor(){super(),this.xDataDomain=null,this.yDataDomain=null,this.xDataRange=null,this.yDataRange=null}xDomain(t,e,i){if(0===arguments.length){const t=this.xScale.value;return null!==t?t.domain:null}return this.xScale.setDomain(t,e,i),this}yDomain(t,e,i){if(0===arguments.length){const t=this.yScale.value;return null!==t?t.domain:null}return this.yScale.setDomain(t,e,i),this}xRange(){const t=this.xScale.value;return null!==t?t.range:null}yRange(){const t=this.yScale.value;return null!==t?t.range:null}setXDataDomain(t){const i=this.xDataDomain;e.Equals(t,i)||(this.willSetXDataDomain(t,i),this.xDataDomain=t,this.onSetXDataDomain(t,i),this.didSetXDataDomain(t,i))}willSetXDataDomain(t,e){this.callObservers("viewWillSetXDataDomain",t,e,this)}onSetXDataDomain(t,e){this.updateXDataRange(),this.requireUpdate(pn.NeedsLayout)}didSetXDataDomain(t,e){this.callObservers("viewDidSetXDataDomain",t,e,this)}updateXDataDomain(t){const i=t.x.getValue();let n=this.xDataDomain;null===n?n=e.Domain(i,i):e.Values.compare(i,n[0])<0?n=e.Domain(i,n[1]):e.Values.compare(n[1],i)<0&&(n=e.Domain(n[0],i)),this.setXDataDomain(n)}setYDataDomain(t){const i=this.yDataDomain;e.Equals(t,i)||(this.willSetYDataDomain(t,i),this.yDataDomain=t,this.onSetYDataDomain(t,i),this.didSetYDataDomain(t,i))}willSetYDataDomain(t,e){this.callObservers("viewWillSetYDataDomain",t,e,this)}onSetYDataDomain(t,e){this.updateYDataRange(),this.requireUpdate(pn.NeedsLayout)}didSetYDataDomain(t,e){this.callObservers("viewDidSetYDataDomain",t,e,this)}updateYDataDomain(t){const i=t.y.value,n=t.y2.value;let o=this.yDataDomain;null===o?o=e.Domain(i,i):(e.Values.compare(i,o[0])<0?o=e.Domain(i,o[1]):e.Values.compare(o[1],i)<0&&(o=e.Domain(o[0],i)),void 0!==n&&(e.Values.compare(n,o[0])<0?o=e.Domain(n,o[1]):e.Values.compare(o[1],n)<0&&(o=e.Domain(o[0],n)))),this.setYDataDomain(o)}setXDataRange(t){this.xDataRange=t}updateXDataRange(){const t=this.xDataDomain;if(null!==t){const i=this.xScale.value;null!==i?this.setXDataRange(e.LinearRange(i(t[0]),i(t[1]))):this.setXDataRange(null)}}setYDataRange(t){this.yDataRange=t}updateYDataRange(){const t=this.yDataDomain;if(null!==t){const i=this.yScale.value;null!==i?this.setYDataRange(e.LinearRange(i(t[0]),i(t[1]))):this.setYDataRange(null)}}onLayout(t){super.onLayout(t),this.xScale.recohere(t.updateTime),this.yScale.recohere(t.updateTime),this.resizeScales(this.viewFrame)}resizeScales(t){const e=this.xScale.inherited?null:this.xScale.value;null!==e&&e.range[1]!==t.width&&this.xScale.setRange(0,t.width);const i=this.yScale.inherited?null:this.yScale.value;null!==i&&i.range[1]!==t.height&&this.yScale.setRange(0,t.height)}displayChildren(t,e,i){let n,o;0!=(t&pn.NeedsLayout)&&(n=this.xScale.value,null!==n)&&(o=this.yScale.value,null!==o)?this.layoutChildViews(n,o,t,e,i):super.displayChildren(t,e,i)}layoutChildViews(t,n,o,s,r){const l=this.viewFrame,a=Math.min(l.width,l.height);let h,c,d,u,p=0,f=0,g=0,v=0,w=null;super.displayChildren(o,s,(function(i,o,s){if(i instanceof br){const o=i.x.getValue(),s=i.y.getValue(),r=i.y2.value,y=i.radius.value,m=t(o),b=n(s);if(i.setXCoord(l.xMin+m),i.setYCoord(l.yMin+b),null!==w?(e.Values.compare(o,h)<0?h=o:e.Values.compare(c,o)<0&&(c=o),e.Values.compare(s,d)<0?d=s:e.Values.compare(u,s)<0&&(u=s),void 0!==r&&(e.Values.compare(r,d)<0?d=r:e.Values.compare(u,r)<0&&(u=r))):(h=o,c=o,d=s,u=s),null!==y){const t=y.pxValue(a);p=Math.max(t,p),f=Math.max(t,f),g=Math.max(t,g),v=Math.max(t,v)}w=i}r.call(this,i,o,s)})),this.setXDataDomain(null!==w?e.Domain(h,c):null),this.setYDataDomain(null!==w?e.Domain(d,u):null),this.xRangePadding.setValue([p,f],i.Affinity.Intrinsic),this.yRangePadding.setValue([g,v],i.Affinity.Intrinsic)}didRender(t){const e=t.renderer;e instanceof ho&&!this.hidden&&!this.culled&&this.renderPlot(e.context,this.viewFrame),super.didRender(t)}init(t){super.init(t),void 0!==t.xScale&&this.xScale(t.xScale),void 0!==t.yScale&&this.yScale(t.yScale);const e=t.data;if(void 0!==e)for(let t=0,i=e.length;t<i;t+=1)this.appendChild(br.fromAny(e[t]));void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor)}}u([zt({type:O,value:null,inherits:!0})],Mr.prototype,"font",void 0),u([zt({type:B,value:null,inherits:!0})],Mr.prototype,"textColor",void 0),u([i.Animator({extends:Tr,type:e.ContinuousScale,inherits:!0,value:null,updateFlags:pn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetXScale",t,e,this.owner)},didSetValue(t,e){this.owner.updateXDataRange(),this.owner.callObservers("viewDidSetXScale",t,e,this.owner)}})],Mr.prototype,"xScale",void 0),u([i.Animator({extends:Tr,type:e.ContinuousScale,inherits:!0,value:null,updateFlags:pn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetYScale",t,e,this.owner)},didSetValue(t,e){this.owner.updateYDataRange(),this.owner.callObservers("viewDidSetYScale",t,e,this.owner)}})],Mr.prototype,"yScale",void 0),u([i.Property({initValue:()=>[0,0],willSetValue(t,e){this.owner.callObservers("viewWillSetXRangePadding",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetXRangePadding",t,e,this.owner)}})],Mr.prototype,"xRangePadding",void 0),u([i.Property({initValue:()=>[0,0],willSetValue(t,e){this.owner.callObservers("viewWillSetYRangePadding",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetYRangePadding",t,e,this.owner)}})],Mr.prototype,"yRangePadding",void 0),u([vn({implements:!0,type:br,binds:!0,observes:!0,willAttachView(t,e){this.owner.callObservers("viewWillAttachDataPoint",t,e,this.owner)},didAttachView(t){this.owner.updateXDataDomain(t),this.owner.updateYDataDomain(t);const e=t.label.view;null!==e&&this.attachDataPointLabelView(e)},willDetachView(t){const e=t.label.view;null!==e&&this.detachDataPointLabelView(e)},didDetachView(t){this.owner.callObservers("viewDidDetachDataPoint",t,this.owner)},viewDidSetDataPointX(t,e,i){this.owner.updateXDataDomain(i),this.owner.requireUpdate(pn.NeedsLayout)},viewDidSetDataPointY(t,e,i){this.owner.updateYDataDomain(i),this.owner.requireUpdate(pn.NeedsLayout)},viewDidSetDataPointY2(t,e,i){this.owner.updateYDataDomain(i),this.owner.requireUpdate(pn.NeedsLayout)},viewWillAttachDataPointLabel(t){this.attachDataPointLabelView(t)},viewDidDetachDataPointLabel(t){this.detachDataPointLabelView(t)},attachDataPointLabelView(t){this.owner.requireUpdate(pn.NeedsLayout)},detachDataPointLabelView(t){}})],Mr.prototype,"dataPoints",void 0);class Lr extends io{constructor(){super(),this.xDataDomain=null,this.yDataDomain=null,this.xDataRange=null,this.yDataRange=null,this.gradientStops=0,this.dataPointViews=new c.BTree}xDomain(t,e,i){if(0===arguments.length){const t=this.xScale.value;return null!==t?t.domain:null}return this.xScale.setDomain(t,e,i),this}yDomain(t,e,i){if(0===arguments.length){const t=this.yScale.value;return null!==t?t.domain:null}return this.yScale.setDomain(t,e,i),this}xRange(){const t=this.xScale.value;return null!==t?t.range:null}yRange(){const t=this.yScale.value;return null!==t?t.range:null}setXDataDomain(t){const i=this.xDataDomain;e.Equals(t,i)||(this.willSetXDataDomain(t,i),this.xDataDomain=t,this.onSetXDataDomain(t,i),this.didSetXDataDomain(t,i))}willSetXDataDomain(t,e){this.callObservers("viewWillSetXDataDomain",t,e,this)}onSetXDataDomain(t,e){this.updateXDataRange(),this.requireUpdate(pn.NeedsLayout)}didSetXDataDomain(t,e){this.callObservers("viewDidSetXDataDomain",t,e,this)}updateXDataDomain(t){const i=this.dataPointViews,n=i.firstKey(),o=i.lastKey();let s;if(void 0!==n&&void 0!==o)s=e.Domain(n,o);else{const i=t.x.getValue();s=e.Domain(i,i)}this.setXDataDomain(s)}setYDataDomain(t){const i=this.yDataDomain;e.Equals(t,i)||(this.willSetYDataDomain(t,i),this.yDataDomain=t,this.onSetYDataDomain(t,i),this.didSetYDataDomain(t,i))}willSetYDataDomain(t,e){this.callObservers("viewWillSetYDataDomain",t,e,this)}onSetYDataDomain(t,e){this.updateYDataRange(),this.requireUpdate(pn.NeedsLayout)}didSetYDataDomain(t,e){this.callObservers("viewDidSetYDataDomain",t,e,this)}updateYDataDomain(t){const i=t.y.value,n=t.y2.value;let o=this.yDataDomain;null===o?o=e.Domain(i,i):(e.Values.compare(i,o[0])<0?o=e.Domain(i,o[1]):e.Values.compare(o[1],i)<0&&(o=e.Domain(o[0],i)),void 0!==n&&(e.Values.compare(n,o[0])<0?o=e.Domain(n,o[1]):e.Values.compare(o[1],n)<0&&(o=e.Domain(o[0],n)))),this.setYDataDomain(o)}setXDataRange(t){this.xDataRange=t}updateXDataRange(){const t=this.xDataDomain;if(null!==t){const i=this.xScale.value;null!==i?this.setXDataRange(e.LinearRange(i(t[0]),i(t[1]))):this.setXDataRange(null)}}setYDataRange(t){this.yDataRange=t}updateYDataRange(){const t=this.yDataDomain;if(null!==t){const i=this.yScale.value;null!==i?this.setYDataRange(e.LinearRange(i(t[0]),i(t[1]))):this.setYDataRange(null)}}getDataPoint(t){const e=this.dataPointViews.get(t);return void 0!==e?e:null}insertDataPoint(t){return this.insertChild(br.fromAny(t),null)}insertDataPoints(...t){for(let e=0,i=t.length;e<i;e+=1)this.insertDataPoint(t[e])}removeDataPoint(t){const e=this.getDataPoint(t);return null!==e&&this.removeChild(e),e}setChild(t,e){var i;if(null!==e&&(e=pn.fromAny(e)),e instanceof br){const n=null!==(i=this.dataPointViews.nextValue(e.x.state))&&void 0!==i?i:null,o=this.getChild(t);return super.insertChild(e,n,t),o}return super.setChild(t,e)}appendChild(t,e){var i;if((t=pn.fromAny(t))instanceof br){const n=null!==(i=this.dataPointViews.nextValue(t.x.state))&&void 0!==i?i:null;return super.insertChild(t,n,e)}return super.appendChild(t,e)}prependChild(t,e){var i;if((t=pn.fromAny(t))instanceof br){const n=null!==(i=this.dataPointViews.nextValue(t.x.state))&&void 0!==i?i:null;return super.insertChild(t,n,e)}return super.prependChild(t,e)}insertChild(t,e,i){var n;return(t=pn.fromAny(t))instanceof br&&null===e&&(e=null!==(n=this.dataPointViews.nextValue(t.x.state))&&void 0!==n?n:null),super.insertChild(t,e,i)}onLayout(t){super.onLayout(t),this.xScale.recohere(t.updateTime),this.yScale.recohere(t.updateTime),this.resizeScales(this.viewFrame)}resizeScales(t){const e=this.xScale.inherited?null:this.xScale.value;null!==e&&e.range[1]!==t.width&&this.xScale.setRange(0,t.width);const i=this.yScale.inherited?null:this.yScale.value;null!==i&&i.range[1]!==t.height&&this.yScale.setRange(0,t.height)}displayChildren(t,e,i){let n,o;0!=(t&pn.NeedsLayout)&&(n=this.xScale.value,null!==n)&&(o=this.yScale.value,null!==o)?this.layoutChildViews(n,o,t,e,i):super.displayChildren(t,e,i)}layoutChildViews(t,n,o,s,r){const l=this.viewFrame;let a,h,c,d,u,p,f=0,g=null,v=null;if(super.displayChildren(o,s,(function(o,s,w){const y=o,m=y.x.getValue(),b=y.y.getValue(),C=y.y2.value,S=t(m),A=n(b);y.setXCoord(l.xMin+S),y.setYCoord(l.yMin+A);const x=void 0!==C?n(C):void 0;if(void 0!==x?y.setY2Coord(l.yMin+x):void 0!==y.y2Coord&&y.setY2Coord(void 0),y.isGradientStop()&&(f+=1),null!==v){let t;t=null!==g?e.Values.compare(u,p)<0&&e.Values.compare(b,p)<0?"maxima":e.Values.compare(p,u)<0&&e.Values.compare(p,b)<0?"minima":e.Values.compare(u,p)<0&&e.Values.compare(p,b)<0?"increasing":e.Values.compare(p,u)<0&&e.Values.compare(b,p)<0?"decreasing":"flat":e.Values.compare(p,b)<0?"increasing":e.Values.compare(b,p)<0?"decreasing":"flat",v.category.setValue(t,i.Affinity.Intrinsic),e.Values.compare(b,c)<0?c=b:e.Values.compare(d,b)<0&&(d=b),void 0!==C&&(e.Values.compare(C,c)<0?c=C:e.Values.compare(d,C)<0&&(d=C))}else a=m,h=m,c=b,d=b;g=v,v=y,u=p,p=b,h=m,r.call(this,o,s,w)})),null!==v){let t;t=null!==g?e.Values.compare(u,p)<0?"increasing":e.Values.compare(p,u)<0?"decreasing":"flat":"flat",v.category.setValue(t,i.Affinity.Intrinsic)}this.setXDataDomain(null!==g?e.Domain(a,h):null),this.setYDataDomain(null!==g?e.Domain(c,d):null),this.gradientStops=f}didRender(t){const e=t.renderer;e instanceof ho&&!this.hidden&&!this.culled&&this.renderPlot(e.context,this.viewFrame),super.didRender(t)}hitTest(t,e,i){const n=this.hitMode.value;if("none"!==n){const o=i.renderer;if(o instanceof ho){let i;if("domain"===n){const n=this.viewFrame;i=this.hitTestDomain(t-n.x,e-n.y,o)}else i=this.hitTestPlot(t,e,o);return i}}return null}hitTestChildren(t,e,i){return null}hitTestDomain(t,e,i){const n=this.xScale.value;if(null!==n){const e=n.inverse(t),i=this.dataPointViews.previousValue(e),o=this.dataPointViews.nextValue(e),s=void 0!==i?i.x.value:void 0,r=void 0!==o?o.x.value:void 0,l=void 0!==s?+e-+s:NaN,a=void 0!==r?+r-+e:NaN;if(l<=a)return i;if(l>a)return o;if(void 0!==i)return i;if(void 0!==o)return o}return null}init(t){super.init(t),void 0!==t.xScale&&this.xScale(t.xScale),void 0!==t.yScale&&this.yScale(t.yScale);const e=t.data;void 0!==e&&this.insertDataPoints(...e),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor),void 0!==t.hitMode&&this.hitMode(t.hitMode)}}u([zt({type:O,value:null,inherits:!0})],Lr.prototype,"font",void 0),u([zt({type:B,value:null,inherits:!0})],Lr.prototype,"textColor",void 0),u([i.Property({type:String,value:"domain"})],Lr.prototype,"hitMode",void 0),u([i.Animator({extends:Tr,type:e.ContinuousScale,inherits:!0,value:null,updateFlags:pn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetXScale",t,e,this.owner)},didSetValue(t,e){this.owner.updateXDataRange(),this.owner.callObservers("viewDidSetXScale",t,e,this.owner)}})],Lr.prototype,"xScale",void 0),u([i.Animator({extends:Tr,type:e.ContinuousScale,inherits:!0,value:null,updateFlags:pn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetYScale",t,e,this.owner)},didSetValue(t,e){this.owner.updateYDataRange(),this.owner.callObservers("viewDidSetYScale",t,e,this.owner)}})],Lr.prototype,"yScale",void 0),u([i.Property({initValue:()=>[0,0],willSetValue(t,e){this.owner.callObservers("viewWillSetXRangePadding",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetXRangePadding",t,e,this.owner)}})],Lr.prototype,"xRangePadding",void 0),u([i.Property({initValue:()=>[0,0],willSetValue(t,e){this.owner.callObservers("viewWillSetYRangePadding",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetYRangePadding",t,e,this.owner)}})],Lr.prototype,"yRangePadding",void 0),u([vn({implements:!0,type:br,binds:!0,observes:!0,willAttachView(t,e){this.owner.callObservers("viewWillAttachDataPoint",t,e,this.owner)},didAttachView(t){void 0===this.owner.dataPointViews.get(t.x.state)&&this.owner.dataPointViews.set(t.x.state,t),this.owner.updateXDataDomain(t),this.owner.updateYDataDomain(t);const e=t.label.view;null!==e&&this.attachDataPointLabelView(e)},willDetachView(t){this.owner.dataPointViews.get(t.x.state)===t&&this.owner.dataPointViews.delete(t.x.state);const e=t.label.view;null!==e&&this.detachDataPointLabelView(e),this.owner.updateXDataDomain(t)},didDetachView(t){this.owner.callObservers("viewDidDetachDataPoint",t,this.owner)},viewDidSetDataPointX(t,e,i){this.owner.updateXDataDomain(i),this.owner.requireUpdate(pn.NeedsLayout)},viewDidSetDataPointY(t,e,i){this.owner.updateYDataDomain(i),this.owner.requireUpdate(pn.NeedsLayout)},viewDidSetDataPointY2(t,e,i){this.owner.updateYDataDomain(i),this.owner.requireUpdate(pn.NeedsLayout)},viewWillAttachDataPointLabel(t){this.attachDataPointLabelView(t)},viewDidDetachDataPointLabel(t){this.detachDataPointLabelView(t)},attachDataPointLabelView(t){this.owner.requireUpdate(pn.NeedsLayout)},detachDataPointLabelView(t){}})],Lr.prototype,"dataPoints",void 0);class kr extends Mr{renderPlot(t,e){const i=Math.min(e.width,e.height),n=this.radius.getValueOr(o.Length.zero()),s=this.fill.value,r=this.stroke.value,l=this.strokeWidth.value,a=t.fillStyle,h=t.lineWidth,c=t.strokeStyle,d=this.dataPoints.views;for(const e in d){const o=d[e];t.beginPath();const a=o.radius.getValueOr(n).pxValue(i);t.arc(o.xCoord,o.yCoord,a,0,2*Math.PI);let h=o.color.getValueOr(s);if(null!==h){const e=o.opacity.value;void 0!==e&&(h=h.alpha(e)),t.fillStyle=h.toString(),t.fill()}null!==r&&(null!==l&&(t.lineWidth=l.pxValue(i)),t.strokeStyle=r.toString(),t.stroke())}t.fillStyle=a,t.lineWidth=h,t.strokeStyle=c}init(t){super.init(t),void 0!==t.radius&&this.radius(t.radius),void 0!==t.fill&&this.fill(t.fill),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth)}}u([zt({type:o.Length,value:o.Length.px(5),updateFlags:pn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetPlotRadius",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetPlotRadius",t,e,this.owner)}})],kr.prototype,"radius",void 0),u([zt({type:B,value:null,look:St.accentColor,updateFlags:pn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetPlotFill",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetPlotFill",t,e,this.owner)}})],kr.prototype,"fill",void 0),u([zt({type:B,value:null,updateFlags:pn.NeedsRender})],kr.prototype,"stroke",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsRender})],kr.prototype,"strokeWidth",void 0);class Fr extends Lr{renderPlot(t,e){const i=Math.min(e.width,e.height),n=this.stroke.getValueOr(B.transparent()),s=this.strokeWidth.getValueOr(o.Length.zero()).pxValue(i),r=this.gradientStops;let l,a,h,c=null;const d=this.dataPointViews;if(d.isEmpty())l=NaN,a=NaN,h=NaN;else{const e=d.firstValue(),i=d.lastValue();l=e.xCoord,a=i.xCoord,h=a-l,0!==r&&(c=t.createLinearGradient(l,0,a,0))}t.beginPath();let u=0;d.forEach((function(e,i){const o=i.xCoord,s=i.yCoord;if(0===u?t.moveTo(o,s):t.lineTo(o,s),null!==c&&i.isGradientStop()){let t=i.color.getValueOr(n);const e=i.opacity.value;void 0!==e&&(t=t.alpha(e));const s=(o-l)/(h||1);c.addColorStop(s,t.toString())}u+=1}),this);const p=t.lineWidth,f=t.strokeStyle;t.lineWidth=s,t.strokeStyle=null!==c?c:n.toString(),t.stroke(),t.lineWidth=p,t.strokeStyle=f}hitTestPlot(t,e,i){const n=i.context;let o=this.hitWidth.value;const s=this.strokeWidth.value;if(null!==s){const t=this.viewFrame,e=Math.min(t.width,t.height);o=Math.max(o,s.pxValue(e))}n.beginPath();let r=0;this.dataPointViews.forEach((function(t,e){const i=e.xCoord,o=e.yCoord;0===r?n.moveTo(i,o):n.lineTo(i,o),r+=1}),this);const l=n.lineWidth;n.lineWidth=o;const a=i.transform.transform(t,e),h=n.isPointInStroke(a.x,a.y);if(n.lineWidth=l,h){const n=this.hitMode.value;if("plot"===n)return this;if("data"===n)return this.hitTestDomain(t,e,i)}return null}init(t){super.init(t),void 0!==t.hitWidth&&this.hitWidth(t.hitWidth),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth)}}u([zt({type:B,value:null,look:St.accentColor,updateFlags:pn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetPlotStroke",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetPlotStroke",t,e,this.owner)}})],Fr.prototype,"stroke",void 0),u([zt({type:o.Length,value:o.Length.px(1),updateFlags:pn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetPlotStrokeWidth",t,e,this.owner)},didSetValue(t,e){if(this.owner.xRangePadding.hasAffinity(i.Affinity.Intrinsic)||this.owner.yRangePadding.hasAffinity(i.Affinity.Intrinsic)){const t=this.owner.viewFrame,e=Math.min(t.width,t.height),n=this.getValueOr(o.Length.zero()).pxValue(e)/2;this.owner.xRangePadding.setValue([n,n],i.Affinity.Intrinsic),this.owner.yRangePadding.setValue([n,n],i.Affinity.Intrinsic)}this.owner.callObservers("viewDidSetPlotStrokeWidth",t,e,this.owner)}})],Fr.prototype,"strokeWidth",void 0),u([i.Property({type:Number,value:5})],Fr.prototype,"hitWidth",void 0);class Rr extends Lr{renderPlot(t,e){const i=this.fill.getValueOr(B.transparent()),n=this.gradientStops;let o,s,r,l=null;t.beginPath();const a=this.dataPointViews;if(a.isEmpty())o=NaN,s=NaN,r=NaN;else{const e=a.firstValue(),h=a.lastValue();if(o=e.xCoord,s=h.xCoord,r=s-o,t.moveTo(e.xCoord,e.yCoord),0!==n&&(l=t.createLinearGradient(o,0,s,0),e.isGradientStop())){let t=e.color.getValueOr(i);const n=e.opacity.value;void 0!==n&&(t=t.alpha(n)),l.addColorStop(0,t.toString())}}const h=a.values();for(h.next();h.hasNext();){const e=h.next().value;if(t.lineTo(e.xCoord,e.yCoord),null!==l&&e.isGradientStop()){let t=e.color.value||i;const n=e.opacity.value;void 0!==n&&(t=t.alpha(n));const s=(e.xCoord-o)/(r||1);l.addColorStop(s,t.toString())}}for(;h.hasPrevious();){const e=h.previous().value;t.lineTo(e.xCoord,e.y2Coord)}a.isEmpty()||t.closePath();const c=t.fillStyle;t.fillStyle=null!==l?l:i.toString(),t.fill(),t.fillStyle=c}hitTestPlot(t,e,i){const n=i.context,o=this.dataPointViews;n.beginPath();const s=o.values();if(s.hasNext()){const t=s.next().value;n.moveTo(t.xCoord,t.yCoord)}for(;s.hasNext();){const t=s.next().value;n.lineTo(t.xCoord,t.yCoord)}for(;s.hasPrevious();){const t=s.previous().value;n.lineTo(t.xCoord,t.y2Coord)}o.isEmpty()||n.closePath();const r=i.transform.transform(t,e);if(n.isPointInPath(r.x,r.y)){const n=this.hitMode.value;if("plot"===n)return this;if("data"===n)return this.hitTestDomain(t,e,i)}return null}init(t){super.init(t),void 0!==t.fill&&this.fill(t.fill)}}u([zt({type:B,value:null,look:St.accentColor,updateFlags:pn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetPlotFill",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetPlotFill",t,e,this.owner)}})],Rr.prototype,"fill",void 0);class Or extends S{onStartConsuming(){super.onStartConsuming();const t=this.dataSet.trait;null!==t&&t.consume(this)}onStopConsuming(){super.onStopConsuming();const t=this.dataSet.trait;null!==t&&t.unconsume(this)}}u([x({type:Sr,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachDataSet",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachDataSet",t,this.owner)},detectModel:t=>null,detectTrait:t=>t instanceof Sr?t:null})],Or.prototype,"dataSet",void 0);class Wr extends Or{}class Er extends Or{}class Nr extends Wr{}u([i.Property({type:o.Length,value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetPlotRadius",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetPlotRadius",t,e,this.owner)}})],Nr.prototype,"radius",void 0),u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetPlotFill",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetPlotFill",t,e,this.owner)},fromAny:t=>(null===t||t instanceof St||(t=B.fromAny(t)),t)})],Nr.prototype,"fill",void 0);class Br extends Er{}u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetPlotStroke",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetPlotStroke",t,e,this.owner)},fromAny:t=>(null===t||t instanceof St||(t=B.fromAny(t)),t)})],Br.prototype,"stroke",void 0),u([i.Property({type:o.Length,value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetPlotStrokeWidth",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetPlotStrokeWidth",t,e,this.owner)}})],Br.prototype,"strokeWidth",void 0);class Ur extends Er{}u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetPlotFill",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetPlotFill",t,e,this.owner)},fromAny:t=>(null===t||t instanceof St||(t=B.fromAny(t)),t)})],Ur.prototype,"fill",void 0);class zr extends xr{static fromTrait(t){if(t instanceof Nr)return new Hr;if(t instanceof Br)return new jr;if(t instanceof Ur)return new Yr;throw new Error("Can't create PlotController from "+t)}}u([i.Property({type:e.Timing,inherits:!0})],zr.prototype,"plotTiming",void 0);class qr extends zr{}class Gr extends zr{}class Hr extends qr{setPlotRadius(t,n){const o=this.plot.view;null!==o&&(void 0===n||!0===n?!0===(n=this.plotTiming.value)&&(n=o.getLook(St.timing,Ot.ambient)):n=e.Timing.fromAny(n),o.radius.setState(t,n,i.Affinity.Intrinsic))}setPlotFill(t,n){const o=this.plot.view;null!==o&&(void 0===n||!0===n?!0===(n=this.plotTiming.value)&&(n=o.getLook(St.timing,Ot.ambient)):n=e.Timing.fromAny(n),t instanceof St?o.fill.setLook(t,n,i.Affinity.Intrinsic):o.fill.setState(t,n,i.Affinity.Intrinsic))}}u([ns({extends:!0,get parentView(){return this.owner.plot.view}})],Hr.prototype,"dataPoints",void 0),u([$o({traitType:Nr,observesTrait:!0,initTrait(t){if(null===this.owner.dataSet.trait){const e=t.getTrait(Sr);null!==e&&this.owner.dataSet.setTrait(e)}null!==this.view&&(this.owner.setPlotRadius(t.radius.value),this.owner.setPlotFill(t.fill.value))},willAttachTrait(t){this.owner.callObservers("controllerWillAttachPlotTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachPlotTrait",t,this.owner)},traitDidSetPlotRadius(t,e){this.owner.setPlotRadius(t)},traitDidSetPlotFill(t,e){this.owner.setPlotFill(t)},viewType:kr,observesView:!0,initView(t){const e=this.owner.dataPoints.controllers;for(const i in e){e[i].dataPoint.insertView(t)}const i=this.trait;null!==i&&(this.owner.setPlotRadius(i.radius.value),this.owner.setPlotFill(i.fill.value))},willAttachView(t){this.owner.callObservers("controllerWillAttachPlotView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachPlotView",t,this.owner)},viewWillSetPlotRadius(t,e,i){this.owner.callObservers("controllerWillSetPlotRadius",t,e,this.owner)},viewDidSetPlotRadius(t,e,i){this.owner.callObservers("controllerDidSetPlotRadius",t,e,this.owner)},viewWillSetPlotFill(t,e,i){this.owner.callObservers("controllerWillSetPlotFill",t,e,this.owner)},viewDidSetPlotFill(t,e,i){this.owner.callObservers("controllerDidSetPlotFill",t,e,this.owner)}})],Hr.prototype,"plot",void 0);class jr extends Gr{setPlotStroke(t,n){const o=this.plot.view;null!==o&&(void 0===n||!0===n?!0===(n=this.plotTiming.value)&&(n=o.getLook(St.timing,Ot.ambient)):n=e.Timing.fromAny(n),t instanceof St?o.stroke.setLook(t,n,i.Affinity.Intrinsic):o.stroke.setState(t,n,i.Affinity.Intrinsic))}setPlotStrokeWidth(t,n){const o=this.plot.view;null!==o&&(void 0===n||!0===n?!0===(n=this.plotTiming.value)&&(n=o.getLook(St.timing,Ot.ambient)):n=e.Timing.fromAny(n),o.strokeWidth.setState(t,n,i.Affinity.Intrinsic))}}u([ns({extends:!0,get parentView(){return this.owner.plot.view}})],jr.prototype,"dataPoints",void 0),u([$o({traitType:Br,observesTrait:!0,initTrait(t){if(null===this.owner.dataSet.trait){const e=t.getTrait(Sr);null!==e&&this.owner.dataSet.setTrait(e)}if(null!==this.view){const e=t.stroke.value;null!==e&&this.owner.setPlotStroke(e);const i=t.strokeWidth.value;null!==i&&this.owner.setPlotStrokeWidth(i)}},willAttachTrait(t){this.owner.callObservers("controllerWillAttachPlotTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachPlotTrait",t,this.owner)},traitDidSetPlotStroke(t,e){this.owner.setPlotStroke(t)},traitDidSetPlotStrokeWidth(t,e){this.owner.setPlotStrokeWidth(t)},viewType:Fr,observesView:!0,initView(t){const e=this.owner.dataPoints.controllers;for(const i in e){e[i].dataPoint.insertView(t)}const i=this.trait;if(null!==i){const t=i.stroke.value;null!==t&&this.owner.setPlotStroke(t);const e=i.strokeWidth.value;null!==e&&this.owner.setPlotStrokeWidth(e)}},willAttachView(t){this.owner.callObservers("controllerWillAttachPlotView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachPlotView",t,this.owner)},viewWillSetPlotStroke(t,e,i){this.owner.callObservers("controllerWillSetPlotStroke",t,e,this.owner)},viewDidSetPlotStroke(t,e,i){this.owner.callObservers("controllerDidSetPlotStroke",t,e,this.owner)},viewWillSetPlotStrokeWidth(t,e,i){this.owner.callObservers("controllerWillSetPlotStrokeWidth",t,e,this.owner)},viewDidSetPlotStrokeWidth(t,e,i){this.owner.callObservers("controllerDidSetPlotStrokeWidth",t,e,this.owner)}})],jr.prototype,"plot",void 0);class Yr extends Gr{setPlotFill(t,n){const o=this.plot.view;null!==o&&(void 0===n||!0===n?!0===(n=this.plotTiming.value)&&(n=o.getLook(St.timing,Ot.ambient)):n=e.Timing.fromAny(n),t instanceof St?o.fill.setLook(t,n,i.Affinity.Intrinsic):o.fill.setState(t,n,i.Affinity.Intrinsic))}willSetPlotFill(t,e,i){const n=this.observers;for(let i=0,o=n.length;i<o;i+=1){const o=n[i];void 0!==o.controllerWillSetPlotFill&&o.controllerWillSetPlotFill(t,e,this)}}onSetPlotFill(t,e,i){}didSetPlotFill(t,e,i){const n=this.observers;for(let i=0,o=n.length;i<o;i+=1){const o=n[i];void 0!==o.controllerDidSetPlotFill&&o.controllerDidSetPlotFill(t,e,this)}}}u([ns({extends:!0,get parentView(){return this.owner.plot.view}})],Yr.prototype,"dataPoints",void 0),u([$o({traitType:Ur,observesTrait:!0,initTrait(t){if(null===this.owner.dataSet.trait){const e=t.getTrait(Sr);null!==e&&this.owner.dataSet.setTrait(e)}if(null!==this.view){const e=t.fill.value;null!==e&&this.owner.setPlotFill(e)}},willAttachTrait(t){this.owner.callObservers("controllerWillAttachPlotTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachPlotTrait",t,this.owner)},traitDidSetPlotFill(t,e){this.owner.setPlotFill(t)},viewType:Rr,observesView:!0,initView(t){const e=this.owner.dataPoints.controllers;for(const i in e){e[i].dataPoint.insertView(t)}const i=this.trait;if(null!==i){const t=i.fill.value;null!==t&&this.owner.setPlotFill(t)}},willAttachView(t){this.owner.callObservers("controllerWillAttachPlotView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachPlotView",t,this.owner)},viewWillSetPlotFill(t,e,i){this.owner.willSetPlotFill(t,e,i)},viewDidSetPlotFill(t,e,i){this.owner.onSetPlotFill(t,e,i),this.owner.didSetPlotFill(t,e,i)}})],Yr.prototype,"plot",void 0);class Xr extends Ir{addPlot(t,e){t=pn.fromAny(t),this.appendChild(t)}willRender(t){super.willRender(t);const e=t.renderer;if(e instanceof ho){const t=e.context;t.save(),this.clipGraph(t,this.viewFrame)}}didRender(t){const e=t.renderer;if(e instanceof ho){e.context.restore()}super.didRender(t)}clipGraph(t,e){t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.clip()}hitTest(t,e,i){return this}init(t){super.init(t);const e=t.plots;if(void 0!==e)for(let t=0,i=e.length;t<i;t+=1)this.addPlot(e[t]);void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor)}}u([zt({type:O,inherits:!0,value:null})],Xr.prototype,"font",void 0),u([zt({type:B,inherits:!0,value:null})],Xr.prototype,"textColor",void 0);class Kr extends S{startConsumingPlots(){const t=this.plots.traits;for(const e in t){t[e].consume(this)}}stopConsumingPlots(){const t=this.plots.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingPlots()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingPlots()}}u([T({type:Or,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachPlot",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachPlot",t,this.owner)},detectModel:t=>t.getTrait(Or)})],Kr.prototype,"plots",void 0);class Zr extends Zo{}u([$o({traitType:Kr,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachGraphTrait",t,this.owner)},didAttachTrait(t){const e=t.plots.traits;for(const t in e){const i=e[t];this.owner.plots.addTraitController(i)}},willDetachTrait(t){const e=t.plots.traits;for(const t in e){const i=e[t];this.owner.plots.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachGraphTrait",t,this.owner)},traitWillAttachPlot(t,e){this.owner.plots.addTraitController(t,e)},traitDidDetachPlot(t){this.owner.plots.deleteTraitController(t)},viewType:Xr,initView(t){const e=this.owner.plots.controllers;for(const i in e){const n=e[i],o=n.plot.view;null!==o&&null===o.parent&&n.plot.insertView(t)}},willAttachView(t){this.owner.callObservers("controllerWillAttachGraphView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachGraphView",t,this.owner)}})],Zr.prototype,"graph",void 0),u([ns({implements:!0,type:zr,binds:!0,observes:!0,get parentView(){return this.owner.graph.view},getTraitViewRef:t=>t.plot,willAttachController(t){this.owner.callObservers("controllerWillAttachPlot",t,this.owner)},didAttachController(t){const e=t.plot.trait;null!==e&&this.attachPlotTrait(e,t);const i=t.plot.view;null!==i&&this.attachPlotView(i,t);const n=t.dataSet.trait;null!==n&&this.attachDataSetTrait(n,t)},willDetachController(t){const e=t.dataSet.trait;null!==e&&this.detachDataSetTrait(e,t);const i=t.plot.view;null!==i&&this.detachPlotView(i,t);const n=t.plot.trait;null!==n&&this.detachPlotTrait(n,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachPlot",t,this.owner)},controllerWillAttachPlotTrait(t,e){this.owner.callObservers("controllerWillAttachPlotTrait",t,e,this.owner),this.attachPlotTrait(t,e)},controllerDidDetachPlotTrait(t,e){this.detachPlotTrait(t,e),this.owner.callObservers("controllerDidDetachPlotTrait",t,e,this.owner)},attachPlotTrait(t,e){},detachPlotTrait(t,e){},controllerWillAttachPlotView(t,e){this.owner.callObservers("controllerWillAttachPlotView",t,e,this.owner),this.attachPlotView(t,e)},controllerDidDetachPlotView(t,e){this.detachPlotView(t,e),this.owner.callObservers("controllerDidDetachPlotView",t,e,this.owner)},attachPlotView(t,e){},detachPlotView(t,e){t.remove()},controllerWillAttachDataSetTrait(t,e){this.owner.callObservers("controllerWillAttachDataSetTrait",t,e,this.owner),this.attachDataSetTrait(t,e)},controllerDidDetachDataSetTrait(t,e){this.detachDataSetTrait(t,e),this.owner.callObservers("controllerDidDetachDataSetTrait",t,e,this.owner)},attachDataSetTrait(t,e){},detachDataSetTrait(t,e){},controllerWillAttachDataPoint(t,e){this.owner.callObservers("controllerWillAttachDataPoint",t,e,this.owner),this.attachDataPoint(t,e)},controllerDidDetachDataPoint(t,e){this.detachDataPoint(t,e),this.owner.callObservers("controllerDidDetachDataPoint",t,e,this.owner)},attachDataPoint(t,e){const i=t.dataPoint.trait;null!==i&&this.attachDataPointTrait(i,t,e);const n=t.dataPoint.view;null!==n&&this.attachDataPointView(n,t,e)},detachDataPoint(t,e){const i=t.dataPoint.trait;null!==i&&this.detachDataPointTrait(i,t,e);const n=t.dataPoint.view;null!==n&&this.detachDataPointView(n,t,e)},controllerWillAttachDataPointTrait(t,e,i){this.owner.callObservers("controllerWillAttachDataPointTrait",t,e,i,this.owner),this.attachDataPointTrait(t,e,i)},controllerDidDetachDataPointTrait(t,e,i){this.detachDataPointTrait(t,e,i),this.owner.callObservers("controllerDidDetachDataPointTrait",t,e,i,this.owner)},attachDataPointTrait(t,e,i){},detachDataPointTrait(t,e,i){},controllerWillAttachDataPointView(t,e,i){this.owner.callObservers("controllerWillAttachDataPointView",t,e,i,this.owner),this.attachDataPointView(t,e,i)},controllerDidDetachDataPointView(t,e,i){this.detachDataPointView(t,e,i),this.owner.callObservers("controllerDidDetachDataPointView",t,e,i,this.owner)},attachDataPointView(t,e,i){const n=t.label.view;null!==n&&this.attachDataPointLabelView(n,e,i)},detachDataPointView(t,e,i){const n=t.label.view;null!==n&&this.detachDataPointLabelView(n,e,i)},controllerWillAttachDataPointLabelView(t,e,i){this.owner.callObservers("controllerWillAttachDataPointLabelView",t,e,i,this.owner),this.attachDataPointLabelView(t,e,i)},controllerDidDetachDataPointLabelView(t,e,i){this.detachDataPointLabelView(t,e,i),this.owner.callObservers("controllerDidDetachDataPointLabelView",t,e,i,this.owner)},attachDataPointLabelView(t,e,i){},detachDataPointLabelView(t,e,i){},createController(t){return void 0!==t?zr.fromTrait(t):ns.prototype.createController.call(this)}})],Zr.prototype,"plots",void 0);const _r=Math.sqrt(50),Qr=Math.sqrt(10),Jr=Math.sqrt(2),$r=1e3,tl=6e4,el=36e5,il=24*el,nl=30*il,ol=365*il,sl=(new c.BTree).set($r,l.TimeInterval.second).set(5e3,l.TimeInterval.second.every(5)).set(15e3,l.TimeInterval.second.every(15)).set(3e4,l.TimeInterval.second.every(30)).set(tl,l.TimeInterval.minute).set(3e5,l.TimeInterval.minute.every(5)).set(9e5,l.TimeInterval.minute.every(15)).set(18e5,l.TimeInterval.minute.every(30)).set(el,l.TimeInterval.hour).set(3*el,l.TimeInterval.hour.every(3)).set(6*el,l.TimeInterval.hour.every(6)).set(12*el,l.TimeInterval.hour.every(12)).set(il,l.TimeInterval.day).set(2*il,l.TimeInterval.day.every(2)).set(6048e5,l.TimeInterval.week).set(nl,l.TimeInterval.month).set(3*nl,l.TimeInterval.month.every(3)).set(ol,l.TimeInterval.year),rl=l.DateTimeFormat.pattern(".%L"),ll=l.DateTimeFormat.pattern(":%S"),al=l.DateTimeFormat.pattern("%I:%M"),hl=l.DateTimeFormat.pattern("%I %p"),cl=l.DateTimeFormat.pattern("%a %d"),dl=l.DateTimeFormat.pattern("%b %d"),ul=l.DateTimeFormat.pattern("%B"),pl=l.DateTimeFormat.pattern("%Y");class fl{format(t){return""+t}static fromScale(t,i){if(void 0===i&&(i=10),t instanceof l.TimeScale){const e=t.domain;return new vl(e[0],e[1],i)}if(t instanceof e.LinearScale){const e=t.domain;return new gl(e[0],e[1],i)}throw new TypeError(""+t)}static step(t,e){const i=Math.abs(t)/e;let n=Math.pow(10,Math.floor(Math.log(i)/Math.LN10));const o=i/n;return o>=_r?n*=10:o>=Qr?n*=5:o>=Jr&&(n*=2),t<0?-n:n}}class gl extends fl{constructor(t,e,i){super(),this.x0=t,this.dx=e-this.x0,this.n=Math.max(0,i)}count(t){return void 0===t?this.n:(this.n=Math.max(0,t),this)}domain(t,i){return void 0===t?e.LinearDomain(this.x0,this.x0+this.dx):void 0===i?(this.x0=t[0],this.dx=t[1]-this.x0,this):(this.x0=t,this.dx=i-this.x0,this)}generate(){let t,e;this.dx<0?(e=this.x0,t=e+this.dx):(t=this.x0,e=t+this.dx);const i=gl.interval(e-t,this.n);if(0===i||!isFinite(i))return[];let n;if(i>0){t=Math.ceil(t/i),e=Math.floor(e/i);const o=Math.ceil(e-t+1);n=new Array(o);for(let e=0;e<o;e+=1)n[e]=(t+e)*i}else{t=Math.floor(t*i),e=Math.ceil(e*i);const o=Math.ceil(t-e+1);n=new Array(o);for(let e=0;e<o;e+=1)n[e]=(t-e)/i}return this.dx<0&&n.reverse(),n}static interval(t,e=10){const i=t/e,n=Math.floor(Math.log(i)/Math.LN10),o=Math.pow(10,n),s=i/o,r=s>=_r?10:s>=Qr?5:s>=Jr?2:1;return n>=0?o*r:-Math.pow(10,-n)/r}}class vl extends fl{constructor(t,e,i,n){super();const o=l.DateTime.fromAny(t),s=l.DateTime.fromAny(e);this.t0=o.time,this.dt=s.time-this.t0,this.zone=void 0!==n?n:o.zone,this.n=Math.max(0,i)}count(t){return void 0===t?this.n:(this.n=Math.max(0,t),this)}domain(t,e){return void 0===t?l.TimeDomain(new l.DateTime(this.t0,this.zone),new l.DateTime(this.t0+this.dt,this.zone)):(void 0===e?(e=t[1],t=t[0]):t=t,t=l.DateTime.fromAny(t),e=l.DateTime.fromAny(e),this.t0=t.time,this.dt=e.time-this.t0,this)}generate(t){let e,i;this.dt<0?(i=this.t0,e=i+this.dt):(e=this.t0,i=e+this.dt),void 0===t&&(t=this.n);const n=(t=vl.interval(i-e,t)).range(new l.DateTime(e,this.zone),new l.DateTime(i+1,this.zone));return this.dt<0&&n.reverse(),n}format(t){return l.TimeInterval.second.floor(t)<t?rl.format(t):l.TimeInterval.minute.floor(t)<t?ll.format(t):l.TimeInterval.hour.floor(t)<t?al.format(t):l.TimeInterval.day.floor(t)<t?hl.format(t):l.TimeInterval.month.floor(t)<t?l.TimeInterval.week.floor(t)<t?cl.format(t):dl.format(t):l.TimeInterval.year.floor(t)<t?ul.format(t):pl.format(t)}static interval(t,e=10){if("number"==typeof e){const i=Math.abs(t)/e,n=sl.nextKey(i);if(void 0===n){const i=fl.step(t/ol,e);e=l.TimeInterval.year.every(i)}else if(n>$r)e=i/sl.previousKey(i)<n/i?sl.previousValue(i):sl.nextValue(i);else{const i=Math.max(1,fl.step(t,e));e=l.TimeInterval.millisecond.every(i)}}return e}}var wl;t.TickState=void 0,(wl=t.TickState||(t.TickState={}))[wl.Excluded=0]="Excluded",wl[wl.Entering=1]="Entering",wl[wl.Included=2]="Included",wl[wl.Leaving=3]="Leaving";class yl extends io{constructor(t){super(),this.value=t,this.offset=0,this.tickState=0,this.preserved=!0}setOffset(t){this.offset=t}preserve(t){return void 0===t?this.preserved:(this.preserved=t,this)}fadeIn(t){0!==this.tickState&&3!==this.tickState||(this.opacity.setState(1,t),this.tickState=1)}fadeOut(t){1!==this.tickState&&2!==this.tickState||(this.opacity.setState(0,t),this.tickState=3)}onLayout(t){super.onLayout(t);const e=this.label.view;null!==e&&this.layoutLabel(e)}willRender(t){super.willRender(t);const e=t.renderer;if(e instanceof ho){const t=e.context;yl.globalAlpha=t.globalAlpha,t.globalAlpha=this.opacity.getValue()}}onRender(t){const e=t.renderer;e instanceof ro&&!this.hidden&&!this.culled&&this.renderTick(e.context,this.viewFrame)}didRender(t){const e=t.renderer;if(e instanceof ho){e.context.globalAlpha=yl.globalAlpha,yl.globalAlpha=NaN}super.didRender(t)}init(t){super.init(t),void 0!==t.tickMarkColor&&this.tickMarkColor(t.tickMarkColor),void 0!==t.tickMarkWidth&&this.tickMarkWidth(t.tickMarkWidth),void 0!==t.tickMarkLength&&this.tickMarkLength(t.tickMarkLength),void 0!==t.tickLabelPadding&&this.tickLabelPadding(t.tickLabelPadding),void 0!==t.gridLineColor&&this.gridLineColor(t.gridLineColor),void 0!==t.gridLineWidth&&this.gridLineWidth(t.gridLineWidth),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor),void 0!==t.label&&this.label(t.label)}static top(t){return new ml(t)}static right(t){return new bl(t)}static bottom(t){return new Cl(t)}static left(t){return new Sl(t)}static from(t,e){if("top"===e)return this.top(t);if("right"===e)return this.right(t);if("bottom"===e)return this.bottom(t);if("left"===e)return this.left(t);throw new TypeError(e)}static fromInit(t,e){if(void 0!==t.orientation&&(e=t.orientation),void 0===e)throw new TypeError;const i=this.from(t.value,e);return i.init(t),i}static fromAny(t,e){if(null==t)return t;if(t instanceof pn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return this.fromInit(t,e)}}yl.globalAlpha=NaN,u([i.Animator({type:o.R2Point,value:o.R2Point.origin(),updateFlags:pn.NeedsRender})],yl.prototype,"anchor",void 0),u([zt({type:Number,value:1,updateFlags:pn.NeedsRender})],yl.prototype,"opacity",void 0),u([zt({type:B,inherits:!0,value:null,updateFlags:pn.NeedsRender})],yl.prototype,"tickMarkColor",void 0),u([zt({type:Number,inherits:!0,value:1,updateFlags:pn.NeedsRender})],yl.prototype,"tickMarkWidth",void 0),u([zt({type:Number,inherits:!0,value:6,updateFlags:pn.NeedsRender})],yl.prototype,"tickMarkLength",void 0),u([zt({type:Number,inherits:!0,value:2,updateFlags:pn.NeedsRender})],yl.prototype,"tickLabelPadding",void 0),u([zt({type:B,inherits:!0,value:null,updateFlags:pn.NeedsRender})],yl.prototype,"gridLineColor",void 0),u([zt({type:Number,inherits:!0,value:0,updateFlags:pn.NeedsRender})],yl.prototype,"gridLineWidth",void 0),u([zt({type:O,inherits:!0,value:null})],yl.prototype,"font",void 0),u([zt({type:B,inherits:!0,value:null})],yl.prototype,"textColor",void 0),u([gn({key:!0,type:So,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachTickLabel",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachTickLabel",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof So?(this.view.text(t),this.view):So.fromAny(t):io.fromAny(t)}})],yl.prototype,"label",void 0);class ml extends yl{constructor(t){super(t)}get orientation(){return"top"}layoutLabel(t){const e=this.anchor.getValue(),n=Math.round(e.x),s=Math.round(e.y)-this.tickMarkLength.getValue()-this.tickLabelPadding.getValue();bo.is(t)&&(t.textAlign.setState("center",i.Affinity.Intrinsic),t.textBaseline.setState("bottom",i.Affinity.Intrinsic),t.textOrigin.setState(new o.R2Point(n,s),i.Affinity.Intrinsic))}renderTick(t,e){const i=this.anchor.getValue(),n=Math.round(i.x),o=Math.round(i.y),s=this.tickMarkLength.getValue(),r=o-s,l=t.lineWidth,a=t.strokeStyle,h=this.tickMarkColor.value,c=this.tickMarkWidth.getValue();null!==h&&0!==c&&0!==s&&(t.beginPath(),t.lineWidth=c,t.strokeStyle=h.toString(),t.moveTo(n,o),t.lineTo(n,r),t.stroke());const d=this.gridLineColor.value,u=this.gridLineWidth.getValue();null!==d&&0!==u&&e.xMin<n&&n<e.xMax&&(t.beginPath(),t.lineWidth=u,t.strokeStyle=d.toString(),t.moveTo(n,o),t.lineTo(n,e.yMax),t.stroke()),t.lineWidth=l,t.strokeStyle=a}}class bl extends yl{constructor(t){super(t)}get orientation(){return"right"}layoutLabel(t){const e=this.anchor.getValue(),n=Math.round(e.x),s=Math.round(e.y),r=n+this.tickMarkLength.getValue()+this.tickLabelPadding.getValue();bo.is(t)&&(t.textAlign.setState("left",i.Affinity.Intrinsic),t.textBaseline.setState("middle",i.Affinity.Intrinsic),t.textOrigin.setState(new o.R2Point(r,s),i.Affinity.Intrinsic))}renderTick(t,e){const i=this.anchor.getValue(),n=Math.round(i.x),o=Math.round(i.y),s=this.tickMarkLength.getValue(),r=n+s,l=t.lineWidth,a=t.strokeStyle,h=this.tickMarkColor.value,c=this.tickMarkWidth.getValue();null!==h&&0!==c&&0!==s&&(t.beginPath(),t.lineWidth=c,t.strokeStyle=h.toString(),t.moveTo(n,o),t.lineTo(r,o),t.stroke());const d=this.gridLineColor.value,u=this.gridLineWidth.getValue();null!==d&&0!==u&&e.yMin<o&&o<e.yMax&&(t.beginPath(),t.lineWidth=u,t.strokeStyle=d.toString(),t.moveTo(n,o),t.lineTo(e.xMin,o),t.stroke()),t.lineWidth=l,t.strokeStyle=a}}class Cl extends yl{constructor(t){super(t)}get orientation(){return"bottom"}layoutLabel(t){const e=this.anchor.getValue(),n=Math.round(e.x),s=Math.round(e.y)+this.tickMarkLength.getValue()+this.tickLabelPadding.getValue();bo.is(t)&&(t.textAlign.setState("center",i.Affinity.Intrinsic),t.textBaseline.setState("top",i.Affinity.Intrinsic),t.textOrigin.setState(new o.R2Point(n,s),i.Affinity.Intrinsic))}renderTick(t,e){const i=this.anchor.getValue(),n=Math.round(i.x),o=Math.round(i.y),s=this.tickMarkLength.getValue(),r=o+s,l=t.lineWidth,a=t.strokeStyle,h=this.tickMarkColor.value,c=this.tickMarkWidth.getValue();null!==h&&0!==c&&0!==s&&(t.beginPath(),t.lineWidth=c,t.strokeStyle=h.toString(),t.moveTo(n,o),t.lineTo(n,r),t.stroke());const d=this.gridLineColor.value,u=this.gridLineWidth.getValue();null!==d&&0!==u&&e.xMin<n&&n<e.xMax&&(t.beginPath(),t.lineWidth=u,t.strokeStyle=d.toString(),t.moveTo(n,o),t.lineTo(n,e.yMin),t.stroke()),t.lineWidth=l,t.strokeStyle=a}}class Sl extends yl{constructor(t){super(t)}get orientation(){return"left"}layoutLabel(t){const e=this.anchor.getValue(),n=Math.round(e.x),s=Math.round(e.y),r=n-this.tickMarkLength.getValue()-this.tickLabelPadding.getValue();bo.is(t)&&(t.textAlign.setState("right",i.Affinity.Intrinsic),t.textBaseline.setState("middle",i.Affinity.Intrinsic),t.textOrigin.setState(new o.R2Point(r,s),i.Affinity.Intrinsic))}renderTick(t,e){const i=this.anchor.getValue(),n=Math.round(i.x),o=Math.round(i.y),s=this.tickMarkLength.getValue(),r=n-s,l=t.lineWidth,a=t.strokeStyle,h=this.tickMarkColor.value,c=this.tickMarkWidth.getValue();null!==h&&0!==c&&0!==s&&(t.beginPath(),t.strokeStyle=h.toString(),t.lineWidth=c,t.moveTo(n,o),t.lineTo(r,o),t.stroke());const d=this.gridLineColor.value,u=this.gridLineWidth.getValue();null!==d&&0!==u&&e.yMin<o&&o<e.yMax&&(t.beginPath(),t.lineWidth=u,t.strokeStyle=d.toString(),t.moveTo(n,o),t.lineTo(e.xMax,o),t.stroke()),t.lineWidth=l,t.strokeStyle=a}}class Al extends io{constructor(){super(),this.ticks=new c.BTree}getTick(t){const e=this.ticks.get(t);return void 0!==e?e:null}insertTick(t){return this.insertChild(yl.fromAny(t,this.orientation),null)}removeTick(t){const e=this.getTick(t);return null!==e&&e.remove(),e}updateTicks(){const t=this.scale.value;let e=this.tickGenerator.value;if(null!==t&&null!==e){let i=this.tickTransition.value;!0===e&&(e=fl.fromScale(t),this.tickGenerator.setValue(e),i=!1),this.generateTicks(e,t,i)}}generateTicks(t,e,i){const n=this.tickMarkSpacing.getValue();if(0!==n){const i=e.range,o=Math.abs(i[1]-i[0]),s=Math.max(1,Math.floor(o/n));t.count(s)}t.domain(e.domain);const o=this.ticks.clone(),s=t.generate();for(let t=0,e=s.length;t<e;t+=1){const e=s[t],n=o.get(e);if(void 0!==n)o.delete(e),n.fadeIn(i);else{const t=this.createTickView(e);null!==t&&(this.appendChild(t),t.opacity.setInterpolatedValue(0,0),t.fadeIn(i))}}o.forEachValue((function(t){t.preserved||t.fadeOut(i)}),this)}createTickView(t){const e=yl.from(t,this.orientation);if(null!==e){const i=this.createTickLabel(t,e);null!==i&&(e.label(i),e.preserve(!1))}return e}createTickLabel(t,e){let i=null;const n=this.observers;for(let o=0,s=n.length;o<s&&null==i;o+=1){const s=n[o];void 0!==s.createTickLabel&&(i=s.createTickLabel(t,e,this))}if(null==i){const e=this.tickGenerator.value;i=e instanceof fl?e.format(t):""+t}return"string"==typeof i&&(i=this.formatTickLabel(i,e)),i}formatTickLabel(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];if(void 0!==o.formatTickLabel){const i=o.formatTickLabel(t,e,this);if(void 0!==i)return i}}return t}onInsertChild(t,e){super.onInsertChild(t,e),t instanceof yl&&this.ticks.get(t.value)!==t&&this.ticks.set(t.value,t)}onRemoveChild(t){super.onRemoveChild(t),t instanceof yl&&this.ticks.get(t.value)===t&&this.ticks.delete(t.value)}needsDisplay(t,e){return 0==(this.flags&pn.NeedsLayout)&&(t&=~pn.NeedsLayout),t}onLayout(t){super.onLayout(t),this.scale.recohere(t.updateTime),this.updateTicks()}displayChild(t,e,i){if(0!=(e&pn.NeedsLayout)&&t instanceof yl){const e=this.scale.value;null!==e&&this.layoutTick(t,this.origin.getValue(),this.viewFrame,e)}super.displayChild(t,e,i)}didRender(t){const e=t.renderer;e instanceof ro&&this.renderDomain(e.context,this.origin.getValue(),this.viewFrame),super.didRender(t)}init(t){super.init(t),void 0!==t.scale&&this.scale(t.scale);const e=t.ticks;if(void 0!==e)for(let t=0,i=e.length;t<i;t+=1)this.appendChild(yl.fromAny(e[t]));void 0!==t.tickGenerator&&this.tickGenerator(t.tickGenerator),void 0!==t.borderColor&&this.borderColor(t.borderColor),void 0!==t.borderWidth&&this.borderWidth(t.borderWidth),void 0!==t.borderSerif&&this.borderSerif(t.borderSerif),void 0!==t.tickMarkSpacing&&this.tickMarkSpacing(t.tickMarkSpacing),void 0!==t.tickMarkColor&&this.tickMarkColor(t.tickMarkColor),void 0!==t.tickMarkWidth&&this.tickMarkWidth(t.tickMarkWidth),void 0!==t.tickMarkLength&&this.tickMarkLength(t.tickMarkLength),void 0!==t.tickLabelPadding&&this.tickLabelPadding(t.tickLabelPadding),void 0!==t.tickTransition&&this.tickTransition(t.tickTransition),void 0!==t.gridLineColor&&this.gridLineColor(t.gridLineColor),void 0!==t.gridLineWidth&&this.gridLineWidth(t.gridLineWidth),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor)}}u([i.Property({type:fl,value:!0})],Al.prototype,"tickGenerator",void 0),u([zt({type:o.R2Point,value:o.R2Point.origin(),updateFlags:pn.NeedsLayout|pn.NeedsRender})],Al.prototype,"origin",void 0),u([zt({type:B,inherits:!0,value:null,updateFlags:pn.NeedsRender})],Al.prototype,"borderColor",void 0),u([zt({type:Number,inherits:!0,value:1,updateFlags:pn.NeedsRender})],Al.prototype,"borderWidth",void 0),u([zt({type:Number,inherits:!0,value:6,updateFlags:pn.NeedsRender})],Al.prototype,"borderSerif",void 0),u([zt({type:Number,value:80,updateFlags:pn.NeedsRender})],Al.prototype,"tickMarkSpacing",void 0),u([zt({type:B,inherits:!0,value:null,updateFlags:pn.NeedsRender})],Al.prototype,"tickMarkColor",void 0),u([zt({type:Number,inherits:!0,value:1,updateFlags:pn.NeedsRender})],Al.prototype,"tickMarkWidth",void 0),u([zt({type:Number,inherits:!0,value:6,updateFlags:pn.NeedsRender})],Al.prototype,"tickMarkLength",void 0),u([zt({type:Number,inherits:!0,value:2,updateFlags:pn.NeedsRender})],Al.prototype,"tickLabelPadding",void 0),u([i.Property({type:e.Timing,inherits:!0,initValue:()=>e.Easing.cubicOut.withDuration(250)})],Al.prototype,"tickTransition",void 0),u([zt({type:B,inherits:!0,value:null,updateFlags:pn.NeedsRender})],Al.prototype,"gridLineColor",void 0),u([zt({type:Number,inherits:!0,value:0,updateFlags:pn.NeedsRender})],Al.prototype,"gridLineWidth",void 0),u([zt({type:O,inherits:!0,value:null,updateFlags:pn.NeedsRender})],Al.prototype,"font",void 0),u([zt({type:B,inherits:!0,value:null,updateFlags:pn.NeedsRender})],Al.prototype,"textColor",void 0);class xl extends Al{get orientation(){return"top"}layoutTick(t,e,n,s){if(t.anchor.hasAffinity(i.Affinity.Intrinsic)){const r=s(t.value);t.setOffset(r),t.anchor.setState(new o.R2Point(n.xMin+r,e.y),i.Affinity.Intrinsic)}}renderDomain(t,e,i){const n=this.borderColor.value,o=this.borderWidth.getValue();if(null!==n&&0!==o){const s=i.xMin,r=i.xMax,l=e.y,a=this.borderSerif.getValue(),h=t.lineWidth,c=t.strokeStyle;t.beginPath(),t.lineWidth=o,t.strokeStyle=n.toString(),0!==a?(t.moveTo(s,l-a),t.lineTo(s,l),t.lineTo(r,l),t.lineTo(r,l-a)):(t.moveTo(s,l),t.lineTo(r,l)),t.stroke(),t.lineWidth=h,t.strokeStyle=c}}}u([i.Animator({extends:Tr,type:e.ContinuousScale,inherits:"xScale",value:null,updateFlags:pn.NeedsLayout})],xl.prototype,"scale",void 0);class Tl extends Al{get orientation(){return"right"}layoutTick(t,e,n,s){if(t.anchor.hasAffinity(i.Affinity.Intrinsic)){const r=s(t.value);t.setOffset(r),t.anchor.setState(new o.R2Point(e.x,n.yMin+r),i.Affinity.Intrinsic)}}renderDomain(t,e,i){const n=this.borderColor.value,o=this.borderWidth.getValue();if(null!==n&&0!==o){const s=e.x,r=this.borderSerif.getValue(),l=i.yMin,a=i.yMax,h=t.lineWidth,c=t.strokeStyle;t.beginPath(),t.lineWidth=o,t.strokeStyle=n.toString(),0!==r?(t.moveTo(s+r,l),t.lineTo(s,l),t.lineTo(s,a),t.lineTo(s+r,a)):(t.moveTo(s,l),t.lineTo(s,a)),t.stroke(),t.lineWidth=h,t.strokeStyle=c}}}u([i.Animator({extends:Tr,type:e.ContinuousScale,inherits:"yScale",value:null,updateFlags:pn.NeedsLayout})],Tl.prototype,"scale",void 0);class Dl extends Al{get orientation(){return"bottom"}layoutTick(t,e,n,s){if(t.anchor.hasAffinity(i.Affinity.Intrinsic)){const r=s(t.value);t.setOffset(r),t.anchor.setState(new o.R2Point(n.xMin+r,e.y),i.Affinity.Intrinsic)}}renderDomain(t,e,i){const n=this.borderColor.value,o=this.borderWidth.getValue();if(null!==n&&0!==o){const s=i.xMin,r=i.xMax,l=e.y,a=this.borderSerif.getValue(),h=t.lineWidth,c=t.strokeStyle;t.beginPath(),t.lineWidth=o,t.strokeStyle=n.toString(),0!==a?(t.moveTo(s,l+a),t.lineTo(s,l),t.lineTo(r,l),t.lineTo(r,l+a)):(t.moveTo(s,l),t.lineTo(r,l)),t.stroke(),t.lineWidth=h,t.strokeStyle=c}}}u([i.Animator({extends:Tr,type:e.ContinuousScale,inherits:"xScale",value:null,updateFlags:pn.NeedsLayout})],Dl.prototype,"scale",void 0);class Vl extends Al{get orientation(){return"left"}layoutTick(t,e,n,s){if(t.anchor.hasAffinity(i.Affinity.Intrinsic)){const r=s(t.value);t.setOffset(r),t.anchor.setState(new o.R2Point(e.x,n.yMin+r),i.Affinity.Intrinsic)}}renderDomain(t,e,i){const n=this.borderColor.value,o=this.borderWidth.getValue();if(null!==n&&0!==o){const s=e.x,r=this.borderSerif.getValue(),l=i.yMin,a=i.yMax,h=t.lineWidth,c=t.strokeStyle;t.beginPath(),t.lineWidth=o,t.strokeStyle=n.toString(),0!==r?(t.moveTo(s-r,l),t.lineTo(s,l),t.lineTo(s,a),t.lineTo(s-r,a)):(t.moveTo(s,l),t.lineTo(s,a)),t.stroke(),t.lineWidth=h,t.strokeStyle=c}}}u([i.Animator({extends:Tr,type:e.ContinuousScale,inherits:"yScale",value:null,updateFlags:pn.NeedsLayout})],Vl.prototype,"scale",void 0);class Pl extends S{}class Il extends Pl{}class Ml extends Pl{}class Ll extends Pl{}class kl extends Pl{}class Fl extends Zo{}u([$o({traitType:Pl,willAttachTrait(t){this.owner.callObservers("controllerWillAttachAxisTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachAxisTrait",t,this.owner)},viewType:Al,willAttachView(t){this.owner.callObservers("controllerWillAttachAxisView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachAxisView",t,this.owner)}})],Fl.prototype,"axis",void 0);class Rl extends Fl{}u([$o({extends:!0,traitType:Il,viewType:xl})],Rl.prototype,"axis",void 0);class Ol extends Fl{}u([$o({extends:!0,traitType:Ml,viewType:Tl})],Ol.prototype,"axis",void 0);class Wl extends Fl{}u([$o({extends:!0,traitType:Ll,viewType:Dl})],Wl.prototype,"axis",void 0);class El extends Fl{}u([$o({extends:!0,traitType:kl,viewType:Vl})],El.prototype,"axis",void 0);class Nl extends Ir{xRange(){const t=this.viewFrame,i=this.gutterLeft.getValue().pxValue(t.width),n=this.gutterRight.getValue().pxValue(t.width),o=this.xRangePadding.value,s=o[0],r=this.viewFrame.width-n-i-o[1];return e.LinearRange(s,r)}yRange(){const t=this.viewFrame,i=this.gutterTop.getValue().pxValue(t.height),n=this.gutterBottom.getValue().pxValue(t.height),o=this.yRangePadding.value,s=o[0],r=this.viewFrame.height-n-i-o[1];return e.LinearRange(r,s)}updateScales(){this.layoutChart(this.viewFrame),super.updateScales()}layoutChart(t){const e=this.gutterTop.getValue().pxValue(t.height),n=this.gutterRight.getValue().pxValue(t.width),s=this.gutterBottom.getValue().pxValue(t.height),r=this.gutterLeft.getValue().pxValue(t.width),l=t.yMin+e,a=t.xMax-n,h=t.yMax-s,c=t.xMin+r,d=this.topAxis.view;null!==d&&(d.setViewFrame(new o.R2Box(c,t.yMin,a,h)),d.origin.setState(new o.R2Point(c,l),i.Affinity.Intrinsic));const u=this.rightAxis.view;null!==u&&(u.setViewFrame(new o.R2Box(c,l,t.xMax,h)),u.origin.setState(new o.R2Point(Math.max(c,a),h),i.Affinity.Intrinsic));const p=this.bottomAxis.view;null!==p&&(p.setViewFrame(new o.R2Box(c,l,a,t.yMax)),p.origin.setState(new o.R2Point(c,Math.max(l,h)),i.Affinity.Intrinsic));const f=this.leftAxis.view;null!==f&&(f.setViewFrame(new o.R2Box(t.xMin,l,a,h)),f.origin.setState(new o.R2Point(c,h),i.Affinity.Intrinsic));const g=this.graph.view;null!==g&&g.setViewFrame(new o.R2Box(c,l,a,h))}init(t){super.init(t),void 0!==t.graph&&this.graph(t.graph),void 0!==t.topAxis&&this.topAxis(t.topAxis),void 0!==t.rightAxis&&this.rightAxis(t.rightAxis),void 0!==t.bottomAxis&&this.bottomAxis(t.bottomAxis),void 0!==t.leftAxis&&this.leftAxis(t.leftAxis),void 0!==t.gutterTop&&this.gutterTop(t.gutterTop),void 0!==t.gutterRight&&this.gutterRight(t.gutterRight),void 0!==t.gutterBottom&&this.gutterBottom(t.gutterBottom),void 0!==t.gutterLeft&&this.gutterLeft(t.gutterLeft),void 0!==t.borderColor&&this.borderColor(t.borderColor),void 0!==t.borderWidth&&this.borderWidth(t.borderWidth),void 0!==t.borderSerif&&this.borderSerif(t.borderSerif),void 0!==t.tickMarkColor&&this.tickMarkColor(t.tickMarkColor),void 0!==t.tickMarkWidth&&this.tickMarkWidth(t.tickMarkWidth),void 0!==t.tickMarkLength&&this.tickMarkLength(t.tickMarkLength),void 0!==t.tickLabelPadding&&this.tickLabelPadding(t.tickLabelPadding),void 0!==t.tickTransition&&this.tickTransition(t.tickTransition),void 0!==t.gridLineColor&&this.gridLineColor(t.gridLineColor),void 0!==t.gridLineWidth&&this.gridLineWidth(t.gridLineWidth),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor)}}u([zt({type:o.Length,value:o.Length.px(20)})],Nl.prototype,"gutterTop",void 0),u([zt({type:o.Length,value:o.Length.px(40)})],Nl.prototype,"gutterRight",void 0),u([zt({type:o.Length,value:o.Length.px(20)})],Nl.prototype,"gutterBottom",void 0),u([zt({type:o.Length,value:o.Length.px(40)})],Nl.prototype,"gutterLeft",void 0),u([zt({type:B,value:null,look:St.neutralColor})],Nl.prototype,"borderColor",void 0),u([zt({type:Number,value:1})],Nl.prototype,"borderWidth",void 0),u([zt({type:Number,value:6})],Nl.prototype,"borderSerif",void 0),u([zt({type:B,value:null,look:St.neutralColor})],Nl.prototype,"tickMarkColor",void 0),u([zt({type:Number,value:1})],Nl.prototype,"tickMarkWidth",void 0),u([zt({type:Number,value:6})],Nl.prototype,"tickMarkLength",void 0),u([zt({type:Number,value:2})],Nl.prototype,"tickLabelPadding",void 0),u([i.Property({type:e.Timing,initValue:()=>e.Easing.cubicOut.withDuration(250)})],Nl.prototype,"tickTransition",void 0),u([zt({type:B,value:null,look:St.subduedColor})],Nl.prototype,"gridLineColor",void 0),u([zt({type:Number,value:0})],Nl.prototype,"gridLineWidth",void 0),u([zt({type:O,value:null,inherits:!0})],Nl.prototype,"font",void 0),u([zt({type:B,value:null,look:St.mutedColor})],Nl.prototype,"textColor",void 0),u([gn({key:!0,type:Xr,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachGraph",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachGraph",t,this.owner)},detectView:t=>t instanceof Xr?t:null})],Nl.prototype,"graph",void 0),u([gn({key:!0,type:xl,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachTopAxis",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachTopAxis",t,this.owner)},detectView:t=>t instanceof xl?t:null})],Nl.prototype,"topAxis",void 0),u([gn({key:!0,type:Tl,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachRightAxis",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachRightAxis",t,this.owner)},detectView:t=>t instanceof Tl?t:null})],Nl.prototype,"rightAxis",void 0),u([gn({key:!0,type:Dl,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachBottomAxis",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachBottomAxis",t,this.owner)},detectView:t=>t instanceof Dl?t:null})],Nl.prototype,"bottomAxis",void 0),u([gn({key:!0,type:Vl,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachLeftAxis",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachLeftAxis",t,this.owner)},detectView:t=>t instanceof Vl?t:null})],Nl.prototype,"leftAxis",void 0);class Bl extends S{onStartConsuming(){super.onStartConsuming();const t=this.graph.trait;null!==t&&t.consume(this);const e=this.topAxis.trait;null!==e&&e.consume(this);const i=this.rightAxis.trait;null!==i&&i.consume(this);const n=this.bottomAxis.trait;null!==n&&n.consume(this);const o=this.leftAxis.trait;null!==o&&o.consume(this)}onStopConsuming(){super.onStopConsuming();const t=this.graph.trait;null!==t&&t.unconsume(this);const e=this.topAxis.trait;null!==e&&e.unconsume(this);const i=this.rightAxis.trait;null!==i&&i.unconsume(this);const n=this.bottomAxis.trait;null!==n&&n.unconsume(this);const o=this.leftAxis.trait;null!==o&&o.unconsume(this)}}u([x({type:Kr,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachGraph",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachGraph",t,this.owner)},detectModel:t=>t.getTrait(Kr),detectTrait:t=>t instanceof Kr?t:null})],Bl.prototype,"graph",void 0),u([x({type:Il,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachTopAxis",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachTopAxis",t,this.owner)},detectModel:t=>t.getTrait(Il),detectTrait:t=>t instanceof Il?t:null})],Bl.prototype,"topAxis",void 0),u([x({type:Ml,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachRightAxis",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachRightAxis",t,this.owner)},detectModel:t=>t.getTrait(Ml),detectTrait:t=>t instanceof Ml?t:null})],Bl.prototype,"rightAxis",void 0),u([x({type:Ll,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachBottomAxis",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachBottomAxis",t,this.owner)},detectModel:t=>t.getTrait(Ll),detectTrait:t=>t instanceof Ll?t:null})],Bl.prototype,"bottomAxis",void 0),u([x({type:kl,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachLeftAxis",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachLeftAxis",t,this.owner)},detectModel:t=>t.getTrait(kl),detectTrait:t=>t instanceof kl?t:null})],Bl.prototype,"leftAxis",void 0);class Ul extends Zr{}u([$o({traitType:Bl,observesTrait:!0,initTrait(t){this.owner.graph.setTrait(t.graph.trait);const e=t.topAxis.trait;null!==e&&this.owner.topAxis.setTrait(e);const i=t.rightAxis.trait;null!==i&&this.owner.rightAxis.setTrait(i);const n=t.bottomAxis.trait;null!==n&&this.owner.bottomAxis.setTrait(n);const o=t.leftAxis.trait;null!==o&&this.owner.leftAxis.setTrait(o)},deinitTrait(t){const e=t.leftAxis.trait;null!==e&&this.owner.leftAxis.deleteTrait(e);const i=t.bottomAxis.trait;null!==i&&this.owner.bottomAxis.deleteTrait(i);const n=t.rightAxis.trait;null!==n&&this.owner.rightAxis.deleteTrait(n);const o=t.topAxis.trait;null!==o&&this.owner.topAxis.deleteTrait(o),this.owner.graph.setTrait(null)},willAttachTrait(t){this.owner.callObservers("controllerWillAttachChartTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachChartTrait",t,this.owner)},traitWillAttachTopAxis(t){this.owner.topAxis.setTrait(t)},traitDidDetachTopAxis(t){this.owner.topAxis.setTrait(null)},traitWillAttachRightAxis(t){this.owner.rightAxis.setTrait(t)},traitDidDetachRightAxis(t){this.owner.rightAxis.setTrait(null)},traitWillAttachBottomAxis(t){this.owner.bottomAxis.setTrait(t)},traitDidDetachBottomAxis(t){this.owner.bottomAxis.setTrait(null)},traitWillAttachLeftAxis(t){this.owner.leftAxis.setTrait(t)},traitDidDetachLeftAxis(t){this.owner.leftAxis.setTrait(null)},viewType:Nl,initView(t){const e=this.owner.topAxis.controller;null!==e&&e.axis.insertView(t);const i=this.owner.rightAxis.controller;null!==i&&i.axis.insertView(t);const n=this.owner.bottomAxis.controller;null!==n&&n.axis.insertView(t);const o=this.owner.leftAxis.controller;null!==o&&o.axis.insertView(t),null===this.owner.graph.view&&null===this.owner.graph.trait||this.owner.graph.insertView(t)},willAttachView(t){this.owner.callObservers("controllerWillAttachChartView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachChartView",t,this.owner)}})],Ul.prototype,"chart",void 0),u([$o({extends:!0,initTrait(t){Zr.graph.prototype.initTrait.call(this,t);const e=this.owner.chart.view;null!==e&&this.insertView(e)},initView(t){Zr.graph.prototype.initView.call(this,t);const e=this.owner.chart.view;null!==e&&this.insertView(e)},deinitView(t){Zr.graph.prototype.deinitView.call(this,t),t.remove()}})],Ul.prototype,"graph",void 0),u([is({implements:!0,type:Rl,binds:!0,observes:!0,get parentView(){return this.owner.chart.view},getTraitViewRef:t=>t.axis,willAttachController(t){this.owner.callObservers("controllerWillAttachTopAxis",t,this.owner)},didAttachController(t){const e=t.axis.trait;null!==e&&this.attachAxisTrait(e);const i=t.axis.view;null!==i&&this.attachAxisView(i)},willDetachController(t){const e=t.axis.view;null!==e&&this.detachAxisView(e);const i=t.axis.trait;null!==i&&this.detachAxisTrait(i)},didDetachController(t){this.owner.callObservers("controllerDidDetachTopAxis",t,this.owner)},controllerWillAttachAxisTrait(t){this.owner.callObservers("controllerWillAttachTopAxisTrait",t,this.owner),this.attachAxisTrait(t)},controllerDidDetachAxisTrait(t){this.detachAxisTrait(t),this.owner.callObservers("controllerDidDetachTopAxisTrait",t,this.owner)},attachAxisTrait(t){},detachAxisTrait(t){},controllerWillAttachAxisView(t){this.owner.callObservers("controllerWillAttachTopAxisView",t,this.owner),this.attachAxisView(t)},controllerDidDetachAxisView(t){this.detachAxisView(t),this.owner.callObservers("controllerDidDetachTopAxisView",t,this.owner)},attachAxisView(t){},detachAxisView(t){t.remove()},detectController:t=>t instanceof Rl?t:null})],Ul.prototype,"topAxis",void 0),u([is({implements:!0,type:Ol,binds:!0,observes:!0,get parentView(){return this.owner.chart.view},getTraitViewRef:t=>t.axis,willAttachController(t){this.owner.callObservers("controllerWillAttachRightAxis",t,this.owner)},didAttachController(t){const e=t.axis.trait;null!==e&&this.attachAxisTrait(e);const i=t.axis.view;null!==i&&this.attachAxisView(i)},willDetachController(t){const e=t.axis.view;null!==e&&this.detachAxisView(e);const i=t.axis.trait;null!==i&&this.detachAxisTrait(i)},didDetachController(t){this.owner.callObservers("controllerDidDetachRightAxis",t,this.owner)},controllerWillAttachAxisTrait(t){this.owner.callObservers("controllerWillAttachRightAxisTrait",t,this.owner),this.attachAxisTrait(t)},controllerDidDetachAxisTrait(t){this.detachAxisTrait(t),this.owner.callObservers("controllerDidDetachRightAxisTrait",t,this.owner)},attachAxisTrait(t){},detachAxisTrait(t){},controllerWillAttachAxisView(t){this.owner.callObservers("controllerWillAttachRightAxisView",t,this.owner),this.attachAxisView(t)},controllerDidDetachAxisView(t){this.detachAxisView(t),this.owner.callObservers("controllerDidDetachRightAxisView",t,this.owner)},attachAxisView(t){},detachAxisView(t){t.remove()},detectController:t=>t instanceof Ol?t:null})],Ul.prototype,"rightAxis",void 0),u([is({implements:!0,type:Wl,binds:!0,observes:!0,get parentView(){return this.owner.chart.view},getTraitViewRef:t=>t.axis,willAttachController(t){this.owner.callObservers("controllerWillAttachBottomAxis",t,this.owner)},didAttachController(t){const e=t.axis.trait;null!==e&&this.attachAxisTrait(e);const i=t.axis.view;null!==i&&this.attachAxisView(i)},willDetachController(t){const e=t.axis.view;null!==e&&this.detachAxisView(e);const i=t.axis.trait;null!==i&&this.detachAxisTrait(i)},didDetachController(t){this.owner.callObservers("controllerDidDetachBottomAxis",t,this.owner)},controllerWillAttachAxisTrait(t){this.owner.callObservers("controllerWillAttachBottomAxisTrait",t,this.owner),this.attachAxisTrait(t)},controllerDidDetachAxisTrait(t){this.detachAxisTrait(t),this.owner.callObservers("controllerDidDetachBottomAxisTrait",t,this.owner)},attachAxisTrait(t){},detachAxisTrait(t){},controllerWillAttachAxisView(t){this.owner.callObservers("controllerWillAttachBottomAxisView",t,this.owner),this.attachAxisView(t)},controllerDidDetachAxisView(t){this.detachAxisView(t),this.owner.callObservers("controllerDidDetachBottomAxisView",t,this.owner)},attachAxisView(t){},detachAxisView(t){t.remove()},detectController:t=>t instanceof Wl?t:null})],Ul.prototype,"bottomAxis",void 0),u([is({implements:!0,type:El,binds:!0,observes:!0,get parentView(){return this.owner.chart.view},getTraitViewRef:t=>t.axis,willAttachController(t){this.owner.callObservers("controllerWillAttachLeftAxis",t,this.owner)},didAttachController(t){const e=t.axis.trait;null!==e&&this.attachAxisTrait(e);const i=t.axis.view;null!==i&&this.attachAxisView(i)},willDetachController(t){const e=t.axis.view;null!==e&&this.detachAxisView(e);const i=t.axis.trait;null!==i&&this.detachAxisTrait(i)},didDetachController(t){this.owner.callObservers("controllerDidDetachLeftAxis",t,this.owner)},controllerWillAttachAxisTrait(t){this.owner.callObservers("controllerWillAttachLeftAxisTrait",t,this.owner),this.attachAxisTrait(t)},controllerDidDetachAxisTrait(t){this.detachAxisTrait(t),this.owner.callObservers("controllerDidDetachLeftAxisTrait",t,this.owner)},attachAxisTrait(t){},detachAxisTrait(t){},controllerWillAttachAxisView(t){this.owner.callObservers("controllerWillAttachLeftAxisView",t,this.owner),this.attachAxisView(t)},controllerDidDetachAxisView(t){this.detachAxisView(t),this.owner.callObservers("controllerDidDetachLeftAxisView",t,this.owner)},attachAxisView(t){},detachAxisView(t){t.remove()},detectController:t=>t instanceof El?t:null})],Ul.prototype,"leftAxis",void 0);const zl=function(){const t={fromAny:function(t){if(null==t)return t;{let e,i;e=void 0!==t.geoFrame&&null!==t.geoFrame?d.GeoBox.fromAny(t.geoFrame):null,i=void 0!==t.geoCenter&&null!==t.geoCenter?d.GeoPoint.fromAny(t.geoCenter):null;return{geoFrame:e,geoCenter:i,zoom:t.zoom,heading:t.heading,tilt:t.tilt}}},is:function(t){if(null!=t||"function"==typeof t){const e=t;return"geoFrame"in e&&"geoCenter"in e&&"zoom"in e&&"heading"in e&&"tilt"in e}return!1}};return t}(),ql=function(){const t={is:function(t){return!(!d.GeoProjection.is(t)||!zl.is(t))}};return t}();class Gl extends io{constructor(){super(),this.geoBounds=d.GeoBox.undefined()}didInsertChild(t,e){t instanceof Gl&&this.onInsertChildGeoBounds(t,t.geoBounds),super.didInsertChild(t,e)}didRemoveChild(t){t instanceof Gl&&this.onRemoveChildGeoBounds(t,t.geoBounds),super.didRemoveChild(t)}onRender(t){super.onRender(t);const e=this.geoBoundsColor.value;null!==e&&this.renderGeoBounds(t,e,1)}renderGeoBounds(t,e,i){const n=t.renderer;n instanceof ro&&!this.hidden&&!this.culled&&!this.unbounded&&this.renderGeoOutline(this.geoBounds,t.geoViewport,n.context,e,i)}renderGeoOutline(t,e,i,n,o){if(t.isDefined()){const s=i.lineWidth,r=i.strokeStyle,l=e.project(t.southWest.normalized()),a=e.project(t.northWest.normalized()),h=e.project(t.northEast.normalized()),c=e.project(t.southEast.normalized());i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(a.x,a.y),i.lineTo(h.x,h.y),i.lineTo(c.x,c.y),i.closePath(),i.lineWidth=o,i.strokeStyle=n.toString(),i.stroke(),i.lineWidth=s,i.strokeStyle=r}}onHide(){super.onHide();const t=this.parent;t instanceof Gl&&t.onHideChild(this)}onUnhide(){super.onUnhide();const t=this.parent;t instanceof Gl&&t.onUnhideChild(this)}onSetUnbounded(t){const e=this.parent;e instanceof Gl&&e.onSetChildUnbounded(this,t)}cullGeoFrame(t=this.geoFrame){this.setCulled(!t.intersects(this.geoBounds))}get geoViewport(){return this.viewContext.geoViewport}get geoFrame(){const t=this.parent;return t instanceof Gl?t.geoFrame:d.GeoBox.globe()}setGeoBounds(t){const e=this.geoBounds;e.equals(t)||(this.willSetGeoBounds(t,e),this.geoBounds=t,this.onSetGeoBounds(t,e),this.didSetGeoBounds(t,e))}willSetGeoBounds(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.viewWillSetGeoBounds&&o.viewWillSetGeoBounds(t,e,this)}}onSetGeoBounds(t,e){if(!this.unbounded){const i=this.parent;i instanceof Gl&&i.onSetChildGeoBounds(this,t,e)}}didSetGeoBounds(t,e){const i=this.observers;for(let n=0,o=i.length;n<o;n+=1){const o=i[n];void 0!==o.viewDidSetGeoBounds&&o.viewDidSetGeoBounds(t,e,this)}}updateGeoBounds(){this.setGeoBounds(this.deriveGeoBounds())}onInsertChildGeoBounds(t,e){this.updateGeoBounds()}onRemoveChildGeoBounds(t,e){this.updateGeoBounds()}onSetChildGeoBounds(t,e,i){this.updateGeoBounds()}onHideChild(t){this.updateGeoBounds()}onUnhideChild(t){this.updateGeoBounds()}onSetChildUnbounded(t,e){this.updateGeoBounds()}get ownGeoBounds(){return null}deriveGeoBounds(){let t=this.ownGeoBounds,e=this.firstChild;for(;null!==e;){if(e instanceof Gl&&!e.hidden&&!e.unbounded){const i=e.geoBounds;i.isDefined()&&(t=null!==t?t.union(i):i)}e=e.nextSibling}return null===t&&(t=this.geoFrame),t}init(t){super.init(t)}}Gl.MountFlags=io.MountFlags|pn.NeedsProject,Gl.UncullFlags=io.UncullFlags|pn.NeedsProject,u([zt({type:B,value:null,inherits:!0})],Gl.prototype,"geoBoundsColor",void 0);class Hl extends S{}class jl extends Zo{static fromTrait(t){if(t instanceof Yl)return new Zl;if(t instanceof ga)return new va;if(t instanceof aa)return new da;if(t instanceof la)return new ca;throw new Error("Can't create GeoController from "+t)}}u([i.Property({type:e.Timing,inherits:!0})],jl.prototype,"geoTiming",void 0);class Yl extends Hl{constructor(){super(),this.geoBounds=d.GeoBox.globe()}setGeoBounds(t){const e=this.geoBounds;t.equals(e)||(this.willSetGeoBounds(t,e),this.geoBounds=t,this.onSetGeoBounds(t,e),this.didSetGeoBounds(t,e))}willSetGeoBounds(t,e){this.callObservers("traitWillSetGeoBounds",t,e,this)}onSetGeoBounds(t,e){}didSetGeoBounds(t,e){this.callObservers("traitDidSetGeoBounds",t,e,this)}startConsumingFeatures(){const t=this.features.traits;for(const e in t){t[e].consume(this)}}stopConsumingFeatures(){const t=this.features.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingFeatures()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingFeatures()}}u([T({type:Hl,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachFeature",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachFeature",t,this.owner)},detectModel:t=>t.getTrait(Hl),detectTrait:t=>null})],Yl.prototype,"features",void 0);class Xl{constructor(t,e,i,n,o,s,r,l,a,h,c,d){this.depth=t,this.maxDepth=e,this.density=i,this.geoFrame=n,this.geoBounds=o,this.geoCenter=s,this.southWest=r,this.northWest=l,this.southEast=a,this.northEast=h,this.views=c,this.size=d}isEmpty(){return 0===this.size}contains(t){return this.geoFrame.contains(t)}intersects(t){return this.geoFrame.intersects(t)}getTree(t){if(this.depth<this.maxDepth&&this.size>this.density){const e=this.geoCenter,i=t.lngMin<=e.lng,n=t.latMin<=e.lat,o=t.lngMax>e.lng,s=t.latMax>e.lat;if(i!==o&&n!==s)if(n&&i){const e=this.southWest;if(null!==e)return e.getTree(t)}else if(s&&i){const e=this.northWest;if(null!==e)return e.getTree(t)}else if(n&&o){const e=this.southEast;if(null!==e)return e.getTree(t)}else if(s&&o){const e=this.northEast;if(null!==e)return e.getTree(t)}}return this}has(t,e){if(this.depth<this.maxDepth&&this.size>this.density){const i=this.hasNode(t,e);if(void 0!==i)return i}return this.hasLeaf(t,e)}hasNode(t,e){const i=this.geoCenter,n=e.lngMin<=i.lng,o=e.latMin<=i.lat,s=e.lngMax>i.lng,r=e.latMax>i.lat;if(n!==s&&o!==r)if(o&&n){const i=this.southWest;if(null!==i)return i.has(t,e)}else if(r&&n){const i=this.northWest;if(null!==i)return i.has(t,e)}else if(o&&s){const i=this.southEast;if(null!==i)return i.has(t,e)}else if(r&&s){const i=this.northEast;if(null!==i)return i.has(t,e)}}hasLeaf(t,e){return this.views.indexOf(t)>=0}inserted(t,e){let i=this;if(i.depth<i.maxDepth&&i.size>i.density){const n=i.insertedNode(t,e);if(null!==n)return i=n,this!==i&&i.size===i.density+1&&(i=i.reinsertedNode()),i}return i=i.insertedLeaf(t,e),this!==i&&i.depth<i.maxDepth&&i.size===i.density+1&&(i=i.reinsertedNode()),i}insertedNode(t,e){const i=this.geoCenter,n=e.lngMin<=i.lng,o=e.latMin<=i.lat,s=e.lngMax>i.lng,r=e.latMax>i.lat;if(n!==s&&o!==r){if(o&&n){const i=this.southWest;let n=i;return null===n&&(n=this.createTree(this.depth+1,this.maxDepth,this.density,new d.GeoBox(this.geoFrame.lngMin,this.geoFrame.latMin,this.geoCenter.lng,this.geoCenter.lat))),n=n.inserted(t,e),i!==n?this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,n,this.northWest,this.southEast,this.northEast,this.views,this.size+1):this}if(r&&n){const i=this.northWest;let n=i;return null===n&&(n=this.createTree(this.depth+1,this.maxDepth,this.density,new d.GeoBox(this.geoFrame.lngMin,this.geoCenter.lat,this.geoCenter.lng,this.geoFrame.latMax))),n=n.inserted(t,e),i!==n?this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,n,this.southEast,this.northEast,this.views,this.size+1):this}if(o&&s){const i=this.southEast;let n=i;return null===n&&(n=this.createTree(this.depth+1,this.maxDepth,this.density,new d.GeoBox(this.geoCenter.lng,this.geoFrame.latMin,this.geoFrame.lngMax,this.geoCenter.lat))),n=n.inserted(t,e),i!==n?this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,n,this.northEast,this.views,this.size+1):this}if(r&&s){const i=this.northEast;let n=i;return null===n&&(n=this.createTree(this.depth+1,this.maxDepth,this.density,new d.GeoBox(this.geoCenter.lng,this.geoCenter.lat,this.geoFrame.lngMax,this.geoFrame.latMax))),n=n.inserted(t,e),i!==n?this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,n,this.views,this.size+1):this}}return null}insertedLeaf(t,e){const i=this.views;if(i.indexOf(t)<0){const e=i.slice(0);return e.push(t),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,this.northEast,e,this.size+1)}return this}removed(t,e){let i=this;if(i.depth<i.maxDepth&&i.size>i.density){const n=i.removedNode(t,e);if(null!==n)return i=n,this!==i&&i.size===i.density&&(i=i.reinsertedLeaf()),i}return i=i.removedLeaf(t,e),this!==i&&i.size===i.density&&(i=i.reinsertedLeaf()),i}removedNode(t,e){const i=this.geoCenter,n=e.lngMin<=i.lng,o=e.latMin<=i.lat,s=e.lngMax>i.lng,r=e.latMax>i.lat;if(n!==s&&o!==r){if(o&&n){const i=this.southWest;if(null!==i){let n=i.removed(t,e);return n.isEmpty()&&(n=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,n,this.northWest,this.southEast,this.northEast,this.views,this.size-1)}return this}if(r&&n){const i=this.northWest;if(null!==i){let n=i.removed(t,e);return n.isEmpty()&&(n=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,n,this.southEast,this.northEast,this.views,this.size-1)}return this}if(o&&s){const i=this.southEast;if(null!==i){let n=i.removed(t,e);return n.isEmpty()&&(n=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,n,this.northEast,this.views,this.size-1)}return this}if(r&&s){const i=this.northEast;if(null!==i){let n=i.removed(t,e);return n.isEmpty()&&(n=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,n,this.views,this.size-1)}return this}}return null}removedLeaf(t,e){const i=this.views,n=i.indexOf(t);if(n>=0){const t=i.slice(0);return t.splice(n,1),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,this.northEast,t,this.size-1)}return this}reinsertedNode(){let t=this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter);return this.forEach((function(e){const i=e.geoBounds,n=t.insertedNode(e,i);t=null!==n?n:t.insertedLeaf(e,i)}),this),t}reinsertedLeaf(){let t=this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter);return this.forEach((function(e){t=t.insertedLeaf(e,e.geoBounds)}),this),t}moved(t,e,i){if(this.depth<this.maxDepth&&this.size>this.density){const n=this.geoCenter,o=e.lngMin<=n.lng,s=e.latMin<=n.lat,r=e.lngMax>n.lng,l=e.latMax>n.lat,a=i.lngMin<=n.lng,h=i.latMin<=n.lat,c=i.lngMax>n.lng,d=i.latMax>n.lat;if(o!==a||s!==h||r!==c||l!==d)return this.removed(t,i).inserted(t,e);if(o!==r&&s!==l)if(s&&o){const n=this.southWest,o=n.moved(t,e,i);if(n!==o)return this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,o,this.northWest,this.southEast,this.northEast,this.views,this.size)}else if(l&&o){const n=this.northWest,o=n.moved(t,e,i);if(n!==o)return this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,o,this.southEast,this.northEast,this.views,this.size)}else if(s&&r){const n=this.southEast,o=n.moved(t,e,i);if(n!==o)return this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,o,this.northEast,this.views,this.size)}else if(l&&r){const n=this.northEast,o=n.moved(t,e,i);if(n!==o)return this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,o,this.views,this.size)}}return this}forEach(t,e){if(null!==this.southWest){const i=this.southWest.forEach(t,e);if(void 0!==i)return i}if(null!==this.northWest){const i=this.northWest.forEach(t,e);if(void 0!==i)return i}if(null!==this.southEast){const i=this.southEast.forEach(t,e);if(void 0!==i)return i}if(null!==this.northEast){const i=this.northEast.forEach(t,e);if(void 0!==i)return i}const i=this.views;for(let n=0;n<i.length;n+=1){const o=t.call(e,i[n]);if(void 0!==o)return o}}forEachReverse(t,e){const i=this.views;for(let n=i.length-1;n>=0;n-=1){const o=t.call(e,i[n]);if(void 0!==o)return o}if(null!==this.northEast){const i=this.northEast.forEachReverse(t,e);if(void 0!==i)return i}if(null!==this.southEast){const i=this.southEast.forEachReverse(t,e);if(void 0!==i)return i}if(null!==this.northWest){const i=this.northWest.forEachReverse(t,e);if(void 0!==i)return i}if(null!==this.southWest){const i=this.southWest.forEachReverse(t,e);if(void 0!==i)return i}}forEachIntersecting(t,e,i){if(this.geoFrame.intersects(t)){if(null!==this.southWest){const n=this.southWest.forEachIntersecting(t,e,i);if(void 0!==n)return n}if(null!==this.northWest){const n=this.northWest.forEachIntersecting(t,e,i);if(void 0!==n)return n}if(null!==this.southEast){const n=this.southEast.forEachIntersecting(t,e,i);if(void 0!==n)return n}if(null!==this.northEast){const n=this.northEast.forEachIntersecting(t,e,i);if(void 0!==n)return n}const n=this.views;for(let t=0;t<n.length;t+=1){const o=e.call(i,n[t]);if(void 0!==o)return o}}}forEachNonIntersecting(t,e,i){if(!this.geoFrame.intersects(t)){if(null!==this.southWest){const n=this.southWest.forEachNonIntersecting(t,e,i);if(void 0!==n)return n}if(null!==this.northWest){const n=this.northWest.forEachNonIntersecting(t,e,i);if(void 0!==n)return n}if(null!==this.southEast){const n=this.southEast.forEachNonIntersecting(t,e,i);if(void 0!==n)return n}if(null!==this.northEast){const n=this.northEast.forEachNonIntersecting(t,e,i);if(void 0!==n)return n}const n=this.views;for(let t=0;t<n.length;t+=1){const o=e.call(i,n[t]);if(void 0!==o)return o}}}createTree(t,i,n,o,s,r,l=null,a=null,h=null,c=null,d=e.Arrays.empty,u=0){if(void 0===r&&(r=o.center),void 0===s){null!==l&&(s=l.geoBounds),null!==a&&(s=void 0!==s?s.union(a.geoBounds):a.geoBounds),null!==h&&(s=void 0!==s?s.union(h.geoBounds):h.geoBounds),null!==c&&(s=void 0!==s?s.union(c.geoBounds):c.geoBounds);for(let t=0;t<d.length;t+=1){const e=d[t];s=void 0!==s?s.union(e.geoBounds):e.geoBounds}void 0===s&&(s=o)}return new Xl(t,i,n,o,s,r,l,a,h,c,d,u)}static empty(t,i,n,o){return void 0===t&&(t=d.GeoBox.globe()),void 0===i&&(i=0),void 0===n&&(n=20),n=Math.max(i,n),void 0===o&&(o=8),new Xl(i,n,o,t,t,t.center,null,null,null,null,e.Arrays.empty,0)}}class Kl extends Gl{constructor(t,e,i,n){super(),this.root=Xl.empty(t,e,i,n),this.stem=null}updateRoot(t){this.root=t,this.stem=null,this.setGeoBounds(t.geoBounds)}getStem(t){let e=this.stem;return null===e&&(e=this.root.getTree(t),this.stem=e),e}onInsertChild(t,e){super.onInsertChild(t,e),t instanceof Gl&&this.updateRoot(this.root.inserted(t,t.geoBounds))}onRemoveChild(t){super.onRemoveChild(t),t instanceof Gl&&this.updateRoot(this.root.removed(t,t.geoBounds))}willProject(t){super.willProject(t),this.stem=null}processChildren(t,e,i){const n=this.getStem(e.geoViewport.geoFrame);this.processTree(n,t,e,i)}processTree(t,e,i,n){null!==t.southWest&&t.southWest.geoFrame.intersects(i.geoViewport.geoFrame)&&this.processTree(t.southWest,e,i,n),null!==t.northWest&&t.northWest.geoFrame.intersects(i.geoViewport.geoFrame)&&this.processTree(t.northWest,e,i,n),null!==t.southEast&&t.southEast.geoFrame.intersects(i.geoViewport.geoFrame)&&this.processTree(t.southEast,e,i,n),null!==t.northEast&&t.northEast.geoFrame.intersects(i.geoViewport.geoFrame)&&this.processTree(t.northEast,e,i,n);const o=t.views;for(let t=0;t<o.length;t+=1){const s=o[t];n.call(this,s,e,i),0!=(s.flags&pn.RemovingFlag)&&(s.setFlags(s.flags&~pn.RemovingFlag),this.removeChild(s))}}onRender(t){super.onRender(t);const e=this.geoTreeColor.value;null!==e&&this.renderGeoTree(t,e)}renderGeoTree(t,e){const i=t.renderer;i instanceof ro&&!this.hidden&&!this.culled&&this.renderGeoTreeOutline(this.root,t.geoViewport,i.context,e)}renderGeoTreeOutline(t,e,i,n){null!==t.southWest&&this.renderGeoTreeOutline(t.southWest,e,i,n),null!==t.northWest&&this.renderGeoTreeOutline(t.northWest,e,i,n),null!==t.southEast&&this.renderGeoTreeOutline(t.southEast,e,i,n),null!==t.northEast&&this.renderGeoTreeOutline(t.northEast,e,i,n);if(t.depth>=2){const o=(t.depth-2)/(t.maxDepth-2),s=4*(1-o)+.5*o;this.renderGeoOutline(t.geoFrame,e,i,n,s)}}displayChildren(t,e,i){const n=this.getStem(e.geoViewport.geoFrame);this.displayTree(n,t,e,i)}displayTree(t,e,i,n){null!==t.southWest&&t.southWest.geoFrame.intersects(i.geoViewport.geoFrame)&&this.displayTree(t.southWest,e,i,n),null!==t.northWest&&t.northWest.geoFrame.intersects(i.geoViewport.geoFrame)&&this.displayTree(t.northWest,e,i,n),null!==t.southEast&&t.southEast.geoFrame.intersects(i.geoViewport.geoFrame)&&this.displayTree(t.southEast,e,i,n),null!==t.northEast&&t.northEast.geoFrame.intersects(i.geoViewport.geoFrame)&&this.displayTree(t.northEast,e,i,n);const o=t.views;for(let t=0;t<o.length;t+=1){const s=o[t];n.call(this,s,e,i),0!=(s.flags&pn.RemovingFlag)&&(s.setFlags(s.flags&~pn.RemovingFlag),this.removeChild(s))}}updateGeoBounds(){}onSetChildGeoBounds(t,e,i){this.updateRoot(this.root.moved(t,e,i))}hitTest(t,e,i){const n=i.geoViewport,o=n.unproject(t,e),s=this.getStem(n.geoFrame);return this.hitTestTree(s,t,e,o,i)}hitTestTree(t,e,i,n,o){let s=null;if(null!==t.southWest&&t.southWest.geoFrame.contains(n)&&(s=this.hitTestTree(t.southWest,e,i,n,o)),null===s&&null!==t.northWest&&t.northWest.geoFrame.contains(n)&&(s=this.hitTestTree(t.northWest,e,i,n,o)),null===s&&null!==t.southEast&&t.southEast.geoFrame.contains(n)&&(s=this.hitTestTree(t.southEast,e,i,n,o)),null===s&&null!==t.northEast&&t.northEast.geoFrame.contains(n)&&(s=this.hitTestTree(t.northEast,e,i,n,o)),null===s){const n=t.views;for(let t=0;t<n.length;t+=1){if(s=n[t].cascadeHitTest(e,i,o),null!==s)break}}return s}init(t){super.init(t),void 0!==t.geoTreeColor&&this.geoTreeColor(t.geoTreeColor)}}u([zt({type:B,value:null})],Kl.prototype,"geoTreeColor",void 0);class Zl extends jl{}u([$o({traitType:Yl,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachGeoTrait",t,this.owner)},didAttachTrait(t){const e=t.features.traits;for(const t in e){const i=e[t];this.owner.features.addTraitController(i)}},willDetachTrait(t){const e=t.features.traits;for(const t in e){const i=e[t];this.owner.features.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachGeoTrait",t,this.owner)},traitWillSetGeoBounds(t,e){this.owner.callObservers("controllerWillSetGeoBounds",t,e,this.owner)},traitDidSetGeoBounds(t,e){this.owner.callObservers("controllerDidSetGeoBounds",t,e,this.owner)},traitWillAttachFeature(t,e){this.owner.features.addTraitController(t,e)},traitDidDetachFeature(t){this.owner.features.deleteTraitController(t)},viewType:Kl,willAttachView(t){this.owner.callObservers("controllerWillAttachGeoView",t,this.owner)},didAttachView(t){const e=this.owner.features.controllers;for(const i in e){const n=e[i],o=n.geo.view;null!==o&&null===o.parent&&n.geo.insertView(t)}},didDetachView(t){this.owner.callObservers("controllerDidDetachGeoView",t,this.owner)}})],Zl.prototype,"geo",void 0),u([ns({implements:!0,type:jl,binds:!0,observes:!0,get parentView(){return this.owner.geo.view},getTraitViewRef:t=>t.geo,willAttachController(t){this.owner.callObservers("controllerWillAttachFeature",t,this.owner)},didAttachController(t){const e=t.geo.trait;null!==e&&this.attachFeatureTrait(e,t);const i=t.geo.view;null!==i&&this.attachFeatureView(i,t)},willDetachController(t){const e=t.geo.view;null!==e&&this.detachFeatureView(e,t);const i=t.geo.trait;null!==i&&this.detachFeatureTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachFeature",t,this.owner)},controllerWillAttachGeoTrait(t,e){this.owner.callObservers("controllerWillAttachFeatureTrait",t,e,this.owner),this.attachFeatureTrait(t,e)},controllerDidDetachGeoTrait(t,e){this.detachFeatureTrait(t,e),this.owner.callObservers("controllerDidDetachFeatureTrait",t,e,this.owner)},attachFeatureTrait(t,e){},detachFeatureTrait(t,e){},controllerWillAttachGeoView(t,e){this.owner.callObservers("controllerWillAttachFeatureView",t,e,this.owner),this.attachFeatureView(t,e)},controllerDidDetachGeoView(t,e){this.detachFeatureView(t,e),this.owner.callObservers("controllerDidDetachFeatureView",t,e,this.owner)},attachFeatureView(t,e){},detachFeatureView(t,e){t.remove()},controllerWillSetGeoBounds(t,e,i){this.owner.callObservers("controllerWillSetFeatureGeoBounds",t,e,i,this.owner)},controllerDidSetGeoBounds(t,e,i){this.owner.callObservers("controllerDidSetFeatureGeoBounds",t,e,i,this.owner)},createController(t){return void 0!==t?jl.fromTrait(t):ns.prototype.createController.call(this)}})],Zl.prototype,"features",void 0);class _l extends Gl{constructor(){super(),Object.defineProperty(this,"viewBounds",{value:o.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0}),this.setFlags(this.flags|pn.UnboundedFlag)}onProject(t){super.onProject(t),this.projectRipple(t)}projectGeoCenter(t){if(this.mounted){const e=this.viewContext,i=null!==t&&t.isDefined()?e.geoViewport.project(t):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectRipple(e)}}projectRipple(t){if(this.viewCenter.hasAffinity(i.Affinity.Intrinsic)){const e=this.geoCenter.value,n=null!==e&&e.isDefined()?t.geoViewport.project(e):null;this.viewCenter.setValue(n,i.Affinity.Intrinsic)}}onRender(t){super.onRender(t);const e=t.renderer;e instanceof ro&&!this.hidden&&!this.culled&&this.renderRipple(e.context,t.viewFrame)}renderRipple(t,e){const i=this.viewCenter.value;if(null!==i&&i.isDefined()){const n=Math.min(e.width,e.height),o=this.radius.getValue().pxValue(n),s=this.stroke.value;if(null!==s){const e=t.lineWidth,r=t.strokeStyle;t.beginPath(),t.arc(i.x,i.y,o,0,2*Math.PI);const l=this.strokeWidth.value;null!==l&&(t.lineWidth=l.pxValue(n)),t.strokeStyle=s.toString(),t.stroke(),t.lineWidth=e,t.strokeStyle=r}}}renderGeoBounds(t,e,i){}updateGeoBounds(){}updateViewBounds(){this.viewBounds=this.deriveViewBounds()}deriveViewBounds(){const t=this.viewCenter.value;return null!==t&&t.isDefined()?t.bounds:o.R2Box.undefined()}ripple(t){let n,s,r,l,a,h;n=void 0===t||void 0===t.source?null:t.source,s=void 0===t||void 0===t.center||null===t.center?null:d.GeoPoint.fromAny(t.center),r=void 0===t||void 0===t.width||null===t.width?null:o.Length.fromAny(t.width),l=void 0===t||void 0===t.radius||null===t.radius?o.Length.pct(12.5):o.Length.fromAny(t.radius),a=void 0===t||void 0===t.color||null===t.color?this.getLookOr(St.accentColor,null):t.color instanceof St?this.getLookOr(t.color,null):B.fromAny(t.color),h=void 0===t||void 0===t.timing||!0===t.timing?this.getLookOr(St.timing,Ot.ambient,!1):"number"==typeof t.timing?e.Easing.linear.withDuration(t.timing):e.Timing.fromAny(t.timing);const c=void 0!==t?t.opacity:void 0;return null!==n&&this.source.setView(n),null!==s&&this.geoCenter.setState(s,i.Affinity.Intrinsic),null!==r&&this.strokeWidth.setState(r,i.Affinity.Intrinsic),this.radius.setState(l,h),null!==a&&(this.stroke.setState(void 0!==c?a.alpha(c):a),this.stroke.setState(a.alpha(0),h)),this}static ripple(t,e){if(document.hidden||t.hidden||t.culled||!t.geoBounds.intersects(t.geoViewport.geoFrame))return null;{const i=_l.create();i.source.setView(t);let n=t.getBase(Gl);return null===n&&(n=t),n.appendChild(i),i.ripple(e),i}}}u([i.Animator({type:d.GeoPoint,value:null,didSetState(t,e){this.owner.projectGeoCenter(t)},willSetValue(t,e){this.owner.callObservers("viewWillSetGeoCenter",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(null!==t?t.bounds:d.GeoBox.undefined()),this.mounted&&this.owner.projectRipple(this.owner.viewContext),this.owner.callObservers("viewDidSetGeoCenter",t,e,this.owner)}})],_l.prototype,"geoCenter",void 0),u([i.Animator({type:o.R2Point,value:o.R2Point.undefined(),updateFlags:pn.NeedsRender,didSetValue(t,e){this.owner.updateViewBounds()}})],_l.prototype,"viewCenter",void 0),u([zt({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsRender,didTransition(){this.owner.source.setView(null),this.owner.remove()}})],_l.prototype,"radius",void 0),u([zt({type:B,value:null,look:St.accentColor,inherits:!0,updateFlags:pn.NeedsRender})],_l.prototype,"stroke",void 0),u([zt({type:o.Length,value:o.Length.px(1),inherits:!0,updateFlags:pn.NeedsRender})],_l.prototype,"strokeWidth",void 0),u([gn({observes:!0,didAttachView(t){this.owner.geoCenter.setState(t.geoBounds.center,i.Affinity.Intrinsic)},viewDidUnmount(t){this.owner.remove()},viewDidSetGeoBounds(t,e,n){this.owner.geoCenter.setState(t.center,i.Affinity.Intrinsic)}})],_l.prototype,"source",void 0);class Ql extends Gl{constructor(){super(),this.canvas=this.createCanvas(),Object.defineProperty(this,"renderer",{value:this.createRenderer(),writable:!0,enumerable:!0,configurable:!0}),this.ownRasterFrame=null}get pixelRatio(){return window.devicePixelRatio||1}get compositor(){const t=this.parent;return t instanceof io?t.renderer:null}setRenderer(t){"string"==typeof t&&(t=this.createRenderer(t)),this.renderer=t,this.requireUpdate(pn.NeedsRender|pn.NeedsComposite)}createRenderer(t="canvas"){if("canvas"===t){const t=this.canvas.getContext("2d");if(null!==t)return new ho(t,o.Transform.identity(),this.pixelRatio);throw new Error("Failed to create canvas rendering context")}if("webgl"===t){const t=this.canvas.getContext("webgl");if(null!==t)return new co(t,this.pixelRatio);throw new Error("Failed to create webgl rendering context")}throw new Error("Failed to create "+t+" renderer")}needsUpdate(t,e){const i=(t=super.needsUpdate(t,e))&(pn.NeedsRender|pn.NeedsComposite);return 0!==i&&(t|=pn.NeedsComposite,this.setFlags(this.flags|pn.NeedsDisplay|pn.NeedsComposite|i)),t}needsProcess(t,e){return 0==(this.flags&pn.ProcessMask)&&0==(t&(pn.NeedsResize|pn.NeedsProject))&&(t=0),t}onResize(t){super.onResize(t),this.requireUpdate(pn.NeedsRender|pn.NeedsComposite)}onProject(t){super.onProject(t),this.projectRaster(t)}projectGeoAnchor(t){if(this.mounted){const e=this.viewContext,i=null!==t&&t.isDefined()?e.geoViewport.project(t):null;this.viewAnchor.setInterpolatedValue(this.viewAnchor.value,i),this.projectRaster(e)}}projectRaster(t){let e;if(this.viewAnchor.hasAffinity(i.Affinity.Intrinsic)){const n=this.geoAnchor.value;e=null!==n&&n.isDefined()?t.geoViewport.project(n):null,this.viewAnchor.setValue(e,i.Affinity.Intrinsic)}else e=this.viewAnchor.value;if(null!==e){const i=t.viewFrame,n=i.width,s=i.height,r=Math.min(n,s);let l=this.width.value;l=l instanceof o.Length?l.pxValue(r):n;let a=this.height.value;a=a instanceof o.Length?a.pxValue(r):s;const h=e.x-l*this.xAlign.getValue(),c=e.y-a*this.yAlign.getValue(),d=new o.R2Box(h,c,h+l,c+a);this.setRasterFrame(d),this.setViewFrame(d),this.setCulled(!i.intersects(d))}else this.setCulled(!this.viewFrame.intersects(this.rasterFrame))}needsDisplay(t,e){return 0!=(this.flags&pn.DisplayMask)?t|=pn.NeedsComposite:t=0!=(t&pn.NeedsComposite)?pn.NeedsDisplay|pn.NeedsComposite:0,t}onRender(t){const e=this.rasterFrame;this.resizeCanvas(this.canvas,e),this.resetRenderer(e),this.clearCanvas(e),super.onRender(t)}didComposite(t){this.compositeImage(t),super.didComposite(t)}extendViewContext(t){const e=Object.create(t);return e.compositor=t.renderer,e.renderer=this.renderer,e}get rasterFrame(){let t=this.ownRasterFrame;return null===t&&(t=this.deriveRasterFrame()),t}setRasterFrame(t){this.ownRasterFrame=t}deriveRasterFrame(){return this.deriveViewBounds()}createCanvas(){return document.createElement("canvas")}resizeCanvas(t,e){const i=this.pixelRatio,n=e.width,o=e.height,s=n*i,r=o*i,l=t.width,a=t.height;s===l&&r===a||(t.width=s,t.height=r,t.style.width=n+"px",t.style.height=o+"px")}clearCanvas(t){const e=this.renderer;if(e instanceof ho)e.context.clearRect(0,0,t.xMax,t.yMax);else if(e instanceof co){const t=e.context;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}}resetRenderer(t){const e=this.renderer;if(e instanceof ho){const i=this.pixelRatio,n=t.xMin*i,s=t.yMin*i;e.context.setTransform(i,0,0,i,-n,-s),e.setTransform(o.Transform.affine(i,0,0,i,-n,-s))}else e instanceof co&&e.context.viewport(t.x,t.y,t.xMax,t.yMax)}compositeImage(t){const e=t.compositor;if(e instanceof ho){const t=e.context,i=this.rasterFrame,n=this.canvas;if(i.isDefined()&&0!==i.width&&0!==i.height&&0!==n.width&&0!==n.height){const e=t.globalAlpha,o=t.globalCompositeOperation;t.globalAlpha=this.opacity.getValue(),t.globalCompositeOperation=this.compositeOperation.getValue(),t.drawImage(n,i.x,i.y,i.width,i.height),t.globalAlpha=e,t.globalCompositeOperation=o}}}ripple(t){return _l.ripple(this,t)}init(t){super.init(t),void 0!==t.geoAnchor&&this.geoAnchor(t.geoAnchor),void 0!==t.viewAnchor&&this.viewAnchor(t.viewAnchor),void 0!==t.xAlign&&this.xAlign(t.xAlign),void 0!==t.yAlign&&this.yAlign(t.yAlign),void 0!==t.width&&this.width(t.width),void 0!==t.height&&this.height(t.height),void 0!==t.opacity&&this.opacity(t.opacity),void 0!==t.compositeOperation&&this.compositeOperation(t.compositeOperation)}}Ql.MountFlags=Gl.MountFlags|pn.NeedsComposite,Ql.UncullFlags=Gl.UncullFlags|pn.NeedsComposite,Ql.UnhideFlags=Gl.UnhideFlags|pn.NeedsComposite,u([i.Animator({type:d.GeoPoint,value:null,didSetState(t,e){this.owner.projectGeoAnchor(t)},willSetValue(t,e){this.owner.callObservers("viewWillSetGeoAnchor",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(null!==t?t.bounds:d.GeoBox.undefined()),this.mounted&&this.owner.projectRaster(this.owner.viewContext),this.owner.callObservers("viewDidSetGeoAnchor",t,e,this.owner)}})],Ql.prototype,"geoAnchor",void 0),u([i.Animator({type:o.R2Point,value:o.R2Point.undefined()})],Ql.prototype,"viewAnchor",void 0),u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsComposite})],Ql.prototype,"xAlign",void 0),u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsComposite})],Ql.prototype,"yAlign",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsResize|pn.NeedsLayout|pn.NeedsRender|pn.NeedsComposite})],Ql.prototype,"width",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsResize|pn.NeedsLayout|pn.NeedsRender|pn.NeedsComposite})],Ql.prototype,"height",void 0),u([zt({type:Number,value:1,updateFlags:pn.NeedsComposite})],Ql.prototype,"opacity",void 0),u([i.Animator({type:String,value:"source-over",updateFlags:pn.NeedsComposite})],Ql.prototype,"compositeOperation",void 0);class Jl extends Gl{constructor(t){super(),this.geoTile=t,this.geoBounds=t.bounds}setGeoBounds(t){}updateGeoBounds(){}}class $l extends Yl{constructor(t){super(),this.geoTile=t,this.geoBounds=t.bounds}setGeoBounds(t){}createTileTrait(t){return new $l(t)}createTileModel(t){const e=this.createTileTrait(t);if(null!==e){const t=new y;return t.setTrait("tile",e),t}return null}initTiles(){let t=this.getChild("southWest");null===t&&(t=this.createTileModel(this.geoTile.southWestTile),null!==t&&this.setChild("southWest",t));let e=this.getChild("northWest");null===e&&(e=this.createTileModel(this.geoTile.northWestTile),null!==e&&this.setChild("northWest",e));let i=this.getChild("southEast");null===i&&(i=this.createTileModel(this.geoTile.southEastTile),null!==i&&this.setChild("southEast",i));let n=this.getChild("northEast");null===n&&(n=this.createTileModel(this.geoTile.northEastTile),null!==n&&this.setChild("northEast",n))}onStartConsuming(){super.onStartConsuming(),this.initTiles()}}u([T({extends:!0,detectModel(t){const e=t.getTrait(Hl);return e instanceof $l?null:e}})],$l.prototype,"features",void 0),u([T({type:$l,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachTile",t,this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachTile",t,this.owner)},detectModel:t=>t.getTrait($l),detectTrait:t=>null})],$l.prototype,"tiles",void 0);class ta extends Zl{constructor(t){super(),this.geoTile=t}get minCullZoom(){return this.geoTile.z}get maxCullZoom(){return 1/0}autoCullGeoView(t,e){const i=this.minCullZoom<=t.zoom&&t.zoom<this.maxCullZoom&&t.geoFrame.intersects(e.geoBounds);e.setCulled(!i)}get minConsumeZoom(){return this.geoTile.z}get maxConsumeZoom(){return 1/0}autoConsumeGeoView(t,e){const i=this.geo.trait;if(null!==i){this.minConsumeZoom<=t.zoom&&t.zoom<this.maxConsumeZoom&&t.geoFrame.intersects(e.geoBounds)?i.consume(this):i.unconsume(this)}}}u([$o({extends:!0,traitType:$l,observesTrait:!0,didAttachTrait(t,e){const i=t.tiles.traits;for(const t in i){const e=i[t];this.owner.tiles.addTraitController(e)}const n=this.view;null===n||n.culled||t.consume(this.owner),Zl.geo.prototype.didAttachTrait.call(this,t,e)},willDetachTrait(t){Zl.geo.prototype.willDetachTrait.call(this,t),t.unconsume(this.owner);const e=t.tiles.traits;for(const t in e){const i=e[t];this.owner.tiles.deleteTraitController(i)}},traitWillAttachTile(t,e){this.owner.tiles.addTraitController(t,e)},traitDidDetachTile(t){this.owner.tiles.deleteTraitController(t)},viewType:Jl,observesView:!0,didAttachView(t,e){Zl.geo.prototype.didAttachView.call(this,t,e),t.setCulled(!0);const i=this.owner.tiles.controllers;for(const e in i){const n=i[e],o=n.geo.view;null!==o&&null===o.parent&&n.geo.insertView(t)}},viewDidProject(t,e){this.owner.autoCullGeoView(t.geoViewport,e),this.owner.autoConsumeGeoView(t.geoViewport,e)},createView(){return new Jl(this.owner.geoTile)}})],ta.prototype,"geo",void 0),u([ns({extends:!0,detectController:t=>t instanceof jl&&!(t instanceof ta)?t:null})],ta.prototype,"features",void 0),u([ns({implements:!0,type:ta,binds:!0,observes:!0,get parentView(){return this.owner.geo.view},getTraitViewRef:t=>t.geo,willAttachController(t){this.owner.callObservers("controllerWillAttachTile",t,this.owner)},didAttachController(t){const e=t.geo.trait;null!==e&&this.attachTileTrait(e,t);const i=t.geo.view;null!==i&&this.attachTileView(i,t)},willDetachController(t){const e=t.geo.view;null!==e&&this.detachTileView(e,t);const i=t.geo.trait;null!==i&&this.detachTileTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachTile",t,this.owner)},controllerWillAttachGeoTrait(t,e){this.owner.callObservers("controllerWillAttachTileTrait",t,e,this.owner),this.attachTileTrait(t,e)},controllerDidDetachGeoTrait(t,e){this.detachTileTrait(t,e),this.owner.callObservers("controllerDidDetachTileTrait",t,e,this.owner)},attachTileTrait(t,e){},detachTileTrait(t,e){},controllerWillAttachGeoView(t,e){this.owner.callObservers("controllerWillAttachTileView",t,e,this.owner),this.attachTileView(t,e)},controllerDidDetachGeoView(t,e){this.detachTileView(t,e),this.owner.callObservers("controllerDidDetachTileView",t,e,this.owner)},attachTileView(t,e){},detachTileView(t,e){t.remove()},createController(t){return void 0!==t?new ta(t.geoTile):ns.prototype.createController.call(this)}})],ta.prototype,"tiles",void 0);class ea extends Gl{constructor(){super(),Object.defineProperty(this,"viewBounds",{value:o.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}onProject(t){super.onProject(t),this.projectCircle(t)}projectGeoCenter(t){if(this.mounted){const e=this.viewContext,i=null!==t&&t.isDefined()?e.geoViewport.project(t):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectCircle(e)}}projectCircle(t){if(i.Affinity.Intrinsic>=(this.viewCenter.flags&i.Affinity.Mask)){const e=this.geoCenter.value,i=null!==e&&e.isDefined()?t.geoViewport.project(e):null;this.viewCenter.value=i}const e=t.viewFrame,n=Math.min(e.width,e.height),s=this.radius.getValue().pxValue(n),r=this.viewCenter.value,l=this.viewCenter.state;null!==r&&null!==l&&(e.intersectsCircle(new o.R2Circle(r.x,r.y,s))||e.intersectsSegment(new o.R2Segment(r.x,r.y,l.x,l.y)))?this.setCulled(!1):this.setCulled(!0)}onRender(t){super.onRender(t);const e=t.renderer;e instanceof ro&&!this.hidden&&!this.culled&&this.renderCircle(e.context,t.viewFrame)}renderCircle(t,e){const i=this.viewCenter.value;if(null!==i&&i.isDefined()){const n=t.fillStyle,o=t.lineWidth,s=t.strokeStyle,r=Math.min(e.width,e.height),l=this.radius.getValue().pxValue(r);t.beginPath(),t.arc(i.x,i.y,l,0,2*Math.PI);const a=this.fill.value;null!==a&&(t.fillStyle=a.toString(),t.fill());const h=this.stroke.value;if(null!==h){const e=this.strokeWidth.value;null!==e&&(t.lineWidth=e.pxValue(r)),t.strokeStyle=h.toString(),t.stroke()}t.fillStyle=n,t.lineWidth=o,t.strokeStyle=s}}renderGeoBounds(t,e,i){}updateGeoBounds(){}deriveViewBounds(){const t=this.viewCenter.value;if(null!==t&&t.isDefined()){const e=this.viewContext.viewFrame,i=Math.min(e.width,e.height),n=this.radius.getValue().pxValue(i);return new o.R2Box(t.x-n,t.y-n,t.x+n,t.y+n)}return o.R2Box.undefined()}get popoverFrame(){const t=this.viewCenter.value;if(null!==t&&t.isDefined()){const e=this.viewContext.viewFrame,i=Math.min(e.width,e.height),n=this.pageTransform.inverse(),s=n.transformX(t.x,t.y),r=n.transformY(t.x,t.y),l=this.radius.getValue().pxValue(i);return new o.R2Box(s-l,r-l,s+l,r+l)}return this.pageBounds}get hitBounds(){const t=this.viewCenter.value;if(null!==t&&t.isDefined()){const e=this.viewContext.viewFrame,i=Math.min(e.width,e.height),n=this.radius.getValue().pxValue(i),s=Math.max(this.hitRadius.getValueOr(n),n);return new o.R2Box(t.x-s,t.y-s,t.x+s,t.y+s)}return this.viewBounds}hitTest(t,e,i){const n=i.renderer;return n instanceof ho?this.hitTestCircle(t,e,n.context,i.viewFrame,n.transform):null}hitTestCircle(t,e,i,n,o){const s=this.viewCenter.value;if(null!==s&&s.isDefined()){const r=Math.min(n.width,n.height),l=this.radius.getValue().pxValue(r);if(null!==this.fill.value){const i=Math.max(this.hitRadius.getValueOr(l),l),n=s.x-t,o=s.y-e;if(n*n+o*o<i*i)return this}const a=this.strokeWidth.value;if(null!==this.stroke.value&&null!==a){const n=i.lineWidth,h=o.transform(t,e);i.beginPath(),i.arc(s.x,s.y,l,0,2*Math.PI),i.lineWidth=a.pxValue(r);const c=i.isPointInStroke(h.x,h.y);if(i.lineWidth=n,c)return this}}return null}ripple(t){return _l.ripple(this,t)}init(t){super.init(t),void 0!==t.geoCenter&&this.geoCenter(t.geoCenter),void 0!==t.viewCenter&&this.viewCenter(t.viewCenter),void 0!==t.radius&&this.radius(t.radius),void 0!==t.hitRadius&&this.hitRadius(t.hitRadius),void 0!==t.fill&&this.fill(t.fill),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth)}}u([i.Animator({type:d.GeoPoint,value:null,didSetState(t,e){this.owner.projectGeoCenter(t)},willSetValue(t,e){this.owner.callObservers("viewWillSetGeoCenter",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(null!==t?t.bounds:d.GeoBox.undefined()),this.mounted&&this.owner.projectCircle(this.owner.viewContext),this.owner.callObservers("viewDidSetGeoCenter",t,e,this.owner)}})],ea.prototype,"geoCenter",void 0),u([i.Animator({type:o.R2Point,value:o.R2Point.undefined(),updateFlags:pn.NeedsRender})],ea.prototype,"viewCenter",void 0),u([zt({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsRender})],ea.prototype,"radius",void 0),u([zt({type:B,value:null,inherits:!0,updateFlags:pn.NeedsRender})],ea.prototype,"fill",void 0),u([zt({type:B,value:null,inherits:!0,updateFlags:pn.NeedsRender})],ea.prototype,"stroke",void 0),u([zt({type:o.Length,value:null,inherits:!0,updateFlags:pn.NeedsRender})],ea.prototype,"strokeWidth",void 0),u([i.Property({type:Number})],ea.prototype,"hitRadius",void 0);class ia extends Gl{constructor(){super(),Object.defineProperty(this,"viewBounds",{value:o.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}get value(){const t=this.viewCenter.value;return null!==t&&t.isDefined()?new yo(t,this.innerRadius.value,this.outerRadius.value,this.startAngle.value,this.sweepAngle.value,this.padAngle.value,this.padRadius.value,this.cornerRadius.value):null}get state(){const t=this.viewCenter.state;return null!==t&&t.isDefined()?new yo(t,this.innerRadius.state,this.outerRadius.state,this.startAngle.state,this.sweepAngle.state,this.padAngle.state,this.padRadius.state,this.cornerRadius.state):null}onProject(t){super.onProject(t),this.projectArc(t)}projectGeoCenter(t){if(this.mounted){const e=this.viewContext,i=null!==t&&t.isDefined()?e.geoViewport.project(t):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectArc(e)}}projectArc(t){if(i.Affinity.Intrinsic>=(this.viewCenter.flags&i.Affinity.Mask)){const e=this.geoCenter.value,i=null!==e&&e.isDefined()?t.geoViewport.project(e):null;this.viewCenter.value=i}const e=t.viewFrame,n=Math.min(e.width,e.height),s=this.outerRadius.getValue().pxValue(n),r=this.viewCenter.value,l=this.viewCenter.state;null!==r&&null!==l&&(e.intersectsCircle(new o.R2Circle(r.x,r.y,s))||e.intersectsSegment(new o.R2Segment(r.x,r.y,l.x,l.y)))?this.setCulled(!1):this.setCulled(!0)}onRender(t){super.onRender(t);const e=t.renderer;e instanceof ro&&!this.hidden&&!this.culled&&this.renderArc(e.context,t.viewFrame)}renderArc(t,e){const i=this.value;if(null!==i&&e.isDefined()){const n=t.fillStyle,o=t.lineWidth,s=t.strokeStyle;t.beginPath(),i.draw(t,e);const r=this.fill.value;null!==r&&(t.fillStyle=r.toString(),t.fill());const l=this.stroke.value;if(null!==l){const i=this.strokeWidth.value;if(null!==i){const n=Math.min(e.width,e.height);t.lineWidth=i.pxValue(n)}t.strokeStyle=l.toString(),t.stroke()}t.fillStyle=n,t.lineWidth=o,t.strokeStyle=s}}renderGeoBounds(t,e,i){}updateGeoBounds(){}deriveViewBounds(){const t=this.viewCenter.value;if(null!==t&&t.isDefined()){const e=this.viewContext.viewFrame,i=Math.min(e.width,e.height),n=this.outerRadius.getValue().pxValue(i);return new o.R2Box(t.x-n,t.y-n,t.x+n,t.y+n)}return o.R2Box.undefined()}get popoverFrame(){const t=this.viewCenter.value;if(null!==t&&t.isDefined()){const e=this.viewContext.viewFrame,i=Math.min(e.width,e.height),n=this.pageTransform.inverse(),s=n.transformX(t.x,t.y),r=n.transformY(t.x,t.y),l=(this.innerRadius.getValue().pxValue(i)+this.outerRadius.getValue().pxValue(i))/2,a=this.startAngle.getValue().radValue()+this.sweepAngle.getValue().radValue()/2,h=s+l*Math.cos(a),c=r+l*Math.sin(a);return new o.R2Box(h,c,h,c)}return this.pageBounds}hitTest(t,e,i){const n=i.renderer;if(n instanceof ho){const o=n.transform.transform(t,e);return this.hitTestArc(o.x,o.y,n.context,i.viewFrame)}return null}hitTestArc(t,e,i,n){const o=this.value;if(null!==o){if(i.beginPath(),o.draw(i,n),null!==this.fill.value&&i.isPointInPath(t,e))return this;if(void 0!==this.stroke.value){const o=this.strokeWidth.value;if(null!==o){const s=i.lineWidth,r=Math.min(n.width,n.height);i.lineWidth=o.pxValue(r);const l=i.isPointInStroke(t,e);if(i.lineWidth=s,l)return this}}}return null}ripple(t){return _l.ripple(this,t)}init(t){super.init(t),void 0!==t.geoCenter&&this.geoCenter(t.geoCenter),void 0!==t.viewCenter&&this.viewCenter(t.viewCenter),void 0!==t.innerRadius&&this.innerRadius(t.innerRadius),void 0!==t.outerRadius&&this.outerRadius(t.outerRadius),void 0!==t.startAngle&&this.startAngle(t.startAngle),void 0!==t.sweepAngle&&this.sweepAngle(t.sweepAngle),void 0!==t.padAngle&&this.padAngle(t.padAngle),void 0!==t.padRadius&&this.padRadius(t.padRadius),void 0!==t.cornerRadius&&this.cornerRadius(t.cornerRadius),void 0!==t.fill&&this.fill(t.fill),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth)}}u([i.Animator({type:d.GeoPoint,value:null,didSetState(t,e){this.owner.projectGeoCenter(t)},willSetValue(t,e){this.owner.callObservers("viewWillSetGeoCenter",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(null!==t?t.bounds:d.GeoBox.undefined()),this.mounted&&this.owner.projectArc(this.owner.viewContext),this.owner.callObservers("viewDidSetGeoCenter",t,e,this.owner)}})],ia.prototype,"geoCenter",void 0),u([i.Animator({type:o.R2Point,value:o.R2Point.undefined(),updateFlags:pn.NeedsRender})],ia.prototype,"viewCenter",void 0),u([zt({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsRender})],ia.prototype,"innerRadius",void 0),u([zt({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsRender})],ia.prototype,"outerRadius",void 0),u([zt({type:o.Angle,value:o.Angle.zero(),updateFlags:pn.NeedsRender})],ia.prototype,"startAngle",void 0),u([zt({type:o.Angle,value:o.Angle.zero(),updateFlags:pn.NeedsRender})],ia.prototype,"sweepAngle",void 0),u([zt({type:o.Angle,value:o.Angle.zero(),updateFlags:pn.NeedsRender})],ia.prototype,"padAngle",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsRender})],ia.prototype,"padRadius",void 0),u([zt({type:o.Length,value:o.Length.zero(),updateFlags:pn.NeedsRender})],ia.prototype,"cornerRadius",void 0),u([zt({type:B,value:null,inherits:!0,updateFlags:pn.NeedsRender})],ia.prototype,"fill",void 0),u([zt({type:B,value:null,inherits:!0,updateFlags:pn.NeedsRender})],ia.prototype,"stroke",void 0),u([zt({type:o.Length,value:null,inherits:!0,updateFlags:pn.NeedsRender})],ia.prototype,"strokeWidth",void 0);class na extends Gl{constructor(){super(),Object.defineProperty(this,"viewBounds",{value:o.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}onProject(t){super.onProject(t),this.projectPath(t)}projectPath(t){const e=t.geoViewport;let n;if(this.viewPath.hasAffinity(i.Affinity.Intrinsic)){const t=this.geoPath.value;n=null!==t&&t.isDefined()?t.project(e):null,this.viewPath.setState(n,i.Affinity.Intrinsic)}else n=this.viewPath.value;if(this.viewCentroid.hasAffinity(i.Affinity.Intrinsic)){const t=this.geoCentroid.value,n=null!==t&&t.isDefined()?e.project(t):null;this.viewCentroid.setState(n,i.Affinity.Intrinsic)}this.viewBounds=null!==n?n.bounds:t.viewFrame,this.cullGeoFrame(t.geoViewport.geoFrame)}updateGeoBounds(){}get popoverFrame(){const t=this.pageTransform.inverse(),e=this.viewCentroid.value;if(null!==e&&e.isDefined()){const i=t.transformX(e.x,e.y),n=t.transformY(e.x,e.y);return new o.R2Box(i,n,i,n)}return this.viewBounds.transform(t)}ripple(t){return _l.ripple(this,t)}init(t){super.init(t),void 0!==t.geoPath&&this.geoPath(t.geoPath)}}u([i.Animator({type:d.GeoPath,value:null,willSetValue(t,e){this.owner.callObservers("viewWillSetGeoPath",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(null!==t?t.bounds:d.GeoBox.undefined()),this.mounted&&this.owner.projectPath(this.owner.viewContext),this.owner.callObservers("viewDidSetGeoPath",t,e,this.owner)}})],na.prototype,"geoPath",void 0),u([i.Animator({type:o.R2Path,value:null})],na.prototype,"viewPath",void 0),u([i.Animator({type:d.GeoPoint,value:null})],na.prototype,"geoCentroid",void 0),u([i.Animator({type:o.R2Point,value:null})],na.prototype,"viewCentroid",void 0);class oa extends na{onRender(t){super.onRender(t);const e=t.renderer;e instanceof ro&&!this.hidden&&!this.culled&&this.renderLine(e.context,t.viewFrame)}renderLine(t,e){const i=this.viewPath.value;if(null!==i&&i.isDefined()){const n=this.stroke.value,o=this.strokeWidth.value;if(null!==n&&null!==o){const s=t.lineWidth,r=t.strokeStyle;t.beginPath(),i.draw(t);const l=Math.min(e.width,e.height);t.lineWidth=o.pxValue(l),t.strokeStyle=n.toString(),t.stroke(),t.lineWidth=s,t.strokeStyle=r}}}hitTest(t,e,i){const n=i.renderer;if(n instanceof ho){const o=n.transform.transform(t,e);return this.hitTestLine(o.x,o.y,n.context,i.viewFrame)}return null}hitTestLine(t,e,i,n){const o=this.viewPath.value;if(null!==o&&o.isDefined()&&null!==this.stroke.value){const s=i.lineWidth;i.beginPath(),o.draw(i);let r=this.hitWidth.getValueOr(0);const l=this.strokeWidth.value;if(null!==l){const t=Math.min(n.width,n.height);r=Math.max(r,l.pxValue(t))}i.lineWidth=r;const a=i.isPointInStroke(t,e);if(i.lineWidth=s,a)return this}return null}init(t){super.init(t),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth),void 0!==t.hitWidth&&this.hitWidth(t.hitWidth)}}u([zt({type:B,value:null,inherits:!0,updateFlags:pn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetStroke",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetStroke",t,e,this.owner)}})],oa.prototype,"stroke",void 0),u([zt({type:o.Length,value:null,inherits:!0,updateFlags:pn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetStrokeWidth",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetStrokeWidth",t,e,this.owner)}})],oa.prototype,"strokeWidth",void 0),u([i.Property({type:Number})],oa.prototype,"hitWidth",void 0);class sa extends na{cullGeoFrame(t=this.geoFrame){let e;if(t.intersects(this.geoBounds)){const t=this.viewContext.viewFrame,i=this.viewBounds;e=!(!this.clipViewport.value||t.xMin-4*t.width<=i.xMin&&i.xMax<=t.xMax+4*t.width&&t.yMin-4*t.height<=i.yMin&&i.yMax<=t.yMax+4*t.height)||!t.intersects(i)}else e=!0;this.setCulled(e)}onRender(t){super.onRender(t);const e=t.renderer;e instanceof ro&&!this.hidden&&!this.culled&&this.renderArea(e.context,t.viewFrame)}renderArea(t,e){const i=this.viewPath.value;if(null!==i&&i.isDefined()){const n=t.fillStyle,o=t.lineWidth,s=t.strokeStyle;t.beginPath(),i.draw(t);const r=this.fill.value;null!==r&&(t.fillStyle=r.toString(),t.fill());const l=this.stroke.value,a=this.strokeWidth.value;if(null!==l&&null!==a){const i=Math.min(e.width,e.height);t.lineWidth=a.pxValue(i),t.strokeStyle=l.toString(),t.stroke()}t.fillStyle=n,t.lineWidth=o,t.strokeStyle=s}}hitTest(t,e,i){const n=i.renderer;if(n instanceof ho){const o=n.transform.transform(t,e);return this.hitTestArea(o.x,o.y,n.context,i.viewFrame)}return null}hitTestArea(t,e,i,n){const o=this.viewPath.value;if(null!==o&&o.isDefined()){if(i.beginPath(),o.draw(i),null!==this.fill.value&&i.isPointInPath(t,e))return this;if(null!==this.stroke.value){const o=this.strokeWidth.value;if(null!==o){const s=i.lineWidth,r=Math.min(n.width,n.height);i.lineWidth=o.pxValue(r);const l=i.isPointInStroke(t,e);if(i.lineWidth=s,l)return this}}}return null}init(t){super.init(t),void 0!==t.fill&&this.fill(t.fill),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth),void 0!==t.clipViewport&&this.clipViewport(t.clipViewport)}}u([zt({type:B,value:null,inherits:!0,updateFlags:pn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetFill",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetFill",t,e,this.owner)}})],sa.prototype,"fill",void 0),u([zt({type:B,value:null,inherits:!0,updateFlags:pn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetStroke",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetStroke",t,e,this.owner)}})],sa.prototype,"stroke",void 0),u([zt({type:o.Length,value:null,inherits:!0,updateFlags:pn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetStrokeWidth",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetStrokeWidth",t,e,this.owner)}})],sa.prototype,"strokeWidth",void 0),u([i.Property({type:Boolean,value:!0})],sa.prototype,"clipViewport",void 0);class ra extends Hl{get geoBounds(){const t=this.geoPath.value;return null!==t?t.bounds:d.GeoBox.undefined()}}u([i.Property({type:d.GeoPath,value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetGeoPath",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetGeoPath",t,e,this.owner)}})],ra.prototype,"geoPath",void 0);class la extends ra{}u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetStroke",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetStroke",t,e,this.owner)},fromAny:t=>(null===t||t instanceof St||(t=B.fromAny(t)),t)})],la.prototype,"stroke",void 0),u([i.Property({type:o.Length,value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetStrokeWidth",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetStrokeWidth",t,e,this.owner)}})],la.prototype,"strokeWidth",void 0);class aa extends ra{}u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetFill",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetFill",t,e,this.owner)},fromAny:t=>(null===t||t instanceof St||(t=B.fromAny(t)),t)})],aa.prototype,"fill",void 0),u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetStroke",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetStroke",t,e,this.owner)},fromAny:t=>(null===t||t instanceof St||(t=B.fromAny(t)),t)})],aa.prototype,"stroke",void 0),u([i.Property({type:o.Length,value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetStrokeWidth",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetStrokeWidth",t,e,this.owner)}})],aa.prototype,"strokeWidth",void 0);class ha extends jl{}class ca extends ha{setGeoPath(t,n,o){const s=this.geo.view;null!==s&&(void 0===o||!0===o?!0===(o=this.geoTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),s.geoPath.setState(t,o,i.Affinity.Intrinsic))}setStroke(t,n,o){const s=this.geo.view;null!==s&&(void 0===o||!0===o?!0===(o=this.geoTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),t instanceof St?s.stroke.setLook(t,o,i.Affinity.Intrinsic):s.stroke.setState(t,o,i.Affinity.Intrinsic))}setStrokeWidth(t,n,o){const s=this.geo.view;null!==s&&(void 0===o||!0===o?!0===(o=this.geoTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),s.strokeWidth.setState(t,o,i.Affinity.Intrinsic))}}u([$o({traitType:la,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachGeoTrait",t,this.owner)},didAttachTrait(t){if(null!==this.view){this.owner.setGeoPath(t.geoPath.value,t);const e=t.stroke.value;null!==e&&this.owner.setStroke(e,t);const i=t.strokeWidth.value;null!==i&&this.owner.setStrokeWidth(i,t)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachGeoTrait",t,this.owner)},traitDidSetGeoPath(t,e,i){this.owner.setGeoPath(t,i)},traitDidSetStroke(t,e,i){this.owner.setStroke(t,i)},traitDidSetStrokeWidth(t,e,i){this.owner.setStrokeWidth(t,i)},viewType:oa,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachGeoView",t,this.owner)},didAttachView(t){const e=this.trait;if(null!==e){this.owner.setGeoPath(e.geoPath.value,e);const t=e.stroke.value;null!==t&&this.owner.setStroke(t,e);const i=e.strokeWidth.value;null!==i&&this.owner.setStrokeWidth(i,e)}},didDetachView(t){this.owner.callObservers("controllerDidDetachGeoView",t,this.owner)},viewWillSetGeoPath(t,e){this.owner.callObservers("controllerWillSetGeoPath",t,e,this.owner)},viewDidSetGeoPath(t,e){this.owner.callObservers("controllerDidSetGeoPath",t,e,this.owner)},viewWillSetStroke(t,e){this.owner.callObservers("controllerWillSetStroke",t,e,this.owner)},viewDidSetStroke(t,e){this.owner.callObservers("controllerDidSetStroke",t,e,this.owner)},viewWillSetStrokeWidth(t,e){this.owner.callObservers("controllerWillSetStrokeWidth",t,e,this.owner)},viewDidSetStrokeWidth(t,e){this.owner.callObservers("controllerDidSetStrokeWidth",t,e,this.owner)}})],ca.prototype,"geo",void 0);class da extends ha{setGeoPath(t,n,o){const s=this.geo.view;null!==s&&(void 0===o||!0===o?!0===(o=this.geoTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),s.geoPath.setState(t,o,i.Affinity.Intrinsic))}setFill(t,n,o){const s=this.geo.view;null!==s&&(void 0===o||!0===o?!0===(o=this.geoTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),t instanceof St?s.fill.setLook(t,o,i.Affinity.Intrinsic):s.fill.setState(t,o,i.Affinity.Intrinsic))}setStroke(t,n,o){const s=this.geo.view;null!==s&&(void 0===o||!0===o?!0===(o=this.geoTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),t instanceof St?s.stroke.setLook(t,o,i.Affinity.Intrinsic):s.stroke.setState(t,o,i.Affinity.Intrinsic))}setStrokeWidth(t,n,o){const s=this.geo.view;null!==s&&(void 0===o||!0===o?!0===(o=this.geoTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),s.strokeWidth.setState(t,o,i.Affinity.Intrinsic))}}u([$o({traitType:aa,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachGeoTrait",t,this.owner)},didAttachTrait(t){if(null!==this.view){this.owner.setGeoPath(t.geoPath.value,t);const e=t.fill.value;null!==e&&this.owner.setFill(e,t);const i=t.stroke.value;null!==i&&this.owner.setStroke(i,t);const n=t.strokeWidth.value;null!==n&&this.owner.setStrokeWidth(n,t)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachGeoTrait",t,this.owner)},traitDidSetGeoPath(t,e,i){this.owner.setGeoPath(t,i)},traitDidSetFill(t,e,i){this.owner.setFill(t,i)},traitDidSetStroke(t,e,i){this.owner.setStroke(t,i)},traitDidSetStrokeWidth(t,e,i){this.owner.setStrokeWidth(t,i)},viewType:sa,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachGeoView",t,this.owner)},didAttachView(t){const e=this.trait;if(null!==e){this.owner.setGeoPath(e.geoPath.value,e);const t=e.fill.value;null!==t&&this.owner.setFill(t,e);const i=e.stroke.value;null!==i&&this.owner.setStroke(i,e);const n=e.strokeWidth.value;null!==n&&this.owner.setStrokeWidth(n,e)}},didDetachView(t){this.owner.callObservers("controllerDidDetachGeoView",t,this.owner)},viewWillSetGeoPath(t,e){this.owner.callObservers("controllerWillSetGeoPath",t,e,this.owner)},viewDidSetGeoPath(t,e){this.owner.callObservers("controllerDidSetGeoPath",t,e,this.owner)},viewWillSetFill(t,e){this.owner.callObservers("controllerWillSetFill",t,e,this.owner)},viewDidSetFill(t,e){this.owner.callObservers("controllerDidSetFill",t,e,this.owner)},viewWillSetStroke(t,e){this.owner.callObservers("controllerWillSetStroke",t,e,this.owner)},viewDidSetStroke(t,e){this.owner.callObservers("controllerDidSetStroke",t,e,this.owner)},viewWillSetStrokeWidth(t,e){this.owner.callObservers("controllerWillSetStrokeWidth",t,e,this.owner)},viewDidSetStrokeWidth(t,e){this.owner.callObservers("controllerDidSetStrokeWidth",t,e,this.owner)}})],da.prototype,"geo",void 0);class ua extends Gl{isGradientStop(){return null!==this.color.value||void 0!==this.opacity.value}setState(t,e){let i;i=t instanceof ua||t instanceof d.GeoPoint?t.toAny():d.GeoPoint.isTuple(t)?{lng:t[0],lat:t[1]}:t,void 0!==i.lng&&void 0!==i.lat?this.geoPoint(new d.GeoPoint(i.lng,i.lat),e):void 0!==i.x&&void 0!==i.y&&this.viewPoint(new o.R2Point(i.x,i.y),e),void 0!==i.radius&&this.radius(i.radius,e),void 0!==i.hitRadius&&this.hitRadius(i.hitRadius),void 0!==i.color&&this.color(i.color,e),void 0!==i.opacity&&this.opacity(i.opacity,e),void 0!==i.labelPadding&&this.labelPadding(i.labelPadding,e),void 0!==i.labelPlacement&&this.labelPlacement(i.labelPlacement),void 0!==i.font&&this.font(i.font,e),void 0!==i.textColor&&this.textColor(i.textColor,e),void 0!==i.label&&this.label(i.label)}needsProcess(t,e){return 0!=(t&pn.NeedsProject)&&null!==this.label.view&&this.requireUpdate(pn.NeedsLayout),t}onProject(t){if(super.onProject(t),this.viewPoint.hasAffinity(i.Affinity.Intrinsic)){const e=t.geoViewport.project(this.geoPoint.getValue());this.viewPoint.setInterpolatedValue(e,e)}}onLayout(t){super.onLayout(t);const e=this.label.view;null!==e&&this.layoutLabel(e,t.viewFrame)}layoutLabel(t,e){const n=this.labelPlacement.value,s=Math.min(e.width,e.height),r=this.labelPadding.getValue().pxValue(s),{x:l,y:a}=this.viewPoint.getValue();let h=a;"top"===n?h-=r:"bottom"===n&&(h+=r),bo.is(t)&&(t.textAlign.setState("center",i.Affinity.Intrinsic),t.textBaseline.setState("bottom",i.Affinity.Intrinsic),t.textOrigin.setState(new o.R2Point(l,h),i.Affinity.Intrinsic))}updateGeoBounds(){}get hitBounds(){const{x:t,y:e}=this.viewPoint.getValue(),i=this.hitRadius.getValueOr(0);return new o.R2Box(t-i,e-i,t+i,e+i)}hitTest(t,e,i){const n=i.renderer;return n instanceof ho?this.hitTestPoint(t,e,n.context,i.viewFrame):null}hitTestPoint(t,e,i,n){const{x:o,y:s}=this.viewPoint.getValue(),r=this.radius.value;let l=this.hitRadius.getValueOr(0);if(null!==r){const t=Math.min(n.width,n.height);l=Math.max(l,r.pxValue(t))}const a=o-t,h=s-e;return a*a+h*h<l*l?this:null}ripple(t){return _l.ripple(this,t)}toAny(){const t={};return t.lng=this.geoPoint.value.lng,t.lat=this.geoPoint.value.lat,this.viewPoint.hasAffinity(i.Affinity.Intrinsic)||(t.x=this.viewPoint.value.x,t.y=this.viewPoint.value.y),null!==this.radius.value&&(t.radius=this.radius.value),void 0!==this.hitRadius.value&&(t.hitRadius=this.hitRadius.value),null!==this.color.value&&(t.color=this.color.value),void 0!==this.opacity.value&&(t.opacity=this.opacity.value),null!==this.labelPadding.value&&(t.labelPadding=this.labelPadding.value),void 0!==this.labelPlacement.value&&(t.labelPlacement=this.labelPlacement.value),t}init(t){t instanceof d.GeoPoint||d.GeoPoint.isTuple(t)?this.setState(t):super.init(t)}}u([i.Animator({type:d.GeoPoint,value:d.GeoPoint.origin(),updateFlags:pn.NeedsProject,willSetValue(t,e){this.owner.callObservers("viewWillSetGeoPoint",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(t.bounds),this.owner.callObservers("viewDidSetGeoPoint",t,e,this.owner)}})],ua.prototype,"geoPoint",void 0),u([i.Animator({type:o.R2Point,value:o.R2Point.origin()})],ua.prototype,"viewPoint",void 0),u([zt({type:o.Length,value:null})],ua.prototype,"radius",void 0),u([zt({type:B,value:null})],ua.prototype,"color",void 0),u([zt({type:Number})],ua.prototype,"opacity",void 0),u([zt({type:o.Length,value:null})],ua.prototype,"labelPadding",void 0),u([zt({type:O,value:null,inherits:!0})],ua.prototype,"font",void 0),u([zt({type:B,value:null,inherits:!0})],ua.prototype,"textColor",void 0),u([i.Property({type:Number})],ua.prototype,"hitRadius",void 0),u([gn({key:!0,type:So,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachGeoLabel",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachGeoLabel",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof So?(this.view.text(t),this.view):So.fromAny(t):io.fromAny(t)}})],ua.prototype,"label",void 0),u([i.Property({type:String,value:"auto"})],ua.prototype,"labelPlacement",void 0),Object.defineProperty(ua.prototype,"viewBounds",{get(){const{x:t,y:e}=this.viewPoint.getValue();return new o.R2Box(t,e,t,e)},configurable:!0});class pa extends Gl{constructor(){super(),this.gradientStops=0,Object.defineProperty(this,"viewBounds",{value:o.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}points(t,e){let n;if(void 0===t){const t=[];for(n=this.firstChild;null!==n;)n instanceof ua&&t.push(n),n=n.nextSibling;return t}{const e=this.geoBounds;let o=1/0,s=1/0,r=-1/0,l=-1/0,a=0,h=0,c=!1,u=0;for(n=this.firstChild;null!==n&&u<t.length;)if(n instanceof ua){const e=t[u];n.setState(e);const{lng:i,lat:d}=n.geoPoint.getValue();a+=i,h+=d,o=Math.min(o,i),s=Math.min(s,d),r=Math.max(i,r),l=Math.max(d,l),c=c||!isFinite(i)||!isFinite(d),u+=1}for(;u<t.length;){const e=ua.fromAny(t[u]);this.appendChild(e);const{lng:i,lat:n}=e.geoPoint.getValue();a+=i,h+=n,o=Math.min(o,i),s=Math.min(s,n),r=Math.max(i,r),l=Math.max(n,l),c=c||!isFinite(i)||!isFinite(n),u+=1}for(;null!==n;){const t=n.nextSibling;n instanceof ua&&this.removeChild(n),n=t}c||0===u?(this.geoCentroid.setValue(d.GeoPoint.origin(),i.Affinity.Intrinsic),this.geoBounds=d.GeoBox.undefined()):(a/=u,h/=u,this.geoCentroid.setValue(new d.GeoPoint(a,h),i.Affinity.Intrinsic),this.geoBounds=new d.GeoBox(o,s,r,l));const p=this.geoBounds;return e.equals(p)||(this.willSetGeoBounds(p,e),this.onSetGeoBounds(p,e),this.didSetGeoBounds(p,e)),this}}appendPoint(t,e){return t=ua.fromAny(t),this.appendChild(t,e),t}setPoint(t,e){return e=ua.fromAny(e),this.setChild(t,e),e}onInsertChild(t,e){super.onInsertChild(t,e),t instanceof ua&&this.onInsertPoint(t)}onInsertPoint(t){t.requireUpdate(pn.NeedsAnimate|pn.NeedsProject)}didProject(t){const e=this.geoBounds;let n=1/0,s=1/0,r=-1/0,l=-1/0,a=0,h=0,c=1/0,u=1/0,p=-1/0,f=-1/0,g=0,v=0,w=!1,y=0,m=0,b=this.firstChild;for(;null!==b;){if(b instanceof ua){const{lng:t,lat:e}=b.geoPoint.getValue();a+=t,h+=e,n=Math.min(n,t),s=Math.min(s,e),r=Math.max(t,r),l=Math.max(e,l),w=w||!isFinite(t)||!isFinite(e);const{x:i,y:o}=b.viewPoint.getValue();c=Math.min(c,i),u=Math.min(u,o),p=Math.max(i,p),f=Math.max(o,f),g+=i,v+=o,w=w||!isFinite(i)||!isFinite(o),b.isGradientStop()&&(y+=1),m+=1}b=b.nextSibling}w||0===m?(this.geoCentroid.setValue(d.GeoPoint.origin(),i.Affinity.Intrinsic),this.geoBounds=d.GeoBox.undefined(),this.viewCentroid.setValue(o.R2Point.origin(),i.Affinity.Intrinsic),this.viewBounds=o.R2Box.undefined(),this.setCulled(!0)):(a/=m,h/=m,this.geoCentroid.setValue(new d.GeoPoint(a,h),i.Affinity.Intrinsic),this.geoBounds=new d.GeoBox(n,s,r,l),g/=m,v/=m,this.viewCentroid.setValue(new o.R2Point(g,v),i.Affinity.Intrinsic),this.viewBounds=new o.R2Box(c,u,p,f),this.cullGeoFrame(t.geoViewport.geoFrame)),this.gradientStops=y;const C=this.geoBounds;e.equals(C)||(this.willSetGeoBounds(C,e),this.onSetGeoBounds(C,e),this.didSetGeoBounds(C,e)),super.didProject(t)}onRender(t){super.onRender(t);const e=t.renderer;e instanceof ro&&!this.hidden&&!this.culled&&(0!==this.gradientStops&&e instanceof ho?this.renderPlotGradient(e.context,t.viewFrame):this.renderPlotStroke(e.context,t.viewFrame))}renderPlotStroke(t,e){const i=this.stroke.value;if(null!==i){let n=0;t.beginPath();let o=this.firstChild;for(;null!==o;){if(o instanceof ua){const{x:e,y:i}=o.viewPoint.getValue();0===n?t.moveTo(e,i):t.lineTo(e,i),n+=1}o=o.nextSibling}if(0!==n){const n=t.lineWidth,o=t.strokeStyle,s=Math.min(e.width,e.height),r=this.strokeWidth.getValue().pxValue(s);t.lineWidth=r,t.strokeStyle=i.toString(),t.stroke(),t.lineWidth=n,t.strokeStyle=o}}}renderPlotGradient(t,e){const i=this.stroke.getValue(),n=Math.min(e.width,e.height),o=this.strokeWidth.getValue().pxValue(n),s=t.lineWidth,r=t.strokeStyle;let l,a=this.firstChild;for(;null!==a;){if(a instanceof ua){if(void 0!==l){const e=l.viewPoint.getValue().x,n=l.viewPoint.getValue().y,s=a.viewPoint.getValue().x,r=a.viewPoint.getValue().y,h=t.createLinearGradient(e,n,s,r);let c=l.color.getValueOr(i),d=l.opacity.value;"number"==typeof d&&(c=c.alpha(d)),h.addColorStop(0,c.toString()),c=a.color.getValueOr(i),d=a.opacity.value,"number"==typeof d&&(c=c.alpha(d)),h.addColorStop(1,c.toString()),t.beginPath(),t.moveTo(e,n),t.lineTo(s,r),t.lineWidth=o,t.strokeStyle=h,t.stroke()}l=a}a=a.nextSibling}t.lineWidth=s,t.strokeStyle=r}updateGeoBounds(){}get popoverFrame(){const t=this.viewCentroid.value,e=this.pageTransform.inverse(),i=e.transformX(t.x,t.y),n=e.transformY(t.x,t.y);return new o.R2Box(i,n,i,n)}hitTest(t,e,i){const n=i.renderer;if(n instanceof ho){const o=n.transform.transform(t,e);return this.hitTestPlot(o.x,o.y,n.context,i.viewFrame)}return null}hitTestPlot(t,e,i,n){let o=0;i.beginPath();let s=this.firstChild;for(;null!==s;){if(s instanceof ua){const{x:t,y:e}=s.viewPoint.getValue();0===o?i.moveTo(t,e):i.lineTo(t,e),o+=1}s=s.nextSibling}if(0!==o){const o=i.lineWidth;let s=this.hitWidth.getValueOr(0);const r=this.strokeWidth.value;if(null!==r){const t=Math.min(n.width,n.height);s=Math.max(s,r.pxValue(t))}i.lineWidth=s;const l=i.isPointInStroke(t,e);if(i.lineWidth=o,l)return this}return null}ripple(t){return _l.ripple(this,t)}init(t){super.init(t),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth),void 0!==t.hitWidth&&this.hitWidth(t.hitWidth),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor);const e=t.points;void 0!==e&&this.points(e)}}u([i.Property({type:d.GeoPoint,value:d.GeoPoint.origin()})],pa.prototype,"geoCentroid",void 0),u([i.Property({type:o.R2Point,value:o.R2Point.origin()})],pa.prototype,"viewCentroid",void 0),u([zt({type:B,value:null,inherits:!0,updateFlags:pn.NeedsRender})],pa.prototype,"stroke",void 0),u([zt({type:o.Length,value:null,inherits:!0,updateFlags:pn.NeedsRender})],pa.prototype,"strokeWidth",void 0),u([zt({type:O,value:null,inherits:!0})],pa.prototype,"font",void 0),u([zt({type:B,value:null,inherits:!0})],pa.prototype,"textColor",void 0),u([i.Property({type:Number})],pa.prototype,"hitWidth",void 0);class fa extends Gl{constructor(){super(),this.sprite=null,Object.defineProperty(this,"viewBounds",{value:o.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),!this.graphics.inherited){const o=this.graphics.value;if(o instanceof xo){const s=o.withTheme(t,e);this.graphics.setState(s,!!o.isThemed()&&n,i.Affinity.Reflexive)}}}onProject(t){super.onProject(t),this.projectIcon(t)}projectGeoCenter(t){if(this.mounted){const e=this.viewContext,i=null!==t&&t.isDefined()?e.geoViewport.project(t):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectIcon(e)}}projectIcon(t){if(i.Affinity.Intrinsic>=(this.viewCenter.flags&i.Affinity.Mask)){const e=this.geoCenter.value,i=null!==e&&e.isDefined()?t.geoViewport.project(e):null;this.viewCenter.value=i}const e=t.viewFrame;this.viewBounds=this.deriveViewBounds(e);const n=this.viewCenter.value,s=this.viewCenter.state;null!==n&&null!==s&&(e.intersectsBox(this.viewBounds)||e.intersectsSegment(new o.R2Segment(n.x,n.y,s.x,s.y)))?this.setCulled(!1):this.setCulled(!0)}onRasterize(t){super.onRasterize(t),this.hidden||this.culled||this.rasterizeIcon(this.viewBounds)}rasterizeIcon(t){let e=this.sprite;const i=this.graphics.value;if(null!==i&&t.isDefined()){const n=t.width,s=t.height;null!==e&&(e.width<n||e.height<s||n<e.width/2&&s<e.height/2)&&(this.sprite=null,e.release(),e=null),null===e&&(e=this.spriteProvider.service.acquireSprite(n,s),this.sprite=e);const r=e.getRenderer(),l=r.context;l.clearRect(0,0,e.width,e.height),l.beginPath(),i.render(r,new o.R2Box(0,0,n,s))}else null!==e&&(this.sprite=null,e.release())}onComposite(t){super.onComposite(t);const e=t.renderer;e instanceof ho&&!this.hidden&&!this.culled&&this.compositeIcon(e,this.viewBounds)}compositeIcon(t,e){const i=this.sprite;null!==i&&i.draw(t.context,e)}renderGeoBounds(t,e,i){}updateGeoBounds(){}deriveViewBounds(t){const e=this.viewCenter.value;if(null!==e&&e.isDefined()){void 0===t&&(t=this.viewContext.viewFrame);const i=Math.min(t.width,t.height);let n=this.iconWidth.value;n=n instanceof o.Length?n.pxValue(i):i;let s=this.iconHeight.value;s=s instanceof o.Length?s.pxValue(i):i;const r=e.x-n*this.xAlign.value,l=e.y-s*this.yAlign.value;return new o.R2Box(r,l,r+n,l+s)}return o.R2Box.undefined()}get popoverFrame(){const t=this.viewCenter.value;if(null!==t&&t.isDefined()){const e=this.viewContext.viewFrame,i=Math.min(e.width,e.height),n=this.pageTransform.inverse(),s=n.transformX(t.x,t.y),r=n.transformY(t.x,t.y);let l=this.iconWidth.value;l=l instanceof o.Length?l.pxValue(i):i;let a=this.iconHeight.value;a=a instanceof o.Length?a.pxValue(i):i;const h=s-l*this.xAlign.getValue(),c=r-a*this.yAlign.getValue();return new o.R2Box(h,c,h+l,c+a)}return this.pageBounds}hitTest(t,e,i){const n=i.renderer;return n instanceof ho?this.hitTestIcon(t,e,n,this.viewBounds):null}hitTestIcon(t,e,i,n){return this.hitBounds.contains(t,e)?this:null}ripple(t){return _l.ripple(this,t)}onUnmount(){super.onUnmount();const t=this.sprite;null!==t&&(this.sprite=null,t.release())}init(t){super.init(t),Ro.init(this,t),void 0!==t.geoCenter&&this.geoCenter(t.geoCenter),void 0!==t.viewCenter&&this.viewCenter(t.viewCenter)}}fa.MountFlags=Gl.MountFlags|pn.NeedsRasterize,fa.UncullFlags=Gl.UncullFlags|pn.NeedsRasterize,u([i.Animator({type:d.GeoPoint,value:null,didSetState(t,e){this.owner.projectGeoCenter(t)},willSetValue(t,e){this.owner.callObservers("viewWillSetGeoCenter",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(null!==t?t.bounds:d.GeoBox.undefined()),this.mounted&&this.owner.projectIcon(this.owner.viewContext),this.owner.callObservers("viewDidSetGeoCenter",t,e,this.owner)}})],fa.prototype,"geoCenter",void 0),u([i.Animator({type:o.R2Point,value:o.R2Point.undefined(),updateFlags:pn.NeedsComposite})],fa.prototype,"viewCenter",void 0),u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsProject|pn.NeedsRender|pn.NeedsRasterize|pn.NeedsComposite})],fa.prototype,"xAlign",void 0),u([i.Animator({type:Number,value:.5,updateFlags:pn.NeedsProject|pn.NeedsRender|pn.NeedsRasterize|pn.NeedsComposite})],fa.prototype,"yAlign",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsProject|pn.NeedsRender|pn.NeedsRasterize|pn.NeedsComposite})],fa.prototype,"iconWidth",void 0),u([zt({type:o.Length,value:null,updateFlags:pn.NeedsProject|pn.NeedsRender|pn.NeedsRasterize|pn.NeedsComposite})],fa.prototype,"iconHeight",void 0),u([zt({type:B,value:null,updateFlags:pn.NeedsRender|pn.NeedsRasterize|pn.NeedsComposite,didSetValue(t,e){if(null!==t){const e=this.owner.graphics.value;if(e instanceof To){const n=e.withFillColor(t);this.owner.graphics.setState(n,i.Affinity.Reflexive)}}}})],fa.prototype,"iconColor",void 0),u([zt({extends:Oo,type:Object,updateFlags:pn.NeedsRender|pn.NeedsRasterize|pn.NeedsComposite,willSetValue(t,e){this.owner.callObservers("viewWillSetGraphics",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetGraphics",t,e,this.owner)}})],fa.prototype,"graphics",void 0);class ga extends Hl{get geoBounds(){const t=this.geoCenter.value;return null!==t?t.bounds:d.GeoBox.undefined()}}u([i.Property({type:d.GeoPoint,value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetGeoCenter",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetGeoCenter",t,e,this.owner)}})],ga.prototype,"geoCenter",void 0),u([i.Property({type:Ao,value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetIconLayout",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetIconLayout",t,e,this.owner)}})],ga.prototype,"iconLayout",void 0),u([i.Property({value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetGraphics",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetGraphics",t,e,this.owner)}})],ga.prototype,"graphics",void 0);class va extends jl{setGeoCenter(t,n,o){const s=this.geo.view;null!==s&&(void 0===o||!0===o?!0===(o=this.geoTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),s.geoCenter.setState(t,o,i.Affinity.Intrinsic))}setIconLayout(t,n,o){const s=this.geo.view;null!==s&&null!==t&&(void 0===o||!0===o?!0===(o=this.geoTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),s.iconWidth.setState(t.iconWidth,o,i.Affinity.Intrinsic),s.iconHeight.setState(t.iconHeight,o,i.Affinity.Intrinsic),void 0!==t.xAlign&&s.xAlign.setState(t.xAlign,o,i.Affinity.Intrinsic),void 0!==t.yAlign&&s.yAlign.setState(t.yAlign,o,i.Affinity.Intrinsic))}setGraphics(t,n,o){const s=this.geo.view;null!==s&&(void 0===o||!0===o?!0===(o=this.geoTiming.value)&&(o=s.getLook(St.timing,Ot.ambient)):o=e.Timing.fromAny(o),s.graphics.setState(t,o,i.Affinity.Intrinsic))}}u([$o({traitType:ga,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachGeoTrait",t,this.owner)},didAttachTrait(t){null!==this.view&&(this.owner.setGeoCenter(t.geoCenter.value,t),this.owner.setIconLayout(t.iconLayout.value,t),this.owner.setGraphics(t.graphics.value,t))},didDetachTrait(t){this.owner.callObservers("controllerDidDetachGeoTrait",t,this.owner)},traitDidSetGeoCenter(t,e,i){this.owner.setGeoCenter(t,i)},traitDidSetIconLayout(t,e,i){this.owner.setIconLayout(t,i)},traitDidSetGraphics(t,e,i){this.owner.setGraphics(t,i)},viewType:fa,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachGeoView",t,this.owner)},didAttachView(t){const e=this.trait;null!==e&&(this.owner.setGeoCenter(e.geoCenter.value,e),this.owner.setIconLayout(e.iconLayout.value,e),this.owner.setGraphics(e.graphics.value,e))},didDetachView(t){this.owner.callObservers("controllerDidDetachGeoView",t,this.owner)},viewWillSetGeoCenter(t,e){this.owner.callObservers("controllerWillSetGeoCenter",t,e,this.owner)},viewDidSetGeoCenter(t,e){this.owner.callObservers("controllerDidSetGeoCenter",t,e,this.owner)},viewWillSetGraphics(t,e){this.owner.callObservers("controllerWillSetGraphics",t,e,this.owner)},viewDidSetGraphics(t,e){this.owner.callObservers("controllerDidSetGraphics",t,e,this.owner)}})],va.prototype,"geo",void 0);class wa extends Gl{needsProcess(t,e){return 0!=(t&pn.NeedsResize)&&(t|=pn.NeedsProject),t}extendViewContext(t){const e=Object.create(t);return e.geoViewport=this.geoViewport,e}get geoFrame(){return this.geoViewport.geoFrame}}u([gn({type:uo,willAttachView(t){this.owner.callObservers("viewWillAttachMapCanvas",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachMapCanvas",t,this.owner)}})],wa.prototype,"canvas",void 0),u([gn({type:Xn,willAttachView(t){this.owner.callObservers("viewWillAttachMapContainer",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachMapContainer",t,this.owner)}})],wa.prototype,"container",void 0);class ya extends Hl{get geoBounds(){return d.GeoBox.globe()}startConsumingLayers(){const t=this.layers.traits;for(const e in t){t[e].consume(this)}}stopConsumingLayers(){const t=this.layers.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingLayers()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingLayers()}}u([i.Property({type:zl,value:null,willSetValue(t,e){this.owner.callObservers("traitWillSetGeoPerspective",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("traitDidSetGeoPerspective",t,e,this.owner)}})],ya.prototype,"geoPerspective",void 0),u([T({type:Hl,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachLayer",t,e,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachLayer",t,this.owner)},detectModel:t=>t.getTrait(Hl),detectTrait:t=>null})],ya.prototype,"layers",void 0);class ma extends Zo{setGeoPerspective(t){if(null!==t){const e=this.map.view;null!==e&&e.moveTo(t)}}}u([$o({traitType:ya,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachMapTrait",t,this.owner)},didAttachTrait(t){null!==this.view&&this.owner.setGeoPerspective(t.geoPerspective.value);const e=t.layers.traits;for(const t in e){const i=e[t];this.owner.layers.addTraitController(i)}},willDetachTrait(t){const e=t.layers.traits;for(const t in e){const i=e[t];this.owner.layers.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachMapTrait",t,this.owner)},traitDidSetGeoPerspective(t,e){this.owner.setGeoPerspective(t)},traitWillAttachLayer(t,e){this.owner.layers.addTraitController(t,e)},traitDidDetachLayer(t){this.owner.layers.deleteTraitController(t)},viewType:wa,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachMapView",t,this.owner)},didAttachView(t){this.owner.canvas.setView(t.canvas.view),this.owner.container.setView(t.container.view);const e=this.trait;null!==e&&this.owner.setGeoPerspective(e.geoPerspective.value);const i=this.owner.layers.controllers;for(const e in i){const n=i[e],o=n.geo.view;null!==o&&null===o.parent&&n.geo.insertView(t)}},willDetachView(t){this.owner.canvas.setView(null),this.owner.container.setView(null)},didDetachView(t){this.owner.callObservers("controllerDidDetachMapView",t,this.owner)},viewWillSetGeoViewport(t,e){this.owner.callObservers("controllerWillSetGeoViewport",t,e,this.owner)},viewDidSetGeoViewport(t,e){this.owner.callObservers("controllerDidSetGeoViewport",t,e,this.owner)},viewWillAttachMapCanvas(t){this.owner.canvas.setView(t)},viewDidDetachMapCanvas(t){this.owner.canvas.setView(null)},viewWillAttachMapContainer(t){this.owner.container.setView(t)},viewDidDetachMapContainer(t){this.owner.container.setView(null)}})],ma.prototype,"map",void 0),u([gn({type:uo,willAttachView(t){this.owner.callObservers("controllerWillAttachMapCanvasView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachMapCanvasView",t,this.owner)}})],ma.prototype,"canvas",void 0),u([gn({type:Xn,willAttachView(t){this.owner.callObservers("controllerWillAttachMapContainerView",t,this.owner)},didAttachView(t){const e=this.owner.createMapView(t);e.container.setView(t),this.owner.map.setView(e)},didDetachView(t){this.owner.callObservers("controllerDidDetachMapContainerView",t,this.owner)}})],ma.prototype,"container",void 0),u([i.Property({type:e.Timing,value:!0})],ma.prototype,"geoTiming",void 0),u([ns({implements:!0,type:jl,binds:!0,observes:!0,get parentView(){return this.owner.map.view},getTraitViewRef:t=>t.geo,willAttachController(t){this.owner.callObservers("controllerWillAttachLayer",t,this.owner)},didAttachController(t){const e=t.geo.trait;null!==e&&this.attachLayerTrait(e,t);const i=t.geo.view;null!==i&&this.attachLayerView(i,t)},willDetachController(t){const e=t.geo.view;null!==e&&this.detachLayerView(e,t);const i=t.geo.trait;null!==i&&this.detachLayerTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachLayer",t,this.owner)},controllerWillAttachGeoTrait(t,e){this.owner.callObservers("controllerWillAttachLayerTrait",t,e,this.owner),this.attachLayerTrait(t,e)},controllerDidDetachGeoTrait(t,e){this.detachLayerTrait(t,e),this.owner.callObservers("controllerDidDetachLayerTrait",t,e,this.owner)},attachLayerTrait(t,e){},detachLayerTrait(t,e){},controllerWillAttachGeoView(t,e){this.owner.callObservers("controllerWillAttachLayerView",t,e,this.owner),this.attachLayerView(t,e)},controllerDidDetachGeoView(t,e){this.detachLayerView(t,e),this.owner.callObservers("controllerDidDetachLayerView",t,e,this.owner)},attachLayerView(t,e){},detachLayerView(t,e){t.remove()},controllerWillSetGeoBounds(t,e,i){this.owner.callObservers("controllerWillSetLayerGeoBounds",t,e,i,this.owner)},controllerDidSetGeoBounds(t,e,i){this.owner.callObservers("controllerDidSetLayerGeoBounds",t,e,i,this.owner)},createController(t){return void 0!==t?jl.fromTrait(t):ns.prototype.createController.call(this)}})],ma.prototype,"layers",void 0);class ba{get geoFrame(){return d.GeoBox.globe()}get geoCenter(){return d.GeoPoint.origin()}get zoom(){return 0}get heading(){return 0}get tilt(){return 0}canEqual(t){return t instanceof ba&&this.constructor===t.constructor}equals(t){return this===t||t instanceof ba&&(t.canEqual(this)&&this.viewFrame.equals(t.viewFrame))}}class Ca extends ba{constructor(t){super(),this.viewFrame=t}withViewFrame(t){let e=t.xMin,i=t.yMin,n=t.xMax,s=t.yMax;const r=n-e,l=s-i,a=r/l;if(a<2){const a=(l-r/2)/2;i+=a,s-=a,t=new o.R2Box(e,i,n,s)}else if(a>2){const a=(r-2*l)/2;e+=a,n-=a,t=new o.R2Box(e,i,n,s)}return new Ca(t)}project(t,e){1===arguments.length&&(Array.isArray(t)?(e=t[1],t=t[0]):(e=t.lat,t=t.lng));const i=this.viewFrame,n=i.xMin+(180+t)/360*i.width,s=i.yMax-(90+e)/180*i.height;return new o.R2Point(n,s)}unproject(t,e){1===arguments.length&&(Array.isArray(t)?(e=t[1],t=t[0]):(e=t.y,t=t.x));const i=this.viewFrame,n=360*(t-i.xMin)/i.width-180,o=180*(i.yMax-e)/i.height-90;return new d.GeoPoint(n,o)}}class Sa extends wa{constructor(t){super(),Object.defineProperty(this,"geoViewport",{value:t,writable:!0,enumerable:!0,configurable:!0})}willSetGeoViewport(t,e){this.callObservers("viewWillSetGeoViewport",t,e,this)}onSetGeoViewport(t,e){}didSetGeoViewport(t,e){this.callObservers("viewDidSetGeoViewport",t,e,this)}updateGeoViewport(){const t=this.geoViewport,e=t.withViewFrame(this.viewFrame);return!e.equals(t)&&(this.willSetGeoViewport(e,t),this.geoViewport=e,this.onSetGeoViewport(e,t),this.didSetGeoViewport(e,t),!0)}willProcess(t,e){0!=(t&pn.NeedsProject)&&(this.updateGeoViewport(),e.geoViewport=this.geoViewport),super.willProcess(t,e)}moveTo(t,e){}static create(t){return void 0===t&&(t=new Ca(o.R2Box.undefined())),new Sa(t)}}u([gn({extends:!0,didAttachView(t,e){null===this.owner.parent&&t.appendChild(this.owner),wa.canvas.prototype.didAttachView.call(this,t,e)},willDetachView(t){wa.canvas.prototype.willDetachView.call(this,t),this.owner.parent===t&&t.removeChild(this.owner)}})],Sa.prototype,"canvas",void 0),u([gn({extends:!0,didAttachView(t,e){this.owner.canvas.insertView(t),wa.container.prototype.didAttachView.call(this,t,e)},willDetachView(t){wa.container.prototype.willDetachView.call(this,t);const e=this.owner.canvas.view;null!==e&&e.parent===t&&t.removeChild(e)}})],Sa.prototype,"container",void 0);class Aa{constructor(t,e,i,n,o,s){this.map=t,this.geoFrame=e,this.geoCenter=i,this.zoom=n,this.heading=o,this.tilt=s}project(t,e){let i;i="number"==typeof t?new mapboxgl.LngLat(t,e):t;const n=this.map.project(i);return new o.R2Point(n.x,n.y)}unproject(t,e){let i;i="number"==typeof t?new mapboxgl.Point(t,e):Array.isArray(t)?t:new mapboxgl.Point(t.x,t.y);const n=this.map.unproject(i);return new d.GeoPoint(n.lng,n.lat)}equals(t){return this===t||t instanceof Aa&&(this.map===t.map&&this.geoFrame.equals(t.geoFrame)&&this.geoCenter.equals(t.geoCenter)&&this.zoom===t.zoom&&this.heading===t.heading&&this.tilt===t.tilt)}static create(t){const e=t.getBounds(),i=new d.GeoBox(e.getWest(),e.getSouth(),e.getEast(),e.getNorth()),n=t.getCenter(),o=new d.GeoPoint(n.lng,n.lat),s=t.getZoom(),r=t.getBearing(),l=t.getPitch();return new Aa(t,i,o,s,r,l)}}class xa extends wa{constructor(t){super(),this.map=t,Object.defineProperty(this,"geoViewport",{value:Aa.create(t),writable:!0,enumerable:!0,configurable:!0}),this.onMapRender=this.onMapRender.bind(this),this.onMoveStart=this.onMoveStart.bind(this),this.onMoveEnd=this.onMoveEnd.bind(this),this.initMap(t)}initMap(t){t.on("render",this.onMapRender),t.on("movestart",this.onMoveStart),t.on("moveend",this.onMoveEnd)}willSetGeoViewport(t,e){this.callObservers("viewWillSetGeoViewport",t,e,this)}onSetGeoViewport(t,e){}didSetGeoViewport(t,e){this.callObservers("viewDidSetGeoViewport",t,e,this)}updateGeoViewport(){const t=this.geoViewport,e=Aa.create(this.map);return!e.equals(t)&&(this.willSetGeoViewport(e,t),this.geoViewport=e,this.onSetGeoViewport(e,t),this.didSetGeoViewport(e,t),!0)}onMapRender(){if(this.updateGeoViewport()){const t=!this.hidden&&!this.culled;this.requireUpdate(pn.NeedsProject,t)}}onMoveStart(){this.willMoveMap()}onMoveEnd(){this.didMoveMap()}moveTo(t,i){const n={},o=this.geoViewport;let s=t.geoCenter;null!=s&&(s=d.GeoPoint.fromAny(s),o.geoCenter.equivalentTo(s,1e-5)||(n.center=s));const r=t.zoom;void 0===r||e.Equivalent(o.zoom,r,1e-5)||(n.zoom=r);const l=t.heading;void 0===l||e.Equivalent(o.heading,l,1e-5)||(n.bearing=l);const a=t.tilt;void 0===a||e.Equivalent(o.tilt,a,1e-5)||(n.pitch=a),(i=void 0===i||!0===i?this.getLookOr(St.timing,Ot.ambient,!1):e.Timing.fromAny(i))instanceof e.Timing&&(n.duration=i.duration),this.map.flyTo(n)}willMoveMap(){this.callObservers("viewWillMoveMap",this)}didMoveMap(){this.callObservers("viewDidMoveMap",this)}}u([gn({extends:!0,didAttachView(t,e){null===this.owner.parent&&(t.appendChild(this.owner),t.setEventNode(this.owner.map.getCanvasContainer())),wa.canvas.prototype.didAttachView.call(this,t,e)},willDetachView(t){wa.canvas.prototype.willDetachView.call(this,t),this.owner.parent===t&&t.removeChild(this.owner)}})],xa.prototype,"canvas",void 0),u([gn({extends:!0,didAttachView(t,e){Xn.fromNode(this.owner.map.getContainer());const i=Xn.fromNode(this.owner.map.getCanvasContainer());this.owner.canvas.insertView(i),wa.container.prototype.didAttachView.call(this,t,e)},willDetachView(t){wa.container.prototype.willDetachView.call(this,t);const e=this.owner.canvas.view,i=Xn.fromNode(this.owner.map.getCanvasContainer());null!==e&&e.parent===i&&i.removeChild(t)}})],xa.prototype,"container",void 0);class Ta{constructor(t,e,i,n,o,s,r){this.map=t,this.geoFrame=e,this.geoCenter=i,this.viewOrigin=n,this.zoom=o,this.heading=s,this.tilt=r}project(t,e){const i=this.viewOrigin;let n;n="number"==typeof t?new L.LatLng(e,t):Array.isArray(t)?new L.LatLng(t[1],t[0]):t;const s=this.map.project(n,this.zoom);return new o.R2Point(s.x-i.x,s.y-i.y)}unproject(t,e){const i=this.viewOrigin;let n;n="number"==typeof t?new L.Point(t+i.x,e+i.y):Array.isArray(t)?new L.Point(t[0]+i.x,t[1]+i.y):new L.Point(t.x+i.x,t.y+i.y);const o=this.map.unproject(n,this.zoom);return new d.GeoPoint(o.lng,o.lat)}equals(t){return this===t||t instanceof Ta&&(this.map===t.map&&this.geoFrame.equals(t.geoFrame)&&this.geoCenter.equals(t.geoCenter)&&this.viewOrigin.equals(t.viewOrigin)&&this.zoom===t.zoom&&this.heading===t.heading&&this.tilt===t.tilt)}static create(t){const e=t.getBounds(),i=new d.GeoBox(e.getWest(),e.getSouth(),e.getEast(),e.getNorth()),n=t.getCenter(),s=new d.GeoPoint(n.lng,n.lat);let{x:r,y:l}=t.getPixelOrigin();try{const e=o.Transform.parse(t.getPane("mapPane").style.transform);e instanceof o.TranslateTransform&&(r-=e.x.pxValue(),l-=e.y.pxValue())}catch(t){}const a=new o.R2Point(r,l),h=t.getZoom();return new Ta(t,i,s,a,h,0,0)}}class Da extends wa{constructor(t){super(),this.map=t,Object.defineProperty(this,"geoViewport",{value:Ta.create(t),writable:!0,enumerable:!0,configurable:!0}),this.onMapRender=this.onMapRender.bind(this),this.onMoveStart=this.onMoveStart.bind(this),this.onMoveEnd=this.onMoveEnd.bind(this),this.initMap(t)}initMap(t){t.on("move",this.onMapRender),t.on("movestart",this.onMoveStart),t.on("moveend",this.onMoveEnd)}willSetGeoViewport(t,e){this.callObservers("viewWillSetGeoViewport",t,e,this)}onSetGeoViewport(t,e){}didSetGeoViewport(t,e){this.callObservers("viewDidSetGeoViewport",t,e,this)}updateGeoViewport(){const t=this.geoViewport,e=Ta.create(this.map);return!e.equals(t)&&(this.willSetGeoViewport(e,t),this.geoViewport=e,this.onSetGeoViewport(e,t),this.didSetGeoViewport(e,t),!0)}onMapRender(){if(this.updateGeoViewport()){const t=!this.hidden&&!this.culled;this.requireUpdate(pn.NeedsProject,t)}}onMoveStart(){this.willMoveMap()}onMoveEnd(){this.didMoveMap()}moveTo(t,i){const n={},o=this.geoViewport;let s=t.geoCenter;s=null!=s?d.GeoPoint.fromAny(s):o.geoCenter;const r=t.zoom;(i=void 0===i||!0===i?this.getLookOr(St.timing,Ot.ambient,!1):e.Timing.fromAny(i))instanceof e.Timing&&(n.animate=!0,n.duration=i.duration),this.map.flyTo(s,r,n)}willMoveMap(){this.callObservers("viewWillMoveMap",this)}didMoveMap(){this.callObservers("viewDidMoveMap",this)}}u([gn({extends:!0,didAttachView(t,e){null===this.owner.parent&&t.appendChild(this.owner),wa.canvas.prototype.didAttachView.call(this,t,e)},willDetachView(t){wa.canvas.prototype.willDetachView.call(this,t),this.owner.parent===t&&t.removeChild(this.owner)}})],Da.prototype,"canvas",void 0),u([gn({extends:!0,didAttachView(t,e){const n=Xn.fromNode(t.node.querySelector(".leaflet-control-container")),o=this.owner.canvas.insertView(t,void 0,n);null!==o&&o.zIndex.setState(500,i.Affinity.Intrinsic),wa.container.prototype.didAttachView.call(this,t,e)},willDetachView(t){wa.container.prototype.willDetachView.call(this,t);const e=this.owner.canvas.view;null!==e&&e.parent===t&&t.removeChild(t)}})],Da.prototype,"container",void 0);class Va{constructor(t,e,i,n,o,s){this.projection=t,this.geoFrame=e,this.geoCenter=i,this.zoom=n,this.heading=o,this.tilt=s}project(t,e){const i=this.projection;if(null!==i){let n;n="number"==typeof t?new google.maps.LatLng(e,t):Array.isArray(t)?new google.maps.LatLng(t[1],t[0]):new google.maps.LatLng(t.lat,t.lng);const s=i.fromLatLngToContainerPixel(n);if(null!==s)return new o.R2Point(s.x,s.y)}return o.R2Point.undefined()}unproject(t,e){const i=this.projection;if(null!==i){let n;n="number"==typeof t?new google.maps.Point(t,e):Array.isArray(t)?new google.maps.Point(t[0],t[1]):new google.maps.Point(t.x,t.y);const o=i.fromContainerPixelToLatLng(n);if(null!==o)return new d.GeoPoint(o.lng(),o.lat())}return d.GeoPoint.undefined()}equals(t){return this===t||t instanceof Va&&(this.projection===t.projection&&this.geoFrame.equals(t.geoFrame)&&this.geoCenter.equals(t.geoCenter)&&this.zoom===t.zoom&&this.heading===t.heading&&this.tilt===t.tilt)}static create(t,e){void 0===e&&(e=null);const i=t.getBounds();let n;if(null!=i){const t=i.getSouthWest(),e=i.getNorthEast();n=new d.GeoBox(t.lng(),t.lat(),e.lng(),e.lat())}else n=d.GeoBox.undefined();const o=t.getCenter(),s=void 0!==o?new d.GeoPoint(o.lng(),o.lat()):d.GeoPoint.origin();let r=t.getZoom();void 0===r&&(r=0);let l=t.getHeading();void 0===l&&(l=0);let a=t.getTilt();return void 0===a&&(a=0),new Va(e,n,s,r,l,a)}}class Pa extends wa{constructor(t){super(),this.map=t,this.mapOverlay=this.createMapOverlay(t),Object.defineProperty(this,"geoViewport",{value:Va.create(this.map,this.mapOverlay.getProjection()),writable:!0,enumerable:!0,configurable:!0}),this.onMapDraw=this.onMapDraw.bind(this),this.onMapIdle=this.onMapIdle.bind(this),this.initMap(t)}initMap(t){t.addListener("idle",this.onMapIdle)}createMapOverlay(t){const e=new Pa.MapOverlay(this);return e.setMap(t),e}static get MapOverlay(){return class extends google.maps.OverlayView{constructor(t){super(),this.owner=t}onAdd(){const t=this.owner.container.view;null!==t&&this.owner.container.materializeView(t)}onRemove(){this.owner.canvas.removeView()}draw(){this.owner.onMapDraw()}}}willSetGeoViewport(t,e){this.callObservers("viewWillSetGeoViewport",t,e,this)}onSetGeoViewport(t,e){}didSetGeoViewport(t,e){this.callObservers("viewDidSetGeoViewport",t,e,this)}updateGeoViewport(){const t=this.geoViewport,e=Va.create(this.map,this.mapOverlay.getProjection());return!e.equals(t)&&(this.willSetGeoViewport(e,t),this.geoViewport=e,this.onSetGeoViewport(e,t),this.didSetGeoViewport(e,t),!0)}willProcess(t,e){0!=(this.flags&pn.NeedsProject)&&this.updateGeoViewport()&&(e.geoViewport=this.geoViewport),super.willProcess(t,e)}onMapDraw(){if(this.updateGeoViewport()){const t=!this.hidden&&!this.culled;this.requireUpdate(pn.NeedsProject,t)}}onMapIdle(){this.requireUpdate(pn.NeedsProject)}moveTo(t,i){const n=this.geoViewport;let o=t.geoCenter;null!=o&&(o=d.GeoPoint.fromAny(o),n.geoCenter.equivalentTo(o,1e-5)||this.map.panTo(o));const s=t.zoom;void 0===s||e.Equivalent(n.zoom,s,1e-5)||this.map.setZoom(s);const r=t.heading;void 0===r||e.Equivalent(n.heading,r,1e-5)||this.map.setHeading(r);const l=t.tilt;void 0===l||e.Equivalent(n.tilt,l,1e-5)||this.map.setTilt(l)}}u([gn({extends:!0,didAttachView(t,e){null===this.owner.parent&&t.appendChild(this.owner),wa.canvas.prototype.didAttachView.call(this,t,e)},willDetachView(t){wa.canvas.prototype.willDetachView.call(this,t),this.owner.parent===t&&t.removeChild(this.owner)}})],Pa.prototype,"canvas",void 0),u([gn({extends:!0,implements:!0,materializeView(t){const e=this.owner.mapOverlay.getPanes();if(null!=e){!function t(e){const i=e.parentNode;return i instanceof HTMLElement&&void 0===i.view&&t(i),Xn.fromNode(e)}(e.overlayMouseTarget);const t=e.overlayMouseTarget.view.parent.parent;this.owner.canvas.insertView(t)}else null===this.owner.canvas.view&&this.owner.canvas.attachView()},didAttachView(t,e){this.materializeView(t),wa.container.prototype.didAttachView.call(this,t,e)},willDetachView(t){wa.container.prototype.willDetachView.call(this,t);const e=this.owner.canvas.view,i=this.owner.mapOverlay.getPanes();if(null!=i){const n=i.overlayMouseTarget.view.parent.parent;null!==e&&e.parent===n&&n.removeChild(t)}}})],Pa.prototype,"container",void 0),u([e.Lazy],Pa,"MapOverlay",null);class Ia{constructor(t,e,i,n,o,s){this.map=t,this.geoFrame=e,this.geoCenter=i,this.zoom=n,this.heading=o,this.tilt=s}equals(t){return this===t||t instanceof Ia&&(this.map===t.map&&this.geoFrame.equals(t.geoFrame)&&this.geoCenter.equals(t.geoCenter)&&this.zoom===t.zoom&&this.heading===t.heading&&this.tilt===t.tilt)}static init(){void 0===Ia.webMercatorUtils&&window.require(["esri/geometry/support/webMercatorUtils"],(function(t){Ia.webMercatorUtils=t}))}}Ia.webMercatorUtils=void 0;class Ma extends wa{constructor(){super(),Ia.init()}}class La extends Ia{constructor(t,e,i,n,o,s){super(t,e,i,n,o,s)}project(t,e){let i;i="number"==typeof t?{x:t,y:e,spatialReference:{wkid:4326}}:Array.isArray(t)?{x:t[0],y:t[1],spatialReference:{wkid:4326}}:{x:t.lng,y:t.lat,spatialReference:{wkid:4326}};const n=this.map.toScreen(i);return null!==n?new o.R2Point(n.x,n.y):o.R2Point.origin()}unproject(t,e){let i;i="number"==typeof t?{x:t,y:e}:Array.isArray(t)?{x:t[0],y:t[1]}:t;const n=this.map.toMap(i);return null!==n?new d.GeoPoint(n.longitude,n.latitude):d.GeoPoint.origin()}static create(t){let e,i=t.extent;null!==i?(i=Ia.webMercatorUtils.webMercatorToGeographic(i),e=new d.GeoBox(i.xmin,i.ymin,i.xmax,i.ymax)):e=d.GeoBox.undefined();const n=t.center,o=new d.GeoPoint(n.longitude,n.latitude),s=t.zoom,r=t.rotation;return new La(t,e,o,s,r,0)}}class ka extends Ma{constructor(t){super(),this.map=t,Object.defineProperty(this,"geoViewport",{value:La.create(t),writable:!0,enumerable:!0,configurable:!0}),this.onMapRender=this.onMapRender.bind(this),this.initMap(t)}initMap(t){t.watch("extent",this.onMapRender)}willSetGeoViewport(t,e){this.callObservers("viewWillSetGeoViewport",t,e,this)}onSetGeoViewport(t,e){}didSetGeoViewport(t,e){this.callObservers("viewDidSetGeoViewport",t,e,this)}updateGeoViewport(){const t=this.geoViewport,e=La.create(this.map);return!e.equals(t)&&(this.willSetGeoViewport(e,t),this.geoViewport=e,this.onSetGeoViewport(e,t),this.didSetGeoViewport(e,t),!0)}onMapRender(){if(this.updateGeoViewport()){const t=!this.hidden&&!this.culled;this.requireUpdate(pn.NeedsProject,t)}}moveTo(t,i){const n={},o={},s=this.geoViewport;let r=t.geoCenter;null!=r&&(r=d.GeoPoint.fromAny(r),s.geoCenter.equivalentTo(r,1e-5)||(n.center=[r.lng,r.lat]));const l=t.zoom;void 0===l||e.Equivalent(s.zoom,l,1e-5)||(n.zoom=l);const a=t.heading;void 0===a||e.Equivalent(s.heading,a,1e-5)||(n.heading=a);const h=t.tilt;void 0===h||e.Equivalent(s.tilt,h,1e-5)||(n.tilt=h),(i=void 0===i||!0===i?this.getLookOr(St.timing,Ot.ambient,!1):e.Timing.fromAny(i))instanceof e.Timing&&(o.duration=i.duration),this.map.goTo(n,o)}}u([gn({extends:!0,didAttachView(t,e){null===this.owner.parent&&(t.appendChild(this.owner),t.setEventNode(this.owner.map.container.querySelector(".esri-view-root"))),Ma.canvas.prototype.didAttachView.call(this,t,e)},willDetachView(t){Ma.canvas.prototype.willDetachView.call(this,t),this.owner.parent===t&&t.removeChild(this.owner)}})],ka.prototype,"canvas",void 0),u([gn({extends:!0,didAttachView(t,e){const i=Xn.fromNode(this.owner.map.container),n=Xn.fromNode(i.node.querySelector(".esri-view-root")),o=Xn.fromNode(n.node.querySelector(".esri-overlay-surface"));this.owner.canvas.insertView(o),Ma.container.prototype.didAttachView.call(this,t,e)},willDetachView(t){Ma.container.prototype.willDetachView.call(this,t);const e=this.owner.canvas.view,i=Xn.fromNode(this.owner.map.container),n=Xn.fromNode(i.node.querySelector(".esri-view-root")),o=Xn.fromNode(n.node.querySelector(".esri-overlay-surface"));null!==e&&e.parent===o&&o.removeChild(t)}})],ka.prototype,"container",void 0);class Fa extends Ia{constructor(t,e,i,n,o,s){super(t,e,i,n,o,s)}project(t,e){let i;i="number"==typeof t?{x:t,y:e,spatialReference:{wkid:4326}}:Array.isArray(t)?{x:t[0],y:t[1],spatialReference:{wkid:4326}}:{x:t.lng,y:t.lat,spatialReference:{wkid:4326}};const n=this.map.toScreen(i);return null!==n?new o.R2Point(n.x,n.y):o.R2Point.origin()}unproject(t,e){let i;i="number"==typeof t?{x:t,y:e}:Array.isArray(t)?{x:t[0],y:t[1]}:t;const n=this.map.toMap(i);return null!==n?new d.GeoPoint(n.longitude,n.latitude):d.GeoPoint.origin()}static create(t){let e,i=t.extent;null!==i?(i=Ia.webMercatorUtils.webMercatorToGeographic(i),e=new d.GeoBox(i.xmin,i.ymin,i.xmax,i.ymax)):e=d.GeoBox.undefined();const n=t.center,o=new d.GeoPoint(n.longitude,n.latitude),s=t.zoom,r=t.camera.heading,l=t.camera.tilt;return new Fa(t,e,o,s,r,l)}}class Ra extends Ma{constructor(t){super(),this.map=t,Object.defineProperty(this,"geoViewport",{value:Fa.create(t),writable:!0,enumerable:!0,configurable:!0}),this.onMapRender=this.onMapRender.bind(this),this.initMap(t)}initMap(t){t.watch("extent",this.onMapRender)}willSetGeoViewport(t,e){this.callObservers("viewWillSetGeoViewport",t,e,this)}onSetGeoViewport(t,e){}didSetGeoViewport(t,e){this.callObservers("viewDidSetGeoViewport",t,e,this)}updateGeoViewport(){const t=this.geoViewport,e=Fa.create(this.map);return!e.equals(t)&&(this.willSetGeoViewport(e,t),this.geoViewport=e,this.onSetGeoViewport(e,t),this.didSetGeoViewport(e,t),!0)}onMapRender(){if(this.updateGeoViewport()){const t=!this.hidden&&!this.culled;this.requireUpdate(pn.NeedsProject,t)}}moveTo(t,i){const n={},o={},s=this.geoViewport;let r=t.geoCenter;null!=r&&(r=d.GeoPoint.fromAny(r),s.geoCenter.equivalentTo(r,1e-5)||(n.center=[r.lng,r.lat]));const l=t.zoom;void 0===l||e.Equivalent(s.zoom,l,1e-5)||(n.zoom=l);const a=t.heading;void 0===a||e.Equivalent(s.heading,a,1e-5)||(n.heading=a);const h=t.tilt;void 0===h||e.Equivalent(s.tilt,h,1e-5)||(n.tilt=h),(i=void 0===i||!0===i?this.getLookOr(St.timing,Ot.ambient,!1):e.Timing.fromAny(i))instanceof e.Timing&&(o.duration=i.duration),this.map.goTo(n,o)}}u([gn({extends:!0,didAttachView(t,e){null===this.owner.parent&&(t.appendChild(this.owner),t.setEventNode(this.owner.map.container.querySelector(".esri-view-root"))),Ma.canvas.prototype.didAttachView.call(this,t,e)},willDetachView(t){Ma.canvas.prototype.willDetachView.call(this,t),this.owner.parent===t&&t.removeChild(this.owner)}})],Ra.prototype,"canvas",void 0),u([gn({extends:!0,didAttachView(t,e){const i=Xn.fromNode(this.owner.map.container),n=Xn.fromNode(i.node.querySelector(".esri-view-root")),o=Xn.fromNode(n.node.querySelector(".esri-view-surface"));this.owner.canvas.insertView(o),Ma.container.prototype.didAttachView.call(this,t,e)},willDetachView(t){Ma.container.prototype.willDetachView.call(this,t);const e=this.owner.canvas.view,i=Xn.fromNode(this.owner.map.container),n=Xn.fromNode(i.node.querySelector(".esri-view-root")),o=Xn.fromNode(n.node.querySelector(".esri-view-surface"));null!==e&&e.parent===o&&o.removeChild(t)}})],Ra.prototype,"container",void 0),t.AngleThemeAnimator=jt,t.Arc=yo,t.ArcView=mo,t.AreaPlotController=Yr,t.AreaPlotTrait=Ur,t.AreaPlotView=Rr,t.AttributeAnimator=mn,t.AxisController=Fl,t.AxisTrait=Pl,t.AxisView=Al,t.BooleanAttributeAnimator=Sn,t.BooleanThemeAnimator=Ht,t.BottomAxisController=Wl,t.BottomAxisTrait=Ll,t.BottomAxisView=Dl,t.BottomTickView=Cl,t.BoxShadow=st,t.BoxShadowForm=lt,t.BoxShadowInterpolator=rt,t.BoxShadowParser=at,t.BoxShadowStyleAnimator=kn,t.BrightnessFeel=Ft,t.BubblePlotController=Hr,t.BubblePlotTrait=Nr,t.BubblePlotView=kr,t.ButtonGlow=os,t.ButtonItem=ls,t.ButtonMembrane=ss,t.ButtonStack=as,t.CanvasRenderer=ho,t.CanvasView=uo,t.CellController=Ss,t.CellTrait=ms,t.CellView=gs,t.ChartController=Ul,t.ChartTrait=Bl,t.ChartView=Nl,t.CircleIcon=Po,t.CircleIconInterpolator=Io,t.ColController=Fs,t.ColLayout=ps,t.ColTrait=ks,t.ColView=Ls,t.Color=B,t.ColorAttributeAnimator=xn,t.ColorChannel=q,t.ColorChannelParser=G,t.ColorForm=U,t.ColorLook=Tt,t.ColorParser=z,t.ColorStop=Q,t.ColorStopInterpolator=J,t.ColorStopListParser=tt,t.ColorStopParser=$,t.ColorStyleAnimator=Mn,t.ColorThemeAnimator=Kt,t.ContinuousScaleAnimator=Tr,t.Controller=Zo,t.ControllerContext=Bo,t.ControllerRef=Qo,t.ControllerRelation=_o,t.ControllerSet=Jo,t.CssContext=Bn,t.CssRule=Un,t.DataPointController=Ar,t.DataPointTrait=Cr,t.DataPointView=br,t.DataSetController=xr,t.DataSetTrait=Sr,t.DeckBar=er,t.DeckButton=_s,t.DeckButtonBackIcon=Js,t.DeckButtonCloseIcon=Qs,t.DeckButtonLabel=$s,t.DeckCard=ir,t.DeckPost=Hs,t.DeckRail=js,t.DeckSlider=Xs,t.DeckSliderItem=Ks,t.DeckSlot=Ys,t.DeckView=nr,t.DeckViewBar=or,t.DeckViewCard=sr,t.DialController=cr,t.DialTrait=hr,t.DialView=ar,t.DisclosureButton=cs,t.DisclosureCellView=ys,t.DisplayProvider=zi,t.DisplayService=Ui,t.DomProvider=yn,t.DomService=wn,t.DownlinkTrait=V,t.DrawerButton=Gs,t.DrawerView=qs,t.DrawingRenderer=no,t.ElementView=Yn,t.EnclosedIcon=ko,t.EnclosedIconInterpolator=Fo,t.EphemeralStorageService=Xo,t.EquirectangularMapViewport=Ca,t.EsriMapView=ka,t.EsriMapViewport=La,t.EsriSceneView=Ra,t.EsriSceneViewport=Fa,t.EsriView=Ma,t.EsriViewport=Ia,t.ExecuteProvider=zo,t.ExecuteService=Uo,t.Expansion=ft,t.ExpansionInterpolator=pt,t.ExpansionThemeAnimator=Jt,t.Feel=Mt,t.FeelVector=It,t.FeelVectorInterpolator=Lt,t.FillView=fo,t.FilledIcon=To,t.FloatingButton=rs,t.Focus=ct,t.FocusInterpolator=ht,t.FocusThemeAnimator=_t,t.Font=O,t.FontFamily=F,t.FontFamilyParser=R,t.FontFamilyStyleAnimator=Ln,t.FontForm=E,t.FontInterpolator=W,t.FontLook=Dt,t.FontParser=N,t.FontSize=M,t.FontThemeAnimator=Zt,t.GaugeController=pr,t.GaugeTrait=ur,t.GaugeView=dr,t.GeoArcView=ia,t.GeoAreaController=da,t.GeoAreaTrait=aa,t.GeoAreaView=sa,t.GeoCircleView=ea,t.GeoController=jl,t.GeoGridController=ta,t.GeoGridTrait=$l,t.GeoGridView=Jl,t.GeoIconController=va,t.GeoIconTrait=ga,t.GeoIconView=fa,t.GeoLayerController=Zl,t.GeoLayerTrait=Yl,t.GeoLineController=ca,t.GeoLineTrait=la,t.GeoLineView=oa,t.GeoPathController=ha,t.GeoPathTrait=ra,t.GeoPathView=na,t.GeoPerspective=zl,t.GeoPlotView=pa,t.GeoPointView=ua,t.GeoRasterView=Ql,t.GeoRippleView=_l,t.GeoTrait=Hl,t.GeoTree=Xl,t.GeoTreeView=Kl,t.GeoView=Gl,t.GeoViewport=ql,t.Gesture=_i,t.GestureInput=Zi,t.GoogleMapView=Pa,t.GoogleMapViewport=Va,t.GraphController=Zr,t.GraphTrait=Kr,t.GraphView=Xr,t.GraphicsIconView=Wo,t.GraphicsRenderer=eo,t.GraphicsView=io,t.HeaderController=Ws,t.HeaderTrait=Os,t.HeaderView=Rs,t.HexColorParser=Y,t.HistoryProvider=Ho,t.HistoryService=Go,t.HistoryState=qo,t.HslColor=K,t.HslColorInterpolator=Z,t.HslColorParser=_,t.HtmlIconView=No,t.HtmlView=Xn,t.HtmlViewTagFactory=Kn,t.Icon=xo,t.IconButton=hs,t.IconCellController=xs,t.IconCellTrait=Cs,t.IconCellView=ws,t.IconGraphicsAnimator=Oo,t.IconLayout=Ao,t.IconView=Ro,t.InputTokenView=us,t.InterpolatedFeel=kt,t.LayoutProvider=Gi,t.LayoutService=qi,t.LeafController=Vs,t.LeafTrait=Ds,t.LeafView=Ts,t.LeafletView=Da,t.LeafletViewport=Ta,t.LeftAxisController=El,t.LeftAxisTrait=kl,t.LeftAxisView=Vl,t.LeftTickView=Sl,t.LengthAttributeAnimator=An,t.LengthLook=xt,t.LengthStyleAnimator=In,t.LengthStyleConstraintAnimator=Wn,t.LengthThemeAnimator=Yt,t.LengthThemeConstraintAnimator=ee,t.LineHeight=k,t.LinePlotController=jr,t.LinePlotTrait=Br,t.LinePlotView=Fr,t.LinearGradient=et,t.LinearGradientAngleParser=nt,t.LinearGradientInterpolator=it,t.LinearGradientParser=ot,t.Look=St,t.LookVector=Ct,t.MapController=ma,t.MapDownlinkTrait=I,t.MapTrait=ya,t.MapView=wa,t.MapboxView=xa,t.MapboxViewport=Aa,t.MediaRule=qn,t.Modal=Yi,t.ModalProvider=Ki,t.ModalService=Xi,t.Model=y,t.ModelContext=p,t.ModelRef=b,t.ModelRelation=m,t.ModelSet=C,t.MomentumGesture=on,t.MomentumGestureInput=nn,t.Mood=Ot,t.MoodMatrix=Et,t.MoodVector=Wt,t.MouseMomentumGesture=ln,t.MousePositionGesture=en,t.MouseScaleGesture=un,t.NodeView=Hn,t.NumberAttributeAnimator=Cn,t.NumberLook=At,t.NumberStyleAnimator=Pn,t.NumberStyleConstraintAnimator=On,t.NumberThemeAnimator=Gt,t.NumberThemeConstraintAnimator=te,t.NumberTickGenerator=gl,t.OpacityFeel=Rt,t.PaintingRenderer=ro,t.PathContext=oo,t.PathRenderer=so,t.PieController=mr,t.PieTrait=yr,t.PieView=wr,t.PlotController=zr,t.PlotTrait=Or,t.PointerMomentumGesture=sn,t.PointerPositionGesture=$i,t.PointerScaleGesture=cn,t.PolygonIcon=Mo,t.PolygonIconInterpolator=Lo,t.PopoverView=zs,t.PositionGesture=Ji,t.PositionGestureInput=Qi,t.Presence=ut,t.PresenceInterpolator=dt,t.PresenceThemeAnimator=Qt,t.RasterView=po,t.Rect=vo,t.RectView=wo,t.RefreshProvider=g,t.RefreshService=f,t.RgbColor=H,t.RgbColorInterpolator=j,t.RgbColorParser=X,t.RightAxisController=Ol,t.RightAxisTrait=Ml,t.RightAxisView=Tl,t.RightTickView=bl,t.RowController=Ms,t.RowTrait=Is,t.RowView=Ps,t.ScaleGesture=hn,t.ScaleGestureInput=an,t.ScaledView=Ir,t.ScaledXView=Dr,t.ScaledXYView=Pr,t.ScaledYView=Vr,t.ScatterPlotController=qr,t.ScatterPlotTrait=Wr,t.ScatterPlotView=Mr,t.ScrimView=Us,t.SelectableTrait=D,t.SelectionProvider=w,t.SelectionService=v,t.SeriesPlotController=Gr,t.SeriesPlotTrait=Er,t.SeriesPlotView=Lr,t.ShadowLook=Vt,t.SliceController=vr,t.SliceTrait=gr,t.SliceView=fr,t.Sprite=Jn,t.SpriteService=to,t.SpriteSheet=$n,t.StorageProvider=Ko,t.StorageService=jo,t.StringAttributeAnimator=bn,t.StringStyleAnimator=Vn,t.StringThemeAnimator=qt,t.StrokeView=go,t.StyleAnimator=Dn,t.StyleConstraintAnimator=Rn,t.StyleContext=En,t.StyleMap=Nn,t.StyleRule=zn,t.StyleSheet=Gn,t.StyleValue=gt,t.StyleValueForm=vt,t.StyleValueParser=wt,t.StyleView=Zn,t.SvgContext=lo,t.SvgIconView=Eo,t.SvgRenderer=ao,t.SvgView=_n,t.SvgViewTagFactory=Qn,t.TableController=Bs,t.TableLayout=fs,t.TableTrait=Ns,t.TableView=Es,t.TextCellController=As,t.TextCellTrait=bs,t.TextCellView=vs,t.TextRun=Co,t.TextRunView=So,t.TextView=jn,t.Theme=Nt,t.ThemeAnimator=zt,t.ThemeConstraintAnimator=$t,t.ThemeContext=Ut,t.ThemeMatrix=Bt,t.ThemeProvider=ji,t.ThemeService=Hi,t.TickGenerator=fl,t.TickView=yl,t.TimeTickGenerator=vl,t.TimingLook=Pt,t.TitleDeckBar=lr,t.TitleDeckView=class extends nr{constructor(t){super(t),this.initBar()}initBar(){let t=this.bar.view;t instanceof lr||(t=lr.create(),this.bar.setView(t))}willPushCard(t,e){super.willPushCard(t,e);const n=this.bar.view;if(n instanceof lr){n.pushTitle(t.cardTitle.getValueOr(""));const e=n.backMembrane.view;null!==e&&e.pointerEvents.setState("none",i.Affinity.Intrinsic)}}didPushCard(t,e){const n=this.bar.view;if(n instanceof lr){const t=n.backMembrane.view;null!==t&&t.pointerEvents.setState("auto",i.Affinity.Intrinsic)}super.didPushCard(t,e)}willPopCard(t,e){super.willPopCard(t,e);const i=this.bar.view;i instanceof lr&&i.popTitle()}didPressBackButton(t){this.deckPhase.tweening||this.popCard(),super.didPressBackButton(t)}},t.ToAttributeString=yt,t.ToCssValue=bt,t.ToStyleString=mt,t.TokenView=ds,t.TopAxisController=Rl,t.TopAxisTrait=Il,t.TopAxisView=xl,t.TopTickView=ml,t.TouchMomentumGesture=rn,t.TouchPositionGesture=tn,t.TouchScaleGesture=dn,t.Trait=S,t.TraitControllerRef=ts,t.TraitControllerSet=es,t.TraitRef=x,t.TraitRelation=A,t.TraitSet=T,t.TraitViewControllerRef=is,t.TraitViewControllerSet=ns,t.TraitViewRef=$o,t.TransformAttributeAnimator=Tn,t.TransformStyleAnimator=Fn,t.TransformThemeAnimator=Xt,t.TypesetView=bo,t.ValueDownlinkTrait=P,t.VectorIcon=Do,t.VectorIconInterpolator=Vo,t.View=pn,t.ViewContext=Ei,t.ViewRef=gn,t.ViewRelation=fn,t.ViewSet=vn,t.Viewport=Wi,t.ViewportProvider=Bi,t.ViewportService=Ni,t.WebGLRenderer=co,t.WebStorageService=Yo,t.WorldMapView=Sa,t.WorldMapViewport=ba,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=swim-toolkit.min.js.map
