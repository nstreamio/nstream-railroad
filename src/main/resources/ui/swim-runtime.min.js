// @swim/runtime v4.0.0-dev.20210927.1 (c) 2015-2021 Swim.inc
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("os"),require("ws")):"function"==typeof define&&define.amd?define(["exports","os","ws"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).swim=e.swim||{},e.os,e.ws)}(this,(function(e,t,r){"use strict";function i(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}const n=function(){const e={};return"undefined"!=typeof window&&void 0!==window.crypto?e.fillBytes=function(e){window.crypto.getRandomValues(e)}:"undefined"!=typeof window&&void 0!==window.msCrypto?e.fillBytes=function(e){window.msCrypto.getRandomValues(e)}:e.fillBytes=function(e){if(e instanceof Int8Array)for(let t=0;t<e.length;t+=1)e[t]=128-Math.round(256*Math.random());else if(e instanceof Uint8Array)for(let t=0;t<e.length;t+=1)e[t]=Math.round(256*Math.random());else if(e instanceof Int16Array)for(let t=0;t<e.length;t+=1)e[t]=32768-Math.round(65536*Math.random());else if(e instanceof Uint16Array)for(let t=0;t<e.length;t+=1)e[t]=Math.round(65536*Math.random());else if(e instanceof Int32Array)for(let t=0;t<e.length;t+=1)e[t]=2147483648-Math.round(4294967296*Math.random());else{if(!(e instanceof Uint32Array))throw new TypeError(""+e);for(let t=0;t<e.length;t+=1)e[t]=Math.round(4294967296*Math.random())}},e}(),s=function(){const e={};return Object.defineProperty(e,"BigEndian",{value:"BE",enumerable:!0}),Object.defineProperty(e,"LittleEndian",{value:"LE",enumerable:!0}),Object.defineProperty(e,"NativeOrder",{get(){let t;const r=new ArrayBuffer(2);new Uint16Array(r)[0]=65279;const i=new Uint8Array(r);if(254===i[0]&&255===i[1])t=e.BigEndian;else{if(255!==i[0]||254!==i[1])throw new Error;t=e.LittleEndian}return Object.defineProperty(e,"NativeOrder",{value:t,enumerable:!0}),t},configurable:!0,enumerable:!0}),e}(),o=function(){const e={mix:function(t,r){return r=3432918353*(65535&r)+((3432918353*(r>>>16)&65535)<<16)&4294967295,t^=r=461845907*(65535&(r=e.rotl(r,15)))+((461845907*(r>>>16)&65535)<<16)&4294967295,t=27492+(65535&(t=5*(65535&(t=e.rotl(t,13)))+((5*(t>>>16)&65535)<<16)&4294967295))+((58964+(t>>>16)&65535)<<16)},mixUint8Array:function(t,r){if(s.NativeOrder===s.BigEndian)return e.mixUint8ArrayBE(t,r);if(s.NativeOrder===s.LittleEndian)return e.mixUInt8ArrayLE(t,r);throw new Error},mixUint8ArrayBE:function(t,r){let i=0;const n=r.length;for(;i+3<n;){const n=(255&r[i])<<24|(255&r[i+1])<<16|(255&r[i+2])<<8|255&r[i+3];t=e.mix(t,n),i+=4}if(i<n){let s=(255&r[i])<<24;i+1<n&&(s|=(255&r[i+1])<<16,i+2<n&&(s|=(255&r[i+2])<<8)),s=3432918353*(65535&s)+((3432918353*(s>>>16)&65535)<<16)&4294967295,s=e.rotl(s,15),s=461845907*(65535&s)+((461845907*(s>>>16)&65535)<<16)&4294967295,t^=s}return t^n},mixUInt8ArrayLE:function(t,r){let i=0;const n=r.length;for(;i+3<n;){const n=255&r[i]|(255&r[i+1])<<8|(255&r[i+2])<<16|(255&r[i+3])<<24;t=e.mix(t,n),i+=4}if(i<n){let s=255&r[i];i+1<n&&(s|=(255&r[i+1])<<8,i+2<n&&(s|=(255&r[i+2])<<16)),s=3432918353*(65535&s)+((3432918353*(s>>>16)&65535)<<16)&4294967295,s=e.rotl(s,15),s=461845907*(65535&s)+((461845907*(s>>>16)&65535)<<16)&4294967295,t^=s}return t^n},mixString:function(t,r){if(s.NativeOrder===s.BigEndian)return e.mixStringBE(t,r);if(s.NativeOrder===s.LittleEndian)return e.mixStringLE(t,r);throw new Error},mixStringBE:function(t,r){let i=0,n=32,s=0;const o=r.length;let a=0;for(;s<o;){let o=r.codePointAt(s);void 0===o&&(o=r.charCodeAt(s)),o>=0&&o<=127?(n-=8,i|=o<<n,0===n&&(t=e.mix(t,i),i=0,n=32),a+=1):o>=128&&o<=2047?(n-=8,i|=(192|o>>>6)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=(128|63&o)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),a+=2):o>=2048&&o<=65535||o>=57344&&o<=65535?(n-=8,i|=(224|o>>>12)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=(128|o>>>6&63)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=(128|63&o)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),a+=3):o>=65536&&o<=1114111?(n-=8,i|=(240|o>>>18)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=(128|o>>>12&63)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=(128|o>>>6&63)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=(128|63&o)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),a+=4):(n-=8,i|=239<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=191<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=189<<n,0===n&&(t=e.mix(t,i),i=0,n=32),a+=3),s=d.offsetByCodePoints(r,s,1)}return 32!==n&&(i=3432918353*(65535&i)+((3432918353*(i>>>16)&65535)<<16)&4294967295,i=e.rotl(i,15),i=461845907*(65535&i)+((461845907*(i>>>16)&65535)<<16)&4294967295,t^=i),t^a},mixStringLE:function(t,r){let i=0,n=0,s=0;const o=r.length;let a=0;for(;s<o;){let o=r.codePointAt(s);void 0===o&&(o=r.charCodeAt(s)),o>=0&&o<=127?(i|=o<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),a+=1):o>=128&&o<=2047?(i|=(192|o>>>6)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=(128|63&o)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),a+=2):o>=2048&&o<=65535||o>=57344&&o<=65535?(i|=(224|o>>>12)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=(128|o>>>6&63)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=(128|63&o)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),a+=3):o>=65536&&o<=1114111?(i|=(240|o>>>18)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=(128|o>>>12&63)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=(128|o>>>6&63)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=(128|63&o)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),a+=4):(i|=239<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=191<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=189<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),a+=3),s=d.offsetByCodePoints(r,s,1)}return 32!==n&&(i=3432918353*(65535&i)+((3432918353*(i>>>16)&65535)<<16)&4294967295,i=e.rotl(i,15),i=461845907*(65535&i)+((461845907*(i>>>16)&65535)<<16)&4294967295,t^=i),t^a},mash:function(e){return e=2246822507*(65535&(e^=e>>>16))+((2246822507*(e>>>16)&65535)<<16)&4294967295,e=3266489909*(65535&(e^=e>>>13))+((3266489909*(e>>>16)&65535)<<16)&4294967295,(e^=e>>>16)>>>0},rotl:function(e,t){return e<<t|e>>>32-t}};return e}(),a=function(e,t,r){const i=r.writable,n=r.enumerable,s=r.configurable;if(void 0!==r.get){const o=r.get;r.get=function(){const r=o.call(this);return Object.defineProperty(e,t,{value:r,writable:i,enumerable:n,configurable:s}),r}}else{if(void 0===r.value)throw new Error("invalid lazy property descriptor");{const o=r.value;r.value=function(){const r=o.call(this);return Object.defineProperty(e,t,{value:function(){return r},writable:i,enumerable:n,configurable:s}),r}}}},u=function(){const e={compare:function(t,r){if("object"==typeof t&&null!==t){if("object"==typeof r&&null!==r){const i=e.hash(t),n=e.hash(r);return i<n?-1:i>n?1:0}return-1}return null===t?void 0===r?-1:null===r?0:1:void 0===t?void 0===r?0:1:NaN}};let t=1;return e.hash=function(e){if("object"==typeof e&&null!==e){let r=e._hashCode;return void 0===r&&(r=~~t,t+=1,Object.defineProperty(e,"_hashCode",{value:r,configurable:!0})),r}if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)},e}(),h=function(){const e={compare:function(e,t){return"boolean"==typeof e?"boolean"==typeof t?e&&!t?-1:!e&&t?1:0:-1:null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN},hash:function(e){if(!0===e)return 3;if(!1===e)return 2;if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)}};return e}(),l=function(){const e=function(e,t,r){return e===t||null!=e&&"function"==typeof e.equivalentTo&&e.equivalentTo(t,r)};return e.is=function(e){return null!=e&&"function"==typeof e.equivalentTo},e.Epsilon=1e-8,e}(),c=function(){const e={equal:function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},equivalent:function(e,t,r){return e===t||"number"==typeof e&&"number"==typeof t&&(isNaN(e)&&isNaN(t)||Math.abs(t-e)<(void 0!==r?r:l.Epsilon))},compare:function(e,t){return"number"==typeof e?"number"==typeof t?e<t?-1:e>t?1:isNaN(t)?isNaN(e)?0:-1:isNaN(e)?1:0:-1:null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN}},t=new ArrayBuffer(8),r=new Float64Array(t),i=new Int32Array(t);return e.hash=function(e){if("number"==typeof e)return e===~~e?~~e:(r[0]=e,i[0]^i[1]);if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)},e}(),d=function(){const e={compare:function(e,t){return"string"==typeof e?"string"==typeof t?e<t?-1:e>t?1:0:-1:null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN},hash:function(e){if("string"==typeof e)return o.mash(o.mixString(0,e));if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)},codePointAt:function(e,t){const r=e.length;if((t=t?Number(t):0)!=t&&(t=0),t>=0&&t<r){const i=e.charCodeAt(t);if(i<=55295||i>=57344)return i;if(i<=56319&&t+1<r){const r=e.charCodeAt(t+1);if(r>=56320&&r<=57343)return 65536+((1023&i)<<10+r&1023)}}},offsetByCodePoints:function(e,t,r){if(r>0){const i=e.length;for(;r>0&&t<i;){const n=e.charCodeAt(t);if(n<=55295||n>=57344)t+=1;else if(n<=56319&&t+1<i){const r=e.charCodeAt(t+1);t+=r>=56320&&r<=57343?2:1}else t+=1;r-=1}}else if(r<0)for(;r<0&&t>0;){const i=e.charCodeAt(t-1);if(i<=55295||i>=57344)t-=1;else if(i>=56320&&i<=57343&&t-1>0){const r=e.charCodeAt(t-2);t-=r>=55296&&r<=57343?2:1}else t-=1;r-=1}return t}};return e}(),p=function(){const e={isStartChar:function(e){return e>=65&&e<=90||95===e||e>=97&&e<=122||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=767||e>=880&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039},isPartChar:function(e){return 45===e||e>=48&&e<=57||e>=65&&e<=90||95===e||e>=97&&e<=122||183===e||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8255&&e<=8256||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039},isValid:function(t){const r=t.length;if(0!==r){let i=t.codePointAt(0);if(void 0!==i&&e.isStartChar(i)){let n=d.offsetByCodePoints(t,0,1);for(;n<r&&(i=t.codePointAt(0),void 0!==i&&e.isPartChar(i));)n=d.offsetByCodePoints(t,n,1);return n===r&&!e.isReserved(t)}}return!1},isReserved:function(e){switch(e){case"await":case"break":case"case":case"catch":case"class":case"const":case"continue":case"debugger":case"default":case"delete":case"do":case"else":case"enum":case"export":case"extends":case"false":case"finally":case"for":case"function":case"if":case"import":case"in":case"instanceof":case"new":case"null":case"return":case"super":case"switch":case"this":case"throw":case"true":case"try":case"typeof":case"var":case"void":case"while":case"with":case"yield":return!0;default:return!1}}};return e}(),f=function(){const e={compare:function(t,r){if("function"==typeof t){if("function"==typeof r){const i=e.hash(t),n=e.hash(r);return i<n?-1:i>n?1:0}return-1}return null===t?void 0===r?-1:null===r?0:1:void 0===t?void 0===r?0:1:NaN}};let t=-1;return e.hash=function(e){if("function"==typeof e){let r=e._hashCode;return void 0===r&&(r=~~t,t-=1,Object.defineProperty(e,"_hashCode",{value:r,configurable:!0})),r}if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)},e}(),m=function(){const e={compare:function(t,r){if("function"==typeof t){if("function"==typeof r){const i=e.hash(t),n=e.hash(r);return i<n?-1:i>n?1:0}return-1}return null===t?void 0===r?-1:null===r?0:1:void 0===t?void 0===r?0:1:NaN},hash:function(e){if("function"==typeof e){let t=e._hashCode;return void 0===t&&(t=o.mash(o.mixString(0,e.name)),Object.defineProperty(e,"_hashCode",{value:t,configurable:!0})),t}if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)}};return e}(),y=function(){const e=function(e,t){return e===t||null!=e&&"function"==typeof e.equals&&e.equals(t)};return e.is=function(e){return null!=e&&"function"==typeof e.equals},e}(),w=function(){const e=function(e){return void 0===e?0:null===e?1:e.hashCode()};return e.is=function(e){return null!=e&&"function"==typeof e.hashCode},e}(),g=function(){const e=function(e,t){return void 0===e?void 0===t?0:1:null===e?void 0===t?-1:null===t?0:1:"function"==typeof e.compareTo?null==t?-1:e.compareTo(t):NaN};return e.is=function(e){return null!=e&&"function"==typeof e.compareTo},e}(),v=function(){const e={equal:function(e,t){if(e===t)return!0;if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t){const r=Object.keys(e),i=Object.keys(t),n=r.length;if(n!==i.length)return!1;for(let s=0;s<n;s+=1){const n=r[s];if(n!==i[s]||!b.equal(e[n],t[n]))return!1}return!0}return!1},equivalent:function(e,t,r){if(e===t)return!0;if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t){const i=Object.keys(e),n=Object.keys(t),s=i.length;if(s!==n.length)return!1;for(let o=0;o<s;o+=1){const s=i[o];if(s!==n[o]||!b.equivalent(e[s],t[s],r))return!1}return!0}return!1},compare:function(e,t){if("object"==typeof e&&null!==e){if("object"==typeof t&&null!==t){if(e!==t){const r=Object.keys(e),i=Object.keys(t),n=r.length,s=i.length,o=Math.min(n,s);let a=0;for(let n=0;n<o&&0===a;n+=1){const s=r[n],o=i[n];a=d.compare(s,o),0===a&&(a=b.compare(e[s],t[o]))}return 0!==a?a:n>s?1:n<s?-1:0}return 0}return-1}return null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN},hash:function(e){if("object"==typeof e&&null!==e){let t=0;const r=Object.keys(e);for(let i=0,n=r.length;i<n;i+=1){const n=r[i];t=o.mix(o.mix(t,d.hash(n)),b.hash(e[n]))}return o.mash(t)}if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)}};return e}(),b=function(){const e={equal:function(e,t){if(e instanceof Date&&(e=e.getTime()),t instanceof Date&&(t=t.getTime()),e===t)return!0;if("number"==typeof e){if("number"==typeof t)return isNaN(e)&&isNaN(t)}else{if(y.is(e))return e.equals(t);if(Array.isArray(e)){if(Array.isArray(t))return x.equal(e,t)}else if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t)return v.equal(e,t)}return!1},hash:function(e){if(void 0===e)return 0;if(null===e)return 1;if(!1===e)return 2;if(!0===e)return 3;if("number"==typeof e)return c.hash(e);if("string"==typeof e)return d.hash(e);if(w.is(e))return e.hashCode();if("function"==typeof e)return f.hash(e);if(Array.isArray(e))return x.hash(e);if("object"==typeof e)return v.hash(e);throw new TypeError(""+e)},equivalent:function(e,t,r=l.Epsilon){if(e instanceof Date&&(e=e.getTime()),t instanceof Date&&(t=t.getTime()),e===t)return!0;if("number"==typeof e){if("number"==typeof t)return isNaN(e)&&isNaN(t)||Math.abs(t-e)<r}else{if(l.is(e))return e.equivalentTo(t,r);if(Array.isArray(e)){if(Array.isArray(t))return x.equivalent(e,t,r)}else if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t)return v.equivalent(e,t,r)}return!1},compare:function(e,t){return e instanceof Date&&(e=e.getTime()),t instanceof Date&&(t=t.getTime()),void 0===e?void 0===t?0:1:null===e?void 0===t?-1:null===t?0:1:"boolean"==typeof e?null==t?-1:"boolean"==typeof t?e&&!t?-1:!e&&t?1:0:1:"number"==typeof e?null==t||"boolean"==typeof t?-1:"number"==typeof t?e<t?-1:e>t?1:isNaN(t)?isNaN(e)?0:-1:isNaN(e)?1:0:1:"string"==typeof e?null==t||"boolean"==typeof t||"number"==typeof t?-1:"string"==typeof t?e<t?-1:e>t?1:0:1:g.is(e)?e.compareTo(t):"function"==typeof e?null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t?-1:"function"==typeof t?f.compare(e,t):1:Array.isArray(e)?null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"function"==typeof t?-1:Array.isArray(t)?x.compare(e,t):1:"object"==typeof e?null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"function"==typeof t||Array.isArray(t)?-1:"object"==typeof t?v.compare(e,t):1:NaN}};return e}(),x=function(){const e={};return Object.defineProperty(e,"empty",{value:Object.freeze([]),enumerable:!0,configurable:!0}),e.inserted=function(e,t){const r=null!=t?t.length:0,i=new Array(r+1);for(let n=0;n<r;n+=1){const r=t[n];if(r===e)return t;i[n]=r}return i[r]=e,i},e.removed=function(t,r){const i=null!=r?r.length:0;if(0===i)return null!=r?r:e.empty;if(1===i)return r[0]!==t?r:e.empty;{const e=new Array(i-1);let n=0;for(;n<i;){const s=r[n];if(s===t){for(n+=1;n<i;)e[n-1]=r[n],n+=1;return e}e[n]=s,n+=1}return r}},e.equal=function(e,t){if(e===t)return!0;if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t){const r=e.length;if(r!==t.length)return!1;for(let i=0;i<r;i+=1)if(!b.equal(e[i],t[i]))return!1;return!0}return!1},e.equivalent=function(e,t,r){if(e===t)return!0;if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t){const i=e.length;if(i!==t.length)return!1;for(let n=0;n<i;n+=1)if(!b.equivalent(e[n],t[n],r))return!1;return!0}return!1},e.compare=function(e,t){if("object"==typeof e&&null!==e){if("object"==typeof t&&null!==t){if(e!==t){const r=e.length,i=t.length;let n=0;for(let s=0,o=Math.min(r,i);s<o&&0===n;s+=1)n=b.compare(e[s],t[s]);return 0!==n?n:r>i?1:r<i?-1:0}return 0}return-1}return null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN},e.hash=function(e){if("object"==typeof e&&null!==e){let t=0;for(let r=0,i=e.length;r<i;r+=1)t=o.mix(t,b.hash(e[r]));return o.mash(t)}if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)},e}(),C=function(){const e={is:function(e){return null!=e&&"function"==typeof e.fromAny}};return e}(),S=function(){const e={is:function(e){return null!=e&&"function"==typeof e.toAny}};return e}(),O=function(e){const t=function(e,r){const i=function(e){return i.range(i.domain(e))};return Object.setPrototypeOf(i,t.prototype),i.domain=e,i.range=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.equivalentTo=function(e,r){return this===e||e instanceof t&&(this.domain.equivalentTo(e.domain,r)&&this.range.equivalentTo(e.range,r))},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"Mapping("+this.domain+", "+this.range+")"},t}(Function),E=function(e){const t=function(e,r){const i=function(e){return b.equal(e,i[1])?1:0};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"domain",{get(){return this},configurable:!0}),Object.defineProperty(t.prototype,"range",{get:()=>A.unit,configurable:!0}),t.prototype.contains=function(e){return b.compare(this[0],e)<=0&&b.compare(e,this[1])<=0},t.prototype.equivalentTo=function(e,r){return this===e||e instanceof t&&(b.equivalent(this[0],e[0],r)&&b.equivalent(this[1],e[1],r))},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&b.equal(this[0],e[0])&&b.equal(this[1],e[1]))},t.prototype.toString=function(){return"Domain("+this[0]+", "+this[1]+")"},Object.defineProperty(t,"unit",{get(){const e=U(0,1);return Object.defineProperty(t,"unit",{value:e,enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),t}(O),A=function(e){const t=function(e,r){const i=function(e){return e<1?i[0]:i[1]};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"domain",{get:()=>E.unit,configurable:!0}),Object.defineProperty(t.prototype,"range",{get(){return this},configurable:!0}),t.prototype.equivalentTo=function(e,r){return this===e||e instanceof t&&(b.equivalent(this[0],e[0],r)&&b.equivalent(this[1],e[1],r))},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&b.equal(this[0],e[0])&&b.equal(this[1],e[1]))},t.prototype.toString=function(){return"Range("+this[0]+", "+this[1]+")"},Object.defineProperty(t,"unit",{get(){const e=j(0,1);return Object.defineProperty(t,"unit",{value:e,enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),t}(O),k=function(){const e=function(e,t){return null!=e&&"function"==typeof e.interpolateTo?e.interpolateTo(t):null};return e.is=function(e){return null!=e&&"function"==typeof e.interpolateTo},e}(),D=function(e){const t=function(e,t){let r;return e===t?r=T(e):"number"==typeof e&&"number"==typeof t?r=M(e,t):Array.isArray(e)&&Array.isArray(t)?r=V(e,t):(r=k(e,t),null===r&&(r=I(e,t))),r};return(t.prototype=Object.create(e.prototype)).constructor=t,t.prototype.map=function(e){return P(this,e)},t.prototype.interpolateTo=function(e){return e instanceof t?q(this,e):null},t.prototype.canEqual=function(e){return e instanceof this.constructor},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&b.equal(this[0],e[0])&&b.equal(this[1],e[1]))},t.prototype.toString=function(){return"Interpolator("+this[0]+", "+this[1]+")"},t}(A),P=function(e){const t=function(e,r){const i=function(e){return i.transform(i.interpolator(e))};return Object.setPrototypeOf(i,t.prototype),i.interpolator=e,i.transform=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return this.transform(this.interpolator[0])},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return this.transform(this.interpolator[1])},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.interpolator.equals(e.interpolator)&&this.transform===e.transform)},t}(D),T=function(e){const t=function(e){const r=function(e){return r.value};return Object.setPrototypeOf(r,t.prototype),r.value=e,r};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return this.value},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return this.value},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&this.value===e.value},t}(D),I=function(e){const t=function(e,r){const i=function(e){return e<1?i[0]:i[1]};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D),M=function(e){const t=function(e,r){const i=function(e){const t=i[0];return t+e*(i[1]-t)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D),V=function(e){const t=function(e,r){const i=function(e){const t=i.interpolators,r=t.length,n=new Array(r);for(let i=0;i<r;i+=1)n[i]=t[i](e);return n};Object.setPrototypeOf(i,t.prototype);const n=Math.min(e.length,r.length),s=new Array(n);for(let t=0;t<n;t+=1)s[t]=D(e[t],r[t]);return i.interpolators=s,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.interpolators,t=e.length,r=new Array(t);for(let i=0;i<t;i+=1)r[i]=e[i][0];return r},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.interpolators,t=e.length,r=new Array(t);for(let i=0;i<t;i+=1)r[i]=e[i][1];return r},configurable:!0}),t.prototype.equals=function(e){if(this===e)return!0;if(e instanceof t){const t=this.interpolators.length;if(t===e.interpolators.length){for(let r=0;r<t;r+=1)if(!this.interpolators[r].equals(e.interpolators[r]))return!1;return!0}}return!1},t}(D),q=function(e){const t=function(e,r){const i=function(e){return 0===e?i[0]:1===e?i[1]:D(i[0](e),i[1](e))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D),F=function(e){const t=function(e,r,i){const n=function(e){const t=n[0],r=n[1];return n.easing(Math.min(Math.max(0,(e-t)/(r-t)),1))};return Object.setPrototypeOf(n,t.prototype),n.easing=e,n[0]=r,n[1]=i,n};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"duration",{get(){return this[1]-this[0]},configurable:!0}),t.prototype.contains=function(e){return this[0]<=e&&e<=this[1]},t.prototype.withDomain=function(e,r){return t(this.easing,e,r)},t.prototype.withDuration=function(e){const r=this[0];return t(this.easing,r,r+e)},t.prototype.overRange=function(e,t){let r;return r=1===arguments.length?e:D(e,t),z(this,r)},t.prototype.equivalentTo=function(e,r){return this===e||e instanceof t&&(this.easing.equivalentTo(e.easing,r)&&b.equivalent(this[0],e[0],r)&&b.equivalent(this[1],e[1],r))},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this.easing.equals(e.easing)&&b.equal(this[0],e[0])&&b.equal(this[1],e[1]))},t.prototype.toString=function(){return"Timing("+this.easing+", "+this[0]+", "+this[1]+")"},t.fromInit=function(e){let r=e.easing;void 0===r?r=N.linear:"string"==typeof r&&(r=N(r));let i=e.t0;void 0===i&&(i=0);let n=e.t1;if(void 0===n){const t=e.dt;n=void 0!==t?i+t:i}return t(r,i,n)},t.fromAny=function(e){if(null==e)return!1;if(e instanceof t||"boolean"==typeof e)return e;if("object"==typeof e)return t.fromInit(e);throw new TypeError(""+e)},t}(E),N=function(e){const t=function(e){switch(e){case"linear":return t.linear;case"quad-in":return t.quadIn;case"quad-out":return t.quadOut;case"quad-in-out":return t.quadInOut;case"cubic-in":return t.cubicIn;case"cubic-out":return t.cubicOut;case"cubic-in-out":return t.cubicInOut;case"quart-in":return t.quartIn;case"quart-out":return t.quartOut;case"quart-in-out":return t.quartInOut;case"expo-in":return t.expoIn;case"expo-out":return t.expoOut;case"expo-in-out":return t.expoInOut;case"circ-in":return t.circIn;case"circ-out":return t.circOut;case"circ-in-out":return t.circInOut;case"back-in":return t.backIn;case"back-out":return t.backOut;case"back-in-out":return t.backInOut;case"elastic-in":return t.elasticIn;case"elastic-out":return t.elasticOut;case"elastic-in-out":return t.elasticInOut;case"bounce-in":return t.bounceIn;case"bounce-out":return t.bounceOut;case"bounce-in-out":return t.bounceInOut;default:throw new Error("unknown easing: "+e)}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{value:0}),Object.defineProperty(t.prototype,1,{value:1}),Object.defineProperty(t.prototype,"easing",{get(){return this}}),t.prototype.equivalentTo=function(e,t){return this===e},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e},t.prototype.toString=function(){return'Easing("'+this.type+'")'},t.fromAny=function(e){if(e instanceof t)return e;if("string"==typeof e)return t(e);throw new TypeError(""+e)},t.linear=function(e){return e},Object.setPrototypeOf(t.linear,t.prototype),t.linear.type="linear",t.quadIn=function(e){return e*e},Object.setPrototypeOf(t.quadIn,t.prototype),t.quadIn.type="quad-in",t.quadOut=function(e){return e*(2-e)},Object.setPrototypeOf(t.quadOut,t.prototype),t.quadOut.type="quad-out",t.quadInOut=function(e){return(e*=2)<=1?e*=e:(e-=1,e*=2-e,e+=1),e/=2},Object.setPrototypeOf(t.quadInOut,t.prototype),t.quadInOut.type="quad-in-out",t.cubicIn=function(e){return e*e*e},Object.setPrototypeOf(t.cubicIn,t.prototype),t.cubicIn.type="cubic-in",t.cubicOut=function(e){return e-=1,e*=e*e,e+=1},Object.setPrototypeOf(t.cubicOut,t.prototype),t.cubicOut.type="cubic-out",t.cubicInOut=function(e){return(e*=2)<=1?e*=e*e:(e-=2,e*=e*e,e+=2),e/=2},Object.setPrototypeOf(t.cubicInOut,t.prototype),t.cubicInOut.type="cubic-in-out",t.quartIn=function(e){return e*e*e*e},Object.setPrototypeOf(t.quartIn,t.prototype),t.quartIn.type="quart-in",t.quartOut=function(e){return 1-(e-=1)*e*e*e},Object.setPrototypeOf(t.quartOut,t.prototype),t.quartOut.type="quart-out",t.quartInOut=function(e){const t=e-1;return e<.5?8*e*e*e*e:1-8*t*t*t*t},Object.setPrototypeOf(t.quartInOut,t.prototype),t.quartInOut.type="quart-in-out",t.expoIn=function(e){return 0===e?0:Math.pow(2,10*(e-1))},Object.setPrototypeOf(t.expoIn,t.prototype),t.expoIn.type="expo-in",t.expoOut=function(e){return 1===e?1:1-Math.pow(2,-10*e)},Object.setPrototypeOf(t.expoOut,t.prototype),t.expoOut.type="expo-out",t.expoInOut=function(e){return 1===e||0===e?e:(e*=2)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*(e-1)))},Object.setPrototypeOf(t.expoInOut,t.prototype),t.expoInOut.type="expo-in-out",t.circIn=function(e){return-1*(Math.sqrt(1-e/1*e)-1)},Object.setPrototypeOf(t.circIn,t.prototype),t.circIn.type="circ-in",t.circOut=function(e){return e-=1,Math.sqrt(1-e*e)},Object.setPrototypeOf(t.circOut,t.prototype),t.circOut.type="circ-out",t.circInOut=function(e){if((e*=2)<1)return-.5*(Math.sqrt(1-e*e)-1);const t=e-2;return.5*(Math.sqrt(1-t*t)+1)},Object.setPrototypeOf(t.circInOut,t.prototype),t.circInOut.type="circ-in-out",t.backIn=function(e){const t=1.70158;return e*e*((t+1)*e-t)},Object.setPrototypeOf(t.backIn,t.prototype),t.backIn.type="back-in",t.backOut=function(e){const t=1.70158,r=e/1-1;return r*r*((t+1)*t+t)+1},Object.setPrototypeOf(t.backOut,t.prototype),t.backOut.type="back-out",t.backInOut=function(e){const t=2.5949095;if((e*=2)<1)return.5*e*e*((t+1)*e-t);const r=e-2;return.5*(r*r*((t+1)*r+t)+2)},Object.setPrototypeOf(t.backInOut,t.prototype),t.backInOut.type="back-in-out",t.elasticIn=function(e){if(0===e||1===e)return e;const t=e/1-1,r=(1-.7)/2*Math.PI*Math.asin(1);return-Math.pow(2,10*t)*Math.sin(2*(t-r)*Math.PI/(1-.7))},Object.setPrototypeOf(t.elasticIn,t.prototype),t.elasticIn.type="elastic-in",t.elasticOut=function(e){if(0===e||1===e)return e;const t=(1-.7)/(2*Math.PI)*Math.asin(1);return e*=2,Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/(1-.7))+1},Object.setPrototypeOf(t.elasticOut,t.prototype),t.elasticOut.type="elastic-out",t.elasticInOut=function(e){if(0===e||1===e)return e;const t=.65,r=(1-t)/(2*Math.PI)*Math.asin(1),i=2*e,n=i-1;return i<1?Math.pow(2,10*n)*Math.sin(2*(n-r)*Math.PI/(1-t))*-.5:Math.pow(2,-10*n)*Math.sin(2*(n-r)*Math.PI/(1-t))*.5+1},Object.setPrototypeOf(t.elasticInOut,t.prototype),t.elasticInOut.type="elastic-in-out",t.bounceIn=function(e){const t=7.5625;return(e=1-e)<1/2.75?1-t*e*e:e<2/2.75?1-(t*(e-=1.5/2.75)*e+.75):e<2.5/2.75?1-(t*(e-=2.25/2.75)*e+.9375):1-(t*(e-=2.625/2.75)*e+.984375)},Object.setPrototypeOf(t.bounceIn,t.prototype),t.bounceIn.type="bounce-in",t.bounceOut=function(e){const t=7.5625;return e<1/2.75?t*e*e:e<2/2.75?t*(e-=1.5/2.75)*e+.75:e<2.5/2.75?t*(e-=2.25/2.75)*e+.9375:t*(e-=2.625/2.75)*e+.984375},Object.setPrototypeOf(t.bounceOut,t.prototype),t.bounceOut.type="bounce-out",t.bounceInOut=function(e){const t=e<.5,r=7.5625;return(e=t?1-2*e:2*e-1)<1/2.75?e*=r*e:e=e<2/2.75?r*(e-=1.5/2.75)*e+.75:e<2.5/2.75?r*(e-=2.25/2.75)*e+.9375:r*(e-=2.625/2.75)*e+.984375,t?.5*(1-e):.5*e+.5},Object.setPrototypeOf(t.bounceInOut,t.prototype),t.bounceInOut.type="bounce-in-out",t}(F),z=function(e){const t=function(e,r){const i=function(e){return i.range(i.domain(e))};return Object.setPrototypeOf(i,t.prototype),i.domain=e,i.range=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.withDomain=function(e,t){return this.domain.withDomain(e,t).overRange(this.range)},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"Tweening("+this.domain+", "+this.range+")"},t}(O),U=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1]-t;return 0!==r?(e-t)/r:0};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"inverse",{get(){return j(this[0],this[1])},configurable:!0}),t.prototype.contains=function(e){return this[0]<=e&&e<=this[1]},t.prototype.interpolateTo=function(e){return e instanceof t?R(this,e):null},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this[0]===e[0]&&this[1]===e[1])},t.prototype.toString=function(){return"LinearDomain("+this[0]+", "+this[1]+")"},t}(E),R=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=t[0],n=t[1],s=i[1],o=s[0],a=s[1];return U(r+e*(o-r),n+e*(a-n))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D),j=function(e){const t=function(e,r){const i=function(e){const t=i[0];return t+e*(i[1]-t)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"inverse",{get(){return U(this[0],this[1])},configurable:!0}),t.prototype.interpolateTo=function(e){return e instanceof t?L(this,e):null},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this[0]===e[0]&&this[1]===e[1])},t.prototype.toString=function(){return"LinearRange("+this[0]+", "+this[1]+")"},t}(A),L=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=t[0],n=t[1],s=i[1],o=s[0],a=s[1];return j(r+e*(o-r),n+e*(a-n))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D),B=function(e){const t=function(){throw new Error};return(t.prototype=Object.create(e.prototype)).constructor=t,t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"Scale("+this.domain+", "+this.range+")"},t}(O),K=function(e){const t=function(){throw new Error};return(t.prototype=Object.create(e.prototype)).constructor=t,t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"ContinuousScale("+this.domain+", "+this.range+")"},t}(B),W=function(e){const t=function(e,r){const i=function(e){return i.range(i.domain(e))};return Object.setPrototypeOf(i,t.prototype),i.domain=e,i.range=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"inverse",{get(){return t(this.range.inverse,this.domain.inverse)},configurable:!0}),t.prototype.withDomain=function(e,r){let i;return i=1===arguments.length?e:U(e,r),t(i,this.range)},t.prototype.overRange=function(e,r){let i;return i=1===arguments.length?e:j(e,r),t(this.domain,i)},t.prototype.clampDomain=function(e,r,i,n,s){void 0===s&&(s=l.Epsilon);let o=this.domain[0],a=this.domain[1];void 0!==e&&void 0!==r&&Math.abs(a-o)>r-e?o<a?(o=e,a=r):(a=e,o=r):(void 0!==e&&(o<a&&o<e?(a+=e-o,o=e):a<o&&a<e&&(o+=e-a,a=e)),void 0!==r&&(o<a&&a>r?(o-=a-r,a=r):a<o&&o>r&&(a-=o-r,o=r)));const u=this(o),h=this(a),c=u<h?h-u:u-h,d=Math.abs(c/(a-o));if(void 0!==i&&d<1/i){const e=c*i,t=o+a;o=(t-e)/2,a=(t+e)/2}else if(void 0!==n&&d>1/n){const e=c*n,t=o+a;o=(t-e)/2,a=(t+e)/2}return Math.abs(o-this.domain[0])<s&&Math.abs(a-this.domain[1])<s?this:t(U(o,a),this.range)},t.prototype.solveDomain=function(e,r,i,n,s,o){void 0===o&&(o=l.Epsilon);const a=this.domain[1]-this.domain[0],u=this.range[0],h=this.range[1];let c;void 0===i||void 0===n||Math.abs(i-e)<o||Math.abs(n-r)<o?c=(h-u)/(0!==a?a:o):(c=(n-r)/(i-e),void 0!==s&&s||c<0==(h-u)/a<0||(c=-c));const d=r-c*e,p=(u-d)/c,f=(h-d)/c;return Math.abs(p-this.domain[0])<o&&Math.abs(f-this.domain[1])<o?this:t(U(p,f),this.range)},t.prototype.interpolateTo=function(e){return e instanceof t?H(this,e):null},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"LinearScale("+this.domain+", "+this.range+")"},t}(K),H=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=t.domain,s=n[0],o=n[1],a=r.domain,u=a[0],h=a[1],l=U(s+e*(u-s),o+e*(h-o)),c=t.range,d=c[0],p=c[1],f=r.range,m=f[0],y=f[1],w=j(d+e*(m-d),p+e*(y-p));return W(l,w)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D),X=function(){const e={is:function(e){if("object"==typeof e&&null!==e||"function"==typeof e){return"create"in e}return!1}};return e}(),_=function(){const e={is:function(e){if("object"==typeof e&&null!==e||"function"==typeof e){return"init"in e}return!1}};return e}(),G=function(){const e={is:function(e){if("object"==typeof e&&null!==e||"function"==typeof e){return"observe"in e}return!1}};return e}(),Y=function(){const e={is:function(e){if("object"==typeof e&&null!==e||"function"==typeof e){return"consume"in e}return!1}};return e}();class Z{set(e){throw new Error("immutable")}delete(){throw new Error("immutable")}static empty(){return new Q}static unary(e){return new $(e)}static array(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.length),new J(e,t,r)}}i([a],Z,"empty",null);class Q extends Z{isEmpty(){return!0}head(){throw new Error("empty")}step(){throw new Error("empty")}skip(e){}hasNext(){return!1}nextIndex(){return 0}next(){return{done:!0}}hasPrevious(){return!1}previousIndex(){return-1}previous(){return{done:!0}}}class $ extends Z{constructor(e){super(),this.value=e,this.index=0}isEmpty(){return 0!==this.index}head(){if(0===this.index)return this.value;throw new Error("empty")}step(){if(0!==this.index)throw new Error("empty");this.index=1}skip(e){this.index=Math.min(Math.max(0,this.index+e),1)}hasNext(){return 0===this.index}nextIndex(){return this.index}next(){return 0===this.index?(this.index=1,{value:this.value,done:!0}):{done:!0}}hasPrevious(){return 1===this.index}previousIndex(){return this.index-1}previous(){return 1===this.index?(this.index=0,{value:this.value,done:!0}):{done:!0}}}class J extends Z{constructor(e,t,r){super(),this.array=e,this.index=t,this.limit=r}isEmpty(){return this.index>=this.limit}head(){if(this.index<this.limit)return this.array[this.index];throw new Error("empty")}step(){if(!(this.index<this.limit))throw new Error("empty");this.index+=1}skip(e){this.index=Math.min(this.index+e,this.limit)}hasNext(){return this.index<this.limit}nextIndex(){return this.index}next(){const e=this.index;return e<this.limit?(this.index+=1,{value:this.array[e],done:this.index===this.limit}):(this.index=this.limit,{done:!0})}hasPrevious(){return this.index>0}previousIndex(){return this.index-1}previous(){const e=this.index-1;return e>=0?(this.index=e,{value:this.array[e],done:0===e}):(this.index=0,{done:!0})}}class ee{constructor(e){this.buckets=new Array(e),this.gen4Hits=0,this.gen3Hits=0,this.gen2Hits=0,this.gen1Hits=0,this.misses=0}get(e){if(0===this.buckets.length)return;const t=Math.abs(b.hash(e))%this.buckets.length,r=this.buckets[t];if(void 0===r)return;const i=r.gen4Key;if(void 0!==i&&b.equal(e,i)){const e=r.gen4Val;if(void 0!==e)return this.gen4Hits+=1,r.gen4Weight++,e;r.gen4Key=void 0}const n=r.gen3Key;if(void 0!==n&&b.equal(e,n)){const e=r.gen3Val;if(void 0!==e)return this.gen3Hits+=1,r.gen3Weight++>r.gen4Weight&&(this.buckets[t]=new te(r.gen3Key,r.gen3Val,r.gen3Weight,r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight)),e;r.gen3Key=void 0}const s=r.gen2Key;if(void 0!==s&&b.equal(e,s)){const e=r.gen2Val;if(void 0!==e)return this.gen2Hits+=1,r.gen2Weight++>r.gen3Weight&&(this.buckets[t]=new te(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight)),e;r.gen2Key=void 0}const o=r.gen1Key;if(void 0!==o&&b.equal(e,o)){const e=r.gen1Val;if(void 0!==e)return this.gen1Hits+=1,r.gen1Weight++>r.gen2Weight&&(this.buckets[t]=new te(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight,r.gen2Key,r.gen2Val,r.gen2Weight)),e;r.gen1Key=void 0}this.misses+=1}put(e,t){if(0===this.buckets.length)return t;const r=Math.abs(b.hash(e))%this.buckets.length,i=this.buckets[r]||new te;let n=i.gen4Key;if(void 0!==n&&b.equal(e,n)){const e=i.gen4Val;if(void 0!==e)return this.gen4Hits+=1,i.gen4Weight++,e;i.gen4Key=void 0,n=void 0}let s=i.gen3Key;if(void 0!==s&&b.equal(e,s)){const e=i.gen3Val;if(void 0!==e)return this.gen3Hits+=1,i.gen3Weight++>i.gen4Weight&&(this.buckets[r]=new te(i.gen3Key,i.gen3Val,i.gen3Weight,i.gen4Key,i.gen4Val,i.gen4Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen1Key,i.gen1Val,i.gen1Weight)),e;i.gen3Key=void 0,s=void 0}let o=i.gen2Key;if(void 0!==o&&b.equal(e,o)){const e=i.gen2Val;if(void 0!==e)return this.gen2Hits+=1,i.gen2Weight++>i.gen3Weight&&(this.buckets[r]=new te(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen1Key,i.gen1Val,i.gen1Weight)),e;i.gen2Key=void 0,o=void 0}let a=i.gen1Key;if(void 0!==a&&b.equal(e,a)){const e=i.gen1Val;if(void 0!==e)return this.gen1Hits+=1,i.gen1Weight++>i.gen2Weight&&(this.buckets[r]=new te(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen1Key,i.gen1Val,i.gen1Weight,i.gen2Key,i.gen2Val,i.gen2Weight)),e;i.gen1Key=void 0,a=void 0}return this.misses+=1,this.buckets[r]=void 0===n?new te(i.gen3Key,i.gen3Val,i.gen3Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen1Key,i.gen1Val,i.gen1Weight,e,t,1):void 0===s?new te(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen1Key,i.gen1Val,i.gen1Weight,e,t,1):void 0===o?new te(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen1Key,i.gen1Val,i.gen1Weight,e,t,1):void 0===a?new te(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen2Key,i.gen2Val,i.gen2Weight,e,t,1):new te(i.gen4Key,i.gen4Val,i.gen4Weight-1,i.gen3Key,i.gen3Val,i.gen3Weight-1,i.gen1Key,i.gen1Val,i.gen1Weight,e,t,1),t}remove(e){if(0===this.buckets.length)return;const t=Math.abs(b.hash(e))%this.buckets.length,r=this.buckets[t];if(void 0===r)return;const i=r.gen4Key;if(void 0!==i&&b.equal(e,i)){const e=r.gen4Val;return this.buckets[t]=new te(r.gen3Key,r.gen3Val,r.gen3Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight,void 0,void 0,0),e}const n=r.gen3Key;if(void 0!==n&&b.equal(e,n)){const e=r.gen3Val;return this.buckets[t]=new te(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight,void 0,void 0,0),e}const s=r.gen2Key;if(void 0!==s&&b.equal(e,s)){const e=r.gen2Val;return this.buckets[t]=new te(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight,void 0,void 0,0),e}const o=r.gen1Key;if(void 0!==o&&b.equal(e,o)){const e=r.gen1Val;return this.buckets[t]=new te(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen2Key,r.gen2Val,r.gen2Weight,void 0,void 0,0),e}}clear(){for(let e=0;e<this.buckets.length;e+=1)this.buckets[e]=void 0}hits(){return this.gen4Hits+this.gen3Hits+this.gen2Hits+this.gen1Hits}hitRatio(){const e=this.hits();return e/(e+this.misses)}}class te{constructor(e,t,r=0,i,n,s=0,o,a,u=0,h,l,c=0){this.gen4Key=e,this.gen4Val=t,this.gen4Weight=r,this.gen3Key=i,this.gen3Val=n,this.gen3Weight=s,this.gen2Key=o,this.gen2Val=a,this.gen2Weight=u,this.gen1Key=h,this.gen1Val=l,this.gen1Weight=c}}class re{constructor(e){this.buckets=new Array(e),this.gen4Hits=0,this.gen3Hits=0,this.gen2Hits=0,this.gen1Hits=0,this.misses=0}put(e){if(0===this.buckets.length)return e;const t=Math.abs(b.hash(e))%this.buckets.length,r=this.buckets[t]||new ie,i=r.gen4Val;if(void 0!==i&&b.equal(e,i))return this.gen4Hits+=1,r.gen4Weight++,i;const n=r.gen3Val;if(void 0!==n&&b.equal(e,n))return this.gen3Hits+=1,r.gen3Weight++>r.gen4Weight&&(this.buckets[t]=new ie(r.gen3Val,r.gen3Weight,r.gen4Val,r.gen4Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight)),n;const s=r.gen2Val;if(void 0!==s&&b.equal(e,s))return this.gen2Hits+=1,r.gen2Weight++>r.gen3Weight&&(this.buckets[t]=new ie(r.gen4Val,r.gen4Weight,r.gen2Val,r.gen2Weight,r.gen3Val,r.gen3Weight,r.gen1Val,r.gen1Weight)),s;const o=r.gen1Val;return void 0!==o&&b.equal(e,o)?(this.gen1Hits+=1,r.gen1Weight++>r.gen2Weight&&(this.buckets[t]=new ie(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen1Val,r.gen1Weight,r.gen2Val,r.gen2Weight)),o):(this.misses+=1,this.buckets[t]=void 0===i?new ie(r.gen3Val,r.gen3Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight,e,1):void 0===n?new ie(r.gen4Val,r.gen4Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight,e,1):void 0===s?new ie(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen1Val,r.gen1Weight,e,1):void 0===o?new ie(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen2Val,r.gen2Weight,e,1):new ie(r.gen4Val,r.gen4Weight-1,r.gen3Val,r.gen3Weight-1,r.gen1Val,r.gen1Weight,e,1),e)}remove(e){if(0===this.buckets.length)return!1;const t=Math.abs(b.hash(e))%this.buckets.length,r=this.buckets[t];if(void 0===r)return!1;const i=r.gen4Val;if(void 0!==i&&b.equal(e,i))return this.buckets[t]=new ie(r.gen3Val,r.gen3Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight,void 0,0),!0;const n=r.gen3Val;if(void 0!==n&&b.equal(e,n))return this.buckets[t]=new ie(r.gen4Val,r.gen4Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight,void 0,0),!0;const s=r.gen2Val;if(void 0!==s&&b.equal(e,s))return this.buckets[t]=new ie(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen1Val,r.gen1Weight,void 0,0),!0;const o=r.gen1Val;return!(void 0===o||!b.equal(e,o))&&(this.buckets[t]=new ie(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen2Val,r.gen2Weight,void 0,0),!0)}clear(){for(let e=0;e<this.buckets.length;e+=1)this.buckets[e]=void 0}get hits(){return this.gen4Hits+this.gen3Hits+this.gen2Hits+this.gen1Hits}get hitRatio(){const e=this.hits;return e/(e+this.misses)}}class ie{constructor(e,t=0,r,i=0,n,s=0,o,a=0){this.gen4Val=e,this.gen4Weight=t,this.gen3Val=r,this.gen3Weight=i,this.gen2Val=n,this.gen2Weight=s,this.gen1Val=o,this.gen1Weight=a}}class ne extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ne.prototype)}}const se=function(){const e=function(e,t){if(!e)throw new ne(t)};return e.ok=function(e,t){if(!e)throw new ne(t)},e.notOk=function(e,t){if(e)throw new ne(t)},e.equal=function(e,t,r){if(!b.equal(e,t))throw new ne(r)},e.notEqual=function(e,t,r){if(b.equal(e,t))throw new ne(r)},e.identical=function(e,t,r){if(e!==t)throw new ne(r)},e.notIdentical=function(e,t,r){if(e===t)throw new ne(r)},e.instanceOf=function(e,t,r){if(!(e instanceof t))throw new ne(r)},e.notInstanceOf=function(e,t,r){if(e instanceof t)throw new ne(r)},e.compareLessThan=function(e,t,r){if(!(b.compare(e,t)<0))throw new ne(r)},e.compareNotLessThan=function(e,t,r){if(b.compare(e,t)<0)throw new ne(r)},e.compareLessThanOrEqual=function(e,t,r){if(!(b.compare(e,t)<=0))throw new ne(r)},e.compareNotLessThanOrEqual=function(e,t,r){if(b.compare(e,t)<=0)throw new ne(r)},e.compareEqual=function(e,t,r){if(0!==b.compare(e,t))throw new ne(r)},e.compareNotEqual=function(e,t,r){if(0===b.compare(e,t))throw new ne(r)},e.compareGreaterThanOrEqual=function(e,t,r){if(!(b.compare(e,t)>=0))throw new ne(r)},e.compareNotGreaterThanOrEqual=function(e,t,r){if(b.compare(e,t)>=0)throw new ne(r)},e.compareGreaterThan=function(e,t,r){if(!(b.compare(e,t)>0))throw new ne(r)},e.compareNotGreaterThan=function(e,t,r){if(b.compare(e,t)>0)throw new ne(r)},e}();class oe{constructor(e,t){this.level=e,this.label=t}isTrace(){return this.level===oe.TRACE_LEVEL}isDebug(){return this.level===oe.DEBUG_LEVEL}isInfo(){return this.level===oe.INFO_LEVEL}isNote(){return this.level===oe.NOTE_LEVEL}isWarning(){return this.level===oe.WARNING_LEVEL}isError(){return this.level===oe.ERROR_LEVEL}isAlert(){return this.level===oe.ALERT_LEVEL}isFatal(){return this.level===oe.FATAL_LEVEL}compareTo(e){return this===e?0:e instanceof oe?this.level<e.level?-1:this.level>e.level?1:this.label.localeCompare(e.label):NaN}equals(e){return this===e||e instanceof oe&&(this.level===e.level&&this.label===e.label)}hashCode(){return o.mash(o.mix(o.mix(m.hash(oe),c.hash(this.level)),d.hash(this.label)))}toString(){return this.label}static create(e,t){switch(e){case oe.TRACE_LEVEL:return oe.trace(t);case oe.DEBUG_LEVEL:return oe.debug(t);case oe.INFO_LEVEL:return oe.info(t);case oe.NOTE_LEVEL:return oe.note(t);case oe.WARNING_LEVEL:return oe.warning(t);case oe.ERROR_LEVEL:return oe.error(t);case oe.ALERT_LEVEL:return oe.alert(t);case oe.FATAL_LEVEL:return oe.fatal(t);default:throw new Error(""+e)}}static trace(e="trace"){return"trace"===e?(void 0===oe._trace&&(oe._trace=new oe(oe.TRACE_LEVEL,e)),oe._trace):new oe(oe.TRACE_LEVEL,e)}static debug(e="debug"){return"debug"===e?(void 0===oe._debug&&(oe._debug=new oe(oe.DEBUG_LEVEL,e)),oe._debug):new oe(oe.DEBUG_LEVEL,e)}static info(e="info"){return"info"===e?(void 0===oe._info&&(oe._info=new oe(oe.INFO_LEVEL,e)),oe._info):new oe(oe.INFO_LEVEL,e)}static note(e="note"){return"note"===e?(void 0===oe._note&&(oe._note=new oe(oe.NOTE_LEVEL,e)),oe._note):new oe(oe.NOTE_LEVEL,e)}static warning(e="warning"){return"warning"===e?(void 0===oe._warning&&(oe._warning=new oe(oe.WARNING_LEVEL,e)),oe._warning):new oe(oe.WARNING_LEVEL,e)}static error(e="error"){return"error"===e?(void 0===oe._error&&(oe._error=new oe(oe.ERROR_LEVEL,e)),oe._error):new oe(oe.ERROR_LEVEL,e)}static alert(e="alert"){return"alert"===e?(void 0===oe._alert&&(oe._alert=new oe(oe.ALERT_LEVEL,e)),oe._alert):new oe(oe.ALERT_LEVEL,e)}static fatal(e="fatal"){return"fatal"===e?(void 0===oe._fatal&&(oe._fatal=new oe(oe.FATAL_LEVEL,e)),oe._fatal):new oe(oe.FATAL_LEVEL,e)}}oe.TRACE_LEVEL=0,oe.DEBUG_LEVEL=1,oe.INFO_LEVEL=2,oe.NOTE_LEVEL=3,oe.WARNING_LEVEL=4,oe.ERROR_LEVEL=5,oe.ALERT_LEVEL=6,oe.FATAL_LEVEL=7;class ae{}class ue extends ae{constructor(e,t,r,i){super(),this.offset=e,this.line=t,this.column=r,this.note=i}withNote(e){return this.note!==e?ue.at(this.offset,this.line,this.column,e):this}min(e){return this.offset<=e.offset?this:e}max(e){return this.offset>=e.offset?this:e}get start(){return this}get end(){return this}union(e){if(e instanceof ue)return this.offset===e.offset&&this.line===e.line&&this.column===e.column?this:he.from(this,e);if(e instanceof he){const t=this.min(e.start),r=this.max(e.end);return t===e.start&&r===e.end?e:he.from(t,r)}throw new Error(e.toString())}shift(e){const t=this.offset+(this.offset-e.offset),r=this.line+(this.line-e.line);let i=this.column;return 1===r&&(i+=this.column-e.column),t===this.offset&&r===this.line&&i===this.column?this:ue.at(t,r,i,this.note)}equals(e){return this===e||e instanceof ue&&(this.offset===e.offset&&this.line===e.line&&this.column===e.column&&this.note===e.note)}hashCode(){return o.mash(o.mix(o.mix(o.mix(o.mix(m.hash(ue),c.hash(this.offset)),c.hash(this.line)),c.hash(this.column)),d.hash(this.note)))}display(e){return e=(e=Oe.displayNumber(e,this.line)).write(58),e=Oe.displayNumber(e,this.column),void 0!==this.note&&(e=e.write(58).write(32).write(this.note)),e}debug(e){return e=e.write("Mark").write(".").write("at").write("("),e=(e=Oe.debugNumber(e,this.offset)).write(", "),e=(e=Oe.debugNumber(e,this.line)).write(", "),e=Oe.debugNumber(e,this.column),void 0!==this.note&&(e=e.write(", "),e=Oe.debugString(e,this.note)),e=e.write(")")}toString(){return Oe.display(this)}static get zero(){return new ue(0,1,1,void 0)}static at(e,t,r,i){return new ue(e,t,r,i)}}i([a],ue,"zero",null);class he extends ae{constructor(e,t){super(),this.start=e,this.end=t}union(e){if(e instanceof ue){const t=this.start.min(e),r=this.end.max(e);return t===this.start&&r===this.end?this:he.from(t,r)}if(e instanceof he){const t=this.start.min(e.start),r=this.end.max(e.end);return t===this.start&&r===this.end?this:he.from(t,r)}throw new Error(e.toString())}shift(e){const t=this.start.shift(e),r=this.end.shift(e);return t===this.start&&r===this.end?this:he.from(t,r)}equals(e){return this===e||e instanceof he&&(this.start.equals(e.start)&&this.end.equals(e.end))}hashCode(){return o.mash(o.mix(o.mix(m.hash(he),this.start.hashCode()),this.end.hashCode()))}display(e){return void 0!==this.start.note&&(e=e.write(this.start.note).write(58).write(32)),e=(e=Oe.displayNumber(e,this.start.line)).write(58),e=(e=Oe.displayNumber(e,this.start.column)).write(45),e=(e=Oe.displayNumber(e,this.end.line)).write(58),e=Oe.displayNumber(e,this.end.column),void 0!==this.end.note&&(e=e.write(58).write(32).write(this.end.note)),e}debug(e){return e=e.write("Span").write(".").write("from").write("("),e=(e=this.start.debug(e)).write(", "),e=(e=this.end.debug(e)).write(")")}toString(){return Oe.display(this)}static from(e,t){if(e.offset>t.offset){const r=e;e=t,t=r}return new he(e,t)}}const le=function(){const e={reset:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(109)),e},bold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(109)),e},faint:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(50).write(109)),e},black:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(48).write(109)),e},red:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(49).write(109)),e},green:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(50).write(109)),e},yellow:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(51).write(109)),e},blue:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(52).write(109)),e},magenta:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(53).write(109)),e},cyan:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(54).write(109)),e},gray:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(55).write(109)),e},blackBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(48).write(109)),e},redBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(49).write(109)),e},greenBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(50).write(109)),e},yellowBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(51).write(109)),e},blueBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(52).write(109)),e},magentaBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(53).write(109)),e},cyanBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(54).write(109)),e},grayBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(55).write(109)),e}};return e}();class ce{constructor(e,t,r,i){Object.defineProperty(this,"lineSeparator",{value:e,enumerable:!0}),Object.defineProperty(this,"pretty",{value:t,enumerable:!0}),Object.defineProperty(this,"styled",{value:r,enumerable:!0}),Object.defineProperty(this,"precision",{value:i,enumerable:!0})}withLineSeparator(e){return this.copy(e,this.pretty,this.styled,this.precision)}isPretty(){return this.pretty}asPretty(e){return this.copy(this.lineSeparator,e,this.styled,this.precision)}isStyled(){return this.styled}asStyled(e){return this.copy(this.lineSeparator,this.pretty,e,this.precision)}withPrecision(e){return this.copy(this.lineSeparator,this.pretty,this.styled,e)}copy(e,t,r,i){return ce.create(e,t,r,i)}canEqual(e){return e instanceof ce}equals(e){return this===e||e instanceof ce&&(e.canEqual(this)&&this.lineSeparator===e.lineSeparator&&this.pretty===e.pretty&&this.styled===e.styled&&this.precision===e.precision)}hashCode(){return o.mash(o.mix(o.mix(o.mix(o.mix(m.hash(ce),d.hash(this.lineSeparator)),h.hash(this.pretty)),h.hash(this.styled)),c.hash(this.precision)))}debug(e){return e=e.write("OutputSettings").write(46),e=(e=this.pretty||this.styled?this.pretty&&!this.styled?e.write("pretty"):!this.pretty&&this.styled?e.write("styled"):e.write("prettyStyled"):e.write("standard")).write(40).write(41),this.lineSeparator!==Oe.lineSeparator&&(e=e.write(46).write("lineSeparator").write(40).display(this.lineSeparator).write(41)),-1!==this.precision&&(e=e.write(46).write("precision").write(40).display(this.precision).write(41)),e}toString(){return Oe.debug(this)}static standard(){return new ce(Oe.lineSeparator,!1,!1,-1)}static pretty(){return new ce(Oe.lineSeparator,!0,!1,-1)}static styled(){return new ce(Oe.lineSeparator,!1,!0,-1)}static prettyStyled(){return new ce(Oe.lineSeparator,!0,!0,-1)}static create(e,t,r,i){return"string"!=typeof e&&(e=Oe.lineSeparator),"boolean"!=typeof t&&(t=!1),"boolean"!=typeof r&&(r=!1),"number"!=typeof i&&(i=-1),e===Oe.lineSeparator&&-1===i?t||r?t&&!r?ce.pretty():!t&&r?ce.styled():ce.prettyStyled():ce.standard():new ce(e,t,r,i)}static fromInit(e){return ce.create(e.lineSeparator,e.isPretty,e.isStyled,e.precision)}static fromAny(e){return e instanceof ce?e:"object"==typeof e&&null!==e?ce.fromInit(e):ce.standard()}}i([a],ce,"standard",null),i([a],ce,"pretty",null),i([a],ce,"styled",null),i([a],ce,"prettyStyled",null);class de extends Error{constructor(e){super(e),Object.setPrototypeOf(this,de.prototype)}}class pe{constructor(e){Object.defineProperty(this,"stripped",{value:e,enumerable:!0})}isStripped(){return this.stripped}asStripped(e){return this.copy(e)}copy(e){return pe.create(e)}canEqual(e){return e instanceof pe}equals(e){return this===e||e instanceof pe&&(e.canEqual(this)&&this.stripped===e.stripped)}hashCode(){return o.mash(o.mix(m.hash(pe),h.hash(this.stripped)))}debug(e){return e=e.write("InputSettings").write(46),e=(e=this.stripped?e.write("stripped"):e.write("standard")).write(40).write(41)}toString(){return Oe.debug(this)}static standard(){return new pe(!1)}static stripped(){return new pe(!0)}static create(e){return e?pe.stripped():pe.standard()}static fromAny(e){return e instanceof pe?e:"object"==typeof e&&null!==e?pe.create(e.isStripped):pe.standard()}}i([a],pe,"standard",null),i([a],pe,"stripped",null);class fe{trap(){throw new de}static empty(){return new ke(void 0,ue.zero,pe.standard())}static done(){return new De(void 0,ue.zero,pe.standard())}static error(e){return new me(e,void 0,ue.zero,pe.standard())}}i([a],fe,"empty",null),i([a],fe,"done",null);class me extends fe{constructor(e,t,r,i){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0}),Object.defineProperty(this,"id",{value:t,enumerable:!0}),Object.defineProperty(this,"mark",{value:r,enumerable:!0}),Object.defineProperty(this,"settings",{value:i,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(e){return this}head(){throw new de}step(){const e=new de("error step");return new me(e,this.id,this.mark,this.settings)}trap(){return this.error}seek(e){const t=new de("error seek");return new me(t,this.id,this.mark,this.settings)}withId(e){return new me(this.error,e,this.mark,this.settings)}withMark(e){return new me(this.error,this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=pe.fromAny(e),new me(this.error,this.id,this.mark,e)}clone(){return this}}class ye extends fe{constructor(e,t,r,i,n,s,o,a){super(),this.string=e,this.index=o,this.part=a,this.id=t,this.offset=r,this.line=i,this.column=n,this.settings=s}isCont(){return this.index<this.string.length}isEmpty(){return this.part&&this.index>=this.string.length}isDone(){return!this.part&&this.index>=this.string.length}isError(){return!1}isPart(){return this.part}asPart(e){return this.part=e,this}head(){const e=this.string,t=this.index;if(t<e.length){const r=e.codePointAt(t);return void 0!==r?r:e.charCodeAt(t)}throw new de}step(){const e=this.string,t=this.index;if(t<e.length){const r=e.codePointAt(t);return this.index=d.offsetByCodePoints(e,t,1),this.offset+=this.index-t,10===r?(this.line+=1,this.column=1):this.column+=1,this}{const e=new de("invalid step");return new me(e,this.id,this.mark,this.settings)}}seek(e){if(void 0!==e){const t=this.index+(e.offset-this.offset);if(0<=t&&t<=this.string.length)return this.index=t,this.offset=e.offset,this.line=e.line,this.column=e.column,this;{const t=new de("invalid seek to "+e);return new me(t,this.id,this.mark,this.settings)}}return this.index=0,this.offset=0,this.line=1,this.column=1,this}withId(e){return this.id=e,this}get mark(){return ue.at(this.offset,this.line,this.column)}withMark(e){return this.offset=e.offset,this.line=e.line,this.column=e.column,this}withSettings(e){return e=pe.fromAny(e),this.settings=e,this}clone(){return new ye(this.string,this.id,this.offset,this.line,this.column,this.settings,this.index,this.part)}static create(e){return new ye(e,void 0,0,1,1,pe.standard(),0,!1)}}class we extends Error{constructor(e){super(e),Object.setPrototypeOf(this,we.prototype)}}class ge{writeln(e){return"string"==typeof e&&this.write(e),this.write(this.settings.lineSeparator)}display(e){return Oe.displayAny(this,e)}debug(e){return Oe.debugAny(this,e)}flush(){return this}push(...e){const t=e.length;for(let r=0;r<t;r+=1)this.write(e[r])}trap(){throw new we}clone(){throw new Error}static full(){return new Ve(ce.standard())}static done(){return new qe(ce.standard())}static error(e){return new Fe(e,ce.standard())}}i([a],ge,"full",null),i([a],ge,"done",null);class ve extends ge{constructor(e,t){super(),this.string=e,this.settings=t}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(e){return this}write(e){if("number"==typeof e)if(e>=0&&e<=55295||e>=57344&&e<=65535)e=String.fromCharCode(e);else if(e>=65536&&e<=1114111){const t=e-65536;e=String.fromCharCode(55296|t>>>10,56320|1023&t)}else e="�";return this.string+=e,this}writeln(e){return void 0!==e&&(this.string=this.string.concat(e)),this.string=this.string.concat(this.settings.lineSeparator),this}withSettings(e){return e=ce.fromAny(e),this.settings=e,this}bind(){return this.string}clone(){return new ve(this.string,this.settings)}toString(){return this.string}}class be extends Error{constructor(e){super(e),Object.setPrototypeOf(this,be.prototype)}}class xe{isCont(){return!0}isDone(){return!1}isError(){return!1}feed(e){throw new be}fork(e){return this}bind(){throw new be}trap(){throw new be}asDone(){throw new be}asError(){throw new be}andThen(e){return new _e(this,e)}static end(){return new We}static done(e){return new He(e)}static error(e){return new Xe(e)}}i([a],xe,"end",null);class Ce extends xe{constructor(e,t,r=0){super(),this.value=e,this.input=t,this.index=r}feed(e){return new Ce(e,""+e)}pull(e){return Ce.write(e,this.value,this.input,this.index)}static write(e,t,r,i=0){const n=r.length;for(;i<n&&e.isCont();){let t=r.codePointAt(i);void 0===t&&(t=r.charCodeAt(i)),e=e.write(t),i=d.offsetByCodePoints(r,i,1)}return i===n?xe.done(t):e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new Ce(t,r,i)}}const Se=function(){const e={stringInput:function(e){return ye.create(e)},stringOutput:function(e,t){return void 0===t&&"string"!=typeof e?(t=e,e=""):"string"!=typeof e&&(e=""),t=ce.fromAny(t),new ve(e,t)},stringWriter:function(e){return void 0===e?new Ce(void 0,""):new Ce(e,""+e)},writeString:function(e,t){return Ce.write(e,void 0,""+t)},isAlpha:function(e){return e>=65&&e<=90||e>=97&&e<=122},isDigit:function(e){return e>=48&&e<=57},isSpace:function(e){return 32===e||9===e},isNewline:function(e){return 10===e||13===e},isWhitespace:function(t){return e.isSpace(t)||e.isNewline(t)}};return e}(),Oe=function(){const e={};return Object.defineProperty(e,"lineSeparator",{value:void 0!==t&&"string"==typeof t.EOL?t.EOL:"\n",enumerable:!0,configurable:!0}),e.display=function(e,t){if(void 0===e)return"undefined";if(null===e)return"null";if("number"==typeof e)return""+e;if("string"==typeof e)return e;if("function"==typeof e.display){let r=Se.stringOutput(t);return r=e.display(r),r.bind()}return""+e},e.debug=function(t,r){if(void 0===t)return"undefined";if(null===t)return"null";if("number"==typeof t)return""+t;if("string"==typeof t){let i=Se.stringOutput(r);return i=e.debugString(i,t),i.bind()}if("function"==typeof t.debug){let e=Se.stringOutput(r);return e=t.debug(e),e.bind()}return""+t},e.displayAny=function(t,r){return t=void 0===r?t.write("undefined"):null===r?t.write("null"):"number"==typeof r?e.displayNumber(t,r):"string"==typeof r?t.write(r):"function"==typeof r.display?r.display(t):t.write(""+r)},e.debugAny=function(t,r){return t=void 0===r?t.write("undefined"):null===r?t.write("null"):"number"==typeof r?e.debugNumber(t,r):"string"==typeof r?e.debugString(t,r):"function"==typeof r.debug?r.debug(t):t.write(""+r)},e.displayNumber=function(t,r){if(isFinite(r)&&Math.floor(r)===r&&Math.abs(r)<2147483648)if(r<0&&(t=t.write(45)),r>-10&&r<10)t=t.write(48+Math.abs(r));else{const e=new Array(19);let i=r,n=18;for(;0!==i;)e[n]=Math.abs(i%10|0),i=i/10|0,n-=1;for(n+=1;n<19;)t=t.write(48+e[n]),n+=1}else t=t.write(e.decimal(r,t.settings.precision));return t},e.debugNumber=function(t,r){return e.displayNumber(t,r)},e.debugChar=function(t,r){switch(t=t.write(39),r){case 8:t.write(92).write(98);break;case 9:t.write(92).write(116);break;case 10:t.write(92).write(110);break;case 12:t.write(92).write(102);break;case 13:t.write(92).write(114);break;case 34:t.write(92).write(34);break;case 39:t.write(92).write(39);break;case 92:t.write(92).write(92);break;default:t=r>=0&&r<=31||r>=127&&r<=159?t.write(92).write(117).write(e.encodeHex(r>>>12&15)).write(e.encodeHex(r>>>8&15)).write(e.encodeHex(r>>>4&15)).write(e.encodeHex(15&r)):t.write(r)}return t=t.write(39)},e.debugString=function(t,r){t=t.write(34);let i=Se.stringInput(r);for(;i.isCont();){const r=i.head();switch(r){case 8:t.write(92).write(98);break;case 9:t.write(92).write(116);break;case 10:t.write(92).write(110);break;case 12:t.write(92).write(102);break;case 13:t.write(92).write(114);break;case 34:t.write(92).write(34);break;case 92:t.write(92).write(92);break;default:t=r>=0&&r<=31||r>=127&&r<=159?t.write(92).write(117).write(e.encodeHex(r>>>12&15)).write(e.encodeHex(r>>>8&15)).write(e.encodeHex(r>>>4&15)).write(e.encodeHex(15&r)):t.write(r)}i=i.step()}return t=t.write(34)},e.encodeHex=function(e){return e<10?48+e:e-10+65},e.prefix=function(){const t=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E"," Z","Y"];return function(r,i=1){if(isFinite(r)){const n=Math.abs(r).toExponential(),s=n.indexOf("e"),o=s>=0?+n.slice(s+1):NaN,a=3*Math.min(Math.max(-8,Math.floor(o/3)),8),u=Math.pow(10,-a)*r;let h=e.trimTrailingZeros(Math.abs(u).toFixed(i));return u<0&&0!=+h&&(h="-"+h),h+=t[8+a/3],h}return""+r}}(),e.decimal=function(t,r=-1){if(r>=0){let i=e.trimTrailingZeros(Math.abs(t).toFixed(r));return t<0&&0!=+i&&(i="-"+i),i}return""+t},e.trimTrailingZeros=function(e){let t,r=-1;for(let i=1,n=e.length;i<n;i+=1){const n=e.charCodeAt(i);if(46===n)r=i,t=i;else if(48===n)0===r&&(r=i),t=i;else if(n>=49&&n<=57)r>0&&(r=0);else if(r>0)break}return r>0&&(e=e.slice(0,r)+e.slice(t+1)),e},e.duration=function(e,t=" "){if(isFinite(e)){const r=1e3,i=60*r,n=60*i,s=24*n,o=7*s;let a,u,h,l,c;e>o&&(a=Math.floor(e/o),e%=o),e>s&&(u=Math.floor(e/s),e%=s),e>n&&(h=Math.floor(e/n),e%=n),e>i&&(l=Math.floor(e/i),e%=i),e>r&&(c=Math.floor(e/r),e%=r);let d="";return void 0!==a&&(d+=a+"w"),void 0!==u&&(d+=(0!==d.length?t:"")+u+"d"),void 0!==h&&(d+=(0!==d.length?t:"")+h+"h"),void 0!==l&&(d+=(0!==d.length?t:"")+l+"m"),void 0===c&&0!==e||(d+=(0!==d.length?t:"")+(void 0!==c?c:0)+"s"),0!==e&&0===d.length&&(d+=e+"ms"),d}return""+e},e}(),Ee=function(){const e={isDigit:function(e){return e>=48&&e<=57},decodeDigit:function(e){if(e>=48&&e<=57)return e-48;{let t=Se.stringOutput();throw t=t.write("Invalid base-10 digit: "),t=Oe.debugChar(t,e),new Error(t.bind())}},encodeDigit:function(e){if(e>=0&&e<=9)return 48+e;throw new Error(""+e)},countDigits:function(e){let t=0;do{t+=1,e=e/10|0}while(0!==e);return t},integerParser:function(){return new st(void 0,void 0,0)},parseInteger:function(e){return st.parse(e,void 0,void 0,0)},decimalParser:function(){return new st(void 0,void 0,1)},parseDecimal:function(e){return st.parse(e,void 0,void 0,1)},numberParser:function(){return new st},parseNumber:function(e){return st.parse(e)},integerWriter:function(e){return new at(void 0,void 0===e?0:e)},writeInteger:function(e,t){return at.write(e,void 0,t)}};return e}();class Ae{constructor(e,t,r,i,n,s){this.input=e,this.tag=t,this.severity=r,this.message=i,this.note=n,this.cause=s}lineDigits(){let e=Ee.countDigits(this.tag.end.line);return null!==this.cause&&(e=Math.max(e,this.cause.lineDigits())),e}display(e){const t=this.input.clone(),r=this.tag.start,i=this.tag.end,n=this.severity,s=this.message,o=this.note,a=this.cause,u=this.lineDigits();return e=Ae.display(e,t,r,i,n,s,o,a,2,u)}static display(e,t,r,i,n,s,o,a,u,h){for(;;){void 0!==s&&(e=(e=Ae.displayMessage(e,n,s)).writeln()),e=(e=Ae.displayAnchor(e,t,r,h)).writeln();const l=Ae.displayContext(e,t,r,i,n,o,a,u,h),c=l[0];if(e=l[1],null===c)break;e=e.writeln(),t=c.input.clone(),r=c.tag.start,i=c.tag.end,n=c.severity,s=c.message,o=c.note,a=c.cause}return e}static displayMessage(e,t,r){return e=(e=Ae.formatSeverity(e,t)).write(t.label),e=le.reset(e),e=(e=le.bold(e)).write(58),void 0!==r&&(e=e.write(32).write(r)),e=le.reset(e)}static displayAnchor(e,t,r,i){e=(e=Ae.displayLineLeadArrow(e,i)).write(32);const n=t.id;return void 0!==n&&(e=Oe.displayAny(e,n)),e=e.write(58),e=(e=Oe.displayNumber(e,r.line)).write(58),e=(e=Oe.displayNumber(e,r.column)).writeln(),e=Ae.displayLineLead(e,i)}static displayContext(e,t,r,i,n,s,o,a,u){let h=o;const l=null!==o&&void 0===o.message&&b.equal(t.id,o.input.id)?r.offset<=o.tag.start.offset?-1:1:0;if(1===l){const t=Ae.displayContext(e,o.input.clone(),o.tag.start,o.tag.end,o.severity,o.note,o.cause,a,u);h=t[0],e=(e=t[1]).writeln(),e=(e=Ae.displayLineLeadEllipsis(e,u)).writeln()}if(e=Ae.displayLines(e,t,r,i,n,a,u),void 0!==s&&(e=Ae.displayNote(e,s,u)),-1===l){e=e.writeln(),e=(e=Ae.displayLineLeadEllipsis(e,u)).writeln();const t=Ae.displayContext(e,o.input.clone(),o.tag.start,o.tag.end,o.severity,o.note,o.cause,a,u);h=t[0],e=t[1]}return[h,e]}static displayLines(e,t,r,i,n,s,o){const a=r.line,u=i.line;let h=t.line;for(;h<a;)Ae.consumeLineText(t,h),h+=1;if(u-a>2*s+2){for(;h<=a+s;)e=Ae.displayLine(e,t,r,i,n,h,o),h+=1;for(e=(e=Ae.displayLineLeadEllipsis(e,o)).write(32),e=(e=Ae.formatSeverity(e,n)).write(124),e=(e=le.reset(e)).writeln();h<u-s;)Ae.consumeLineText(t,h),h+=1}for(;h<=u;)e=Ae.displayLine(e,t,r,i,n,h,o),h+=1;return e}static displayNote(e,t,r){return e=e.writeln(),e=(e=Ae.displayLineLead(e,r)).writeln(),e=Ae.displayLineComment(e,"note",t,r)}static displayLine(e,t,r,i,n,s,o){return e=r.line===s&&i.line===s?Ae.displaySingleLine(e,t,r,i,n,s,o):r.line===s?Ae.displayStartLine(e,t,r,n,s,o):i.line===s?Ae.displayEndLine(e,t,i,n,s,o):Ae.displayMidLine(e,t,n,s,o)}static displaySingleLine(e,t,r,i,n,s,o){e=(e=Ae.displayLineLeadNumber(e,s,o)).write(32);for(let r=1;r<t.column;r+=1)e=e.write(32);e=Ae.displayLineText(e,t,s),e=(e=Ae.displayLineLead(e,o)).write(32);let a=1;for(;a<r.column;)e=e.write(32),a+=1;for(e=Ae.formatSeverity(e,n);a<=i.column;)e=e.write(94),a+=1;return void 0!==i.note&&(e=e.write(32).write(i.note)),e=le.reset(e)}static displayStartLine(e,t,r,i,n,s){e=(e=Ae.displayLineLeadNumber(e,n,s)).write(32).write(32).write(32);for(let r=1;r<t.column;r+=1)e=e.write(32);e=Ae.displayLineText(e,t,n),e=(e=Ae.displayLineLead(e,s)).write(32).write(32),e=(e=Ae.formatSeverity(e,i)).write(95);let o=1;for(;o<r.column;)e=e.write(95),o+=1;return e=e.write(94),void 0!==r.note&&(e=e.write(32).write(r.note)),e=(e=le.reset(e)).writeln()}static displayEndLine(e,t,r,i,n,s){e=(e=Ae.displayLineLeadNumber(e,n,s)).write(32),e=(e=Ae.formatSeverity(e,i)).write(124),e=(e=le.reset(e)).write(32),e=Ae.displayLineText(e,t,n),e=(e=Ae.displayLineLead(e,s)).write(32),e=(e=Ae.formatSeverity(e,i)).write(124).write(95);let o=1;for(;o<r.column;)e=e.write(95),o+=1;return e=e.write(94),void 0!==r.note&&(e=e.write(32).write(r.note)),e=le.reset(e)}static displayMidLine(e,t,r,i,n){return e=(e=Ae.displayLineLeadNumber(e,i,n)).write(32),e=(e=Ae.formatSeverity(e,r)).write(124),e=(e=le.reset(e)).write(32),e=Ae.displayLineText(e,t,i)}static displayLineComment(e,t,r,i){return e=(e=Ae.displayLineLeadComment(e,i)).write(32),e=(e=le.bold(e)).write(t).write(58),e=le.reset(e),void 0!==r&&(e=e.write(32).write(r)),e}static displayLineLead(e,t){e=le.blueBold(e);const r=1+t;for(let t=0;t<r;t+=1)e=e.write(32);return e=e.write(124),e=le.reset(e)}static displayLineLeadComment(e,t){e=le.blueBold(e);const r=1+t;for(let t=0;t<r;t+=1)e=e.write(32);return e=e.write(61),e=le.reset(e)}static displayLineLeadArrow(e,t){for(let r=0;r<t;r+=1)e=e.write(32);return e=(e=le.blueBold(e)).write(45).write(45).write(62),e=le.reset(e)}static displayLineLeadEllipsis(e,t){e=le.blueBold(e);for(let r=0;r<t;r+=1)e=e.write(46);return e=(e=le.reset(e)).write(32).write(32)}static displayLineLeadNumber(e,t,r){const i=r-Ee.countDigits(t);for(let t=0;t<i;t+=1)e=e.write(32);return e=le.blueBold(e),e=(e=Oe.displayNumber(e,t)).write(32).write(124),e=le.reset(e)}static displayLineText(e,t,r){for(;t.isCont()&&t.line===r;)e=e.write(t.head()),t=t.step();return t.line===r&&(e=e.writeln()),e}static consumeLineText(e,t){for(;e.isCont()&&e.line===t;)e=e.step()}static formatSeverity(e,t){switch(t.level){case oe.FATAL_LEVEL:case oe.ALERT_LEVEL:case oe.ERROR_LEVEL:e=le.redBold(e);break;case oe.WARNING_LEVEL:e=le.yellowBold(e);break;case oe.NOTE_LEVEL:e=le.greenBold(e);break;case oe.INFO_LEVEL:e=le.cyanBold(e);break;case oe.DEBUG_LEVEL:case oe.TRACE_LEVEL:default:e=le.magentaBold(e)}return e}toString(e){return Oe.display(this,e)}static create(e,t,r,i,n,s){return 3===arguments.length?(s=null,n=void 0,i=void 0):4===arguments.length?null===i||i instanceof Ae?(s=i,i=void 0):s=null:5===arguments.length?null===n||n instanceof Ae?(s=n,n=void 0):s=null:void 0===s&&(s=null),new Ae(e.clone(),t,r,i,n,s)}static message(e,t,r,i,n){2===arguments.length?(n=null,i=void 0,r=oe.error()):3===arguments.length?null===r||r instanceof Ae?(n=r,r=oe.error()):"string"==typeof r?(n=null,i=r,r=oe.error()):n=null:4===arguments.length?"string"==typeof r?(n=i,i=r,r=oe.error()):null===i||i instanceof Ae?(n=i,i=void 0):n=null:void 0===n&&(n=null);const s=t.mark,o=t.clone();return o.seek(),new Ae(o,s,r,e,i,n)}static unexpected(e,t,r,i){let n;if(1===arguments.length?(i=null,t=oe.error()):2===arguments.length?null===t||t instanceof Ae?(i=t,t=oe.error()):"string"==typeof t?(i=null,r=t,t=oe.error()):i=null:3===arguments.length?"string"==typeof t?(i=r,r=t,t=oe.error()):null===r||r instanceof Ae?(i=r,r=void 0):i=null:void 0===i&&(i=null),e.isCont()){let t=Se.stringOutput().write("unexpected").write(32);t=Oe.debugChar(t,e.head()),n=t.bind()}else n="unexpected end of input";const s=e.mark,o=e.clone();return o.seek(),new Ae(o,s,t,n,r,i)}static expected(e,t,r,i,n){2===arguments.length?(n=null,r=oe.error()):3===arguments.length?null===r||r instanceof Ae?(n=r,r=oe.error()):"string"==typeof r?(n=null,i=r,r=oe.error()):n=null:4===arguments.length?"string"==typeof r?(n=i,i=r,r=oe.error()):null===i||i instanceof Ae?(n=i,i=void 0):n=null:void 0===n&&(n=null);let s=Se.stringOutput().write("expected").write(32);s="number"==typeof e?Oe.debugChar(s,e):s.write(e),s=s.write(44).write(32).write("but found").write(32),s=t.isCont()?Oe.debugChar(s,t.head()):s.write("end of input");const o=s.bind(),a=t.mark,u=t.clone();return u.seek(),new Ae(u,a,r,o,i,n)}}class ke extends fe{constructor(e,t,r){super(),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(e){return e?this:new De(this.id,this.mark,this.settings)}head(){throw new de}step(){const e=new de("empty step");return new me(e,this.id,this.mark,this.settings)}seek(e){const t=new de("empty seek");return new me(t,this.id,this.mark,this.settings)}withId(e){return new ke(e,this.mark,this.settings)}withMark(e){return new ke(this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=pe.fromAny(e),new ke(this.id,this.mark,e)}clone(){return this}}class De extends fe{constructor(e,t,r){super(),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(e){return e?new ke(this.id,this.mark,this.settings):this}head(){throw new de}step(){const e=new de("done step");return new me(e,this.id,this.mark,this.settings)}seek(e){const t=new de("empty seek");return new me(t,this.id,this.mark,this.settings)}withId(e){return new De(e,this.mark,this.settings)}withMark(e){return new De(this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=pe.fromAny(e),new De(this.id,this.mark,e)}clone(){return this}}class Pe extends fe{static empty(){return new Te(void 0,ue.zero,pe.standard())}static done(){return new Ie(void 0,ue.zero,pe.standard())}static error(e){return new Me(e,void 0,ue.zero,pe.standard())}}i([a],Pe,"empty",null),i([a],Pe,"done",null);class Te extends Pe{constructor(e,t,r){super(),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(e){return e?this:new Ie(this.id,this.mark,this.settings)}get index(){return 0}withIndex(e){if(0===e)return this;{const e=new de("invalid index");return new Me(e,this.id,this.mark,this.settings)}}get limit(){return 0}withLimit(e){if(0===e)return this;{const e=new de("invalid limit");return new Me(e,this.id,this.mark,this.settings)}}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new de}set(e,t){throw new de}head(){throw new de}step(e){const t=new de("empty step");return new Me(t,this.id,this.mark,this.settings)}seek(e){const t=new de("empty seek");return new Me(t,this.id,this.mark,this.settings)}withId(e){return new Te(e,this.mark,this.settings)}withMark(e){return new Te(this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=pe.fromAny(e),new Te(this.id,this.mark,e)}clone(){return this}}class Ie extends Pe{constructor(e,t,r){super(),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(e){return e?new Te(this.id,this.mark,this.settings):this}get index(){return 0}withIndex(e){if(0===e)return this;{const e=new de("invalid index");return new Me(e,this.id,this.mark,this.settings)}}get limit(){return 0}withLimit(e){if(0===e)return this;{const e=new de("invalid limit");return new Me(e,this.id,this.mark,this.settings)}}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new de}set(e,t){throw new de}head(){throw new de}step(e){const t=new de("done step");return new Me(t,this.id,this.mark,this.settings)}seek(e){const t=new de("done seek");return new Me(t,this.id,this.mark,this.settings)}withId(e){return new Ie(e,this.mark,this.settings)}withMark(e){return new Ie(this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=pe.fromAny(e),new Ie(this.id,this.mark,e)}clone(){return this}}class Me extends Pe{constructor(e,t,r,i){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0}),Object.defineProperty(this,"id",{value:t,enumerable:!0}),Object.defineProperty(this,"mark",{value:r,enumerable:!0}),Object.defineProperty(this,"settings",{value:i,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(e){return this}get index(){return 0}withIndex(e){if(0===e)return this;{const e=new de("invalid index");return new Me(e,this.id,this.mark,this.settings)}}get limit(){return 0}withLimit(e){if(0===e)return this;{const e=new de("invalid limit");return new Me(e,this.id,this.mark,this.settings)}}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new de}set(e,t){throw new de}head(){throw new de}step(e){const t=new de("error step");return new Me(t,this.id,this.mark,this.settings)}trap(){return this.error}seek(e){const t=new de("error seek");return new Me(t,this.id,this.mark,this.settings)}withId(e){return new Me(this.error,e,this.mark,this.settings)}withMark(e){return new Me(this.error,this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=pe.fromAny(e),new Me(this.error,this.id,this.mark,e)}clone(){return this}}class Ve extends ge{constructor(e){super(),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(e){return e?this:new qe(this.settings)}write(e){return new Fe(new we("full"),this.settings)}writeln(e){return new Fe(new we("full"),this.settings)}bind(){throw new we}withSettings(e){return e=ce.fromAny(e),new Ve(e)}clone(){return this}}class qe extends ge{constructor(e){super(),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(e){return e?new Ve(this.settings):this}write(e){return new Fe(new we("done"),this.settings)}writeln(e){return new Fe(new we("done"),this.settings)}bind(){throw new we}withSettings(e){return e=ce.fromAny(e),new qe(e)}clone(){return this}}class Fe extends ge{constructor(e,t){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0}),Object.defineProperty(this,"settings",{value:t,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(e){return this}write(e){return this}writeln(e){return this}bind(){throw new we}trap(){return this.error}withSettings(e){return e=ce.fromAny(e),new Fe(this.error,e)}clone(){return this}}class Ne extends ge{writeln(e){return"string"==typeof e&&this.write(e),this.write(this.settings.lineSeparator)}flush(){return this}clone(){throw new Error}static full(){return new ze(ce.standard())}static done(){return new Ue(ce.standard())}static error(e){return new Re(e,ce.standard())}}i([a],Ne,"full",null),i([a],Ne,"done",null);class ze extends Ne{constructor(e){super(),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(e){return e?this:new Ue(this.settings)}get index(){return 0}withIndex(e){return 0===e?this:new Re(new we("invalid index"),this.settings)}get limit(){return 0}withLimit(e){return 0===e?this:new Re(new we("invalid limit"),this.settings)}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new we}set(e,t){throw new we}write(e){return new Re(new we("full"),this.settings)}writeln(e){return new Re(new we("full"),this.settings)}step(e=1){return 0===e?this:new Re(new we("invalid step"),this.settings)}bind(){throw new we}withSettings(e){return e=ce.fromAny(e),new ze(e)}clone(){return this}}class Ue extends Ne{constructor(e){super(),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(e){return e?new ze(this.settings):this}get index(){return 0}withIndex(e){return 0===e?this:new Re(new we("invalid index"),this.settings)}get limit(){return 0}withLimit(e){return 0===e?this:new Re(new we("invalid limit"),this.settings)}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new we}set(e,t){throw new we}write(e){return new Re(new we("done"),this.settings)}writeln(e){return new Re(new we("done"),this.settings)}step(e=1){return 0===e?this:new Re(new we("invalid step"),this.settings)}bind(){throw new we}withSettings(e){return e=ce.fromAny(e),new Ue(e)}clone(){return this}}class Re extends Ne{constructor(e,t){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0}),Object.defineProperty(this,"settings",{value:t,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(e){return this}get index(){return 0}withIndex(e){return 0===e?this:new Re(new we("invalid index"),this.settings)}get limit(){return 0}withLimit(e){return 0===e?this:new Re(new we("invalid limit"),this.settings)}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new we}set(e,t){throw new we}write(e){return this}writeln(e){return this}step(e=1){return 0===e?this:new Re(new we("invalid step"),this.settings)}bind(){throw new we}trap(){return this.error}withSettings(e){return e=ce.fromAny(e),new Re(this.error,e)}clone(){return this}}class je extends Error{constructor(e){super(e instanceof Ae?e.message:e),Object.setPrototypeOf(this,je.prototype),this.diagnostic=e instanceof Ae?e:null}toString(){return null!==this.diagnostic?this.diagnostic.toString():super.toString()}}class Le{isCont(){return!0}isDone(){return!1}isError(){return!1}fork(e){return this}bind(){throw new je}trap(){throw new je}asError(){throw new je}static done(e){return new Be(e)}static error(e){return e instanceof Error?new Ke(e):new Ke(new je(e))}}class Be extends Le{constructor(e){super(),Object.defineProperty(this,"value",{value:e,enumerable:!0})}isCont(){return!1}isDone(){return!0}feed(e){return this}bind(){return this.value}}class Ke extends Le{constructor(e){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0})}isCont(){return!1}isError(){return!0}feed(e){return this}bind(){throw this.error}trap(){return this.error}asError(){return this}}class We extends xe{constructor(){super()}isCont(){return!1}isDone(){return!0}pull(e){return this}bind(){throw new be}asDone(){return this}andThen(e){return e}}class He extends xe{constructor(e){super(),Object.defineProperty(this,"value",{value:e,enumerable:!0})}isCont(){return!1}isDone(){return!0}pull(e){return this}bind(){return this.value}asDone(){return this}andThen(e){return e}}class Xe extends xe{constructor(e){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0})}isCont(){return!1}isError(){return!0}pull(e){return this}bind(){throw this.error}trap(){return this.error}asError(){return this}andThen(e){return this}}class _e extends xe{constructor(e,t){super(),this.head=e,this.tail=t}pull(e){let t=this.head;return t.isCont()&&(t=t.pull(e)),t.isError()?t.asError():t.isDone()?this.tail.pull(e):new _e(t,this.tail)}}class Ge extends ge{constructor(e,t,r){super(),this.array=e,this.size=t,this.settings=r}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(e){return this}write(e){if("number"==typeof e){const t=this.size,r=this.array;let i;return null===r||t+1>r.length?(i=new Uint8Array(Ge.expand(t+1)),null!==r&&i.set(r,0),this.array=i):i=r,i[t]=e,this.size=t+1,this}throw new TypeError(""+e)}writeln(e){throw new TypeError(""+e)}toUint8Array(){const e=this.size,t=this.array;if(null!==t&&e===t.length)return t;{const r=new Uint8Array(e);return null!==t&&r.set(t.slice(0,e),0),this.array=r,r}}cloneArray(){const e=this.array;return null!==e?e.slice(0,this.size):null}withSettings(e){return e=ce.fromAny(e),this.settings=e,this}static expand(e){return e=Math.max(32,e)-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}}class Ye extends Ge{constructor(e,t,r){super(e,t,r)}bind(){return this.toUint8Array()}clone(){return new Ye(this.cloneArray(),this.size,this.settings)}}class Ze extends Ne{constructor(e,t,r,i,n){super(),this.array=e,this.index=t,this.limit=r,this.part=i,this.settings=n}isCont(){return this.index<this.limit}isFull(){return this.part&&this.index>=this.limit}isDone(){return!this.part&&this.index>=this.limit}isError(){return!1}isPart(){return this.part}asPart(e){return this.part=e,this}withIndex(e){return 0<=e&&e<=this.limit?(this.index=e,this):new Re(new we("invalid index"),this.settings)}withLimit(e){return 0<=e&&e<=this.array.length?(this.limit=e,this):new Re(new we("invalid limit"),this.settings)}get capacity(){return this.array.length}get remaining(){return this.limit-this.index}has(e){return 0<=e&&e<this.limit}get(e){if(0<=e&&e<this.limit)return this.array[e];throw new we}set(e,t){if(!(0<=e&&e<this.limit))throw new we;this.array[e]=t}write(e){if("number"==typeof e){const t=this.index;return t<this.limit?(this.array[t]=e,this.index+=1,this):new Re(new we("full"),this.settings)}return new Re(new we("binary output"),this.settings)}writeln(e){return new Re(new we("binary output"),this.settings)}step(e){const t=this.index+e;return 0<=t&&t<=this.limit?(this.index=t,this):new Re(new we("invalid step"),this.settings)}bind(){return new Uint8Array(this.array.buffer,0,this.index)}withSettings(e){return e=ce.fromAny(e),this.settings=e,this}clone(){return new Ze(this.array,this.index,this.limit,this.part,this.settings)}static create(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.length),new Ze(e,t,t+r,!1,ce.standard())}}const Qe=function(){const e={output:function(e,t){let r;return void 0===t&&"number"!=typeof e?(t=e,e=void 0):"number"!=typeof e&&(e=void 0),r="number"==typeof e?new Uint8Array(e):null,t=ce.fromAny(t),new Ye(r,0,t)},outputBuffer:function(e,t,r){return Ze.create(e,t,r)}};return e}();class $e{isFatal(){return!1}isReplacement(){return!1}toString(){return Oe.debug(this)}static fatal(){return new Je(!1)}static fatalNonZero(){return new Je(!0)}static replacement(){return new et(65533,!1)}static replacementNonZero(){return new et(65533,!0)}}i([a],$e,"fatal",null),i([a],$e,"fatalNonZero",null),i([a],$e,"replacement",null),i([a],$e,"replacementNonZero",null);class Je extends $e{constructor(e){super(),Object.defineProperty(this,"nonZero",{value:e,enumerable:!0})}isFatal(){return!0}get replacementChar(){return 65533}isNonZero(){return this.nonZero}asNonZero(e){return e?$e.fatalNonZero():$e.fatal()}equals(e){return this===e||e instanceof Je&&this.nonZero===e.nonZero}hashCode(){return o.mash(o.mix(m.hash(Je),h.hash(this.nonZero)))}debug(e){return e=e.write("UtfErrorMode").write(46).write(this.nonZero?"fatalNonZero":"fatal").write(40).write(41)}}class et extends $e{constructor(e,t){super(),Object.defineProperty(this,"replacementChar",{value:e,enumerable:!0}),Object.defineProperty(this,"nonZero",{value:t,enumerable:!0})}isReplacement(){return!0}isNonZero(){return this.nonZero}asNonZero(e){return 65533===this.replacementChar?e?$e.replacementNonZero():$e.replacement():new et(this.replacementChar,e)}equals(e){return this===e||e instanceof et&&(this.replacementChar===e.replacementChar&&this.nonZero===e.nonZero)}hashCode(){return o.mash(o.mix(o.mix(m.hash(et),c.hash(this.replacementChar)),h.hash(this.nonZero)))}debug(e){return e=e.write("UtfErrorMode").write(46).write(this.nonZero?"replacementNonZero":"replacement").write(40).write(41)}}class tt{constructor(e){Object.defineProperty(this,"alphabet",{value:e,enumerable:!0})}encodeDigit(e){return this.alphabet.charCodeAt(e)}uint8ArrayWriter(e){return void 0===e?new ht(this,void 0,null):new ht(this,e,e)}writeUint8Array(e,t){return ht.write(e,this,void 0,t)}writeInteger(e,t,r=0){return lt.write(e,this,void 0,t,r)}writeIntegerLiteral(e,t,r=0){return lt.writeLiteral(e,this,void 0,t,r)}static get lowercase(){return new tt("0123456789abcdef")}static get uppercase(){return new tt("0123456789ABCDEF")}static isDigit(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}static decodeDigit(e){if(e>=48&&e<=57)return e-48;if(e>=65&&e<=70)return e-65+10;if(e>=97&&e<=102)return e-97+10;{let t=Se.stringOutput();throw t=t.write("Invalid base-16 digit: "),t=Oe.debugChar(t,e),new Error(t.bind())}}static writeQuantum(e,t,r){const i=tt.decodeDigit(t),n=tt.decodeDigit(r);return e=e.write(i<<4|n)}static parser(e){return new ut(e)}static parse(e,t){return ut.parse(e,t)}static parseUint8Array(e){return ut.parse(e,Qe.output())}}i([a],tt,"lowercase",null),i([a],tt,"uppercase",null);class rt extends ge{constructor(e,t,r,i,n,s){super(),this.output=e,this.errorMode=t,this.c1=r,this.c2=i,this.c3=n,this.have=s}isCont(){return this.output.isCont()}isFull(){return this.output.isFull()}isDone(){return this.output.isDone()}isError(){return this.output.isError()}isPart(){return this.output.isPart()}asPart(e){return this.output=this.output.asPart(e),this}write(e){if("number"==typeof e){let t=this.c1,r=this.c2,i=this.c3,n=-1,s=this.have;if(e>=0)switch(s){case 0:t=255&e,s=1;break;case 1:r=255&e,s=2;break;case 2:i=255&e,s=3;break;case 3:n=255&e,s=4;break;default:throw new Error("unreachable")}if(0===t&&this.errorMode.isNonZero())return ge.error(new we("unexpected NUL byte"));if(t>=0&&t<=127)this.output=this.output.write(t),this.have=0;else if(t>=194&&t<=244)if(t>=194&&t<=223&&r>=128&&r<=191)this.output=this.output.write((31&t)<<6|63&r),this.c1=-1,this.have=0;else if(224===t&&r>=160&&r<=191||t>=225&&t<=236&&r>=128&&r<=191||237===t&&r>=128&&r<=159||t>=238&&t<=239&&r>=128&&r<=191)if(i>=128&&i<=191)this.output=this.output.write((15&t)<<12|(63&r)<<6|63&i),this.c1=-1,this.c2=-1,this.have=0;else if(i>=0){if(this.errorMode.isFatal())return ge.error(new we(rt.invalid(t,r,i)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=i,this.c2=-1,this.have=1}else{if(e<0||this.output.isDone())return ge.error(new we(rt.invalid(t,r)));this.c2=r,this.have=2}else if(240===t&&r>=144&&r<=191||t>=241&&t<=243&&r>=128&&r<=191||244===t&&r>=128&&r<=143)if(i>=128&&i<=191)if(n>=128&&n<=191)this.have=4,this.output=this.output.write((7&t)<<18|(63&r)<<12|(63&i)<<6|63&n),this.c1=-1,this.c2=-1,this.c3=-1,this.have=0;else if(n>=0){if(this.errorMode.isFatal())return ge.error(new we(rt.invalid(t,r,i,n)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=n,this.c2=-1,this.c3=-1,this.have=1}else{if(e<0||this.output.isDone())return ge.error(new we(rt.invalid(t,r,i)));this.c3=i,this.have=3}else if(i>=0){if(this.errorMode.isFatal())return ge.error(new we(rt.invalid(t,r,i)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=i,this.c2=-1,this.have=1}else{if(e<0||this.output.isDone())return ge.error(new we(rt.invalid(t,r)));this.c2=r,this.have=2}else if(r>=0){if(this.errorMode.isFatal())return ge.error(new we(rt.invalid(t,r)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=r,this.have=1}else{if(e<0||this.output.isDone())return ge.error(new we(rt.invalid(t)));this.c1=t,this.have=1}else if(t>=0){if(this.errorMode.isFatal())return ge.error(new we(rt.invalid(t)));this.output=this.output.write(this.errorMode.replacementChar),this.have=0}return this.output.isError()?this.output:this}if("string"==typeof e)return this.output=this.output.write(e),this;throw new TypeError(""+e)}static invalid(e,t,r,i){let n=Se.stringOutput();n=n.write("invalid UTF-8 code unit sequence: ");const s=tt.uppercase;return s.writeIntegerLiteral(n,e,2),void 0!==t&&(n=n.write(" "),s.writeIntegerLiteral(n,t,2),void 0!==r&&(n=n.write(" "),s.writeIntegerLiteral(n,r,2),void 0!==i&&(n=n.write(" "),s.writeIntegerLiteral(n,i,2)))),n.bind()}get settings(){return this.output.settings}withSettings(e){return this.output=this.output.withSettings(e),this}bind(){return 0===this.have?this.output.bind():this.write(-1).bind()}trap(){return this.output.trap()}clone(){return new rt(this.output.clone(),this.errorMode,this.c1,this.c2,this.c3,this.have)}static create(e,t){return void 0===t&&(t=$e.fatal()),new rt(e,t,-1,-1,-1,0)}}class it extends ge{constructor(e,t,r,i,n,s){super(),this.output=e,this.errorMode=t,this.c2=r,this.c3=i,this.c4=n,this.index=s}isCont(){return this.output.isCont()}isFull(){return this.output.isFull()}isDone(){return this.output.isDone()}isError(){return!1}isPart(){return this.output.isPart()}asPart(e){return this.output=this.output.asPart(e),this}write(e){if("number"==typeof e){let t=0,r=this.c2,i=this.c3,n=this.c4,s=this.output,o=this.index;for(;o<4;){if(!s.isCont())return ge.error(new we("unable to flush buffered code units"));switch(o){case 1:s=s.write(r),this.c2=0;break;case 2:s=s.write(i),this.c3=0;break;case 3:s=s.write(n),this.c4=0;break;default:throw new Error("unreachable")}o+=1}if(e>=0&&e<=127)n=e,o=3;else if(e>=128&&e<=2047)i=192|e>>>6,n=128|63&e,o=2;else if(e>=2048&&e<=65535||e>=57344&&e<=65535)r=224|e>>>12,i=128|e>>>6&63,n=128|63&e,o=1;else{if(!(e>=65536&&e<=1114111))return this.errorMode.isFatal()?ge.error(new we("invalid code point: "+e)):this.write(this.errorMode.replacementChar);t=240|e>>>18,r=128|e>>>12&63,i=128|e>>>6&63,n=128|63&e,o=0}do{switch(o){case 0:s=s.write(t);break;case 1:s=s.write(r),this.c2=0;break;case 2:s=s.write(i),this.c3=0;break;case 3:s=s.write(n),this.c4=0;break;default:throw new Error("unreachable")}this.output=s,o+=1}while(o<4&&s.isCont());return o<4&&(o<3&&(o<2&&(this.c2=r),this.c3=i),this.c4=n),this.output=s,this.index=o,this}if("string"==typeof e)return this.output=this.output.write(e),this;throw new TypeError(""+e)}flush(){let e=this.output,t=this.index;for(;t<4;){if(!e.isCont())return ge.error(new we("unable to flush buffered code units"));switch(t){case 1:e=e.write(this.c2),this.c2=0;break;case 2:e=e.write(this.c3),this.c3=0;break;case 3:e=e.write(this.c4),this.c4=0;break;default:throw new Error("unreachable")}t+=1}return this.output=e,this.index=t,this}get settings(){return this.output.settings}withSettings(e){return this.output=this.output.withSettings(e),this}bind(){return this.output.bind()}clone(){return new it(this.output.clone(),this.errorMode,this.c2,this.c3,this.c4,this.index)}static create(e,t){return void 0===t&&(t=$e.fatal()),new it(e,t,0,0,0,4)}}const nt=function(){const e={sizeOf:function(t,r){if("number"==typeof t||void 0===t){if("number"==typeof t){if(0===t&&void 0!==r&&r.isNonZero())return 2;if(t>=0&&t<=127)return 1;if(t>=128&&t<=2047)return 2;if(t>=2048&&t<=65535||t>=57344&&t<=65535)return 3;if(t>=65536&&t<=1114111)return 4}return void 0===r?3:r.isReplacement()?e.sizeOf(r.replacementChar):0}if("string"==typeof t){let i=0;for(let n=0,s=t.length;n<s;n=d.offsetByCodePoints(t,n,1))i+=e.sizeOf(t.charCodeAt(n),r);return i}throw new TypeError(""+t)},decodedOutput:function(e,t){return rt.create(e,t)},encodedOutput:function(e,t){return it.create(e,t)},decodedString:function(){return e.decodedOutput(Se.stringOutput())}};return e}();class st extends Le{constructor(e=1,t=0,r=2,i=1){super(),this.sign=e,this.value=t,this.mode=r,this.step=i}feed(e){return st.parse(e,this.sign,this.value,this.mode,this.step)}static parse(e,t=1,r=0,i=2,n=1){let s=0;if(1===n)if(e.isCont())s=e.head(),45===s?(e=e.step(),t=-1):43===s&&(e=e.step(),t=1),n=2;else if(e.isDone())return Le.error(Ae.expected("number",e));if(2===n)if(e.isCont())if(s=e.head(),48===s)e=e.step(),n=4;else{if(!(s>=49&&s<=57)){if(i>0&&46===s){let r=Se.stringOutput();return t<0&&(r=r.write(45)),ot.parse(e,r,i)}return Le.error(Ae.expected("number",e))}e=e.step(),r=t*(s-48),n=3}else if(e.isDone())return Le.error(Ae.expected("number",e));if(3===n){for(;e.isCont()&&(s=e.head(),s>=48&&s<=57);){const i=10*r+t*(s-48);if(!(-9007199254740991<=i&&i<=9007199254740992))return Le.error(Ae.message("integer overflow",e));r=i,e=e.step()}if(e.isCont())n=4;else if(e.isDone())return Le.done(r)}if(4===n){if(e.isCont()){if(s=e.head(),i>0&&46===s||i>1&&(69===s||101===s)){let n=Se.stringOutput();return n=t<0&&0===r?n.write(45).write(48):n.write(""+r),ot.parse(e,n,i)}return Le.done(r)}if(e.isDone())return Le.done(r)}return new st(t,r,i,n)}}class ot extends Le{constructor(e,t=2,r=1){super(),this.output=e,this.mode=t,this.step=r}feed(e){return ot.parse(e,this.output,this.mode,this.step)}static parse(e,t,r=2,i=1){let n=0;if(1===i)if(e.isCont())if(n=e.head(),46===n)e=e.step(),t=t.write(n),i=2;else{if(!(r>1)||69!==n&&101!==n)return Le.error(Ae.expected("decimal or exponent",e));e=e.step(),t=t.write(n),i=5}else if(e.isDone())return Le.error(Ae.expected("decimal or exponent",e));if(2===i)if(e.isCont()){if(n=e.head(),!(n>=48&&n<=57))return Le.error(Ae.expected("digit",e));e=e.step(),t=t.write(n),i=3}else if(e.isDone())return Le.error(Ae.expected("digit",e));if(3===i){for(;e.isCont()&&(n=e.head(),n>=48&&n<=57);)e=e.step(),t=t.write(n);if(e.isCont()){if(!(r>1))return Le.done(+t.bind());i=4}else if(e.isDone())return Le.done(+t.bind())}if(4===i){if(n=e.head(),69!==n&&101!==n)return Le.done(+t.bind());e=e.step(),t=t.write(n),i=5}if(5===i)if(e.isCont())n=e.head(),43!==n&&45!==n||(e=e.step(),t=t.write(n)),i=6;else if(e.isDone())return Le.error(Ae.unexpected(e));if(6===i)if(e.isCont()){if(n=e.head(),!(n>=48&&n<=57))return Le.error(Ae.expected("digit",e));e=e.step(),t=t.write(n),i=7}else if(e.isDone())return Le.error(Ae.expected("digit",e));if(7===i){for(;e.isCont()&&(n=e.head(),n>=48&&n<=57);)e=e.step(),t=t.write(n);if(!e.isEmpty())return Le.done(+t.bind())}return new ot(t,r,i)}}class at extends xe{constructor(e,t,r=0,i=1){super(),this.value=e,this.input=t,this.index=r,this.step=i}pull(e){return at.write(e,this.value,this.input,this.index,this.step)}static write(e,t,r,i=0,n=1){if(0===n)return xe.end();if(1===n&&(r<0?e.isCont()&&(e=e.write(45),n=2):n=2),2===n)if(r>-10&&r<10){if(e.isCont())return e=e.write(Ee.encodeDigit(Math.abs(0|r))),xe.done(t)}else{const n=new Array(19);let s=r,o=18;for(;0!==s;)n[o]=Math.abs(s%10|0),s=s/10|0,o-=1;for(o+=1+i;o<19&&e.isCont();)e=e.write(Ee.encodeDigit(n[o])),i+=1,o+=1;if(19===o)return xe.done(t)}return e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new at(t,r,i,n)}}class ut extends Le{constructor(e,t=0,r=1){super(),this.output=e,this.p=t,this.step=r}feed(e){return ut.parse(e,this.output.clone(),this.p,this.step)}static parse(e,t,r=0,i=1){let n=0;for(;!e.isEmpty();){if(1===i)if(e.isCont()&&(n=e.head(),tt.isDigit(n)))e=e.step(),r=n,i=2;else if(!e.isEmpty())return Le.done(t.bind());if(2===i)if(e.isCont()&&(n=e.head(),tt.isDigit(n)))e=e.step(),t=tt.writeQuantum(t,r,n),r=0,i=1;else if(!e.isEmpty())return Le.error(Ae.expected("base16 digit",e))}return new ut(t,r,i)}}class ht extends xe{constructor(e,t,r,i=0,n=1){super(),this.base16=e,this.value=t,this.input=r,this.index=i,this.step=n}feed(e){if(e instanceof Uint8Array)return new ht(this.base16,void 0,e);throw new TypeError(""+e)}pull(e){if(null===this.input)throw new be;return ht.write(e,this.base16,this.value,this.input,this.index,this.step)}static write(e,t,r,i,n=0,s=1){for(;n<i.length;){const r=i[n];1===s&&e.isCont()&&(e=e.write(t.encodeDigit(r>>>4)),s=2),2===s&&e.isCont()&&(e=e.write(t.encodeDigit(15&r)),n+=1,s=1)}return n===i.length?xe.done(r):e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new ht(t,r,i,n,s)}}class lt extends xe{constructor(e,t,r,i,n=0,s=3){super(),this.base16=e,this.value=t,this.input=r,this.width=i,this.index=n,this.step=s}pull(e){return lt.write(e,this.base16,this.value,this.input,this.width,this.index,this.step)}static write(e,t,r,i,n,s=0,o=3){if(o<=0)return xe.end();if(1===o&&e.isCont()&&(e=e.write(48),o=2),2===o&&e.isCont()&&(e=e.write(120),o=3),3===o)if(i>=0&&i<16&&n<=1){if(e.isCont())return e=e.write(t.encodeDigit(i)),xe.done(r)}else{let o=15;const a=new Array(16);let u=i;for(;0!==u||o>=16-n;)a[o]=15&u,u>>>=4,o-=1;for(o+=1+s;o<16&&e.isCont();)e=e.write(t.encodeDigit(a[o])),s+=1,o+=1;if(16===o)return xe.done(r)}return e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new lt(t,r,i,n,s,o)}static writeLiteral(e,t,r,i,n){return lt.write(e,t,r,i,n,0,1)}}class ct{decodeDigit(e){if(e>=65&&e<=90)return e-65;if(e>=97&&e<=122)return e+-71;if(e>=48&&e<=57)return e+4;if(43===e||45===e)return 62;if(47===e||95===e)return 63;{let t=Se.stringOutput();throw t=t.write("Invalid base-64 digit: "),t=Oe.debugChar(t,e),new Error(t.bind())}}encodeDigit(e){return this.alphabet.charCodeAt(e)}writeQuantum(e,t,r,i,n){const s=this.decodeDigit(t),o=this.decodeDigit(r);if(61!==i){const t=this.decodeDigit(i);if(61!==n){const r=this.decodeDigit(n);e=(e=(e=e.write(s<<2|o>>>4)).write(o<<4|t>>>2)).write(t<<6|r)}else e=(e=e.write(s<<2|o>>>4)).write(o<<4|t>>>2)}else{if(61!==n)return ge.error(new Error("Improperly padded base-64"));e=e.write(s<<2|o>>>4)}return e}parser(e){return new ft(this,e)}parse(e,t){return ft.parse(e,this,t)}parseUint8Array(e){return ft.parse(e,this,Qe.output())}uint8ArrayWriter(e){return void 0===e?new mt(this,void 0,null):new mt(this,e,e)}writeUint8Array(e,t){return mt.write(e,this,void 0,t)}static get standardPadded(){return new dt(!0)}static get standardUnpadded(){return new dt(!1)}static standard(e=!0){return e?ct.standardPadded:ct.standardUnpadded}static get urlPadded(){return new pt(!0)}static get urlUnpadded(){return new pt(!1)}static url(e=!0){return e?ct.urlPadded:ct.urlUnpadded}}i([a],ct,"standardPadded",null),i([a],ct,"standardUnpadded",null),i([a],ct,"urlPadded",null),i([a],ct,"urlUnpadded",null);class dt extends ct{constructor(e){super(),Object.defineProperty(this,"padded",{value:e,enumerable:!0})}get alphabet(){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}isPadded(){return this.padded}asPadded(e){return e===this.padded?this:ct.standard(e)}isDigit(e){return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||43===e||47===e}}class pt extends ct{constructor(e){super(),Object.defineProperty(this,"padded",{value:e,enumerable:!0})}get alphabet(){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}isPadded(){return this.padded}asPadded(e){return e===this.padded?this:ct.url(e)}isDigit(e){return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||45===e||95===e}}class ft extends Le{constructor(e,t,r=0,i=0,n=0,s=1){super(),this.base64=e,this.output=t,this.p=r,this.q=i,this.r=n,this.step=s}feed(e){return ft.parse(e,this.base64,this.output.clone(),this.p,this.q,this.r,this.step)}static parse(e,t,r,i=0,n=0,s=0,o=1){let a=0;for(;!e.isEmpty();){if(1===o)if(e.isCont()&&(a=e.head(),t.isDigit(a)))e=e.step(),i=a,o=2;else if(!e.isEmpty())return Le.done(r.bind());if(2===o)if(e.isCont()&&(a=e.head(),t.isDigit(a)))e=e.step(),n=a,o=3;else if(!e.isEmpty())return Le.error(Ae.expected("base64 digit",e));if(3===o)if(e.isCont()&&(a=e.head(),t.isDigit(a)||61===a))e=e.step(),s=a,o=61!==a?4:5;else if(!e.isEmpty())return t.isPadded()?Le.error(Ae.unexpected(e)):(r=t.writeQuantum(r,i,n,61,61),Le.done(r.bind()));if(4===o){if(e.isCont()&&(a=e.head(),t.isDigit(a)||61===a)){if(e=e.step(),r=t.writeQuantum(r,i,n,s,a),s=0,n=0,i=0,61===a)return Le.done(r.bind());o=1}else if(!e.isEmpty())return t.isPadded()?Le.error(Ae.unexpected(e)):(r=t.writeQuantum(r,i,n,s,61),Le.done(r.bind()))}else if(5===o){if(e.isCont()&&(a=e.head(),61===a))return e=e.step(),r=t.writeQuantum(r,i,n,s,a),s=0,n=0,i=0,Le.done(r.bind());if(!e.isEmpty())return Le.error(Ae.expected(61,e))}}return new ft(t,r,i,n,s,o)}}class mt extends xe{constructor(e,t,r,i=0,n=1){super(),this.base64=e,this.value=t,this.input=r,this.index=i,this.step=n}feed(e){if(e instanceof Uint8Array)return new mt(this.base64,null,e);throw new TypeError(""+e)}pull(e){if(null===this.input)throw new be;return mt.write(e,this.base64,this.value,this.input,this.index,this.step)}static write(e,t,r,i,n=0,s=1){for(;n+2<i.length&&e.isCont();){const r=i[n],o=i[n+1],a=i[n+2];1===s&&e.isCont()&&(e=e.write(t.encodeDigit(r>>>2)),s=2),2===s&&e.isCont()&&(e=e.write(t.encodeDigit(63&(r<<4|o>>>4))),s=3),3===s&&e.isCont()&&(e=e.write(t.encodeDigit(63&(o<<2|a>>>6))),s=4),4===s&&e.isCont()&&(e=e.write(t.encodeDigit(63&a)),n+=3,s=1)}if(n+1<i.length&&e.isCont()){const r=i[n],o=i[n+1];1===s&&e.isCont()&&(e=e.write(t.encodeDigit(r>>>2)),s=2),2===s&&e.isCont()&&(e=e.write(t.encodeDigit(63&(r<<4|o>>>4))),s=3),3===s&&e.isCont()&&(e=e.write(t.encodeDigit(o<<2&63)),s=4),4===s&&(t.isPadded()?e.isCont()&&(e=e.write(61),n+=2):n+=2)}else if(n<i.length&&e.isCont()){const r=i[n];1===s&&e.isCont()&&(e=e.write(t.encodeDigit(r>>>2)),s=2),2===s&&e.isCont()&&(e=e.write(t.encodeDigit(r<<4&63)),s=3),3===s&&(t.isPadded()?e.isCont()&&(e=e.write(61),s=4):n+=1),4===s&&e.isCont()&&(e=e.write(61),n+=1)}return n===i.length?xe.done(r):e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new mt(t,r,i,n,s)}}const yt=function(){const e={Transient:0,Inherited:1,Intrinsic:2,Extrinsic:3,Reflexive:4,Shift:2};return e.Mask=(1<<e.Shift)-1,e}(),wt=function(){const e={getLazyFastener:function(t,r,i){let n=t.getFastener(r);if(null===n){const s=t.constructor,o=e.getFastenerClass(s,r,i);null!==o&&(n=o.create(t),t.setFastener(r,n))}else null==i||n instanceof i||(n=null);return n},getFastenerClass:function(e,t,r){do{if(Object.prototype.hasOwnProperty.call(e,"fastenerClassMap")){const i=e.fastenerClassMap[t];if(void 0!==i&&(null==r||i.prototype instanceof r))return i}e=Object.getPrototypeOf(e)}while(null!==e);return null},getSuperFastenerClass:function(t,r,i){const n=Object.getPrototypeOf(t),s=e.getFastenerClass(n,r,i);if(null===s)throw new Error("No "+r+" "+(null!=i?i.name:"fastener")+" class in "+n.constructor.name);return s},decorate:function(t,r,i,n){const s=i.constructor,o=n.toString(),a=r.extends;"string"==typeof a?Object.defineProperty(r,"extends",{value:e.getSuperFastenerClass(s,a),writable:!0,enumerable:!0,configurable:!0}):!0===a?Object.defineProperty(r,"extends",{value:e.getSuperFastenerClass(s,o),writable:!0,enumerable:!0,configurable:!0}):!1===a&&Object.defineProperty(r,"extends",{value:null,writable:!0,enumerable:!0,configurable:!0});const u=t.define(o,r);u.contextClass=s,Object.prototype.hasOwnProperty.call(s,"fastenerClassMap")||(s.fastenerClassMap={}),s.fastenerClassMap[o]=u,u.prototype.lazy||(Object.prototype.hasOwnProperty.call(s,"fastenerClassInitMap")||(s.fastenerClassInitMap={}),s.fastenerClassInitMap[o]=u);let h=u.prototype.static;!1!==h&&(!0===h&&(h=o),s[h]=u),Object.defineProperty(i,n,{get:function(){let e=this.getFastener(o);return null===e&&(e=u.create(this),this.setFastener(o,e)),e},configurable:!0})},decorator:function(t,r){return e.decorate.bind(e,t,r)},init:function(e){let t=e.constructor;do{if(Object.prototype.hasOwnProperty.call(t,"fastenerClassInitMap")){const r=t.fastenerClassInitMap;for(const t in r){const i=r[t];if(!e.hasFastener(t)){const r=i.create(e);e.setFastener(t,r)}}}t=Object.getPrototypeOf(t)}while(null!==t)},has:function(e,t){return("object"==typeof e&&null!==e||"function"==typeof e)&&t in e},is:function(e){if("object"==typeof e&&null!==e||"function"==typeof e){return"hasFastener"in e}return!1}};return e}(),gt=function(e){const t=function(e){return wt.decorator(t,e)};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.init=function(){},Object.defineProperty(t.prototype,"fastenerType",{get:function(){return t},configurable:!0}),Object.defineProperty(t.prototype,"name",{value:"",configurable:!0}),t.prototype.setFlags=function(e){this.flags=e},Object.defineProperty(t.prototype,"affinity",{get(){return this.flags&yt.Mask},configurable:!0}),t.prototype.hasAffinity=function(e){return e>=(this.flags&yt.Mask)},t.prototype.initAffinity=function(e){this.flags=this.flags&~yt.Mask|e&yt.Mask},t.prototype.minAffinity=function(e){const t=this.flags&yt.Mask;if(e===yt.Reflexive)e=t;else if(0!=(e&~yt.Mask))throw new Error("invalid affinity: "+e);return e>t&&(this.willSetAffinity(e,t),this.setFlags(this.flags&~yt.Mask|e),this.onSetAffinity(e,t),this.didSetAffinity(e,t)),e>=t},t.prototype.setAffinity=function(e){if(0!=(e&~yt.Mask))throw new Error("invalid affinity: "+e);const t=this.flags&yt.Mask;e!==t&&(this.willSetAffinity(e,t),this.setFlags(this.flags&~yt.Mask|e),this.onSetAffinity(e,t),this.didSetAffinity(e,t))},t.prototype.willSetAffinity=function(e,t){},t.prototype.onSetAffinity=function(e,r){if(e>r&&0!=(this.flags&t.InheritedFlag)){const t=this.superFastener;null!==t&&Math.min(t.flags&yt.Mask,yt.Intrinsic)<e&&this.setInherited(!1,t)}else if(e<r&&0!=(this.flags&t.InheritsFlag)){const t=this.superFastener;null!==t&&Math.min(t.flags&yt.Mask,yt.Intrinsic)>=e&&this.setInherited(!0,t)}},t.prototype.didSetAffinity=function(e,t){},Object.defineProperty(t.prototype,"inherits",{get:function(){return 0!=(this.flags&t.InheritsFlag)},configurable:!0}),t.prototype.initInherits=function(e){let r;"string"==typeof e&&(r=e,e=!0),e?(void 0!==r&&Object.defineProperty(this,"name",{value:r,enumerable:!0,configurable:!0}),this.flags=this.flags|t.InheritsFlag):this.flags=this.flags&~t.InheritsFlag},t.prototype.setInherits=function(e){let r;"string"==typeof e&&(e!==this.name&&(r=e),e=!0),e===(0!=(this.flags&t.InheritsFlag))&&void 0===r||(this.unbindSuperFastener(),this.willSetInherits(e,r),e?(void 0!==r&&Object.defineProperty(this,"name",{value:r,enumerable:!0,configurable:!0}),this.setFlags(this.flags|t.InheritsFlag)):this.setFlags(this.flags&~t.InheritsFlag),this.onSetInherits(e,r),this.didSetInherits(e,r),this.bindSuperFastener())},t.prototype.willSetInherits=function(e,t){},t.prototype.onSetInherits=function(e,t){},t.prototype.didSetInherits=function(e,t){},Object.defineProperty(t.prototype,"inherited",{get:function(){return 0!=(this.flags&t.InheritedFlag)},configurable:!0}),t.prototype.setInherited=function(e,r){e&&0==(this.flags&t.InheritedFlag)?(this.willInherit(r),this.setFlags(this.flags|t.InheritedFlag),this.onInherit(r),this.didInherit(r)):e||0==(this.flags&t.InheritedFlag)||(this.willUninherit(r),this.setFlags(this.flags&~t.InheritedFlag),this.onUninherit(r),this.didUninherit(r))},t.prototype.willInherit=function(e){},t.prototype.onInherit=function(e){},t.prototype.didInherit=function(e){},t.prototype.willUninherit=function(e){},t.prototype.onUninherit=function(e){},t.prototype.didUninherit=function(e){},Object.defineProperty(t.prototype,"superName",{get:function(){return 0!=(this.flags&t.InheritsFlag)?this.name:void 0},configurable:!0}),Object.defineProperty(t.prototype,"superFastener",{get:function(){return this.getSuperFastener()},configurable:!0}),t.prototype.getSuperFastener=function(){const e=this.superName;if(void 0!==e){const t=this.owner;if(wt.is(t)){const r=t.getSuperFastener(e,this.fastenerType);if(null!==r)return r}}return null},t.prototype.bindSuperFastener=function(){const e=this.superName;if(void 0!==e){const t=this.owner;if(wt.is(t)){const r=t.getSuperFastener(e,this.fastenerType);null!==r&&(this.willBindSuperFastener(r),r.attachSubFastener(this),this.onBindSuperFastener(r),this.didBindSuperFastener(r))}}},t.prototype.willBindSuperFastener=function(e){},t.prototype.onBindSuperFastener=function(e){(e.flags&yt.Mask)>=(this.flags&yt.Mask)&&this.setInherited(!0,e)},t.prototype.didBindSuperFastener=function(e){},t.prototype.unbindSuperFastener=function(){const e=this.superFastener;null!==e&&(this.willUnbindSuperFastener(e),e.detachSubFastener(this),this.onUnbindSuperFastener(e),this.didUnbindSuperFastener(e))},t.prototype.willUnbindSuperFastener=function(e){},t.prototype.onUnbindSuperFastener=function(e){this.setInherited(!1,e)},t.prototype.didUnbindSuperFastener=function(e){},t.prototype.attachSubFastener=function(e){},t.prototype.detachSubFastener=function(e){},Object.defineProperty(t.prototype,"coherent",{get:function(){return 0==(this.flags&t.DecoherentFlag)},configurable:!0}),t.prototype.setCoherent=function(e){e?this.setFlags(this.flags&~t.DecoherentFlag):this.setFlags(this.flags|t.DecoherentFlag)},t.prototype.decohere=function(){const e=this.owner;wt.has(e,"decohereFastener")&&e.decohereFastener(this)},t.prototype.recohere=function(e){},Object.defineProperty(t.prototype,"mounted",{get:function(){return 0!=(this.flags&t.MountedFlag)},configurable:!0}),t.prototype.mount=function(){0==(this.flags&t.MountedFlag)&&(this.willMount(),this.setFlags(this.flags|t.MountedFlag),this.onMount(),this.didMount())},t.prototype.willMount=function(){},t.prototype.onMount=function(){this.bindSuperFastener()},t.prototype.didMount=function(){},t.prototype.unmount=function(){0!=(this.flags&t.MountedFlag)&&(this.willUnmount(),this.setFlags(this.flags&~t.MountedFlag),this.onUnmount(),this.didUnmount())},t.prototype.willUnmount=function(){},t.prototype.onUnmount=function(){this.unbindSuperFastener()},t.prototype.didUnmount=function(){},t.prototype.toString=function(){return this.name},Object.defineProperty(t.prototype,"lazy",{get:function(){return!0},configurable:!0}),Object.defineProperty(t.prototype,"static",{get:function(){return!1},configurable:!0}),t.create=function(e){const t=this.construct(this,null,e);return t.init(),t},t.construct=function(e,t,r){return null===t&&(t=Object.create(e.prototype)),t.owner=r,t.flags=0,t},t.extend=function(e,t){let r,i;null!=t&&"string"==typeof t.name&&p.isValid(t.name)?(r=t.name,e=r):p.isValid(e)&&(r=e),void 0!==r?i=new Function("FastenerContext","return function "+e+"(descriptor) { return FastenerContext.decorator("+e+", descriptor); }")(wt):(i=function(e){return wt.decorator(i,e)},Object.defineProperty(i,"name",{value:e,configurable:!0}));const n={};if(null!=t){n.name={value:e,configurable:!0};const r=Object.getOwnPropertyNames(t);for(let e=0;e<r.length;e+=1){const i=r[e];n[i]=Object.getOwnPropertyDescriptor(t,i)}}else n.name={value:"",configurable:!0};return Object.setPrototypeOf(i,this),i.prototype=Object.create(this.prototype,n),i.prototype.constructor=i,i},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,null==r&&(r=this);const s=r.extend(e,t);return s.construct=function(e,t,s){return t=r.construct(e,t,s),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),t},s},t.MountedFlag=1<<yt.Shift+0,t.InheritsFlag=1<<yt.Shift+1,t.InheritedFlag=1<<yt.Shift+2,t.DecoherentFlag=1<<yt.Shift+3,t.FlagShift=yt.Shift+4,t.FlagMask=(1<<t.FlagShift)-1,t}(Object),vt=function(e){const t=e.extend("Property");return Object.defineProperty(t.prototype,"fastenerType",{get:function(){return t},configurable:!0}),t.prototype.onInherit=function(e){const t=this.transformSuperValue(e.value);this.setValue(t,yt.Reflexive)},t.prototype.onBindSuperFastener=function(t){this.superFastener=t,e.prototype.onBindSuperFastener.call(this,t)},t.prototype.onUnbindSuperFastener=function(t){e.prototype.onUnbindSuperFastener.call(this,t),this.superFastener=null},t.prototype.attachSubFastener=function(e){let t=this.subFasteners;null===t&&(t=[],this.subFasteners=t),t.push(e)},t.prototype.detachSubFastener=function(e){const t=this.subFasteners;if(null!==t){const r=t.indexOf(e);r>=0&&t.splice(r,1)}},Object.defineProperty(t.prototype,"superValue",{get:function(){const e=this.superFastener;return null!==e?e.value:void 0},configurable:!0}),t.prototype.getSuperValue=function(){const e=this.superValue;if(null==e){let t=e+" ";throw 0!==this.name.length&&(t+=this.name+" "),t+="super value",new TypeError(t)}return e},t.prototype.getSuperValueOr=function(e){let t=this.superValue;return null==t&&(t=e),t},t.prototype.transformSuperValue=function(e){return e},t.prototype.getValue=function(){const e=this.value;if(null==e){let t=e+" ";throw 0!==this.name.length&&(t+=this.name+" "),t+="value",new TypeError(t)}return e},t.prototype.getValueOr=function(e){let t=this.value;return null==t&&(t=e),t},t.prototype.transformValue=function(e){return e},t.prototype.setValue=function(e,t){if(void 0===t&&(t=yt.Extrinsic),this.minAffinity(t)){e=this.fromAny(e),e=this.transformValue(e);const t=this.value;this.equalValues(e,t)||(this.willSetValue(e,t),this.value=e,this.onSetValue(e,t),this.didSetValue(e,t),this.setCoherent(!0),this.decohereSubFasteners())}},t.prototype.willSetValue=function(e,t){},t.prototype.onSetValue=function(e,t){const r=this.updateFlags,i=this.owner;void 0!==r&&wt.has(i,"requireUpdate")&&i.requireUpdate(r)},t.prototype.didSetValue=function(e,t){},t.prototype.decohereSubFasteners=function(){const e=this.subFasteners;for(let t=0,r=null!==e?e.length:0;t<r;t+=1)this.decohereSubFastener(e[t])},t.prototype.decohereSubFastener=function(e){0==(e.flags&gt.InheritedFlag)&&Math.min(this.flags&yt.Mask,yt.Intrinsic)>=(e.flags&yt.Mask)?e.setInherited(!0,this):0!=(e.flags&gt.InheritedFlag)&&0==(e.flags&gt.DecoherentFlag)&&(e.setCoherent(!1),e.decohere())},t.prototype.recohere=function(e){if(0!=(this.flags&gt.InheritedFlag)){const e=this.superFastener;if(null!==e){const t=this.transformSuperValue(e.value);this.setValue(t,yt.Reflexive)}}},t.prototype.definedValue=function(e){return null!=e},t.prototype.equalValues=function(e,t){return y(e,t)},t.prototype.fromAny=function(e){return e},t.construct=function(t,r,i){return null===r&&(r=function(e,t){return 0===arguments.length?r.value:(r.setValue(e,t),r.owner)},delete r.name,Object.setPrototypeOf(r,t.prototype)),r=e.construct(t,r,i),Object.defineProperty(r,"superFastener",{value:null,writable:!0,enumerable:!0,configurable:!0}),r.subFasteners=null,r.value=void 0,r},t.specialize=function(e){return e===String?bt:e===Number?xt:e===Boolean?Ct:null},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits,s=t.value,o=t.initValue;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,delete t.value,delete t.initValue,null==r&&(r=this.specialize(t.type)),null===r&&(r=this,void 0===t.fromAny&&C.is(t.type)&&(t.fromAny=t.type.fromAny));const a=r.extend(e,t);return a.construct=function(e,t,a){return t=r.construct(e,t,a),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),void 0!==o?t.value=t.fromAny(o()):void 0!==s&&(t.value=t.fromAny(s)),t},a},t}(gt),bt=function(e){const t=e.extend("StringProperty");return t.prototype.fromAny=function(e){return e},t.prototype.equalValues=function(e,t){return e===t},t}(vt),xt=function(e){const t=e.extend("NumberProperty");return t.prototype.fromAny=function(e){if("string"==typeof e){const t=+e;if(isFinite(t))return t;throw new Error(e)}return e},t.prototype.equalValues=function(e,t){return e===t},t}(vt),Ct=function(e){const t=e.extend("BooleanProperty");return t.prototype.fromAny=function(e){return!!e},t.prototype.equalValues=function(e,t){return e===t},t}(vt),St=function(e){const t=e.extend("Animator");return t.prototype.onInherit=function(e){let r,i;e instanceof t?(r=this.transformSuperValue(e.value),i=this.transformSuperValue(e.state)):(r=this.transformSuperValue(e.value),i=r);const n=this.state,s=!this.equalValues(i,n);s&&(this.willSetState(i,n),this.state=i,this.timing=null,this.interpolator=null,this.onSetState(i,n)),this.setValue(r,yt.Reflexive),s&&(this.didSetState(i,n),0!=(this.flags&t.TweeningFlag)&&this.didInterrupt(this.value)),e instanceof t&&0!=(e.flags&t.TweeningFlag)?this.startTweening():this.stopTweening()},t.prototype.setValue=function(e,t){if(void 0===t&&(t=yt.Extrinsic),this.minAffinity(t)){e=this.fromAny(e),e=this.transformValue(e);const t=this.value;this.equalValues(e,t)||(this.willSetValue(e,t),this.value=e,this.onSetValue(e,t),this.didSetValue(e,t),this.decohereSubFasteners())}},Object.defineProperty(t.prototype,"superState",{get:function(){const e=this.superFastener;return e instanceof t?e.state:void 0},configurable:!0}),t.prototype.getSuperState=function(){const e=this.superState;if(null==e){let t=e+" ";throw 0!==this.name.length&&(t+=this.name+" "),t+="super state",new TypeError(t)}return e},t.prototype.getSuperStateOr=function(e){let t=this.superState;return null==t&&(t=e),t},t.prototype.getState=function(){const e=this.state;if(null==e){let t=e+" ";throw 0!==this.name.length&&(t+=this.name+" "),t+="state",new TypeError(t)}return e},t.prototype.getStateOr=function(e){let t=this.state;return null==t&&(t=e),t},t.prototype.transformState=function(e){return e},t.prototype.setState=function(e,r,i){if("number"==typeof r&&(i=r,r=void 0),void 0===i&&(i=yt.Extrinsic),this.minAffinity(i)){e=this.fromAny(e),e=this.transformState(e);const i=this.state;if(!this.equalValues(e,i)){const n=!1!==(r=null!=r&&!1!==r&&(!0===r?null!==this.timing&&this.timing:F.fromAny(r)))&&this.definedValue(i);this.willSetState(e,i),this.state=e,n?(this.timing=r,this.interpolator=D(this.value,e),0!=(this.flags&t.TweeningFlag)?this.setFlags(this.flags|t.DivergedFlag|t.InterruptFlag):this.setFlags(this.flags|t.DivergedFlag)):(this.timing=null,this.interpolator=null),this.onSetState(e,i),n||this.setValue(e,yt.Reflexive),this.didSetState(e,i),n?this.startTweening():0!=(this.flags&t.TweeningFlag)&&(this.didInterrupt(this.value),this.stopTweening())}}},t.prototype.willSetState=function(e,t){},t.prototype.onSetState=function(e,t){},t.prototype.didSetState=function(e,t){},t.prototype.setInterpolatedValue=function(e,r){const i=arguments.length>1?this.state:void 0,n=arguments.length>1&&!this.equalValues(r,i);n&&(this.willSetState(r,i),this.state=r,this.timing=null,this.interpolator=null,this.onSetState(r,i)),this.setValue(e,yt.Reflexive),n&&(this.didSetState(r,i),0!=(this.flags&t.TweeningFlag)&&(this.didInterrupt(this.value),this.stopTweening()))},t.prototype.decohereSubFastener=function(e){0==(e.flags&t.InheritedFlag)&&Math.min(this.flags&yt.Mask,yt.Intrinsic)>=(e.flags&yt.Mask)?e.setInherited(!0,this):0!=(e.flags&t.InheritedFlag)&&(0!=(this.flags&t.TweeningFlag)&&e instanceof t&&e.startTweening(),0==(e.flags&t.DecoherentFlag)&&(e.setCoherent(!1),e.decohere()))},t.prototype.recohere=function(e){const r=this.flags;0!=(r&t.InheritedFlag)?this.tweenInherited(e):0!=(r&t.TweeningFlag)&&this.tween(e)},t.prototype.tween=function(e){const r=this.value;let i=this.timing;null===i&&(i=N.linear.withDomain(e,e),this.timing=i);let n=this.interpolator;null===n&&(n=D(r,this.state),this.interpolator=n),0!=(this.flags&t.InterruptFlag)&&(this.setFlags(this.flags&~t.InterruptFlag),this.didInterrupt(r)),0!=(this.flags&t.DivergedFlag)&&(this.setFlags(this.flags&~t.DivergedFlag),i=this.equalValues(this.state,r)?i.withDomain(e-i.duration,e):i.withDomain(e,e+i.duration),this.timing=i,this.willTransition(r));const s=i(e),o=n(s);this.setValue(o,yt.Reflexive),s<1?this.decohere():0!=(this.flags&t.TweeningFlag)?(this.stopTweening(),this.interpolator=null,this.didTransition(this.value)):this.setCoherent(!0)},t.prototype.tweenInherited=function(e){const r=this.superFastener;if(null!==r){let e,i;r instanceof t?(e=this.transformSuperValue(r.value),i=this.transformSuperValue(r.state)):(e=this.transformSuperValue(r.value),i=e);const n=this.state,s=!this.equalValues(i,n);s&&(this.willSetState(i,n),this.state=i,this.timing=null,this.interpolator=null,this.onSetState(i,n)),this.setValue(e,yt.Reflexive),s&&(this.didSetState(i,n),0!=(this.flags&t.TweeningFlag)&&this.didInterrupt(this.value)),r instanceof t&&0!=(r.flags&t.TweeningFlag)?this.decohere():0!=(this.flags&t.TweeningFlag)?this.stopTweening():this.setCoherent(!0)}else this.stopTweening()},Object.defineProperty(t.prototype,"tweening",{get:function(){return 0!=(this.flags&t.TweeningFlag)},configurable:!0}),t.prototype.startTweening=function(){0==(this.flags&t.TweeningFlag)&&(this.willStartTweening(),this.setFlags(this.flags|t.TweeningFlag),this.onStartTweening(),this.didStartTweening())},t.prototype.willStartTweening=function(){},t.prototype.onStartTweening=function(){0==(this.flags&t.DecoherentFlag)&&(this.setCoherent(!1),this.decohere()),this.decohereSubFasteners()},t.prototype.didStartTweening=function(){},t.prototype.stopTweening=function(){0!=(this.flags&t.TweeningFlag)&&(this.willStopTweening(),this.setFlags(this.flags&~t.TweeningFlag),this.onStopTweening(),this.didStopTweening())},t.prototype.willStopTweening=function(){},t.prototype.onStopTweening=function(){this.setCoherent(!0)},t.prototype.didStopTweening=function(){},t.prototype.willTransition=function(e){},t.prototype.didTransition=function(e){},t.prototype.didInterrupt=function(e){},t.prototype.onUnmount=function(){this.stopTweening(),e.prototype.onUnmount.call(this)},t.construct=function(t,r,i){return null===r&&(r=function(e,t,i){return 0===arguments.length?r.value:(2===arguments.length?r.setState(e,t):r.setState(e,t,i),r.owner)},delete r.name,Object.setPrototypeOf(r,t.prototype)),(r=e.construct(t,r,i)).state=r.value,r.timing=null,r.interpolator=null,r},t.specialize=function(e){return e===String?Ot:e===Number?Et:e===Boolean?At:null},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits,s=t.value,o=t.initValue;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,delete t.value,delete t.initValue,null==r&&(r=this.specialize(t.type)),null===r&&(r=this,void 0===t.fromAny&&C.is(t.type)&&(t.fromAny=t.type.fromAny));const a=r.extend(e,t);return a.construct=function(e,t,a){return t=r.construct(e,t,a),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),void 0!==o?(t.value=t.fromAny(o()),t.state=t.value):void 0!==s&&(t.value=t.fromAny(s),t.state=t.value),t},a},t.TweeningFlag=1<<e.FlagShift+0,t.DivergedFlag=1<<e.FlagShift+1,t.InterruptFlag=1<<e.FlagShift+2,t.FlagShift=e.FlagShift+3,t.FlagMask=(1<<t.FlagShift)-1,t}(vt),Ot=function(e){const t=e.extend("StringAnimator");return t.prototype.fromAny=function(e){return e},t.prototype.equalValues=function(e,t){return e===t},t}(St),Et=function(e){const t=e.extend("NumberAnimator");return t.prototype.fromAny=function(e){if("string"==typeof e){const t=+e;if(isFinite(t))return t;throw new Error(e)}return e},t.prototype.equalValues=function(e,t){return e===t},t}(St),At=function(e){const t=e.extend("BooleanAnimator");return t.prototype.fromAny=function(e){return!!e},t.prototype.equalValues=function(e,t){return e===t},t}(St);class kt{constructor(){this.roots=x.empty,this.fasteners=null,this.decoherent=null,this.observers=x.empty}attachRoot(e){const t=this.roots,r=x.inserted(e,t);if(t!==r){const i=0===t.length;i&&this.willAttach(),this.willAttachRoot(e),this.roots=r,i&&this.onAttach(),this.onAttachRoot(e),this.didAttachRoot(e),i&&this.didAttach()}}willAttachRoot(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.serviceWillAttachRoot&&i.serviceWillAttachRoot(e,this)}}onAttachRoot(e){}didAttachRoot(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.serviceDidAttachRoot&&i.serviceDidAttachRoot(e,this)}}detachRoot(e){const t=this.roots,r=x.removed(e,t);if(t!==r){const i=1===t.length;i&&this.willDetach(),this.willDetachRoot(e),this.roots=r,i&&this.onDetach(),this.onDetachRoot(e),this.didDetachRoot(e),i&&this.didDetach()}}willDetachRoot(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.serviceWillDetachRoot&&i.serviceWillDetachRoot(e,this)}}onDetachRoot(e){}didDetachRoot(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.serviceDidDetachRoot&&i.serviceDidDetachRoot(e,this)}}get attached(){return 0!==this.roots.length}willAttach(){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.serviceWillAttach&&r.serviceWillAttach(this)}}onAttach(){this.mountFasteners()}didAttach(){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.serviceDidAttach&&r.serviceDidAttach(this)}}willDetach(){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.serviceWillDetach&&r.serviceWillDetach(this)}}onDetach(){this.unmountFasteners()}didDetach(){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.serviceDidDetach&&r.serviceDidDetach(this)}}hasFastener(e,t){const r=this.fasteners;if(null!==r){const i=r[e];if(void 0!==i&&(null==t||i instanceof t))return!0}return!1}getFastener(e,t){const r=this.fasteners;if(null!==r){const i=r[e];if(void 0!==i&&(null==t||i instanceof t))return i}return null}setFastener(e,t){var r;const i=this.fasteners,n=null!==i&&null!==(r=i[e])&&void 0!==r?r:null;n!==t&&(null!==n&&this.detachFastener(e,n),null!==t&&this.attachFastener(e,t))}attachFastener(e,t){let r=this.fasteners;null===r&&(r={},this.fasteners=r),this.willAttachFastener(e,t),r[e]=t,this.attached&&t.mount(),this.onAttachFastener(e,t),this.didAttachFastener(e,t)}willAttachFastener(e,t){}onAttachFastener(e,t){}didAttachFastener(e,t){}detachFastener(e,t){const r=this.fasteners;this.willDetachFastener(e,t),this.onDetachFastener(e,t),this.attached&&t.unmount(),delete r[e],this.didDetachFastener(e,t)}willDetachFastener(e,t){}onDetachFastener(e,t){}didDetachFastener(e,t){}getLazyFastener(e,t){return wt.getLazyFastener(this,e,t)}getSuperFastener(e,t){return null}mountFasteners(){const e=this.fasteners;for(const t in e){e[t].mount()}}unmountFasteners(){const e=this.fasteners;for(const t in e){e[t].unmount()}}decohereFastener(e){let t=this.decoherent;null===t&&(t=[],this.decoherent=t),t.push(e)}recohereFasteners(e){const t=this.decoherent;if(null!==t){const r=t.length;if(0!==r){void 0===e&&(e=performance.now()),this.decoherent=null;for(let i=0;i<r;i+=1){t[i].recohere(e)}}}}observe(e){const t=this.observers,r=x.inserted(e,t);t!==r&&(this.willObserve(e),this.observers=r,this.onObserve(e),this.didObserve(e))}willObserve(e){}onObserve(e){}didObserve(e){}unobserve(e){const t=this.observers,r=x.removed(e,t);t!==r&&(this.willUnobserve(e),this.observers=r,this.onUnobserve(e),this.didUnobserve(e))}willUnobserve(e){}onUnobserve(e){}didUnobserve(e){}forEachObserver(e){let t;const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];if(t=e.call(this,n),void 0!==t)return t}return t}callObservers(e,...t){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=n[e];"function"==typeof s&&s.call(n,...t)}}}const Dt=function(e){const t=e.extend("Provider");return Object.defineProperty(t.prototype,"fastenerType",{get:function(){return t},configurable:!0}),t.prototype.onInherit=function(e){this.setService(e.service)},t.prototype.onBindSuperFastener=function(t){0!=(this.flags&gt.InheritsFlag)&&(this.flags&yt.Mask)===yt.Inherited&&this.initAffinity(yt.Transient),e.prototype.onBindSuperFastener.call(this,t)},t.prototype.onUnbindSuperFastener=function(t){e.prototype.onUnbindSuperFastener.call(this,t),0!=(this.flags&gt.InheritsFlag)&&(this.flags&yt.Mask)===yt.Transient&&this.initAffinity(yt.Inherited)},t.prototype.getService=function(){const e=this.service;if(null==e){let t=e+" ";throw 0!==this.name.length&&(t+=this.name+" "),t+="service",new TypeError(t)}return e},t.prototype.getServiceOr=function(e){let t=this.service;return null==t&&(t=e),t},t.prototype.setService=function(e){const t=this.service;return t!==e&&(null!=t&&(this.willDetachService(t),this.service=void 0,this.onDetachService(t),this.deinitService(t),this.didDetachService(t)),null!=e&&(this.willAttachService(e),this.service=e,this.onAttachService(e),this.initService(e),this.didAttachService(e))),t},t.prototype.initService=function(e){},t.prototype.willAttachService=function(e){},t.prototype.onAttachService=function(e){!0===this.observes&&G.is(e)&&e.observe(this)},t.prototype.didAttachService=function(e){},t.prototype.deinitService=function(e){},t.prototype.willDetachService=function(e){},t.prototype.onDetachService=function(e){!0===this.observes&&G.is(e)&&e.unobserve(this)},t.prototype.didDetachService=function(e){},t.prototype.createService=function(){return this.service},t.prototype.onMount=function(){e.prototype.onMount.call(this);let t=this.service;null==t&&(t=this.createService(),this.setService(t)),0==(this.flags&gt.InheritedFlag)&&t instanceof kt&&t.attachRoot(this.owner)},t.prototype.onUnmount=function(){const t=this.service;0==(this.flags&gt.InheritedFlag)&&t instanceof kt&&t.detachRoot(this.owner),e.prototype.onUnmount.call(this)},t.construct=function(t,r,i){return null===r&&(delete(r=function(){return r.service}).name,Object.setPrototypeOf(r,t.prototype)),(r=e.construct(t,r,i)).service=void 0,r.initAffinity(yt.Inherited),r.initInherits(!0),r},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits,s=t.service;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,delete t.service,null==r&&(r=this);const o=r.extend(e,t);return o.construct=function(e,t,o){return t=r.construct(e,t,o),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),void 0!==s&&t.setService(s),t},o},t}(gt),Pt=function(e){const t=e.extend("Timer");return Object.defineProperty(t.prototype,"fastenerType",{get:function(){return t},configurable:!0}),t.prototype.onInherit=function(e){this.setDelay(e.delay)},t.prototype.initDelay=function(e){this.delay=Math.max(0,e)},t.prototype.setDelay=function(e){this.delay=Math.max(0,e)},Object.defineProperty(t.prototype,"elapsed",{get:function(){const e=this.deadline;return void 0!==e?Math.max(0,performance.now()-(e-this.delay)):void 0},configurable:!0}),Object.defineProperty(t.prototype,"remaining",{get:function(){const e=this.deadline;return void 0!==e?Math.max(0,e-performance.now()):void 0},configurable:!0}),t.prototype.fire=function(){},Object.defineProperty(t.prototype,"scheduled",{get:function(){return void 0!==this.timeout},configurable:!0}),t.prototype.schedule=function(e){let t=this.timeout;if(void 0!==t)throw new Error("timer already scheduled; call throttle or debounce to reschedule");void 0===e?e=this.delay:this.setDelay(e),this.willSchedule(e),this.deadline=performance.now()+e,t=this.setTimeout(this.expire.bind(this),e),this.timeout=t,this.onSchedule(e),this.didSchedule(e)},t.prototype.throttle=function(e){let t=this.timeout;void 0===t&&(void 0===e?e=this.delay:this.setDelay(e),this.willSchedule(e),this.deadline=performance.now()+e,t=this.setTimeout(this.expire.bind(this),e),this.timeout=t,this.onSchedule(e),this.didSchedule(e))},t.prototype.debounce=function(e){let t=this.timeout;void 0!==t&&(this.willCancel(),this.timeout=void 0,this.clearTimeout(t),this.onCancel(),this.didCancel()),void 0===e?e=this.delay:this.setDelay(e),this.willSchedule(e),this.deadline=performance.now()+e,t=this.setTimeout(this.expire.bind(this),e),this.timeout=t,this.onSchedule(e),this.didSchedule(e)},t.prototype.willSchedule=function(e){},t.prototype.onSchedule=function(e){},t.prototype.didSchedule=function(e){},t.prototype.cancel=function(){const e=this.timeout;void 0!==e&&(this.willCancel(),this.timeout=void 0,this.deadline=void 0,this.clearTimeout(e),this.onCancel(),this.didCancel())},t.prototype.willCancel=function(){},t.prototype.onCancel=function(){},t.prototype.didCancel=function(){},t.prototype.expire=function(){this.timeout=void 0,this.deadline=void 0,this.willExpire(),this.fire(),this.onExpire(),this.didExpire()},t.prototype.willExpire=function(){},t.prototype.onExpire=function(){},t.prototype.didExpire=function(){},t.prototype.setTimeout=function(e,t){return setTimeout(e,t)},t.prototype.clearTimeout=function(e){clearTimeout(e)},t.prototype.onUnmount=function(){e.prototype.onUnmount.call(this),this.cancel()},Object.defineProperty(t.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(t.prototype,"static",{get:function(){return!0},configurable:!0}),t.construct=function(t,r,i){return(r=e.construct(t,r,i)).delay=0,r.deadline=0,r.timeout=void 0,r.expire=r.expire.bind(r),r},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits,s=t.delay;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,delete t.delay,null==r&&(r=this);const o=r.extend(e,t);return o.construct=function(e,t,o){return t=r.construct(e,t,o),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),void 0!==s&&t.initDelay(s),t},o},t}(gt);class Tt{constructor(){this.uid=this.constructor.uid(),this.key=void 0,this.flags=0,this.parent=null,this.nextSibling=null,this.previousSibling=null,this.firstChild=null,this.lastChild=null,this.childMap=null,this.fasteners=null,this.decoherent=null,this.observers=x.empty,wt.init(this)}get componentType(){return Tt}setKey(e){this.key=e}setFlags(e){this.flags=e}attachParent(e,t){let r;this.willAttachParent(e),this.parent=e,null!==t?(r=t.previousSibling,this.setNextSibling(t),t.setPreviousSibling(this)):(r=e.lastChild,e.setLastChild(this)),null!==r?(r.setNextSibling(this),this.setPreviousSibling(r)):e.setFirstChild(this),e.mounted&&this.cascadeMount(),this.onAttachParent(e),this.didAttachParent(e)}willAttachParent(e){}onAttachParent(e){}didAttachParent(e){}detachParent(e){this.willDetachParent(e),this.mounted&&this.cascadeUnmount(),this.onDetachParent(e);const t=this.nextSibling,r=this.previousSibling;null!==t?(this.setNextSibling(null),t.setPreviousSibling(r)):e.setLastChild(r),null!==r?(r.setNextSibling(t),this.setPreviousSibling(null)):e.setFirstChild(t),this.parent=null,this.didDetachParent(e)}willDetachParent(e){}onDetachParent(e){}didDetachParent(e){}setNextSibling(e){this.nextSibling=e}setPreviousSibling(e){this.previousSibling=e}setFirstChild(e){this.firstChild=e}setLastChild(e){this.lastChild=e}forEachChild(e,t){let r=this.firstChild;for(;null!==r;){const i=r.nextSibling;if(void 0!==e.call(t,r))break;r=null!==i&&i.parent===this?i:null}}insertChildMap(e){const t=e.key;if(void 0!==t){let r=this.childMap;null===r&&(r={},this.childMap=r),r[t]=e}}removeChildMap(e){const t=e.key;if(void 0!==t){const e=this.childMap;null!==e&&delete e[t]}}getChild(e,t){const r=this.childMap;if(null!==r){const i=r[e];if(void 0!==i&&(void 0===t||i instanceof t))return i}return null}setChild(e,t){const r=this.getChild(e);let i;return null!==r&&null!==t&&r!==t?(t.remove(),i=r.nextSibling,0==(r.flags&Tt.RemovingFlag)&&(r.setFlags(r.flags|Tt.RemovingFlag),this.willRemoveChild(r),r.detachParent(this),this.removeChildMap(r),this.onRemoveChild(r),this.didRemoveChild(r),r.setKey(void 0),r.setFlags(r.flags&~Tt.RemovingFlag)),t.setKey(r.key),this.willInsertChild(t,i),this.insertChildMap(t),t.attachParent(this,i),this.onInsertChild(t,i),this.didInsertChild(t,i),t.cascadeInsert()):(t!==r||null!==t&&t.key!==e)&&(null!==r?(i=r.nextSibling,0==(r.flags&Tt.RemovingFlag)&&(r.setFlags(r.flags|Tt.RemovingFlag),this.willRemoveChild(r),r.detachParent(this),this.removeChildMap(r),this.onRemoveChild(r),this.didRemoveChild(r),r.setKey(void 0),r.setFlags(r.flags&~Tt.RemovingFlag))):i=null,null!==t&&(t.remove(),t.setKey(e),this.willInsertChild(t,i),this.insertChildMap(t),t.attachParent(this,i),this.onInsertChild(t,i),this.didInsertChild(t,i),t.cascadeInsert())),r}appendChild(e,t){return e.remove(),void 0!==t&&this.removeChild(t),e.setKey(t),this.willInsertChild(e,null),this.insertChildMap(e),e.attachParent(this,null),this.onInsertChild(e,null),this.didInsertChild(e,null),e.cascadeInsert(),e}prependChild(e,t){e.remove(),void 0!==t&&this.removeChild(t);const r=this.firstChild;return e.setKey(t),this.willInsertChild(e,r),this.insertChildMap(e),e.attachParent(this,r),this.onInsertChild(e,r),this.didInsertChild(e,r),e.cascadeInsert(),e}insertChild(e,t,r){if(null!==t&&t.parent!==this)throw new Error("insert target is not a child");return e.remove(),void 0!==r&&this.removeChild(r),e.setKey(r),this.willInsertChild(e,t),this.insertChildMap(e),e.attachParent(this,t),this.onInsertChild(e,t),this.didInsertChild(e,t),e.cascadeInsert(),e}replaceChild(e,t){if(t.parent!==this)throw new Error("replacement target is not a child");if(e!==t){e.remove();const r=t.nextSibling;0==(t.flags&Tt.RemovingFlag)&&(t.setFlags(t.flags|Tt.RemovingFlag),this.willRemoveChild(t),t.detachParent(this),this.removeChildMap(t),this.onRemoveChild(t),this.didRemoveChild(t),t.setKey(void 0),t.setFlags(t.flags&~Tt.RemovingFlag)),e.setKey(t.key),this.willInsertChild(e,r),this.insertChildMap(e),e.attachParent(this,r),this.onInsertChild(e,r),this.didInsertChild(e,r),e.cascadeInsert()}return t}get insertChildFlags(){return this.constructor.InsertChildFlags}willInsertChild(e,t){}onInsertChild(e,t){this.requireUpdate(this.insertChildFlags),this.bindChildFasteners(e,t)}didInsertChild(e,t){}cascadeInsert(){}removeChild(e){let t;if("string"==typeof e){if(t=this.getChild(e),null===t)return null}else if(t=e,t.parent!==this)throw new Error("not a child");return 0==(t.flags&Tt.RemovingFlag)&&(t.setFlags(t.flags|Tt.RemovingFlag),this.willRemoveChild(t),t.detachParent(this),this.removeChildMap(t),this.onRemoveChild(t),this.didRemoveChild(t),t.setKey(void 0),t.setFlags(t.flags&~Tt.RemovingFlag)),t}get removeChildFlags(){return this.constructor.RemoveChildFlags}willRemoveChild(e){}onRemoveChild(e){this.requireUpdate(this.removeChildFlags),this.unbindChildFasteners(e)}didRemoveChild(e){}removeChildren(){let e;for(;e=this.lastChild,null!==e;){if(0!=(e.flags&Tt.RemovingFlag))throw new Error("inconsistent removeChildren");this.willRemoveChild(e),e.detachParent(this),this.removeChildMap(e),this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0),e.setFlags(e.flags&~Tt.RemovingFlag)}}remove(){const e=this.parent;null!==e&&e.removeChild(this)}sortChildren(e){let t=this.firstChild;if(null!==t){const r=[];do{r.push(t),t=t.nextSibling}while(null!==t);r.sort(e),t=r[0],this.setFirstChild(t),t.setPreviousSibling(null);for(let e=1;e<r.length;e+=1){const i=r[e];t.setNextSibling(i),i.setPreviousSibling(t),t=i}t.setNextSibling(null),this.setLastChild(t)}}getSuper(e){const t=this.parent;return null===t?null:t instanceof e?t:t.getSuper(e)}getBase(e){const t=this.parent;if(null===t)return null;{const r=t.getBase(e);return null!==r?r:t instanceof e?t:null}}get mounted(){return 0!=(this.flags&Tt.MountedFlag)}get mountFlags(){return this.constructor.MountFlags}mount(){this.mounted||null!==this.parent||(this.cascadeMount(),this.cascadeInsert())}cascadeMount(){if(0!=(this.flags&Tt.MountedFlag))throw new Error("already mounted");this.willMount(),this.setFlags(this.flags|Tt.MountedFlag),this.onMount(),this.mountChildren(),this.didMount()}willMount(){}onMount(){this.requireUpdate(this.mountFlags),this.mountFasteners()}didMount(){}mountChildren(){let e=this.firstChild;for(;null!==e;){const t=e.nextSibling;if(e.cascadeMount(),null!==t&&t.parent!==this)throw new Error("inconsistent mount");e=t}}unmount(){this.mounted&&null===this.parent&&this.cascadeUnmount()}cascadeUnmount(){if(0==(this.flags&Tt.MountedFlag))throw new Error("already unmounted");this.willUnmount(),this.setFlags(this.flags&~Tt.MountedFlag),this.unmountChildren(),this.onUnmount(),this.didUnmount()}willUnmount(){}onUnmount(){this.unmountFasteners()}didUnmount(){}unmountChildren(){let e=this.lastChild;for(;null!==e;){const t=e.previousSibling;if(e.cascadeUnmount(),null!==t&&t.parent!==this)throw new Error("inconsistent unmount");e=t}}requireUpdate(e,t){}hasFastener(e,t){const r=this.fasteners;if(null!==r){const i=r[e];if(void 0!==i&&(null==t||i instanceof t))return!0}return!1}getFastener(e,t){const r=this.fasteners;if(null!==r){const i=r[e];if(void 0!==i&&(null==t||i instanceof t))return i}return null}setFastener(e,t){var r;const i=this.fasteners,n=null!==i&&null!==(r=i[e])&&void 0!==r?r:null;n!==t&&(null!==n&&this.detachFastener(e,n),null!==t&&this.attachFastener(e,t))}attachFastener(e,t){let r=this.fasteners;null===r&&(r={},this.fasteners=r),this.willAttachFastener(e,t),r[e]=t,this.mounted&&t.mount(),this.onAttachFastener(e,t),this.didAttachFastener(e,t)}willAttachFastener(e,t){}onAttachFastener(e,t){this.bindFastener(t)}didAttachFastener(e,t){}detachFastener(e,t){const r=this.fasteners;this.willDetachFastener(e,t),this.onDetachFastener(e,t),this.mounted&&t.unmount(),delete r[e],this.didDetachFastener(e,t)}willDetachFastener(e,t){}onDetachFastener(e,t){}didDetachFastener(e,t){}getLazyFastener(e,t){return wt.getLazyFastener(this,e,t)}getSuperFastener(e,t){const r=this.parent;if(null===r)return null;{const i=r.getLazyFastener(e,t);return null!==i?i:r.getSuperFastener(e,t)}}mountFasteners(){const e=this.fasteners;for(const t in e){e[t].mount()}}unmountFasteners(){const e=this.fasteners;for(const t in e){e[t].unmount()}}bindFastener(e){if(e.binds){let t=this.firstChild;for(;null!==t;){const r=t.nextSibling;this.bindChildFastener(e,t,r),t=null!==r&&r.parent===this?r:null}}}bindChildFasteners(e,t){const r=this.fasteners;for(const i in r){const n=r[i];this.bindChildFastener(n,e,t)}}bindChildFastener(e,t,r){e instanceof It&&e.bindComponent(t,r)}unbindChildFasteners(e){const t=this.fasteners;for(const r in t){const i=t[r];this.unbindChildFastener(i,e)}}unbindChildFastener(e,t){e instanceof It&&e.unbindComponent(t)}decohereFastener(e){let t=this.decoherent;null===t&&(t=[],this.decoherent=t),t.push(e)}recohereFasteners(e){const t=this.decoherent;if(null!==t){const r=t.length;if(0!==r){void 0===e&&(e=performance.now()),this.decoherent=null;for(let i=0;i<r;i+=1){t[i].recohere(e)}}}}observe(e){const t=this.observers,r=x.inserted(e,t);t!==r&&(this.willObserve(e),this.observers=r,this.onObserve(e),this.didObserve(e))}willObserve(e){}onObserve(e){}didObserve(e){}unobserve(e){const t=this.observers,r=x.removed(e,t);t!==r&&(this.willUnobserve(e),this.observers=r,this.onUnobserve(e),this.didUnobserve(e))}willUnobserve(e){}onUnobserve(e){}didUnobserve(e){}forEachObserver(e){let t;const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];if(t=e.call(this,n),void 0!==t)return t}return t}callObservers(e,...t){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=n[e];"function"==typeof s&&s.call(n,...t)}}equals(e){return this===e}hashCode(){return this.uid}init(e){}static create(){return new this}static fromInit(e){let t;t=("object"==typeof e&&null!==e||"function"==typeof e)&&X.is(e.type)?e.type:this;const r=t.create();return r.init(e),r}static fromAny(e){if(null==e)return e;if(e instanceof Tt){if(e instanceof this)return e;throw new TypeError(e+" not an instance of "+this)}return X.is(e)?e.create():this.fromInit(e)}}Tt.uid=function(){let e=1;return function(){const t=~~e;return e+=1,t}}(),Tt.MountedFlag=1,Tt.RemovingFlag=2,Tt.FlagShift=2,Tt.FlagMask=(1<<Tt.FlagShift)-1,Tt.MountFlags=0,Tt.InsertChildFlags=0,Tt.RemoveChildFlags=0;const It=function(e){const t=e.extend("ComponentRelation");return Object.defineProperty(t.prototype,"fastenerType",{get:function(){return t},configurable:!0}),t.prototype.initComponent=function(e){},t.prototype.willAttachComponent=function(e,t){},t.prototype.onAttachComponent=function(e,t){!0===this.observes&&e.observe(this)},t.prototype.didAttachComponent=function(e,t){},t.prototype.deinitComponent=function(e){},t.prototype.willDetachComponent=function(e){},t.prototype.onDetachComponent=function(e){!0===this.observes&&e.unobserve(this)},t.prototype.didDetachComponent=function(e){},Object.defineProperty(t.prototype,"parentComponent",{get(){const e=this.owner;return e instanceof Tt?e:null},configurable:!0}),t.prototype.insertChild=function(e,t,r,i){e.insertChild(t,r,i)},t.prototype.bindComponent=function(e,t){},t.prototype.unbindComponent=function(e){},t.prototype.detectComponent=function(e){return null},t.prototype.createComponent=function(){let e;const t=this.type;if(void 0!==t&&(e=t.create()),null==e){let e="Unable to create ";throw 0!==this.name.length&&(e+=this.name+" "),e+="component",new Error(e)}return e},t.prototype.fromAny=function(e){const t=this.type;return void 0!==t?t.fromAny(e):Tt.fromAny(e)},Object.defineProperty(t.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(t.prototype,"static",{get:function(){return!0},configurable:!0}),t.construct=function(t,r,i){return r=e.construct(t,r,i)},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,null==r&&(r=this);const s=r.extend(e,t);return s.construct=function(e,t,s){return t=r.construct(e,t,s),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),t},s},t}(gt),Mt=function(e){const t=e.extend("ComponentRef");return Object.defineProperty(t.prototype,"fastenerType",{get:function(){return t},configurable:!0}),t.prototype.onInherit=function(e){this.setComponent(e.component)},t.prototype.getComponent=function(){const e=this.component;if(null===e){let t=e+" ";throw 0!==this.name.length&&(t+=this.name+" "),t+="component",new TypeError(t)}return e},t.prototype.setComponent=function(e,t,r){null!==e&&(e=this.fromAny(e));let i=this.component;if(i!==e){let n;void 0===t&&(t=null),this.binds&&(n=this.parentComponent,null!==n)&&(null!==i&&i.parent===n&&(null===t&&(t=i.nextSibling),i.remove()),null!==e&&(void 0===r&&(r=this.key),this.insertChild(n,e,t,r)),i=this.component),i!==e&&(null!==i&&(this.willDetachComponent(i),this.component=null,this.onDetachComponent(i),this.deinitComponent(i),this.didDetachComponent(i)),null!==e&&(this.willAttachComponent(e,t),this.component=e,this.onAttachComponent(e,t),this.initComponent(e),this.didAttachComponent(e,t)))}return i},t.prototype.attachComponent=function(e,t){const r=this.component;return(e=null!=e?this.fromAny(e):null===r?this.createComponent():r)!==r&&(void 0===t&&(t=null),null!==r&&(this.willDetachComponent(r),this.component=null,this.onDetachComponent(r),this.deinitComponent(r),this.didDetachComponent(r)),this.willAttachComponent(e,t),this.component=e,this.onAttachComponent(e,t),this.initComponent(e),this.didAttachComponent(e,t)),e},t.prototype.detachComponent=function(){const e=this.component;return null!==e&&(this.willDetachComponent(e),this.component=null,this.onDetachComponent(e),this.deinitComponent(e),this.didDetachComponent(e)),e},t.prototype.insertComponent=function(e,t,r,i){if(null!=t)t=this.fromAny(t);else{const e=this.component;t=null===e?this.createComponent():e}null==e&&(e=this.parentComponent),void 0===r&&(r=null),void 0===i&&(i=this.key),null===e||t.parent===e&&t.key===i||this.insertChild(e,t,r,i);const n=this.component;return t!==n&&(null!==n&&(this.willDetachComponent(n),this.component=null,this.onDetachComponent(n),this.deinitComponent(n),this.didDetachComponent(n),n.remove()),this.willAttachComponent(t,r),this.component=t,this.onAttachComponent(t,r),this.initComponent(t),this.didAttachComponent(t,r)),t},t.prototype.removeComponent=function(){const e=this.component;return null!==e&&e.remove(),e},t.prototype.deleteComponent=function(){const e=this.detachComponent();return null!==e&&e.remove(),e},t.prototype.bindComponent=function(e,t){if(this.binds&&null===this.component){const r=this.detectComponent(e);null!==r&&(this.willAttachComponent(r,t),this.component=r,this.onAttachComponent(r,t),this.initComponent(r),this.didAttachComponent(r,t))}},t.prototype.unbindComponent=function(e){if(this.binds){const t=this.detectComponent(e);null!==t&&this.component===t&&(this.willDetachComponent(t),this.component=null,this.onDetachComponent(t),this.deinitComponent(t),this.didDetachComponent(t))}},t.prototype.detectComponent=function(e){const t=this.key;return void 0!==t&&t===e.key?e:null},t.construct=function(t,r,i){return null===r&&(delete(r=function(e,t,i){return void 0===e?r.component:(r.setComponent(e,t,i),r.owner)}).name,Object.setPrototypeOf(r,t.prototype)),(r=e.construct(t,r,i)).key=void 0,r.component=null,r},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,!0===t.key?Object.defineProperty(t,"key",{value:e,configurable:!0}):!1===t.key&&Object.defineProperty(t,"key",{value:void 0,configurable:!0}),null==r&&(r=this);const s=r.extend(e,t);return s.construct=function(e,t,s){return t=r.construct(e,t,s),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),t},s},t}(It),Vt=function(e){const t=e.extend("ComponentSet");return Object.defineProperty(t.prototype,"fastenerType",{get:function(){return t},configurable:!0}),t.prototype.hasComponent=function(e){return void 0!==this.components[e.uid]},t.prototype.addComponent=function(e,t,r){let i;e=null!=e?this.fromAny(e):this.createComponent(),void 0===t&&(t=null),this.binds&&(i=this.parentComponent,null!==i)&&(void 0===r&&(r=this.key(e)),this.insertChild(i,e,t,r));const n=this.components;return void 0===n[e.uid]&&(this.willAttachComponent(e,t),n[e.uid]=e,this.componentCount+=1,this.onAttachComponent(e,t),this.initComponent(e),this.didAttachComponent(e,t)),e},t.prototype.attachComponent=function(e,t){e=null!=e?this.fromAny(e):this.createComponent();const r=this.components;return void 0===r[e.uid]&&(void 0===t&&(t=null),this.willAttachComponent(e,t),r[e.uid]=e,this.componentCount+=1,this.onAttachComponent(e,t),this.initComponent(e),this.didAttachComponent(e,t)),e},t.prototype.detachComponent=function(e){const t=this.components;return void 0!==t[e.uid]?(this.willDetachComponent(e),this.componentCount-=1,delete t[e.uid],this.onDetachComponent(e),this.deinitComponent(e),this.didDetachComponent(e),e):null},t.prototype.insertComponent=function(e,t,r,i){t=null!=t?this.fromAny(t):this.createComponent(),null==e&&(e=this.parentComponent),void 0===r&&(r=null),void 0===i&&(i=this.key(t)),null===e||t.parent===e&&t.key===i||this.insertChild(e,t,r,i);const n=this.components;return void 0===n[t.uid]&&(this.willAttachComponent(t,r),n[t.uid]=t,this.componentCount+=1,this.onAttachComponent(t,r),this.initComponent(t),this.didAttachComponent(t,r)),t},t.prototype.removeComponent=function(e){return this.hasComponent(e)?(e.remove(),e):null},t.prototype.deleteComponent=function(e){const t=this.detachComponent(e);return null!==t&&t.remove(),t},t.prototype.bindComponent=function(e,t){if(this.binds){const r=this.detectComponent(e),i=this.components;null!==r&&void 0===i[r.uid]&&(this.willAttachComponent(r,t),i[r.uid]=r,this.componentCount+=1,this.onAttachComponent(r,t),this.initComponent(r),this.didAttachComponent(r,t))}},t.prototype.unbindComponent=function(e){if(this.binds){const t=this.detectComponent(e),r=this.components;null!==t&&void 0!==r[t.uid]&&(this.willDetachComponent(t),this.componentCount-=1,delete r[t.uid],this.onDetachComponent(t),this.deinitComponent(t),this.didDetachComponent(t))}},t.prototype.detectComponent=function(e){return"function"==typeof this.type&&e instanceof this.type?e:null},t.prototype.key=function(e){},Object.defineProperty(t.prototype,"sorted",{get(){return 0!=(this.flags&t.SortedFlag)},configurable:!0}),t.prototype.initInherits=function(e){this.flags=e?this.flags|t.SortedFlag:this.flags&~t.SortedFlag},t.prototype.sort=function(e){void 0===e&&(e=!0);const r=this.flags;if(e&&0==(r&t.SortedFlag)){const e=this.parentComponent;this.willSort(e),this.setFlags(r|t.SortedFlag),this.onSort(e),this.didSort(e)}else e||0==(r&t.SortedFlag)||this.setFlags(r&~t.SortedFlag);return this},t.prototype.willSort=function(e){},t.prototype.onSort=function(e){null!==e&&this.sortChildren(e)},t.prototype.didSort=function(e){},t.prototype.sortChildren=function(e){e.sortChildren(this.compareChildren.bind(this))},t.prototype.compareChildren=function(e,t){const r=this.components,i=r[e.uid],n=r[t.uid];return void 0!==i&&void 0!==n?this.compare(i,n):void 0!==i?1:void 0!==n?-1:0},t.prototype.compare=function(e,t){return e.uid<t.uid?-1:e.uid>t.uid?1:0},t.construct=function(t,r,i){return null===r&&(delete(r=function(e){return r.addComponent(e),r.owner}).name,Object.setPrototypeOf(r,t.prototype)),(r=e.construct(t,r,i)).components={},r.componentCount=0,r},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits,s=t.sorted;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,delete t.sorted,null==r&&(r=this);const o=r.extend(e,t);return o.construct=function(e,t,o){return t=r.construct(e,t,o),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),void 0!==s&&t.initSorted(s),t},o},t.SortedFlag=1<<e.FlagShift+0,t.FlagShift=e.FlagShift+1,t.FlagMask=(1<<t.FlagShift)-1,t}(It);class qt extends Z{constructor(e){super(),this.cursor=e}isEmpty(){return this.cursor.isEmpty()}head(){return this.cursor.head()[0]}step(){this.cursor.step()}skip(e){this.cursor.skip(e)}hasNext(){return this.cursor.hasNext()}nextIndex(){return this.cursor.nextIndex()}next(){const{value:e,done:t}=this.cursor.next();return{value:e&&e[0],done:t}}hasPrevious(){return this.cursor.hasPrevious()}previousIndex(){return this.cursor.previousIndex()}previous(){const{value:e,done:t}=this.cursor.previous();return{value:e&&e[0],done:t}}delete(){this.cursor.delete()}}class Ft extends Z{constructor(e){super(),this.cursor=e}isEmpty(){return this.cursor.isEmpty()}head(){return this.cursor.head()[1]}step(){this.cursor.step()}skip(e){this.cursor.skip(e)}hasNext(){return this.cursor.hasNext()}nextIndex(){return this.cursor.nextIndex()}next(){const{value:e,done:t}=this.cursor.next();return{value:e&&e[1],done:t}}hasPrevious(){return this.cursor.hasPrevious()}previousIndex(){return this.cursor.previousIndex()}previous(){const{value:e,done:t}=this.cursor.previous();return{value:e&&e[1],done:t}}delete(){this.cursor.delete()}}class Nt extends Z{constructor(e,t,r,i){super(),this.pages=e,this.index=t,this.childIndex=r,this.childCursor=i}isEmpty(){for(;;)if(null!==this.childCursor){if(!this.childCursor.isEmpty())return!1;this.childCursor=null}else{if(!(this.childIndex<this.pages.length))return this.childIndex=this.pages.length,!0;this.childCursor=this.pageCursor(this.pages[this.childIndex]),this.childIndex+=1}}head(){for(;;)if(null!==this.childCursor){if(!this.childCursor.isEmpty())return this.childCursor.head();this.childCursor=null}else{if(!(this.childIndex<this.pages.length))throw this.childIndex=this.pages.length,new Error("empty");this.childCursor=this.pageCursor(this.pages[this.childIndex]),this.childIndex+=1}}step(){for(;;)if(null!==this.childCursor){if(!this.childCursor.isEmpty())return void(this.index+=1);this.childCursor=null}else{if(!(this.childIndex<this.pages.length))throw this.childIndex=this.pages.length,new Error("empty");this.childCursor=this.pageCursor(this.pages[this.childIndex]),this.childIndex+=1}}skip(e){for(;e>0;)if(null!==this.childCursor)this.childCursor.hasNext()?(this.index+=1,e-=1,this.childCursor.next()):this.childCursor=null;else{if(!(this.childIndex<this.pages.length))break;{const t=this.pages[this.childIndex],r=this.pageSize(t);if(this.childIndex+=1,r<e){this.childCursor=this.pageCursor(t),e>0&&(this.index+=e,this.childCursor.skip(e),e=0);break}this.index+=r,e-=r}}}hasNext(){for(;;)if(null!==this.childCursor){if(this.childCursor.hasNext())return!0;this.childCursor=null}else{if(!(this.childIndex<this.pages.length))return this.childIndex=this.pages.length,!1;this.childCursor=this.pageCursor(this.pages[this.childIndex]),this.childIndex+=1}}nextIndex(){return this.index}next(){for(;;)if(null!==this.childCursor){if(this.childCursor.hasNext())return this.index+=1,this.childCursor.next();this.childCursor=null}else{if(!(this.childIndex<this.pages.length))return this.childIndex=this.pages.length,{done:!0};this.childCursor=this.pageCursor(this.pages[this.childIndex]),this.childIndex+=1}}hasPrevious(){for(;;)if(null!==this.childCursor){if(this.childCursor.hasPrevious())return!0;this.childCursor=null}else{if(!(this.childIndex>0))return this.childIndex=0,!1;this.childCursor=this.reversePageCursor(this.pages[this.childIndex-1]),this.childIndex-=1}}previousIndex(){return this.index-1}previous(){for(;;)if(null!==this.childCursor){if(this.childCursor.hasPrevious())return this.index-=1,this.childCursor.previous();this.childCursor=null}else{if(!(this.childIndex>0))return this.childIndex=0,{done:!0};this.childCursor=this.reversePageCursor(this.pages[this.childIndex-1]),this.childIndex-=1}}set(e){this.childCursor.set(e)}delete(){this.childCursor.delete()}}class zt{constructor(){this.pageSplitSize=32}compare(e,t){return b.compare(e,t)}pageShouldSplit(e){return e.arity>this.pageSplitSize}pageShouldMerge(e){return e.arity<this.pageSplitSize>>>1}}class Ut extends zt{constructor(e){super(),void 0===e&&(e=Rt.empty()),this.root=e}get size(){return this.root.size}isEmpty(){return this.root.isEmpty()}has(e){return this.root.has(e,this)}get(e){return this.root.get(e,this)}getEntry(e){return this.root.getEntry(e)}firstKey(){const e=this.root.firstEntry();return void 0!==e?e[0]:void 0}firstValue(){const e=this.root.firstEntry();return void 0!==e?e[1]:void 0}firstEntry(){return this.root.firstEntry()}lastKey(){const e=this.root.lastEntry();return void 0!==e?e[0]:void 0}lastValue(){const e=this.root.lastEntry();return void 0!==e?e[1]:void 0}lastEntry(){return this.root.lastEntry()}nextKey(e){const t=this.root.nextEntry(e,this);return void 0!==t?t[0]:void 0}nextValue(e){const t=this.root.nextEntry(e,this);return void 0!==t?t[1]:void 0}nextEntry(e){return this.root.nextEntry(e,this)}previousKey(e){const t=this.root.previousEntry(e,this);return void 0!==t?t[0]:void 0}previousValue(e){const t=this.root.previousEntry(e,this);return void 0!==t?t[1]:void 0}previousEntry(e){return this.root.previousEntry(e,this)}set(e,t){const r=this.root;let i=this.root.updated(e,t,this);return r!==i&&(i.size>r.size&&(i=i.balanced(this)),this.root=i),this}delete(e){const t=this.root,r=this.root.removed(e,this);return t!==r&&(this.root=r,!0)}drop(e){return e>0&&this.root.size>0&&(e<this.root.size?this.root=this.root.drop(e,this):this.root=Rt.empty()),this}take(e){return e<this.root.size&&this.root.size>0&&(this.root=e>0?this.root.take(e,this):Rt.empty()),this}clear(){this.root=Rt.empty()}updated(e,t){const r=this.root;let i=r.updated(e,t,this);return r!==i?(i.size>r.size&&(i=i.balanced(this)),this.copy(i)):this}removed(e){const t=this.root,r=t.removed(e,this);return t!==r?this.copy(r):this}cleared(){return this.root.isEmpty()?this:this.copy(Rt.empty())}reduced(e,t,r){const i=this.root,n=i.reduced(e,t,r);return i!==n&&(this.root=n),n.fold}forEach(e,t){return this.root.forEach(e,t)}forEachKey(e,t){return this.root.forEachKey(e,t)}forEachValue(e,t){return this.root.forEachValue(e,t)}keys(){return this.root.keys()}values(){return this.root.values()}entries(){return this.root.entries()}reverseKeys(){return this.root.reverseKeys()}reverseValues(){return this.root.reverseValues()}reverseEntries(){return this.root.reverseEntries()}clone(){return this.copy(this.root)}copy(e){const t=new Ut(e);return t.compare!==this.compare&&(t.compare=this.compare),t.pageSplitSize!==this.pageSplitSize&&(t.pageSplitSize=this.pageSplitSize),t}}class Rt{keys(){return new qt(this.entries())}values(){return new Ft(this.entries())}reverseKeys(){return new qt(this.reverseEntries())}reverseValues(){return new Ft(this.reverseEntries())}static empty(){return new jt([],void 0)}}i([a],Rt,"empty",null);class jt extends Rt{constructor(e,t){super(),this.slots=e,this.fold=t}get arity(){return this.slots.length}get size(){return this.slots.length}isEmpty(){return 0===this.slots.length}minKey(){return this.slots[0][0]}maxKey(){return this.slots[this.slots.length-1][0]}has(e,t){return this.lookup(e,t)>=0}get(e,t){const r=this.lookup(e,t);return r>=0?this.slots[r][1]:void 0}getEntry(e){return this.slots[e]}firstEntry(){const e=this.slots;return 0!==e.length?e[0]:void 0}lastEntry(){const e=this.slots;return 0!==e.length?e[e.length-1]:void 0}nextEntry(e,t){let r=this.lookup(e,t);return r>=0?r+=1:r=-(r+1),this.slots[r]}previousEntry(e,t){let r=this.lookup(e,t);return r>=0?r-=1:r=-(r+2),this.slots[r]}updated(e,t,r){let i=this.lookup(e,r);return i>=0?this.updatedSlot(i,e,t):(i=-(i+1),this.insertedSlot(i,e,t))}updatedSlot(e,t,r){const i=this.slots;if(r!==i[e][1]){const n=i.slice(0);return n[e]=[t,r],new jt(n,void 0)}return this}insertedSlot(e,t,r){const i=this.slots,n=i.length+1,s=new Array(n);for(let t=0;t<e;t+=1)s[t]=i[t];s[e]=[t,r];for(let t=e;t<n-1;t+=1)s[t+1]=i[t];return new jt(s,void 0)}removed(e,t){const r=this.lookup(e,t);return r>=0?this.slots.length>1?this.removedSlot(r):Rt.empty():this}removedSlot(e){const t=this.slots,r=new Array(t.length-1);for(let i=0;i<e;i+=1)r[i]=t[i];for(let i=e;i<r.length;i+=1)r[i]=t[i+1];return new jt(r,void 0)}drop(e,t){if(e>0){const t=this.slots;if(e<t.length){const r=t.length-e,i=new Array(r);for(let n=0;n<r;n+=1)i[n]=t[n+e];return new jt(i,void 0)}return Rt.empty()}return this}take(e,t){const r=this.slots;if(e<r.length){if(e>0){const t=new Array(e);for(let i=0;i<e;i+=1)t[i]=r[i];return new jt(t,void 0)}return Rt.empty()}return this}balanced(e){const t=this.slots.length;if(t>1&&e.pageShouldSplit(this)){const e=t>>>1;return this.split(e)}return this}split(e){const t=new Array(2),r=this.splitLeft(e),i=this.splitRight(e);t[0]=r,t[1]=i;const n=new Array(1);return n[0]=i.minKey(),new Lt(t,n,void 0,this.slots.length)}splitLeft(e){const t=this.slots,r=new Array(e);for(let i=0;i<e;i+=1)r[i]=t[i];return new jt(r,void 0)}splitRight(e){const t=this.slots,r=t.length-e,i=new Array(r);for(let n=0;n<r;n+=1)i[n]=t[n+e];return new jt(i,void 0)}reduced(e,t,r){if(void 0===this.fold){const r=this.slots;let i=e;for(let e=0,n=r.length;e<n;e+=1)i=t(i,r[e][1]);return new jt(r,i)}return this}forEach(e,t){const r=this.slots;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=e.call(t,n[0],n[1]);if(void 0!==s)return s}}forEachKey(e,t){const r=this.slots;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=e.call(t,n[0]);if(void 0!==s)return s}}forEachValue(e,t){const r=this.slots;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=e.call(t,n[1]);if(void 0!==s)return s}}entries(){return Z.array(this.slots)}reverseEntries(){return Z.array(this.slots,this.slots.length)}lookup(e,t){let r=0,i=this.slots.length-1;for(;r<=i;){const n=r+i>>>1,s=t.compare(e,this.slots[n][0]);if(s>0)r=n+1;else{if(!(s<0))return n;i=n-1}}return-(r+1)}}class Lt extends Rt{constructor(e,t,r,i){super(),this.pages=e,this.knots=t,this.fold=r,this.size=i}get arity(){return this.pages.length}isEmpty(){return 0===this.size}minKey(){return this.pages[0].minKey()}maxKey(){return this.pages[this.pages.length-1].maxKey()}has(e,t){let r=this.lookup(e,t);if(r>0)r+=1;else{if(!(r<0))return!0;r=-(r+1)}return this.pages[r].has(e,t)}get(e,t){let r=this.lookup(e,t);return r>=0?r+=1:r=-(r+1),this.pages[r].get(e,t)}getEntry(e){const t=this.pages;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];if(e<i.size)return i.getEntry(e);e-=i.size}}firstEntry(){const e=this.pages;return 0!==e.length?e[0].firstEntry():void 0}lastEntry(){const e=this.pages;return 0!==e.length?e[e.length-1].lastEntry():void 0}nextEntry(e,t){let r=this.lookup(e,t);r>=0?r+=1:r=-(r+1);const i=this.pages;let n=i[r].nextEntry(e,t);return void 0===n&&r+1<i.length&&(n=i[r+1].nextEntry(e,t)),n}previousEntry(e,t){let r=this.lookup(e,t);r>=0?r+=1:r=-(r+1);const i=this.pages;let n=i[r].previousEntry(e,t);return void 0===n&&r>0&&(n=i[r-1].previousEntry(e,t)),n}updated(e,t,r){let i=this.lookup(e,r);i>=0?i+=1:i=-(i+1);const n=this.pages[i],s=n.updated(e,t,r);return n!==s?n.size!==s.size&&r.pageShouldSplit(s)?this.updatedPageSplit(i,s,n):this.updatedPage(i,s,n):this}updatedPage(e,t,r){const i=this.pages.slice(0);i[e]=t;const n=this.knots;let s;n.length>0?(s=n.slice(0),e>0&&(s[e-1]=t.minKey())):s=[];const o=this.size-r.size+t.size;return new Lt(i,s,void 0,o)}updatedPageSplit(e,t,r){const i=this.pages,n=new Array(i.length+1);for(let t=0;t<e;t+=1)n[t]=i[t];const s=t.splitLeft(t.arity>>>1),o=t.splitRight(t.arity>>>1);n[e]=s,n[e+1]=o;for(let t=e+1;t<i.length;t+=1)n[t+1]=i[t];const a=this.knots,u=new Array(i.length);if(e>0){for(let t=0;t<e-1;t+=1)u[t]=a[t];u[e-1]=s.minKey(),u[e]=o.minKey();for(let t=e;t<a.length;t+=1)u[t+1]=a[t]}else{u[0]=o.minKey();for(let e=0;e<a.length;e+=1)u[e+1]=a[e]}const h=this.size-r.size+t.size;return new Lt(n,u,void 0,h)}updatedPageMerge(e,t,r){const i=this.pages,n=t.pages,s=new Array(i.length+n.length-1);for(let t=0;t<e;t+=1)s[t]=i[t];for(let t=0;t<n.length;t+=1)s[t+e]=n[t];for(let t=e+1;t<i.length;t+=1)s[t+n.length-1]=i[t];const o=this.knots,a=t.knots,u=new Array(s.length-1);if(e>0){for(let t=0;t<e-1;t+=1)u[t]=o[t];u[e-1]=n[0].minKey();for(let t=0;t<a.length;t+=1)u[t+e]=a[t];for(let t=e;t<o.length;t+=1)u[t+a.length]=o[t]}else{for(let e=0;e<a.length;e+=1)u[e]=a[e];u[a.length]=i[1].minKey();for(let e=1;e<o.length;e+=1)u[e+a.length]=o[e]}const h=this.size-r.size+t.size;return new Lt(s,u,void 0,h)}removed(e,t){let r=this.lookup(e,t);r>=0?r+=1:r=-(r+1);const i=this.pages[r],n=i.removed(e,t);return i!==n?this.replacedPage(r,n,i,t):this}replacedPage(e,t,r,i){return t.isEmpty()?this.pages.length>2?this.removedPage(e,t,r):this.pages.length>1?0===e?this.pages[1]:this.pages[0]:Rt.empty():t instanceof Lt&&i.pageShouldMerge(t)?this.updatedPageMerge(e,t,r):this.updatedPage(e,t,r)}removedPage(e,t,r){const i=this.pages,n=new Array(i.length-1);for(let t=0;t<e;t+=1)n[t]=i[t];for(let t=e+1;t<i.length;t+=1)n[t-1]=i[t];const s=this.knots,o=new Array(s.length-1);if(e>0){for(let t=0;t<e-1;t+=1)o[t]=s[t];for(let t=e;t<s.length;t+=1)o[t-1]=s[t]}else for(let e=1;e<s.length;e+=1)o[e-1]=s[e];const a=this.size-r.size;return new Lt(n,o,void 0,a)}drop(e,t){if(e>0){let r=this.size;if(e<r){const i=this.pages;let n=0;for(;n<i.length;){const t=i[n].size;if(!(t<=e))break;r-=t,e-=t,n+=1}const s=i.length-n;if(s>1){let o;if(n>0){const e=new Array(s);for(let t=0;t<s;t+=1)e[t]=i[t+n];const t=new Array(s-1);for(let e=0;e<t.length;e+=1)t[e]=this.knots[e+n];o=new Lt(e,t,void 0,r)}else o=this;if(e>0){const r=i[n],s=r.drop(e,t);return o.replacedPage(0,s,r,t)}return o}return i[n].drop(e,t)}return Rt.empty()}return this}take(e,t){if(e<this.size){if(e>0){const r=this.pages;let i=0,n=0;for(;i<r.length&&e>0;){const t=r[i].size;if(n+=t,i+=1,!(t<=e))break;e-=t}const s=0===e?i:i+1;if(s>1){let o;if(i<r.length){const e=new Array(s);for(let t=0;t<s;t+=1)e[t]=r[t];const t=new Array(s-1);for(let e=0;e<t.length;e+=1)t[e]=this.knots[e];o=new Lt(e,t,void 0,n)}else o=this;if(e>0){const n=r[i-1],s=n.take(e,t);return o.replacedPage(i-1,s,n,t)}return o}return e>0?r[0].take(e,t):r[0]}return Rt.empty()}return this}balanced(e){if(this.pages.length>1&&e.pageShouldSplit(this)){const e=this.knots.length>>>1;return this.split(e)}return this}split(e){const t=new Array(2),r=this.splitLeft(e),i=this.splitRight(e);t[0]=r,t[1]=i;const n=new Array(1);return n[0]=i.minKey(),new Lt(t,n,void 0,this.size)}splitLeft(e){const t=this.pages,r=new Array(e+1);for(let i=0;i<e+1;i+=1)r[i]=t[i];const i=this.knots,n=new Array(e);for(let t=0;t<e;t+=1)n[t]=i[t];let s=0;for(let t=0;t<=e;t+=1)s+=r[t].size;return new Lt(r,n,void 0,s)}splitRight(e){const t=this.pages,r=t.length-(e+1),i=new Array(r);for(let n=0;n<r;n+=1)i[n]=t[n+(e+1)];const n=this.knots,s=new Array(r-1);for(let t=0;t<s.length;t+=1)s[t]=n[t+(e+1)];let o=0;for(let e=0;e<r;e+=1)o+=i[e].size;return new Lt(i,s,void 0,o)}reduced(e,t,r){if(void 0===this.fold){const i=this.pages,n=i.length,s=new Array(n);for(let o=0;o<n;o+=1)s[o]=i[o].reduced(e,t,r);let o=s[0].fold;for(let e=1;e<n;e+=1)o=r(o,s[e].fold);return new Lt(s,this.knots,o,this.size)}return this}forEach(e,t){const r=this.pages;for(let i=0,n=r.length;i<n;i+=1){const n=r[i].forEach(e,t);if(void 0!==n)return n}}forEachKey(e,t){const r=this.pages;for(let i=0,n=r.length;i<n;i+=1){const n=r[i].forEachKey(e,t);if(void 0!==n)return n}}forEachValue(e,t){const r=this.pages;for(let i=0,n=r.length;i<n;i+=1){const n=r[i].forEachValue(e,t);if(void 0!==n)return n}}entries(){return new Bt(this.pages)}reverseEntries(){return new Bt(this.pages,this.size,this.pages.length)}lookup(e,t){let r=0,i=this.knots.length-1;for(;r<=i;){const n=r+i>>>1,s=t.compare(e,this.knots[n]);if(s>0)r=n+1;else{if(!(s<0))return n;i=n-1}}return-(r+1)}}class Bt extends Nt{constructor(e,t=0,r=0,i=null){super(e,t,r,i)}pageSize(e){return e.size}pageCursor(e){return e.entries()}reversePageCursor(e){return e.reverseEntries()}}class Kt{constructor(){this.pageSplitSize=32}identify(e){const t=new Uint8Array(6);return n.fillBytes(t),t}compare(e,t){return b.compare(e,t)}pageShouldSplit(e){return e.arity>this.pageSplitSize}pageShouldMerge(e){return e.arity<this.pageSplitSize>>>1}}class Wt extends Kt{constructor(e){super(),void 0===e&&(e=Ht.empty()),this.root=e}get length(){return this.root.size}isEmpty(){return this.root.isEmpty()}get(e,t){if(!(void 0!==t&&(e=this.lookup(t,e))<0))return this.root.get(e)}getEntry(e,t){if(!(void 0!==t&&(e=this.lookup(t,e))<0))return this.root.getEntry(e)}set(e,t,r){if(void 0!==r&&(e=this.lookup(r,e))<0)throw new RangeError(""+r);const i=this.root;if(e<0||e>=i.size)throw new RangeError(""+e);return this.root=i.updated(e,t,this),this}insert(e,t,r){const i=this.root;if(e<0||e>i.size)throw new RangeError(""+e);return this.root=i.inserted(e,t,r,this).balanced(this),this}remove(e,t){if(void 0!==t&&(e=this.lookup(t,e))<0)throw new RangeError(""+t);const r=this.root;if(e<0||e>r.size)throw new RangeError(""+e);return this.root=r.removed(e,this),this}push(...e){let t=this.root;for(let r=0;r<e.length;r+=1)t=t.inserted(t.size,e[r],void 0,this).balanced(this);return this.root=t,t.size}pop(){const e=this.root,t=e.size-1;if(t>=0){const r=e.get(t);return this.root=e.removed(t,this),r}}unshift(...e){let t=this.root;for(let r=e.length-1;r>=0;r-=1)t=t.inserted(0,e[r],void 0,this).balanced(this);return this.root=t,t.size}shift(){const e=this.root;if(e.size>0){const t=e.get(0);return this.root=e.removed(0,this),t}}move(e,t,r){if(void 0!==r&&(e=this.lookup(r,e))<0)throw new RangeError(""+r);const i=this.root;if(e<0||e>=i.size)throw new RangeError(""+e);if(t<0||t>=i.size)throw new RangeError(""+t);if(e!==t){const r=i.getEntry(e);this.root=i.removed(e,this).inserted(t,r[1],r[0],this).balanced(this)}return this}splice(e,t,...r){let i=this.root;e<0&&(e=i.size+e),e=Math.min(Math.max(0,e),i.size),void 0===t&&(t=i.size-e);const n=[];for(let r=e,s=e+t;r<s;r+=1)n.push(i.get(e)),i=i.removed(e,this);for(let t=0;t<r.length;t+=1)i=i.inserted(e+t,r[t],void 0,this).balanced(this);return this.root=i,n}drop(e){const t=this.root;return e>0&&t.size>0&&(e<t.size?this.root=t.drop(e,this):this.root=Ht.empty()),this}take(e){const t=this.root;return e<t.size&&t.size>0&&(this.root=e>0?t.take(e,this):Ht.empty()),this}clear(){this.root=Ht.empty()}forEach(e,t){return this.root.forEach(e,t,0)}keys(){return this.root.keys()}values(){return this.root.values()}entries(){return this.root.entries()}reverseKeys(){return this.root.reverseKeys()}reverseValues(){return this.root.reverseValues()}reverseEntries(){return this.root.reverseEntries()}clone(){return this.copy(this.root)}copy(e){const t=new Wt(e);return t.identify!==this.identify&&(t.identify=this.identify),t.compare!==this.compare&&(t.compare=this.compare),t.pageSplitSize!==this.pageSplitSize&&(t.pageSplitSize=this.pageSplitSize),t}lookup(e,t=0){const r=this.root;let i=t=Math.min(Math.max(0,t),r.size-1);do{const t=r.getEntry(i);if(void 0!==t&&0===this.compare(t[0],e))return i;i=(i+1)%r.size}while(isFinite(i)&&i!==t);return-1}}class Ht{keys(){return new qt(this.entries())}values(){return new Ft(this.entries())}reverseKeys(){return new qt(this.reverseEntries())}reverseValues(){return new Ft(this.reverseEntries())}static empty(){return new Xt([])}}i([a],Ht,"empty",null);class Xt extends Ht{constructor(e){super(),this.slots=e}get arity(){return this.slots.length}get size(){return this.slots.length}isEmpty(){return 0===this.slots.length}get(e){const t=this.slots[e];return void 0!==t?t[1]:void 0}getEntry(e){return this.slots[e]}updated(e,t,r){if(e<0||e>=this.slots.length)throw new RangeError(""+e);return this.updatedItem(e,t)}updatedItem(e,t){const r=this.slots,i=r[e];if(void 0!==i&&t!==i[1]){const n=r.slice(0);return n[e]=[i[0],t],new Xt(n)}return this}inserted(e,t,r,i){if(e<0||e>this.slots.length)throw new RangeError(""+e);return this.insertedItem(e,t,r,i)}insertedItem(e,t,r,i){void 0===r&&(r=i.identify(t));const n=this.slots,s=new Array(n.length+1);for(let t=0;t<e;t+=1)s[t]=n[t];s[e]=[r,t];for(let t=e;t<n.length;t+=1)s[t+1]=n[t];return new Xt(s)}removed(e,t){if(e<0||e>=this.slots.length)throw new RangeError(""+e);return this.slots.length>1?this.removedSlot(e):Ht.empty()}removedSlot(e){const t=this.slots,r=new Array(t.length-1);for(let i=0;i<e;i+=1)r[i]=t[i];for(let i=e;i<r.length;i+=1)r[i]=t[i+1];return new Xt(r)}drop(e,t){const r=this.slots;if(e>0&&r.length>0){if(e<r.length){const t=r.length-e,i=new Array(t);for(let n=0;n<t;n+=1)i[n]=r[n+e];return new Xt(i)}return Ht.empty()}return this}take(e,t){const r=this.slots;if(e<r.length&&r.length>0){if(e>0){const t=new Array(e);for(let i=0;i<e;i+=1)t[i]=r[i];return new Xt(t)}return Ht.empty()}return this}balanced(e){const t=this.slots.length;return t>1&&e.pageShouldSplit(this)?this.split(t>>>1):this}split(e){const t=new Array(2),r=this.splitLeft(e),i=this.splitRight(e);t[0]=r,t[1]=i;const n=new Array(1);return n[0]=e,new _t(t,n,this.slots.length)}splitLeft(e){const t=this.slots,r=new Array(e);for(let i=0;i<e;i+=1)r[i]=t[i];return new Xt(r)}splitRight(e){const t=this.slots,r=t.length-e,i=new Array(r);for(let n=0;n<r;n+=1)i[n]=t[n+e];return new Xt(i)}forEach(e,t,r){for(let i=0;i<this.slots.length;i+=1){const n=this.slots[i],s=e.call(t,n[1],r+i,n[0]);if(void 0!==s)return s}}entries(){return Z.array(this.slots)}reverseEntries(){return Z.array(this.slots,this.slots.length)}}class _t extends Ht{constructor(e,t,r){super(),this.pages=e,this.knots=t,this.size=r}get arity(){return this.pages.length}isEmpty(){return 0===this.size}get(e){let t=this.lookup(e);t>=0?t+=1:t=-(t+1);const r=0===t?e:e-this.knots[t-1];return this.pages[t].get(r)}getEntry(e){let t=this.lookup(e);t>=0?t+=1:t=-(t+1);const r=0===t?e:e-this.knots[t-1];return this.pages[t].getEntry(r)}updated(e,t,r){let i=this.lookup(e);i>=0?i+=1:i=-(i+1);const n=0===i?e:e-this.knots[i-1],s=this.pages[i],o=s.updated(n,t,r);return s!==o?s.size!==o.size&&r.pageShouldSplit(o)?this.updatedPageSplit(i,o,s):this.updatedPage(i,o,s):this}updatedPage(e,t,r){const i=this.pages,n=i.slice(0);n[e]=t;const s=this.knots;let o,a;if(i.length-1>0){o=s.slice(0),a=e>0?s[e-1]:0;for(let t=e;t<o.length;t+=1)a+=n[t].size,o[t]=a;a+=n[o.length].size}else o=[],a=0;return new _t(n,o,a)}updatedPageSplit(e,t,r){const i=this.pages,n=new Array(i.length+1);for(let t=0;t<e;t+=1)n[t]=i[t];const s=t.splitLeft(t.arity>>>1),o=t.splitRight(t.arity>>>1);n[e]=s,n[e+1]=o;for(let t=e+1;t<i.length;t+=1)n[t+1]=i[t];return _t.create(n)}updatedPageMerge(e,t,r){const i=this.pages,n=t.pages,s=new Array(i.length+n.length-1);for(let t=0;t<e;t+=1)s[t]=i[t];for(let t=0;t<n.length;t+=1)s[t+e]=n[t];for(let t=e+1;t<i.length;t+=1)s[t+n.length-1]=i[t];return _t.create(s)}inserted(e,t,r,i){let n=this.lookup(e);n>=0?n+=1:n=-(n+1);const s=0===n?e:e-this.knots[n-1],o=this.pages[n],a=o.inserted(s,t,r,i);return o!==a?i.pageShouldSplit(a)?this.updatedPageSplit(n,a,o):this.updatedPage(n,a,o):this}removed(e,t){let r=this.lookup(e);r>=0?r+=1:r=-(r+1);const i=0===r?e:e-this.knots[r-1],n=this.pages[r],s=n.removed(i,t);return n!==s?this.replacedPage(r,s,n,t):this}replacedPage(e,t,r,i){return t.isEmpty()?this.pages.length>2?this.removedPage(e,t,r):this.pages.length>1?0===e?this.pages[1]:this.pages[0]:Ht.empty():t instanceof _t&&i.pageShouldMerge(t)?this.updatedPageMerge(e,t,r):this.updatedPage(e,t,r)}removedPage(e,t,r){const i=this.pages,n=new Array(i.length-1);for(let t=0;t<e;t+=1)n[t]=i[t];for(let t=e+1;t<i.length;t+=1)n[t-1]=i[t];const s=this.knots,o=new Array(s.length-1);let a;if(e>0){for(let t=0;t<e;t+=1)o[t]=s[t];a=s[e-1]}else a=0;for(let t=e;t<o.length;t+=1)a+=n[t].size,o[t]=a;return a+=n[o.length].size,new _t(n,o,a)}drop(e,t){if(e>0){if(e<this.size){let r=this.lookup(e);r>=0?r+=1:r=-(r+1),e=0===r?e:e-this.knots[r-1];const i=this.pages,n=i.length-r;if(n>1){let s;if(r>0){const e=new Array(n);for(let t=0;t<n;t+=1)e[t]=i[t+r];s=_t.create(e)}else s=this;if(e>0){const n=i[r],o=n.drop(e,t);return s.replacedPage(0,o,n,t)}return s}return i[r].drop(e,t)}return Ht.empty()}return this}take(e,t){if(e<this.size){if(e>0){let r=this.lookup(e);r>=0?r+=1:r=-(r+1),e=0===r?e:e-this.knots[r-1];const i=this.pages,n=0===e?r:r+1;if(n>1){let s;if(r<i.length){const e=new Array(n);for(let t=0;t<n;t+=1)e[t]=i[t];const t=new Array(n-1);for(let e=0;e<t.length;e+=1)t[e]=this.knots[e];const r=t[n-2]+e[n-1].size;s=new _t(e,t,r)}else s=this;if(e>0){const n=i[r],o=n.take(e,t);return s.replacedPage(r,o,n,t)}return s}return e>0?i[0].take(e,t):i[0]}return Ht.empty()}return this}balanced(e){if(this.pages.length>1&&e.pageShouldSplit(this)){const e=this.knots.length>>>1;return this.split(e)}return this}split(e){const t=new Array(2),r=this.splitLeft(e),i=this.splitRight(e);t[0]=r,t[1]=i;const n=new Array(1);return n[0]=r.size,new _t(t,n,this.size)}splitLeft(e){const t=this.pages,r=new Array(e+1);for(let i=0;i<e+1;i+=1)r[i]=t[i];const i=this.knots,n=new Array(e);for(let t=0;t<e;t+=1)n[t]=i[t];let s=0;for(let t=0;t<=e;t+=1)s+=r[t].size;return new _t(r,n,s)}splitRight(e){const t=this.pages,r=t.length-(e+1),i=new Array(r);for(let n=0;n<r;n+=1)i[n]=t[n+(e+1)];const n=new Array(r-1);let s;if(r>0){s=i[0].size;for(let e=1;e<r;e+=1)n[e-1]=s,s+=i[e].size}else s=0;return new _t(i,n,s)}forEach(e,t,r){for(let i=0;i<this.pages.length;i+=1){const n=this.pages[i],s=n.forEach(e,t,r);if(void 0!==s)return s;r+=n.size}}entries(){return new Gt(this.pages)}reverseEntries(){return new Gt(this.pages,this.size,this.pages.length)}lookup(e){let t=0,r=this.knots.length-1;for(;t<=r;){const i=t+r>>>1;if(e>this.knots[i])t=i+1;else{if(!(e<this.knots[i]))return i;r=i-1}}return-(t+1)}static create(e){const t=new Array(e.length-1);let r=0;for(let i=0,n=t.length;i<n;i+=1)r+=e[i].size,t[i]=r;return r+=e[t.length].size,new _t(e,t,r)}}class Gt extends Nt{constructor(e,t=0,r=0,i=null){super(e,t,r,i)}pageSize(e){return e.size}pageCursor(e){return e.entries()}reversePageCursor(e){return e.reverseEntries()}}const Yt=function(){const e={};let t=1;return e.next=function(){const e=~~t;return t+=1,e},e}();class Zt{constructor(e,t){this.index=void 0!==e?e:{},this.array=void 0!==t?t:[]}get size(){return this.array.length}isEmpty(){return 0===this.array.length}has(e){return void 0!==this.index[e.id]}get(e){const t=this.index[e.id];return void 0!==t?this.array[t][1]:void 0}getField(e){const t=this.index[e.id];return void 0!==t?this.array[t]:void 0}getEntry(e){return this.array[e]}set(e,t){const r=this.index[e.id];if(void 0!==r){const e=this.array[r],i=e[1];return e[1]=t,i}return this.index[e.id]=this.array.length,void this.array.push([e,t])}delete(e){const t=this.index[e.id];if(void 0!==t){delete this.index[e.id];const r=this.array[t],i=this.array.pop();return r!==i&&(this.array[t]=i,this.index[i[0].id]=t),!0}return!1}remove(e){const t=this.index[e.id];if(void 0!==t){delete this.index[e.id];const r=this.array[t],i=this.array.pop();return r!==i&&(this.array[t]=i,this.index[i[0].id]=t),r[1]}}clear(){this.index={},this.array.length=0}forEach(e,t){const r=this.array;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=e.call(t,n[0],n[1]);if(void 0!==s)return s}}clone(){const e=this.array,t=e.length,r={},i=new Array(t);for(let n=0;n<t;n+=1){const[t,s]=e[n];i[n]=[t,s],r[t.id]=n}return new Zt(r,i)}}const Qt={};class $t{constructor(){this.id=Yt.next()}isExternal(){return!1}isDummy(){return!1}isInvalid(){return!1}addConstraintCondition(e,t){}removeConstraintCondition(e,t){}updateConstraintSolution(e){}}class Jt{constructor(){this.id=Yt.next()}isExternal(){return!1}isDummy(){return!0}isInvalid(){return!1}addConstraintCondition(e,t){}removeConstraintCondition(e,t){}updateConstraintSolution(e){}}class er{constructor(){this.id=Yt.next()}isExternal(){return!1}isDummy(){return!1}isInvalid(){return!1}addConstraintCondition(e,t){}removeConstraintCondition(e,t){}updateConstraintSolution(e){}}class tr{get id(){return-1}isExternal(){return!1}isDummy(){return!1}isInvalid(){return!0}addConstraintCondition(e,t){}removeConstraintCondition(e,t){}updateConstraintSolution(e){}}Qt.invalid=new tr;const rr=function(){const e={fromAny:function(t){return"number"==typeof t?e.constant(t):t},sum:function(...e){const t=new Zt;let r=0;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];if("number"==typeof n)r+=n;else if(nr.is(n)){const e=n.variable;if(null!==e){const r=t.getField(e);void 0!==r?r[1]+=n.coefficient:t.set(e,n.coefficient)}else r+=n.constant}else{const e=n.terms;for(let r=0,i=e.size;r<i;r+=1){const[i,n]=e.getEntry(r),s=t.getField(i);void 0!==s?s[1]+=n:t.set(i,n)}r+=n.constant}}return new ir(t,r)},product:function(e,t){return new sr(e,t)},constant:function(t){return 0===t?e.zero:new or(t)}};return e}();class ir{constructor(e,t){this.terms=e,this.constant=t}isConstant(){return this.terms.isEmpty()}plus(e){return rr.sum(this,e)}negative(){const e=this.terms,t=new Zt;for(let r=0,i=e.size;r<i;r+=1){const[i,n]=e.getEntry(r);t.set(i,-n)}return new ir(t,-this.constant)}minus(e){return e="number"==typeof e?rr.constant(e):e.negative(),rr.sum(this,e)}times(e){const t=this.terms,r=new Zt;for(let i=0,n=t.size;i<n;i+=1){const[n,s]=t.getEntry(i);r.set(n,s*e)}return new ir(r,this.constant*e)}divide(e){const t=this.terms,r=new Zt;for(let i=0,n=t.size;i<n;i+=1){const[n,s]=t.getEntry(i);r.set(n,s/e)}return new ir(r,this.constant/e)}debug(e){e=e.write("ConstraintExpression").write(46).write("sum").write(40);const t=this.terms.size;for(let r=0;r<t;r+=1){const[t,i]=this.terms.getEntry(r);r>0&&(e=e.write(", ")),e=1===i?e.debug(t):e.debug(rr.product(i,t))}return 0!==this.constant&&(t>0&&(e=e.write(", ")),e=e.debug(this.constant)),e=e.write(41)}toString(){return Oe.debug(this)}}const nr=function(){const e={is:function(e){if("object"==typeof e&&null!==e||"function"==typeof e){const t=e;return"coefficient"in t&&"variable"in t}return!1}};return e}();class sr{constructor(e,t){this.coefficient=e,this.variable=t}isConstant(){return!1}get terms(){const e=new Zt;return e.set(this.variable,this.coefficient),e}get constant(){return 0}plus(e){return(e=rr.fromAny(e))instanceof sr&&this.variable===e.variable?rr.product(this.coefficient+e.coefficient,this.variable):this.variable===e?rr.product(this.coefficient+1,this.variable):rr.sum(this,e)}negative(){return rr.product(-this.coefficient,this.variable)}minus(e){return(e=rr.fromAny(e))instanceof sr&&this.variable===e.variable?rr.product(this.coefficient-e.coefficient,this.variable):this.variable===e?rr.product(this.coefficient-1,this.variable):rr.sum(this,e.negative())}times(e){return rr.product(this.coefficient*e,this.variable)}divide(e){return rr.product(this.coefficient/e,this.variable)}debug(e){return e=e.write("ConstraintExpression").write(46).write("product").write(40).debug(this.coefficient).write(", ").debug(this.variable).write(41)}toString(){return Oe.debug(this)}}class or{constructor(e){this.constant=e}isConstant(){return!0}get coefficient(){return 0}get variable(){return null}get terms(){return new Zt}plus(e){return(e=rr.fromAny(e))instanceof or?rr.constant(this.constant+e.constant):rr.sum(this,e)}negative(){return rr.constant(-this.constant)}minus(e){return(e=rr.fromAny(e))instanceof or?rr.constant(this.constant-e.constant):rr.sum(this,e.negative())}times(e){return rr.constant(this.constant*e)}divide(e){return rr.constant(this.constant/e)}debug(e){return e=e.write("ConstraintExpression").write(46),e=0===this.constant?e.write("zero"):e.write("constant").write(40).debug(this.constant).write(41)}toString(){return Oe.debug(this)}}rr.zero=new or(0);const ar=function(e){const t=e.extend("ConstraintProperty");return t.prototype.isExternal=function(){return!0},t.prototype.isDummy=function(){return!1},t.prototype.isInvalid=function(){return!1},t.prototype.isConstant=function(){return!1},t.prototype.evaluateConstraintVariable=function(){},t.prototype.updateConstraintSolution=function(e){this.constrained&&this.toNumber(this.value)!==e&&this.setValue(e,yt.Reflexive)},t.prototype.setStrength=function(e){this.strength=hr.fromAny(e)},Object.defineProperty(t.prototype,"coefficient",{get:()=>1,configurable:!0}),Object.defineProperty(t.prototype,"variable",{get(){return this},configurable:!0}),Object.defineProperty(t.prototype,"terms",{get(){const e=new Zt;return e.set(this,1),e},configurable:!0}),Object.defineProperty(t.prototype,"constant",{get:()=>0,configurable:!0}),t.prototype.plus=function(e){return this===(e=rr.fromAny(e))?rr.product(2,this):rr.sum(this,e)},t.prototype.negative=function(){return rr.product(-1,this)},t.prototype.minus=function(e){return this===(e=rr.fromAny(e))?rr.zero:rr.sum(this,e.negative())},t.prototype.times=function(e){return rr.product(e,this)},t.prototype.divide=function(e){return rr.product(1/e,this)},Object.defineProperty(t.prototype,"constrained",{get(){return 0!=(this.flags&t.ConstrainedFlag)},configurable:!0}),t.prototype.constrain=function(e){void 0===e&&(e=!0);const r=this.flags;return e&&0==(r&t.ConstrainedFlag)?(this.setFlags(r|t.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&this.stopConstraining()):e||0==(r&t.ConstrainedFlag)||(this.setFlags(r&~t.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())),this},t.prototype.addConstraintCondition=function(e,t){this.conditionCount+=1,!this.constrained&&1===this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())},t.prototype.removeConstraintCondition=function(e,t){this.conditionCount-=1,!this.constrained&&0===this.conditionCount&&this.mounted&&this.stopConstraining()},Object.defineProperty(t.prototype,"constraining",{get(){return 0!=(this.flags&t.ConstrainingFlag)},configurable:!0}),t.prototype.startConstraining=function(){0==(this.flags&t.ConstrainingFlag)&&(this.willStartConstraining(),this.setFlags(this.flags|t.ConstrainingFlag),this.onStartConstraining(),this.didStartConstraining())},t.prototype.willStartConstraining=function(){},t.prototype.onStartConstraining=function(){const e=this.owner;cr.is(e)&&e.addConstraintVariable(this)},t.prototype.didStartConstraining=function(){},t.prototype.stopConstraining=function(){0!=(this.flags&t.ConstrainingFlag)&&(this.willStopConstraining(),this.setFlags(this.flags&~t.ConstrainingFlag),this.onStopConstraining(),this.didStopConstraining())},t.prototype.willStopConstraining=function(){},t.prototype.onStopConstraining=function(){const e=this.owner;cr.is(e)&&e.removeConstraintVariable(this)},t.prototype.didStopConstraining=function(){},t.prototype.updateConstraintVariable=function(){const e=this.owner,t=this.value;void 0!==t&&cr.is(e)&&e.setConstraintVariable(this,this.toNumber(t))},t.prototype.onSetValue=function(t,r){e.prototype.onSetValue.call(this,t,r);const i=this.owner;this.constraining&&cr.is(i)&&i.setConstraintVariable(this,null!=t?this.toNumber(t):0)},t.prototype.onMount=function(){e.prototype.onMount.call(this),this.constrained||0===this.conditionCount||this.startConstraining()},t.prototype.onUnmount=function(){this.constrained||0===this.conditionCount||this.stopConstraining(),e.prototype.onUnmount.call(this)},t.prototype.fromAny=function(e){if("string"==typeof e){const t=+e;if(isFinite(t))return t}return e},t.prototype.toNumber=function(e){return null!=e?+e:0},t.construct=function(t,r,i){return(r=e.construct(t,r,i)).id=Yt.next(),r.strength=hr.Strong,r.conditionCount=0,r},t.specialize=function(e){return null},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits,s=void 0!==t.strength?hr.fromAny(t.strength):void 0,o=t.constrain,a=t.value,u=t.initValue;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,delete t.strength,delete t.constrain,delete t.value,delete t.initValue,null==r&&(r=this.specialize(t.type)),null===r&&(r=this,void 0===t.fromAny&&C.is(t.type)&&(t.fromAny=t.type.fromAny));const h=r.extend(e,t);return h.construct=function(e,t,h){return t=r.construct(e,t,h),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),void 0!==s&&(t.strength=s),void 0!==u?t.value=t.fromAny(u()):void 0!==a&&(t.value=t.fromAny(a)),!0===o&&t.constrain(),t},h},t.ConstrainedFlag=1<<e.FlagShift+0,t.ConstrainingFlag=1<<e.FlagShift+1,t.FlagShift=e.FlagShift+2,t.FlagMask=(1<<t.FlagShift)-1,t}(vt),ur=function(e){const t=e.extend("ConstraintAnimator");return t.prototype.isExternal=function(){return!0},t.prototype.isDummy=function(){return!1},t.prototype.isInvalid=function(){return!1},t.prototype.isConstant=function(){return!1},t.prototype.evaluateConstraintVariable=function(){},t.prototype.updateConstraintSolution=function(e){this.constrained&&this.toNumber(this.state)!==e&&this.setState(e,yt.Reflexive)},t.prototype.setStrength=function(e){this.strength=hr.fromAny(e)},Object.defineProperty(t.prototype,"coefficient",{get:()=>1,configurable:!0}),Object.defineProperty(t.prototype,"variable",{get(){return this},configurable:!0}),Object.defineProperty(t.prototype,"terms",{get(){const e=new Zt;return e.set(this,1),e},configurable:!0}),Object.defineProperty(t.prototype,"constant",{get:()=>0,configurable:!0}),t.prototype.plus=function(e){return this===(e=rr.fromAny(e))?rr.product(2,this):rr.sum(this,e)},t.prototype.negative=function(){return rr.product(-1,this)},t.prototype.minus=function(e){return this===(e=rr.fromAny(e))?rr.zero:rr.sum(this,e.negative())},t.prototype.times=function(e){return rr.product(e,this)},t.prototype.divide=function(e){return rr.product(1/e,this)},Object.defineProperty(t.prototype,"constrained",{get(){return 0!=(this.flags&t.ConstrainedFlag)},configurable:!0}),t.prototype.constrain=function(e){void 0===e&&(e=!0);const r=this.flags;return e&&0==(r&t.ConstrainedFlag)?(this.setFlags(r|t.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&this.stopConstraining()):e||0==(r&t.ConstrainedFlag)||(this.setFlags(r&~t.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())),this},t.prototype.addConstraintCondition=function(e,t){this.conditionCount+=1,!this.constrained&&1===this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())},t.prototype.removeConstraintCondition=function(e,t){this.conditionCount-=1,!this.constrained&&0===this.conditionCount&&this.mounted&&this.stopConstraining()},Object.defineProperty(t.prototype,"constraining",{get(){return 0!=(this.flags&t.ConstrainingFlag)},configurable:!0}),t.prototype.startConstraining=function(){0==(this.flags&t.ConstrainingFlag)&&(this.willStartConstraining(),this.setFlags(this.flags|t.ConstrainingFlag),this.onStartConstraining(),this.didStartConstraining())},t.prototype.willStartConstraining=function(){},t.prototype.onStartConstraining=function(){const e=this.owner;cr.is(e)&&e.addConstraintVariable(this)},t.prototype.didStartConstraining=function(){},t.prototype.stopConstraining=function(){0!=(this.flags&t.ConstrainingFlag)&&(this.willStopConstraining(),this.setFlags(this.flags&~t.ConstrainingFlag),this.onStopConstraining(),this.didStopConstraining())},t.prototype.willStopConstraining=function(){},t.prototype.onStopConstraining=function(){const e=this.owner;cr.is(e)&&e.removeConstraintVariable(this)},t.prototype.didStopConstraining=function(){},t.prototype.updateConstraintVariable=function(){const e=this.owner,t=this.value;void 0!==t&&cr.is(e)&&e.setConstraintVariable(this,this.toNumber(t))},t.prototype.onSetValue=function(t,r){e.prototype.onSetValue.call(this,t,r);const i=this.owner;this.constraining&&cr.is(i)&&i.setConstraintVariable(this,null!=t?this.toNumber(t):0)},t.prototype.onMount=function(){e.prototype.onMount.call(this),this.constrained||0===this.conditionCount||this.startConstraining()},t.prototype.onUnmount=function(){this.constrained||0===this.conditionCount||this.stopConstraining(),e.prototype.onUnmount.call(this)},t.prototype.fromAny=function(e){if("string"==typeof e){const t=+e;if(isFinite(t))return t}return e},t.prototype.toNumber=function(e){return null!=e?+e:0},t.construct=function(t,r,i){return(r=e.construct(t,r,i)).id=Yt.next(),r.strength=hr.Strong,r.conditionCount=0,r},t.specialize=function(e){return null},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits,s=void 0!==t.strength?hr.fromAny(t.strength):void 0,o=t.constrain,a=t.value,u=t.initValue;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,delete t.strength,delete t.constrain,delete t.value,delete t.initValue,null==r&&(r=this.specialize(t.type)),null===r&&(r=this,void 0===t.fromAny&&C.is(t.type)&&(t.fromAny=t.type.fromAny));const h=r.extend(e,t);return h.construct=function(e,t,h){return t=r.construct(e,t,h),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),void 0!==s&&(t.strength=s),void 0!==u?(t.value=t.fromAny(u()),t.state=t.value):void 0!==a&&(t.value=t.fromAny(a),t.state=t.value),!0===o&&t.constrain(),t},h},t.ConstrainedFlag=1<<e.FlagShift+0,t.ConstrainingFlag=1<<e.FlagShift+1,t.FlagShift=e.FlagShift+2,t.FlagMask=(1<<t.FlagShift)-1,t}(St),hr=function(){const e={Required:1001001e3,Strong:1e6,Medium:1e3,Weak:1,Unbound:-1,clip:function(t){return Math.min(Math.max(0,t),e.Required)},fromAny:function(t){if("number"==typeof t)return e.clip(t);if("required"===t)return e.Required;if("strong"===t)return e.Strong;if("medium"===t)return e.Medium;if("weak"===t)return e.Weak;throw new TypeError(""+t)}};return e}();class lr{constructor(e,t,r,i){this.id=Yt.next(),this.scope=e,this.expression=t,this.relation=r,this.strength=i}isConstrained(){return this.scope.hasConstraint(this)}constrain(e=!0){return e?this.scope.addConstraint(this):this.scope.removeConstraint(this),this}debug(e){return e=e.debug(this.scope).write(46).write("constraint").write(40).debug(this.expression).write(", ").debug(this.relation).write(", ").debug(void 0).write(", "),e=(e=this.strength===hr.Required?e.debug("required"):this.strength===hr.Strong?e.debug("strong"):this.strength===hr.Medium?e.debug("medium"):this.strength===hr.Weak?e.debug("weak"):e.debug(this.strength)).write(41)}toString(){return Oe.debug(this)}}const cr=function(){const e={is:function(e){if("object"==typeof e&&null!==e||"function"==typeof e){return"constraint"in e}return!1}};return e}();class dr{constructor(e,t,r,i){this.solver=e,this.symbol=t,this.cells=r,this.constant=i}setSymbol(e){this.symbol=e,this.invalidate()}setConstant(e){this.constant!==e&&(this.constant=e,this.invalidate())}isConstant(){return this.cells.isEmpty()}isDummy(){for(let e=0,t=this.cells.size;e<t;e+=1){if(!(this.cells.getEntry(e)[0]instanceof Jt))return!1}return!0}clone(){return new dr(this.solver,this.symbol,this.cells.clone(),this.constant)}add(e){const t=this.constant+e;return this.setConstant(t),t}insertSymbol(e,t=1){var r;t+=null!==(r=this.cells.get(e))&&void 0!==r?r:0,Math.abs(t)<l.Epsilon?this.cells.remove(e):this.cells.set(e,t)}insertRow(e,t){this.setConstant(this.constant+e.constant*t);for(let r=0,i=e.cells.size;r<i;r+=1){const[i,n]=e.cells.getEntry(r);this.insertSymbol(i,n*t)}}removeSymbol(e){this.cells.remove(e)}negate(){this.setConstant(-this.constant);for(let e=0,t=this.cells.size;e<t;e+=1){const t=this.cells.getEntry(e);t[1]=-t[1]}}solveFor(e){const t=this.cells.remove(e);if(void 0!==t){const e=-1/t;this.setConstant(this.constant*e);for(let t=0,r=this.cells.size;t<r;t+=1){this.cells.getEntry(t)[1]*=e}}}solveForEx(e,t){this.insertSymbol(e,-1),this.solveFor(t)}coefficientFor(e){const t=this.cells.get(e);return void 0!==t?t:0}substitute(e,t){const r=this.cells.remove(e);void 0!==r&&this.insertRow(t,r)}invalidate(){const e=this.symbol;null!==e&&this.solver.invalidate(e,this)}}class pr{constructor(){}updated(e,t){const r=Cr.create(2);return r.push(this),r.set(e,t),r}updatedAttr(e,t){const r=Cr.create(2);return r.push(this),r.setAttr(e,t),r}updatedSlot(e,t){const r=Cr.create(2);return r.push(this),r.setSlot(e,t),r}appended(...e){const t=Cr.create(1+arguments.length);return t.push(this),t.push(...e),t}prepended(...e){const t=Cr.create(arguments.length+1);return t.push(...e),t.push(this),t}concat(...e){const t=Cr.create();t.push(this);for(let r=0,i=e.length;r<i;r+=1)pr.fromAny(e[r]).forEach((function(e){t.push(e)}));return t}lt(e){return e=pr.fromAny(e),this.compareTo(e)<0?qr.from(!0):pr.absent()}le(e){return e=pr.fromAny(e),this.compareTo(e)<=0?qr.from(!0):pr.absent()}eq(e){return e=pr.fromAny(e),this.equals(e)?qr.from(!0):pr.absent()}ne(e){return e=pr.fromAny(e),this.equals(e)?pr.absent():qr.from(!0)}ge(e){return e=pr.fromAny(e),this.compareTo(e)>=0?qr.from(!0):pr.absent()}gt(e){return e=pr.fromAny(e),this.compareTo(e)>0?qr.from(!0):pr.absent()}invoke(e){return pr.absent()}filter(e){const t=yi.literal(this);return 0===arguments.length?t.filter():t.filter(e)}max(e){return this.compareTo(e)>=0?this:e}min(e){return this.compareTo(e)<=0?this:e}evaluate(e){return this}substitute(e){return this}cast(e,t){let r=e.cast(this);return void 0===r&&(r=t),r}coerce(e,t){let r=e.cast(this);return void 0===r&&(r=e.unit),void 0===r&&(r=t),r}get precedence(){return 11}forEach(e,t){return e.call(t,this,0)}iterator(){return Z.unary(this)}interpolateTo(e){return e instanceof pr?fr(this,e):null}display(e){return this.debug(e)}toString(){return Oe.debug(this)}static empty(){return Cr.empty()}static extant(){return Fr.extant()}static absent(){return Nr.absent()}static fromAny(e){return e instanceof pr?e:xr.fromAny(e)}static globalScope(){return Cr.create(1).slot("math",Ti.scope).commit()}}i([a],pr,"globalScope",null);const fr=function(e){const t=function(e,r){const i=function(e){return e<1?i[0]:i[1]};return Object.setPrototypeOf(i,t.prototype),i[0]=e.commit(),i[1]=r.commit(),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class mr extends pr{constructor(){super()}isDefined(){return!0}isDistinct(){return!0}isDefinite(){return!0}toValue(){return this.value}get tag(){}get target(){return this.value}flattened(){return xr.absent()}unflattened(){return Cr.of(this)}header(e){return xr.absent()}headers(e){}head(){return pr.absent()}tail(){return Cr.empty()}body(){return xr.absent()}get length(){return 0}has(e){return!1}get(e){return xr.absent()}getAttr(e){return xr.absent()}getSlot(e){return xr.absent()}getField(e){}getItem(e){return pr.absent()}deleted(e){return this}conditional(e,t){return e=pr.fromAny(e)}or(e){return this}and(e){return e=pr.fromAny(e)}lambda(e){return xr.absent()}stringValue(e){return this.value.stringValue(e)}numberValue(e){return this.value.numberValue(e)}booleanValue(e){return this.value.booleanValue(e)}interpolateTo(e){return e instanceof mr?wr(this,e):super.interpolateTo(e)}static of(e,t){let r;return"string"==typeof e?r=e:e instanceof Tr&&(r=e.value),void 0!==r&&64===r.charCodeAt(0)?(r=r.slice(1),1===arguments.length?gr.of(r):gr.of(r,t)):1===arguments.length?yr.of(e):yr.of(e,t)}static fromAny(e){if(e instanceof mr)return e;if("object"==typeof e&&null!==e){if(void 0!==e.$key)return mr.of(e.$key,e.$value);for(const t in e)return mr.of(t,e[t])}throw new TypeError(""+e)}}mr.ImmutableFlag=1;class yr extends mr{constructor(e,t,r){super(),this.key=e.commit(),this.value=t,this.flags=void 0!==r?r:0}isConstant(){return this.key.isConstant()&&this.value.isConstant()}setValue(e){if(0!=(this.flags&mr.ImmutableFlag))throw new Error("immutable");const t=this.value;return this.value=e,t}updatedValue(e){return new yr(this.key,e)}bitwiseOr(e){if((e=pr.fromAny(e))instanceof zr)return new Zr(this,e);let t;return t=e instanceof yr&&this.key.equals(e.key)?this.value.bitwiseOr(e.value):e instanceof xr?this.value.bitwiseOr(e):xr.absent(),t.isDefined()?new yr(this.key,t):pr.absent()}bitwiseXor(e){if((e=pr.fromAny(e))instanceof zr)return new Qr(this,e);let t;return t=e instanceof yr&&this.key.equals(e.key)?this.value.bitwiseXor(e.value):e instanceof xr?this.value.bitwiseXor(e):xr.absent(),t.isDefined()?new yr(this.key,t):pr.absent()}bitwiseAnd(e){if((e=pr.fromAny(e))instanceof zr)return new $r(this,e);let t;return t=e instanceof yr&&this.key.equals(e.key)?this.value.bitwiseAnd(e.value):e instanceof xr?this.value.bitwiseAnd(e):xr.absent(),t.isDefined()?new yr(this.key,t):pr.absent()}plus(e){if((e=pr.fromAny(e))instanceof zr)return new si(this,e);let t;return t=e instanceof yr&&this.key.equals(e.key)?this.value.plus(e.value):e instanceof xr?this.value.plus(e):xr.absent(),t.isDefined()?new yr(this.key,t):pr.absent()}minus(e){if((e=pr.fromAny(e))instanceof zr)return new oi(this,e);let t;return t=e instanceof yr&&this.key.equals(e.key)?this.value.minus(e.value):e instanceof xr?this.value.minus(e):xr.absent(),t.isDefined()?new yr(this.key,t):pr.absent()}times(e){if((e=pr.fromAny(e))instanceof zr)return new ai(this,e);let t;return t=e instanceof yr&&this.key.equals(e.key)?this.value.times(e.value):e instanceof xr?this.value.times(e):xr.absent(),t.isDefined()?new yr(this.key,t):pr.absent()}divide(e){if((e=pr.fromAny(e))instanceof zr)return new ui(this,e);let t;return t=e instanceof yr&&this.key.equals(e.key)?this.value.divide(e.value):e instanceof xr?this.value.divide(e):xr.absent(),t.isDefined()?new yr(this.key,t):pr.absent()}modulo(e){if((e=pr.fromAny(e))instanceof zr)return new hi(this,e);let t;return t=e instanceof yr&&this.key.equals(e.key)?this.value.modulo(e.value):e instanceof xr?this.value.modulo(e):xr.absent(),t.isDefined()?new yr(this.key,t):pr.absent()}not(){const e=this.value.not();return e.isDefined()?new yr(this.key,e):pr.absent()}bitwiseNot(){const e=this.value.bitwiseNot();return e.isDefined()?new yr(this.key,e):pr.absent()}negative(){const e=this.value.negative();return e.isDefined()?new yr(this.key,e):pr.absent()}positive(){const e=this.value.positive();return e.isDefined()?new yr(this.key,e):pr.absent()}inverse(){const e=this.value.inverse();return e.isDefined()?new yr(this.key,e):pr.absent()}evaluate(e){e=_r.fromAny(e);const t=this.key.evaluate(e).toValue(),r=this.value.evaluate(e).toValue();return t===this.key&&r===this.value?this:t.isDefined()&&r.isDefined()?new yr(t,r):pr.absent()}substitute(e){e=_r.fromAny(e);const t=this.key.substitute(e).toValue(),r=this.value.substitute(e).toValue();return t===this.key&&r===this.value?this:t.isDefined()&&r.isDefined()?new yr(t,r):pr.absent()}toAny(){const e={};return this.key instanceof Tr?e[this.key.value]=this.value.toAny():(e.$key=this.key.toAny(),e.$value=this.value.toAny()),e}isAliased(){return!1}isMutable(){return 0==(this.flags&mr.ImmutableFlag)}alias(){this.flags|=mr.ImmutableFlag}branch(){return 0!=(this.flags&mr.ImmutableFlag)?new yr(this.key,this.value,this.flags&~mr.ImmutableFlag):this}clone(){return new yr(this.key.clone(),this.value.clone())}commit(){return this.flags|=mr.ImmutableFlag,this.value.commit(),this}interpolateTo(e){return e instanceof yr?br(this,e):super.interpolateTo(e)}get typeOrder(){return 2}compareTo(e){if(e instanceof yr){let t=this.key.compareTo(e.key);return 0===t&&(t=this.value.compareTo(e.value)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof yr&&(this.key.equals(e.key)&&this.value.equivalentTo(e.value,t))}keyEquals(e){return"string"==typeof e&&this.key instanceof Tr?this.key.value===e:e instanceof mr?this.key.equals(e.key):this.key.equals(e)}equals(e){return this===e||e instanceof yr&&(this.key.equals(e.key)&&this.value.equals(e.value))}hashCode(){return o.mash(o.mix(o.mix(m.hash(yr),this.key.hashCode()),this.value.hashCode()))}debug(e){return e=e.write("Slot").write(46).write("of").write(40).display(this.key),this.value instanceof Fr||(e=e.write(44).write(32).display(this.value)),e=e.write(41)}static of(e,t){return e=xr.fromAny(e),t=1===arguments.length?xr.extant():xr.fromAny(t),new yr(e,t)}}const wr=function(e){const t=function(e,r){const i=function(e){const t=i.keyInterpolator(e),r=i.valueInterpolator(e);return yr.of(t,r)};return Object.setPrototypeOf(i,t.prototype),i.keyInterpolator=e.key.interpolateTo(r.key),i.valueInterpolator=e.value.interpolateTo(r.value),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return yr.of(this.keyInterpolator[0],this.valueInterpolator[0])},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return yr.of(this.keyInterpolator[1],this.valueInterpolator[1])},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.keyInterpolator.equals(e.keyInterpolator)&&this.valueInterpolator.equals(e.valueInterpolator))},t}(D);class gr extends mr{constructor(e,t,r){super(),this.key=e,this.value=t,this.flags=void 0!==r?r:0}isConstant(){return this.key.isConstant()&&this.value.isConstant()}get name(){return this.key.value}setValue(e){if(0!=(this.flags&mr.ImmutableFlag))throw new Error("immutable");const t=this.value;return this.value=e,t}updatedValue(e){return new gr(this.key,e)}bitwiseOr(e){if((e=pr.fromAny(e))instanceof zr)return new Zr(this,e);let t;return t=e instanceof gr&&this.key.equals(e.key)?this.value.bitwiseOr(e.value):e instanceof xr?this.value.bitwiseOr(e):xr.absent(),t.isDefined()?new gr(this.key,t):pr.absent()}bitwiseXor(e){if((e=pr.fromAny(e))instanceof zr)return new Qr(this,e);let t;return t=e instanceof gr&&this.key.equals(e.key)?this.value.bitwiseXor(e.value):e instanceof xr?this.value.bitwiseXor(e):xr.absent(),t.isDefined()?new gr(this.key,t):pr.absent()}bitwiseAnd(e){if((e=pr.fromAny(e))instanceof zr)return new $r(this,e);let t;return t=e instanceof gr&&this.key.equals(e.key)?this.value.bitwiseAnd(e.value):e instanceof xr?this.value.bitwiseAnd(e):xr.absent(),t.isDefined()?new gr(this.key,t):pr.absent()}plus(e){if((e=pr.fromAny(e))instanceof zr)return new si(this,e);let t;return t=e instanceof gr&&this.key.equals(e.key)?this.value.plus(e.value):e instanceof xr?this.value.plus(e):xr.absent(),t.isDefined()?new gr(this.key,t):pr.absent()}minus(e){if((e=pr.fromAny(e))instanceof zr)return new oi(this,e);let t;return t=e instanceof gr&&this.key.equals(e.key)?this.value.minus(e.value):e instanceof xr?this.value.minus(e):xr.absent(),t.isDefined()?new gr(this.key,t):pr.absent()}times(e){if((e=pr.fromAny(e))instanceof zr)return new ai(this,e);let t;return t=e instanceof gr&&this.key.equals(e.key)?this.value.times(e.value):e instanceof xr?this.value.times(e):xr.absent(),t.isDefined()?new gr(this.key,t):pr.absent()}divide(e){if((e=pr.fromAny(e))instanceof zr)return new ui(this,e);let t;return t=e instanceof gr&&this.key.equals(e.key)?this.value.divide(e.value):e instanceof xr?this.value.divide(e):xr.absent(),t.isDefined()?new gr(this.key,t):pr.absent()}modulo(e){if((e=pr.fromAny(e))instanceof zr)return new hi(this,e);let t;return t=e instanceof gr&&this.key.equals(e.key)?this.value.modulo(e.value):e instanceof xr?this.value.modulo(e):xr.absent(),t.isDefined()?new gr(this.key,t):pr.absent()}not(){const e=this.value.not();return e.isDefined()?new gr(this.key,e):pr.absent()}bitwiseNot(){const e=this.value.bitwiseNot();return e.isDefined()?new gr(this.key,e):pr.absent()}negative(){const e=this.value.negative();return e.isDefined()?new gr(this.key,e):pr.absent()}positive(){const e=this.value.positive();return e.isDefined()?new gr(this.key,e):pr.absent()}inverse(){const e=this.value.inverse();return e.isDefined()?new gr(this.key,e):pr.absent()}evaluate(e){e=_r.fromAny(e);const t=this.key.evaluate(e).toValue(),r=this.value.evaluate(e).toValue();return t===this.key&&r===this.value?this:t.isDefined()&&r.isDefined()?t instanceof Tr?new gr(t,r):new yr(t,r):pr.absent()}substitute(e){e=_r.fromAny(e);const t=this.key.substitute(e).toValue(),r=this.value.substitute(e).toValue();return t===this.key&&r===this.value?this:t.isDefined()&&r.isDefined()?t instanceof Tr?new gr(t,r):new yr(t,r):pr.absent()}toAny(){const e={};return e["@"+this.key.value]=this.value.toAny(),e}isAliased(){return!1}isMutable(){return 0==(this.flags&mr.ImmutableFlag)}alias(){this.flags|=mr.ImmutableFlag}branch(){return 0!=(this.flags&mr.ImmutableFlag)?new gr(this.key,this.value,this.flags&~mr.ImmutableFlag):this}clone(){return new gr(this.key.clone(),this.value.clone())}commit(){return this.flags|=mr.ImmutableFlag,this.value.commit(),this}interpolateTo(e){return e instanceof gr?vr(this,e):super.interpolateTo(e)}get typeOrder(){return 1}compareTo(e){if(e instanceof gr){let t=this.key.compareTo(e.key);return 0===t&&(t=this.value.compareTo(e.value)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof gr&&(this.key.equals(e.key)&&this.value.equivalentTo(e.value,t))}keyEquals(e){return"string"==typeof e?this.key.value===e:e instanceof mr?this.key.equals(e.key):this.key.equals(e)}equals(e){return this===e||e instanceof gr&&(this.key.equals(e.key)&&this.value.equals(e.value))}hashCode(){return o.mash(o.mix(o.mix(m.hash(gr),this.key.hashCode()),this.value.hashCode()))}debug(e){return e=e.write("Attr").write(46).write("of").write(40).display(this.key),this.value instanceof Fr||(e=e.write(44).write(32).display(this.value)),e=e.write(41)}static of(e,t){return e=Tr.fromAny(e),t=1===arguments.length?xr.extant():xr.fromAny(t),new gr(e,t)}}const vr=function(e){const t=function(e,r){const i=function(e){const t=i.keyInterpolator(e),r=i.valueInterpolator(e);return gr.of(t,r)};return Object.setPrototypeOf(i,t.prototype),i.keyInterpolator=e.key.interpolateTo(r.key),i.valueInterpolator=e.value.interpolateTo(r.value),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return gr.of(this.keyInterpolator[0],this.valueInterpolator[0])},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return gr.of(this.keyInterpolator[1],this.valueInterpolator[1])},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.keyInterpolator.equals(e.keyInterpolator)&&this.valueInterpolator.equals(e.valueInterpolator))},t}(D),br=function(e){const t=function(e,r){const i=function(e){const t=i.keyInterpolator(e),r=i.valueInterpolator(e);return yr.of(t,r)};return Object.setPrototypeOf(i,t.prototype),i.keyInterpolator=e.key.interpolateTo(r.key),i.valueInterpolator=e.value.interpolateTo(r.value),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return yr.of(this.keyInterpolator[0],this.valueInterpolator[0])},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return yr.of(this.keyInterpolator[1],this.valueInterpolator[1])},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.keyInterpolator.equals(e.keyInterpolator)&&this.valueInterpolator.equals(e.valueInterpolator))},t}(D);class xr extends pr{constructor(){super()}isDefined(){return!0}isDistinct(){return!0}isDefinite(){return!0}get key(){return xr.absent()}toValue(){return this}get tag(){}get target(){return this}flattened(){return this}unflattened(){return Cr.of(this)}header(e){return xr.absent()}headers(e){}head(){return pr.absent()}tail(){return Cr.empty()}body(){return xr.extant()}get length(){return 0}has(e){return!1}get(e){return xr.absent()}getAttr(e){return xr.absent()}getSlot(e){return xr.absent()}getField(e){}getItem(e){return pr.absent()}deleted(e){return this}conditional(e,t){return e=pr.fromAny(e)}or(e){return this}and(e){return e=pr.fromAny(e)}bitwiseOr(e){if((e=pr.fromAny(e))instanceof zr)return new Zr(this,e);if(e instanceof gr){const t=this.bitwiseOr(e.value);if(t.isDefined())return new gr(e.key,t)}else if(e instanceof yr){const t=this.bitwiseOr(e.value);if(t.isDefined())return new yr(e.key,t)}return pr.absent()}bitwiseXor(e){if((e=pr.fromAny(e))instanceof zr)return new Qr(this,e);if(e instanceof gr){const t=this.bitwiseXor(e.value);if(t.isDefined())return new gr(e.key,t)}else if(e instanceof yr){const t=this.bitwiseXor(e.value);if(t.isDefined())return new yr(e.key,t)}return pr.absent()}bitwiseAnd(e){if((e=pr.fromAny(e))instanceof zr)return new $r(this,e);if(e instanceof gr){const t=this.bitwiseAnd(e.value);if(t.isDefined())return new gr(e.key,t)}else if(e instanceof yr){const t=this.bitwiseAnd(e.value);if(t.isDefined())return new yr(e.key,t)}return pr.absent()}lt(e){return(e=pr.fromAny(e))instanceof zr?new Jr(this,e):super.lt(e)}le(e){return(e=pr.fromAny(e))instanceof zr?new ei(this,e):super.le(e)}eq(e){return(e=pr.fromAny(e))instanceof zr?new ti(this,e):super.eq(e)}ne(e){return(e=pr.fromAny(e))instanceof zr?new ri(this,e):super.ne(e)}ge(e){return(e=pr.fromAny(e))instanceof zr?new ii(this,e):super.ge(e)}gt(e){return(e=pr.fromAny(e))instanceof zr?new ni(this,e):super.gt(e)}plus(e){if((e=pr.fromAny(e))instanceof zr)return new si(this,e);if(e instanceof gr){const t=this.plus(e.value);if(t.isDefined())return new gr(e.key,t)}else if(e instanceof yr){const t=this.plus(e.value);if(t.isDefined())return new yr(e.key,t)}return pr.absent()}minus(e){if((e=pr.fromAny(e))instanceof zr)return new oi(this,e);if(e instanceof gr){const t=this.minus(e.value);if(t.isDefined())return new gr(e.key,t)}else if(e instanceof yr){const t=this.minus(e.value);if(t.isDefined())return new yr(e.key,t)}return pr.absent()}times(e){if((e=pr.fromAny(e))instanceof zr)return new ai(this,e);if(e instanceof gr){const t=this.times(e.value);if(t.isDefined())return new gr(e.key,t)}else if(e instanceof yr){const t=this.times(e.value);if(t.isDefined())return new yr(e.key,t)}return pr.absent()}divide(e){if((e=pr.fromAny(e))instanceof zr)return new ui(this,e);if(e instanceof gr){const t=this.divide(e.value);if(t.isDefined())return new gr(e.key,t)}else if(e instanceof yr){const t=this.divide(e.value);if(t.isDefined())return new yr(e.key,t)}return pr.absent()}modulo(e){if((e=pr.fromAny(e))instanceof zr)return new hi(this,e);if(e instanceof gr){const t=this.modulo(e.value);if(t.isDefined())return new gr(e.key,t)}else if(e instanceof yr){const t=this.modulo(e.value);if(t.isDefined())return new yr(e.key,t)}return pr.absent()}not(){return xr.absent()}bitwiseNot(){return xr.absent()}negative(){return xr.absent()}positive(){return xr.absent()}inverse(){return xr.absent()}lambda(e){return new Di(this,e)}stringValue(e){return e}numberValue(e){return e}booleanValue(e){return e}isAliased(){return!1}isMutable(){return!1}alias(){}branch(){return this}clone(){return this}commit(){return this}interpolateTo(e){return super.interpolateTo(e)}keyEquals(e){return!1}static builder(){return new Sr}static empty(){return Cr.empty()}static extant(){return Fr.extant()}static absent(){return Nr.absent()}static fromAny(e){if(e instanceof xr)return e;if(void 0===e)return Nr.absent();if(null===e)return Fr.extant();if("boolean"==typeof e)return qr.from(e);if("number"==typeof e)return Mr.from(e);if("string"==typeof e)return Tr.from(e);if(e instanceof Uint8Array)return Dr.wrap(e);if(Array.isArray(e))return Cr.fromArray(e);if("object"==typeof e)return Cr.fromObject(e);throw new TypeError(""+e)}}class Cr extends xr{constructor(){super()}isDefinite(){return!this.isEmpty()}isArray(){return 0===this.fieldCount}isObject(){return 0===this.valueCount}get valueCount(){let e=0;return this.forEach((function(t){t instanceof xr&&(e+=1)}),this),e}isConstant(){return void 0===this.forEach((function(e){return!!e.isConstant()&&void 0}),this)}get tag(){const e=this.head();if(e instanceof gr)return e.key.value}get target(){let e,t,r=!1;return this.forEach((function(i){i instanceof gr?r=!0:void 0===e&&i instanceof xr?e=i:(void 0===t&&(t=Cr.create(),void 0!==e&&t.push(e)),t.push(i))}),this),void 0===e?xr.extant():void 0===t?e:r?t:this}flattened(){if(this.isEmpty())return xr.extant();{const e=this.iterator(),t=e.head();return e.step(),e.isEmpty()&&t instanceof xr?t:this.branch()}}unflattened(){return this}header(e){const t=this.head();return t instanceof gr&&t.key.value===e?t.value:xr.absent()}headers(e){const t=this.head();if(t instanceof gr&&t.key.value===e){const e=t.value;return e instanceof Cr?e:Cr.of(e)}}head(){return this.forEach((function(e){return e}),this)||pr.absent()}tail(){const e=Cr.create();return this.forEach((function(t,r){r>0&&e.push(t)}),this),e}body(){const e=this.tail();return e.isEmpty()?xr.absent():e.flattened()}has(e){return e=xr.fromAny(e),this.forEach((function(t){return!!(t instanceof mr&&t.key.equals(e))||void 0}),this)||!1}indexOf(e,t=0){e=pr.fromAny(e),t<0&&(t=Math.max(0,this.length+t));const r=this.forEach((function(r,i){return i>=t&&e.equals(r)?i:void 0}),this);return void 0!==r?r:-1}lastIndexOf(e,t){e=pr.fromAny(e);const r=this.length;for(void 0===t?t=r-1:t<0&&(t=r+t),t=Math.min(t,r-1);t>=0;){if(e.equals(this.getItem(t)))return t;t-=1}return-1}get(e){return e=xr.fromAny(e),this.forEach((function(t){return t instanceof mr&&t.key.equals(e)?t.value:void 0}),this)||xr.absent()}getAttr(e){return e=Tr.fromAny(e),this.forEach((function(t){return t instanceof gr&&t.key.equals(e)?t.value:void 0}),this)||xr.absent()}getSlot(e){return e=xr.fromAny(e),this.forEach((function(t){return t instanceof yr&&t.key.equals(e)?t.value:void 0}),this)||xr.absent()}getField(e){return e=xr.fromAny(e),this.forEach((function(t){return t instanceof mr&&t.key.equals(e)?t:void 0}),this)}set(e,t){e=xr.fromAny(e),t=xr.fromAny(t);const r=this.iterator();for(;!r.isEmpty();){const i=r.head();if(i instanceof mr&&i.key.equals(e))return i.isMutable()?i.setValue(t):r.set(i.updatedValue(t)),this;r.step()}return this.push(new yr(e,t)),this}setAttr(e,t){e=Tr.fromAny(e),t=xr.fromAny(t);const r=this.iterator();for(;!r.isEmpty();){const i=r.head();if(i instanceof mr&&i.key.equals(e))return i instanceof gr&&i.isMutable()?i.setValue(t):r.set(new gr(e,t)),this;r.step()}return this.push(new gr(e,t)),this}setSlot(e,t){e=xr.fromAny(e),t=xr.fromAny(t);const r=this.iterator();for(;!r.isEmpty();){const i=r.head();if(i instanceof mr&&i.key.equals(e))return i instanceof yr&&i.isMutable()?i.setValue(t):r.set(new yr(e,t)),this;r.step()}return this.push(new yr(e,t)),this}updated(e,t){e=xr.fromAny(e),t=xr.fromAny(t);const r=this.isMutable()?this:this.branch(),i=r.iterator();for(;!i.isEmpty();){const n=i.head();if(n.key.equals(e))return n instanceof mr&&n.isMutable()?n.setValue(t):i.set(new yr(e,t)),r;i.step()}return r.push(new yr(e,t)),r}updatedAttr(e,t){e=Tr.fromAny(e),t=xr.fromAny(t);const r=this.isMutable()?this:this.branch(),i=r.iterator();for(;!i.isEmpty();){const n=i.head();if(n.key.equals(e))return n instanceof gr&&n.isMutable()?n.setValue(t):i.set(new gr(e,t)),r;i.step()}return r.push(new gr(e,t)),r}updatedSlot(e,t){e=xr.fromAny(e),t=xr.fromAny(t);const r=this.isMutable()?this:this.branch(),i=r.iterator();for(;!i.isEmpty();){const n=i.head();if(n.key.equals(e))return n instanceof yr&&n.isMutable()?n.setValue(t):i.set(new yr(e,t)),r;i.step()}return r.push(new yr(e,t)),r}appended(...e){const t=this.isMutable()?this:this.branch();return t.push(...e),t}prepended(...e){const t=this.isMutable()?this:this.branch();return t.splice(0,0,...e),t}deleted(e){const t=this.isMutable()?this:this.branch();return t.delete(e),t}concat(...e){const t=this.isMutable()?this:this.branch();for(let r=0,i=e.length;r<i;r+=1)pr.fromAny(e[r]).forEach((function(e){t.push(e)}));return t}slice(e,t){return this.subRecord(e,t).branch()}attr(e,t){let r;return r=1===arguments.length?gr.of(e):gr.of(e,t),this.push(r),this}slot(e,t){let r;return r=1===arguments.length?yr.of(e):yr.of(e,t),this.push(r),this}item(e){return this.push(e),this}items(...e){return this.push(this,...e),this}evaluate(e){e=_r.fromAny(e);const t=Cr.create();e.pushScope(t);let r=!1;return this.forEach((function(i){const n=i.evaluate(e);n.isDefined()&&t.push(n),i!==n&&(r=!0)}),this),e.popScope(),r?t:this}substitute(e){e=_r.fromAny(e);const t=Cr.create();e.pushScope(t);let r=!1;return this.forEach((function(i){const n=i.substitute(e);n.isDefined()&&t.push(n),i!==n&&(r=!0)}),this),e.popScope(),r?t:this}stringValue(e){let t="";return void 0===this.forEach((function(e){if(e instanceof xr){const r=e.stringValue();if(void 0!==r)return void(t+=r)}return null}),this)?t:void 0}toAny(){return!this.isEmpty()&&this.isArray()?this.toArray():this.toObject()}toArray(){const e=new Array(this.length);return this.forEach((function(t,r){t instanceof xr?e[r]=t.toAny():t instanceof mr&&(e[r]={$key:t.key.toAny(),$value:t.value.toAny()})}),this),e}toObject(){const e={};return this.forEach((function(t,r){t instanceof gr?e["@"+t.key.value]=t.value.toAny():t instanceof yr?t.key instanceof Tr?e[t.key.value]=t.value.toAny():e["$"+r]={$key:t.key.toAny(),$value:t.value.toAny()}:t instanceof xr&&(e["$"+r]=t.toAny())}),this),e}isAliased(){return!1}isMutable(){return!0}alias(){}branch(){const e=Cr.create();return this.forEach((function(t){e.push(t)}),this),e}clone(){const e=Cr.create();return this.forEach((function(t){e.push(t.clone())}),this),e}commit(){return this}bind(){return this}subRecord(e,t){const r=this.length;void 0===e?e=0:e<0&&(e=r+e),e=Math.min(Math.max(0,e),r),void 0===t?t=r:t<0&&(t=r+t);const i=Cr.create();return this.forEach((function(r,n){return n<e?void 0:n<t?void i.push(r):null}),this),i}iterator(){return new Er(this)}interpolateTo(e){return e instanceof Cr?Or(this,e):super.interpolateTo(e)}get typeOrder(){return 3}compareTo(e){if(e instanceof Cr){const t=this.iterator(),r=e.iterator();let i=0;do{if(t.isEmpty()||r.isEmpty())break;i=t.head().compareTo(r.head()),t.step(),r.step()}while(0===i);return 0!==i?i:t.isEmpty()&&!r.isEmpty()?-1:!t.isEmpty()&&r.isEmpty()?1:0}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){if(this===e)return!0;if(e instanceof Cr){const r=this.iterator(),i=e.iterator();for(;!r.isEmpty()&&!i.isEmpty();){if(!r.head().equivalentTo(i.head(),t))return!1;r.step(),i.step()}return r.isEmpty()&&i.isEmpty()}return!1}equals(e){if(this===e)return!0;if(e instanceof Cr){const t=this.iterator(),r=e.iterator();for(;!t.isEmpty()&&!r.isEmpty();){if(!t.head().equals(r.head()))return!1;t.step(),r.step()}return t.isEmpty()&&r.isEmpty()}return!1}hashCode(){let e=m.hash(Cr);return this.forEach((function(t){e=o.mix(e,t.hashCode())}),this),e}debug(e){return e=e.write("Record").write(46),this.isEmpty()?e=e.write("empty").write(40).write(41):(e=e.write("of").write(40),this.forEach((function(t,r){0!==r&&(e=e.write(44).write(32)),e=e.display(t)}),this),e=e.write(41)),e}static empty(){return Ar.empty()}static create(e){return Ar.create(e)}static of(...e){return Ar.of(...e)}static fromAny(e){if(e instanceof Cr)return e;if(Array.isArray(e))return Cr.fromArray(e);if("object"==typeof e&&null!==e)return Cr.fromObject(e);throw new TypeError(""+e)}static fromArray(e){const t=e.length||0,r=Cr.create(t);for(let i=0;i<t;i+=1)r.push(pr.fromAny(e[i]));return r}static fromObject(e){const t=Cr.create();for(const r in e){const i=e[r];36===r.charCodeAt(0)?i&&"object"==typeof i&&Object.prototype.hasOwnProperty.call(i,"$key")?t.push(mr.of(i.$key,i.$value)):t.push(xr.fromAny(i)):t.push(mr.of(r,i))}return t}static expand(e){return e=Math.max(8,e)-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}}Cr.AliasedFlag=1,Cr.ImmutableFlag=2,Object.defineProperty(Cr.prototype,"fieldCount",{get(){let e=0;return this.forEach((function(t){t instanceof mr&&(e+=1)}),this),e},configurable:!0});class Sr{constructor(){this.record=null,this.value=null}push(...e){for(let t=0,r=e.length;t<r;t+=1){const r=e[t];if(r instanceof mr)return this.pushField(r);if(r instanceof xr)return this.pushValue(r);throw new TypeError(""+r)}}pushField(e){null===this.record&&(this.record=Cr.create(),null!==this.value&&(this.record.push(this.value),this.value=null)),this.record.push(e)}pushValue(e){null!==this.record?this.record.push(e):null===this.value?this.value=e:(this.record=Cr.create(),this.record.push(this.value),this.value=null,this.record.push(e))}bind(){return null!==this.record?this.record:null!==this.value?this.value:xr.absent()}}const Or=function(e){const t=function(e,r){const i=function(e){const t=i.interpolators,r=t.length,n=Cr.create(r);for(let i=0;i<r;i+=1)n.push(t[i](e));return n};Object.setPrototypeOf(i,t.prototype);const n=Math.min(e.length,r.length),s=new Array(n);for(let t=0;t<n;t+=1)s[t]=e.getItem(t).interpolateTo(r.getItem(t));return i.interpolators=s,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.interpolators,t=e.length,r=Cr.create(t);for(let i=0;i<t;i+=1)r.push(e[i][0]);return r},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.interpolators,t=e.length,r=Cr.create(t);for(let i=0;i<t;i+=1)r.push(e[i][1]);return r},configurable:!0}),t.prototype.equals=function(e){if(this===e)return!0;if(e instanceof t){const t=this.interpolators.length;if(t===e.interpolators.length){for(let r=0;r<t;r+=1)if(!this.interpolators[r].equals(e.interpolators[r]))return!1;return!0}}return!1},t}(D);class Er extends Z{constructor(e,t,r,i){super(),void 0===t&&(t=0),void 0===r&&(r=e.length),void 0===i&&(i=t),this.record=e,this.lower=t,this.upper=r,this.index=i,this.direction=0}isEmpty(){return this.index>=this.upper}head(){if(this.direction=0,this.index<this.upper)return this.record.getItem(this.index);throw new Error("empty")}step(){this.direction=0;const e=this.index;if(!(e<this.upper))throw new Error("empty");this.index=e+1}skip(e){this.index=Math.min(Math.max(this.lower,this.index+e,this.upper))}hasNext(){return this.index<this.upper}nextIndex(){return this.index-this.lower}next(){this.direction=1;const e=this.index;return e<this.upper?(this.index=e+1,{value:this.record.getItem(e),done:this.index===this.upper}):(this.index=this.upper,{done:!0})}hasPrevious(){return this.index>this.lower}previousIndex(){return this.index-this.lower-1}previous(){this.direction=-1;const e=this.index-1;return e>=this.lower?(this.index=e,{value:this.record.getItem(e),done:e===this.lower}):(this.index=0,{done:!0})}set(e){this.direction>0?this.record.setItem(this.index-1,e):this.record.setItem(this.index,e)}delete(){let e=this.index;this.direction>0&&(e-=1,this.index=e),this.record.splice(e,1),this.direction=0}}class Ar extends Cr{constructor(e,t,r,i,n){super(),this.array=e,this.table=t,Object.defineProperty(this,"length",{value:r,writable:!0,enumerable:!0,configurable:!0}),Object.defineProperty(this,"fieldCount",{value:i,writable:!0,enumerable:!0,configurable:!0}),this.flags=n}isEmpty(){return 0===this.length}get valueCount(){return this.length-this.fieldCount}isConstant(){const e=this.array;for(let t=0,r=this.length;t<r;t+=1)if(!e[t].isConstant())return!1;return!0}get tag(){if(this.fieldCount>0){const e=this.array[0];if(e instanceof gr)return e.key.value}}get target(){let e,t,r=!1;const i=this.array;for(let n=0,s=this.length;n<s;n+=1){const s=i[n];s instanceof gr?r=!0:void 0===e&&s instanceof xr?e=s:(void 0===t&&(t=Cr.create(),void 0!==e&&t.push(e)),t.push(s))}return void 0===e?xr.extant():void 0===t?e:r?t:this}head(){return this.length>0?this.array[0]:pr.absent()}tail(){const e=this.length;return e>0?new kr(this,1,e):Cr.empty()}body(){const e=this.length;if(e>2)return new kr(this,1,e).branch();if(2===e){const e=this.array[1];return e instanceof xr?e:Cr.of(e)}return xr.absent()}has(e){if(0!==this.fieldCount){e=xr.fromAny(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i.key.equals(e))return!0;n=(n+1)%r}while(n!==i)}return!1}indexOf(e,t=0){e=pr.fromAny(e);const r=this.array,i=this.length;for(t<0&&(t=Math.max(0,i+t));t<i;){if(e.equals(r[t]))return t;t+=1}return-1}lastIndexOf(e,t){e=pr.fromAny(e);const r=this.array,i=this.length;for(void 0===t?t=i-1:t<0&&(t=i+t),t=Math.min(t,i-1);t>=0;){if(e.equals(r[t]))return t;t-=1}return-1}get(e){if(this.fieldCount>0){e=xr.fromAny(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i.key.equals(e))return i.value;n=(n+1)%r}while(n!==i)}return xr.absent()}getAttr(e){if(this.fieldCount>0){e=Tr.fromAny(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i instanceof gr&&i.key.equals(e))return i.value;n=(n+1)%r}while(n!==i)}return xr.absent()}getSlot(e){if(this.fieldCount>0){e=xr.fromAny(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i instanceof yr&&i.key.equals(e))return i.value;n=(n+1)%r}while(n!==i)}return xr.absent()}getField(e){if(this.fieldCount>0){e=xr.fromAny(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i.key.equals(e))return i;n=(n+1)%r}while(n!==i)}}getItem(e){e instanceof Mr&&(e=e.value);const t=this.length;return e<0&&(e=t+e),e>=0&&e<t?this.array[e]:pr.absent()}set(e,t){if(0!=(this.flags&Cr.ImmutableFlag))throw new Error("immutable");return e=xr.fromAny(e),t=xr.fromAny(t),0!=(this.flags&Cr.AliasedFlag)?this.fieldCount>0?this.setAliased(e,t):this.pushAliased(new yr(e,t)):this.fieldCount>0?null!==this.table?this.setMutable(e,t):this.updateMutable(e,t):this.pushMutable(new yr(e,t)),this}setAliased(e,t){const r=this.length,i=this.array,n=new Array(Cr.expand(r+1));for(let s=0;s<r;s+=1){const o=i[s];if(o instanceof mr&&o.key.equals(e)){for(n[s]=o.updatedValue(t),s+=1;s<r;)n[s]=i[s],s+=1;return this.array=n,this.table=null,void(this.flags&=~Cr.AliasedFlag)}n[s]=o}n[r]=new yr(e,t),this.array=n,this.table=null,this.length=r+1,this.fieldCount+=1,this.flags&=~Cr.AliasedFlag}setMutable(e,t){const r=this.table,i=r.length,n=Math.abs(e.hashCode()%i);let s=n;do{const n=r[s];if(void 0===n)break;if(n.key.equals(e))return n.isMutable()?void n.setValue(t):void this.updateMutable(e,t);s=(s+1)%i}while(s!==n);const o=new yr(e,t);this.pushMutable(o),Ar.put(r,o)}updateMutable(e,t){const r=this.array;for(let i=0,n=this.length;i<n;i+=1){const n=r[i];if(n instanceof mr&&n.key.equals(e))return r[i]=n.updatedValue(t),void(this.table=null)}const i=new yr(e,t);this.pushMutable(i),Ar.put(this.table,i)}setAttr(e,t){if(0!=(this.flags&Cr.ImmutableFlag))throw new Error("immutable");return e=Tr.fromAny(e),t=xr.fromAny(t),0!=(this.flags&Cr.AliasedFlag)?this.fieldCount>0?this.setAttrAliased(e,t):this.pushAliased(new gr(e,t)):this.fieldCount>0?null!==this.table?this.setAttrMutable(e,t):this.updateAttrMutable(e,t):this.pushMutable(new gr(e,t)),this}setAttrAliased(e,t){const r=this.length,i=this.array,n=new Array(Cr.expand(r+1));for(let s=0;s<r;s+=1){const o=i[s];if(o instanceof mr&&o.key.equals(e)){for(n[s]=new gr(e,t),s+=1;s<r;)n[s]=i[s],s+=1;return this.array=n,this.table=null,void(this.flags&=~Cr.AliasedFlag)}n[s]=o}n[r]=new gr(e,t),this.array=n,this.table=null,this.length=r+1,this.fieldCount+=1,this.flags&=~Cr.AliasedFlag}setAttrMutable(e,t){const r=this.table,i=r.length,n=Math.abs(e.hashCode()%i);let s=n;do{const n=r[s];if(void 0===n)break;if(n.key.equals(e))return void(n instanceof gr&&n.isMutable()?n.setValue(t):this.updateAttrMutable(e,t));s=(s+1)%i}while(s!==n);const o=new gr(e,t);this.push(o),Ar.put(r,o)}updateAttrMutable(e,t){const r=this.array;for(let i=0,n=this.length;i<n;i+=1){const n=r[i];if(n instanceof mr&&n.key.equals(e))return r[i]=new gr(e,t),void(this.table=null)}const i=new gr(e,t);this.push(i),Ar.put(this.table,i)}setSlot(e,t){if(0!=(this.flags&Cr.ImmutableFlag))throw new Error("immutable");return e=xr.fromAny(e),t=xr.fromAny(t),0!=(this.flags&Cr.AliasedFlag)?this.fieldCount>0?this.setSlotAliased(e,t):this.pushAliased(new yr(e,t)):this.fieldCount>0?null!==this.table?this.setSlotMutable(e,t):this.updateSlotMutable(e,t):this.pushMutable(new yr(e,t)),this}setSlotAliased(e,t){const r=this.length,i=this.array,n=new Array(Cr.expand(r+1));for(let s=0;s<r;s+=1){const o=i[s];if(o instanceof mr&&o.key.equals(e)){for(n[s]=new yr(e,t),s+=1;s<r;)n[s]=i[s],s+=1;return this.array=n,this.table=null,void(this.flags&=~Cr.AliasedFlag)}n[s]=o}n[r]=new yr(e,t),this.array=n,this.table=null,this.length=r+1,this.fieldCount+=1,this.flags&=~Cr.AliasedFlag}setSlotMutable(e,t){const r=this.table,i=r.length,n=Math.abs(e.hashCode()%i);let s=n;do{const n=r[s];if(void 0===n)break;if(n.key.equals(e))return void(n instanceof yr&&n.isMutable()?n.setValue(t):this.updateSlotMutable(e,t));s=(s+1)%i}while(s!==n);const o=new yr(e,t);this.push(o),Ar.put(r,o)}updateSlotMutable(e,t){const r=this.array;for(let i=0,n=this.length;i<n;i+=1){const n=r[i];if(n instanceof mr&&n.key.equals(e))return r[i]=new yr(e,t),void(this.table=null)}const i=new yr(e,t);this.push(i),Ar.put(this.table,i)}setItem(e,t){if(0!=(this.flags&Cr.ImmutableFlag))throw new Error("immutable");t=pr.fromAny(t);const r=this.length;if(e<0&&(e=r+e),e<0||e>r)throw new RangeError(""+e);return 0!=(this.flags&Cr.AliasedFlag)?this.setItemAliased(e,t):this.setItemMutable(e,t),this}setItemAliased(e,t){const r=this.length,i=this.array,n=new Array(Cr.expand(r));for(let e=0;e<r;e+=1)n[e]=i[e];const s=i[e];n[e]=t,this.array=n,this.table=null,t instanceof mr?s instanceof mr||(this.fieldCount+=1):s instanceof mr&&(this.fieldCount-=1),this.flags&=~Cr.AliasedFlag}setItemMutable(e,t){const r=this.array,i=r[e];r[e]=t,t instanceof mr?(this.table=null,i instanceof mr||(this.fieldCount+=1)):i instanceof mr&&(this.table=null,this.fieldCount-=1)}updated(e,t){e=xr.fromAny(e),t=xr.fromAny(t);const r=0==(this.flags&Cr.ImmutableFlag)?this:this.branch();return 0!=(r.flags&Cr.AliasedFlag)?r.fieldCount>0?r.setAliased(e,t):r.pushAliased(new yr(e,t)):r.fieldCount>0?null!==r.table?r.setMutable(e,t):r.updateMutable(e,t):r.pushMutable(new yr(e,t)),r}updatedAttr(e,t){e=Tr.fromAny(e),t=xr.fromAny(t);const r=0==(this.flags&Cr.ImmutableFlag)?this:this.branch();return 0!=(r.flags&Cr.AliasedFlag)?r.fieldCount>0?r.setAttrAliased(e,t):r.pushAliased(new gr(e,t)):r.fieldCount>0?null!==r.table?r.setAttrMutable(e,t):r.updateAttrMutable(e,t):r.pushMutable(new gr(e,t)),r}updatedSlot(e,t){e=xr.fromAny(e),t=xr.fromAny(t);const r=0==(this.flags&Cr.ImmutableFlag)?this:this.branch();return 0!=(r.flags&Cr.AliasedFlag)?r.fieldCount>0?r.setSlotAliased(e,t):r.pushAliased(new yr(e,t)):r.fieldCount>0?null!==r.table?r.setSlotMutable(e,t):r.updateSlotMutable(e,t):r.pushMutable(new yr(e,t)),r}push(...e){if(0!=(this.flags&Cr.ImmutableFlag))throw new Error("immutable");return 0!=(this.flags&Cr.AliasedFlag)?this.pushAliased(...e):this.pushMutable(...e),this.length}pushAliased(...e){const t=e.length;let r=this.length,i=this.fieldCount;const n=this.array,s=new Array(Cr.expand(r+t));if(null!==n)for(let e=0;e<r;e+=1)s[e]=n[e];for(let n=0;n<t;n+=1){const t=pr.fromAny(e[n]);s[r]=t,r+=1,t instanceof mr&&(i+=1)}this.array=s,this.table=null,this.length=r,this.fieldCount=i,this.flags&=~Cr.AliasedFlag}pushMutable(...e){const t=e.length;let r=this.length,i=this.fieldCount;const n=this.array;let s;if(null===n||r+t>n.length){if(s=new Array(Cr.expand(r+t)),null!==n)for(let e=0;e<r;e+=1)s[e]=n[e]}else s=n;for(let n=0;n<t;n+=1){const t=pr.fromAny(e[n]);s[r]=t,r+=1,t instanceof mr&&(i+=1,this.table=null)}this.array=s,this.length=r,this.fieldCount=i}splice(e,t=0,...r){if(0!=(this.flags&Cr.ImmutableFlag))throw new Error("immutable");const i=this.length;return e<0&&(e=i+e),e=Math.min(Math.max(0,e),i),t=Math.min(Math.max(0,t),i-e),0!=(this.flags&Cr.AliasedFlag)?this.spliceAliased(e,t,...r):this.spliceMutable(e,t,...r)}spliceAliased(e,t,...r){const i=r.length;let n=this.length,s=this.fieldCount;const o=this.array,a=new Array(Cr.expand(n-t+i));for(let t=0;t<e;t+=1)a[t]=o[t];const u=[];for(let r=e;r<e+t;r+=1){const e=o[r];u.push(e),n-=1,e instanceof mr&&(s-=1)}for(let r=e;r<n;r+=1)a[r+i]=o[r+t];for(let t=0;t<i;t+=1){const i=pr.fromAny(r[t]);a[t+e]=i,n+=1,i instanceof mr&&(s+=1)}return this.array=a,this.table=null,this.length=n,this.fieldCount=s,this.flags&=~Cr.AliasedFlag,u}spliceMutable(e,t,...r){const i=r.length;let n=this.length,s=this.fieldCount;const o=this.array;let a;if(null===o||n-t+i>o.length){if(a=new Array(Cr.expand(n-t+i)),null!==o)for(let t=0;t<e;t+=1)a[t]=o[t]}else a=o;const u=[];for(let r=e;r<e+t;r+=1){const e=o[r];u.push(e),n-=1,e instanceof mr&&(s-=1)}if(i>t)for(let r=n-1;r>=e;r-=1)a[r+i]=o[r+t];else for(let r=e;r<n;r+=1)a[r+i]=o[r+t];for(let t=0;t<i;t+=1){const i=pr.fromAny(r[t]);a[t+e]=i,n+=1,i instanceof mr&&(s+=1)}return this.array=a,this.length=n,this.fieldCount=s,u}delete(e){if(0!=(this.flags&Cr.ImmutableFlag))throw new Error("immutable");return e=xr.fromAny(e),0!=(this.flags&Cr.AliasedFlag)?this.deleteAliased(e):this.deleteMutable(e)}deleteAliased(e){const t=this.length,r=this.array,i=new Array(Cr.expand(t));for(let n=0;n<t;n+=1){const s=r[n];if(s instanceof mr&&s.key.equals(e)){for(let e=n+1;e<t;e+=1,n+=1)i[n]=r[e];return this.array=i,this.table=null,this.length=t-1,this.fieldCount-=1,this.flags&=~Cr.AliasedFlag,s}i[n]=s}return pr.absent()}deleteMutable(e){const t=this.length,r=this.array;for(let i=0;i<t;i+=1){const n=r[i];if(n instanceof mr&&n.key.equals(e)){for(let e=i+1;e<t;e+=1,i+=1)r[i]=r[e];return r[t-1]=void 0,this.table=null,this.length=t-1,this.fieldCount-=1,n}}return pr.absent()}clear(){if(0!=(this.flags&Cr.ImmutableFlag))throw new Error("immutable");this.array=null,this.table=null,this.length=0,this.fieldCount=0,this.flags=0}isAliased(){return 0!=(this.flags&Cr.AliasedFlag)}isMutable(){return 0==(this.flags&Cr.ImmutableFlag)}alias(){this.flags|=Cr.AliasedFlag}branch(){if(0==(this.flags&(Cr.AliasedFlag|Cr.ImmutableFlag))){const e=this.array;for(let t=0,r=this.length;t<r;t+=1)e[t].alias()}return this.flags|=Cr.AliasedFlag,new Ar(this.array,this.table,this.length,this.fieldCount,Cr.AliasedFlag)}clone(){const e=this.length,t=this.array,r=new Array(e);for(let i=0;i<e;i+=1)r[i]=t[i].clone();return new Ar(r,null,e,this.fieldCount,0)}commit(){if(0==(this.flags&Cr.ImmutableFlag)){this.flags|=Cr.ImmutableFlag;const e=this.array;for(let t=0,r=this.length;t<r;t+=1)e[t].commit()}return this}hashTable(){const e=this.fieldCount;let t=this.table;if(0!==e&&null===t){t=new Array(Cr.expand(Math.max(e,10*e/7)));const r=this.array;for(let e=0,i=this.length;e<i;e+=1){const i=r[e];i instanceof mr&&Ar.put(t,i)}this.table=t}return t}static put(e,t){if(null!==e){const r=e.length,i=Math.abs(t.key.hashCode()%r);let n=i;do{const i=e[n];if(void 0===i)return void(e[n]=t);if(t.key.equals(i.key))return void(e[n]=t);n=(n+1)%r}while(n!==i);throw new Error}}evaluate(e){e=_r.fromAny(e);const t=this.array,r=this.length,i=Cr.create(r);e.pushScope(i);let n=!1;for(let s=0;s<r;s+=1){const r=t[s],o=r.evaluate(e);o.isDefined()&&i.push(o),r!==o&&(n=!0)}return e.popScope(),n?i:this}substitute(e){e=_r.fromAny(e);const t=this.array,r=this.length,i=Cr.create(r);e.pushScope(i);let n=!1;for(let s=0;s<r;s+=1){const r=t[s],o=r.substitute(e);o.isDefined()&&i.push(o),r!==o&&(n=!0)}return e.popScope(),n?i:this}subRecord(e,t){const r=this.length;if(void 0===e?e=0:e<0&&(e=r+e),void 0===t?t=r:t<0&&(t=r+t),e<0||t>r||e>t)throw new RangeError(e+", "+t);return new kr(this,e,t)}forEach(e,t){const r=this.array;for(let i=0,n=this.length;i<n;i+=1){const n=e.call(t,r[i],i);if(void 0!==n)return n}}static empty(){return new Ar(null,null,0,0,Cr.AliasedFlag|Cr.ImmutableFlag)}static create(e){return void 0===e?new Ar(null,null,0,0,Cr.AliasedFlag):new Ar(new Array(e),null,0,0,0)}static of(...e){const t=e.length;if(0===t)return new Ar(null,null,0,0,Cr.AliasedFlag);{const r=new Array(t);let i=0,n=0;for(let s=0;s<t;s+=1){const t=pr.fromAny(e[s]);r[s]=t,i+=1,t instanceof mr&&(n+=1)}return new Ar(r,null,i,n,0)}}}i([a],Ar,"empty",null);class kr extends Cr{constructor(e,t,r){super(),this.record=e,this.lower=t,this.upper=r}isEmpty(){return this.lower===this.upper}isArray(){const e=this.record.array;for(let t=this.lower,r=this.upper;t<r;t+=1)if(e[t]instanceof mr)return!1;return!0}isObject(){const e=this.record.array;for(let t=this.lower,r=this.upper;t<r;t+=1)if(e[t]instanceof xr)return!1;return!0}get length(){return this.upper-this.lower}get valueCount(){let e=0;const t=this.record.array;for(let r=this.lower,i=this.upper;r<i;r+=1)t[r]instanceof xr&&(e+=1);return e}isConstant(){const e=this.record.array;for(let t=this.lower,r=this.upper;t<r;t+=1)if(!e[t].isConstant())return!1;return!0}get tag(){if(this.length>0){const e=this.record.array[this.lower];if(e instanceof gr)return e.key.value}}get target(){let e,t,r=!1;const i=this.record.array;for(let n=this.lower,s=this.upper;n<s;n+=1){const s=i[n];s instanceof gr?r=!0:void 0===e&&s instanceof xr?e=s:(void 0===t&&(t=Cr.create(),void 0!==e&&t.push(e)),t.push(s))}return void 0===e?xr.extant():void 0===t?e:r?t:this}head(){return this.length>0?this.record.array[this.lower]:pr.absent()}tail(){return this.length>0?new kr(this.record,this.lower+1,this.upper):Cr.empty()}body(){const e=this.length;if(e>2)return new kr(this.record,this.lower+1,this.upper).branch();if(2===e){const e=this.record.array[this.lower+1];return e instanceof xr?e:Cr.of(e)}return xr.absent()}indexOf(e,t=0){e=pr.fromAny(e);const r=this.record.array,i=this.length;for(t<0&&(t=Math.max(0,i+t)),t=this.lower+t;t<this.upper;){if(e.equals(r[t]))return t-this.lower;t+=1}return-1}lastIndexOf(e,t){e=pr.fromAny(e);const r=this.record.array,i=this.length;for(void 0===t?t=i-1:t<0&&(t=i+t),t=this.lower+Math.min(t,i-1);t>=this.lower;){if(e.equals(r[t]))return t-this.lower;t-=1}return-1}getItem(e){e instanceof Mr&&(e=e.value);const t=this.length;return e<0&&(e=t+e),e>=0&&e<t?this.record.array[this.lower+e]:pr.absent()}setItem(e,t){if(0!=(this.record.flags&Cr.ImmutableFlag))throw new Error("immutable");t=pr.fromAny(t);const r=this.length;if(e<0&&(e=r+e),e<0||e>r)throw new RangeError(""+e);return 0!=(this.record.flags&Cr.AliasedFlag)?this.setItemAliased(e,t):this.setItemMutable(e,t),this}setItemAliased(e,t){const r=this.record,i=r.length,n=r.array,s=new Array(Cr.expand(i));for(let e=0;e<i;e+=1)s[e]=n[e];const o=null!==n?n[this.lower+e]:null;s[this.lower+e]=t,r.array=s,r.table=null,t instanceof mr?o instanceof mr||(r.fieldCount+=1):o instanceof mr&&(r.fieldCount-=1),r.flags&=~Cr.AliasedFlag}setItemMutable(e,t){const r=this.record,i=r.array,n=i[this.lower+e];i[this.lower+e]=t,t instanceof mr?(r.table=null,n instanceof mr||(r.fieldCount+=1)):n instanceof mr&&(r.table=null,r.fieldCount-=1)}push(...e){if(0!=(this.record.flags&Cr.ImmutableFlag))throw new Error("immutable");return 0!=(this.record.flags&Cr.AliasedFlag)?this.pushAliased(...e):this.pushMutable(...e),this.length}pushAliased(...e){const t=this.record,r=e.length;let i=t.length,n=t.fieldCount;const s=t.array,o=new Array(Cr.expand(i+r));if(null!==s){for(let e=0;e<this.upper;e+=1)o[e]=s[e];for(let e=this.upper;e<i;e+=1)o[e+r]=s[e]}for(let t=0;t<r;t+=1){const r=pr.fromAny(e[t]);o[t+this.upper]=r,i+=1,r instanceof mr&&(n+=1)}t.array=o,t.table=null,t.length=i,t.fieldCount=n,t.flags&=~Cr.AliasedFlag,this.upper+=r}pushMutable(...e){const t=this.record,r=e.length;let i=t.length,n=t.fieldCount;const s=t.array;let o;if(null===s||i+r>s.length){if(o=new Array(Cr.expand(i+r)),null!==s)for(let e=0;e<this.upper;e+=1)o[e]=s[e]}else o=s;for(let e=i-1;e>=this.upper;e-=1)o[e+r]=s[e];for(let s=0;s<r;s+=1){const r=pr.fromAny(e[s]);o[s+this.upper]=r,i+=1,r instanceof mr&&(n+=1,t.table=null)}t.array=o,t.length=i,t.fieldCount=n,this.upper+=r}splice(e,t=0,...r){if(0!=(this.record.flags&Cr.ImmutableFlag))throw new Error("immutable");const i=this.length;let n;return e<0&&(e=i+e),e=Math.min(Math.max(0,e),i),t=Math.min(Math.max(0,t),i-e),n=0!=(this.record.flags&Cr.AliasedFlag)?this.record.spliceAliased(this.lower+e,t,...r):this.record.spliceMutable(this.lower+e,t,...r),this.upper+=r.length-n.length,n}delete(e){if(0!=(this.record.flags&Cr.ImmutableFlag))throw new Error("immutable");return e=xr.fromAny(e),0!=(this.record.flags&Cr.AliasedFlag)?this.deleteAliased(e):this.deleteMutable(e)}deleteAliased(e){const t=this.record,r=t.length,i=t.array,n=new Array(Cr.expand(r));for(let s=this.lower;s<this.upper;s+=1){const o=i[s];if(o instanceof mr&&o.key.equals(e)){for(let e=s+1;e<r;e+=1,s+=1)n[s]=i[e];return t.array=n,t.table=null,t.length=r-1,t.fieldCount-=1,t.flags&=~Cr.AliasedFlag,this.upper-=1,o}n[s]=o}return pr.absent()}deleteMutable(e){const t=this.record,r=t.length,i=t.array;for(let n=this.lower;n<this.upper;n+=1){const s=i[n];if(s instanceof mr&&s.key.equals(e)){for(let e=n+1;e<r;e+=1,n+=1)i[n]=i[e];return i[r-1]=void 0,t.table=null,t.length=r-1,t.fieldCount-=1,this.upper-=1,s}}return pr.absent()}clear(){if(0!=(this.record.flags&Cr.ImmutableFlag))throw new Error("immutable");0!=(this.record.flags&Cr.AliasedFlag)?this.clearAliased():this.clearMutable()}clearAliased(){const e=this.record,t=e.length;let r=e.fieldCount;const i=t-this.length,n=e.array,s=new Array(Cr.expand(i));let o=0;for(;o<this.lower;)s[o]=n[o],o+=1;for(;o<this.upper;)n[o]instanceof mr&&(r-=1),o+=1;o=this.lower;let a=this.upper;for(;a<t;)s[o]=n[a],o+=1,a+=1;e.array=s,e.table=null,e.length=i,e.fieldCount=r,e.flags&=~Cr.AliasedFlag,this.upper=this.lower}clearMutable(){const e=this.record,t=e.length;let r=e.fieldCount;const i=e.array;let n=this.lower;for(;n<this.upper;)i[n]instanceof mr&&(r-=1),n+=1;n=this.lower;let s=this.upper;for(;s<t;){const t=i[s];t instanceof mr&&(e.table=null),i[n]=t,n+=1,s+=1}for(e.length=n,e.fieldCount=r;n<t;)i[n]=void 0,n+=1;this.upper=this.lower}isAliased(){return 0!=(this.record.flags&Cr.AliasedFlag)}isMutable(){return 0==(this.record.flags&Cr.ImmutableFlag)}alias(){this.record.flags|=Cr.AliasedFlag}branch(){const e=this.length;let t=0;const r=this.record.array,i=new Array(Cr.expand(e));let n=this.lower,s=0;for(;s<e;){const e=r[n];i[s]=e,e instanceof mr&&(t+=1),n+=1,s+=1}return new Ar(i,null,e,t,0)}clone(){const e=this.length;let t=0;const r=this.record.array,i=new Array(Cr.expand(e));let n=this.lower,s=0;for(;s<e;){const e=r[n];i[s]=e.clone(),e instanceof mr&&(t+=1),n+=1,s+=1}return new Ar(i,null,e,t,0)}commit(){return this.record.commit(),this}subRecord(e,t){const r=this.length;if(void 0===e?e=0:e<0&&(e=r+e),void 0===t?t=r:t<0&&(t=r+t),e<0||t>r||e>t)throw new RangeError(e+", "+t);return new kr(this.record,this.lower+e,this.upper+t)}forEach(e,t){const r=this.record.array;for(let i=this.lower,n=this.upper;i<n;i+=1){const n=e.call(t,r[i],i);if(void 0!==n)return n}}}Object.defineProperty(kr.prototype,"fieldCount",{get(){const e=this.record.array;let t=0;for(let r=this.lower,i=this.upper;r<i;r+=1)e[r]instanceof mr&&(t+=1);return t},configurable:!0});class Dr extends xr{constructor(e,t,r){super(),this.array=e,this.size=t,this.flags=r}isConstant(){return!0}getByte(e){if(e<0||e>=this.size)throw new RangeError(""+e);return this.array[e]}setByte(e,t){const r=this.flags;if(0!=(r&Dr.ImmutableFlag))throw new Error("immutable");if(e<0||e>=this.size)throw new RangeError(""+e);return 0!=(r&Dr.AliasedFlag)?this.setByteAliased(e,t):this.setByteMutable(e,t)}setByteAliased(e,t){const r=this.size,i=this.array,n=new Uint8Array(Dr.expand(r));return n.set(i,0),n[e]=t,this.array=n,this.flags&=~Dr.AliasedFlag,this}setByteMutable(e,t){return this.array[e]=t,this}addByte(e){const t=this.flags;if(0!=(t&Dr.ImmutableFlag))throw new Error("immutable");return 0!=(t&Dr.AliasedFlag)?this.addByteAliased(e):this.addByteMutable(e)}addByteAliased(e){const t=this.size,r=this.array,i=new Uint8Array(Dr.expand(t+1));return null!==r&&i.set(r,0),i[t]=e,this.array=i,this.size=t+1,this.flags&=~Dr.AliasedFlag,this}addByteMutable(e){const t=this.size,r=this.array;let i;return null===r||t+1>r.length?(i=new Uint8Array(Dr.expand(t+1)),null!==r&&i.set(r,0),this.array=i):i=r,i[t]=e,this.size=t+1,this}addData(e){let t=e.array;if(null!==t){const r=e.size;return t.length>r&&(t=t.slice(0,r)),this.addUint8Array(t)}return this}addUint8Array(e){const t=this.flags;if(0!=(t&Dr.ImmutableFlag))throw new Error("immutable");return 0!=(t&Dr.AliasedFlag)?this.addUint8ArrayAliased(e):this.addUint8ArrayMutable(e)}addUint8ArrayAliased(e){const t=e.length;if(0===t)return this;const r=this.size,i=this.array,n=new Uint8Array(Dr.expand(r+t));return null!==i&&n.set(i,0),n.set(e,r),this.array=n,this.size=r+t,this.flags&=~Dr.AliasedFlag,this}addUint8ArrayMutable(e){const t=e.length;if(0===t)return this;const r=this.size,i=this.array;let n;return null===i||r+t>i.length?(n=new Uint8Array(Dr.expand(r+t)),null!==i&&n.set(i,0),this.array=n):n=i,n.set(e,r),this.size=r+t,this}clear(){if(0!=(this.flags&Dr.ImmutableFlag))throw new Error("immutable");this.array=null,this.size=0,this.flags=Dr.AliasedFlag}toUint8Array(){const e=this.array,t=this.flags;if(0!=(t&Dr.ImmutableFlag))return null!==e?e.slice(0):new Uint8Array(0);if(0!=(t&Dr.AliasedFlag)||this.size!==e.length){const t=null!==e?e.slice(0):new Uint8Array(0);return this.array=t,this.flags&=~Dr.AliasedFlag,t}return e}asUint8Array(){let e;return null!==this.array&&this.size>0?(e=this.array,e.length!==this.size&&(e=new Uint8Array(e.buffer,e.byteOffset,this.size))):e=void 0,e}toAny(){return this.toUint8Array()}isAliased(){return 0!=(this.flags&Dr.AliasedFlag)}isMutable(){return 0==(this.flags&Dr.ImmutableFlag)}branch(){return this.flags|=Dr.AliasedFlag,new Dr(this.array,this.size,Dr.AliasedFlag)}clone(){return this.branch()}commit(){return this.flags|=Dr.ImmutableFlag,this}writeBase16(e,t=tt.uppercase){let r=this.array;const i=this.size;return null!==r&&0!==i?(r.length!==i&&(r=r.slice(0,i)),t.writeUint8Array(e,r)):xe.end()}toBase16(e=tt.uppercase){const t=Se.stringOutput();return this.writeBase16(t,e).bind(),t.bind()}writeBase64(e,t=ct.standard()){let r=this.array;const i=this.size;return null!==r&&0!==i?(r.length!==i&&(r=r.slice(0,i)),t.writeUint8Array(e,r)):xe.end()}toBase64(e=ct.standard()){const t=Se.stringOutput();return this.writeBase64(t,e),t.bind()}interpolateTo(e){return super.interpolateTo(e)}get typeOrder(){return 4}compareTo(e){if(e instanceof Dr){const t=this.array,r=e.array,i=this.size,n=e.size;let s=0,o=0;do{if(!(o<i&&o<n))break;s=t[o]-r[o],o+=1}while(0===s);return s>0?1:s<0?-1:i>n?1:i<n?-1:0}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this.equals(e)}equals(e){if(this===e)return!0;if(e instanceof Dr){const t=this.array,r=e.array,i=this.size;if(i!==e.size)return!1;for(let e=0;e<i;e+=1)if(t[e]!==r[e])return!1;return!0}return!1}hashCode(){return o.mash(o.mixUint8Array(m.hash(Dr),null!==this.array?this.array:new Uint8Array(0)))}debug(e){if(e=e.write("Data").write(46),0===this.size)e=e.write("empty").write(40).write(41);else{e=e.write("base16").write(40).write(34);const t=this.writeBase16(e);if(!t.isDone())return ge.error(t.trap());e=e.write(34).write(41)}return e}static empty(){return new Dr(null,0,Dr.AliasedFlag|Dr.ImmutableFlag)}static create(e){return void 0===e?new Dr(null,0,Dr.AliasedFlag):new Dr(new Uint8Array(e),0,0)}static wrap(e){return new Dr(e,e.length,Dr.AliasedFlag)}static fromBase16(e){return"string"==typeof e&&(e=Se.stringInput(e)),tt.parse(e,Dr.output()).bind()}static fromBase64(e,t=ct.standard()){return"string"==typeof e&&(e=Se.stringInput(e)),t.parse(e,Dr.output()).bind()}static fromAny(e){if(e instanceof Dr)return e;if(e instanceof Uint8Array)return Dr.wrap(e);throw new TypeError(""+e)}static random(e){const t=new Uint8Array(e);return n.fillBytes(t),Dr.wrap(t)}static output(e){return e instanceof Dr||(e=Dr.create(e)),new Pr(e,ce.standard())}static expand(e){return e=Math.max(32,e)-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}}Dr.AliasedFlag=1,Dr.ImmutableFlag=2,i([a],Dr,"empty",null);class Pr extends ge{constructor(e,t){super(),this.data=e,this.settings=t}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(e){return this}write(e){if("number"==typeof e)return this.data.addByte(e),this;throw new TypeError(""+e)}writeln(e){throw new TypeError(""+e)}withSettings(e){return e=ce.fromAny(e),this.settings=e,this}bind(){return this.data}clone(){return new Pr(this.data.branch(),this.settings)}}class Tr extends xr{constructor(e){super(),this.value=e,this.hashValue=void 0}isConstant(){return!0}get size(){return this.value.length}stringValue(e){return this.value}numberValue(e){try{return Mr.parse(this.value).numberValue()}catch(t){return e}}booleanValue(e){return"true"===this.value||"false"!==this.value&&e}toAny(){return this.value}valueOf(){return this.value}plus(e){return(e=pr.fromAny(e))instanceof Tr?Tr.from(this.value+e.value):super.plus(e)}branch(){return this}clone(){return this}commit(){return this}interpolateTo(e){return super.interpolateTo(e)}get typeOrder(){return 5}compareTo(e){return e instanceof Tr?this.value.localeCompare(e.value):e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this.equals(e)}equals(e){return this===e||e instanceof Tr&&this.value===e.value}hashCode(){let e=this.hashValue;return void 0===e&&(e=d.hash(this.value),this.hashValue=e),e}debug(e){return e=e.write("Text").write(46),e=0===this.value.length?e.write("empty").write(40).write(41):e.write("from").write(40).debug(this.value).write(41)}display(e){return Oe.debugAny(e,this.value)}toString(){return this.value}static empty(){return new Tr("")}static from(e){const t=e.length;if(0===t)return Tr.empty();{let r=new Tr(e);return t<=64&&(r=Tr.cache.put(r)),r}}static fromAny(e){if(e instanceof Tr)return e;if("string"==typeof e)return Tr.from(e);throw new TypeError(""+e)}static output(e){return void 0===e&&(e=ce.standard()),new Ir("",e)}static get cache(){return new re(128)}}i([a],Tr,"empty",null),i([a],Tr,"cache",null);class Ir extends ge{constructor(e,t){super(),this.string=e,this.settings=t}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(e){return this}write(e){if("number"==typeof e)if(e>=0&&e<=55295||e>=57344&&e<=65535)e=String.fromCharCode(e);else if(e>=65536&&e<=1114111){const t=e-65536;e=String.fromCharCode(55296|t>>>10,56320|1023&t)}else e="�";return this.string+=e,this}withSettings(e){return e=ce.fromAny(e),this.settings=e,this}bind(){return Tr.from(this.string)}clone(){return new Ir(this.string,this.settings)}toString(){return this.string}}class Mr extends xr{constructor(e,t){super(),this.value=e,this.flags=void 0!==t?t:0}isConstant(){return!0}isNaN(){return isNaN(this.value)}isInfinite(){return!isNaN(this.value)&&!isFinite(this.value)}isUint32(){return 0!=(this.flags&Mr.Uint32Flag)}isUint64(){return 0!=(this.flags&Mr.Uint64Flag)}stringValue(e){return""+this.value}numberValue(e){return this.value}booleanValue(e){return!!this.value}toAny(){return this.value}valueOf(){return this.value}bitwiseOr(e){return(e=pr.fromAny(e))instanceof Mr?Mr.from((this.value|e.value)>>>0):super.bitwiseOr(e)}bitwiseXor(e){return(e=pr.fromAny(e))instanceof Mr?Mr.from((this.value^e.value)>>>0):super.bitwiseXor(e)}bitwiseAnd(e){return(e=pr.fromAny(e))instanceof Mr?Mr.from((this.value&e.value)>>>0):super.bitwiseAnd(e)}plus(e){return(e=pr.fromAny(e))instanceof Mr?Mr.from(this.value+e.value):super.plus(e)}minus(e){return(e=pr.fromAny(e))instanceof Mr?Mr.from(this.value-e.value):super.minus(e)}times(e){return(e=pr.fromAny(e))instanceof Mr?Mr.from(this.value*e.value):super.times(e)}divide(e){return(e=pr.fromAny(e))instanceof Mr?Mr.from(this.value/e.value):super.divide(e)}modulo(e){return(e=pr.fromAny(e))instanceof Mr?Mr.from(this.value%e.value):super.modulo(e)}bitwiseNot(){return Mr.from(~this.value>>>0)}negative(){return Mr.from(-this.value)}positive(){return this}inverse(){return Mr.from(1/this.value)}abs(){return Mr.from(Math.abs(this.value))}ceil(){return Mr.from(Math.ceil(this.value))}floor(){return Mr.from(Math.floor(this.value))}round(){return Mr.from(Math.round(this.value))}sqrt(){return Mr.from(Math.sqrt(this.value))}pow(e){return e=Mr.fromAny(e),Mr.from(Math.pow(this.value,e.value))}max(e){return this.compareTo(e)>=0?this:e}min(e){return this.compareTo(e)<=0?this:e}interpolateTo(e){return e instanceof Mr?Vr(this,e):super.interpolateTo(e)}get typeOrder(){return 6}compareTo(e){if(e instanceof Mr){const t=this.value,r=e.value;return t<r?-1:t>r?1:isNaN(r)?isNaN(t)?0:-1:isNaN(t)?1:0}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){if(this===e)return!0;if(e instanceof Mr){const r=this.value,i=e.value;return r===i||isNaN(r)&&isNaN(i)||Math.abs(i-r)<(void 0!==t?t:l.Epsilon)}return!1}equals(e){if(this===e)return!0;if(e instanceof Mr){const t=this.value,r=e.value;return t===r||isNaN(t)&&isNaN(r)}return!1}hashCode(){return c.hash(this.value)}debug(e){return e=e.write("Num").write(46).write("from").write(40).display(this).write(41)}display(e){return Oe.displayNumber(e,this.value)}static get zero(){return new Mr(0)}static get negativeZero(){return new Mr(-0)}static get one(){return new Mr(1)}static get negativeOne(){return new Mr(-1)}static get nan(){return new Mr(NaN)}static uint32(e){return new Mr(e,Mr.Uint32Flag)}static uint64(e){return new Mr(e,Mr.Uint64Flag)}static from(e){return 0===e?1/e==-1/0?Mr.negativeZero:Mr.zero:1===e?Mr.one:-1===e?Mr.negativeOne:isNaN(e)?Mr.nan:Mr.cache.put(new Mr(e))}static fromAny(e){if(e instanceof Mr)return e;if("number"==typeof e)return Mr.from(e);throw new TypeError(""+e)}static parse(e){if("NaN"===e)return Mr.nan;{const t=+e;if(isFinite(t))return Mr.from(t)}throw new Error(e)}static get cache(){return new re(128)}}Mr.Uint32Flag=1,Mr.Uint64Flag=2,Mr.TypeMask=3,i([a],Mr,"zero",null),i([a],Mr,"negativeZero",null),i([a],Mr,"one",null),i([a],Mr,"negativeOne",null),i([a],Mr,"nan",null),i([a],Mr,"cache",null);const Vr=function(e){const t=function(e,r){const i=function(e){const t=i[0].value,r=i[1].value;return Mr.from(t+e*(r-t))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class qr extends xr{constructor(e){super(),Object.defineProperty(this,"value",{value:e,enumerable:!0}),Object.defineProperty(this,"hashValue",{value:d.hash(e?"true":"false")})}isDefinite(){return this.value}isConstant(){return!0}stringValue(e){return this.value?"true":"false"}booleanValue(e){return this.value}toAny(){return this.value}valueOf(){return this.value}conditional(e,t){return this.value?pr.fromAny(e):pr.fromAny(t)}or(e){return this.value?this:pr.fromAny(e)}and(e){return this.value?pr.fromAny(e):this}not(){return qr.from(!this.value)}get typeOrder(){return 7}compareTo(e){return e instanceof qr?this.value&&!e.value?-1:!this.value&&e.value?1:0:e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this.equals(e)}equals(e){return this===e||e instanceof qr&&this.value===e.value}hashCode(){return this.hashValue}debug(e){return e=e.write("Bool").write(46).write("from").write(40).write(this.value?"true":"false").write(41)}display(e){return e=e.write(this.value?"true":"false")}static get true(){return new qr(!0)}static get false(){return new qr(!1)}static from(e){return e?qr.true:qr.false}static fromAny(e){if(e instanceof qr)return e;if("boolean"==typeof e)return qr.from(e);throw new TypeError(""+e)}}i([a],qr,"true",null),i([a],qr,"false",null);class Fr extends xr{constructor(){super()}isDefined(){return!0}isDistinct(){return!1}isDefinite(){return!1}isConstant(){return!0}unflattened(){return Cr.empty()}not(){return xr.absent()}stringValue(e){return""}booleanValue(e){return!0}toAny(){return null}interpolateTo(e){return super.interpolateTo(e)}get typeOrder(){return 98}compareTo(e){return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this===e}equals(e){return this===e}hashCode(){return m.hash(Fr)}debug(e){return e=e.write("Value").write(46).write("extant").write(40).write(41)}display(e){return e=e.write("null")}static extant(){return new Fr}static fromAny(e){if(e instanceof Fr)return e;if(null===e)return Fr.extant();throw new TypeError(""+e)}}i([a],Fr,"extant",null);class Nr extends xr{constructor(){super()}isDefined(){return!1}isDistinct(){return!1}isDefinite(){return!1}isConstant(){return!0}unflattened(){return Cr.empty()}updated(e,t){return Cr.of(yr.of(e,t))}updatedAttr(e,t){return Cr.of(gr.of(e,t))}updatedSlot(e,t){return Cr.of(yr.of(e,t))}appended(...e){return Cr.of(e)}prepended(...e){return Cr.of(e)}concat(...e){const t=Cr.create();for(let r=0,i=e.length;r<i;r+=1)pr.fromAny(e[r]).forEach((function(e){t.push(e)}));return t}conditional(e,t){return pr.fromAny(t)}or(e){return pr.fromAny(e)}and(e){return this}not(){return xr.extant()}booleanValue(e){return!1}toAny(){}forEach(e,t){}iterator(){return Z.empty()}interpolateTo(e){return super.interpolateTo(e)}get typeOrder(){return 99}compareTo(e){return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this===e}equals(e){return this===e}hashCode(){return m.hash(Nr)}debug(e){return e=e.write("Value").write(46).write("absent").write(40).write(41)}display(e){return e=e.write("undefined")}static absent(){return new Nr}static fromAny(e){if(e instanceof Nr)return e;if(void 0===e)return Nr.absent();throw new TypeError(""+e)}}i([a],Nr,"absent",null);class zr extends xr{constructor(){super()}conditional(e,t){return e=pr.fromAny(e),t=pr.fromAny(t),new Kr(this,e,t)}or(e){return e=pr.fromAny(e),new Gr(this,e)}and(e){return e=pr.fromAny(e),new Yr(this,e)}bitwiseOr(e){return e=pr.fromAny(e),new Zr(this,e)}bitwiseXor(e){return e=pr.fromAny(e),new Qr(this,e)}bitwiseAnd(e){return e=pr.fromAny(e),new $r(this,e)}lt(e){return e=pr.fromAny(e),new Jr(this,e)}le(e){return e=pr.fromAny(e),new ei(this,e)}eq(e){return e=pr.fromAny(e),new ti(this,e)}ne(e){return e=pr.fromAny(e),new ri(this,e)}ge(e){return e=pr.fromAny(e),new ii(this,e)}gt(e){return e=pr.fromAny(e),new ni(this,e)}plus(e){return e=pr.fromAny(e),new si(this,e)}minus(e){return e=pr.fromAny(e),new oi(this,e)}times(e){return e=pr.fromAny(e),new ai(this,e)}divide(e){return e=pr.fromAny(e),new ui(this,e)}modulo(e){return e=pr.fromAny(e),new hi(this,e)}not(){return new li(this)}bitwiseNot(){return new ci(this)}negative(){return new di(this)}positive(){return new pi(this)}inverse(){return new ui(Mr.one,this)}toAny(){return this}}class Ur extends zr{constructor(){super()}static binary(e,t,r){switch(t){case"||":return new Gr(e,r);case"&&":return new Yr(e,r);case"|":return new Zr(e,r);case"^":return new Qr(e,r);case"&":return new $r(e,r);case"<":return new Jr(e,r);case"<=":return new ei(e,r);case"==":return new ti(e,r);case"!=":return new ri(e,r);case">=":return new ii(e,r);case">":return new ni(e,r);case"+":return new si(e,r);case"-":return new oi(e,r);case"*":return new ai(e,r);case"/":return new ui(e,r);case"%":return new hi(e,r);default:throw new Error(t)}}static unary(e,t){switch(e){case"!":return new li(t);case"~":return new ci(t);case"-":return new di(t);case"+":return new pi(t);default:throw new Error(e)}}}class Rr extends Ur{constructor(e,t){super(),this.operand1=e,this.operand2=t}isConstant(){return this.operand1.isConstant()&&this.operand2.isConstant()}interpolateTo(e){return e instanceof Rr&&this.operator===e.operator?jr(this,e):super.interpolateTo(e)}}const jr=function(e){const t=function(e,r){const i=e.operator;if(i!==r.operator)throw new Error;const n=function(e){const t=n.operand1Interpolator(e),r=n.operand2Interpolator(e);return Ur.binary(t,n.operator,r)};return Object.setPrototypeOf(n,t.prototype),n.operand1Interpolator=e.operand1.interpolateTo(r.operand1),n.operator=i,n.operand2Interpolator=e.operand2.interpolateTo(r.operand2),n};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.operand1Interpolator[0],t=this.operand2Interpolator[0];return Ur.binary(e,this.operator,t)},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.operand1Interpolator[1],t=this.operand2Interpolator[1];return Ur.binary(e,this.operator,t)},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.operator===e.operator&&this.operand1Interpolator.equals(e.operand1Interpolator)&&this.operand2Interpolator.equals(e.operand2Interpolator))},t}(D);class Lr extends Ur{constructor(e){super(),this.operand=e}isConstant(){return this.operand.isConstant()}interpolateTo(e){return e instanceof Lr&&this.operator===e.operator?Br(this,e):super.interpolateTo(e)}}const Br=function(e){const t=function(e,r){const i=e.operator;if(i!==r.operator)throw new Error;const n=function(e){const t=n.operandInterpolator(e);return Ur.unary(n.operator,t)};return Object.setPrototypeOf(n,t.prototype),n.operator=i,n.operandInterpolator=e.operand.interpolateTo(r.operand),n};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.operandInterpolator[0];return Ur.unary(this.operator,e)},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.operandInterpolator[1];return Ur.unary(this.operator,e)},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.operator===e.operator&&this.operandInterpolator.equals(e.operandInterpolator))},t}(D);class Kr extends Ur{constructor(e,t,r){super(),this.ifTerm=e.commit(),this.thenTerm=t.commit(),this.elseTerm=r.commit()}isConstant(){return this.ifTerm.isConstant()&&this.thenTerm.isConstant()&&this.elseTerm.isConstant()}get precedence(){return 2}evaluate(e){let t;(e=_r.fromAny(e)).willOperate(this);if(this.ifTerm.evaluate(e).isDefinite()){t=this.thenTerm.evaluate(e)}else{t=this.elseTerm.evaluate(e)}return e.didOperate(this,t),t}substitute(e){e=_r.fromAny(e);const t=this.ifTerm.substitute(e),r=this.thenTerm.substitute(e),i=this.elseTerm.substitute(e);return new Kr(t,r,i)}interpolateTo(e){return e instanceof Kr?Wr(this,e):super.interpolateTo(e)}get typeOrder(){return 20}compareTo(e){if(e instanceof Kr){let t=this.ifTerm.compareTo(e.ifTerm);return 0===t&&(t=this.thenTerm.compareTo(e.thenTerm),0===t&&(t=this.elseTerm.compareTo(e.elseTerm))),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Kr&&(this.ifTerm.equivalentTo(e.ifTerm,t)&&this.thenTerm.equivalentTo(e.thenTerm,t)&&this.elseTerm.equivalentTo(e.elseTerm,t))}equals(e){return this===e||e instanceof Kr&&(this.ifTerm.equals(e.ifTerm)&&this.thenTerm.equals(e.thenTerm)&&this.elseTerm.equals(e.elseTerm))}hashCode(){return o.mash(o.mix(o.mix(o.mix(m.hash(Kr),this.ifTerm.hashCode()),this.thenTerm.hashCode()),this.elseTerm.hashCode()))}debug(e){return e=e.debug(this.ifTerm).write(46).write("conditional").write(40).debug(this.thenTerm).write(44).write(32).debug(this.elseTerm).write(41)}clone(){return new Kr(this.ifTerm.clone(),this.thenTerm.clone(),this.elseTerm.clone())}}const Wr=function(e){const t=function(e,r){const i=function(e){const t=i.ifTermInterpolator(e),r=i.thenTermInterpolator(e),n=i.elseTermInterpolator(e);return new Kr(t,r,n)};return Object.setPrototypeOf(i,t.prototype),i.ifTermInterpolator=e.ifTerm.interpolateTo(r.ifTerm),i.thenTermInterpolator=e.thenTerm.interpolateTo(r.thenTerm),i.elseTermInterpolator=e.elseTerm.interpolateTo(r.elseTerm),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.ifTermInterpolator[0],t=this.thenTermInterpolator[0],r=this.elseTermInterpolator[0];return new Kr(e,t,r)},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.ifTermInterpolator[1],t=this.thenTermInterpolator[1],r=this.elseTermInterpolator[1];return new Kr(e,t,r)},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.ifTermInterpolator.equals(e.ifTermInterpolator)&&this.thenTermInterpolator.equals(e.thenTermInterpolator)&&this.elseTermInterpolator.equals(e.elseTermInterpolator))},t}(D);class Hr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Hr.prototype)}}class Xr{constructor(e){Object.defineProperty(this,"maxScopeDepth",{value:e,enumerable:!0})}withMaxScopeDepth(e){return this.copy(e)}copy(e){return new Xr(e)}canEqual(e){return e instanceof Xr}equals(e){return this===e||e instanceof Xr&&(e.canEqual(this)&&this.maxScopeDepth===e.maxScopeDepth)}hashCode(){return o.mash(o.mix(m.hash(Xr),c.hash(this.maxScopeDepth)))}debug(e){return e=e.write("new").write(32).write("InterpreterSettings").write(40).debug(this.maxScopeDepth).write(41)}toString(){return Oe.debug(this)}static standard(){return new Xr(1024)}}i([a],Xr,"standard",null);class _r{constructor(e,t,r){this.settings=void 0!==e?e:Xr.standard(),this.scopeStack=void 0!==t?t:null,this.scopeDepth=void 0!==r?r:0}withSettings(e){return this.settings=e,this}peekScope(){const e=this.scopeDepth;if(e<=0)throw new Hr("scope stack empty");return this.scopeStack[e-1]}getScope(e){if(e<0||e>=this.scopeDepth)throw new RangeError(""+e);return this.scopeStack[e]}pushScope(e){const t=this.scopeDepth;if(t>=this.settings.maxScopeDepth)throw new Hr("scope stack overflow");const r=this.scopeStack;let i;if(null===r||t+1>r.length){if(i=new Array(_r.expand(t+1)),null!==r)for(let e=0;e<t;e+=1)i[e]=r[e];this.scopeStack=i}else i=r;i[t]=e,this.scopeDepth+=1}popScope(){const e=this.scopeDepth;if(e<=0)throw new Hr("scope stack empty");const t=this.scopeStack,r=t[e-1];return t[e-1]=void 0,this.scopeDepth-=1,r}swapScope(e){const t=this.scopeDepth;if(t<=0)throw new Hr("scope stack empty");const r=this.scopeStack,i=r[t-1];return r[t-1]=e,i}willOperate(e){}didOperate(e,t){}willSelect(e){}didSelect(e,t){}willTransform(e){}didTransform(e,t){}static of(...e){const t=e.length,r=new Array(_r.expand(t));for(let i=0;i<t;i+=1){const t=pr.fromAny(e[i]);r[i]=t}return new _r(Xr.standard(),r,t)}static fromAny(e,t=pr.globalScope()){if(!(e instanceof _r)){const r=e;e=new _r,void 0!==t&&e.pushScope(t),void 0!==r&&e.pushScope(pr.fromAny(r))}return e}static expand(e){return e=Math.max(32,e)-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}}class Gr extends Rr{constructor(e,t){super(e,t)}get operator(){return"||"}get precedence(){return 3}evaluate(e){let t;(e=_r.fromAny(e)).willOperate(this);const r=this.operand1.evaluate(e);if(r.isDefinite())t=r;else{t=this.operand2.evaluate(e)}return e.didOperate(this,t),t}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.or(r)}get typeOrder(){return 21}compareTo(e){if(e instanceof Gr){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Gr&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Gr&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(Gr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("or").write(40).debug(this.operand2).write(41)}clone(){return new Gr(this.operand1.clone(),this.operand2.clone())}}class Yr extends Rr{constructor(e,t){super(e,t)}get operator(){return"&&"}get precedence(){return 4}evaluate(e){let t;(e=_r.fromAny(e)).willOperate(this);const r=this.operand1.evaluate(e);if(r.isDefinite()){t=this.operand2.evaluate(e)}else t=r;return e.didOperate(this,t),t}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.and(r)}get typeOrder(){return 22}compareTo(e){if(e instanceof Yr){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Yr&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Yr&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(Yr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("and").write(40).debug(this.operand2).write(41)}clone(){return new Yr(this.operand1.clone(),this.operand2.clone())}}class Zr extends Rr{constructor(e,t){super(e,t)}get operator(){return"|"}get precedence(){return 5}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.bitwiseOr(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.bitwiseOr(r)}get typeOrder(){return 23}compareTo(e){if(e instanceof Zr){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Zr&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Zr&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(Zr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("bitwiseOr").write(40).debug(this.operand2).write(41)}clone(){return new Zr(this.operand1.clone(),this.operand2.clone())}}class Qr extends Rr{constructor(e,t){super(e,t)}get operator(){return"^"}get precedence(){return 6}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.bitwiseXor(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.bitwiseXor(r)}get typeOrder(){return 24}compareTo(e){if(e instanceof Qr){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Qr&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Qr&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(Qr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("bitwiseXor").write(40).debug(this.operand2).write(41)}clone(){return new Qr(this.operand1.clone(),this.operand2.clone())}}class $r extends Rr{constructor(e,t){super(e,t)}get operator(){return"&"}get precedence(){return 7}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.bitwiseAnd(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.bitwiseAnd(r)}get typeOrder(){return 25}compareTo(e){if(e instanceof $r){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof $r&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof $r&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash($r),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("bitwiseAnd").write(40).debug(this.operand2).write(41)}clone(){return new $r(this.operand1.clone(),this.operand2.clone())}}class Jr extends Rr{constructor(e,t){super(e,t)}get operator(){return"<"}get precedence(){return 0}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.lt(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.lt(r)}get typeOrder(){return 26}compareTo(e){if(e instanceof Jr){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Jr&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Jr&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(Jr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e.debug(this.operand1).write(46).write("lt").write(40).debug(this.operand2).write(41)}clone(){return new Jr(this.operand1.clone(),this.operand2.clone())}}class ei extends Rr{constructor(e,t){super(e,t)}get operator(){return"<="}get precedence(){return 0}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.le(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.le(r)}get typeOrder(){return 27}compareTo(e){if(e instanceof ei){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ei&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof ei&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(ei),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e.debug(this.operand1).write(46).write("le").write(40).debug(this.operand2).write(41)}clone(){return new ei(this.operand1.clone(),this.operand2.clone())}}class ti extends Rr{constructor(e,t){super(e,t)}get operator(){return"=="}get precedence(){return 0}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.eq(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.eq(r)}get typeOrder(){return 28}compareTo(e){if(e instanceof ti){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ti&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof ti&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(ti),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("eq").write(40).debug(this.operand2).write(41)}clone(){return new ti(this.operand1.clone(),this.operand2.clone())}}class ri extends Rr{constructor(e,t){super(e,t)}get operator(){return"!="}get precedence(){return 0}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.ne(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.ne(r)}get typeOrder(){return 29}compareTo(e){if(e instanceof ri){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ri&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof ri&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(ri),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("ne").write(40).debug(this.operand2).write(41)}clone(){return new ri(this.operand1.clone(),this.operand2.clone())}}class ii extends Rr{constructor(e,t){super(e,t)}get operator(){return">="}get precedence(){return 0}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.ge(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.ge(r)}get typeOrder(){return 30}compareTo(e){if(e instanceof ii){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ii&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof ii&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(ii),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("ge").write(40).debug(this.operand2).write(41)}clone(){return new ii(this.operand1.clone(),this.operand2.clone())}}class ni extends Rr{constructor(e,t){super(e,t)}get operator(){return">"}get precedence(){return 0}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.gt(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.gt(r)}get typeOrder(){return 31}compareTo(e){if(e instanceof ni){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ni&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof ni&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(ni),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("gt").write(40).debug(this.operand2).write(41)}clone(){return new ni(this.operand1.clone(),this.operand2.clone())}}class si extends Rr{constructor(e,t){super(e,t)}get operator(){return"+"}get precedence(){return 8}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.plus(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.plus(r)}get typeOrder(){return 32}compareTo(e){if(e instanceof si){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof si&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof si&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(si),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("plus").write(40).debug(this.operand2).write(41)}clone(){return new si(this.operand1.clone(),this.operand2.clone())}}class oi extends Rr{constructor(e,t){super(e,t)}get operator(){return"-"}get precedence(){return 8}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.minus(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.minus(r)}get typeOrder(){return 33}compareTo(e){if(e instanceof oi){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof oi&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof oi&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(oi),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("minus").write(40).debug(this.operand2).write(41)}clone(){return new oi(this.operand1.clone(),this.operand2.clone())}}class ai extends Rr{constructor(e,t){super(e,t)}get operator(){return"*"}get precedence(){return 9}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.times(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.times(r)}get typeOrder(){return 34}compareTo(e){if(e instanceof ai){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ai&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof ai&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(ai),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("times").write(40).debug(this.operand2).write(41)}clone(){return new ai(this.operand1.clone(),this.operand2.clone())}}class ui extends Rr{constructor(e,t){super(e,t)}get operator(){return"/"}get precedence(){return 9}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.divide(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.divide(r)}get typeOrder(){return 35}compareTo(e){if(e instanceof ui){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ui&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof ui&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(ui),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("divide").write(40).debug(this.operand2).write(41)}clone(){return new ui(this.operand1.clone(),this.operand2.clone())}}class hi extends Rr{constructor(e,t){super(e,t)}get operator(){return"%"}get precedence(){return 9}evaluate(e){(e=_r.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.modulo(r);return e.didOperate(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.modulo(r)}get typeOrder(){return 36}compareTo(e){if(e instanceof hi){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof hi&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof hi&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return o.mash(o.mix(o.mix(m.hash(hi),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("modulo").write(40).debug(this.operand2).write(41)}clone(){return new hi(this.operand1.clone(),this.operand2.clone())}}class li extends Lr{constructor(e){super(e)}get operator(){return"!"}get precedence(){return 10}evaluate(e){e=_r.fromAny(e);return this.operand.evaluate(e).not()}substitute(e){e=_r.fromAny(e);return this.operand.substitute(e).not()}get typeOrder(){return 37}compareTo(e){return c.compare(this.typeOrder,e.typeOrder)}equivalentTo(e,t){return this===e||e instanceof li&&this.operand.equivalentTo(e.operand,t)}equals(e){return this===e||e instanceof li&&this.operand.equals(e.operand)}hashCode(){return o.mash(o.mix(m.hash(li),this.operand.hashCode()))}debug(e){return e=e.debug(this.operand).write(46).write("not").write(40).write(41)}clone(){return new li(this.operand.clone())}}class ci extends Lr{constructor(e){super(e)}get operator(){return"~"}get precedence(){return 10}evaluate(e){e=_r.fromAny(e);return this.operand.evaluate(e).bitwiseNot()}substitute(e){e=_r.fromAny(e);return this.operand.substitute(e).bitwiseNot()}get typeOrder(){return 38}compareTo(e){return e instanceof ci?this.operand.compareTo(e.operand):e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ci&&this.operand.equivalentTo(e.operand,t)}equals(e){return this===e||e instanceof ci&&this.operand.equals(e.operand)}hashCode(){return o.mash(o.mix(m.hash(ci),this.operand.hashCode()))}debug(e){return e=e.debug(this.operand).write(46).write("bitwiseNot").write(40).write(41)}clone(){return new ci(this.operand.clone())}}class di extends Lr{constructor(e){super(e)}get operator(){return"-"}get precedence(){return 10}evaluate(e){e=_r.fromAny(e);return this.operand.evaluate(e).negative()}substitute(e){e=_r.fromAny(e);return this.operand.substitute(e).negative()}get typeOrder(){return 39}compareTo(e){return e instanceof di?this.operand.compareTo(e.operand):e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof di&&this.operand.equivalentTo(e.operand,t)}equals(e){return this===e||e instanceof di&&this.operand.equals(e.operand)}hashCode(){return o.mash(o.mix(m.hash(di),this.operand.hashCode()))}debug(e){return e=e.debug(this.operand).write(46).write("negative").write(40).write(41)}clone(){return new di(this.operand.clone())}}class pi extends Lr{constructor(e){super(e)}get operator(){return"+"}get precedence(){return 10}evaluate(e){e=_r.fromAny(e);return this.operand.evaluate(e).positive()}substitute(e){e=_r.fromAny(e);return this.operand.substitute(e).positive()}get typeOrder(){return 40}compareTo(e){return e instanceof pi?this.operand.compareTo(e.operand):e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof pi&&this.operand.equivalentTo(e.operand,t)}equals(e){return this===e||e instanceof pi&&this.operand.equals(e.operand)}hashCode(){return o.mash(o.mix(m.hash(pi),this.operand.hashCode()))}debug(e){return e=e.debug(this.operand).write(46).write("positive").write(40).write(41)}clone(){return new pi(this.operand.clone())}}class fi extends Ur{constructor(e,t){super(),this.func=e,this.args=t.commit(),this.state=void 0}setState(e){this.state=e}isConstant(){return this.func.isConstant()&&this.args.isConstant()}get precedence(){return 11}evaluate(e){e=_r.fromAny(e);const t=this.func.evaluate(e);return t instanceof ki?t.invoke(this.args,e,this):pr.absent()}substitute(e){e=_r.fromAny(e);const t=this.func.evaluate(e);if(t instanceof ki){const r=t.expand(this.args,e,this);if(void 0!==r)return r}const r=this.args.substitute(e).toValue();return new fi(this.func,r)}interpolateTo(e){return e instanceof fi?mi(this,e):super.interpolateTo(e)}get typeOrder(){return 41}compareTo(e){if(e instanceof fi){let t=this.func.compareTo(e.func);return 0===t&&(t=this.args.compareTo(e.args)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof fi&&(this.func.equals(e.func)&&this.args.equivalentTo(e.args,t))}equals(e){return this===e||e instanceof fi&&(this.func.equals(e.func)&&this.args.equals(e.args))}hashCode(){return o.mash(o.mix(o.mix(m.hash(fi),this.func.hashCode()),this.args.hashCode()))}debug(e){return e=e.debug(this.func).write(46).write("invoke").write(40).debug(this.args).write(41)}clone(){return new fi(this.func.clone(),this.args.clone())}}const mi=function(e){const t=function(e,r){const i=function(e){const t=i.funcInterpolator(e),r=i.argsInterpolator(e);return new fi(t,r)};return Object.setPrototypeOf(i,t.prototype),i.funcInterpolator=e.func.interpolateTo(r.func),i.argsInterpolator=e.args.interpolateTo(r.args),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.funcInterpolator[0],t=this.argsInterpolator[0];return new fi(e,t)},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.funcInterpolator[1],t=this.argsInterpolator[1];return new fi(e,t)},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.funcInterpolator.equals(e.funcInterpolator)&&this.argsInterpolator.equals(e.argsInterpolator))},t}(D);class yi extends zr{constructor(){super()}isConstant(){return!1}evaluate(e){e=_r.fromAny(e);const t=Cr.create();return this.forSelected(e,(function(e){const r=e.peekScope();void 0!==r&&t.push(r)}),this),t.isEmpty()?pr.absent():t.flattened()}get(e){return e=xr.fromAny(e),this.andThen(new gi(e,yi.identity()))}getAttr(e){return e=Tr.fromAny(e),this.andThen(new vi(e,yi.identity()))}getItem(e){return e=Mr.fromAny(e),this.andThen(new bi(e,yi.identity()))}keys(){return this.andThen(yi.keys())}values(){return this.andThen(yi.values())}children(){return this.andThen(yi.children())}descendants(){return this.andThen(yi.descendants())}filter(e){return 0===arguments.length?new Ei(this,yi.identity()):(e=pr.fromAny(e),this.andThen(e.filter()))}invoke(e){return new fi(this,e)}get precedence(){return 11}debug(e){return e=e.write("Selector").write(46).write("identity").write(40).write(41),e=this.debugThen(e)}static identity(){return new wi}static get(e){return e=xr.fromAny(e),new gi(e,yi.identity())}static getAttr(e){return e=Tr.fromAny(e),new vi(e,yi.identity())}static getItem(e){return e=Mr.fromAny(e),new bi(e,yi.identity())}static keys(){return new xi(yi.identity())}static values(){return new Ci(yi.identity())}static children(){return new Si(yi.identity())}static descendants(){return new Oi(yi.identity())}static literal(e){return(e=pr.fromAny(e))instanceof yi||(e=new Ai(e,yi.identity())),e}}i([a],yi,"identity",null),i([a],yi,"keys",null),i([a],yi,"values",null),i([a],yi,"children",null),i([a],yi,"descendants",null);class wi extends yi{get then(){return this}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope(),s=n.evaluate(e);e.pushScope(s),i=t.call(r,e),e.swapScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){return t.call(r,e)}substitute(e){return(e=_r.fromAny(e)).peekScope().substitute(e)}get(e){return e=xr.fromAny(e),new gi(e,this)}getAttr(e){return e=Tr.fromAny(e),new vi(e,this)}getItem(e){return e=Mr.fromAny(e),new bi(e,this)}andThen(e){return e}keys(){return yi.keys()}values(){return yi.values()}children(){return yi.children()}descendants(){return yi.descendants()}filter(e){return 0===arguments.length?new Ei(this,this):(e=pr.fromAny(e)).filter()}get typeOrder(){return 10}compareTo(e){return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this===e}equals(e){return this===e}hashCode(){return m.hash(wi)}debugThen(e){return e}clone(){return this}}class gi extends yi{constructor(e,t){super(),this.item=e.commit(),this.then=t}forSelected(e,t,r){e.willSelect(this);const i=this.item.evaluate(e).toValue(),n=gi.forSelected(i,this.then,e,t,r);return e.didSelect(this,n),n}static forSelected(e,t,r,i,n){let s;if(0!==r.scopeDepth){const o=r.popScope().toValue();let a;o instanceof Cr&&(a=o.getField(e),void 0!==a&&(r.pushScope(a.toValue()),s=t.forSelected(r,i,n),r.popScope())),void 0===a&&void 0===s&&gi.forSelected(e,t,r,i,n),r.pushScope(o)}return s}mapSelected(e,t,r){let i;e.willTransform(this);const n=this.item.evaluate(e).toValue();if(0!==e.scopeDepth){const s=e.popScope().toValue();if(s instanceof Cr){const i=s.getField(n);if(void 0!==i){e.pushScope(i.toValue());const o=this.then.mapSelected(e,t,r);e.popScope(),o instanceof mr?n.equals(o.key)?s.set(n,o.toValue()):(s.delete(n),s.push(o)):o.isDefined()?s.set(n,o.toValue()):s.delete(n)}}e.pushScope(s),i=s}else i=pr.absent();return e.didTransform(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.item.evaluate(e).toValue(),r=gi.substitute(t,this.then,e);if(void 0!==r)return r;let i=this.then.substitute(e);return i instanceof yi||(i=this.then),new gi(this.item,i)}static substitute(e,t,r){let i;if(0!==r.scopeDepth){const n=r.popScope().toValue();let s;n instanceof Cr&&(s=n.getField(e),void 0!==s&&(i=s.toValue().substitute(r))),void 0===s&&void 0===i&&gi.substitute(e,t,r),r.pushScope(n)}return i}andThen(e){return new gi(this.item,this.then.andThen(e))}get typeOrder(){return 12}compareTo(e){if(e instanceof gi){let t=this.item.compareTo(e.item);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof gi&&(this.item.equals(e.item)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof gi&&(this.item.equals(e.item)&&this.then.equals(e.then))}hashCode(){return o.mash(o.mix(o.mix(m.hash(gi),this.item.hashCode()),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("get").write(40).debug(this.item).write(41),e=this.then.debugThen(e)}clone(){return new gi(this.item.clone(),this.then.clone())}}class vi extends yi{constructor(e,t){super(),this.item=e,this.then=t}forSelected(e,t,r){e.willSelect(this);const i=this.item,n=vi.forSelected(i,this.then,e,t);return e.didSelect(this,n),n}static forSelected(e,t,r,i,n){let s;if(0!==r.scopeDepth){const o=r.popScope().toValue();let a;o instanceof Cr&&(a=o.getField(e),a instanceof gr&&(r.pushScope(a.toValue()),s=t.forSelected(r,i,n),r.popScope())),void 0===a&&void 0===s&&vi.forSelected(e,t,r,i,n),r.pushScope(o)}return s}mapSelected(e,t,r){let i;e.willTransform(this);const n=this.item;if(0!==e.scopeDepth){const s=e.popScope().toValue();if(s instanceof Cr){const i=s.getField(n);if(i instanceof gr){e.pushScope(i.toValue());const o=this.then.mapSelected(e,t,r);e.popScope(),o instanceof mr?n.equals(o.key)?s.setAttr(n,o.toValue()):(s.delete(n),s.push(o)):o.isDefined()?s.setAttr(n,o.toValue()):s.delete(n)}}e.pushScope(s),i=s}else i=pr.absent();return e.didTransform(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.item,r=vi.substitute(t,this.then,e);if(void 0!==r)return r;let i=this.then.substitute(e);return i instanceof yi||(i=this.then),new vi(this.item,i)}static substitute(e,t,r){let i;if(0!==r.scopeDepth){const n=r.popScope().toValue();let s;n instanceof Cr&&(s=n.getField(e),s instanceof gr&&(i=s.toValue().substitute(r))),void 0===s&&void 0===i&&vi.substitute(e,t,r),r.pushScope(n)}return i}andThen(e){return new vi(this.item,this.then.andThen(e))}get typeOrder(){return 13}compareTo(e){if(e instanceof vi){let t=this.item.compareTo(e.item);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof vi&&(this.item.equals(e.item)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof vi&&(this.item.equals(e.item)&&this.then.equals(e.then))}hashCode(){return o.mash(o.mix(o.mix(m.hash(vi),this.item.hashCode()),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("getAttr").write(40).debug(this.item).write(41),e=this.then.debugThen(e)}clone(){return new vi(this.item.clone(),this.then.clone())}}class bi extends yi{constructor(e,t){super(),this.item=e,this.then=t}forSelected(e,t,r){let i;e.willSelect(this);const n=this.item.numberValue();if(0!==e.scopeDepth){const s=e.popScope().toValue();if(s instanceof Cr&&n<s.length){const o=s.getItem(n);e.pushScope(o),i=this.then.forSelected(e,t,r),e.popScope()}e.pushScope(s)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){const n=e.popScope().toValue(),s=this.item.numberValue();if(n instanceof Cr&&s<n.length){const i=n.getItem(s);e.pushScope(i);const o=this.then.mapSelected(e,t,r);e.popScope(),o.isDefined()?n.setItem(s,o):n.splice(s,1)}e.pushScope(n),i=n}else i=pr.absent();return e.didTransform(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.item.numberValue();if(0!==e.scopeDepth){const r=e.popScope().toValue();let i;if(r instanceof Cr&&t<r.length){i=r.getItem(t).substitute(e)}if(e.pushScope(r),void 0!==i)return i}let r=this.then.substitute(e);return r instanceof yi||(r=this.then),new bi(this.item,r)}andThen(e){return new bi(this.item,this.then.andThen(e))}get typeOrder(){return 14}compareTo(e){if(e instanceof bi){let t=this.item.compareTo(e.item);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof bi&&(this.item.equals(e.item)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof bi&&(this.item.equals(e.item)&&this.then.equals(e.then))}hashCode(){return o.mash(o.mix(o.mix(m.hash(bi),this.item.hashCode()),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("getItem").write(40).debug(this.item).write(41),e=this.then.debugThen(e)}clone(){return new bi(this.item,this.then.clone())}}class xi extends yi{constructor(e){super(),this.then=e}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope();if(n instanceof Cr){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;n instanceof mr&&(e.pushScope(n.key),i=this.then.forSelected(e,t,r),e.popScope())}}else n instanceof mr&&(e.pushScope(n.key),i=this.then.forSelected(e,t,r),e.popScope());e.pushScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){let n=e.popScope();if(n instanceof Cr){const i=n.iterator();for(;i.hasNext();){const s=i.next().value;if(s instanceof mr){const o=s.key;e.pushScope(o);const a=this.then.mapSelected(e,t,r).toValue();e.popScope(),a.isDefined()?o!==a&&(n instanceof gr&&a instanceof Tr?i.set(gr.of(a,n.toValue())):i.set(yr.of(a,n.toValue()))):i.delete()}}}else if(n instanceof mr){const i=n.key;e.pushScope(i);const s=this.then.mapSelected(e,t,r).toValue();e.popScope(),s.isDefined()?i!==s&&(n=n instanceof gr&&s instanceof Tr?gr.of(s,n.toValue()):yr.of(s,n.toValue())):n=pr.absent()}e.pushScope(n),i=n}else i=pr.absent();return e.didTransform(this,i),i}substitute(e){e=_r.fromAny(e);let t=this.then.substitute(e);return t instanceof yi||(t=this.then),new xi(t)}andThen(e){return new xi(this.then.andThen(e))}get typeOrder(){return 15}compareTo(e){return e instanceof xi?this.then.compareTo(e.then):e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof xi&&this.then.equivalentTo(e.then,t)}equals(e){return this===e||e instanceof xi&&this.then.equals(e.then)}hashCode(){return o.mash(o.mix(m.hash(xi),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("keys").write(40).write(41),e=this.then.debugThen(e)}clone(){return new xi(this.then.clone())}}class Ci extends yi{constructor(e){super(),this.then=e}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope();if(n instanceof Cr){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;e.pushScope(n.toValue()),i=this.then.forSelected(e,t,r),e.popScope()}}else e.pushScope(n.toValue()),i=this.then.forSelected(e,t,r),e.popScope();e.pushScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){let n=e.popScope();if(n instanceof Cr){const i=n.iterator();for(;i.hasNext();){const n=i.next().value;if(n instanceof mr){const s=n.toValue();e.pushScope(s);const o=this.then.mapSelected(e,t,r);e.popScope(),o.isDefined()?o instanceof mr?i.set(o):o!==s&&i.set(n.updatedValue(o.toValue())):i.delete()}else{e.pushScope(n.toValue());const s=this.then.mapSelected(e,t,r);e.popScope(),s.isDefined()?n!==s&&i.set(s):i.delete()}}}else if(n instanceof mr){const i=n.toValue();e.pushScope(i);const s=this.then.mapSelected(e,t,r);e.popScope(),s.isDefined()?s instanceof mr?n=s:s!==i&&(n=n.updatedValue(s.toValue())):n=pr.absent()}else e.pushScope(n),n=this.then.mapSelected(e,t,r),e.popScope();e.pushScope(n),i=n}else i=pr.absent();return e.didTransform(this,i),i}substitute(e){e=_r.fromAny(e);let t=this.then.substitute(e);return t instanceof yi||(t=this.then),new Ci(t)}andThen(e){return new Ci(this.then.andThen(e))}get typeOrder(){return 16}compareTo(e){return e instanceof Ci?this.then.compareTo(e.then):e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Ci&&this.then.equivalentTo(e.then,t)}equals(e){return this===e||e instanceof Ci&&this.then.equals(e.then)}hashCode(){return o.mash(o.mix(m.hash(Ci),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("values").write(40).write(41),e=this.then.debugThen(e)}clone(){return new Ci(this.then.clone())}}class Si extends yi{constructor(e){super(),this.then=e}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope().toValue();if(n instanceof Cr){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;e.pushScope(n),i=this.then.forSelected(e,t,r),e.popScope()}}e.pushScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){const r=e.popScope().toValue();if(r instanceof Cr){const i=r.iterator();for(;i.hasNext();){const r=i.next().value;e.pushScope(r);const n=this.then.mapSelected(e,t);e.popScope(),n.isDefined()?n!==r&&i.set(n):i.delete()}}e.pushScope(r),i=r}else i=pr.absent();return e.didTransform(this,i),i}substitute(e){e=_r.fromAny(e);let t=this.then.substitute(e);return t instanceof yi||(t=this.then),new Si(t)}andThen(e){return new Si(this.then.andThen(e))}get typeOrder(){return 17}compareTo(e){return e instanceof Si?this.then.compareTo(e.then):e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Si&&this.then.equivalentTo(e.then,t)}equals(e){return this===e||e instanceof Si&&this.then.equals(e.then)}hashCode(){return o.mash(o.mix(m.hash(Si),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("children").write(40).write(41),e=this.then.debugThen(e)}clone(){return new Si(this.then.clone())}}class Oi extends yi{constructor(e){super(),this.then=e}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope().toValue();if(n instanceof Cr){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;e.pushScope(n),i=this.then.forSelected(e,t,r),void 0===i&&this.forSelected(e,t,r),e.popScope()}}e.pushScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){const n=e.popScope().toValue();if(n instanceof Cr){const i=n.iterator();for(;i.hasNext();){const n=i.next().value;e.pushScope(n);let s=this.then.mapSelected(e,t,r);s.isDefined()&&(s=this.mapSelected(e,t,r)),e.popScope(),s.isDefined()?s!==n&&i.set(s):i.delete()}}e.pushScope(n),i=n}else i=pr.absent();return e.didTransform(this,i),i}substitute(e){e=_r.fromAny(e);let t=this.then.substitute(e);return t instanceof yi||(t=this.then),new Oi(t)}andThen(e){return new Oi(this.then.andThen(e))}get typeOrder(){return 18}compareTo(e){return e instanceof Oi?this.then.compareTo(e.then):e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Oi&&this.then.equivalentTo(e.then,t)}equals(e){return this===e||e instanceof Oi&&this.then.equals(e.then)}hashCode(){return o.mash(o.mix(m.hash(Oi),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("descendants").write(40).write(41),e=this.then.debugThen(e)}clone(){return new Oi(this.then.clone())}}class Ei extends yi{constructor(e,t){super(),this.predicate=e,this.then=t}forSelected(e,t,r){let i;return e.willSelect(this),0!==e.scopeDepth&&this.filterSelected(e)&&(i=this.then.forSelected(e,t,r)),e.didSelect(this,i),i}mapSelected(e,t,r){let i;return e.willTransform(this),i=0!==e.scopeDepth?this.filterSelected(e)?this.then.mapSelected(e,t,r):e.peekScope().toValue():pr.absent(),e.didTransform(this,i),i}substitute(e){e=_r.fromAny(e);let t=this.predicate.substitute(e);t instanceof yi||(t=this.predicate);let r=this.then.substitute(e);return r instanceof yi||(r=this.then),new Ei(t,r)}filterSelected(e){return void 0!==this.predicate.forSelected(e,this.selected,this)}selected(e){return null}andThen(e){return new Ei(this.predicate,this.then.andThen(e))}filter(e){return 0===arguments.length?this:(e=pr.fromAny(e),this.andThen(e.filter()))}get typeOrder(){return 19}compareTo(e){if(e instanceof Ei){let t=this.predicate.compareTo(e.predicate);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Ei&&(this.predicate.equivalentTo(e.predicate,t)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof Ei&&(this.predicate.equals(e.predicate)&&this.then.equals(e.then))}hashCode(){return o.mash(o.mix(o.mix(m.hash(Ei),this.predicate.hashCode()),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("filter").write(40).debug(this.predicate).write(41),e=this.then.debugThen(e)}clone(){return new Ei(this.predicate.clone(),this.then.clone())}}class Ai extends yi{constructor(e,t){super(),this.item=e.commit(),this.then=t}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=this.item.evaluate(e);n.isDefined()&&(e.pushScope(n),i=this.then.forSelected(e,t,r),e.popScope())}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){let n=this.item.evaluate(e);n.isDefined()&&(e.pushScope(n),n=this.then.mapSelected(e,t,r),e.popScope()),i=n}else i=pr.absent();return e.didTransform(this,i),i}substitute(e){e=_r.fromAny(e);const t=this.item.substitute(e);let r=this.then.substitute(e);return r instanceof yi||(r=this.then),new Ai(t,r)}andThen(e){return new Ai(this.item,this.then.andThen(e))}get precedence(){return this.item.precedence}get typeOrder(){return 11}compareTo(e){if(e instanceof Ai){let t=this.item.compareTo(e.item);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Ai&&(this.item.equivalentTo(e.item,t)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof Ai&&(this.item.equals(e.item)&&this.then.equals(e.then))}hashCode(){return o.mash(o.mix(o.mix(m.hash(Ai),this.item.hashCode()),this.then.hashCode()))}debug(e){return e=e.write("Selector").write(46).write("literal").write(40).debug(this.item).write(41),e=this.then.debugThen(e)}debugThen(e){return e}clone(){return new Ai(this.item.clone(),this.then.clone())}}class ki extends zr{constructor(){super()}isConstant(){return!1}expand(e,t,r){}}class Di extends ki{constructor(e,t){super(),this.bindings=e,this.template=t}get precedence(){return 1}invoke(e,t,r){t=_r.fromAny(t);const i=this.bindings,n=Math.max(1,i.length),s=Cr.create(n);let o=0,a=0;for(;o<n;){const t=i instanceof Cr?i.getItem(o):0===o?i:pr.absent(),r=e instanceof Cr?e.getItem(a).toValue():0===a?e:xr.absent();t instanceof Tr&&r.isDistinct()?(s.push(yr.of(t,r)),a+=1):t instanceof yr&&(r.isDistinct()?s.push(t.updatedValue(r)):s.push(t),a+=1),o+=1}t.pushScope(s);const u=this.template.evaluate(t);return t.popScope(),u}get typeOrder(){return 50}compareTo(e){if(e instanceof Di){let t=this.bindings.compareTo(e.bindings);return 0===t&&(t=this.template.compareTo(e.template)),t}return e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Di&&(this.bindings.equivalentTo(e.bindings,t)&&this.template.equivalentTo(e.template,t))}equals(e){return this===e||e instanceof Di&&(this.bindings.equals(e.bindings)&&this.template.equals(e.template))}hashCode(){return o.mash(o.mix(o.mix(m.hash(Di),this.bindings.hashCode()),this.template.hashCode()))}debug(e){return e=e.debug(this.bindings).write(46).write("lambda").write(40).debug(this.template).write(41)}}class Pi extends ki{get typeOrder(){return 51}compareTo(e){return e instanceof Pi?m.compare(this.constructor,e.constructor):e instanceof pr?c.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this===e}equals(e){return this===e}hashCode(){return m.hash(this.constructor)}debug(e){return e=e.write(this.constructor.name)}}const Ti=function(){const e={};Object.defineProperty(e,"max",{get(){const r=new t;return Object.defineProperty(e,"max",{value:r,enumerable:!0,configurable:!0}),r},enumerable:!0,configurable:!0}),Object.defineProperty(e,"min",{get(){const t=new r;return Object.defineProperty(e,"min",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"abs",{get(){const t=new i;return Object.defineProperty(e,"abs",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ceil",{get(){const t=new n;return Object.defineProperty(e,"ceil",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"floor",{get(){const t=new s;return Object.defineProperty(e,"floor",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"round",{get(){const t=new o;return Object.defineProperty(e,"round",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"sqrt",{get(){const t=new a;return Object.defineProperty(e,"sqrt",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"pow",{get(){const t=new u;return Object.defineProperty(e,"pow",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"rate",{get(){const t=new h;return Object.defineProperty(e,"rate",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"random",{get(){const t=new l;return Object.defineProperty(e,"random",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"scope",{get(){const t=Cr.create(10).slot("max",e.max).slot("min",e.min).slot("abs",e.abs).slot("ceil",e.ceil).slot("floor",e.floor).slot("round",e.round).slot("pow",e.pow).slot("sqrt",e.sqrt).slot("rate",e.rate).slot("random",e.random).commit();return Object.defineProperty(e,"scope",{value:t,configurable:!0,enumerable:!0}),t},enumerable:!0,configurable:!0});class t extends Pi{invoke(e,t,r){let i,n;if(t=_r.fromAny(t),e.length>=2?(i=e.getItem(0).evaluate(t),n=e.getItem(1).evaluate(t)):i=e.evaluate(t),void 0!==n)return i.max(n);if(void 0!==r){n=r.state;const e=void 0!==n?i.max(n):i;return r.setState(e),e}return pr.absent()}expand(e,t,r){if(1===e.length)return e=e.evaluate(t).toValue(),this.invoke(e,t,r)}}class r extends Pi{invoke(e,t,r){let i,n;if(t=_r.fromAny(t),e.length>=2?(i=e.getItem(0).evaluate(t),n=e.getItem(1).evaluate(t)):i=e.evaluate(t),void 0!==n)return i.min(n);if(void 0!==r){n=r.state;const e=void 0!==n?i.min(n):i;return r.setState(e),e}return pr.absent()}expand(e,t,r){if(1===e.length)return e=e.evaluate(t).toValue(),this.invoke(e,t,r)}}class i extends Pi{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof Mr?e.abs():pr.absent()}}class n extends Pi{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof Mr?e.ceil():pr.absent()}}class s extends Pi{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof Mr?e.floor():pr.absent()}}class o extends Pi{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof Mr?e.round():pr.absent()}}class a extends Pi{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof Mr?e.sqrt():pr.absent()}}class u extends Pi{invoke(e,t,r){t=_r.fromAny(t);const i=e.getItem(0).evaluate(t),n=e.getItem(1).evaluate(t);return i instanceof Mr&&n instanceof Mr?i.pow(n):pr.absent()}}class h extends Pi{invoke(e,t,r){let i,n;if(t=_r.fromAny(t),e.length>=2?(i=e.getItem(0).evaluate(t).numberValue(NaN),n=e.getItem(1).evaluate(t).numberValue(1e3)):(i=e.evaluate(t).numberValue(NaN),n=1e3),isFinite(i)&&void 0!==r){let e=r.state;if(void 0===e)e={v0:i,t0:Date.now(),dv:0,dt:0},r.setState(e);else{const t=Date.now(),s=t-e.t0;if(s>n&&t>e.t0||s>2*n){const r=i-e.v0;e.v0=i,e.t0=t,e.dv=r,e.dt=s}if(r.setState(e),0!==e.dt){const t=n*e.dv/e.dt;return Mr.from(t)}}}return pr.absent()}expand(e,t,r){return e=e.evaluate(t).toValue(),this.invoke(e,t,r)}}class l extends Pi{invoke(e,t,r){const i=(e=e.evaluate(t).toValue()).length>=1?e.getItem(0).numberValue(0):0,n=e.length>=2?e.getItem(1).numberValue(i+1):i+1,s=i+Math.random()*(n-i);return Mr.from(s)}}return e}();class Ii extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ii.prototype)}}class Mi{withTag(e){return void 0!==e&&e!==this.tag?new Vi(this,e):this}withUnit(e){return e!==this.unit?new qi(this,e):this}static forString(){return new Fi("")}static forNumber(){return new Ni(0)}static forBoolean(){return new zi(!1)}static forAny(){return new Ui(void 0)}static forItem(){return new Ri(pr.absent())}static forValue(){return new ji(xr.absent())}}i([a],Mi,"forString",null),i([a],Mi,"forNumber",null),i([a],Mi,"forBoolean",null),i([a],Mi,"forAny",null),i([a],Mi,"forItem",null),i([a],Mi,"forValue",null),Object.defineProperty(Mi.prototype,"tag",{get(){},configurable:!0}),Object.defineProperty(Mi.prototype,"unit",{get(){},configurable:!0});class Vi extends Mi{constructor(e,t){super(),this.form=e,this.tag=t}withTag(e){return void 0!==e&&e!==this.tag?new Vi(this.form,e):void 0===e?this.form:this}withUnit(e){return e!==this.unit?new Vi(this.form.withUnit(e),this.tag):this}mold(e,t){return(t=this.form.mold(e,t)).header(this.tag).isDefined()||(t=t.prepended(gr.of(this.tag))),t}cast(e,t){return e.header(this.tag).isDefined()?this.form.cast(e,t):e.keyEquals(this.tag)?this.form.cast(e.toValue(),t):void 0}}Object.defineProperty(Vi.prototype,"unit",{get(){return this.form.unit},configurable:!0});class qi extends Mi{constructor(e,t){super(),this.form=e,Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withTag(e){return e!==this.tag?new qi(this.form.withTag(e),this.unit):this}withUnit(e){return e!==this.unit?new qi(this.form,e):e===this.form.unit?this.form:this}mold(e,t){return 1===arguments.length?this.form.mold(e):this.form.mold(e,t)}cast(e,t){return 1===arguments.length?this.form.cast(e):this.form.cast(e,t)}}Object.defineProperty(qi.prototype,"tag",{get(){return this.form.tag},configurable:!0});class Fi extends Mi{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new Fi(e):this}mold(e,t){return void 0===t?Tr.from(e):t.concat(Tr.from(e))}cast(e,t){const r=e.target;try{return r.stringValue()}catch(e){return}}}class Ni extends Mi{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new Ni(e):this}mold(e,t){return void 0===t?Mr.from(e):t.concat(Mr.from(e))}cast(e,t){const r=e.target;try{return r.numberValue()}catch(e){return}}}class zi extends Mi{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new zi(e):this}mold(e,t){return void 0===t?qr.from(e):t.concat(qr.from(e))}cast(e,t){const r=e.target;try{return r.booleanValue()}catch(e){return}}}class Ui extends Mi{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new Ui(e):this}mold(e,t){return e=pr.fromAny(e),void 0!==t&&(e=t.concat(e)),e}cast(e,t){return e.toAny()}}class Ri extends Mi{constructor(e){super(),Object.defineProperty(this,"unit",{value:void 0!==e?e.commit():void 0,enumerable:!0})}withUnit(e){return e!==this.unit?new Ri(e):this}mold(e,t){return e=pr.fromAny(e),void 0!==t&&(e=t.concat(e)),e}cast(e,t){return e}}class ji extends Mi{constructor(e){super(),Object.defineProperty(this,"unit",{value:void 0!==e?e.commit():void 0,enumerable:!0})}withUnit(e){return e!==this.unit?new ji(e):this}mold(e,t){return e=xr.fromAny(e),void 0!==t&&(e=t.concat(e)),e}cast(e,t){return e.toValue()}}class Li extends Z{constructor(e,t){super(),this.cursor=e,this.form=t}isEmpty(){return this.cursor.isEmpty()}head(){return this.cursor.head().coerce(this.form)}step(){this.cursor.step()}skip(e){this.cursor.skip(e)}hasNext(){return this.cursor.hasNext()}nextIndex(){return this.cursor.nextIndex()}next(){const{value:e,done:t}=this.cursor.next();return void 0!==e?{value:e.coerce(this.form),done:t}:{done:t}}hasPrevious(){return this.cursor.hasPrevious()}previousIndex(){return this.cursor.previousIndex()}previous(){const{value:e,done:t}=this.cursor.previous();return void 0!==e?{value:e.coerce(this.form),done:t}:{done:t}}delete(){this.cursor.delete()}}class Bi extends Z{constructor(e,t,r){super(),this.cursor=e,this.keyForm=t,this.valueForm=r}isEmpty(){return this.cursor.isEmpty()}head(){const e=this.cursor.head();return[e[0].coerce(this.keyForm),e[1].coerce(this.valueForm)]}step(){this.cursor.step()}skip(e){this.cursor.skip(e)}hasNext(){return this.cursor.hasNext()}nextIndex(){return this.cursor.nextIndex()}next(){const{value:e,done:t}=this.cursor.next();return void 0!==e?{value:[e[0].coerce(this.keyForm),e[1].coerce(this.valueForm)],done:t}:{done:t}}hasPrevious(){return this.cursor.hasPrevious()}previousIndex(){return this.cursor.previousIndex()}previous(){const{value:e,done:t}=this.cursor.previous();return void 0!==e?{value:[e[0].coerce(this.keyForm),e[1].coerce(this.valueForm)],done:t}:{done:t}}delete(){this.cursor.delete()}}const Ki=function(){const e={is:function(e){if("object"==typeof e&&null!==e||"function"==typeof e){const t=e;return"input"in t&&"function"==typeof t.bindInput&&"function"==typeof t.unbindInput}return!1}};return e}(),Wi=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return"function"==typeof t.outputIterator&&"function"==typeof t.bindOutput&&"function"==typeof t.unbindOutput}return!1}};return e}(),Hi=function(){const e={define:function(t){Object.prototype.hasOwnProperty.call(t,"memoize")||(t.memoize=e.memoize),Object.prototype.hasOwnProperty.call(t,"map")||(t.map=e.map),Object.prototype.hasOwnProperty.call(t,"watch")||(t.watch=e.watch)},memoize:function(){const e=new dn;return e.bindInput(this),e},map:function(e){const t=new wn(e);return t.bindInput(this),t},watch:function(e){return new Sn(e).bindInput(this),this}};return e}();var Xi;e.KeyEffect=void 0,(Xi=e.KeyEffect||(e.KeyEffect={}))[Xi.Update=0]="Update",Xi[Xi.Remove=1]="Remove";const _i=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return Ki.is(t)&&"function"==typeof t.decohereOutputKey&&"function"==typeof t.recohereOutputKey}return!1}};return e}(),Gi=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return Wi.is(t)&&"function"==typeof t.keyIterator&&"function"==typeof t.outlet}return!1}};return e}(),Yi=function(){const e={define:function(t){Object.prototype.hasOwnProperty.call(t,"memoize")||(t.memoize=e.memoize),Object.prototype.hasOwnProperty.call(t,"filterr")||(t.filter=e.filter),Object.prototype.hasOwnProperty.call(t,"map")||(t.map=e.map),Object.prototype.hasOwnProperty.call(t,"reduce")||(t.reduce=e.reduce),Object.prototype.hasOwnProperty.call(t,"watch")||(t.watch=e.watch)},memoize:function(){const e=new pn;return e.bindInput(this),e},filter:function(e){const t=new mn(e);return t.bindInput(this),t},map:function(e){if(1===e.length){const t=new wn(e);return t.bindInput(this),t}{const t=new vn(e);return t.bindInput(this),t}},reduce:function(e,t,r){const i=new xn(e,t,r);return i.bindInput(this),i},watch:function(e){if(1===e.length){return new Sn(e).bindInput(this),this}return new En(e).bindInput(this),this}};return e}();class Zi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Zi.prototype)}}const Qi=function(){const e={is:function(e){if("object"==typeof e&&null!==e||"function"==typeof e){const t=e;return"streamletScope"in t&&"streamletContext"in t&&"function"==typeof t.outlet}return!1}};return e}(),$i=function(){const e={is:function(e){if("object"==typeof e&&null!==e||"function"==typeof e){const t=e;return"streamletScope"in t&&"function"==typeof t.setStreamletScope&&"streamletContext"in t&&"function"==typeof t.setStreamletContext}return!1}};return e}();class Ji{constructor(){this.input=null,this.version=-1}bindInput(e){const t=this.input;t!==e&&(null!==t&&t.unbindOutput(this),this.input=e,null!==e&&e.bindOutput(this))}unbindInput(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null)}disconnectInputs(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null,e.disconnectInputs())}disconnectOutputs(){}decohereOutput(){this.version>=0&&(this.willDecohereOutput(),this.version=-1,this.onDecohereOutput(),this.didDecohereOutput())}recohereOutput(e){this.version<0&&(this.willRecohereOutput(e),this.version=e,null!==this.input&&this.input.recohereInput(e),this.onRecohereOutput(e),this.didRecohereOutput(e))}willDecohereOutput(){}onDecohereOutput(){}didDecohereOutput(){}willRecohereOutput(e){}onRecohereOutput(e){}didRecohereOutput(e){}}class en{constructor(){this.outputs=x.empty,this.version=-1}outputIterator(){return Z.array(this.outputs)}bindOutput(e){this.outputs=x.inserted(e,this.outputs)}unbindOutput(e){this.outputs=x.removed(e,this.outputs)}unbindOutputs(){const e=this.outputs;this.outputs=x.empty;for(let t=0,r=e.length;t<r;t+=1){e[t].unbindInput()}}disconnectOutputs(){const e=this.outputs;this.outputs=x.empty;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];r.unbindInput(),r.disconnectOutputs()}}disconnectInputs(){}decohereInput(){if(this.version>=0){this.willDecohereInput(),this.version=-1,this.onDecohereInput();const e=this.outputs;for(let t=0,r=e.length;t<r;t+=1)e[t].decohereOutput();this.didDecohereInput()}}recohereInput(e){if(this.version<0){this.willRecohereInput(e),this.version=e,this.onRecohereInput(e);const t=this.outputs;for(let r=0,i=t.length;r<i;r+=1)t[r].recohereOutput(e);this.didRecohereInput(e)}}willDecohereInput(){}onDecohereInput(){}didDecohereInput(){}willRecohereInput(e){}onRecohereInput(e){}didRecohereInput(e){}}Hi.define(en.prototype);class tn{constructor(){this.input=null,this.outputs=x.empty,this.version=-1}bindInput(e){const t=this.input;t!==e&&(null!==t&&t.unbindOutput(this),this.input=e,null!==e&&e.bindOutput(this))}unbindInput(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null)}disconnectInputs(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null,e.disconnectInputs())}outputIterator(){return Z.array(this.outputs)}bindOutput(e){this.outputs=x.inserted(e,this.outputs)}unbindOutput(e){this.outputs=x.removed(e,this.outputs)}unbindOutputs(){const e=this.outputs;this.outputs=x.empty;for(let t=0,r=e.length;t<r;t+=1){e[t].unbindInput()}}disconnectOutputs(){const e=this.outputs;this.outputs=x.empty;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];r.unbindInput(),r.disconnectOutputs()}}decohereOutput(){this.decohere()}decohereInput(){this.decohere()}decohere(){if(this.version>=0){this.willDecohere(),this.version=-1,this.onDecohere();const e=this.outputs;for(let t=0,r=e.length;t<r;t+=1)e[t].decohereOutput();this.didDecohere()}}recohereOutput(e){this.recohere(e)}recohereInput(e){this.recohere(e)}recohere(e){if(this.version<0){this.willRecohere(e),this.version=e,null!==this.input&&this.input.recohereInput(e),this.onRecohere(e);const t=this.outputs;for(let r=0,i=t.length;r<i;r+=1)t[r].recohereOutput(e);this.didRecohere(e)}}willDecohere(){}onDecohere(){}didDecohere(){}willRecohere(e){}onRecohere(e){}didRecohere(e){}}Hi.define(tn.prototype);class rn extends en{constructor(e,t){super(),this.input=e,this.key=t}get(){return this.input.get(this.key)}}class nn{constructor(){this.input=null,this.effects=new Ut,this.version=-1}bindInput(e){if(!Gi.is(e))throw new TypeError(""+e);const t=this.input;t!==e&&(null!==t&&t.unbindOutput(this),this.input=e,null!==e&&e.bindOutput(this))}unbindInput(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null)}disconnectInputs(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null,e.disconnectInputs())}disconnectOutputs(){}decohereOutputKey(e,t){const r=this.effects;r.get(e)!==t&&(this.willDecohereOutputKey(e,t),this.effects=r.updated(e,t),this.version=-1,this.onDecohereOutputKey(e,t),this.didDecohereOutputKey(e,t))}decohereOutput(){this.version>=0&&(this.willDecohereOutput(),this.version=-1,this.onDecohereOutput(),this.didDecohereOutput())}recohereOutputKey(e,t){if(this.version<0){const r=this.effects,i=r.get(e);void 0!==i&&(this.willRecohereOutputKey(e,i,t),this.effects=r.removed(e),null!==this.input&&this.input.recohereInputKey(e,t),this.onRecohereOutputKey(e,i,t),this.didRecohereOutputKey(e,i,t))}}recohereOutput(e){this.version<0&&(this.willRecohereOutput(e),this.effects.forEach((function(t){this.recohereOutputKey(t,e)}),this),this.version=e,this.onRecohereOutput(e),this.didRecohereOutput(e))}willDecohereOutputKey(e,t){}onDecohereOutputKey(e,t){}didDecohereOutputKey(e,t){}willDecohereOutput(){}onDecohereOutput(){}didDecohereOutput(){}willRecohereOutputKey(e,t,r){}onRecohereOutputKey(e,t,r){}didRecohereOutputKey(e,t,r){}willRecohereOutput(e){}onRecohereOutput(e){}didRecohereOutput(e){}}class sn{constructor(){this.effects=new Ut,this.outlets=new Ut,this.outputs=x.empty,this.version=-1}outlet(e){const t=this.outlets;let r=t.get(e);return void 0===r&&(r=new rn(this,e),this.outlets=t.updated(e,r)),r}outputIterator(){return Z.array(this.outputs)}bindOutput(e){this.outputs=x.inserted(e,this.outputs)}unbindOutput(e){this.outputs=x.removed(e,this.outputs)}unbindOutputs(){const e=this.outlets;e.isEmpty()&&(this.outlets=new Ut,e.forEach((function(e,t){t.unbindOutputs()}),this));const t=this.outputs;this.outputs=x.empty;for(let e=0,r=t.length;e<r;e+=1){t[e].unbindInput()}}disconnectOutputs(){const e=this.outlets;e.isEmpty()&&(this.outlets=new Ut,e.forEach((function(e,t){t.disconnectOutputs()}),this));const t=this.outputs;this.outputs=x.empty;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];r.unbindInput(),r.disconnectOutputs()}}disconnectInputs(){}decohereInputKey(e,t){const r=this.effects;if(r.get(e)!==t){this.willDecohereInputKey(e,t),this.effects=r.updated(e,t),this.version=-1,this.onDecohereInputKey(e,t);const i=this.outputs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];_i.is(n)?n.decohereOutputKey(e,t):n.decohereOutput()}const n=this.outlets.get(e);void 0!==n&&n.decohereInput(),this.didDecohereInputKey(e,t)}}decohereInput(){if(this.version>=0){this.willDecohereInput(),this.version=-1,this.onDecohereInput();const e=this.outputs;for(let t=0,r=e.length;t<r;t+=1){e[t].decohereOutput()}this.outlets.forEach((function(e,t){t.decohereInput()}),this),this.didDecohereInput()}}recohereInputKey(e,t){if(this.version<0){const r=this.effects,i=r.get(e);if(void 0!==i){this.willRecohereInputKey(e,i,t),this.effects=r.removed(e),this.onRecohereInputKey(e,i,t);const n=this.outputs;for(let r=0,i=n.length;r<i;r+=1){const i=n[r];_i.is(i)&&i.recohereOutputKey(e,t)}const s=this.outlets.get(e);void 0!==s&&s.recohereInput(t),this.didRecohereInputKey(e,i,t)}}}recohereInput(e){if(this.version<0){this.willRecohereInput(e),this.effects.forEach((function(t){this.recohereInputKey(t,e)}),this),this.version=e,this.onRecohereInput(e);const t=this.outputs;for(let r=0,i=t.length;r<i;r+=1){t[r].recohereOutput(e)}this.didRecohereInput(e)}}willDecohereInputKey(e,t){}onDecohereInputKey(e,t){}didDecohereInputKey(e,t){}willDecohereInput(){}onDecohereInput(){}didDecohereInput(){}willRecohereInputKey(e,t,r){}onRecohereInputKey(e,t,r){}didRecohereInputKey(e,t,r){}willRecohereInput(e){}onRecohereInput(e){}didRecohereInput(e){}}Yi.define(sn.prototype);class on{constructor(){this.input=null,this.effects=new Ut,this.outlets=new Ut,this.outputs=x.empty,this.version=-1}bindInput(e){if(!Gi.is(e))throw new TypeError(""+e);const t=this.input;t!==e&&(null!==t&&t.unbindOutput(this),this.input=e,null!==e&&e.bindOutput(this))}unbindInput(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null)}disconnectInputs(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null,e.disconnectInputs())}outlet(e){const t=this.outlets;let r=t.get(e);return void 0===r&&(r=new rn(this,e),this.outlets=t.updated(e,r)),r}outputIterator(){return Z.array(this.outputs)}bindOutput(e){this.outputs=x.inserted(e,this.outputs)}unbindOutput(e){this.outputs=x.removed(e,this.outputs)}unbindOutputs(){const e=this.outlets;e.isEmpty()&&(this.outlets=new Ut,e.forEach((function(e,t){t.unbindOutputs()}),this));const t=this.outputs;this.outputs=x.empty;for(let e=0,r=t.length;e<r;e+=1){t[e].unbindInput()}}disconnectOutputs(){const e=this.outlets;e.isEmpty()&&(this.outlets=new Ut,e.forEach((function(e,t){t.disconnectOutputs()}),this));const t=this.outputs;this.outputs=x.empty;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];r.unbindInput(),r.disconnectOutputs()}}decohereOutputKey(e,t){this.decohereKey(e,t)}decohereInputKey(e,t){this.decohereKey(e,t)}decohereKey(e,t){const r=this.effects;if(r.get(e)!==t){this.willDecohereKey(e,t),this.effects=r.updated(e,t),this.version=-1,this.onDecohereKey(e,t);const i=this.outputs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];_i.is(n)?n.decohereOutputKey(e,t):n.decohereOutput()}const n=this.outlets.get(e);void 0!==n&&n.decohereInput(),this.didDecohereKey(e,t)}}decohereOutput(){this.decohere()}decohereInput(){this.decohere()}decohere(){if(this.version>=0){this.willDecohere(),this.version=-1,this.onDecohere();const e=this.outputs;for(let t=0,r=e.length;t<r;t+=1){e[t].decohereOutput()}this.outlets.forEach((function(e,t){t.decohereInput()}),this),this.didDecohere()}}recohereOutputKey(e,t){this.recohereKey(e,t)}recohereInputKey(e,t){this.recohereKey(e,t)}recohereKey(e,t){if(this.version<0){const r=this.effects,i=r.get(e);if(void 0!==i){this.willRecohereKey(e,i,t),this.effects=r.removed(e),null!==this.input&&this.input.recohereInputKey(e,t),this.onRecohereKey(e,i,t);const n=this.outputs;for(let r=0,i=n.length;r<i;r+=1){const i=n[r];_i.is(i)&&i.recohereOutputKey(e,t)}const s=this.outlets.get(e);void 0!==s&&s.recohereInput(t),this.didRecohereKey(e,i,t)}}}recohereOutput(e){this.recohere(e)}recohereInput(e){this.recohere(e)}recohere(e){if(this.version<0){this.willRecohere(e),this.effects.forEach((function(t){this.recohereKey(t,e)}),this),this.version=e,this.onRecohere(e);const t=this.outputs;for(let r=0,i=t.length;r<i;r+=1){t[r].recohereOutput(e)}this.didRecohere(e)}}willDecohereKey(e,t){}onDecohereKey(e,t){}didDecohereKey(e,t){}willDecohere(){}onDecohere(){}didDecohere(){}willRecohereKey(e,t,r){}onRecohereKey(e,t,r){}didRecohereKey(e,t,r){}willRecohere(e){}onRecohere(e){}didRecohere(e){}}Yi.define(on.prototype);class an{constructor(){this.input=null,this.effects=new Ut,this.outputs=x.empty,this.version=-1}bindInput(e){if(!Gi.is(e))throw new TypeError(""+e);const t=this.input;t!==e&&(null!==t&&t.unbindOutput(this),this.input=e,null!==e&&e.bindOutput(this))}unbindInput(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null)}disconnectInputs(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null,e.disconnectInputs())}outputIterator(){return Z.array(this.outputs)}bindOutput(e){this.outputs=x.inserted(e,this.outputs)}unbindOutput(e){this.outputs=x.removed(e,this.outputs)}unbindOutputs(){const e=this.outputs;this.outputs=x.empty;for(let t=0,r=e.length;t<r;t+=1){e[t].unbindInput()}}disconnectOutputs(){const e=this.outputs;this.outputs=x.empty;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];r.unbindInput(),r.disconnectOutputs()}}decohereOutputKey(e,t){const r=this.effects;if(r.get(e)!==t){this.willDecohereOutputKey(e,t),this.effects=r.updated(e,t),this.version=-1,this.onDecohereOutputKey(e,t);const i=this.outputs;for(let e=0,t=i.length;e<t;e+=1){i[e].decohereOutput()}this.didDecohereOutputKey(e,t)}}decohereOutput(){this.decohere()}decohereInput(){this.decohere()}decohere(){if(this.version>=0){this.willDecohere(),this.version=-1,this.onDecohere();const e=this.outputs;for(let t=0,r=e.length;t<r;t+=1){e[t].decohereOutput()}this.didDecohere()}}recohereOutputKey(e,t){if(this.version<0){const r=this.effects,i=r.get(e);void 0!==i&&(this.willRecohereOutputKey(e,i,t),this.effects=r.removed(e),null!==this.input&&this.input.recohereInputKey(e,t),this.onRecohereOutputKey(e,i,t),this.didRecohereOutputKey(e,i,t))}}recohereOutput(e){this.recohere(e)}recohereInput(e){this.recohere(e)}recohere(e){if(this.version<0){this.willRecohere(e),this.effects.forEach((function(t){this.recohereOutputKey(t,e)}),this),this.version=e,this.onRecohere(e);const t=this.outputs;for(let r=0,i=t.length;r<i;r+=1){t[r].recohereOutput(e)}this.didRecohere(e)}}willDecohereOutputKey(e,t){}onDecohereOutputKey(e,t){}didDecohereOutputKey(e,t){}willDecohere(){}onDecohere(){}didDecohere(){}willRecohereOutputKey(e,t,r){}onRecohereOutputKey(e,t,r){}didRecohereOutputKey(e,t,r){}willRecohere(e){}onRecohere(e){}didRecohere(e){}}Hi.define(an.prototype);class un{constructor(){this.input=null,this.outputEffects=new Ut,this.inputEffects=new Ut,this.outlets=new Ut,this.outputs=x.empty,this.version=-1}bindInput(e){if(!Gi.is(e))throw new TypeError(""+e);const t=this.input;t!==e&&(null!==t&&t.unbindOutput(this),this.input=e,null!==e&&e.bindOutput(this))}unbindInput(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null)}disconnectInputs(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null,e.disconnectInputs())}outlet(e){const t=this.outlets;let r=t.get(e);return void 0===r&&(r=new rn(this,e),this.outlets=t.updated(e,r)),r}outputIterator(){return Z.array(this.outputs)}bindOutput(e){this.outputs=x.inserted(e,this.outputs)}unbindOutput(e){this.outputs=x.removed(e,this.outputs)}unbindOutputs(){const e=this.outlets;e.isEmpty()&&(this.outlets=new Ut,e.forEach((function(e,t){t.unbindOutputs()}),this));const t=this.outputs;this.outputs=x.empty;for(let e=0,r=t.length;e<r;e+=1){t[e].unbindInput()}}disconnectOutputs(){const e=this.outlets;e.isEmpty()&&(this.outlets=new Ut,e.forEach((function(e,t){t.disconnectOutputs()}),this));const t=this.outputs;this.outputs=x.empty;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];r.unbindInput(),r.disconnectOutputs()}}decohereOutputKey(e,t){const r=this.outputEffects;r.get(e)!==t&&(this.willDecohereOutputKey(e,t),this.outputEffects=r.updated(e,t),this.version=-1,this.onDecohereOutputKey(e,t),this.didDecohereOutputKey(e,t))}decohereInputKey(e,t){const r=this.inputEffects;if(r.get(e)!==t){this.willDecohereInputKey(e,t),this.inputEffects=r.updated(e,t),this.version=-1,this.onDecohereInputKey(e,t);const i=this.outputs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];_i.is(n)?n.decohereOutputKey(e,t):n.decohereOutput()}const n=this.outlets.get(e);void 0!==n&&n.decohereInput(),this.didDecohereInputKey(e,t)}}decohereOutput(){this.decohere()}decohereInput(){this.decohere()}decohere(){if(this.version>=0){this.willDecohere(),this.version=-1,this.onDecohere();const e=this.outputs;for(let t=0,r=e.length;t<r;t+=1){e[t].decohereOutput()}this.outlets.forEach((function(e,t){t.decohereInput()}),this),this.didDecohere()}}recohereOutputKey(e,t){if(this.version<0){const r=this.outputEffects,i=r.get(e);void 0!==i&&(this.willRecohereOutputKey(e,i,t),this.outputEffects=r.removed(e),null!==this.input&&this.input.recohereInputKey(e,t),this.onRecohereOutputKey(e,i,t),this.didRecohereOutputKey(e,i,t))}}recohereInputKey(e,t){if(this.version<0){const r=this.inputEffects,i=r.get(e);if(void 0!==i){const n=this.willRecohereInputKey(e,i,t);i!==n&&this.decohereInputKey(e,n),this.inputEffects=r.removed(e),this.onRecohereInputKey(e,n,t);const s=this.outputs;for(let r=0,i=s.length;r<i;r+=1){const i=s[r];_i.is(i)&&i.recohereOutputKey(e,t)}const o=this.outlets.get(e);void 0!==o&&o.recohereInput(t),this.didRecohereInputKey(e,n,t)}}}recohereOutput(e){this.recohere(e)}recohereInput(e){this.recohere(e)}recohere(e){if(this.version<0){this.willRecohere(e),this.outputEffects.forEach((function(t){this.recohereOutputKey(t,e)}),this),this.inputEffects.forEach((function(t){this.recohereInputKey(t,e)}),this),this.version=e,this.onRecohere(e);const t=this.outputs;for(let r=0,i=t.length;r<i;r+=1){t[r].recohereOutput(e)}this.didRecohere(e)}}willDecohereOutputKey(e,t){}onDecohereOutputKey(e,t){}didDecohereOutputKey(e,t){}willDecohereInputKey(e,t){}onDecohereInputKey(e,t){}didDecohereInputKey(e,t){}willDecohere(){}onDecohere(){}didDecohere(){}willRecohereOutputKey(e,t,r){}onRecohereOutputKey(e,t,r){}didRecohereOutputKey(e,t,r){}willRecohereInputKey(e,t,r){return t}onRecohereInputKey(e,t,r){}didRecohereInputKey(e,t,r){}willRecohere(e){}onRecohere(e){}didRecohere(e){}}Yi.define(un.prototype);class hn extends Ji{constructor(e){super(),this.outlet=e}onDecohereOutput(){this.outlet.decohereInput()}onRecohereOutput(e){this.outlet.recohereInput(e)}}class ln extends nn{constructor(e){super(),this.outlet=e}onDecohereOutputKey(e,t){this.outlet.decohereInput()}onDecohereOutput(){this.outlet.decohereInput()}onRecohereOutputKey(e,t,r){this.outlet.recohereInput(r)}onRecohereOutput(e){this.outlet.recohereInput(e)}}class cn extends en{constructor(e){super(),this.state=e}get(){return this.state}set(e){const t=this.state;return t!==e&&(this.state=e,this.decohereInput()),t}}class dn extends tn{constructor(){super(),this.state=void 0}get(){return this.state}onRecohere(e){const t=this.input;null!==t&&(this.state=t.get())}memoize(){return this}}class pn extends on{constructor(){super(),this.state=void 0,this.cache=new Ut}has(e){return this.cache.has(e)}get(e){if(void 0===e){let e=this.state;const t=this.input;return void 0===e&&null!==t&&(e=t.get(),this.state=e),e}return this.cache.get(e)}keyIterator(){return this.cache.keys()}onRecohereKey(e,t,r){if(0===t){const t=this.input;if(null!==t){const r=t.get(e);this.cache=void 0!==r?this.cache.updated(e,r):this.cache.removed(e)}}else 1===t&&(this.cache=this.cache.removed(e))}onRecohere(e){this.state=void 0}memoize(){return this}}class fn extends un{has(e){const t=this.input;if(null!==t){const r=t.get(e);return void 0!==r&&this.evaluate(e,r)}return!1}get(e){if(void 0===e){const e=new Ut,t=this.keyIterator();for(;;){const r=t.next();if(r.done)break;{const t=r.value,i=this.input.get(t);void 0!==i&&this.evaluate(t,i)&&e.set(t,i)}}return e}{const t=this.input;if(null!==t){const r=t.get(e);if(void 0!==r&&this.evaluate(e,r))return r}return}}keyIterator(){const e=this.input;return null!==e?e.keyIterator():Z.empty()}onDecohereOutputKey(e,t){this.decohereInputKey(e,t)}onRecohereOutputKey(e,t,r){this.recohereInputKey(e,r)}willRecohereInputKey(e,t,r){if(0===t){const t=this.input;if(null!==t){const r=t.get(e);if(void 0===r||!this.evaluate(e,r))return 1}}return t}}class mn extends fn{constructor(e){super(),this.func=e}evaluate(e,t){return(0,this.func)(e,t)}}class yn extends tn{get(){const e=this.input;return null!==e?this.evaluate(e.get()):void 0}}class wn extends yn{constructor(e){super(),this.func=e}evaluate(e){if(void 0!==e){return(0,this.func)(e)}}}class gn extends on{has(e){const t=this.input;return null!==t&&t.has(e)}get(e){if(void 0===e){const e=new Ut,t=this.keyIterator();for(;;){const r=t.next();if(r.done)break;{const t=r.value,i=this.evaluate(t,this.input.get(t));void 0!==i&&e.set(t,i)}}return e}{const t=this.input;return null!==t?this.evaluate(e,t.get(e)):void 0}}keyIterator(){const e=this.input;return null!==e?e.keyIterator():Z.empty()}}class vn extends gn{constructor(e){super(),this.func=e}evaluate(e,t){if(void 0!==t){return(0,this.func)(e,t)}}}class bn extends an{constructor(){super(),this.state=new Ut}get(){return this.state.reduced(this.identity,this.accumulate.bind(this),this.combine.bind(this))}onRecohereOutputKey(e,t,r){if(0===t){const t=this.input;if(null!==t){const r=t.get(e);void 0!==r?this.state.set(e,r):this.state.delete(e)}}else 1===t&&this.state.delete(e)}}class xn extends bn{constructor(e,t,r){super(),this.identity=e,this.accumulator=t,this.combiner=r}get(){return this.state.reduced(this.identity,this.accumulator,this.combiner)}accumulate(e,t){return(0,this.accumulator)(e,t)}combine(e,t){return(0,this.combiner)(e,t)}}class Cn extends Ji{onRecohereOutput(e){const t=this.input;null!==t&&this.evaluate(t.get())}}class Sn extends Cn{constructor(e){super(),this.func=e}evaluate(e){if(void 0!==e){return(0,this.func)(e)}}}class On extends nn{onRecohereOutputKey(e,t,r){if(0===t){const t=this.input;null!==t?this.evaluate(e,t.get(e)):this.evaluate(e,void 0)}else 1===t&&this.evaluate(e,void 0)}}class En extends On{constructor(e){super(),this.func=e}evaluate(e,t){if(void 0!==t){return(0,this.func)(e,t)}}}class An extends Ji{constructor(e){super(),this.streamlet=e}willDecohereOutput(){const e=this.streamlet;void 0!==e.willDecohereInlet&&e.willDecohereInlet(this)}didDecohereOutput(){const e=this.streamlet;void 0!==e.didDecohereInlet?e.didDecohereInlet(this):e.decohere()}willRecohereOutput(e){const t=this.streamlet;void 0!==t.willRecohereInlet&&t.willRecohereInlet(this,e)}didRecohereOutput(e){const t=this.streamlet;void 0!==t.didRecohereInlet?t.didRecohereInlet(this,e):t.recohere(e)}}class kn extends en{constructor(e){super(),this.streamlet=e}get(){const e=this.streamlet;return void 0!==e.getOutput?e.getOutput(this):void 0}willDecohereInput(){const e=this.streamlet;void 0!==e.willDecohereOutlet&&e.willDecohereOutlet(this)}didDecohereInput(){const e=this.streamlet;void 0!==e.didDecohereOutlet?e.didDecohereOutlet(this):e.decohere()}willRecohereInput(e){const t=this.streamlet;void 0!==t.willRecohereOutlet&&t.willRecohereOutlet(this,e)}didRecohereInput(e){const t=this.streamlet;void 0!==t.didRecohereOutlet&&t.didRecohereOutlet(this,e)}}class Dn extends tn{constructor(e){super(),this.streamlet=e}get(){const e=this.streamlet;if(void 0!==e.getOutput){const t=e.getOutput(this);if(void 0!==t)return t}const t=this.input;return null!==t?t.get():void 0}willDecohere(){const e=this.streamlet;void 0!==e.willDecohereOutlet&&e.willDecohereOutlet(this)}didDecohere(){const e=this.streamlet;void 0!==e.didDecohereOutlet?e.didDecohereOutlet(this):e.decohere()}willRecohere(e){const t=this.streamlet;void 0!==t.willRecohereOutlet&&t.willRecohereOutlet(this,e)}didRecohere(e){const t=this.streamlet;void 0!==t.didRecohereOutlet&&t.didRecohereOutlet(this,e)}}class Pn{constructor(e,t,r){this.key=e,this.name=t,this.type=r}}class Tn{constructor(e,t,r){this.key=e,this.name=t,this.type=r}}class In{constructor(e,t,r){this.key=e,this.name=t,this.type=r}}class Mn{constructor(e=null){this.streamletScope=e,this.streamletContext=null,this.version=-1}setStreamletScope(e){this.streamletScope=e}setStreamletContext(e){this.streamletContext=e}inlet(e){return void 0===e?new An(this):Mn.reflectInletKey(e,this,Object.getPrototypeOf(this))}bindInput(e,t){const r=this.inlet(e);if(null===r)throw new Error(""+e);r.bindInput(t)}unbindInput(e){const t=this.inlet(e);if(null===t)throw new Error(""+e);t.unbindInput()}outlet(e){return void 0===e?new kn(this):"string"==typeof e?Mn.reflectOutletKey(e,this,Object.getPrototypeOf(this)):e}inoutlet(){return new Dn(this)}decohere(){this.version>=0&&(this.willDecohere(),this.version=-1,this.onDecohere(),this.onDecohereOutlets(),this.didDecohere())}recohere(e){this.version<0&&(this.willRecohere(e),this.version=e,this.onRecohereInlets(e),this.onRecohere(e),this.onRecohereOutlets(e),this.didRecohere(e))}getInput(e,t){let r;if("string"==typeof e&&(e=this.inlet(e)),null!==e){const t=e.input;null!==t&&(r=t.get())}return void 0===r&&(r=t),r}getOutput(e){}disconnectInputs(){Mn.disconnectInputs(this,Object.getPrototypeOf(this))}static disconnectInputs(e,t){for(;null!==t;){if(Object.prototype.hasOwnProperty.call(t,"inlets"))for(const r in t.inlets){const i=t.inlets[r];if(i instanceof Pn){Mn.reflectInletField(e,i).disconnectInputs()}else if(i instanceof In){Mn.reflectInoutletField(e,i).disconnectInputs()}}t=Object.getPrototypeOf(t)}}disconnectOutputs(){Mn.disconnectOutputs(this,Object.getPrototypeOf(this))}static disconnectOutputs(e,t){for(;null!==t;){if(Object.prototype.hasOwnProperty.call(t,"outlets"))for(const r in t.outlets){const i=t.outlets[r];if(i instanceof Tn){Mn.reflectOutletField(e,i).disconnectOutputs()}else if(i instanceof In){Mn.reflectInoutletField(e,i).disconnectOutputs()}}t=Object.getPrototypeOf(t)}}willDecohereInlet(e){}didDecohereInlet(e){this.decohere()}willRecohereInlet(e,t){}didRecohereInlet(e,t){this.recohere(t)}willDecohereOutlet(e){}didDecohereOutlet(e){}willRecohereOutlet(e,t){}didRecohereOutlet(e,t){}willDecohere(){}onDecohere(){}onDecohereOutlets(){Mn.decohereOutlets(this,Object.getPrototypeOf(this))}static decohereOutlets(e,t){for(;null!==t;){if(Object.prototype.hasOwnProperty.call(t,"outlets"))for(const r in t.outlets){const i=t.outlets[r];if(i instanceof Tn){Mn.reflectOutletField(e,i).decohereInput()}else if(i instanceof In){Mn.reflectInoutletField(e,i).decohereInput()}}t=Object.getPrototypeOf(t)}}didDecohere(){}willRecohere(e){}onRecohereInlets(e){Mn.recohereInlets(e,this,Object.getPrototypeOf(this))}static recohereInlets(e,t,r){for(;null!==r;){if(Object.prototype.hasOwnProperty.call(r,"inlets"))for(const i in r.inlets){const n=r.inlets[i];if(n instanceof Pn){Mn.reflectInletField(t,n).recohereOutput(e)}else if(n instanceof In){Mn.reflectInoutletField(t,n).recohereOutput(e)}}r=Object.getPrototypeOf(r)}}onRecohere(e){}onRecohereOutlets(e){Mn.recohereOutlets(e,this,Object.getPrototypeOf(this))}static recohereOutlets(e,t,r){for(;null!==r;){if(Object.prototype.hasOwnProperty.call(r,"outlets"))for(const i in r.outlets){const n=r.outlets[i];if(n instanceof Tn){Mn.reflectOutletField(t,n).recohereInput(e)}else if(n instanceof In){Mn.reflectInoutletField(t,n).recohereInput(e)}}r=Object.getPrototypeOf(r)}}didRecohere(e){}static reflectEachInlet(e,t,r,i){let n=0;for(;null!==t;){if(Object.prototype.hasOwnProperty.call(t,"inlets"))for(const s in t.inlets){const o=t.inlets[s];let a;if(a=o instanceof Pn?Mn.reflectInletField(e,o):o instanceof In?Mn.reflectInoutletField(e,o):null,null!==a){const e=r.call(i,a,o.name,n);if(void 0!==e)return e;n+=1}}t=Object.getPrototypeOf(t)}}static reflectEachOutlet(e,t,r,i){let n=0;for(;null!==t;){if(Object.prototype.hasOwnProperty.call(t,"outlets"))for(const s in t.outlets){const o=t.outlets[s];let a;if(a=o instanceof Tn?Mn.reflectOutletField(e,o):o instanceof In?Mn.reflectInoutletField(e,o):null,null!==a){const e=r.call(i,a,o.name,n);if(void 0!==e)return e;n+=1}}t=Object.getPrototypeOf(t)}}static reflectInletCount(e){let t=0;for(;null!==e;){if(Object.prototype.hasOwnProperty.call(e,"inlets"))for(const r in e.inlets)t+=1;e=Object.getPrototypeOf(e)}return t}static reflectOutletCount(e){let t=0;for(;null!==e;){if(Object.prototype.hasOwnProperty.call(e,"outlets"))for(const r in e.outlets)t+=1;e=Object.getPrototypeOf(e)}return t}static reflectInletIndex(e,t,r){for(;null!==r;){if(Object.prototype.hasOwnProperty.call(r,"inlets"))for(const i in r.inlets){if(0===e){const e=r.inlets[i];return e instanceof Pn?[e.name,Mn.reflectInletField(t,e)]:e instanceof In?[e.name,Mn.reflectInoutletField(t,e)]:null}e-=1}r=Object.getPrototypeOf(r)}return null}static reflectOutletIndex(e,t,r){for(;null!==r;){if(Object.prototype.hasOwnProperty.call(r,"outlets"))for(const i in r.outlets){if(0===e){const e=r.outlets[i];return e instanceof Tn?[e.name,Mn.reflectOutletField(t,e)]:e instanceof In?[e.name,Mn.reflectInoutletField(t,e)]:null}e-=1}r=Object.getPrototypeOf(r)}return null}static reflectInletKey(e,t,r){for(;null!==r;){if(Object.prototype.hasOwnProperty.call(r,"inlets")){const i=r.inlets[e];if(void 0!==i)return i instanceof Pn?Mn.reflectInletField(t,i):i instanceof In?Mn.reflectInoutletField(t,i):null}r=Object.getPrototypeOf(r)}return null}static reflectOutletKey(e,t,r){for(;null!==r;){if(Object.prototype.hasOwnProperty.call(r,"outlets")){const i=r.outlets[e];if(void 0!==i)return i instanceof Tn?Mn.reflectOutletField(t,i):i instanceof In?Mn.reflectInoutletField(t,i):null}r=Object.getPrototypeOf(r)}return null}static reflectInletField(e,t){if("value"===t.type)return Mn.reflectValueInletField(e,t.key);if("map"===t.type)return Mn.reflectMapInletField(e,t.key);throw new TypeError(t.type)}static reflectValueInletField(e,t){let r=e[t];return void 0===r&&(r=e instanceof Mn?e.inlet():new An(e),e[t]=r),r}static reflectMapInletField(e,t){return null}static reflectOutletField(e,t){if("value"===t.type)return Mn.reflectValueOutletField(e,t.key);if("map"===t.type)return Mn.reflectMapOutletField(e,t.key);throw new TypeError(t.type)}static reflectValueOutletField(e,t){let r=e[t];return void 0===r&&(r=e instanceof Mn?e.outlet():new kn(e),e[t]=r),r}static reflectMapOutletField(e,t){return null}static reflectInoutletField(e,t){if("value"===t.type)return Mn.reflectValueInoutletField(e,t.key);if("map"===t.type)return Mn.reflectMapInoutletField(e,t.key);throw new TypeError(t.type)}static reflectValueInoutletField(e,t){let r=e[t];return void 0===r&&(r=e instanceof Mn?e.inoutlet():new Dn(e),e[t]=r),r}static reflectMapInoutletField(e,t){return null}static init(e){Object.prototype.hasOwnProperty.call(e,"inlets")||(e.inlets={}),Object.prototype.hasOwnProperty.call(e,"outlets")||(e.outlets={}),Object.prototype.hasOwnProperty.call(e,"inoutlets")||(e.inoutlets={})}static decorateInlet(e,t,r){Mn.init(t);const i=void 0!==e.name?e.name:r.toString(),n=void 0!==e.type?e.type:"value",s=new Pn(r.toString(),i,n);t.inlets[i]=s}static decorateOutlet(e,t,r){Mn.init(t);const i=void 0!==e.name?e.name:r.toString(),n=void 0!==e.type?e.type:"value",s=new Tn(r.toString(),i,n);t.outlets[i]=s}static decorateInoutlet(e,t,r){Mn.init(t);const i=void 0!==e.name?e.name:r.toString(),n=void 0!==e.type?e.type:"value",s=new In(r.toString(),i,n);t.inlets[i]=s,t.outlets[i]=s,t.inoutlets[i]=s}}function Vn(e,t){if(1===arguments.length)return"string"==typeof e&&(e={name:e}),Mn.decorateOutlet.bind(void 0,e);Mn.decorateOutlet({},e,t)}function qn(e,t){if(1===arguments.length)return"string"==typeof e&&(e={name:e}),Mn.decorateInoutlet.bind(void 0,e);Mn.decorateInoutlet({},e,t)}const Fn=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return Gi.is(t)&&Qi.is(t)}return!1}};return e}();class Nn extends Cr{constructor(){super(),this.effects=new Ut,this.outlets=new Ut,this.outputs=x.empty,this.version=-1}get streamletContext(){const e=this.streamletScope;return null!==e?e.streamletContext:null}hasOwn(e){return this.has(e)}get(e){return void 0===e?this:super.get(e)}outlet(e){if("string"==typeof e&&(e=Tr.from(e)),!this.hasOwn(e)){const t=this.streamletScope;if(Fn.is(t)&&t.has(e))return t.outlet(e)}const t=this.outlets;let r=t.get(e);return void 0===r&&(r=new rn(this,e),this.outlets=t.updated(e,r),this.decohereInputKey(e,0)),r}outputIterator(){return Z.array(this.outputs)}bindOutput(e){this.outputs=x.inserted(e,this.outputs)}unbindOutput(e){this.outputs=x.removed(e,this.outputs)}unbindOutputs(){const e=this.outlets;e.isEmpty()&&(this.outlets=new Ut,e.forEach((function(e,t){t.unbindOutputs()}),this));const t=this.outputs;this.outputs=x.empty;for(let e=0,r=t.length;e<r;e+=1){t[e].unbindInput()}}disconnectOutputs(){const e=this.outlets;e.isEmpty()&&(this.outlets=new Ut,e.forEach((function(e,t){t.disconnectOutputs()}),this));const t=this.outputs;this.outputs=x.empty;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];r.unbindInput(),r.disconnectOutputs()}this.forEach((function(e){e instanceof mr&&(e=e.toValue()),(e instanceof Nn||e instanceof zn||Fn.is(e))&&e.disconnectOutputs()}),this)}disconnectInputs(){}decohereInputKey(e,t){const r=this.effects;if(r.get(e)!==t){this.willDecohereInputKey(e,t),this.effects=r.updated(e,t),this.version=-1,this.onDecohereInputKey(e,t);const i=this.outputs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];_i.is(n)?n.decohereOutputKey(e,t):n.decohereOutput()}const n=this.outlets.get(e);void 0!==n&&n.decohereInput(),this.didDecohereInputKey(e,t)}}decohereInput(){if(this.version>=0){this.willDecohereInput(),this.version=-1,this.onDecohereInput();const e=this.outputs;for(let t=0,r=e.length;t<r;t+=1){e[t].decohereOutput()}this.outlets.forEach((function(e,t){t.decohereInput()}),this),this.didDecohereInput()}}recohereInputKey(e,t){if(this.version<0){const r=this.effects,i=r.get(e);if(void 0!==i){this.willRecohereInputKey(e,i,t),this.effects=r.removed(e),this.onRecohereInputKey(e,i,t);const n=this.outputs;for(let r=0,i=n.length;r<i;r+=1){const i=n[r];_i.is(i)&&i.recohereOutputKey(e,t)}const s=this.outlets.get(e);void 0!==s&&s.recohereInput(t),this.didRecohereInputKey(e,i,t)}}}recohereInput(e){if(this.version<0){this.willRecohereInput(e),this.effects.forEach((function(t){this.recohereInputKey(t,e)}),this),this.version=e,this.onRecohereInput(e);const t=this.outputs;for(let r=0,i=t.length;r<i;r+=1){t[r].recohereOutput(e)}this.forEach((function(t){t instanceof mr&&(t=t.toValue()),t instanceof Nn?t.recohereInput(e):t instanceof zn?t.recohere(e):Fn.is(t)&&t.recohereInput(e)}),this),this.didRecohereInput(e)}}willDecohereInputKey(e,t){}onDecohereInputKey(e,t){}didDecohereInputKey(e,t){}willDecohereInput(){}onDecohereInput(){}didDecohereInput(){}willRecohereInputKey(e,t,r){}onRecohereInputKey(e,t,r){}didRecohereInputKey(e,t,r){}willRecohereInput(e){}onRecohereInput(e){}didRecohereInput(e){}filter(e){if("function"!=typeof e)return super.filter(e);{const t=new mn(e);return t.bindInput(this),t}}}Object.defineProperty(Nn.prototype,"streamletScope",{get:()=>null,configurable:!0}),Yi.define(Nn.prototype);class zn extends Cr{isConstant(){return!1}compile(){Mn.reflectEachInlet(this,Object.getPrototypeOf(this),(function(e,t){null===e.input&&this.compileInlet(e,t)}),this)}compileInlet(e,t){const r=this.streamletScope;if(null!==r){const i=r.outlet(t);null!==i&&e.bindInput(i)}}}class Un extends zn{constructor(e=null){super(),this.streamletScope=e,this.streamletContext=null,this.version=-1}setStreamletScope(e){this.streamletScope=e}setStreamletContext(e){this.streamletContext=e}isEmpty(){return 0!==this.length}get length(){return Mn.reflectOutletCount(Object.getPrototypeOf(this))}has(e){if(e instanceof Tr)e=e.value;else if("string"!=typeof e)return!1;return null!==this.outlet(e)}get(e){if(e instanceof Tr)e=e.value;else if("string"!=typeof e)return xr.absent();const t=this.outlet(e);if(null!==t){const e=t.get();if(void 0!==e)return e}return xr.absent()}getAttr(e){return xr.absent()}getSlot(e){return this.get(e)}getField(e){if("string"==typeof e)e=Tr.from(e);else if(!(e instanceof Tr))return;const t=this.get(e);if(t.isDefined())return yr.of(e,t)}getItem(e){e instanceof Mr&&(e=e.value);const t=Mn.reflectOutletIndex(e,this,Object.getPrototypeOf(this));if(null!==t){const e=t[0];let r=t[1].get();return void 0===r&&(r=xr.extant()),yr.of(e,r)}return pr.absent()}set(e,t){throw new Error("unsupported")}setAttr(e,t){throw new Error("unsupported")}setSlot(e,t){throw new Error("unsupported")}setItem(e,t){throw new Error("unsupported")}push(...e){throw new Error("unsupported")}splice(e,t,...r){throw new Error("unsupported")}delete(e){throw new Error("unsupported")}clear(){throw new Error("unsupported")}forEach(e,t){return Mn.reflectEachOutlet(this,Object.getPrototypeOf(this),(function(r,i,n){const s=r.get();if(void 0!==s){const r=e.call(t,s,n);if(void 0!==r)return r}}),this)}inlet(e){return void 0===e?new An(this):Mn.reflectInletKey(e,this,Object.getPrototypeOf(this))}bindInput(e,t){const r=this.inlet(e);if(null===r)throw new Error(e);r.bindInput(t)}unbindInput(e){const t=this.inlet(e);if(null===t)throw new Error(e);t.unbindInput()}outlet(e){return void 0===e?new kn(this):"string"==typeof e?Mn.reflectOutletKey(e,this,Object.getPrototypeOf(this)):e}inoutlet(){return new Dn(this)}decohere(){this.version>=0&&(this.willDecohere(),this.version=-1,this.onDecohere(),this.onDecohereOutlets(),this.didDecohere())}recohere(e){this.version<0&&(this.willRecohere(e),this.version=e,this.onRecohereInlets(e),this.onRecohere(e),this.onRecohereOutlets(e),this.didRecohere(e))}getInput(e,t){let r;if("string"==typeof e&&(e=this.inlet(e)),null!==e){const t=e.input;null!==t&&(r=t.get())}return void 0===r&&(r=t),r}castInput(e,t,r){const i=this.getInput(e);let n;return void 0!==i&&(n=t.cast(i)),void 0===n&&(n=r),n}coerceInput(e,t,r){const i=this.getInput(e);let n;return void 0!==i&&(n=t.cast(i)),void 0===n&&(n=t.unit),void 0===n&&(n=r),n}getOutput(e){}disconnectInputs(){Mn.disconnectInputs(this,Object.getPrototypeOf(this))}disconnectOutputs(){Mn.disconnectOutputs(this,Object.getPrototypeOf(this))}willDecohereInlet(e){}didDecohereInlet(e){this.decohere()}willRecohereInlet(e,t){}didRecohereInlet(e,t){this.recohere(t)}willDecohereOutlet(e){}didDecohereOutlet(e){}willRecohereOutlet(e,t){}didRecohereOutlet(e,t){}willDecohere(){}onDecohere(){}didDecohere(){}onDecohereOutlets(){Mn.decohereOutlets(this,Object.getPrototypeOf(this))}willRecohere(e){}onRecohereInlets(e){Mn.recohereInlets(e,this,Object.getPrototypeOf(this))}onRecohere(e){}onRecohereOutlets(e){Mn.recohereOutlets(e,this,Object.getPrototypeOf(this))}didRecohere(e){}}class Rn extends Ji{constructor(e,t){super(),this.record=e,this.key=t}onDecohereOutput(){const e=this.record;Fn.is(e)&&e.decohereInputKey(this.key,0)}onRecohereOutput(e){const t=this.input;if(null!==t){const e=t.get();void 0!==e?this.record.set(this.key,e):this.record.delete(this.key)}}}class jn extends Nn{constructor(e){super(),void 0===e&&(e=Cr.create()),this.state=e,this.fieldUpdaters=new Ut}isEmpty(){return this.state.isEmpty()}isArray(){return this.state.isArray()}isObject(){return this.state.isObject()}get length(){return this.state.length}get valueCount(){return this.state.valueCount}has(e){if(this.state.has(e))return!0;{const t=this.streamletScope;return t instanceof Cr&&t.has(e)}}hasOwn(e){return this.state.has(e)}indexOf(e,t){return this.state.indexOf(e,t)}lastIndexOf(e,t=0){return this.state.lastIndexOf(e,t)}get(e){if(void 0===e)return this;{e=xr.fromAny(e);let t=this.state.get(e);if(!t.isDefined()){const r=this.streamletScope;r instanceof Cr&&(t=r.get(e))}return t}}getAttr(e){e=Tr.fromAny(e);let t=this.state.getAttr(e);if(!t.isDefined()){const r=this.streamletScope;r instanceof Cr&&(t=r.getAttr(e))}return t}getSlot(e){e=xr.fromAny(e);let t=this.state.getSlot(e);if(!t.isDefined()){const r=this.streamletScope;r instanceof Cr&&(t=r.getSlot(e))}return t}getField(e){e=xr.fromAny(e);let t=this.state.getField(e);if(void 0===t){const r=this.streamletScope;r instanceof Cr&&(t=r.getField(e))}return t}getItem(e){return this.state.getItem(e)}bindValue(e,t){const r=new Rn(this,e),i=fs.compile(t,this);r.bindInput(i),this.fieldUpdaters=this.fieldUpdaters.updated(e,r)}set(e,t){if(e=xr.fromAny(e),this.state.has(e))this.state.set(e,t);else{const r=this.streamletScope;r instanceof Cr&&r.has(e)?r.set(e,t):this.state.set(e,t)}return this.decohereInputKey(e,0),this}setAttr(e,t){if(e=Tr.fromAny(e),this.state.has(e))this.state.setAttr(e,t);else{const r=this.streamletScope;r instanceof Cr&&r.has(e)?r.setAttr(e,t):this.state.setAttr(e,t)}return this.decohereInputKey(e,0),this}setSlot(e,t){if(e=xr.fromAny(e),this.state.has(e))this.state.setSlot(e,t);else{const r=this.streamletScope;r instanceof Cr&&r.has(e)?r.setSlot(e,t):this.state.setSlot(e,t)}return this.decohereInputKey(e,0),this}setItem(e,t){const r=this.state.getItem(e);return t=pr.fromAny(t),this.state.setItem(e,t),r instanceof mr&&t instanceof mr?r.key.equals(t.key)?this.decohereInputKey(r.key,0):(this.decohereInputKey(r.key,1),this.decohereInputKey(t.key,0)):r instanceof mr?this.decohereInputKey(r.key,1):t instanceof mr?this.decohereInputKey(t.key,0):this.decohereInput(),this}push(...e){let t=this.state.length;const r=this.state.push(...e);for(;t<r;){const e=this.state.get(t);e instanceof mr&&this.decohereInputKey(e.key,0),t+=1}return r}splice(e,t=0,...r){const i=this.state.length;e<0&&(e=i+e),e=Math.max(0,e),t=Math.max(0,t);const n=this.state.splice(e,t,...r);for(let e=0;e<n.length;e+=1){const t=n[e];t instanceof mr&&this.decohereInputKey(t.key,1)}for(let t=e;t<e+r.length;t+=1){const e=this.state.get(t);e instanceof mr&&this.decohereInputKey(e.key,0)}return n}delete(e){const t=this.state.delete(e);return t instanceof mr&&this.decohereInputKey(t.key,1),t}clear(){const e=this.state.branch();this.state.clear(),e.forEach((function(e){e instanceof mr&&this.decohereInputKey(e.key,1)}),this)}forEach(e,t){return this.state.forEach(e,t)}keyIterator(){throw new Error}disconnectInputs(){const e=this.fieldUpdaters;e.isEmpty()||(this.fieldUpdaters=new Ut,e.forEach((function(e,t){t.disconnectInputs()}),this))}memoize(){return this}materialize(e){e.forEach((function(e){this.materializeItem(e)}),this)}materializeItem(e){e instanceof mr?this.materializeField(e):this.materializeValue(e)}materializeField(e){const t=e.value;if(t instanceof zn)t.setStreamletScope(this),this.state.push(e);else if(t instanceof Cr){const r=new Ln(this);r.materialize(t),this.state.push(e.updatedValue(r))}else this.state.push(e)}materializeValue(e){if(e instanceof zn)e.setStreamletScope(this),this.state.push(e);else if(e instanceof Cr){const t=new Ln(this);t.materialize(e),this.state.push(t)}else this.state.push(e)}compile(e){e.forEach((function(e,t){this.compileItem(e,t)}),this)}compileItem(e,t){e instanceof mr?this.compileField(e,t):this.compileValue(e,t)}compileField(e,t){const r=e.key,i=e.value;r.isConstant()&&(i.isConstant()?this.decohereInputKey(r,0):i instanceof zn?(i.compile(),this.decohereInputKey(r,0)):i instanceof Cr?(this.state.getItem(t).toValue().compile(i),this.decohereInputKey(r,0)):(e.setValue(xr.extant()),this.bindValue(r,i)))}compileValue(e,t){e instanceof zn?e.compile():e instanceof Cr?this.state.getItem(t).compile(e):e.isConstant()}reify(e=Bn.system()){this.forEach((function(t,r){const i=this.reifyItem(t,e);t!==i&&this.setItem(r,i)}),this)}reifyItem(e,t){null!==t&&(e=t.reify(e));const r=this.streamletScope;return r instanceof jn?r.reifyItem(e,t):e}static from(e){const t=new jn;return t.materialize(e),t.compile(e),t}static of(...e){return jn.from(Cr.of(...e))}static globalScope(){const e=new jn;return e.materializeField(yr.of("math",Ti.scope.branch())),e}}Object.defineProperty(jn.prototype,"fieldCount",{get(){return this.state.fieldCount},configurable:!0});class Ln extends jn{constructor(e,t){super(t),Object.defineProperty(this,"streamletScope",{value:e,writable:!0,enumerable:!0,configurable:!0})}static from(e){const t=new Ln(Ln.globalScope());return t.materialize(e),t.compile(e),t}static of(...e){return Ln.from(Cr.of(...e))}}class Bn{static system(){return null}}class Kn extends en{constructor(){super(),this.keyInlet=new hn(this),this.mapInlet=new ln(this)}get(){const e=this.keyInlet.input;if(null!==e){const t=e.get();if(void 0!==t){const e=this.mapInlet.input;if(null!==e){const r=e.get(t);if(void 0!==r)return r}}}return xr.absent()}}class Wn extends en{constructor(){super(),this.operand1Inlet=new hn(this),this.operand2Inlet=new hn(this)}get(){const e=this.operand1Inlet.input,t=this.operand2Inlet.input;if(null!==e&&null!==t){const r=e.get(),i=t.get();if(void 0!==r&&void 0!==i){return this.evaluate(r,i).toValue()}}return xr.absent()}}class Hn extends en{constructor(){super(),this.operandInlet=new hn(this)}get(){const e=this.operandInlet.input;if(null!==e){const t=e.get();if(void 0!==t){return this.evaluate(t).toValue()}}return xr.absent()}}class Xn extends en{constructor(){super(),this.ifInlet=new hn(this),this.thenInlet=new hn(this),this.elseInlet=new hn(this)}get(){const e=this.ifInlet.input;if(null!==e){const t=e.get();if(void 0!==t)if(t.isDefinite()){const e=this.thenInlet.input;if(null!==e){const t=e.get();if(void 0!==t)return t}}else{const e=this.elseInlet.input;if(null!==e){const t=e.get();if(void 0!==t)return t}}}return xr.absent()}}class _n extends en{constructor(){super(),this.operand1Inlet=new hn(this),this.operand2Inlet=new hn(this)}get(){const e=this.operand1Inlet.input,t=null!==e?e.get():void 0;if(void 0!==t&&t.isDefinite())return t;const r=this.operand2Inlet.input,i=null!==r?r.get():void 0;return void 0!==i?i:xr.absent()}}class Gn extends en{constructor(){super(),this.operand1Inlet=new hn(this),this.operand2Inlet=new hn(this)}get(){const e=this.operand1Inlet.input,t=null!==e?e.get():void 0;if(void 0!==t){if(t.isDefinite()){const e=this.operand2Inlet.input,t=null!==e?e.get():void 0;if(void 0!==t)return t}return t}return xr.absent()}}class Yn extends Wn{evaluate(e,t){return e.bitwiseOr(t)}}class Zn extends Wn{evaluate(e,t){return e.bitwiseXor(t)}}class Qn extends Wn{evaluate(e,t){return e.bitwiseAnd(t)}}class $n extends Wn{evaluate(e,t){return e.lt(t)}}class Jn extends Wn{evaluate(e,t){return e.le(t)}}class es extends Wn{evaluate(e,t){return e.eq(t)}}class ts extends Wn{evaluate(e,t){return e.ne(t)}}class rs extends Wn{evaluate(e,t){return e.ge(t)}}class is extends Wn{evaluate(e,t){return e.gt(t)}}class ns extends Wn{evaluate(e,t){return e.plus(t)}}class ss extends Wn{evaluate(e,t){return e.minus(t)}}class os extends Wn{evaluate(e,t){return e.times(t)}}class as extends Wn{evaluate(e,t){return e.divide(t)}}class us extends Wn{evaluate(e,t){return e.modulo(t)}}class hs extends Hn{evaluate(e){return e.not()}}class ls extends Hn{evaluate(e){return e.bitwiseNot()}}class cs extends Hn{evaluate(e){return e.negative()}}class ds extends Hn{evaluate(e){return e.positive()}}class ps extends en{constructor(e){super(),this.scope=e,this.funcInlet=new hn(this),this.argsInlet=new hn(this)}get(){const e=this.funcInlet.input,t=this.argsInlet.input;if(null!==e&&null!==t){const r=e.get();if(r instanceof ki){const e=t.get();if(void 0!==e){const t=new _r;t.pushScope(this.scope);return r.invoke(e,t,void 0).toValue()}}}return xr.absent()}}const fs=function(){const e={compile:function(t,r){if(r instanceof rn){const e=r.get();Wi.is(e)&&(r=e)}if(t.isConstant())return new cn(t);if(t instanceof yi)return e.compileSelector(t,r);if(t instanceof Ur)return e.compileOperator(t,r);throw new TypeError(""+t)},compileSelector:function(t,r){if(t instanceof wi)return e.compileIdentitySelector(r);if(t instanceof gi)return e.compileGetSelector(t,r);if(t instanceof vi)return e.compileGetAttrSelector(t,r);if(t instanceof bi)return e.compileGetItemSelector(t,r);if(t instanceof xi)return e.compileKeysSelector(r);if(t instanceof Ci)return e.compileValuesSelector(r);if(t instanceof Si)return e.compileChildrenSelector(r);if(t instanceof Oi)return e.compileDescendantsSelector(r);if(t instanceof Ei)return e.compileFilterSelector(t,r);throw new TypeError(""+t)},compileIdentitySelector:function(e){return e},compileGetSelector:function(t,r){const i=t.item;if(!i.isConstant()){const t=new Kn,n=e.compile(i,r);return t.keyInlet.bindInput(n),t.mapInlet.bindInput(r),t}if(Fn.is(r)){const n=r.outlet(i);if(null!==n)return e.compile(t.then,n)}else if(Qi.is(r)){const n=i.stringValue(void 0);if(void 0!==n){const i=r.outlet(n);if(null!==i)return e.compile(t.then,i)}}return null},compileGetAttrSelector:function(e,t){throw new Error},compileGetItemSelector:function(e,t){throw new Error},compileKeysSelector:function(e){throw new Error},compileValuesSelector:function(e){throw new Error},compileChildrenSelector:function(e){throw new Error},compileDescendantsSelector:function(e){throw new Error},compileFilterSelector:function(e,t){throw new Error},compileOperator:function(t,r){if(t instanceof Kr)return e.compileConditionalOperator(t,r);if(t instanceof Rr)return e.compileBinaryOperator(t,r);if(t instanceof Lr)return e.compileUnaryOperator(t,r);if(t instanceof fi)return e.compileInvokeOperator(t,r);throw new TypeError(""+t)},compileConditionalOperator:function(t,r){const i=new Xn,n=t.ifTerm.toValue(),s=t.thenTerm.toValue(),o=t.elseTerm.toValue(),a=e.compile(n,r),u=e.compile(s,r),h=e.compile(o,r);return i.ifInlet.bindInput(a),i.thenInlet.bindInput(u),i.elseInlet.bindInput(h),i},compileBinaryOperator:function(t,r){if(t instanceof Gr)return e.compileOrOperator(t,r);if(t instanceof Yr)return e.compileAndOperator(t,r);if(t instanceof Zr)return e.compileBitwiseOrOperator(t,r);if(t instanceof Qr)return e.compileBitwiseXorOperator(t,r);if(t instanceof $r)return e.compileBitwiseAndOperator(t,r);if(t instanceof Jr)return e.compileLtOperator(t,r);if(t instanceof ei)return e.compileLeOperator(t,r);if(t instanceof ti)return e.compileEqOperator(t,r);if(t instanceof ri)return e.compileNeOperator(t,r);if(t instanceof ii)return e.compileGeOperator(t,r);if(t instanceof ni)return e.compileGtOperator(t,r);if(t instanceof si)return e.compilePlusOperator(t,r);if(t instanceof oi)return e.compileMinusOperator(t,r);if(t instanceof ai)return e.compileTimesOperator(t,r);if(t instanceof ui)return e.compileDivideOperator(t,r);if(t instanceof hi)return e.compileModuloOperator(t,r);throw new TypeError(""+t)},compileBinaryOutlet:function(t,r,i){const n=t.operand1.toValue(),s=t.operand2.toValue(),o=e.compile(n,i),a=e.compile(s,i);return r.operand1Inlet.bindInput(o),r.operand2Inlet.bindInput(a),r},compileOrOperator:function(t,r){const i=new _n,n=t.operand1.toValue(),s=t.operand2.toValue(),o=e.compile(n,r),a=e.compile(s,r);return i.operand1Inlet.bindInput(o),i.operand2Inlet.bindInput(a),i},compileAndOperator:function(t,r){const i=new Gn,n=t.operand1.toValue(),s=t.operand2.toValue(),o=e.compile(n,r),a=e.compile(s,r);return i.operand1Inlet.bindInput(o),i.operand2Inlet.bindInput(a),i},compileBitwiseOrOperator:function(t,r){return e.compileBinaryOutlet(t,new Yn,r)},compileBitwiseXorOperator:function(t,r){return e.compileBinaryOutlet(t,new Zn,r)},compileBitwiseAndOperator:function(t,r){return e.compileBinaryOutlet(t,new Qn,r)},compileLtOperator:function(t,r){return e.compileBinaryOutlet(t,new $n,r)},compileLeOperator:function(t,r){return e.compileBinaryOutlet(t,new Jn,r)},compileEqOperator:function(t,r){return e.compileBinaryOutlet(t,new es,r)},compileNeOperator:function(t,r){return e.compileBinaryOutlet(t,new ts,r)},compileGeOperator:function(t,r){return e.compileBinaryOutlet(t,new rs,r)},compileGtOperator:function(t,r){return e.compileBinaryOutlet(t,new is,r)},compilePlusOperator:function(t,r){return e.compileBinaryOutlet(t,new ns,r)},compileMinusOperator:function(t,r){return e.compileBinaryOutlet(t,new ss,r)},compileTimesOperator:function(t,r){return e.compileBinaryOutlet(t,new os,r)},compileDivideOperator:function(t,r){return e.compileBinaryOutlet(t,new as,r)},compileModuloOperator:function(t,r){return e.compileBinaryOutlet(t,new us,r)},compileUnaryOperator:function(t,r){if(t instanceof li)return e.compileNotOperator(t,r);if(t instanceof ci)return e.compileBitwiseNotOperator(t,r);if(t instanceof di)return e.compileNegativeOperator(t,r);if(t instanceof pi)return e.compilePositiveOperator(t,r);throw new TypeError(""+t)},compileUnaryOutlet:function(t,r,i){const n=t.operand.toValue(),s=e.compile(n,i);return r.operandInlet.bindInput(s),r},compileNotOperator:function(t,r){return e.compileUnaryOutlet(t,new hs,r)},compileBitwiseNotOperator:function(t,r){return e.compileUnaryOutlet(t,new ls,r)},compileNegativeOperator:function(t,r){return e.compileUnaryOutlet(t,new cs,r)},compilePositiveOperator:function(t,r){return e.compileUnaryOutlet(t,new ds,r)},compileInvokeOperator:function(t,r){const i=t.func,n=t.args,s=new ps(r),o=e.compile(i,r),a=e.compile(n,r);return s.funcInlet.bindInput(o),s.argsInlet.bindInput(a),s}};return e}(),ms=function(){const e={};return Object.defineProperty(e,"structureParser",{value:function(){const t=new Xs;return Object.defineProperty(e,"structureParser",{value:function(){return t},enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"structureWriter",{value:function(){const t=new wo;return Object.defineProperty(e,"structureWriter",{value:function(){return t},enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),e.parse=function(t){return e.structureParser().parseBlockString(t)},e.parser=function(){return e.structureParser().blockParser()},e.sizeOf=function(t){return e.structureWriter().sizeOfItem(t)},e.sizeOfBlock=function(t){return e.structureWriter().sizeOfBlockItem(t)},e.write=function(t,r){return e.structureWriter().writeItem(t,r)},e.writeBlock=function(t,r){return e.structureWriter().writeBlockItem(t,r)},e.toString=function(t){let r=Se.stringOutput();const i=e.write(r,t);return i.isDone()||(r=ge.error(i.trap())),r.bind()},e.toBlockString=function(t){let r=Se.stringOutput();const i=e.writeBlock(r,t);return i.isDone()||(r=ge.error(i.trap())),r.bind()},e.toData=function(t){let r=nt.encodedOutput(Dr.output());const i=e.write(r,t);return i.isDone()||(r=ge.error(i.trap())),r.bind()},e.toBlockData=function(t){let r=nt.encodedOutput(Dr.output());const i=e.writeBlock(r,t);return i.isDone()||(r=ge.error(i.trap())),r.bind()},e.isSpace=function(e){return 32===e||9===e},e.isNewline=function(e){return 10===e||13===e},e.isWhitespace=function(t){return e.isSpace(t)||e.isNewline(t)},e.isIdentStartChar=function(e){return e>=65&&e<=90||95===e||e>=97&&e<=122||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=767||e>=880&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039},e.isIdentChar=function(e){return 45===e||e>=48&&e<=57||e>=65&&e<=90||95===e||e>=97&&e<=122||183===e||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8255&&e<=8256||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039},pr.prototype.toRecon=function(){return e.toString(this)},pr.prototype.toReconBlock=function(){return e.toBlockString(this)},e}();xr.parseRecon=function(e){return ms.parse(e)};class ys extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.keyParser=r,this.valueParser=i,this.step=n}feed(e){return ys.parse(e,this.recon,this.builder,this.keyParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;e:for(;;){if(1===s){for(;e.isCont()&&(o=e.head(),ms.isWhitespace(o));)e=e.step();if(e.isCont())if(33===o||34===o||36===o||37===o||39===o||40===o||43===o||45===o||o>=48&&o<=57||64===o||91===o||96===o||123===o||126===o||ms.isIdentStartChar(o))r=r||t.valueBuilder(),s=2;else{if(35!==o)return void 0!==r?Le.done(r.bind()):Le.done(t.absent());e=e.step(),s=7}else if(e.isDone())return void 0!==r?Le.done(r.bind()):Le.done(t.absent())}if(2===s){for(void 0===i&&(i=t.parseBlockExpression(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=3;else if(i.isError())return i}if(3===s){for(;e.isCont()&&(o=e.head(),ms.isSpace(o));)e=e.step();if(e.isCont())58===o?(e=e.step(),s=4):(r.push(t.item(i.bind())),i=void 0,s=6);else if(e.isDone())return r.push(t.item(i.bind())),Le.done(r.bind())}if(4===s){for(;e.isCont()&&ms.isSpace(e.head());)e=e.step();if(e.isCont())s=5;else if(e.isDone())return r.push(t.slot(i.bind())),Le.done(r.bind())}if(5===s){for(void 0===n&&(n=t.parseBlockExpression(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())r.push(t.slot(i.bind(),n.bind())),i=void 0,n=void 0,s=6;else if(n.isError())return n}if(6===s){for(;e.isCont()&&(o=e.head(),ms.isSpace(o));)e=e.step();if(e.isCont()){if(44===o||59===o||ms.isNewline(o)){e=e.step(),s=1;continue}if(35!==o)return Le.done(r.bind());e=e.step(),s=7}else if(e.isDone())return Le.done(r.bind())}if(7===s){for(;e.isCont();){if(o=e.head(),ms.isNewline(o)){s=1;continue e}e=e.step()}if(e.isDone()){s=1;continue}}break}return new ys(t,r,i,n,s)}}class ws extends Le{constructor(e,t,r,i){super(),this.recon=e,this.keyParser=t,this.valueParser=r,this.step=i}feed(e){return ws.parse(e,this.recon,this.keyParser,this.valueParser,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n)if(e.isCont()){if(s=e.head(),64!==s)return Le.error(Ae.expected(64,e));e=e.step(),n=2}else if(e.isDone())return Le.error(Ae.expected(64,e));if(2===n){if(void 0===r){if(e.isCont())if(s=e.head(),34===s||39===s)r=t.parseString(e);else{if(!ms.isIdentStartChar(s))return Le.error(Ae.expected("attribute name",e));r=t.parseIdent(e)}else if(e.isDone())return Le.error(Ae.expected("attribute name",e))}else r=r.feed(e);if(void 0!==r)if(r.isDone())n=3;else if(r.isError())return r.asError()}if(3===n)if(e.isCont()&&40===e.head())e=e.step(),n=4;else if(!e.isEmpty())return Le.done(t.attr(r.bind()));if(4===n){for(;e.isCont()&&(s=e.head(),ms.isWhitespace(s));)e=e.step();if(e.isCont()){if(41===s)return e=e.step(),Le.done(t.attr(r.bind()));n=5}else if(e.isDone())return Le.error(Ae.expected(")",e))}if(5===n){for(void 0===i&&(i=t.parseBlock(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())n=6;else if(i.isError())return i.asError()}if(6===n){for(;e.isCont()&&(s=e.head(),ms.isWhitespace(s));)e=e.step();if(e.isCont())return 41===s?(e=e.step(),Le.done(t.attr(r.bind(),i.bind()))):Le.error(Ae.expected(")",e));if(e.isDone())return Le.error(Ae.expected(")",e))}return new ws(t,r,i,n)}}class gs extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.fieldParser=r,this.valueParser=i,this.step=n}feed(e){return gs.parse(e,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s)if(e.isCont())if(o=e.head(),64===o)i=t.parseAttr(e),s=2;else if(123===o)r=r||t.recordBuilder(),n=t.parseRecord(e,r),s=5;else if(91===o)r=r||t.recordBuilder(),n=t.parseMarkup(e,r),s=5;else if(ms.isIdentStartChar(o))n=t.parseIdent(e),s=4;else if(34===o||39===o)n=t.parseString(e),s=4;else if(96===o)n=t.parseRawString(e),s=4;else if(45===o||o>=48&&o<=57)n=t.parseNumber(e),s=4;else if(37===o)n=t.parseData(e),s=4;else{if(36!==o)return void 0===r?Le.done(t.extant()):Le.done(r.bind());n=t.parseSelector(e),s=4}else if(e.isDone())return void 0===r?Le.done(t.extant()):Le.done(r.bind());if(2===s){for(;i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())(r=r||t.valueBuilder()).push(i.bind()),i=void 0,s=3;else if(i.isError())return i.asError()}if(3===s){for(;e.isCont()&&ms.isSpace(e.head());)e=e.step();if(e.isCont()){s=1;continue}if(e.isDone())return Le.done(r.bind())}if(4===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())(r=r||t.valueBuilder()).push(t.item(n.bind())),n=void 0,s=6;else if(n.isError())return n}if(5===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())n=void 0,s=6;else if(n.isError())return n}if(6===s){for(;e.isCont()&&ms.isSpace(e.head());)e=e.step();if(e.isCont()){if(64!==e.head())return Le.done(r.bind());s=1}else if(e.isDone())return Le.done(r.bind())}break}return new gs(t,r,i,n,s)}}class vs extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.fieldParser=r,this.valueParser=i,this.step=n}feed(e){return vs.parse(e,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s)if(e.isCont())if(o=e.head(),64===o)i=t.parseAttr(e),s=2;else if(123===o)void 0!==r?(n=t.parseRecord(e,r),s=5):(n=t.parseRecord(e),s=4);else{if(91!==o)return void 0===r?Le.done(t.extant()):Le.done(r.bind());void 0!==r?(n=t.parseMarkup(e,r),s=5):(n=t.parseMarkup(e),s=4)}else if(e.isDone())return void 0===r?Le.done(t.extant()):Le.done(r.bind());if(2===s){for(;i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())(r=r||t.valueBuilder()).push(i.bind()),i=void 0,s=3;else if(i.isError())return i.asError()}if(3===s)if(e.isCont())if(o=e.head(),123===o)n=t.parseRecord(e,r),s=5;else{if(91!==o)return Le.done(r.bind());n=t.parseMarkup(e,r),s=5}else if(e.isDone())return Le.done(r.bind());if(4===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())return(r=r||t.valueBuilder()).push(t.item(n.bind())),Le.done(r.bind());if(n.isError())return n}if(5===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())return Le.done(r.bind());if(n.isError())return n}return new vs(t,r,i,n,s)}}class bs extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.keyParser=r,this.valueParser=i,this.step=n}feed(e){return bs.parse(e,this.recon,this.builder,this.keyParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s)if(e.isCont()){if(o=e.head(),123!==o)return Le.error(Ae.expected(123,e));e=e.step(),s=2}else if(e.isDone())return Le.error(Ae.expected(123,e));e:for(;;){if(2===s){for(;e.isCont()&&(o=e.head(),ms.isWhitespace(o));)e=e.step();if(e.isCont()){if(r=r||t.recordBuilder(),125===o)return e=e.step(),Le.done(r.bind());35===o?(e=e.step(),s=8):s=3}else if(e.isDone())return Le.error(Ae.expected(125,e))}if(3===s){for(void 0===i&&(i=t.parseBlockExpression(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=4;else if(i.isError())return i}if(4===s){for(;e.isCont()&&(o=e.head(),ms.isSpace(o));)e=e.step();if(e.isCont())58===o?(e=e.step(),s=5):(r.push(t.item(i.bind())),i=void 0,s=7);else if(e.isDone())return Le.error(Ae.expected(125,e))}if(5===s){for(;e.isCont()&&ms.isSpace(e.head());)e=e.step();if(e.isCont())s=6;else if(e.isDone())return r.push(t.slot(i.bind())),Le.done(r.bind())}if(6===s){for(void 0===n&&(n=t.parseBlockExpression(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())r.push(t.slot(i.bind(),n.bind())),i=void 0,n=void 0,s=7;else if(n.isError())return n}if(7===s){for(;e.isCont()&&(o=e.head(),ms.isSpace(o));)e=e.step();if(e.isCont()){if(44===o||59===o||ms.isNewline(o)){e=e.step(),s=2;continue}if(35!==o)return 125===o?(e=e.step(),Le.done(r.bind())):Le.error(Ae.expected("'}', ';', ',', or newline",e));e=e.step(),s=8}else if(e.isDone())return Le.error(Ae.expected(125,e))}if(8===s){for(;e.isCont();){if(o=e.head(),ms.isNewline(o)){s=2;continue e}e=e.step()}if(e.isDone()){s=2;continue}}break}return new bs(t,r,i,n,s)}}class xs extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.textOutput=r,this.valueParser=i,this.step=n}feed(e){return xs.parse(e,this.recon,this.builder,this.textOutput,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s)if(e.isCont()){if(o=e.head(),91!==o)return Le.error(Ae.expected(91,e));e=e.step(),s=2}else if(e.isDone())return Le.error(Ae.expected(91,e));for(;;){if(2===s){for(;e.isCont()&&(o=e.head(),64!==o&&91!==o&&92!==o&&93!==o&&123!==o&&125!==o);)e=e.step(),(i=i||t.textOutput()).write(o);if(e.isCont()){if(93===o)return e=e.step(),r=r||t.recordBuilder(),void 0!==i&&r.push(t.item(i.bind())),Le.done(r.bind());if(64===o)r=r||t.recordBuilder(),void 0!==i&&(r.push(t.item(i.bind())),i=void 0),n=t.parseInlineItem(e),s=3;else if(123===o)r=r||t.recordBuilder(),void 0!==i&&(r.push(t.item(i.bind())),i=void 0),n=t.parseRecord(e,r),s=4;else if(91===o)r=r||t.recordBuilder(),void 0!==i&&(r.push(t.item(i.bind())),i=void 0),n=t.parseMarkup(e,r),s=4;else{if(92!==o)return Le.error(Ae.unexpected(e));e=e.step(),s=5}}else if(e.isDone())return Le.error(Ae.unexpected(e))}if(3===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){r.push(t.item(n.bind())),n=void 0,s=2;continue}if(n.isError())return n}if(4===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){n=void 0,s=2;continue}if(n.isError())return n}if(5===s){if(e.isCont()){if(o=e.head(),i=i||t.textOutput(),34===o||36===o||39===o||47===o||64===o||91===o||92===o||93===o||123===o||125===o)e=e.step(),i.write(o),s=2;else if(98===o)e=e.step(),i.write(8),s=2;else if(102===o)e=e.step(),i.write(12),s=2;else if(110===o)e=e.step(),i.write(10),s=2;else if(114===o)e=e.step(),i.write(13),s=2;else{if(116!==o)return Le.error(Ae.expected("escape character",e));e=e.step(),i.write(9),s=2}continue}if(e.isDone())return Le.error(Ae.expected("escape character",e))}break}return new xs(t,r,i,n,s)}}class Cs extends Le{constructor(e,t,r){super(),this.recon=e,this.base64Parser=t,this.step=r}feed(e){return Cs.parse(e,this.recon,this.base64Parser,this.step)}static parse(e,t,r,i=1){let n=0;if(1===i)if(e.isCont()){if(n=e.head(),37!==n)return Le.error(Ae.expected(37,e));e=e.step(),i=2}else if(e.isDone())return Le.error(Ae.expected(37,e));if(2===i){for(void 0===r&&(r=ct.standard().parse(e,t.dataOutput()));r.isCont()&&!e.isEmpty();)r=r.feed(e);if(r.isDone())return r;if(r.isError())return r}return new Cs(t,r,i)}}class Ss extends Le{constructor(e,t,r){super(),this.recon=e,this.output=t,this.step=r}feed(e){return Ss.parse(e,this.recon,this.output,this.step)}static parse(e,t,r,i=1){let n=0;if(1===i)if(e.isCont()){if(n=e.head(),!ms.isIdentStartChar(n))return Le.error(Ae.expected("identifier",e));e=e.step(),r=(r=r||t.textOutput()).write(n),i=2}else if(e.isDone())return Le.error(Ae.expected("identifier",e));if(2===i){for(;e.isCont()&&(n=e.head(),ms.isIdentChar(n));)e=e.step(),r.write(n);if(!e.isEmpty())return Le.done(t.ident(r.bind()))}return new Ss(t,r,i)}}class Os extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.output=t,this.quote=r,this.code=i,this.step=n}feed(e){return Os.parse(e,this.recon,this.output,this.quote,this.code,this.step)}static parse(e,t,r,i=0,n=0,s=1){let o=0;if(1===s){for(;e.isCont()&&(o=e.head(),ms.isWhitespace(o));)e=e.step();if(e.isCont()){if(34!==o&&39!==o||i!==o&&0!==i)return Le.error(Ae.expected("string",e));e=e.step(),r=r||t.textOutput(),i=o,s=2}else if(e.isDone())return Le.error(Ae.expected("string",e))}e:for(;;){if(2===s){for(;e.isCont()&&(o=e.head(),o>=32&&o!==i&&92!==o);)e=e.step(),r=r.write(o);if(e.isCont()){if(o===i)return e=e.step(),Le.done(r.bind());if(92!==o)return Le.error(Ae.expected(i,e));e=e.step(),s=3}else if(e.isDone())return Le.error(Ae.expected(i,e))}if(3===s)if(e.isCont()){if(o=e.head(),34===o||36===o||39===o||47===o||64===o||91===o||92===o||93===o||123===o||125===o){e=e.step(),r=r.write(o),s=2;continue}if(98===o){e=e.step(),r=r.write(8),s=2;continue}if(102===o){e=e.step(),r=r.write(12),s=2;continue}if(110===o){e=e.step(),r=r.write(10),s=2;continue}if(114===o){e=e.step(),r=r.write(13),s=2;continue}if(116===o){e=e.step(),r=r.write(9),s=2;continue}if(117!==o)return Le.error(Ae.expected("escape character",e));e=e.step(),s=4}else if(e.isDone())return Le.error(Ae.expected("escape character",e));if(s>=4)for(;;){if(e.isCont()){if(o=e.head(),tt.isDigit(o)){if(e=e.step(),n=16*n+tt.decodeDigit(o),s<=6){s+=1;continue}r=r.write(n),n=0,s=2;continue e}return Le.error(Ae.expected("hex digit",e))}if(e.isDone())return Le.error(Ae.expected("hex digit",e));break}break}return new Os(t,r,i,n,s)}}class Es extends Le{constructor(e,t,r,i){super(),this.recon=e,this.output=t,this.count=r,this.step=i}feed(e){return Es.parse(e,this.recon,this.output,this.count,this.step)}static parse(e,t,r,i=0,n=1){let s=0;if(1===n){for(;e.isCont()&&(s=e.head(),ms.isWhitespace(s));)e=e.step();if(e.isCont()&&96===s)e=e.step(),i=1,n=2;else if(e.isDone())return Le.error(Ae.expected("raw string",e))}if(2===n)if(e.isCont())96===e.head()?(e=e.step(),i=2,n=3):(r=r||t.textOutput(),n=4);else if(e.isDone())return Le.error(Ae.expected("raw string",e));if(3===n)if(e.isCont()){if(96!==e.head())return r=r||t.textOutput(),Le.done(r.bind());e=e.step(),r=r||t.textOutput(),i=3,n=4}else if(e.isDone())return r=r||t.textOutput(),Le.done(r.bind());for(;;){if(4===n){for(;e.isCont()&&(s=e.head(),(1!==i||s>=32)&&96!==s&&92!==s);)e=e.step(),r=r.write(s);if(e.isCont())if(92===s)e=e.step(),n=5;else{if(96!==s)return Le.error(Ae.expected(96,e));if(e=e.step(),1===i)return Le.done(r.bind());n=6}else if(e.isDone())return Le.error(Ae.expected(96,e))}if(5===n){if(e.isCont()){s=e.head(),e=e.step(),92!==s&&96!==s&&(r=r.write(92)),r=r.write(s),n=4;continue}if(e.isDone())return Le.error(Ae.expected("escape character",e))}if(6===n)if(e.isCont()){if(96!==e.head()){r=r.write(96),n=4;continue}e=e.step(),n=7}else if(e.isDone())return Le.error(Ae.message("unclosed raw string",e));if(7===n){if(e.isCont()){if(96===e.head())return e=e.step(),Le.done(r.bind());r=(r=r.write(96)).write(96),n=4;continue}if(e.isDone())return Le.error(Ae.message("unclosed raw string",e))}break}return new Es(t,r,i,n)}}class As extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.sign=t,this.value=r,this.mode=i,this.step=n}feed(e){return As.parse(e,this.recon,this.sign,this.value,this.mode,this.step)}static parse(e,t,r=1,i=0,n=2,s=1){let o=0;if(1===s){for(;e.isCont()&&(o=e.head(),ms.isWhitespace(o));)e=e.step();if(e.isCont())45===o&&(e=e.step(),r=-1),s=2;else if(e.isDone())return Le.error(Ae.expected("number",e))}if(2===s)if(e.isCont())if(o=e.head(),48===o)e=e.step(),s=4;else{if(!(o>=49&&o<=57))return Le.error(Ae.expected("digit",e));e=e.step(),i=r*(o-48),s=3}else if(e.isDone())return Le.error(Ae.expected("digit",e));if(3===s){for(;e.isCont()&&(o=e.head(),o>=48&&o<=57);){const t=10*i+r*(o-48);if(!(-9007199254740991<=t&&t<=9007199254740992))return Le.error(Ae.message("integer overflow",e));i=t,e=e.step()}if(e.isCont())s=4;else if(e.isDone())return Le.done(t.num(i))}if(4===s){if(e.isCont()){if(o=e.head(),n>0&&46===o||n>1&&(69===o||101===o)){let s=Se.stringOutput();return s=r<0&&0===i?s.write(45).write(48):s.write(""+i),ks.parse(e,t,s,n)}return 120===o&&r>0&&0===i?(e=e.step(),Ds.parse(e,t)):Le.done(t.num(i))}if(e.isDone())return Le.done(t.num(i))}return new As(t,r,i,n,s)}static parseInteger(e,t){return As.parse(e,t,void 0,void 0,0)}static parseDecimal(e,t){return As.parse(e,t,void 0,void 0,1)}}class ks extends Le{constructor(e,t,r,i){super(),this.recon=e,this.output=t,this.mode=r,this.step=i}feed(e){return ks.parse(e,this.recon,this.output,this.mode,this.step)}static parse(e,t,r,i=2,n=1){let s=0;if(1===n)if(e.isCont())if(s=e.head(),46===s)e=e.step(),r=r.write(s),n=2;else{if(!(i>1)||69!==s&&101!==s)return Le.error(Ae.expected("decimal or exponent",e));e=e.step(),r=r.write(s),n=5}else if(e.isDone())return Le.error(Ae.expected("decimal or exponent",e));if(2===n)if(e.isCont()){if(s=e.head(),!(s>=48&&s<=57))return Le.error(Ae.expected("digit",e));e=e.step(),r=r.write(s),n=3}else if(e.isDone())return Le.error(Ae.expected("digit",e));if(3===n){for(;e.isCont()&&(s=e.head(),s>=48&&s<=57);)e=e.step(),r=r.write(s);if(e.isCont()){if(!(i>1))return Le.done(t.num(r.bind()));n=4}else if(e.isDone())return Le.done(t.num(r.bind()))}if(4===n){if(s=e.head(),69!==s&&101!==s)return Le.done(t.num(r.bind()));e=e.step(),r=r.write(s),n=5}if(5===n)if(e.isCont())s=e.head(),43!==s&&45!==s||(e=e.step(),r=r.write(s)),n=6;else if(e.isDone())return Le.error(Ae.unexpected(e));if(6===n)if(e.isCont()){if(s=e.head(),!(s>=48&&s<=57))return Le.error(Ae.expected("digit",e));e=e.step(),r=r.write(s),n=7}else if(e.isDone())return Le.error(Ae.expected("digit",e));if(7===n){for(;e.isCont()&&(s=e.head(),s>=48&&s<=57);)e=e.step(),r=r.write(s);if(!e.isEmpty())return Le.done(t.num(r.bind()))}return new ks(t,r,i,n)}}class Ds extends Le{constructor(e,t,r){super(),this.recon=e,this.value=t,this.size=r}feed(e){return Ds.parse(e,this.recon,this.value,this.size)}static parse(e,t,r=0,i=0){let n=0;for(;e.isCont()&&(n=e.head(),tt.isDigit(n));)e=e.step(),r=16*r+tt.decodeDigit(n),i+=1;return e.isEmpty()?new Ds(t,r,i):i>0?i<=8?Le.done(t.uint32(r)):Le.done(t.uint64(r)):Le.error(Ae.expected("hex digit",e))}}class Ps extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.bindingsParser=r,this.templateParser=i,this.step=n}feed(e){return Ps.parse(e,this.recon,this.builder,this.bindingsParser,this.templateParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s){for(void 0===i&&(i=t.parseConditionalOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(e.isCont()){if(o=e.head(),62!==o)return i;e=e.step(),s=3}else if(e.isDone())return i;if(3===s){for(void 0===n&&(n=t.parseConditionalOperator(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();return Le.done(t.lambda(e,r))}if(n.isError())return n.asError()}return new Ps(t,r,i,n,s)}}class Ts extends Le{constructor(e,t,r,i,n,s){super(),this.recon=e,this.builder=t,this.ifParser=r,this.thenParser=i,this.elseParser=n,this.step=s}feed(e){return Ts.parse(e,this.recon,this.builder,this.ifParser,this.thenParser,this.elseParser,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;if(1===o){for(void 0===i&&(i=t.parseOrOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;e.isCont()&&(a=e.head(),ms.isSpace(a));)e=e.step();if(e.isCont()){if(63!==a)return i;e=e.step(),o=3}else if(e.isDone())return i}if(3===o){for(void 0===n&&(n=t.parseConditionalOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())o=4;else if(n.isError())return n.asError()}if(4===o){for(;e.isCont()&&(a=e.head(),ms.isSpace(a));)e=e.step();if(e.isCont()){if(58!==a)return Le.error(Ae.expected(58,e));e=e.step(),o=5}else if(e.isDone())return Le.error(Ae.expected(58,e))}if(5===o){for(void 0===s&&(s=t.parseConditionalOperator(e,r));s.isCont()&&!e.isEmpty();)s=s.feed(e);if(s.isDone()){const e=i.bind(),r=n.bind(),o=s.bind();return Le.done(t.conditional(e,r,o))}if(s.isError())return s.asError()}return new Ts(t,r,i,n,s,o)}}class Is extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return Is.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseAndOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(e.isCont()){if(o=e.head(),124!==o)return i;e=e.step(),s=3}else if(e.isDone())return i;if(3===s){for(void 0===n&&(n=t.parseAndOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Le.done(t.or(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Is(t,r,i,n,s)}}class Ms extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return Ms.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseBitwiseOrOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(e.isCont()){if(o=e.head(),38!==o)return i;e=e.step(),s=3}else if(e.isDone())return i;if(3===s){for(void 0===n&&(n=t.parseBitwiseOrOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Le.done(t.and(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Ms(t,r,i,n,s)}}class Vs extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return Vs.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseBitwiseXorOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;e.isCont()&&(o=e.head(),ms.isSpace(o));)e=e.step();if(e.isCont()){if(124!==o)return i;e=e.step(),s=3}else if(e.isDone())return i}if(3===s)if(e.isCont()){if(o=e.head(),124===o)return i;s=4}else if(e.isDone())return Le.error(Ae.unexpected(e));if(4===s){for(void 0===n&&(n=t.parseBitwiseXorOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Le.done(t.bitwiseOr(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Vs(t,r,i,n,s)}}class qs extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return qs.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseBitwiseAndOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;e.isCont()&&(o=e.head(),ms.isSpace(o));)e=e.step();if(e.isCont()){if(94!==o)return i;e=e.step(),s=3}else if(e.isDone())return i}if(3===s){for(void 0===n&&(n=t.parseBitwiseAndOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Le.done(t.bitwiseXor(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new qs(t,r,i,n,s)}}class Fs extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return Fs.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseComparisonOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;e.isCont()&&(o=e.head(),ms.isSpace(o));)e=e.step();if(e.isCont()){if(38!==o)return i;e=e.step(),s=3}else if(e.isDone())return i}if(3===s)if(e.isCont()){if(o=e.head(),38===o)return i;s=4}else if(e.isDone())return Le.error(Ae.unexpected(e));if(4===s){for(void 0===n&&(n=t.parseComparisonOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Le.done(t.bitwiseAnd(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Fs(t,r,i,n,s)}}class Ns extends Le{constructor(e,t,r,i,n,s){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.operator=i,this.rhsParser=n,this.step=s}feed(e){return Ns.parse(e,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;if(1===o){for(void 0===i&&(i=t.parseAttrExpression(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;e.isCont()&&(a=e.head(),ms.isSpace(a));)e=e.step();if(e.isCont())if(33===a)e=e.step(),o=3;else if(60===a)e=e.step(),o=4;else if(62===a)e=e.step(),o=5;else{if(61!==a)return i;e=e.step(),o=6}else if(e.isDone())return i}if(3===o)if(e.isCont())a=e.head(),61===a?(e=e.step(),n="!=",o=7):(n="!",o=7);else if(e.isDone())return Le.error(Ae.unexpected(e));if(4===o)if(e.isCont())a=e.head(),61===a?(e=e.step(),n="<=",o=7):(n="<",o=7);else if(e.isDone())return Le.error(Ae.unexpected(e));if(5===o)if(e.isCont())a=e.head(),61===a?(e=e.step(),n=">=",o=7):(n=">",o=7);else if(e.isDone())return Le.error(Ae.unexpected(e));if(6===o)if(e.isCont())if(a=e.head(),61===a)e=e.step(),n="==",o=7;else{if(62===a)return i;n="=",o=7}else if(e.isDone())return Le.error(Ae.unexpected(e));if(7===o){for(void 0===s&&(s=t.parseAttrExpression(e,r));s.isCont()&&!e.isEmpty();)s=s.feed(e);if(s.isDone()){const r=i.bind(),o=s.bind();return"<"===n?Le.done(t.lt(r,o)):"<="===n?Le.done(t.le(r,o)):"=="===n?Le.done(t.eq(r,o)):"!="===n?Le.done(t.ne(r,o)):">="===n?Le.done(t.ge(r,o)):">"===n?Le.done(t.gt(r,o)):Le.error(Ae.message(n,e))}if(s.isError())return s.asError()}return new Ns(t,r,i,n,s,o)}}class zs extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.fieldParser=r,this.valueParser=i,this.step=n}feed(e){return zs.parse(e,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(;e.isCont()&&(o=e.head(),ms.isSpace(o));)e=e.step();if(e.isCont())if(64===o)s=2;else if(123===o||91===o)r=r||t.recordBuilder(),s=5;else if(40===o)s=4;else{if(!(33===o||34===o||36===o||37===o||39===o||43===o||45===o||o>=48&&o<=57||96===o||126===o||ms.isIdentStartChar(o)))return void 0===r?Le.done(t.extant()):Le.done(r.bind());s=3}else if(e.isDone())return void 0===r?Le.done(t.extant()):Le.done(r.bind())}if(2===s){for(void 0===i&&(i=t.parseAttr(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone()){(r=r||t.recordBuilder()).push(i.bind()),i=void 0,s=1;continue}if(i.isError())return i.asError()}if(3===s){for(void 0===n&&(n=t.parseAdditiveOperator(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())(r=r||t.valueBuilder()).push(t.item(n.bind())),n=void 0,s=6;else if(n.isError())return n.asError()}if(4===s){for(void 0===n&&(n=t.parseAdditiveOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())void 0===r&&(r=t.valueBuilder()).push(t.item(n.bind())),n=void 0,s=6;else if(n.isError())return n.asError()}if(5===s){for(void 0===n&&(n=t.parseAdditiveOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())n=void 0,s=6;else if(n.isError())return n.asError()}if(6===s){for(;e.isCont()&&(o=e.head(),ms.isSpace(o));)e=e.step();if(e.isCont()){if(64===o){s=1;continue}return Le.done(r.bind())}if(e.isDone())return Le.done(r.bind())}break}return new zs(t,r,i,n,s)}}class Us extends Le{constructor(e,t,r,i,n,s){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.operator=i,this.rhsParser=n,this.step=s}feed(e){return Us.parse(e,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;for(;;){if(1===o){for(void 0===i&&(i=t.parseMultiplicativeOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;e.isCont()&&(a=e.head(),ms.isSpace(a));)e=e.step();if(e.isCont())if(43===a)e=e.step(),n="+",o=3;else{if(45!==a)return i;e=e.step(),n="-",o=3}else if(e.isDone())return i}if(3===o){for(void 0===s&&(s=t.parseMultiplicativeOperator(e,r));s.isCont()&&!e.isEmpty();)s=s.feed(e);if(s.isDone()){const r=i.bind(),a=s.bind();if("+"===n)i=Le.done(t.plus(r,a));else{if("-"!==n)return Le.error(Ae.message(n,e));i=Le.done(t.minus(r,a))}s=void 0,n=void 0,o=2;continue}if(s.isError())return s.asError()}break}return new Us(t,r,i,n,s,o)}}class Rs extends Le{constructor(e,t,r,i,n,s){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.operator=i,this.rhsParser=n,this.step=s}feed(e){return Rs.parse(e,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;for(;;){if(1===o){for(void 0===i&&(i=t.parsePrefixOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;e.isCont()&&(a=e.head(),ms.isSpace(a));)e=e.step();if(e.isCont())if(42===a)e=e.step(),n="*",o=3;else if(47===a)e=e.step(),n="/",o=3;else{if(37!==a)return i;e=e.step(),n="%",o=3}else if(e.isDone())return i}if(3===o){for(void 0===s&&(s=t.parsePrefixOperator(e,r));s.isCont()&&!e.isEmpty();)s=s.feed(e);if(s.isDone()){const r=i.bind(),a=s.bind();if("*"===n)i=Le.done(t.times(r,a));else if("/"===n)i=Le.done(t.divide(r,a));else{if("%"!==n)return Le.error(Ae.message(n,e));i=Le.done(t.modulo(r,a))}s=void 0,n=void 0,o=2;continue}if(s.isError())return s.asError()}break}return new Rs(t,r,i,n,s,o)}}class js extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.operator=r,this.operandParser=i,this.step=n}feed(e){return js.parse(e,this.recon,this.builder,this.operator,this.operandParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s){for(;e.isCont()&&(o=e.head(),ms.isSpace(o));)e=e.step();if(e.isCont()){if(33===o)e=e.step(),i="!";else if(126===o)e=e.step(),i="~";else if(45===o)e=e.step(),i="-";else{if(43!==o)return t.parseInvokeOperator(e,r);e=e.step(),i="+"}s=2}else if(e.isDone())return t.parseInvokeOperator(e,r)}if(2===s){for(void 0===n&&(n=t.parsePrefixOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const r=n.bind();return t.isDistinct(r)?"!"===i?Le.done(t.not(r)):"~"===i?Le.done(t.bitwiseNot(r)):"-"===i?Le.done(t.negative(r)):"+"===i?Le.done(t.positive(r)):Le.error(Ae.message(i,e)):Le.error(Ae.expected("value",e))}if(n.isError())return n.asError()}return new js(t,r,i,n,s)}}class Ls extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.exprParser=r,this.argsParser=i,this.step=n}feed(e){return Ls.parse(e,this.recon,this.builder,this.exprParser,this.argsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s){for(void 0===i&&(i=t.parsePrimary(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}for(;;){if(2===s){for(;e.isCont()&&(o=e.head(),ms.isSpace(o));)e=e.step();if(e.isCont()){if(40!==o)return i;e=e.step(),s=3}else if(e.isDone())return i}if(3===s){for(;e.isCont()&&(o=e.head(),ms.isWhitespace(o));)e=e.step();if(e.isCont()){if(41===o){e=e.step();const r=i.bind();i=Le.done(t.invoke(r,t.extant())),s=2;continue}s=4}else if(e.isDone())return Le.error(Ae.expected(41,e))}if(4===s){for(void 0===n&&(n=t.parseBlock(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())s=5;else if(n.isError())return n.asError()}if(5===s){for(;e.isCont()&&(o=e.head(),ms.isWhitespace(o));)e=e.step();if(e.isCont()){if(41===o){e=e.step();const r=i.bind(),o=n.bind();i=Le.done(t.invoke(r,o)),n=void 0,s=2;continue}return Le.error(Ae.expected(41,e))}if(e.isDone())return Le.error(Ae.expected(41,e))}break}return new Ls(t,r,i,n,s)}}class Bs extends Le{constructor(e,t,r,i){super(),this.recon=e,this.builder=t,this.exprParser=r,this.step=i}feed(e){return Bs.parse(e,this.recon,this.builder,this.exprParser,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n){for(;e.isCont()&&(s=e.head(),ms.isSpace(s));)e=e.step();e.isCont()?40===s?(e=e.step(),n=3):n=2:e.isDone()&&(n=2)}if(2===n){for(void 0===i&&(i=t.parseLiteral(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())return i;if(i.isError())return i.asError()}if(3===n){for(void 0===i&&(i=t.parseBlockExpression(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())n=4;else if(i.isError())return i.asError()}for(;;){if(4===n){for(;e.isCont()&&(s=e.head(),ms.isSpace(s));)e=e.step();if(e.isCont()){if(44!==s)return 41===s?(e=e.step(),void 0!==i?i:Le.done(r.bind())):Le.error(Ae.expected(41,e));e=e.step(),void 0!==i&&(void 0===r&&(r=t.recordBuilder()).push(t.item(i.bind())),i=void 0),n=5}else if(e.isDone())return Le.error(Ae.expected(41,e))}if(5===n){for(void 0===i&&(i=t.parseBlockExpression(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone()){i=void 0,n=4;continue}if(i.isError())return i.asError()}break}return new Bs(t,r,i,n)}}class Ks extends Le{constructor(e,t,r,i){super(),this.recon=e,this.builder=t,this.valueParser=r,this.step=i}feed(e){return Ks.parse(e,this.recon,this.builder,this.valueParser,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n){for(;e.isCont()&&(s=e.head(),ms.isSpace(s));)e=e.step();if(e.isCont())if(40===s)e=e.step(),n=4;else if(123===s)r=r||t.recordBuilder(),i=t.parseRecord(e,r),n=3;else if(91===s)r=r||t.recordBuilder(),i=t.parseMarkup(e,r),n=3;else if(ms.isIdentStartChar(s))i=t.parseIdent(e),n=2;else if(34===s||39===s)i=t.parseString(e),n=2;else if(96===s)i=t.parseRawString(e),n=2;else if(45===s||s>=48&&s<=57)i=t.parseNumber(e),n=2;else if(37===s)i=t.parseData(e),n=2;else{if(36!==s)return void 0===r?Le.done(t.extant()):Le.done(r.bind());i=t.parseSelector(e),n=2}else if(e.isDone())return void 0===r?Le.done(t.extant()):Le.done(r.bind())}if(2===n){for(;i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())return(r=r||t.valueBuilder()).push(t.item(i.bind())),Le.done(r.bind());if(i.isError())return i.asError()}if(3===n){for(;i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())return Le.done(r.bind());if(i.isError())return i.asError()}if(4===n){for(void 0===i&&(i=t.parseBlockExpression(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())n=5;else if(i.isError())return i.asError()}if(5===n){for(;e.isCont()&&(s=e.head(),ms.isWhitespace(s));)e=e.step();if(e.isCont())return 41===s?(e=e.step(),(r=r||t.valueBuilder()).push(t.item(i.bind())),Le.done(r.bind())):Le.error(Ae.expected(41,e));if(e.isDone())return Le.error(Ae.expected(41,e))}return new Ks(t,r,i,n)}}class Ws extends Le{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.selector=r,this.valueParser=i,this.step=n}feed(e){return Ws.parse(e,this.recon,this.builder,this.selector,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s){for(;e.isCont()&&(o=e.head(),ms.isSpace(o));)e=e.step();if(e.isCont()&&36===o)e=e.step(),i=i||t.selector(),s=2;else if(e.isDone())return Le.error(Ae.expected(36,e))}if(2===s)if(e.isCont())o=e.head(),91===o?(e=e.step(),s=8):64===o?(e=e.step(),s=7):58===o?(e=e.step(),s=6):42===o?(e=e.step(),s=5):35===o?(e=e.step(),s=4):s=3;else if(e.isDone())return Le.error(Ae.unexpected(e));for(;;){if(3===s){for(void 0===n&&(n=t.parseLiteral(e,t.valueBuilder()));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())i=t.get(i,n.bind()),n=void 0,s=10;else if(n.isError())return n.asError()}if(4===s){for(void 0===n&&(n=t.parseInteger(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())i=t.value(t.getItem(i,n.bind())),n=void 0,s=10;else if(n.isError())return n.asError()}if(5===s&&(e.isCont()?(o=e.head(),58===o?(e=e.step(),i=t.keys(i),s=10):42===o?(e=e.step(),i=t.descendants(i),s=10):(i=t.children(i),s=10)):e.isDone()&&(i=t.children(i),s=10)),6===s)if(e.isCont()){if(o=e.head(),42!==o)return Le.error(Ae.expected(42,e));e=e.step(),i=t.values(i),s=10}else if(e.isDone())return Le.error(Ae.expected(42,e));if(7===s){for(void 0===n&&(n=t.parseIdent(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())i=t.getAttr(i,n.bind()),n=void 0,s=10;else if(n.isError())return n.asError()}if(8===s){for(void 0===n&&(n=t.parseBlockExpression(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())s=9;else if(n.isError())return n.asError()}if(9===s){for(;e.isCont()&&(o=e.head(),ms.isSpace(o));)e=e.step();if(e.isCont()){if(93!==o)return Le.error(Ae.expected(93,e));e=e.step(),i=t.filter(i,n.bind()),n=void 0,s=10}else if(e.isDone())return Le.error(Ae.expected(93,e))}if(10===s)if(e.isCont()){if(o=e.head(),91===o){e=e.step(),s=8;continue}if(35===o){e=e.step(),s=4;continue}if(46!==o)return void 0!==r?(r.push(t.item(i)),Le.done(r.bind())):Le.done(i);e=e.step(),s=11}else if(e.isDone())return void 0!==r?(r.push(t.item(i)),Le.done(r.bind())):Le.done(i);if(11===s){if(e.isCont()){if(o=e.head(),64===o){e=e.step(),s=7;continue}if(58===o){e=e.step(),s=6;continue}if(42===o){e=e.step(),s=5;continue}s=3;continue}if(e.isDone())return Le.error(Ae.unexpected(e))}break}return new Ws(t,r,i,n,s)}}class Hs{parseBlock(e){return ys.parse(e,this)}parseAttr(e){return ws.parse(e,this)}parseBlockItem(e){return gs.parse(e,this)}parseInlineItem(e){return vs.parse(e,this)}parseRecord(e,t){return bs.parse(e,this,t)}parseMarkup(e,t){return xs.parse(e,this,t)}parseData(e){return Cs.parse(e,this)}parseIdent(e){return Ss.parse(e,this)}parseString(e){return Os.parse(e,this)}parseRawString(e){return Es.parse(e,this)}parseNumber(e){return As.parse(e,this)}parseInteger(e){return As.parseInteger(e,this)}parseBlockExpression(e,t){return this.parseLambdaFunc(e,t)}parseLambdaFunc(e,t){return Ps.parse(e,this,t)}parseConditionalOperator(e,t){return Ts.parse(e,this,t)}parseOrOperator(e,t){return Is.parse(e,this,t)}parseAndOperator(e,t){return Ms.parse(e,this,t)}parseBitwiseOrOperator(e,t){return Vs.parse(e,this,t)}parseBitwiseXorOperator(e,t){return qs.parse(e,this,t)}parseBitwiseAndOperator(e,t){return Fs.parse(e,this,t)}parseComparisonOperator(e,t){return Ns.parse(e,this,t)}parseAttrExpression(e,t){return zs.parse(e,this,t)}parseAdditiveOperator(e,t){return Us.parse(e,this,t)}parseMultiplicativeOperator(e,t){return Rs.parse(e,this,t)}parsePrefixOperator(e,t){return js.parse(e,this,t)}parseInvokeOperator(e,t){return Ls.parse(e,this,t)}parsePrimary(e,t){return Bs.parse(e,this,t)}parseLiteral(e,t){return Ks.parse(e,this,t)}parseSelector(e,t){return Ws.parse(e,this,t)}blockParser(){return new ys(this)}parseBlockString(e){let t=Se.stringInput(e);for(;t.isCont()&&ms.isWhitespace(t.head());)t=t.step();let r=this.parseBlock(t);if(r.isDone())for(;t.isCont()&&ms.isWhitespace(t.head());)t=t.step();return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}}class Xs extends Hs{isDistinct(e){return e.isDistinct()}item(e){return e}value(e){return e.toValue()}attr(e,t){return 1===arguments.length?gr.of(e):gr.of(e,t)}slot(e,t){return 1===arguments.length?yr.of(e):yr.of(e,t)}valueBuilder(){return xr.builder()}recordBuilder(){return Cr.create()}dataOutput(){return Dr.output()}textOutput(){return Tr.output()}ident(e){if(e instanceof Tr){const t=e.stringValue();if("true"===t)return qr.from(!0);if("false"===t)return qr.from(!1)}return e}num(e){if("number"==typeof e)return Mr.from(e);if("string"==typeof e)return Mr.from(+e);throw new TypeError(""+e)}uint32(e){return Mr.uint32(e)}uint64(e){return Mr.uint64(e)}bool(e){return qr.from(e)}selector(){return yi.identity()}extant(){return xr.extant()}absent(){return xr.absent()}conditional(e,t,r){return e.conditional(t,r)}or(e,t){return new Gr(e,t)}and(e,t){return new Yr(e,t)}bitwiseOr(e,t){return new Zr(e,t)}bitwiseXor(e,t){return new Qr(e,t)}bitwiseAnd(e,t){return new $r(e,t)}lt(e,t){return new Jr(e,t)}le(e,t){return new ei(e,t)}eq(e,t){return new ti(e,t)}ne(e,t){return new ri(e,t)}ge(e,t){return new ii(e,t)}gt(e,t){return new ni(e,t)}plus(e,t){return new si(e,t)}minus(e,t){return new oi(e,t)}times(e,t){return new ai(e,t)}divide(e,t){return new ui(e,t)}modulo(e,t){return new hi(e,t)}not(e){return new li(e)}bitwiseNot(e){return new ci(e)}negative(e){return e instanceof Mr?e.negative():new di(e)}positive(e){return new pi(e)}invoke(e,t){return new fi(e,t)}lambda(e,t){return e.lambda(t)}get(e,t){return e.get(t)}getAttr(e,t){return e.getAttr(t)}getItem(e,t){return e.getItem(t)}children(e){return yi.literal(e).children()}descendants(e){return yi.literal(e).descendants()}keys(e){return yi.literal(e).keys()}values(e){return yi.literal(e).values()}filter(e,t){return e.filter(t)}}class _s extends xe{constructor(e,t,r,i,n){super(),this.recon=e,this.key=t,this.value=r,this.part=i,this.step=n}pull(e){return _s.write(e,this.recon,this.key,this.value,this.part,this.step)}static sizeOf(e,t,r){let i=0;return i+=1,i+=e.sizeOfValue(t),e.isExtant(e.item(r))||(i+=1,i+=e.sizeOfBlockValue(r),i+=1),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()&&(e=e.write(64),s=2),2===s)if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone()){if(n=void 0,t.isExtant(t.item(i)))return xe.end();s=3}else if(n.isError())return n.asError();if(3===s&&e.isCont()&&(e=e.write(40),s=4),4===s)if((n=void 0===n?t.writeBlockValue(e,i):n.pull(e)).isDone())n=void 0,s=5;else if(n.isError())return n.asError();return 5===s&&e.isCont()?(e=e.write(41),xe.end()):e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new _s(t,r,i,n,s)}}class Gs extends xe{constructor(e,t,r,i,n){super(),this.recon=e,this.key=t,this.value=r,this.part=i,this.step=n}pull(e){return Gs.write(e,this.recon,this.key,this.value,this.part,this.step)}static sizeOf(e,t,r){let i=0;return i+=e.sizeOfValue(t),i+=1,e.isExtant(e.item(r))||(i+=e.sizeOfValue(r)),i}static write(e,t,r,i,n,s=1){if(1===s)if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())n=void 0,s=2;else if(n.isError())return n.asError();if(2===s&&e.isCont()){if(e=e.write(58),t.isExtant(t.item(i)))return xe.end();s=3}if(3===s){if((n=void 0===n?t.writeValue(e,i):n.pull(e)).isDone())return xe.end();if(n.isError())return n.asError()}return e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new Gs(t,r,i,n,s)}}class Ys extends xe{constructor(e,t,r,i,n,s,o,a,u,h,l,c){super(),this.recon=e,this.items=t,this.inBlock=r,this.inMarkup=i,this.inBraces=n,this.inBrackets=s,this.first=o,this.markupSafe=a,this.item=u,this.next=h,this.part=l,this.step=c}pull(e){return Ys.write(e,this.recon,this.items,this.inBlock,this.inMarkup,this.inBraces,this.inBrackets,this.first,this.markupSafe,this.item,this.next,this.part,this.step)}static sizeOf(e,t,r,i){let n,s=0,o=!1,a=!1,u=!0,h=!0;for(;void 0!==n||t.hasNext();){let l;void 0===n?l=t.next().value:(l=n,n=void 0),t.hasNext()&&(n=t.next().value),e.isExpression(l)&&(h=!1),a&&e.isAttr(l)&&(o&&(s+=1,o=!1),s+=1,a=!1),e.isAttr(l)?(o?(s+=1,o=!1):a&&(s+=1,a=!1),s+=e.sizeOfItem(l),u=!1):a&&e.isText(l)?(o&&(s+=1,o=!1),s+=e.sizeOfMarkupText(l)):o?(u?u=!1:s+=1,s+=Ys.sizeOfBlockItem(e,l)):a?e.isRecord(l)&&e.isMarkupSafe(e.items(l))?(s+=e.sizeOfBlock(e.items(l),!1,!0),void 0!==n&&e.isText(n)?(s+=e.sizeOfMarkupText(n),n=void 0):void 0===n||e.isAttr(n)?(s+=1,a=!1):(s+=1,o=!0,u=!0)):(s+=1,s+=e.sizeOfItem(l),o=!0,u=!1):!h||!e.isText(l)||void 0===n||e.isField(n)||e.isText(n)||e.isBool(n)?r&&!o?(u?u=!1:s+=1,s+=Ys.sizeOfBlockItem(e,l)):i&&e.isText(l)&&void 0===n?(s+=1,s+=e.sizeOfMarkupText(l),s+=1):!i&&e.isValue(l)&&!e.isRecord(l)&&(!u&&void 0===n||void 0!==n&&e.isAttr(n))?(!u&&(e.isText(l)&&e.isIdent(l)||e.isNum(l)||e.isBool(l))&&(s+=1),s+=e.sizeOfItem(l)):(s+=1,s+=e.sizeOfItem(l),o=!0,u=!1):(s+=1,s+=e.sizeOfMarkupText(l),a=!0)}return o&&(s+=1),a&&(s+=1),s}static sizeOfBlockItem(e,t){let r=0;return e.isField(t)?r+=e.sizeOfSlot(e.key(t),e.value(t)):r+=e.sizeOfItem(t),r}static write(e,t,r,i,n,s=!1,o=!1,a=!0,u=!0,h,l,c,d=1){for(;;){if(1===d){if(void 0===l&&!r.hasNext()){d=10;break}void 0===l?h=r.next().value:(h=l,l=void 0),r.hasNext()&&(l=r.next().value),t.isExpression(h)&&(u=!1),d=2}if(2===d&&e.isCont()&&(o&&t.isAttr(h)?(s&&(e=e.write(125),s=!1),d=3):d=4),3===d&&e.isCont()&&(e=e.write(93),o=!1,d=4),4===d&&e.isCont()&&(t.isAttr(h)?(s?(e=e.write(125),s=!1):o&&(e=e.write(93),o=!1),c=t.writeItem(e,h),a=!1,d=7):o&&t.isText(h)?(s&&(e=e.write(125),s=!1),c=t.writeMarkupText(e,h),d=7):s?(a?a=!1:e=e.write(44),c=Ys.writeBlockItem(e,t,h),d=7):o?t.isRecord(h)&&t.isMarkupSafe(t.items(h))?(c=t.writeBlock(e,t.items(h),!1,!0),d=5):(e=e.write(123),c=t.writeItem(e,h),s=!0,a=!1,d=7):!u||!t.isText(h)||void 0===l||t.isField(l)||t.isText(l)||t.isBool(l)?i&&!s?(a?a=!1:e=e.write(44),c=Ys.writeBlockItem(e,t,h),d=7):n&&t.isText(h)&&void 0===l?(e=e.write(91),c=t.writeMarkupText(e,h),d=8):!n&&t.isValue(h)&&!t.isRecord(h)&&(!a&&void 0===l||void 0!==l&&t.isAttr(l))?(!a&&(t.isText(h)&&t.isIdent(h)||t.isNum(h)||t.isBool(h))&&(e=e.write(32)),c=t.writeItem(e,h),d=7):(e=e.write(123),c=t.writeItem(e,h),s=!0,a=!1,d=7):(e=e.write(91),c=t.writeMarkupText(e,h),o=!0,d=7)),5===d)if((c=c.pull(e)).isDone())c=void 0,d=6;else if(c.isError())return c.asError();if(6===d&&e.isCont()){if(void 0===l||!t.isText(l)){if(void 0===l||t.isAttr(l)){e=e.write(93),o=!1,d=1;continue}e=e.write(123),s=!0,a=!0,d=1;continue}c=t.writeMarkupText(e,l),l=void 0,d=7}if(7===d){if((c=c.pull(e)).isDone()){c=void 0,d=1;continue}if(c.isError())return c.asError()}if(8===d)if((c=c.pull(e)).isDone())c=void 0,d=9;else if(c.isError())return c.asError();if(9!==d||!e.isCont())break;e=e.write(93),d=1}if(10===d&&(s?e.isCont()&&(e=e.write(125),d=11):d=11),11===d){if(!o)return xe.end();if(e.isCont())return e=e.write(93),xe.end()}return e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new Ys(t,r,i,n,s,o,a,u,h,l,c,d)}static writeBlockItem(e,t,r){return t.isField(r)?t.writeSlot(e,t.key(r),t.value(r)):t.writeItem(e,r)}}class Zs extends xe{constructor(e,t,r,i,n,s,o,a){super(),this.recon=e,this.items=t,this.inParens=r,this.first=i,this.item=n,this.next=s,this.part=o,this.step=a}pull(e){return Zs.write(e,this.recon,this.items,this.inParens,this.first,this.item,this.next,this.part,this.step)}static sizeOf(e,t){let r,i=0,n=!1,s=!0;for(;void 0!==r||t.hasNext();){let o;void 0===r?o=t.next().value:(o=r,r=void 0),t.hasNext()&&(r=t.next().value),n||s||(i+=1),e.isAttr(o)?(n&&(i+=1,n=!1),i+=e.sizeOfItem(o),s=!1):n?(s?s=!1:i+=1,i+=e.sizeOfBlockItem(o)):e.isValue(o)&&!e.isRecord(o)&&(!s&&void 0===r||void 0!==r&&e.isAttr(r))?i+=e.sizeOfItem(o):(i+=1,i+=e.sizeOfItem(o),n=!0,s=!1)}return n&&(i+=1),i}static write(e,t,r,i=!1,n=!0,s,o,a,u=1){for(;;){if(1===u){if(void 0===o&&!r.hasNext()){u=5;break}void 0===o?s=r.next().value:(s=o,o=void 0),r.hasNext()&&(o=r.next().value),u=2}if(2===u&&e.isCont()&&(i||n||(e=e.write(32)),u=3),3===u&&e.isCont()&&(t.isAttr(s)?(i&&(e=e.write(41),i=!1),a=t.writeItem(e,s),n=!1,u=4):i?(n?n=!1:e=e.write(44),a=t.writeBlockItem(e,s),u=4):t.isValue(s)&&!t.isRecord(s)&&(!n&&void 0===o||void 0!==o&&t.isAttr(o))?(a=t.writeItem(e,s),u=4):(e=e.write(40),a=t.writeItem(e,s),i=!0,n=!1,u=4)),4===u){if((a=a.pull(e)).isDone()){a=void 0,u=1;continue}if(a.isError())return a.asError()}break}if(5===u){if(!i)return xe.end();if(e.isCont())return e=e.write(41),xe.end()}return e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new Zs(t,r,i,n,s,o,a,u)}}class Qs extends xe{constructor(e,t,r,i){super(),this.text=e,this.index=t,this.escape=r,this.step=i}pull(e){return Qs.write(e,this.text,this.index,this.escape,this.step)}static sizeOf(e){let t=0;for(let r=0,i=e.length;r<i;r=d.offsetByCodePoints(e,r,1)){let i=e.codePointAt(r);void 0===i&&(i=e.charCodeAt(r)),t+=36===i||64===i||91===i||92===i||93===i||123===i||125===i||8===i||12===i||10===i||13===i||9===i?2:i<32?6:nt.sizeOf(i)}return t}static write(e,t,r=0,i=0,n=1){const s=t.length;for(;e.isCont();)if(1===n){if(!(r<s))return xe.end();{let s=t.codePointAt(r);void 0===s&&(s=t.charCodeAt(r)),r=d.offsetByCodePoints(t,r,1),36===s||64===s||91===s||92===s||93===s||123===s||125===s?(e=e.write(92),i=s,n=2):8===s?(e=e.write(92),i=98,n=2):12===s?(e=e.write(92),i=102,n=2):10===s?(e=e.write(92),i=110,n=2):13===s?(e=e.write(92),i=114,n=2):9===s?(e=e.write(92),i=116,n=2):s<32?(e=e.write(92),i=s,n=3):e=e.write(s)}}else 2===n?(e=e.write(i),i=0,n=1):3===n?(e=e.write(117),n=4):4===n?(e=e.write(tt.uppercase.encodeDigit(i>>>12&15)),n=5):5===n?(e=e.write(tt.uppercase.encodeDigit(i>>>8&15)),n=6):6===n?(e=e.write(tt.uppercase.encodeDigit(i>>>4&15)),n=7):7===n&&(e=e.write(tt.uppercase.encodeDigit(15&i)),i=0,n=1);return e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new Qs(t,r,i,n)}}class $s extends xe{constructor(e,t,r){super(),this.array=e,this.part=t,this.step=r}pull(e){return $s.write(e,this.array,this.part,this.step)}static sizeOf(e){return 1+(Math.floor(4*e/3)+3&-4)}static write(e,t,r,i=1){if(1===i&&e.isCont()&&(e=e.write(37),i=2),2===i){if((r=void 0===r?ct.standard().writeUint8Array(e,t):r.pull(e)).isDone())return r=void 0,xe.end();if(r.isError())return r.asError()}return e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new $s(t,r,i)}}class Js extends xe{constructor(e,t){super(),this.ident=e,this.index=t}pull(e){return Js.write(e,this.ident,this.index)}static sizeOf(e){return nt.sizeOf(e)}static write(e,t,r=0){let i;const n=t.length;if(0===n)return xe.error(new be("empty identifier"));for(0===r&&e.isCont()&&(i=t.codePointAt(0),void 0===i&&(i=t.charCodeAt(0)),ms.isIdentStartChar(i)&&(e=e.write(i),r=d.offsetByCodePoints(t,0,1)));r<n&&e.isCont();){if(i=t.codePointAt(r),void 0===i&&(i=t.charCodeAt(r)),!ms.isIdentChar(i))return xe.error(new be("invalid identifier"));e=e.write(i),r=d.offsetByCodePoints(t,r,1)}return r>=n?xe.end():e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new Js(t,r)}}class eo extends xe{constructor(e,t,r,i){super(),this.string=e,this.index=t,this.escape=r,this.step=i}pull(e){return eo.write(e,this.string,this.index,this.escape,this.step)}static sizeOf(e){let t=0;t+=1;for(let r=0,i=e.length;r<i;r=d.offsetByCodePoints(e,r,1)){let i=e.codePointAt(r);void 0===i&&(i=e.charCodeAt(r)),t+=34===i||92===i||8===i||12===i||10===i||13===i||9===i?2:i<32?6:nt.sizeOf(i)}return t+=1,t}static write(e,t,r=0,i=0,n=1){1===n&&e.isCont()&&(e=e.write(34),n=2);const s=t.length;for(;n>=2&&n<=8&&e.isCont();)if(2===n){if(!(r<s)){n=9;break}{let s=t.codePointAt(r);void 0===s&&(s=t.charCodeAt(r)),r=d.offsetByCodePoints(t,r,1),34===s||92===s?(e=e.write(92),i=s,n=3):8===s?(e=e.write(92),i=98,n=3):12===s?(e=e.write(92),i=102,n=3):10===s?(e=e.write(92),i=110,n=3):13===s?(e=e.write(92),i=114,n=3):9===s?(e=e.write(92),i=116,n=3):s<32?(e=e.write("\\"),i=s,n=4):e=e.write(s)}}else 3===n?(e=e.write(i),i=0,n=2):4===n?(e=e.write(117),n=5):5===n?(e=e.write(tt.uppercase.encodeDigit(i>>>12&15)),n=6):6===n?(e=e.write(tt.uppercase.encodeDigit(i>>>8&15)),n=7):7===n?(e=e.write(tt.uppercase.encodeDigit(i>>>4&15)),n=8):8===n&&(e=e.write(tt.uppercase.encodeDigit(15&i)),i=0,n=2);return 9===n&&e.isCont()?(e=e.write(34),xe.end()):e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new eo(t,r,i,n)}}class to extends xe{constructor(e,t,r,i,n){super(),this.recon=e,this.bindings=t,this.template=r,this.part=i,this.step=n}pull(e){return to.write(e,this.recon,this.bindings,this.template,this.part,this.step)}static sizeOf(e,t,r){let i=0;return i+=e.sizeOfPrimary(t),i+=4,i+=e.sizeOfValue(r),i}static write(e,t,r,i,n,s=1){if(1===s)if((n=void 0===n?t.writePrimary(e,r):n.pull(e)).isDone())n=void 0,s=2;else if(n.isError())return n.asError();if(2===s&&e.isCont()&&(e=e.write(32),s=3),3===s&&e.isCont()&&(e=e.write(61),s=4),4===s&&e.isCont()&&(e=e.write(62),s=5),5===s&&e.isCont()&&(e=e.write(32),s=6),6===s){if((n=void 0===n?t.writeValue(e,i):n.pull(e)).isDone())return xe.end();if(n.isError())return n.asError()}return e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new to(t,r,i,n,s)}}class ro extends xe{constructor(e,t,r,i,n,s,o){super(),this.recon=e,this.ifTerm=t,this.thenTerm=r,this.elseTerm=i,this.precedence=n,this.part=s,this.step=o}pull(e){return ro.write(e,this.recon,this.ifTerm,this.thenTerm,this.elseTerm,this.precedence,this.part,this.step)}static sizeOf(e,t,r,i,n){let s=0;return e.precedence(t)>0&&e.precedence(t)<=n?(s+=1,s+=e.sizeOfItem(t),s+=1):s+=e.sizeOfItem(t),s+=3,s+=e.sizeOfItem(r),s+=3,s+=e.sizeOfItem(i),s}static write(e,t,r,i,n,s,o,a=1){if(1===a&&(t.precedence(r)>0&&t.precedence(r)<=s?e.isCont()&&(e=e.write(40),a=2):a=2),2===a)if((o=void 0===o?t.writeItem(e,r):o.pull(e)).isDone())o=void 0,a=3;else if(o.isError())return o.asError();if(3===a&&(t.precedence(r)>0&&t.precedence(r)<=s?e.isCont()&&(e=e.write(41),a=4):a=4),4===a&&e.isCont()&&(e=e.write(32),a=5),5===a&&e.isCont()&&(e=e.write(63),a=6),6===a&&e.isCont()&&(e=e.write(32),a=7),7===a)if((o=void 0===o?t.writeItem(e,i):o.pull(e)).isDone())o=void 0,a=8;else if(o.isError())return o.asError();if(8===a&&e.isCont()&&(e=e.write(32),a=9),9===a&&e.isCont()&&(e=e.write(58),a=10),10===a&&e.isCont()&&(e=e.write(32),a=11),11===a){if((o=void 0===o?t.writeItem(e,n):o.pull(e)).isDone())return xe.end();if(o.isError())return o.asError()}return e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new ro(t,r,i,n,s,o,a)}}class io extends xe{constructor(e,t,r,i,n,s,o){super(),this.recon=e,this.lhs=t,this.operator=r,this.rhs=i,this.precedence=n,this.part=s,this.step=o}pull(e){return io.write(e,this.recon,this.lhs,this.operator,this.rhs,this.precedence,this.part,this.step)}static sizeOf(e,t,r,i,n){let s=0;return e.precedence(t)<n?(s+=1,s+=e.sizeOfItem(t),s+=1):s+=e.sizeOfItem(t),s+=1,s+=nt.sizeOf(r),s+=1,e.precedence(i)<n?(s+=1,s+=e.sizeOfItem(i),s+=1):s+=e.sizeOfItem(i),s}static write(e,t,r,i,n,s,o,a=1){if(1===a&&(t.precedence(r)<s?e.isCont()&&(e=e.write(40),a=2):a=2),2===a)if((o=void 0===o?t.writeItem(e,r):o.pull(e)).isDone())o=void 0,a=3;else if(o.isError())return o.asError();if(3===a&&(t.precedence(r)<s?e.isCont()&&(e=e.write(41),a=4):a=4),4===a&&e.isCont()&&(e=e.write(32),a=5),5===a)if((o=void 0===o?Se.writeString(e,i):o.pull(e)).isDone())o=void 0,a=6;else if(o.isError())return o.asError();if(6===a&&e.isCont()&&(e=e.write(32),a=7),7===a&&(t.precedence(n)<s?e.isCont()&&(e=e.write(40),a=8):a=8),8===a)if((o=void 0===o?t.writeItem(e,n):o.pull(e)).isDone())o=void 0,a=9;else if(o.isError())return o.asError();if(9===a){if(!(t.precedence(n)<s))return xe.end();if(e.isCont())return e=e.write(41),xe.end()}return e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new io(t,r,i,n,s,o,a)}}class no extends xe{constructor(e,t,r,i,n,s){super(),this.recon=e,this.operator=t,this.rhs=r,this.precedence=i,this.part=n,this.step=s}pull(e){return no.write(e,this.recon,this.operator,this.rhs,this.precedence,this.part,this.step)}static sizeOf(e,t,r,i){let n=0;return n+=nt.sizeOf(t),e.precedence(r)<i?(n+=1,n+=e.sizeOfItem(r),n+=1):n+=e.sizeOfItem(r),n}static write(e,t,r,i,n,s,o=1){if(1===o)if((s=void 0===s?Se.writeString(e,r):s.pull(e)).isDone())s=void 0,o=2;else if(s.isError())return s.asError();if(2===o&&(t.precedence(i)<n?e.isCont()&&(e=e.write(40),o=3):o=3),3===o)if((s=void 0===s?t.writeItem(e,i):s.pull(e)).isDone())s=void 0,o=4;else if(s.isError())return s.asError();if(4===o){if(!(t.precedence(i)<n))return xe.end();if(e.isCont())return e=e.write(41),xe.end()}return e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new no(t,r,i,n,s,o)}}class so extends xe{constructor(e,t,r,i,n){super(),this.recon=e,this.func=t,this.args=r,this.part=i,this.step=n}pull(e){return so.write(e,this.recon,this.func,this.args,this.part,this.step)}static sizeOf(e,t,r){let i=0;return i+=e.sizeOfValue(t),i+=1,i+=e.sizeOfBlockValue(r),i+=1,i}static write(e,t,r,i,n,s=1){if(1===s)if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())n=void 0,s=2;else if(n.isError())return n.asError();if(2===s&&e.isCont()&&(e=e.write(40),s=3),3===s)if((n=void 0===n?t.writeBlockValue(e,i):n.pull(e)).isDone())n=void 0,s=4;else if(n.isError())return n.asError();return 4===s&&e.isCont()?(e=e.write(41),xe.end()):e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new so(t,r,i,n,s)}}class oo extends xe{constructor(e,t,r,i,n){super(),this.recon=e,this.item=t,this.then=r,this.part=i,this.step=n}pull(e){return oo.write(e,this.recon,this.item,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=0;return e.precedence(t)<e.precedence(e.item(r))?(i+=1,i+=e.sizeOfItem(t),i+=1):i+=e.sizeOfItem(t),i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&(t.precedence(r)<t.precedence(t.item(i))?e.isCont()&&(e=e.write(40),s=2):s=2),2===s)if((n=void 0===n?t.writeItem(e,r):n.pull(e)).isDone())n=void 0,s=3;else if(n.isError())return n.asError();return 3===s&&(t.precedence(r)<t.precedence(t.item(i))?e.isCont()&&(e=e.write(41),s=4):s=4),4===s?t.writeThen(e,i):e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new oo(t,r,i,n,s)}}class ao extends xe{constructor(e,t,r,i,n){super(),this.recon=e,this.key=t,this.then=r,this.part=i,this.step=n}pull(e){return ao.write(e,this.recon,this.key,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=1;return e.isRecord(e.item(t))?(i+=1,i+=e.sizeOfBlockValue(t),i+=1):i+=e.sizeOfValue(t),i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()?(e=e.write(36),s=3):2===s&&e.isCont()&&(e=e.write(46),s=3),3===s&&(t.isRecord(t.item(r))?e.isCont()&&(e=e.write(123),s=4):s=4),4===s)if((n=void 0===n?t.isRecord(t.item(r))?t.writeBlockValue(e,r):t.writeValue(e,r):n.pull(e)).isDone())n=void 0,s=5;else if(n.isError())return n.asError();return 5===s&&(t.isRecord(t.item(r))?e.isCont()&&(e=e.write(125),s=6):s=6),6===s?t.writeThen(e,i):e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new ao(t,r,i,n,s)}static writeThen(e,t,r,i){return ao.write(e,t,r,i,void 0,2)}}class uo extends xe{constructor(e,t,r,i,n){super(),this.recon=e,this.key=t,this.then=r,this.part=i,this.step=n}pull(e){return uo.write(e,this.recon,this.key,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=2;return i+=e.sizeOfValue(t),i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()?(e=e.write(36),s=3):2===s&&e.isCont()&&(e=e.write(46),s=3),3===s&&e.isCont()&&(e=e.write(64),s=4),4===s){if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())return t.writeThen(e,i);if(n.isError())return n.asError()}return e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new uo(t,r,i,n,s)}static writeThen(e,t,r,i){return uo.write(e,t,r,i,void 0,2)}}class ho extends xe{constructor(e,t,r,i,n){super(),this.recon=e,this.index=t,this.then=r,this.part=i,this.step=n}pull(e){return ho.write(e,this.recon,this.index,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=2;return i+=e.sizeOfValue(t),i+=e.sizeOfThen(r),i}static sizeOfThen(e,t,r){let i=1;return i+=e.sizeOfValue(t),i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()&&(e=e.write(36),s=2),2===s&&e.isCont()&&(e=e.write(35),s=3),3===s){if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())return t.writeThen(e,i);if(n.isError())return n.asError()}return e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new ho(t,r,i,n,s)}static writeThen(e,t,r,i){return ho.write(e,t,r,i,void 0,2)}}class lo extends xe{constructor(e,t,r){super(),this.recon=e,this.then=t,this.step=r}pull(e){return lo.write(e,this.recon,this.then,this.step)}static sizeOf(e,t){let r=3;return r+=e.sizeOfThen(t),r}static write(e,t,r,i=1){return 1===i&&e.isCont()?(e=e.write(36),i=3):2===i&&e.isCont()&&(e=e.write(46),i=3),3===i&&e.isCont()&&(e=e.write(42),i=4),4===i&&e.isCont()?(e=e.write(58),t.writeThen(e,r)):e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new lo(t,r,i)}static writeThen(e,t,r){return lo.write(e,t,r,2)}}class co extends xe{constructor(e,t,r){super(),this.recon=e,this.then=t,this.step=r}pull(e){return co.write(e,this.recon,this.then,this.step)}static sizeOf(e,t){let r=3;return r+=e.sizeOfThen(t),r}static write(e,t,r,i=1){return 1===i&&e.isCont()?(e=e.write(36),i=3):2===i&&e.isCont()&&(e=e.write(46),i=3),3===i&&e.isCont()&&(e=e.write(58),i=4),4===i&&e.isCont()?(e=e.write(42),t.writeThen(e,r)):e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new co(t,r,i)}static writeThen(e,t,r){return co.write(e,t,r,2)}}class po extends xe{constructor(e,t,r){super(),this.recon=e,this.then=t,this.step=r}pull(e){return po.write(e,this.recon,this.then,this.step)}static sizeOf(e,t){let r=2;return r+=e.sizeOfThen(t),r}static write(e,t,r,i=1){return 1===i&&e.isCont()?(e=e.write(36),i=3):2===i&&e.isCont()&&(e=e.write(46),i=3),3===i&&e.isCont()?(e=e.write(42),t.writeThen(e,r)):e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new po(t,r,i)}static writeThen(e,t,r){return po.write(e,t,r,2)}}class fo extends xe{constructor(e,t,r){super(),this.recon=e,this.then=t,this.step=r}pull(e){return fo.write(e,this.recon,this.then,this.step)}static sizeOf(e,t){let r=3;return r+=e.sizeOfThen(t),r}static write(e,t,r,i=1){return 1===i&&e.isCont()?(e=e.write(36),i=3):2===i&&e.isCont()&&(e=e.write(46),i=3),3===i&&e.isCont()&&(e=e.write(42),i=4),4===i&&e.isCont()?(e=e.write(42),t.writeThen(e,r)):e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new fo(t,r,i)}static writeThen(e,t,r){return fo.write(e,t,r,2)}}class mo extends xe{constructor(e,t,r,i,n){super(),this.recon=e,this.predicate=t,this.then=r,this.part=i,this.step=n}pull(e){return mo.write(e,this.recon,this.predicate,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=2;return i+=e.sizeOfValue(t),i+=1,i+=e.sizeOfThen(r),i}static sizeOfThen(e,t,r){let i=1;return i+=e.sizeOfValue(t),i+=1,i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()&&(e=e.write(36),s=2),2===s&&e.isCont()&&(e=e.write(91),s=3),3===s)if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())n=void 0,s=4;else if(n.isError())return n.asError();return 4===s&&e.isCont()?(e=e.write(93),t.writeThen(e,i)):e.isDone()?xe.error(new be("truncated")):e.isError()?xe.error(e.trap()):new mo(t,r,i,n,s)}static writeThen(e,t,r,i){return mo.write(e,t,r,i,void 0,2)}}class yo{sizeOfAttr(e,t){return _s.sizeOf(this,e,t)}writeAttr(e,t,r){return _s.write(e,this,t,r)}sizeOfSlot(e,t){return Gs.sizeOf(this,e,t)}writeSlot(e,t,r){return Gs.write(e,this,t,r)}sizeOfBlock(e,t,r){if(3===arguments.length)return Ys.sizeOf(this,e,t,r);{const t=this.items(e);return t.hasNext()?Ys.sizeOf(this,t,this.isBlockSafe(this.items(e)),!1):2}}writeBlock(e,t,r,i){if(4===arguments.length)return Ys.write(e,this,t,r,i);{const r=this.items(t);return r.hasNext()?Ys.write(e,this,r,this.isBlockSafe(this.items(t)),!1):Se.writeString(e,"{}")}}sizeOfRecord(e){const t=this.items(e);return t.hasNext()?Ys.sizeOf(this,t,!1,!1):2}writeRecord(e,t){const r=this.items(t);return r.hasNext()?Ys.write(e,this,r,!1,!1):Se.writeString(e,"{}")}sizeOfPrimary(e){if(this.isRecord(this.item(e))){const t=this.items(this.item(e));if(t.hasNext())return Zs.sizeOf(this,t)}else if(!this.isExtant(this.item(e)))return this.sizeOfValue(e);return 2}writePrimary(e,t){if(this.isRecord(this.item(t))){const r=this.items(this.item(t));if(r.hasNext())return Zs.write(e,this,r)}else if(!this.isExtant(this.item(t)))return this.writeValue(e,t);return Se.writeString(e,"()")}isBlockSafe(e){for(;e.hasNext();)if(this.isAttr(e.next().value))return!1;return!0}isMarkupSafe(e){if(!e.hasNext()||!this.isAttr(e.next().value))return!1;for(;e.hasNext();)if(this.isAttr(e.next().value))return!1;return!0}sizeOfMarkupText(e){return"string"!=typeof e&&(e=this.string(e)),Qs.sizeOf(e)}writeMarkupText(e,t){return"string"!=typeof t&&(t=this.string(t)),Qs.write(e,t)}sizeOfData(e){return $s.sizeOf(e)}writeData(e,t){return void 0!==t?$s.write(e,t):Se.writeString(e,"%")}isIdent(e){"string"!=typeof e&&(e=this.string(e));const t=e.length;let r;if(0===t||(r=e.codePointAt(0),void 0!==r&&!ms.isIdentStartChar(r)))return!1;for(let i=d.offsetByCodePoints(e,0,1);i<t;i=d.offsetByCodePoints(e,i,1))if(r=e.codePointAt(i),void 0===r||!ms.isIdentChar(r))return!1;return!0}sizeOfText(e){return this.isIdent(e)?Js.sizeOf(e):eo.sizeOf(e)}writeText(e,t){return this.isIdent(t)?Js.write(e,t):eo.write(e,t)}sizeOfNum(e){if(isFinite(e)&&Math.floor(e)===e&&Math.abs(e)<2147483648){let t=Ee.countDigits(e);return e<0&&(t+=1),t}return(""+e).length}writeNum(e,t){return isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<2147483648?Ee.writeInteger(e,t):Se.writeString(e,""+t)}sizeOfUint32(e){return 10}writeUint32(e,t){return tt.lowercase.writeIntegerLiteral(e,t,8)}sizeOfUint64(e){return 18}writeUint64(e,t){return tt.lowercase.writeIntegerLiteral(e,t,16)}sizeOfBool(e){return e?4:5}writeBool(e,t){return Se.writeString(e,t?"true":"false")}sizeOfLambdaFunc(e,t){return to.sizeOf(this,e,t)}writeLambdaFunc(e,t,r){return to.write(e,this,t,r)}sizeOfConditionalOperator(e,t,r,i){return ro.sizeOf(this,e,t,r,i)}writeConditionalOperator(e,t,r,i,n){return ro.write(e,this,t,r,i,n)}sizeOfInfixOperator(e,t,r,i){return io.sizeOf(this,e,t,r,i)}writeInfixOperator(e,t,r,i,n){return io.write(e,this,t,r,i,n)}sizeOfPrefixOperator(e,t,r){return no.sizeOf(this,e,t,r)}writePrefixOperator(e,t,r,i){return no.write(e,this,t,r,i)}sizeOfInvokeOperator(e,t){return so.sizeOf(this,e,t)}writeInvokeOperator(e,t,r){return so.write(e,this,t,r)}sizeOfIdentitySelector(){return 0}writeIdentitySelector(e){return xe.end()}sizeOfThenIdentitySelector(){return 0}writeThenIdentitySelector(e){return xe.end()}sizeOfLiteralSelector(e,t){return oo.sizeOf(this,e,t)}writeLiteralSelector(e,t,r){return oo.write(e,this,t,r)}sizeOfThenLiteralSelector(e,t){return 0}writeThenLiteralSelector(e,t,r){return xe.end()}sizeOfGetSelector(e,t){return ao.sizeOf(this,e,t)}writeGetSelector(e,t,r){return ao.write(e,this,t,r)}sizeOfThenGetSelector(e,t){return ao.sizeOf(this,e,t)}writeThenGetSelector(e,t,r){return ao.writeThen(e,this,t,r)}sizeOfGetAttrSelector(e,t){return uo.sizeOf(this,e,t)}writeGetAttrSelector(e,t,r){return uo.write(e,this,t,r)}sizeOfThenGetAttrSelector(e,t){return uo.sizeOf(this,e,t)}writeThenGetAttrSelector(e,t,r){return uo.writeThen(e,this,t,r)}sizeOfGetItemSelector(e,t){return ho.sizeOf(this,e,t)}writeGetItemSelector(e,t,r){return ho.write(e,this,t,r)}sizeOfThenGetItemSelector(e,t){return ho.sizeOfThen(this,e,t)}writeThenGetItemSelector(e,t,r){return ho.writeThen(e,this,t,r)}sizeOfKeysSelector(e){return lo.sizeOf(this,e)}writeKeysSelector(e,t){return lo.write(e,this,t)}sizeOfThenKeysSelector(e){return lo.sizeOf(this,e)}writeThenKeysSelector(e,t){return lo.writeThen(e,this,t)}sizeOfValuesSelector(e){return co.sizeOf(this,e)}writeValuesSelector(e,t){return co.write(e,this,t)}sizeOfThenValuesSelector(e){return co.sizeOf(this,e)}writeThenValuesSelector(e,t){return co.writeThen(e,this,t)}sizeOfChildrenSelector(e){return po.sizeOf(this,e)}writeChildrenSelector(e,t){return po.write(e,this,t)}sizeOfThenChildrenSelector(e){return po.sizeOf(this,e)}writeThenChildrenSelector(e,t){return po.writeThen(e,this,t)}sizeOfDescendantsSelector(e){return fo.sizeOf(this,e)}writeDescendantsSelector(e,t){return fo.write(e,this,t)}sizeOfThenDescendantsSelector(e){return fo.sizeOf(this,e)}writeThenDescendantsSelector(e,t){return fo.writeThen(e,this,t)}sizeOfFilterSelector(e,t){return mo.sizeOf(this,e,t)}writeFilterSelector(e,t,r){return mo.write(e,this,t,r)}sizeOfThenFilterSelector(e,t){return mo.sizeOfThen(this,e,t)}writeThenFilterSelector(e,t,r){return mo.writeThen(e,this,t,r)}sizeOfExtant(){return 0}writeExtant(e){return xe.end()}sizeOfAbsent(){return 0}writeAbsent(e){return xe.end()}}class wo extends yo{isField(e){return e instanceof mr}isAttr(e){return e instanceof gr}isSlot(e){return e instanceof yr}isValue(e){return e instanceof xr}isRecord(e){return e instanceof Cr}isText(e){return e instanceof Tr}isNum(e){return e instanceof Mr}isBool(e){return e instanceof qr}isExpression(e){return e instanceof zr}isExtant(e){return e instanceof Fr}items(e){return e.iterator()}item(e){return e}key(e){return e.key}value(e){return e.toValue()}string(e){return e.stringValue("")}precedence(e){return e.precedence}sizeOfItem(e){if(e instanceof mr){if(e instanceof gr)return this.sizeOfAttr(e.key,e.value);if(e instanceof yr)return this.sizeOfSlot(e.key,e.value)}else if(e instanceof xr)return this.sizeOfValue(e);throw new be("No Recon serialization for "+e)}writeItem(e,t){if(t instanceof mr){if(t instanceof gr)return this.writeAttr(e,t.key,t.value);if(t instanceof yr)return this.writeSlot(e,t.key,t.value)}else if(t instanceof xr)return this.writeValue(e,t);return xe.error(new be("No Recon serialization for "+t))}sizeOfValue(e){if(e instanceof Cr)return this.sizeOfRecord(e);if(e instanceof Dr)return this.sizeOfData(e.size);if(e instanceof Tr)return this.sizeOfText(e.value);if(e instanceof Mr)return e.isUint32()?this.sizeOfUint32(e.value):e.isUint64()?this.sizeOfUint64(e.value):this.sizeOfNum(e.value);if(e instanceof qr)return this.sizeOfBool(e.value);if(e instanceof yi)return this.sizeOfSelector(e);if(e instanceof Ur)return this.sizeOfOperator(e);if(e instanceof ki)return this.sizeOfFunc(e);if(e instanceof Fr)return this.sizeOfExtant();if(e instanceof Nr)return this.sizeOfAbsent();throw new be("No Recon serialization for "+e)}writeValue(e,t){return t instanceof Cr?this.writeRecord(e,t):t instanceof Dr?this.writeData(e,t.asUint8Array()):t instanceof Tr?this.writeText(e,t.value):t instanceof Mr?t.isUint32()?this.writeUint32(e,t.value):t.isUint64()?this.writeUint64(e,t.value):this.writeNum(e,t.value):t instanceof qr?this.writeBool(e,t.value):t instanceof yi?this.writeSelector(e,t):t instanceof Ur?this.writeOperator(e,t):t instanceof ki?this.writeFunc(e,t):t instanceof Fr?this.writeExtant(e):t instanceof Nr?this.writeAbsent(e):xe.error(new be("No Recon serialization for "+t))}sizeOfSelector(e){if(e instanceof wi)return this.sizeOfIdentitySelector();if(e instanceof Ai)return this.sizeOfLiteralSelector(e.item,e.then);if(e instanceof gi)return this.sizeOfGetSelector(e.item,e.then);if(e instanceof vi)return this.sizeOfGetAttrSelector(e.item,e.then);if(e instanceof bi)return this.sizeOfGetItemSelector(e.item,e.then);if(e instanceof xi)return this.sizeOfKeysSelector(e.then);if(e instanceof Ci)return this.sizeOfValuesSelector(e.then);if(e instanceof Si)return this.sizeOfChildrenSelector(e.then);if(e instanceof Oi)return this.sizeOfDescendantsSelector(e.then);if(e instanceof Ei)return this.sizeOfFilterSelector(e.predicate,e.then);throw new be("No Recon serialization for "+e)}writeSelector(e,t){return t instanceof wi?this.writeIdentitySelector(e):t instanceof Ai?this.writeLiteralSelector(e,t.item,t.then):t instanceof gi?this.writeGetSelector(e,t.item,t.then):t instanceof vi?this.writeGetAttrSelector(e,t.item,t.then):t instanceof bi?this.writeGetItemSelector(e,t.item,t.then):t instanceof xi?this.writeKeysSelector(e,t.then):t instanceof Ci?this.writeValuesSelector(e,t.then):t instanceof Si?this.writeChildrenSelector(e,t.then):t instanceof Oi?this.writeDescendantsSelector(e,t.then):t instanceof Ei?this.writeFilterSelector(e,t.predicate,t.then):xe.error(new be("No Recon serialization for "+t))}sizeOfOperator(e){if(e instanceof Rr)return this.sizeOfInfixOperator(e.operand1,e.operator,e.operand2,e.precedence);if(e instanceof Lr)return this.sizeOfPrefixOperator(e.operator,e.operand,e.precedence);if(e instanceof fi)return this.sizeOfInvokeOperator(e.func,e.args);if(e instanceof Kr)return this.sizeOfConditionalOperator(e.ifTerm,e.thenTerm,e.elseTerm,e.precedence);throw new be("No Recon serialization for "+e)}writeOperator(e,t){return t instanceof Rr?this.writeInfixOperator(e,t.operand1,t.operator,t.operand2,t.precedence):t instanceof Lr?this.writePrefixOperator(e,t.operator,t.operand,t.precedence):t instanceof fi?this.writeInvokeOperator(e,t.func,t.args):t instanceof Kr?this.writeConditionalOperator(e,t.ifTerm,t.thenTerm,t.elseTerm,t.precedence):xe.error(new be("No Recon serialization for "+t))}sizeOfFunc(e){if(e instanceof Di)return this.sizeOfLambdaFunc(e.bindings,e.template);if(e instanceof Pi)return 0;throw new be("No Recon serialization for "+e)}writeFunc(e,t){return t instanceof Di?this.writeLambdaFunc(e,t.bindings,t.template):t instanceof Pi?xe.end():xe.error(new be("No Recon serialization for "+t))}sizeOfBlockItem(e){if(e instanceof mr)return this.sizeOfItem(e);if(e instanceof xr)return this.sizeOfBlockValue(e);throw new be("No Recon serialization for "+e)}writeBlockItem(e,t){return t instanceof mr?this.writeItem(e,t):t instanceof xr?this.writeBlockValue(e,t):xe.error(new be("No Recon serialization for "+t))}sizeOfBlockValue(e){return e instanceof Cr?this.sizeOfBlock(e):this.sizeOfValue(e)}writeBlockValue(e,t){return t instanceof Cr?this.writeBlock(e,t):this.writeValue(e,t)}sizeOfThen(e){if(e instanceof yi){if(e instanceof wi)return this.sizeOfThenIdentitySelector();if(e instanceof Ai)return this.sizeOfThenLiteralSelector(e.item,e.then);if(e instanceof gi)return this.sizeOfThenGetSelector(e.item,e.then);if(e instanceof vi)return this.sizeOfThenGetAttrSelector(e.item,e.then);if(e instanceof bi)return this.sizeOfThenGetItemSelector(e.item,e.then);if(e instanceof xi)return this.sizeOfThenKeysSelector(e.then);if(e instanceof Ci)return this.sizeOfThenValuesSelector(e.then);if(e instanceof Si)return this.sizeOfThenChildrenSelector(e.then);if(e instanceof Oi)return this.sizeOfThenDescendantsSelector(e.then);if(e instanceof Ei)return this.sizeOfThenFilterSelector(e.predicate,e.then)}throw new be("No Recon serialization for "+e)}writeThen(e,t){if(t instanceof yi){if(t instanceof wi)return this.writeThenIdentitySelector(e);if(t instanceof Ai)return this.writeThenLiteralSelector(e,t.item,t.then);if(t instanceof gi)return this.writeThenGetSelector(e,t.item,t.then);if(t instanceof vi)return this.writeThenGetAttrSelector(e,t.item,t.then);if(t instanceof bi)return this.writeThenGetItemSelector(e,t.item,t.then);if(t instanceof xi)return this.writeThenKeysSelector(e,t.then);if(t instanceof Ci)return this.writeThenValuesSelector(e,t.then);if(t instanceof Si)return this.writeThenChildrenSelector(e,t.then);if(t instanceof Oi)return this.writeThenDescendantsSelector(e,t.then);if(t instanceof Ei)return this.writeThenFilterSelector(e,t.predicate,t.then)}return xe.error(new be("No Recon serialization for "+t))}}class go extends Error{constructor(e){super(e instanceof Ae?e.message:e),Object.setPrototypeOf(this,go.prototype),this.diagnostic=e instanceof Ae?e:null}toString(){return null!==this.diagnostic?this.diagnostic.toString():super.toString()}}class vo{constructor(e,t,r,i,n){this.scheme=e,this.authority=t,this.path=r,this.query=i,this.fragment=n,this.hashValue=void 0,this.stringValue=void 0}isDefined(){return this.scheme.isDefined()||this.authority.isDefined()||this.path.isDefined()||this.query.isDefined()||this.fragment.isDefined()}isEmpty(){return!this.scheme.isDefined()&&!this.authority.isDefined()&&this.path.isEmpty()&&!this.query.isDefined()&&!this.fragment.isDefined()}withScheme(e){return(e=bo.fromAny(e))!==this.scheme?this.copy(e,this.authority,this.path,this.query,this.fragment):this}get schemePart(){return this.scheme.toString()}withSchemePart(e){return this.withScheme(bo.parse(e))}get schemeName(){return this.scheme.name}withSchemeName(e){return this.withScheme(bo.create(e))}withAuthority(e){return(e=xo.fromAny(e))!==this.authority?this.copy(this.scheme,e,this.path,this.query,this.fragment):this}get authorityPart(){return this.authority.toString()}withAuthorityPart(e){return this.withAuthority(xo.parse(e))}get user(){return this.authority.user}withUser(e){return this.withAuthority(this.authority.withUser(e))}get userPart(){return this.authority.userPart}withUserPart(e){return this.withAuthority(this.authority.withUserPart(e))}get username(){return this.authority.username}withUsername(e,t){return 1===arguments.length?this.withAuthority(this.authority.withUsername(e)):this.withAuthority(this.authority.withUsername(e,t))}get password(){return this.authority.password}withPassword(e){return this.withAuthority(this.authority.withPassword(e))}get host(){return this.authority.host}withHost(e){return this.withAuthority(this.authority.withHost(e))}get hostPart(){return this.authority.hostPart}withHostPart(e){return this.withAuthority(this.authority.withHostPart(e))}get hostAddress(){return this.authority.hostAddress}get hostName(){return this.authority.hostName}withHostName(e){return this.withAuthority(this.authority.withHostName(e))}get hostIPv4(){return this.authority.hostIPv4}withHostIPv4(e){return this.withAuthority(this.authority.withHostIPv4(e))}get hostIPv6(){return this.authority.hostIPv6}withHostIPv6(e){return this.withAuthority(this.authority.withHostIPv6(e))}get port(){return this.authority.port}withPort(e){return this.withAuthority(this.authority.withPort(e))}get portPart(){return this.authority.portPart}withPortPart(e){return this.withAuthority(this.authority.withPortPart(e))}get portNumber(){return this.authority.portNumber}withPortNumber(e){return this.withAuthority(this.authority.withPortNumber(e))}withPath(...e){const t=Po.of(...e);return t!==this.path?this.copy(this.scheme,this.authority,t,this.query,this.fragment):this}get pathPart(){return this.path.toString()}withPathPart(e){return this.withPath(Po.parse(e))}get pathName(){return this.path.name}withPathName(e){return this.withPath(this.path.withName(e))}parentPath(){return this.path.parent()}basePath(){return this.path.base()}parent(){return vo.create(this.scheme,this.authority,this.path.parent())}base(){return vo.create(this.scheme,this.authority,this.path.base())}appendedPath(...e){return this.withPath(this.path.appended(...e))}appendedSlash(){return this.withPath(this.path.appendedSlash())}appendedSegment(e){return this.withPath(this.path.appendedSegment(e))}prependedPath(...e){return this.withPath(this.path.prepended(...e))}prependedSlash(){return this.withPath(this.path.prependedSlash())}prependedSegment(e){return this.withPath(this.path.prependedSegment(e))}withQuery(e){return(e=Fo.fromAny(e))!==this.query?this.copy(this.scheme,this.authority,this.path,e,this.fragment):this}get queryPart(){return this.query.toString()}withQueryPart(e){return this.withQuery(Fo.parse(e))}updatedQuery(e,t){return this.withQuery(this.query.updated(e,t))}removedQuery(e){return this.withQuery(this.query.removed(e))}appendedQuery(e,t){return this.withQuery(this.query.appended(e,t))}prependedQuery(e,t){return this.withQuery(this.query.prepended(e,t))}withFragment(e){return(e=Ro.fromAny(e))!==this.fragment?vo.create(this.scheme,this.authority,this.path,this.query,e):this}get fragmentPart(){return this.fragment.toString()}withFragmentPart(e){return this.withFragment(Ro.parse(e))}get fragmentIdentifier(){return this.fragment.identifier}withFragmentIdentifier(e){return this.withFragment(Ro.create(e))}endpoint(){return this.path.isDefined()||this.query.isDefined()||this.fragment.isDefined()?vo.create(this.scheme,this.authority):this}resolve(e){const t=vo.fromAny(e);return t.scheme.isDefined()?this.copy(t.scheme,t.authority,t.path.removeDotSegments(),t.query,t.fragment):t.authority.isDefined()?this.copy(this.scheme,t.authority,t.path.removeDotSegments(),t.query,t.fragment):t.path.isEmpty()?this.copy(this.scheme,this.authority,this.path,t.query.isDefined()?t.query:this.query,t.fragment):t.path.isAbsolute()?this.copy(this.scheme,this.authority,t.path.removeDotSegments(),t.query,t.fragment):this.copy(this.scheme,this.authority,this.merge(t.path).removeDotSegments(),t.query,t.fragment)}merge(e){return this.authority.isDefined()&&this.path.isEmpty()?e.prependedSlash():this.path.isEmpty()?e:this.path.merge(e)}unresolve(e){const t=vo.fromAny(e);return this.scheme.equals(t.scheme)&&this.authority.equals(t.authority)?vo.create(bo.undefined(),xo.undefined(),this.path.unmerge(t.path),t.query,t.fragment):t}copy(e,t,r,i,n){return vo.create(e,t,r,i,n)}toAny(){const e={};return e.scheme=this.scheme.toAny(),this.authority.toAny(e),e.path=this.path.toAny(),e.query=this.query.toAny(),e.fragment=this.fragment.toAny(),e}compareTo(e){return e instanceof vo?this.toString().localeCompare(e.toString()):NaN}equals(e){return this===e||e instanceof vo&&this.toString()===e.toString()}hashCode(){let e=this.hashValue;return void 0===e&&(e=d.hash(this.toString()),this.hashValue=e),e}debug(e){return e=e.write("Uri").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("empty").write(40).write(41)}display(e){const t=this.stringValue;return void 0!==t?e=e.write(t):(this.scheme.isDefined()&&(e=e.display(this.scheme).write(58)),this.authority.isDefined()&&(e=e.write(47).write(47).display(this.authority)),e=e.display(this.path),this.query.isDefined()&&(e=e.write(63).display(this.query)),this.fragment.isDefined()&&(e=e.write(35).display(this.fragment))),e}toString(){let e=this.stringValue;return void 0===e&&(e=Oe.display(this),this.stringValue=e),e}static empty(){return new vo(bo.undefined(),xo.undefined(),Po.empty(),Fo.undefined(),Ro.undefined())}static create(e=bo.undefined(),t=xo.undefined(),r=Po.empty(),i=Fo.undefined(),n=Ro.undefined()){return e.isDefined()||t.isDefined()||r.isDefined()||i.isDefined()||n.isDefined()?new vo(e,t,r,i,n):vo.empty()}static fromInit(e){const t=bo.fromAny(e.scheme),r=xo.fromAny(void 0!==e.authority?e.authority:e),i=Po.fromAny(e.path),n=Fo.fromAny(e.query),s=Ro.fromAny(e.fragment);return t.isDefined()||r.isDefined()||i.isDefined()||n.isDefined()||s.isDefined()?new vo(t,r,i,n,s):vo.empty()}static fromAny(e){if(null==e)return vo.empty();if(e instanceof vo)return e;if("object"==typeof e)return vo.fromInit(e);if("string"==typeof e)return vo.parse(e);throw new TypeError(""+e)}static scheme(e){return e=bo.fromAny(e),vo.create(e,void 0,void 0,void 0,void 0)}static schemePart(e){const t=bo.parse(e);return vo.create(t,void 0,void 0,void 0,void 0)}static schemeName(e){const t=bo.create(e);return vo.create(t,void 0,void 0,void 0,void 0)}static authority(e){return e=xo.fromAny(e),vo.create(void 0,e,void 0,void 0,void 0)}static authorityPart(e){const t=xo.parse(e);return vo.create(void 0,t,void 0,void 0,void 0)}static user(e){const t=xo.user(e);return vo.create(void 0,t,void 0,void 0,void 0)}static userPart(e){const t=xo.userPart(e);return vo.create(void 0,t,void 0,void 0,void 0)}static username(e,t){const r=xo.username(e,t);return vo.create(void 0,r,void 0,void 0,void 0)}static password(e){const t=xo.password(e);return vo.create(void 0,t,void 0,void 0,void 0)}static host(e){const t=xo.host(e);return vo.create(void 0,t,void 0,void 0,void 0)}static hostPart(e){const t=xo.hostPart(e);return vo.create(void 0,t,void 0,void 0,void 0)}static hostName(e){const t=xo.hostName(e);return vo.create(void 0,t,void 0,void 0,void 0)}static hostIPv4(e){const t=xo.hostIPv4(e);return vo.create(void 0,t,void 0,void 0,void 0)}static hostIPv6(e){const t=xo.hostIPv6(e);return vo.create(void 0,t,void 0,void 0,void 0)}static port(e){const t=xo.port(e);return vo.create(void 0,t,void 0,void 0,void 0)}static portPart(e){const t=xo.portPart(e);return vo.create(void 0,t,void 0,void 0,void 0)}static portNumber(e){const t=xo.portNumber(e);return vo.create(void 0,t,void 0,void 0,void 0)}static path(...e){const t=Po.of(...e);return vo.create(void 0,void 0,t,void 0,void 0)}static pathPart(e){const t=Po.parse(e);return vo.create(void 0,void 0,t,void 0,void 0)}static query(e){return e=Fo.fromAny(e),vo.create(void 0,void 0,void 0,e,void 0)}static queryPart(e){const t=Fo.parse(e);return vo.create(void 0,void 0,void 0,t,void 0)}static fragment(e){return e=Ro.fromAny(e),vo.create(void 0,void 0,void 0,void 0,e)}static fragmentPart(e){const t=Ro.parse(e);return vo.create(void 0,void 0,void 0,void 0,t)}static fragmentIdentifier(e){const t=Ro.create(e);return vo.create(void 0,void 0,void 0,void 0,t)}static get standardParser(){return new Bo}static parse(e){return vo.standardParser.parseAbsoluteString(e)}static pathBuilder(){return new Vo}static queryBuilder(){return new Uo}static form(){return new jo(vo.empty())}static isUnreservedChar(e){return e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||45===e||46===e||95===e||126===e}static isSubDelimChar(e){return 33===e||36===e||38===e||40===e||41===e||42===e||43===e||44===e||59===e||61===e||39===e}static isSchemeChar(e){return e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||43===e||45===e||46===e}static isUserInfoChar(e){return vo.isUnreservedChar(e)||vo.isSubDelimChar(e)||58===e}static isUserChar(e){return vo.isUnreservedChar(e)||vo.isSubDelimChar(e)}static isHostChar(e){return vo.isUnreservedChar(e)||vo.isSubDelimChar(e)}static isPathChar(e){return vo.isUnreservedChar(e)||vo.isSubDelimChar(e)||58===e||64===e}static isQueryChar(e){return vo.isUnreservedChar(e)||vo.isSubDelimChar(e)||47===e||58===e||63===e||64===e}static isParamChar(e){return vo.isUnreservedChar(e)||33===e||36===e||40===e||41===e||42===e||43===e||44===e||47===e||58===e||59===e||63===e||64===e||39===e}static isFragmentChar(e){return vo.isUnreservedChar(e)||vo.isSubDelimChar(e)||47===e||58===e||63===e||64===e}static isAlpha(e){return e>=65&&e<=90||e>=97&&e<=122}static toLowerCase(e){return e>=65&&e<=90?e+32:e}static writeScheme(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=r>0&&vo.isSchemeChar(i)||0===r&&vo.isAlpha(i)?e.write(i):ge.error(new go("Invalid scheme: "+t))}return e}static writeUserInfo(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=vo.isUserInfoChar(i)?e.write(i):vo.writeEncoded(e,i)}return e}static writeUser(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=vo.isUserChar(i)?e.write(i):vo.writeEncoded(e,i)}return e}static writeHost(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=vo.isHostChar(i)?e.write(i):vo.writeEncoded(e,i)}return e}static writeHostLiteral(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=vo.isHostChar(i)||58===i?e.write(i):vo.writeEncoded(e,i)}return e}static writePathSegment(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=vo.isPathChar(i)?e.write(i):vo.writeEncoded(e,i)}return e}static writeQuery(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=vo.isQueryChar(i)?e.write(i):vo.writeEncoded(e,i)}return e}static writeParam(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=vo.isParamChar(i)?e.write(i):vo.writeEncoded(e,i)}return e}static writeFragment(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=vo.isFragmentChar(i)?e.write(i):vo.writeEncoded(e,i)}return e}static writeEncoded(e,t){return 0===t?(e=vo.writePctEncoded(e,192),e=vo.writePctEncoded(e,128)):t>=0&&t<=127?e=vo.writePctEncoded(e,t):t>=128&&t<=2047?(e=vo.writePctEncoded(e,192|t>>>6),e=vo.writePctEncoded(e,128|63&t)):t>=2048&&t<=65535?(e=vo.writePctEncoded(e,224|t>>>12),e=vo.writePctEncoded(e,128|t>>>6&63),e=vo.writePctEncoded(e,128|63&t)):t>=65536&&t<=1114111?(e=vo.writePctEncoded(e,240|t>>>18),e=vo.writePctEncoded(e,128|t>>>12&63),e=vo.writePctEncoded(e,128|t>>>6&63),e=vo.writePctEncoded(e,128|63&t)):(e=vo.writePctEncoded(e,239),e=vo.writePctEncoded(e,191),e=vo.writePctEncoded(e,189)),e}static writePctEncoded(e,t){const r=tt.lowercase;return e=e.write(37).write(r.encodeDigit(t>>>4&15)).write(r.encodeDigit(15&t))}}i([a],vo,"empty",null),i([a],vo,"standardParser",null),i([a],vo,"form",null);class bo{constructor(e){this.name=e}isDefined(){return 0!==this.name.length}toAny(){return 0!==this.name.length?this.name:void 0}compareTo(e){return e instanceof bo?this.name.localeCompare(e.name):NaN}equals(e){return this===e||e instanceof bo&&this.name===e.name}hashCode(){return d.hash(this.name)}debug(e){return e=e.write("UriScheme").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("undefined").write(40).write(41)}display(e){return e=vo.writeScheme(e,this.name)}toString(){return this.name}static undefined(){return new bo("")}static create(e){const t=bo.cache,r=t.get(e);return void 0!==r?r:t.put(e,new bo(e))}static fromAny(e){if(null==e)return bo.undefined();if(e instanceof bo)return e;if("string"==typeof e)return bo.parse(e);throw new TypeError(""+e)}static parse(e){return vo.standardParser.parseSchemeString(e)}static get cache(){return new ee(4)}}i([a],bo,"undefined",null),i([a],bo,"cache",null);class xo{constructor(e,t,r){this.user=e,this.host=t,this.port=r,this.hashValue=void 0,this.stringValue=void 0}isDefined(){return this.user.isDefined()||this.host.isDefined()||this.port.isDefined()}withUser(e){return(e=Co.fromAny(e))!==this.user?this.copy(e,this.host,this.port):this}get userPart(){return this.user.toString()}withUserPart(e){return this.withUser(Co.parse(e))}get username(){return this.user.username}withUsername(e,t){return 1===arguments.length?this.withUser(this.user.withUsername(e)):this.withUser(Co.create(e,t))}get password(){return this.user.password}withPassword(e){return this.withUser(this.user.withPassword(e))}withHost(e){return(e=So.fromAny(e))!==this.host?this.copy(this.user,e,this.port):this}get hostPart(){return this.host.toString()}withHostPart(e){return this.withHost(So.parse(e))}get hostAddress(){return this.host.address}get hostName(){return this.host.name}withHostName(e){return this.withHost(So.hostname(e))}get hostIPv4(){return this.host.ipv4}withHostIPv4(e){return this.withHost(So.ipv4(e))}get hostIPv6(){return this.host.ipv6}withHostIPv6(e){return this.withHost(So.ipv6(e))}withPort(e){return(e=Do.fromAny(e))!==this.port?this.copy(this.user,this.host,e):this}get portPart(){return this.port.toString()}withPortPart(e){return this.withPort(Do.parse(e))}get portNumber(){return this.port.number}withPortNumber(e){return this.withPort(Do.create(e))}copy(e,t,r){return xo.create(e,t,r)}toAny(e){return this.isDefined()&&(void 0===e&&(e={}),this.user.toAny(e),this.host.isDefined()&&(e.host=this.host.toAny()),this.port.isDefined()&&(e.port=this.port.toAny())),e}compareTo(e){return e instanceof xo?this.toString().localeCompare(e.toString()):NaN}equals(e){return this===e||e instanceof xo&&this.toString()===e.toString()}hashCode(){let e=this.hashValue;return void 0===e&&(e=d.hash(this.toString()),this.hashValue=e),e}debug(e){return e=e.write("UriAuthority").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("undefined").write(40).write(41)}display(e){const t=this.stringValue;if(void 0!==t)e=e.write(t);else{const t=this.user;t.isDefined()&&(e=e.display(t).write(64)),e=e.display(this.host);const r=this.port;r.isDefined()&&(e=e.write(58).display(r))}return e}toString(){let e=this.stringValue;return void 0===e&&(e=Oe.display(this),this.stringValue=e),e}static undefined(){return new xo(Co.undefined(),So.undefined(),Do.undefined())}static create(e=Co.undefined(),t=So.undefined(),r=Do.undefined()){return e.isDefined()||t.isDefined()||r.isDefined()?new xo(e,t,r):xo.undefined()}static fromInit(e){const t=Co.fromAny(void 0!==e.user?e.user:e),r=So.fromAny(e.host),i=Do.fromAny(e.port);return xo.create(t,r,i)}static fromAny(e){if(null==e)return xo.undefined();if(e instanceof xo)return e;if("object"==typeof e)return xo.fromInit(e);if("string"==typeof e)return xo.parse(e);throw new TypeError(""+e)}static user(e){return e=Co.fromAny(e),xo.create(e,void 0,void 0)}static userPart(e){const t=Co.parse(e);return xo.create(t,void 0,void 0)}static username(e,t){const r=Co.create(e,t);return xo.create(r,void 0,void 0)}static password(e){const t=Co.create("",e);return xo.create(t,void 0,void 0)}static host(e){return e=So.fromAny(e),xo.create(void 0,e,void 0)}static hostPart(e){const t=So.parse(e);return xo.create(void 0,t,void 0)}static hostName(e){const t=So.hostname(e);return xo.create(void 0,t,void 0)}static hostIPv4(e){const t=So.ipv4(e);return xo.create(void 0,t,void 0)}static hostIPv6(e){const t=So.ipv6(e);return xo.create(void 0,t,void 0)}static port(e){return e=Do.fromAny(e),xo.create(void 0,void 0,e)}static portPart(e){const t=Do.parse(e);return xo.create(void 0,void 0,t)}static portNumber(e){const t=Do.create(e);return xo.create(void 0,void 0,t)}static parse(e){return vo.standardParser.parseAuthorityString(e)}}i([a],xo,"undefined",null);class Co{constructor(e,t){this.username=e,this.password=t}isDefined(){return void 0!==this.username}withUsername(e){return e!==this.username?this.copy(e,this.password):this}withPassword(e){return e!==this.password?this.copy(this.username,e):this}copy(e,t){return Co.create(e,t)}toAny(e){return void 0!==this.username&&(void 0===e&&(e={}),e.username=this.username,void 0!==this.password&&(e.password=this.password)),e}equals(e){return this===e||e instanceof Co&&(this.username===e.username&&this.password===e.password)}hashCode(){return d.hash(this.toString())}debug(e){return e=e.write("UriUser").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("undefined").write(40).write(41)}display(e){return void 0!==this.username&&(e=vo.writeUser(e,this.username),void 0!==this.password&&(e=e.write(58),e=vo.writeUser(e,this.password))),e}toString(){return Oe.display(this)}static undefined(){return new Co(void 0,void 0)}static create(e,t){return void 0!==e||void 0!==t?new Co(e,t):Co.undefined()}static fromInit(e){return Co.create(e.username,e.password)}static fromAny(e){if(null==e)return Co.undefined();if(e instanceof Co)return e;if("object"==typeof e)return Co.fromInit(e);if("string"==typeof e)return Co.parse(e);throw new TypeError(""+e)}static parse(e){return vo.standardParser.parseUserString(e)}}i([a],Co,"undefined",null);class So{constructor(){}isDefined(){return!0}get name(){}get ipv4(){}get ipv6(){}toAny(){return this.toString()}compareTo(e){return e instanceof So?this.toString().localeCompare(e.toString()):NaN}equals(e){return this===e||e instanceof So&&this.toString()===e.toString()}hashCode(){return d.hash(this.toString())}static undefined(){return new ko}static hostname(e){const t=So.cache,r=t.get(e);return r instanceof Oo?r:t.put(e,new Oo(e))}static ipv4(e){const t=So.cache,r=t.get(e);return r instanceof Eo?r:t.put(e,new Eo(e))}static ipv6(e){const t=So.cache,r=t.get(e);return r instanceof Ao?r:t.put(e,new Ao(e))}static fromAny(e){if(null==e)return So.undefined();if(e instanceof So)return e;if("string"==typeof e)return So.parse(e);throw new TypeError(""+e)}static parse(e){return vo.standardParser.parseHostString(e)}static get cache(){return new ee(16)}}i([a],So,"undefined",null),i([a],So,"cache",null);class Oo extends So{constructor(e){super(),this.address=e}get name(){return this.address}debug(e){return e=e.write("UriHost").write(46).write("hostname").write(40).debug(this.address).write(41)}display(e){return e=vo.writeHost(e,this.address)}toString(){return this.address}}class Eo extends So{constructor(e){super(),this.address=e}get ipv4(){return this.address}debug(e){return e=e.write("UriHost").write(46).write("ipv4").write(40).debug(this.address).write(41)}display(e){return e=vo.writeHost(e,this.address)}toString(){return this.address}}class Ao extends So{constructor(e){super(),this.address=e}get ipv6(){return this.address}debug(e){return e=e.write("UriHost").write(46).write("ipv6").write(40).debug(this.address).write(41)}display(e){return e=e.write(91),e=(e=vo.writeHostLiteral(e,this.address)).write(93)}toString(){return"["+this.address+"]"}}class ko extends So{constructor(){super()}isDefined(){return!1}get address(){return""}debug(e){return e=e.write("UriHost").write(46).write("undefined").write(40).write(41)}display(e){return e}toString(){return""}}class Do{constructor(e){this.number=e}isDefined(){return 0!==this.number}valueOf(){return this.number}toAny(){return this.number}compareTo(e){return e instanceof Do?this.number<e.number?-1:this.number>e.number?1:0:NaN}equals(e){return this===e||e instanceof Do&&this.number===e.number}hashCode(){return d.hash(this.toString())}debug(e){return e=e.write("UriPort").write(46),this.isDefined()?(e=e.write("create").write(40),e=Oe.displayNumber(e,this.number)):e=e.write("undefined").write(40),e=e.write(41)}display(e){return e=Oe.displayNumber(e,this.number)}toString(){return""+this.number}static undefined(){return new Do(0)}static create(e){if(0===e)return Do.undefined();if(e>0){const t=Do.cache,r=t.get(e);return void 0!==r?r:t.put(e,new Do(e))}throw new TypeError(""+e)}static fromAny(e){if(null==e)return Do.undefined();if(e instanceof Do)return e;if("number"==typeof e)return Do.create(e);if("string"==typeof e)return Do.parse(e);throw new TypeError(""+e)}static parse(e){return vo.standardParser.parsePortString(e)}static get cache(){return new ee(16)}}i([a],Do,"undefined",null),i([a],Do,"cache",null);class Po{constructor(){}get length(){let e=0,t=this;for(;!t.isEmpty();)e+=1,t=t.tail();return e}get(e){let t=0,r=this;for(;!r.isEmpty();){if(!(t<e))return r.head();t+=1,r=r.tail()}}get name(){if(this.isEmpty())return"";let e=this;for(;;){const t=e.tail();if(t.isEmpty())return e.isRelative()?e.head():"";e=t}}withName(e){const t=new Vo;return t.addPath(this.base()),t.addSegment(e),t.bind()}foot(){if(this.isEmpty())return this;let e=this;for(;;){const t=e.tail();if(t.isEmpty())return e;e=t}}isSubpathOf(e){e=Po.fromAny(e);let t=this;for(;!t.isEmpty()&&!e.isEmpty();){if(t.head()!==e.head())return!1;t=t.tail(),e=e.tail()}return e.isEmpty()}appended(...e){if(arguments.length>0){const t=new Vo;return t.addPath(this),t.push(...e),t.bind()}return this}appendedSlash(){const e=new Vo;return e.addPath(this),e.addSlash(),e.bind()}appendedSegment(e){const t=new Vo;return t.addPath(this),t.addSegment(e),t.bind()}prepended(...e){if(arguments.length>0){const t=new Vo;return t.push(...e),t.addPath(this),t.bind()}return this}prependedSlash(){return new Io(this)}prependedSegment(e){return this.isEmpty()||this.isAbsolute()?Po.segment(e,this):Po.segment(e,this.prependedSlash())}resolve(e){return e.isEmpty()?this:e.isAbsolute()||this.isEmpty()?e.removeDotSegments():this.merge(e).removeDotSegments()}removeDotSegments(){let e=this;const t=new Vo;for(;!e.isEmpty();){const r=e.head();if("."===r||".."===r)e=e.tail(),e.isEmpty()||(e=e.tail());else if(e.isAbsolute()){const i=e.tail();if(i.isEmpty())t.push(e.head()),e=e.tail();else{const n=i.head();"."===n?(e=i.tail(),e.isEmpty()&&(e=Po.slash())):".."===n?(e=i.tail(),e.isEmpty()&&(e=Po.slash()),t.isEmpty()||t.pop().isAbsolute()||t.isEmpty()||t.pop()):(t.push(r,n),e=i.tail())}}else t.push(e.head()),e=e.tail()}return t.bind()}merge(e){if(this.isEmpty())return e;{const t=new Vo;let r=this;for(;;){const e=r.tail();if(e.isEmpty()){r.isAbsolute()&&t.addSlash();break}r.isAbsolute()?t.addSlash():t.addSegment(r.head()),r=e}return t.addPath(e),t.bind()}}unmerge(e,t=e){let r=this;for(;;){if(r.isEmpty())return e.isEmpty()||e.tail().isEmpty()?e:e.tail();if(r.isRelative())return e;if(e.isRelative())return e.prependedSlash();{let i=r.tail(),n=e.tail();if(!i.isEmpty()&&n.isEmpty())return Po.slash();if(i.isEmpty()||n.isEmpty()||i.head()!==n.head())return n;if(i=i.tail(),n=n.tail(),!i.isEmpty()&&n.isEmpty())return t;r=i,e=n}}}toAny(){const e=[];let t=this;for(;!t.isEmpty();)e.push(t.head()),t=t.tail();return e}compareTo(e){return e instanceof Po?this.toString().localeCompare(e.toString()):NaN}equals(e){return this===e||e instanceof Po&&this.toString()===e.toString()}hashCode(){return d.hash(this.toString())}display(e){let t=this;for(;!t.isEmpty();)e=t.isAbsolute()?e.write(47):vo.writePathSegment(e,t.head()),t=t.tail();return e}static empty(){return new Mo}static slash(){return new Io(Po.empty())}static segment(e,t){return void 0===t&&(t=Po.empty()),e=this.cacheSegment(e),new To(e,t)}static of(...e){const t=new Vo;return t.push(...e),t.bind()}static fromAny(e){if(null==e)return Po.empty();if(e instanceof Po)return e;if(Array.isArray(e))return Po.of(...e);if("string"==typeof e)return Po.parse(e);throw new TypeError(""+e)}static parse(e){return vo.standardParser.parsePathString(e)}static builder(){return new Vo}static pathForm(){return new qo(Po.empty())}static get segmentCache(){return new re(64)}static cacheSegment(e){return e.length<=32?this.segmentCache.put(e):e}}i([a],Po,"empty",null),i([a],Po,"slash",null),i([a],Po,"pathForm",null),i([a],Po,"segmentCache",null);class To extends Po{constructor(e,t){super(),this.segment=e,this.rest=t,this.stringValue=void 0}isDefined(){return!0}isAbsolute(){return!1}isRelative(){return!0}isEmpty(){return!1}head(){return this.segment}tail(){return this.rest}setTail(e){if(e instanceof To)throw new Error("adjacent path segments");this.rest=e}dealias(){return new To(this.segment,this.rest)}parent(){const e=this.rest;if(e.isEmpty())return Po.empty();return e.tail().isEmpty()?Po.empty():new To(this.segment,e.parent())}base(){const e=this.rest;return e.isEmpty()?Po.empty():new To(this.segment,e.base())}prependedSegment(e){return Po.segment(e,this.prependedSlash())}debug(e){return e=e.write("UriPath").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)}display(e){const t=this.stringValue;return e=void 0!==t?e.write(t):super.display(e)}toString(){let e=this.stringValue;return void 0===e&&(e=Oe.display(this),this.stringValue=e),e}}class Io extends Po{constructor(e){super(),this.rest=e,this.stringValue=void 0}isDefined(){return!0}isAbsolute(){return!0}isRelative(){return!1}isEmpty(){return!1}head(){return"/"}tail(){return this.rest}setTail(e){this.rest=e}dealias(){return new Io(this.rest)}parent(){const e=this.rest;if(e.isEmpty())return Po.empty();return e.tail().isEmpty()?Po.slash():new Io(e.parent())}base(){const e=this.rest;return e.isEmpty()?this:new Io(e.base())}prependedSegment(e){return Po.segment(e,this)}debug(e){return e=e.write("UriPath").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)}display(e){const t=this.stringValue;return e=void 0!==t?e.write(t):super.display(e)}toString(){let e=this.stringValue;return void 0===e&&(e=Oe.display(this),this.stringValue=e),e}}class Mo extends Po{constructor(){super()}isDefined(){return!1}isAbsolute(){return!1}isRelative(){return!0}isEmpty(){return!0}head(){throw new Error("empty path")}tail(){throw new Error("empty path")}setTail(e){throw new Error("empty path")}dealias(){return this}parent(){return this}base(){return this}appended(...e){return Po.of(...e)}appendedSlash(){return Po.slash()}appendedSegment(e){return Po.segment(e)}prepended(...e){return Po.of(...e)}prependedSlash(){return Po.slash()}prependedSegment(e){return Po.segment(e)}merge(e){return e}debug(e){return e=e.write("UriPath").write(46).write("empty").write(40).write(41)}display(e){return e}toString(){return""}}class Vo{constructor(){this.first=Po.empty(),this.last=null,this.size=0,this.aliased=0}isEmpty(){return 0===this.size}push(...e){for(let t=0;t<e.length;t+=1){const r=e[t];r instanceof Po?this.addPath(r):Array.isArray(r)?this.push(...r):"/"===r?this.addSlash():this.addSegment(r)}}bind(){return this.aliased=0,this.first}addSlash(){const e=Po.slash().dealias(),t=this.size;0===t?this.first=e:this.dealias(t-1).setTail(e),this.last=e,this.size=t+1,this.aliased+=1}addSegment(e){const t=Po.segment(e,Po.empty());let r=this.size;if(0===r)this.first=t;else{const e=this.dealias(r-1);e.isAbsolute()?e.setTail(t):(e.setTail(t.prependedSlash()),r+=1,this.aliased+=1)}this.last=t,this.size=r+1,this.aliased+=1}addPath(e){if(!e.isEmpty()){let t=this.size;if(0===t)this.first=e;else{const r=this.dealias(t-1);r.isAbsolute()||e.isAbsolute()?r.setTail(e):(r.setTail(e.prependedSlash()),t+=1,this.aliased+=1)}for(t+=1;;){const r=e.tail();if(r.isEmpty())break;e=r,t+=1}this.last=e,this.size=t}}pop(){const e=this.size,t=this.aliased;if(0===e)throw new Error("Empty UriPath");if(1===e){const r=this.first;return this.first=r.tail(),r.tail().isEmpty()&&(this.last=null),this.size=e-1,t>0&&(this.aliased=t-1),r}{const r=this.dealias(e-2);return r.setTail(Po.empty()),this.last=r,this.size=e-1,this.aliased=t-1,r.tail()}}dealias(e){let t=0,r=null,i=this.first;if(this.aliased<=e){for(;t<this.aliased;)r=i,i=i.tail(),t+=1;for(;t<=e;){const e=i.dealias();0===t?this.first=e:r.setTail(e),r=e,i=i.tail(),t+=1}t===this.size&&(this.last=r),this.aliased=t}else if(0===e)r=this.first;else if(e===this.size-1)r=this.last;else for(;t<=e;)r=i,i=i.tail(),t+=1;return r}}class qo extends Mi{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new qo(e):this}mold(e,t){return e=Po.fromAny(e),void 0===t?Tr.from(e.toString()):t.concat(Tr.from(e.toString()))}cast(e,t){const r=e.target;try{const e=r.stringValue();if("string"==typeof e)return Po.parse(e)}catch(e){}}}class Fo{get length(){let e=0,t=this;for(;!t.isEmpty();)e+=1,t=t.tail();return e}has(e){let t=this;for(;!t.isEmpty();){if(e===t.key)return!0;t=t.tail()}return!1}get(e){let t=this;for(;!t.isEmpty();){if(e===t.key)return t.value;t=t.tail()}}updated(e,t){let r=this;const i=new Uo;let n=!1;for(;!r.isEmpty();)e===r.key?(i.addParam(e,t),n=!0):i.addParam(r.key,r.value),r=r.tail();return n||i.addParam(e,t),i.bind()}removed(e){let t=this;const r=new Uo;let i=!1;for(;!t.isEmpty();)e===t.key?i=!0:r.addParam(t.key,t.value),t=t.tail();return i?r.bind():this}appended(e,t){const r=new Uo;return r.addQuery(this),r.add(e,t),r.bind()}prepended(e,t){const r=new Uo;return r.add(e,t),r.addQuery(this),r.bind()}toAny(e){if(this.isDefined()){e=e||{};let t=this,r=0;for(;!t.isEmpty();){const i=t.key;void 0!==i?e[i]=t.value:e["$"+r]=t.value,t=t.tail(),r+=1}}return e}compareTo(e){return e instanceof Fo?this.toString().localeCompare(e.toString()):NaN}equals(e){return this===e||e instanceof Fo&&this.toString()===e.toString()}hashCode(){return d.hash(this.toString())}display(e){let t=this,r=!0;for(;!t.isEmpty();){r?r=!1:e=e.write(38);const i=t.key;void 0!==i&&(e=(e=vo.writeParam(e,i)).write(61)),e=vo.writeQuery(e,t.value),t=t.tail()}return e}static undefined(){return new zo}static param(e,t,r){return void 0===r?(r=t,t=e,e=void 0):void 0!==e&&(e=this.cacheKey(e)),void 0===r&&(r=Fo.undefined()),new No(e,t,r)}static fromAny(e){if(null==e)return Fo.undefined();if(e instanceof Fo)return e;if("object"==typeof e){const t=new Uo;return t.add(e),t.bind()}if("string"==typeof e)return Fo.parse(e);throw new TypeError(""+e)}static parse(e){return vo.standardParser.parseQueryString(e)}static builder(){return new Uo}static get keyCache(){return new re(64)}static cacheKey(e){return e.length<=32?Fo.keyCache.put(e):e}}i([a],Fo,"undefined",null),i([a],Fo,"keyCache",null);class No extends Fo{constructor(e,t,r){super(),this.key=e,this.value=t,this.rest=r,this.stringValue=void 0}isDefined(){return!0}isEmpty(){return!1}head(){return[this.key,this.value]}tail(){return this.rest}setTail(e){this.rest=e}dealias(){return new No(this.key,this.value,this.rest)}debug(e){return e=e.write("UriQuery").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)}display(e){const t=this.stringValue;return e=void 0!==t?e.write(t):super.display(e)}toString(){let e=this.stringValue;return void 0===e&&(e=Oe.display(this),this.stringValue=e),e}}class zo extends Fo{isDefined(){return!1}isEmpty(){return!0}head(){throw new Error("undefined query")}get key(){throw new Error("undefined query")}get value(){throw new Error("undefined query")}tail(){throw new Error("undefined query")}setTail(e){throw new Error("undefined query")}dealias(){return this}updated(e,t){return Fo.param(e,t,this)}removed(e){return this}appended(e,t){const r=new Uo;return r.add(e,t),r.bind()}prepended(e,t){const r=new Uo;return r.add(e,t),r.bind()}debug(e){return e=e.write("UriQuery").write(46).write("undefined").write(40).write(41)}display(e){return e}toString(){return""}}class Uo{constructor(){this.first=Fo.undefined(),this.last=null,this.size=0,this.aliased=0}isEmpty(){return 0===this.size}add(e,t){if(void 0!==t)this.addParam(e,t);else if("string"==typeof e)this.addParam(void 0,e);else if(e instanceof Fo)this.addQuery(e);else{const t=e;for(const e in t){let r=e;const i=t[e];36===e.charCodeAt(0)&&(r=void 0),this.addParam(r,i)}}}bind(){return this.aliased=0,this.first}addParam(e,t){void 0===t&&(t=e,e=void 0);const r=Fo.param(e,t,Fo.undefined()),i=this.size;0===i?this.first=r:this.dealias(i-1).setTail(r),this.last=r,this.size=i+1,this.aliased+=1}addQuery(e){if(!e.isEmpty()){let t=this.size;for(0===t?this.first=e:this.dealias(t-1).setTail(e),t+=1;;){const r=e.tail();if(r.isEmpty())break;e=r,t+=1}this.last=e,this.size=t}}dealias(e){let t=0,r=null,i=this.first;if(this.aliased<=e){for(;t<this.aliased;)r=i,i=i.tail(),t+=1;for(;t<=e;){const e=i.dealias();0===t?this.first=e:r.setTail(e),r=e,i=i.tail(),t+=1}t===this.size&&(this.last=r),this.aliased=t}else if(0===e)r=this.first;else if(e===this.size-1)r=this.last;else for(;t<=e;)r=i,i=i.tail(),t+=1;return r}}class Ro{constructor(e){this.identifier=e,this.stringValue=void 0}isDefined(){return void 0!==this.identifier}toAny(){return this.identifier}compareTo(e){return e instanceof Ro?this.toString().localeCompare(e.toString()):NaN}equals(e){return this===e||e instanceof Ro&&this.identifier===e.identifier}hashCode(){return d.hash(this.identifier)}debug(e){return e=e.write("UriFragment").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("undefined").write(40).write(41)}display(e){const t=this.stringValue;return void 0!==t?e=e.write(t):void 0!==this.identifier&&(e=vo.writeFragment(e,this.identifier)),e}toString(){let e=this.stringValue;return void 0===e&&(e=Oe.display(this),this.stringValue=e),e}static undefined(){return new Ro(void 0)}static create(e){if(void 0!==e){const t=Ro.cache,r=t.get(e);return void 0!==r?r:t.put(e,new Ro(e))}return Ro.undefined()}static fromAny(e){if(null==e)return Ro.undefined();if(e instanceof Ro)return e;if("string"==typeof e)return Ro.parse(e);throw new TypeError(""+e)}static parse(e){return vo.standardParser.parseFragmentString(e)}static get cache(){return new ee(32)}}i([a],Ro,"undefined",null),i([a],Ro,"cache",null);class jo extends Mi{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new jo(e):this}mold(e,t){return e=vo.fromAny(e),void 0===t?Tr.from(e.toString()):t.concat(Tr.from(e.toString()))}cast(e,t){const r=e.target;try{const e=r.stringValue();if("string"==typeof e)return vo.parse(e)}catch(e){}}}class Lo{constructor(e,t=32){this.base=e,this.resolveCache=new ee(t),this.unresolveCache=new ee(t)}resolve(e){e=vo.fromAny(e);let t=this.resolveCache.get(e);return void 0===t&&(t=this.base.resolve(e),this.resolveCache.put(e,t)),t}unresolve(e){e=vo.fromAny(e);let t=this.unresolveCache.get(e);return void 0===t&&(t=this.base.unresolve(e),this.unresolveCache.put(e,t)),t}}class Bo{absolute(e,t,r,i,n){return vo.create(e,t,r,i,n)}scheme(e){return bo.create(e)}authority(e,t,r){return xo.create(e,t,r)}user(e,t){return Co.create(e,t)}hostName(e){return So.hostname(e)}hostIPv4(e){return So.ipv4(e)}hostIPv6(e){return So.ipv6(e)}port(e){return Do.create(e)}pathEmpty(){return Po.empty()}pathBuilder(){return new Vo}queryBuilder(){return new Uo}fragment(e){return Ro.create(e)}absoluteParser(){return new Ko(this)}parseAbsolute(e){return Ko.parse(e,this)}parseAbsoluteString(e){const t=Se.stringInput(e);let r=this.parseAbsolute(t);return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}schemeParser(){return new Wo(this)}parseScheme(e){return Wo.parse(e,this)}parseSchemeString(e){const t=Se.stringInput(e);let r=this.parseScheme(t);return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}authorityParser(){return new Ho(this)}parseAuthority(e){return Ho.parse(e,this)}parseAuthorityString(e){const t=Se.stringInput(e);let r=this.parseAuthority(t);return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}userParser(){return new Xo(this)}parseUser(e){return Xo.parse(e,this)}parseUserString(e){const t=Se.stringInput(e);let r=this.parseUser(t);return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}hostParser(){return new _o(this)}parseHost(e){return _o.parse(e,this)}parseHostString(e){const t=Se.stringInput(e);let r=this.parseHost(t);return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}hostAddressParser(){return new Go(this)}parseHostAddress(e){return Go.parse(e,this)}hostLiteralParser(){return new Yo(this)}parseHostLiteral(e){return Yo.parse(e,this)}portParser(){return new Zo(this)}parsePort(e){return Zo.parse(e,this)}parsePortString(e){const t=Se.stringInput(e);let r=this.parsePort(t);return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}pathParser(e){return new Qo(this,e)}parsePath(e,t){return Qo.parse(e,this,t)}parsePathString(e){const t=Se.stringInput(e);let r=this.parsePath(t);return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}queryParser(e){return new $o(this,e)}parseQuery(e,t){return $o.parse(e,this,t)}parseQueryString(e){const t=Se.stringInput(e);let r=this.parseQuery(t);return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}fragmentParser(){return new Jo(this)}parseFragment(e){return Jo.parse(e,this)}parseFragmentString(e){const t=Se.stringInput(e);let r=this.parseFragment(t);return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}}class Ko extends Le{constructor(e,t,r,i,n,s,o){super(),this.uri=e,this.schemeParser=t,this.authorityParser=r,this.pathParser=i,this.queryParser=n,this.fragmentParser=s,this.step=o}feed(e){return Ko.parse(e,this.uri,this.schemeParser,this.authorityParser,this.pathParser,this.queryParser,this.fragmentParser,this.step)}static parse(e,t,r,i,n,s,o,a=1){let u=0;if(1===a)if(e.isCont()){const t=e.clone();for(;t.isCont()&&(u=t.head(),vo.isSchemeChar(u));)t.step();a=t.isCont()&&58===u?2:3}else e.isDone()&&(a=3);if(2===a)if((r=void 0===r?t.parseScheme(e):r.feed(e)).isDone()){if(e.isCont()&&58===e.head())e=e.step(),a=3;else if(!e.isEmpty())return Le.error(Ae.expected(58,e))}else if(r.isError())return r.asError();if(3===a)if(e.isCont())u=e.head(),47===u?(e=e.step(),a=4):63===u?(e=e.step(),a=7):35===u?(e=e.step(),a=8):a=6;else if(e.isDone())return Le.done(t.absolute(void 0!==r?r.bind():void 0));if(4===a)if(e.isCont()&&47===e.head())e=e.step(),a=5;else if(e.isCont()){const r=t.pathBuilder();r.addSlash(),n=t.parsePath(e,r),a=6}else if(e.isDone())return Le.done(t.absolute(void 0!==r?r.bind():void 0,void 0,Po.slash()));if(5===a)if((i=void 0===i?t.parseAuthority(e):i.feed(e)).isDone()){if(e.isCont())u=e.head(),63===u?(e=e.step(),a=7):35===u?(e=e.step(),a=8):a=6;else if(e.isDone())return Le.done(t.absolute(void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0))}else if(i.isError())return i.asError();if(6===a)if((n=void 0===n?t.parsePath(e):n.feed(e)).isDone()){if(e.isCont()&&63===e.head())e=e.step(),a=7;else if(e.isCont()&&35===e.head())e=e.step(),a=8;else if(!e.isEmpty())return Le.done(t.absolute(void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0,n.bind()))}else if(n.isError())return n.asError();if(7===a)if((s=void 0===s?t.parseQuery(e):s.feed(e)).isDone()){if(e.isCont()&&35===e.head())e=e.step(),a=8;else if(!e.isEmpty())return Le.done(t.absolute(void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0,void 0!==n?n.bind():void 0,s.bind()))}else if(s.isError())return s.asError();if(8===a){if((o=void 0===o?t.parseFragment(e):o.feed(e)).isDone())return Le.done(t.absolute(void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0,void 0!==n?n.bind():void 0,void 0!==s?s.bind():void 0,o.bind()));if(o.isError())return o.asError()}return new Ko(t,r,i,n,s,o,a)}}class Wo extends Le{constructor(e,t,r){super(),this.uri=e,this.output=t,this.step=r}feed(e){return Wo.parse(e,this.uri,this.output,this.step)}static parse(e,t,r,i=1){let n=0;if(1===i)if(e.isCont()&&(n=e.head(),vo.isAlpha(n)))e=e.step(),r=(r=r||nt.decodedString()).write(vo.toLowerCase(n)),i=2;else if(!e.isEmpty())return Le.error(Ae.expected("scheme",e));if(2===i){for(;e.isCont()&&(n=e.head(),vo.isSchemeChar(n));)e=e.step(),r.write(vo.toLowerCase(n));if(!e.isEmpty())return Le.done(t.scheme(r.bind()))}return new Wo(t,r,i)}}class Ho extends Le{constructor(e,t,r,i,n){super(),this.uri=e,this.userParser=t,this.hostParser=r,this.portParser=i,this.step=n}feed(e){return Ho.parse(e,this.uri,this.userParser,this.hostParser,this.portParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s)if(e.isCont()){const t=e.clone();for(;t.isCont()&&(o=t.head(),64!==o&&47!==o);)t.step();s=t.isCont()&&64===o?2:3}else e.isDone()&&(s=3);if(2===s)if((r=void 0===r?t.parseUser(e):r.feed(e)).isDone()){if(e.isCont()&&64===e.head())e=e.step(),s=3;else if(!e.isEmpty())return Le.error(Ae.expected(64,e))}else if(r.isError())return r.asError();if(3===s)if((i=void 0===i?t.parseHost(e):i.feed(e)).isDone()){if(e.isCont()&&58===e.head())e=e.step(),s=4;else if(!e.isEmpty())return Le.done(t.authority(void 0!==r?r.bind():void 0,i.bind()))}else if(i.isError())return i.asError();if(4===s){if((n=void 0===n?t.parsePort(e):n.feed(e)).isDone())return Le.done(t.authority(void 0!==r?r.bind():void 0,i.bind(),n.bind()));if(n.isError())return n.asError()}return new Ho(t,r,i,n,s)}}class Xo extends Le{constructor(e,t,r,i,n){super(),this.uri=e,this.usernameOutput=t,this.passwordOutput=r,this.c1=i,this.step=n}feed(e){return Xo.parse(e,this.uri,this.usernameOutput,this.passwordOutput,this.c1,this.step)}static parse(e,t,r,i,n=0,s=1){let o=0;for(;;){if(1===s){for(r=r||nt.decodedString();e.isCont()&&(o=e.head(),vo.isUserChar(o));)e=e.step(),r.write(o);if(e.isCont()&&58===o)e=e.step(),s=4;else if(e.isCont()&&37===o)e=e.step(),s=2;else if(!e.isEmpty())return Le.done(t.user(r.bind()))}if(2===s)if(e.isCont()&&(o=e.head(),tt.isDigit(o)))e=e.step(),n=o,s=3;else if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e));if(3===s){if(e.isCont()&&(o=e.head(),tt.isDigit(o))){e=e.step(),r.write(tt.decodeDigit(n)<<4|tt.decodeDigit(o)),n=0,s=1;continue}if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e))}if(4===s){for(i=i||nt.decodedString();e.isCont()&&(o=e.head(),vo.isUserInfoChar(o));)e=e.step(),i.write(o);if(e.isCont()&&37===o)e=e.step(),s=5;else if(!e.isEmpty())return Le.done(t.user(r.bind(),i.bind()))}if(5===s)if(e.isCont()&&(o=e.head(),tt.isDigit(o)))e=e.step(),n=o,s=6;else if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e));if(6===s){if(e.isCont()&&(o=e.head(),tt.isDigit(o))){e=e.step(),i.write(tt.decodeDigit(n)<<4|tt.decodeDigit(o)),n=0,s=4;continue}if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e))}break}return new Xo(t,r,i,n,s)}}class _o extends Le{constructor(e){super(),this.uri=e}feed(e){return _o.parse(e,this.uri)}static parse(e,t){if(e.isCont()){return 91===e.head()?t.parseHostLiteral(e):t.parseHostAddress(e)}return e.isDone()?Le.done(t.hostName("")):new _o(t)}}class Go extends Le{constructor(e,t,r,i,n){super(),this.uri=e,this.output=t,this.c1=r,this.x=i,this.step=n}feed(e){return Go.parse(e,this.uri,this.output,this.c1,this.x,this.step)}static parse(e,t,r,i=0,n=0,s=1){let o=0;for(r=r||nt.decodedString();s<=4;){for(;e.isCont()&&(o=e.head(),Ee.isDigit(o));)e=e.step(),r=r.write(o),n=10*n+Ee.decodeDigit(o);if(!e.isCont()){if(e.isEmpty())break;return 4===s&&n<=255?Le.done(t.hostIPv4(r.bind())):Le.done(t.hostName(r.bind()))}if(!(46===o&&s<4&&n<=255)){if(!vo.isHostChar(o)&&37!==o&&4===s&&n<=255)return Le.done(t.hostIPv4(r.bind()));n=0,s=5;break}e=e.step(),r=r.write(o),n=0,s+=1}for(;;){if(5===s){for(;e.isCont()&&(o=e.head(),vo.isHostChar(o));)e=e.step(),r.write(vo.toLowerCase(o));if(e.isCont()&&37===o)e=e.step(),s=6;else if(!e.isEmpty())return Le.done(t.hostName(r.bind()))}if(6===s)if(e.isCont()&&(o=e.head(),tt.isDigit(o)))e=e.step(),i=o,s=7;else if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e));if(7===s){if(e.isCont()&&(o=e.head(),tt.isDigit(o))){e=e.step(),r.write(tt.decodeDigit(i)<<4|tt.decodeDigit(o)),i=0,s=5;continue}if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e))}break}return new Go(t,r,i,n,s)}}class Yo extends Le{constructor(e,t,r){super(),this.uri=e,this.output=t,this.step=r}feed(e){return Yo.parse(e,this.uri,this.output,this.step)}static parse(e,t,r,i=1){let n=0;if(1===i)if(e.isCont()&&91===e.head())e=e.step(),i=2;else if(!e.isEmpty())return Le.error(Ae.expected(91,e));if(2===i){for(r=r||nt.decodedString();e.isCont()&&(n=e.head(),vo.isHostChar(n)||58===n);)e=e.step(),r=r.write(vo.toLowerCase(n));if(e.isCont()&&93===n)return e=e.step(),Le.done(t.hostIPv6(r.bind()));if(!e.isEmpty())return Le.error(Ae.expected(93,e))}return new Yo(t,r,i)}}class Zo extends Le{constructor(e,t){super(),this.uri=e,this.number=t}feed(e){return Zo.parse(e,this.uri,this.number)}static parse(e,t,r=0){let i=0;for(;e.isCont()&&(i=e.head(),Ee.isDigit(i));)e=e.step(),r=10*r+Ee.decodeDigit(i);return e.isEmpty()?new Zo(t,r):Le.done(t.port(r))}}class Qo extends Le{constructor(e,t,r,i,n){super(),this.uri=e,this.builder=t,this.output=r,this.c1=i,this.step=n}feed(e){return Qo.parse(e,this.uri,this.builder,this.output,this.c1,this.step)}static parse(e,t,r,i,n=0,s=1){let o=0;for(;;){if(1===s){for(;e.isCont()&&(o=e.head(),vo.isPathChar(o));)i=i||nt.decodedString(),e=e.step(),i=i.write(o);if(e.isCont()&&47===o){e=e.step(),r=r||t.pathBuilder(),void 0!==i&&(r.addSegment(i.bind()),i=void 0),r.addSlash();continue}if(e.isCont()&&37===o)e=e.step(),s=2;else if(!e.isEmpty())return void 0!==i&&(r=r||t.pathBuilder()).addSegment(i.bind()),void 0!==r?Le.done(r.bind()):Le.done(t.pathEmpty())}if(2===s)if(e.isCont()&&(o=e.head(),tt.isDigit(o)))e=e.step(),n=o,s=3;else if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e));if(3===s){if(e.isCont()&&(o=e.head(),tt.isDigit(o))){i=i||nt.decodedString(),e=e.step(),i=i.write(tt.decodeDigit(n)<<4|tt.decodeDigit(o)),n=0,s=1;continue}if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e))}break}return new Qo(t,r,i,n,s)}}class $o extends Le{constructor(e,t,r,i,n,s){super(),this.uri=e,this.builder=t,this.keyOutput=r,this.valueOutput=i,this.c1=n,this.step=s}feed(e){return $o.parse(e,this.uri,this.builder,this.keyOutput,this.valueOutput,this.c1,this.step)}static parse(e,t,r,i,n,s=0,o=1){let a=0;for(;;){if(1===o){for(i=i||nt.decodedString();e.isCont()&&(a=e.head(),vo.isParamChar(a));)e=e.step(),i.write(a);if(e.isCont()&&61===a)e=e.step(),o=4;else{if(e.isCont()&&38===a){e=e.step(),(r=r||t.queryBuilder()).addParam(i.bind()),i=void 0;continue}if(e.isCont()&&37===a)e=e.step(),o=2;else if(!e.isEmpty())return(r=r||t.queryBuilder()).addParam(i.bind()),Le.done(r.bind())}}if(2===o)if(e.isCont()&&(a=e.head(),tt.isDigit(a)))e=e.step(),s=a,o=3;else if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e));if(3===o){if(e.isCont()&&(a=e.head(),tt.isDigit(a))){e=e.step(),i.write(tt.decodeDigit(s)<<4|tt.decodeDigit(a)),s=0,o=1;continue}if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e))}if(4===o){for(n=n||nt.decodedString();e.isCont()&&(a=e.head(),vo.isParamChar(a)||61===a);)e=e.step(),n.write(a);if(e.isCont()&&38===a){e=e.step(),(r=r||t.queryBuilder()).addParam(i.bind(),n.bind()),i=void 0,n=void 0,o=1;continue}if(e.isCont()&&37===a)e=e.step(),o=5;else if(!e.isEmpty())return(r=r||t.queryBuilder()).addParam(i.bind(),n.bind()),Le.done(r.bind())}if(5===o)if(e.isCont()&&(a=e.head(),tt.isDigit(a)))e=e.step(),s=a,o=6;else if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e));if(6===o){if(e.isCont()&&(a=e.head(),tt.isDigit(a))){e=e.step(),n.write(tt.decodeDigit(s)<<4|tt.decodeDigit(a)),s=0,o=4;continue}if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e))}break}return new $o(t,r,i,n,s,o)}}class Jo extends Le{constructor(e,t,r,i){super(),this.uri=e,this.output=t,this.c1=r,this.step=i}feed(e){return Jo.parse(e,this.uri,this.output,this.c1,this.step)}static parse(e,t,r,i=0,n=1){let s=0;for(r=r||nt.decodedString();;){if(1===n){for(;e.isCont()&&(s=e.head(),vo.isFragmentChar(s));)e=e.step(),r=r.write(s);if(e.isCont()&&37===s)e=e.step(),n=2;else if(!e.isEmpty())return Le.done(t.fragment(r.bind()))}if(2===n)if(e.isCont()&&(s=e.head(),tt.isDigit(s)))e=e.step(),i=s,n=3;else if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e));if(3===n){if(e.isCont()&&(s=e.head(),tt.isDigit(s))){e=e.step(),r=r.write(tt.decodeDigit(i)<<4|tt.decodeDigit(s)),i=0,n=1;continue}if(!e.isEmpty())return Le.error(Ae.expected("hex digit",e))}break}return new Jo(t,r,i,n)}}class ea extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ea.prototype)}}class ta{isDefined(){return isFinite(this.value)}plus(e,t=this.units,r){return e=ta.fromAny(e),ta.create(this.toValue(t,r)+e.toValue(t,r),t)}negative(e=this.units,t){return ta.create(-this.toValue(e,t),e)}minus(e,t=this.units,r){return e=ta.fromAny(e),ta.create(this.toValue(t,r)-e.toValue(t,r),t)}times(e,t=this.units,r){return ta.create(this.toValue(t,r)*e,t)}divide(e,t=this.units,r){return ta.create(this.toValue(t,r)/e,t)}combine(e,t=1,r=this.units,i){return e=ta.fromAny(e),ta.create(this.toValue(r,i)+e.toValue(r,i)*t,r)}emValue(e){return 0!==this.value?this.pxValue(e)/ta.emUnit(e):0}remValue(e){return 0!==this.value?this.pxValue(e)/ta.remUnit(e):0}pctValue(e){return 0!==this.value?this.pxValue(e)/ta.pctUnit(e):0}px(e){return ta.px(this.pxValue(e))}em(e){return ta.em(this.emValue(e))}rem(e){return ta.rem(this.remValue(e))}pct(e){return ta.pct(this.pctValue(e))}toValue(e,t){if(void 0===e)return Tr.from(this.toString());switch(e){case"px":return this.pxValue(t);case"em":return this.emValue(t);case"rem":return this.remValue(t);case"%":return this.pctValue(t);default:throw new ea("unknown length units: "+e)}}to(e,t){switch(e){case"px":return this.px(t);case"em":return this.em(t);case"rem":return this.rem(t);case"%":return this.pct(t);default:throw new ea("unknown length units: "+e)}}interpolateTo(e){return e instanceof ta?aa(this,e):null}static zero(e){switch(e){case void 0:case"px":return ra.zero();case"em":return ia.zero();case"rem":return na.zero();case"%":return sa.zero();case"":return oa.zero();default:throw new ea("unknown length units: "+e)}}static px(e){return new ra(e)}static em(e){return new ia(e)}static rem(e){return new na(e)}static pct(e){return new sa(e)}static unitless(e){return new oa(e)}static create(e,t){switch(t){case void 0:case"px":return ta.px(e);case"em":return ta.em(e);case"rem":return ta.rem(e);case"%":return ta.pct(e);case"":return ta.unitless(e);default:throw new ea("unknown length units: "+t)}}static fromCssValue(e){if(e instanceof CSSUnitValue)return ta.create(e.value,e.unit);throw new TypeError(""+e)}static fromAny(e,t){if(null==e||e instanceof ta)return e;if("number"==typeof e)return ta.create(e,t);if("string"==typeof e)return ta.parse(e,t);throw new TypeError(""+e)}static fromValue(e){if(2===e.length){const t=e.getItem(0).numberValue(void 0),r=e.getItem(1);if(void 0!==t&&isFinite(t)&&r instanceof gr&&r.value===xr.extant())switch(r.key.value){case"px":return ta.px(t);case"em":return ta.em(t);case"rem":return ta.rem(t);case"pct":return ta.pct(t)}}return null}static parse(e,t){let r=Se.stringInput(e);for(;r.isCont()&&Se.isWhitespace(r.head());)r=r.step();let i=ha.parse(r,t);if(i.isDone())for(;r.isCont()&&Se.isWhitespace(r.head());)r=r.step();return r.isCont()&&!i.isError()&&(i=Le.error(Ae.unexpected(r))),i.bind()}static form(){return new ua(void 0,ta.zero())}static isAny(e){return e instanceof ta||"number"==typeof e||"string"==typeof e}static emUnit(e){if("object"==typeof e&&"number"==typeof e.emUnit)return e.emUnit;if("object"==typeof e&&e.emUnit instanceof Node){let t=e.emUnit;for(;null!==t;){if(t instanceof Element){const e=getComputedStyle(t).fontSize;if("string"==typeof e)return parseFloat(e)}t=t.parentNode}}throw new ea("unknown em unit")}static remUnit(e){if("object"==typeof e&&"number"==typeof e.remUnit)return e.remUnit;{const e=getComputedStyle(document.documentElement).fontSize;if("string"==typeof e)return parseFloat(e)}throw new ea("unknown rem unit")}static pctUnit(e){if("number"==typeof e)return e;if("object"==typeof e&&"number"==typeof e.pctUnit)return e.pctUnit;throw new ea("unknown percentage unit")}}i([a],ta,"form",null);class ra extends ta{constructor(e){super(),this.value=e}get units(){return"px"}pxValue(e){return this.value}px(e){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"px"):null}compareTo(e){if(e instanceof ta){const t=this.value,r=e.pxValue();return t<r?-1:t>r?1:isNaN(r)?isNaN(t)?0:-1:isNaN(t)?1:0}return NaN}equivalentTo(e,t){return e instanceof ta&&c.equivalent(this.value,e.pxValue())}equals(e){return e instanceof ra&&this.value===e.value}hashCode(){return o.mash(o.mix(m.hash(ra),c.hash(this.value)))}debug(e){return e=e.write("Length").write(46).write("px").write(40).debug(this.value).write(41)}toString(){return this.value+"px"}static zero(){return new ra(0)}}i([a],ra,"zero",null);class ia extends ta{constructor(e){super(),this.value=e}get units(){return"em"}pxValue(e){return 0!==this.value?this.value*ta.emUnit(e):0}emValue(e){return this.value}em(e){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"em"):null}compareTo(e){if(e instanceof ta){const t=this.value,r=e.emValue();return t<r?-1:t>r?1:isNaN(r)?isNaN(t)?0:-1:isNaN(t)?1:0}return NaN}equivalentTo(e,t){return e instanceof ta&&c.equivalent(this.value,e.emValue())}equals(e){return e instanceof ia&&this.value===e.value}hashCode(){return o.mash(o.mix(m.hash(ia),c.hash(this.value)))}debug(e){return e=e.write("Length").write(46).write("em").write(40).debug(this.value).write(41)}toString(){return this.value+"em"}static zero(){return new ia(0)}}i([a],ia,"zero",null);class na extends ta{constructor(e){super(),this.value=e}get units(){return"rem"}pxValue(e){return 0!==this.value?this.value*ta.remUnit(e):0}remValue(e){return this.value}rem(e){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"rem"):null}compareTo(e){if(e instanceof na){const t=this.value,r=e.remValue();return t<r?-1:t>r?1:isNaN(r)?isNaN(t)?0:-1:isNaN(t)?1:0}return NaN}equivalentTo(e,t){return e instanceof na&&c.equivalent(this.value,e.remValue())}equals(e){return e instanceof na&&this.value===e.value}hashCode(){return o.mash(o.mix(m.hash(na),c.hash(this.value)))}debug(e){return e=e.write("Length").write(46).write("rem").write(40).debug(this.value).write(41)}toString(){return this.value+"rem"}static zero(){return new na(0)}}i([a],na,"zero",null);class sa extends ta{constructor(e){super(),this.value=e}get units(){return"%"}pxValue(e){return 0!==this.value?this.value*ta.pctUnit(e)/100:0}pctValue(e){return this.value}pct(e){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"percent"):null}compareTo(e){if(e instanceof ta){const t=this.value,r=e.pctValue();return t<r?-1:t>r?1:isNaN(r)?isNaN(t)?0:-1:isNaN(t)?1:0}return NaN}equivalentTo(e,t){return e instanceof ta&&c.equivalent(this.value,e.pctValue())}equals(e){return e instanceof sa&&this.value===e.value}hashCode(){return o.mash(o.mix(m.hash(sa),c.hash(this.value)))}debug(e){return e=e.write("Length").write(46).write("pct").write(40).debug(this.value).write(41)}toString(){return this.value+"%"}static zero(){return new sa(0)}}i([a],sa,"zero",null);class oa extends ta{constructor(e){super(),this.value=e}get units(){return""}pxValue(e){throw new ea("unitless length")}toCssValue(){return null}compareTo(e){if(e instanceof ta){const t=this.value,r=e.value;return t<r?-1:t>r?1:isNaN(r)?isNaN(t)?0:-1:isNaN(t)?1:0}return NaN}equivalentTo(e,t){return e instanceof ta&&c.equivalent(this.value,e.value)}equals(e){return e instanceof oa&&this.value===e.value}hashCode(){return o.mash(o.mix(m.hash(oa),c.hash(this.value)))}debug(e){return e=e.write("Length").write(46).write("unitless").write(40).debug(this.value).write(41)}toString(){return this.value+""}static zero(){return new oa(0)}}i([a],oa,"zero",null);const aa=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1];return ta.create(t.value+e*(r.value-t.value),r.units)};return Object.setPrototypeOf(i,t.prototype),i[0]=e.to(r.units),i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class ua extends Mi{constructor(e,t){super(),this.defaultUnits=e,Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(e){return e!==this.unit?new ua(this.defaultUnits,e):this}mold(e){return e=ta.fromAny(e,this.defaultUnits),Tr.from(e.toString())}cast(e){const t=e.toValue();let r=null;try{if(r=ta.fromValue(t),void 0!==r){const e=t.stringValue(void 0);void 0!==e&&(r=ta.parse(e,this.defaultUnits))}}catch(e){}return null!==r?r:void 0}}class ha extends Le{constructor(e,t,r,i){super(),this.defaultUnits=e,this.valueParser=t,this.unitsOutput=r,this.step=i}feed(e){return ha.parse(e,this.defaultUnits,this.valueParser,this.unitsOutput,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n)if((r=void 0===r?Ee.parseDecimal(e):r.feed(e)).isDone())n=2;else if(r.isError())return r.asError();if(2===n){for(i=i||Se.stringOutput();e.isCont()&&(s=e.head(),Se.isAlpha(s)||37===s);)e=e.step(),i.push(s);if(!e.isEmpty()){const n=r.bind(),s=i.bind()||t;switch(s){case"px":return Le.done(ta.px(n));case"em":return Le.done(ta.em(n));case"rem":return Le.done(ta.rem(n));case"%":return Le.done(ta.pct(n));case"":case void 0:return Le.done(ta.unitless(n));default:return Le.error(Ae.message("unknown length units: "+s,e))}}}return new ha(t,r,i,n)}}class la{isDefined(){return isFinite(this.value)}plus(e,t=this.units){return e=la.fromAny(e),la.create(this.toValue(t)+e.toValue(t),t)}negative(e=this.units){return la.create(-this.toValue(e),e)}minus(e,t=this.units){return e=la.fromAny(e),la.create(this.toValue(t)-e.toValue(t),t)}times(e,t=this.units){return la.create(this.toValue(t)*e,t)}divide(e,t=this.units){return la.create(this.toValue(t)/e,t)}combine(e,t=1,r=this.units){return e=la.fromAny(e),la.create(this.toValue(r)+e.toValue(r)*t,r)}norm(e,t=this.units){return e=la.fromAny(e),la.create(this.toValue(t)/e.toValue(t),t)}deg(){return la.deg(this.degValue())}rad(){return la.rad(this.radValue())}grad(){return la.grad(this.gradValue())}turn(){return la.turn(this.turnValue())}toValue(e){if(void 0===e)return Tr.from(this.toString());switch(e){case"deg":return this.degValue();case"rad":return this.radValue();case"grad":return this.gradValue();case"turn":return this.turnValue();default:throw new Error("unknown angle units: "+e)}}to(e){switch(e){case"deg":return this.deg();case"rad":return this.rad();case"grad":return this.grad();case"turn":return this.turn();default:throw new Error("unknown angle units: "+e)}}interpolateTo(e){return e instanceof la?ma(this,e):null}static zero(e){switch(e){case"deg":return ca.zero();case void 0:case"rad":return da.zero();case"grad":return pa.zero();case"turn":return fa.zero();default:throw new Error("unknown angle units: "+e)}}static deg(e){return new ca(e)}static rad(e){return new da(e)}static grad(e){return new pa(e)}static turn(e){return new fa(e)}static create(e,t){switch(t){case"deg":return la.deg(e);case void 0:case"rad":return la.rad(e);case"grad":return la.grad(e);case"turn":return la.turn(e);default:throw new Error("unknown angle units: "+t)}}static fromCssValue(e){if(e instanceof CSSUnitValue)return la.create(e.value,e.unit);throw new TypeError(""+e)}static fromAny(e,t){if(null==e||e instanceof la)return e;if("number"==typeof e)return la.create(e,t);if("string"==typeof e)return la.parse(e,t);throw new TypeError(""+e)}static fromValue(e){if(2===e.length){const t=e.getItem(0).numberValue(),r=e.getItem(1);if(void 0!==t&&isFinite(t)&&r instanceof gr&&r.toValue()===xr.extant())switch(r.key.value){case"deg":return la.deg(t);case"rad":return la.rad(t);case"grad":return la.grad(t);case"turn":return la.turn(t)}}return null}static parse(e,t){let r=Se.stringInput(e);for(;r.isCont()&&Se.isWhitespace(r.head());)r=r.step();let i=wa.parse(r,t);if(i.isDone())for(;r.isCont()&&Se.isWhitespace(r.head());)r=r.step();return r.isCont()&&!i.isError()&&(i=Le.error(Ae.unexpected(r))),i.bind()}static form(){return new ya(void 0,la.zero())}static isAny(e){return e instanceof la||"number"==typeof e||"string"==typeof e}}i([a],la,"form",null);class ca extends la{constructor(e){super(),this.value=e}get units(){return"deg"}degValue(){return this.value}gradValue(){return 10*this.value/9}radValue(){return this.value*Math.PI/180}turnValue(){return this.value/360}deg(){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"deg"):null}compareTo(e){if(e instanceof la){const t=this.value,r=e.degValue();return t<r?-1:t>r?1:isNaN(r)?isNaN(t)?0:-1:isNaN(t)?1:0}return NaN}equivalentTo(e,t){return e instanceof la&&c.equivalent(this.value,e.degValue())}equals(e){return e instanceof ca&&this.value===e.value}hashCode(){return o.mash(o.mix(m.hash(ca),c.hash(this.value)))}debug(e){return e=e.write("Angle").write(46).write("deg").write(40).debug(this.value).write(41)}toString(){return this.value+"deg"}static zero(){return new ca(0)}}i([a],ca,"zero",null);class da extends la{constructor(e){super(),this.value=e}get units(){return"rad"}degValue(){return 180*this.value/Math.PI}gradValue(){return 200*this.value/Math.PI}radValue(){return this.value}turnValue(){return this.value/(2*Math.PI)}rad(){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"rad"):null}compareTo(e){if(e instanceof la){const t=this.value,r=e.radValue();return t<r?-1:t>r?1:isNaN(r)?isNaN(t)?0:-1:isNaN(t)?1:0}return NaN}equivalentTo(e,t){return e instanceof la&&c.equivalent(this.value,e.radValue())}equals(e){return e instanceof da&&this.value===e.value}hashCode(){return o.mash(o.mix(m.hash(da),c.hash(this.value)))}debug(e){return e=e.write("Angle").write(46).write("rad").write(40).debug(this.value).write(41)}toString(){return this.value+"rad"}static zero(){return new da(0)}}i([a],da,"zero",null);class pa extends la{constructor(e){super(),this.value=e}get units(){return"grad"}degValue(){return.9*this.value}gradValue(){return this.value}radValue(){return this.value*Math.PI/200}turnValue(){return this.value/400}grad(){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"grad"):null}compareTo(e){if(e instanceof la){const t=this.value,r=e.gradValue();return t<r?-1:t>r?1:isNaN(r)?isNaN(t)?0:-1:isNaN(t)?1:0}return NaN}equivalentTo(e,t){return e instanceof la&&c.equivalent(this.value,e.gradValue())}equals(e){return e instanceof pa&&this.value===e.value}hashCode(){return o.mash(o.mix(m.hash(pa),c.hash(this.value)))}debug(e){return e=e.write("Angle").write(46).write("grad").write(40).debug(this.value).write(41)}toString(){return this.value+"grad"}static zero(){return new pa(0)}}i([a],pa,"zero",null);class fa extends la{constructor(e){super(),this.value=e}get units(){return"turn"}degValue(){return 360*this.value}gradValue(){return 400*this.value}radValue(){return this.value*(2*Math.PI)}turnValue(){return this.value}turn(){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"turn"):null}compareTo(e){if(e instanceof la){const t=this.value,r=e.turnValue();return t<r?-1:t>r?1:isNaN(r)?isNaN(t)?0:-1:isNaN(t)?1:0}return NaN}equivalentTo(e,t){return e instanceof la&&c.equivalent(this.value,e.turnValue())}equals(e){return e instanceof fa&&this.value===e.value}hashCode(){return o.mash(o.mix(m.hash(fa),c.hash(this.value)))}debug(e){return e=e.write("Angle").write(46).write("turn").write(40).debug(this.value).write(41)}toString(){return this.value+"turn"}static zero(){return new fa(0)}}i([a],fa,"zero",null);const ma=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1];return la.create(t.value+e*(r.value-t.value),r.units)};return Object.setPrototypeOf(i,t.prototype),i[0]=e.to(r.units),i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class ya extends Mi{constructor(e,t){super(),this.defaultUnits=e,Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(e){return e!==this.unit?new ya(this.defaultUnits,e):this}mold(e){return e=la.fromAny(e,this.defaultUnits),Tr.from(e.toString())}cast(e){const t=e.toValue();let r=null;try{if(r=la.fromValue(t),void 0===r){const e=t.stringValue(void 0);void 0!==e&&(r=la.parse(e,this.defaultUnits))}}catch(e){}return null!==r?r:void 0}}class wa extends Le{constructor(e,t,r,i){super(),this.defaultUnits=e,this.valueParser=t,this.unitsOutput=r,this.step=i}feed(e){return wa.parse(e,this.defaultUnits,this.valueParser,this.unitsOutput,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n)if((r=void 0===r?Ee.parseDecimal(e):r.feed(e)).isDone())n=2;else if(r.isError())return r.asError();if(2===n){for(i=i||Se.stringOutput();e.isCont()&&(s=e.head(),Se.isAlpha(s));)e=e.step(),i.push(s);if(!e.isEmpty()){const n=r.bind(),s=i.bind()||t;switch(s){case"deg":return Le.done(la.deg(n));case"":case"rad":return Le.done(la.rad(n));case"grad":return Le.done(la.grad(n));case"turn":return Le.done(la.turn(n));default:return Le.error(Ae.message("unknown units: "+s,e))}}}return new wa(t,r,i,n)}}class ga{constructor(e,t){this.x=e,this.y=t}isDefined(){return isFinite(this.x)&&isFinite(this.y)}plus(e){return new ga(this.x+e.x,this.y+e.y)}negative(){return new ga(-this.x,-this.y)}minus(e){return new ga(this.x-e.x,this.y-e.y)}times(e){return new ga(this.x*e,this.y*e)}toAny(){return{x:this.x,y:this.y}}interpolateTo(e){return e instanceof ga?va(this,e):null}equivalentTo(e,t){return this===e||e instanceof ga&&(c.equivalent(this.x,e.x,t)&&c.equivalent(this.y,e.y,t))}equals(e){return this===e||e instanceof ga&&(this.x===e.x&&this.y===e.y)}hashCode(){return o.mash(o.mix(o.mix(m.hash(ga),c.hash(this.x)),c.hash(this.y)))}debug(e){return e=e.write("R2Vector").write(46).write("of").write(40).debug(this.x).write(", ").debug(this.y).write(41)}toString(){return Oe.debug(this)}static zero(){return new ga(0,0)}static of(e,t){return new ga(e,t)}static fromInit(e){return new ga(e.x,e.y)}static fromAny(e){if(null==e||e instanceof ga)return e;if(ga.isInit(e))return ga.fromInit(e);throw new TypeError(""+e)}static isInit(e){if("object"==typeof e&&null!==e){const t=e;return"number"==typeof t.x&&"number"==typeof t.y}return!1}static isAny(e){return e instanceof ga||ga.isInit(e)}}i([a],ga,"zero",null);const va=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=t.x+e*(r.x-t.x),s=t.y+e*(r.y-t.y);return new ga(n,s)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class ba{union(e){return e=ba.fromAny(e),new Ba(Math.min(this.xMin,e.xMin),Math.min(this.yMin,e.yMin),Math.max(this.xMax,e.xMax),Math.max(this.yMax,e.yMax))}get bounds(){return new Ba(this.xMin,this.yMin,this.xMax,this.yMax)}static fromAny(e){if(null==e||e instanceof ba)return e;if(xa.isInit(e))return xa.fromInit(e);if(xa.isTuple(e))return xa.fromTuple(e);if(Aa.isInit(e))return Aa.fromInit(e);if(Ba.isInit(e))return Ba.fromInit(e);if(La.isInit(e))return La.fromInit(e);throw new TypeError(""+e)}static isAny(e){return e instanceof ba||xa.isInit(e)||xa.isTuple(e)||Aa.isInit(e)||Ba.isInit(e)||La.isInit(e)}}class xa extends ba{constructor(e,t){super(),this.x=e,this.y=t}isDefined(){return isFinite(this.x)&&isFinite(this.y)}get xMin(){return this.x}get yMin(){return this.y}get xMax(){return this.x}get yMax(){return this.y}plus(e){return new xa(this.x+e.x,this.y+e.y)}minus(e){return e instanceof ga?new xa(this.x-e.x,this.y-e.y):new ga(this.x-e.x,this.y-e.y)}contains(e,t){return"number"==typeof e?this.x===e&&this.y===t:(e=ba.fromAny(e))instanceof xa?this.x===e.x&&this.y===e.y:e instanceof ba&&(this.x<=e.xMin&&e.xMax<=this.x&&this.y<=e.yMin&&e.yMax<=this.y)}intersects(e){return(e=ba.fromAny(e)).intersects(this)}transform(e){return new xa(e.transformX(this.x,this.y),e.transformY(this.x,this.y))}toAny(){return{x:this.x,y:this.y}}interpolateTo(e){return e instanceof xa?Ca(this,e):null}equivalentTo(e,t){return this===e||e instanceof xa&&(c.equivalent(this.x,e.x,t)&&c.equivalent(this.y,e.y,t))}equals(e){return this===e||e instanceof xa&&(this.x===e.x&&this.y===e.y)}hashCode(){return o.mash(o.mix(o.mix(m.hash(xa),c.hash(this.x)),c.hash(this.y)))}debug(e){return e=e.write("R2Point").write(46).write("of").write(40).debug(this.x).write(", ").debug(this.y).write(41)}toString(){return Oe.debug(this)}static origin(){return new xa(0,0)}static undefined(){return new xa(NaN,NaN)}static of(e,t){return new xa(e,t)}static fromInit(e){return new xa(e.x,e.y)}static fromTuple(e){return new xa(e[0],e[1])}static fromAny(e){if(null==e||e instanceof xa)return e;if(xa.isInit(e))return xa.fromInit(e);if(xa.isTuple(e))return xa.fromTuple(e);throw new TypeError(""+e)}static isInit(e){if("object"==typeof e&&null!==e){const t=e;return"number"==typeof t.x&&"number"==typeof t.y}return!1}static isTuple(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}static isAny(e){return e instanceof xa||xa.isInit(e)||xa.isTuple(e)}}i([a],xa,"origin",null),i([a],xa,"undefined",null);const Ca=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=t.x+e*(r.x-t.x),s=t.y+e*(r.y-t.y);return new xa(n,s)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class Sa extends ba{draw(e){this.drawMove(e),this.drawRest(e)}transformDraw(e,t){this.transformDrawMove(e,t),this.transformDrawRest(e,t)}writePath(e){return e=this.writeMove(e),e=this.writeRest(e)}toPathString(e){let t=Se.stringOutput(e);return t=this.writePath(t),t.toString()}static linear(e,t,r,i){return new Aa(e,t,r,i)}static quadratic(e,t,r,i,n,s){return new Pa(e,t,r,i,n,s)}static cubic(e,t,r,i,n,s,o,a){return new Ia(e,t,r,i,n,s,o,a)}static elliptic(e,t,r,i,n,s,o){return new Va(e,t,r,i,n,s,o)}static parse(e){let t=Se.stringInput(e);for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();let r=Oa.parse(t);if(r.isDone())for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}}class Oa extends Le{constructor(e,t,r,i){super(),this.x0Parser=e,this.y0Parser=t,this.command=r,this.step=i}feed(e){return Oa.parse(e,this.x0Parser,this.y0Parser,this.command,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n){for(;e.isCont()&&(s=e.head(),Se.isSpace(s));)e=e.step();if(e.isCont()){if(77!==s&&109!==s)return Le.error(Ae.expected("moveto",e));e=e.step(),i=s,n=2}else if(!e.isEmpty())return Le.error(Ae.unexpected(e))}if(2===n){if(void 0===t){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(t=Ee.parseDecimal(e))}else t=t.feed(e);if(void 0!==t)if(t.isDone())n=3;else if(t.isError())return t.asError()}if(3===n){for(;e.isCont()&&(s=e.head(),Se.isSpace(s));)e=e.step();e.isCont()?(44===s&&(e=e.step()),n=4):e.isEmpty()||(n=4)}if(4===n){if(void 0===r){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(r=Ee.parseDecimal(e))}else r=r.feed(e);if(void 0!==r)if(r.isDone())n=5;else if(r.isError())return r.asError()}if(5===n){for(;e.isCont()&&(s=e.head(),Se.isSpace(s));)e=e.step();if(e.isCont())switch(s){case 76:case 108:case 72:case 104:case 86:case 118:return Da.parse(e,t,r);case 81:case 113:return Ta.parse(e,t,r);case 84:return Ta.parse(e,t,r,t,r);case 116:return Ta.parse(e,t,r,Le.done(0),Le.done(0));case 67:case 99:return Ma.parse(e,t,r);case 83:return Ma.parse(e,t,r,t,r);case 115:return Ma.parse(e,t,r,Le.done(0),Le.done(0));case 65:case 97:return qa.parse(e,t,r);case 44:e=e.step();case 43:case 45:case 46:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:switch(i){case 77:case 109:return Da.parseRest(e,i,t,r)}default:return Le.error(Ae.expected("draw command",e))}else if(!e.isEmpty())return Le.error(Ae.unexpected(e))}return new Oa(t,r,i,n)}}class Ea extends Sa{}class Aa extends Ea{constructor(e,t,r,i){super(),this.x0=e,this.y0=t,this.x1=r,this.y1=i}isDefined(){return isFinite(this.x0)&&isFinite(this.y0)&&isFinite(this.x1)&&isFinite(this.y1)}get xMin(){return Math.min(this.x0,this.x1)}get yMin(){return Math.min(this.y0,this.y1)}get xMax(){return Math.max(this.x0,this.x1)}get yMax(){return Math.max(this.y0,this.y1)}interpolateX(e){return(1-e)*this.x0+e*this.x1}interpolateY(e){return(1-e)*this.y0+e*this.y1}interpolate(e){const t=1-e,r=t*this.x0+e*this.x1,i=t*this.y0+e*this.y1;return new xa(r,i)}contains(e,t){return"number"==typeof e?Aa.contains(this.x0,this.y0,this.x1,this.y1,e,t):(e=ba.fromAny(e))instanceof xa?this.containsPoint(e):e instanceof Aa&&this.containsSegment(e)}containsPoint(e){return Aa.contains(this.x0,this.y0,this.x1,this.y1,e.x,e.y)}containsSegment(e){return Aa.contains(this.x0,this.y0,this.x1,this.y1,e.x0,e.y0)&&Aa.contains(this.x0,this.y0,this.x1,this.y1,e.x1,e.y1)}static contains(e,t,r,i,n,s){return(e<=n&&n<=r||r<=n&&n<=e)&&(t<=s&&s<=i||i<=s&&s<=t)&&(r-e)*(s-t)==(n-e)*(i-t)}intersects(e){return(e=ba.fromAny(e))instanceof xa?this.intersectsPoint(e):e instanceof Aa?this.intersectsSegment(e):e.intersects(this)}intersectsPoint(e){return Aa.contains(this.x0,this.y0,this.x1,this.y1,e.x,e.y)}intersectsSegment(e){return Aa.intersects(this.x0,this.y0,this.x1-this.x0,this.y1-this.y0,e.x0,e.y0,e.x1-e.x0,e.y1-e.y0)}static intersects(e,t,r,i,n,s,o,a){const u=n-e,h=s-t,l=u*i-h*r,c=r*a-i*o;if(0===l&&0===c){const e=r*r+i*i,t=o*r+a*i,n=(u*r+h*i)/e,s=n+t/e;return t>=0?0<s&&n<1:0<n&&s<1}if(0===c)return!1;{const e=(u*a-h*o)/c,t=l/c;return 0<=e&&e<=1&&0<=t&&t<=1}}split(e){const t=1-e,r=t*this.x0+e*this.x1,i=t*this.y0+e*this.y1;return[new Aa(this.x0,this.y0,r,i),new Aa(r,i,this.x1,this.y1)]}transform(e){return new Aa(e.transformX(this.x0,this.y0),e.transformY(this.x0,this.y0),e.transformX(this.x1,this.y1),e.transformY(this.x1,this.y1))}toAny(){return{x0:this.x0,y0:this.y0,x1:this.x1,y1:this.y1}}drawMove(e){e.moveTo(this.x0,this.y0)}drawRest(e){e.lineTo(this.x1,this.y1)}transformDrawMove(e,t){e.moveTo(t.transformX(this.x0,this.y0),t.transformY(this.x0,this.y0))}transformDrawRest(e,t){e.lineTo(t.transformX(this.x1,this.y1),t.transformY(this.x1,this.y1))}writeMove(e){return e=e.write(77),e=(e=Oe.displayNumber(e,this.x0)).write(44),e=Oe.displayNumber(e,this.y0)}writeRest(e){return e=e.write(76),e=(e=Oe.displayNumber(e,this.x1)).write(44),e=Oe.displayNumber(e,this.y1)}interpolateTo(e){return e instanceof Aa?ka(this,e):null}equivalentTo(e,t){return this===e||e instanceof Aa&&(c.equivalent(this.x0,e.x0,t)&&c.equivalent(this.y0,e.y0,t)&&c.equivalent(this.x1,e.x1,t)&&c.equivalent(this.y1,e.y1,t))}equals(e){return this===e||e instanceof Aa&&(this.x0===e.x0&&this.y0===e.y0&&this.x1===e.x1&&this.y1===e.y1)}hashCode(){return o.mash(o.mix(o.mix(o.mix(o.mix(m.hash(Aa),c.hash(this.x0)),c.hash(this.y0)),c.hash(this.x1)),c.hash(this.y1)))}debug(e){return e=e.write("R2Segment").write(46).write("of").write(40).debug(this.x0).write(", ").debug(this.y0).write(", ").debug(this.x1).write(", ").debug(this.y1).write(41)}toString(){return Oe.debug(this)}static of(e,t,r,i){return new Aa(e,t,r,i)}static fromInit(e){return new Aa(e.x0,e.y0,e.x1,e.y1)}static fromAny(e){if(null==e||e instanceof Aa)return e;if(Aa.isInit(e))return Aa.fromInit(e);throw new TypeError(""+e)}static isInit(e){if("object"==typeof e&&null!==e){const t=e;return"number"==typeof t.x0&&"number"==typeof t.y0&&"number"==typeof t.x1&&"number"==typeof t.y1}return!1}static isAny(e){return e instanceof Aa||Aa.isInit(e)}}const ka=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=t.x0+e*(r.x0-t.x0),s=t.y0+e*(r.y0-t.y0),o=t.x1+e*(r.x1-t.x1),a=t.y1+e*(r.y1-t.y1);return new Aa(n,s,o,a)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class Da extends Le{constructor(e,t,r,i,n,s){super(),this.x0Parser=e,this.y0Parser=t,this.x1Parser=r,this.y1Parser=i,this.command=n,this.step=s}feed(e){return Da.parse(e,this.x0Parser,this.y0Parser,this.x1Parser,this.y1Parser,this.command,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;if(1===o){for(;e.isCont()&&(a=e.head(),Se.isSpace(a));)e=e.step();if(e.isCont())switch(a){case 77:case 109:case 76:case 108:e=e.step(),s=a,o=2;break;case 72:e=e.step(),n=r,s=a,o=2;break;case 104:e=e.step(),n=Le.done(0),s=a,o=2;break;case 86:e=e.step(),i=t,s=a,o=4;break;case 118:e=e.step(),i=Le.done(0),s=a,o=4;break;default:return Le.error(Ae.expected("lineto",e))}else if(!e.isEmpty())return Le.error(Ae.unexpected(e))}if(2===o){if(void 0===i){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(i=Ee.parseDecimal(e))}else i=i.feed(e);if(void 0!==i)if(i.isDone())o=void 0!==n&&n.isDone()?4:3;else if(i.isError())return i.asError()}if(3===o){for(;e.isCont()&&(a=e.head(),Se.isSpace(a));)e=e.step();e.isCont()?(44===a&&(e=e.step()),o=4):e.isEmpty()||(o=4)}if(4===o){if(void 0===n){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(n=Ee.parseDecimal(e))}else n=n.feed(e);if(void 0!==n){if(n.isDone()){const e=t.bind(),o=r.bind();let a=i.bind(),u=n.bind();return 109!==s&&108!==s&&104!==s&&118!==s||(a+=e,u+=o),Le.done(new Aa(e,o,a,u))}if(n.isError())return n.asError()}}return new Da(t,r,i,n,s,o)}static parseRest(e,t,r,i){let n,s,o;switch(t){case 72:s=i,o=2;break;case 104:s=Le.done(0),o=2;break;case 86:n=r,o=4;break;case 118:n=Le.done(0),o=4;break;default:o=2}return this.parse(e,r,i,n,s,t,o)}}class Pa extends Ea{constructor(e,t,r,i,n,s){super(),this.x0=e,this.y0=t,this.x1=r,this.y1=i,this.x2=n,this.y2=s}isDefined(){return isFinite(this.x0)&&isFinite(this.y0)&&isFinite(this.x1)&&isFinite(this.y1)&&isFinite(this.x2)&&isFinite(this.y2)}get xMin(){return Math.min(this.x0,this.x1,this.x2)}get yMin(){return Math.min(this.y0,this.y1,this.y2)}get xMax(){return Math.max(this.x0,this.x1,this.x2)}get yMax(){return Math.max(this.y0,this.y1,this.y2)}interpolateX(e){const t=1-e;return t*(t*this.x0+e*this.x1)+e*(t*this.x1+e*this.x2)}interpolateY(e){const t=1-e;return t*(t*this.y0+e*this.y1)+e*(t*this.y1+e*this.y2)}interpolate(e){const t=1-e,r=t*this.x0+e*this.x1,i=t*this.y0+e*this.y1,n=t*this.x1+e*this.x2,s=t*this.y1+e*this.y2;return new xa(t*r+e*n,t*i+e*s)}contains(e,t){return!1}intersects(e){return!1}split(e){const t=1-e,r=t*this.x0+e*this.x1,i=t*this.y0+e*this.y1,n=t*this.x1+e*this.x2,s=t*this.y1+e*this.y2,o=t*r+e*n,a=t*i+e*s;return[new Pa(this.x0,this.y0,r,i,o,a),new Pa(o,a,n,s,this.x2,this.y2)]}transform(e){return new Pa(e.transformX(this.x0,this.y0),e.transformY(this.x0,this.y0),e.transformX(this.x1,this.y1),e.transformY(this.x1,this.y1),e.transformX(this.x2,this.y2),e.transformY(this.x2,this.y2))}drawMove(e){e.moveTo(this.x0,this.y0)}drawRest(e){e.quadraticCurveTo(this.x1,this.y1,this.x2,this.y2)}transformDrawMove(e,t){e.moveTo(t.transformX(this.x0,this.y0),t.transformY(this.x0,this.y0))}transformDrawRest(e,t){e.quadraticCurveTo(t.transformX(this.x1,this.y1),t.transformY(this.x1,this.y1),t.transformX(this.x2,this.y2),t.transformY(this.x2,this.y2))}writeMove(e){return e=e.write(77),e=(e=Oe.displayNumber(e,this.x0)).write(44),e=Oe.displayNumber(e,this.y0)}writeRest(e){return e=e.write(81),e=(e=Oe.displayNumber(e,this.x1)).write(44),e=(e=Oe.displayNumber(e,this.y1)).write(44),e=(e=Oe.displayNumber(e,this.x2)).write(44),e=Oe.displayNumber(e,this.y2)}equivalentTo(e,t){return this===e||e instanceof Pa&&(c.equivalent(this.x0,e.x0,t)&&c.equivalent(this.y0,e.y0,t)&&c.equivalent(this.x1,e.x1,t)&&c.equivalent(this.y1,e.y1,t)&&c.equivalent(this.x2,e.x2,t)&&c.equivalent(this.y2,e.y2,t))}equals(e){return this===e||e instanceof Pa&&(this.x0===e.x0&&this.y0===e.y0&&this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2)}debug(e){return e=e.write("R2Curve").write(46).write("quadratic").write(40).debug(this.x0).write(", ").debug(this.y0).write(", ").debug(this.x1).write(", ").debug(this.y1).write(", ").debug(this.x2).write(", ").debug(this.y2).write(41)}toString(){return Oe.debug(this)}}class Ta extends Le{constructor(e,t,r,i,n,s,o,a){super(),this.x0Parser=e,this.y0Parser=t,this.x1Parser=r,this.y1Parser=i,this.x2Parser=n,this.y2Parser=s,this.command=o,this.step=a}feed(e){return Ta.parse(e,this.x0Parser,this.y0Parser,this.x1Parser,this.y1Parser,this.x2Parser,this.y2Parser,this.command,this.step)}static parse(e,t,r,i,n,s,o,a,u=1){let h=0;if(1===u){for(;e.isCont()&&(h=e.head(),Se.isSpace(h));)e=e.step();if(e.isCont())switch(h){case 81:case 113:e=e.step(),a=h,u=2;break;case 84:case 116:e=e.step(),a=h,u=6;break;default:return Le.error(Ae.expected("curveto",e))}else if(!e.isEmpty())return Le.error(Ae.unexpected(e))}if(2===u){if(void 0===i){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(i=Ee.parseDecimal(e))}else i=i.feed(e);if(void 0!==i)if(i.isDone())u=3;else if(i.isError())return i.asError()}if(3===u){for(;e.isCont()&&(h=e.head(),Se.isSpace(h));)e=e.step();e.isCont()?(44===h&&(e=e.step()),u=4):e.isEmpty()||(u=4)}if(4===u){if(void 0===n){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(n=Ee.parseDecimal(e))}else n=n.feed(e);if(void 0!==n)if(n.isDone())u=5;else if(n.isError())return n.asError()}if(5===u){for(;e.isCont()&&(h=e.head(),Se.isSpace(h));)e=e.step();e.isCont()?(44===h&&(e=e.step()),u=6):e.isEmpty()||(u=6)}if(6===u){if(void 0===s){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(s=Ee.parseDecimal(e))}else s=s.feed(e);if(void 0!==s)if(s.isDone())u=7;else if(s.isError())return s.asError()}if(7===u){for(;e.isCont()&&(h=e.head(),Se.isSpace(h));)e=e.step();e.isCont()?(44===h&&(e=e.step()),u=8):e.isEmpty()||(u=8)}if(8===u){if(void 0===o){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(o=Ee.parseDecimal(e))}else o=o.feed(e);if(void 0!==o){if(o.isDone()){const e=t.bind(),u=r.bind();let h=i.bind(),l=n.bind(),c=s.bind(),d=o.bind();return 113!==a&&116!==a||(h+=e,l+=u,c+=e,d+=u),Le.done(new Pa(e,u,h,l,c,d))}if(o.isError())return o.asError()}}return new Ta(t,r,i,n,s,o,a,u)}static parseRest(e,t,r,i,n,s){const o=84===t||116===t?6:2;return Ta.parse(e,r,i,n,s,void 0,void 0,t,o)}}class Ia extends Ea{constructor(e,t,r,i,n,s,o,a){super(),this.x0=e,this.y0=t,this.x1=r,this.y1=i,this.x2=n,this.y2=s,this.x3=o,this.y3=a}isDefined(){return isFinite(this.x0)&&isFinite(this.y0)&&isFinite(this.x1)&&isFinite(this.y1)&&isFinite(this.x2)&&isFinite(this.y2)&&isFinite(this.x3)&&isFinite(this.y3)}get xMin(){return Math.min(this.x0,this.x1,this.x2,this.x3)}get yMin(){return Math.min(this.y0,this.y1,this.y2,this.y3)}get xMax(){return Math.max(this.x0,this.x1,this.x2,this.x3)}get yMax(){return Math.max(this.y0,this.y1,this.y2,this.y3)}interpolateX(e){const t=1-e,r=t*this.x0+e*this.x1,i=t*this.x1+e*this.x2;return t*(t*r+e*i)+e*(t*i+e*(t*this.x2+e*this.x3))}interpolateY(e){const t=1-e,r=t*this.y0+e*this.y1,i=t*this.y1+e*this.y2;return t*(t*r+e*i)+e*(t*i+e*(t*this.y2+e*this.y3))}interpolate(e){const t=1-e,r=t*this.x0+e*this.x1,i=t*this.y0+e*this.y1,n=t*this.x1+e*this.x2,s=t*this.y1+e*this.y2,o=t*this.x2+e*this.x3,a=t*this.y2+e*this.y3;return new xa(t*(t*r+e*n)+e*(t*n+e*o),t*(t*i+e*s)+e*(t*s+e*a))}contains(e,t){return!1}intersects(e){return!1}split(e){const t=1-e,r=t*this.x0+e*this.x1,i=t*this.y0+e*this.y1,n=t*this.x1+e*this.x2,s=t*this.y1+e*this.y2,o=t*this.x2+e*this.x3,a=t*this.y2+e*this.y3,u=t*r+e*n,h=t*i+e*s,l=t*n+e*o,c=t*s+e*a,d=t*u+e*l,p=t*h+e*c;return[new Ia(this.x0,this.y0,r,i,u,h,d,p),new Ia(d,p,l,c,o,a,this.x3,this.y3)]}transform(e){return new Ia(e.transformX(this.x0,this.y0),e.transformY(this.x0,this.y0),e.transformX(this.x1,this.y1),e.transformY(this.x1,this.y1),e.transformX(this.x2,this.y2),e.transformY(this.x2,this.y2),e.transformX(this.x3,this.y3),e.transformY(this.x3,this.y3))}drawMove(e){e.moveTo(this.x0,this.y0)}drawRest(e){e.bezierCurveTo(this.x1,this.y1,this.x2,this.y2,this.x3,this.y3)}transformDrawMove(e,t){e.moveTo(t.transformX(this.x0,this.y0),t.transformY(this.x0,this.y0))}transformDrawRest(e,t){e.bezierCurveTo(t.transformX(this.x1,this.y1),t.transformY(this.x1,this.y1),t.transformX(this.x2,this.y2),t.transformY(this.x2,this.y2),t.transformX(this.x3,this.y3),t.transformY(this.x3,this.y3))}writeMove(e){return e=e.write(77),e=(e=Oe.displayNumber(e,this.x0)).write(44),e=Oe.displayNumber(e,this.y0)}writeRest(e){return e=e.write(67),e=(e=Oe.displayNumber(e,this.x1)).write(44),e=(e=Oe.displayNumber(e,this.y1)).write(44),e=(e=Oe.displayNumber(e,this.x2)).write(44),e=(e=Oe.displayNumber(e,this.y2)).write(44),e=(e=Oe.displayNumber(e,this.x3)).write(44),e=Oe.displayNumber(e,this.y3)}equivalentTo(e,t){return this===e||e instanceof Ia&&(c.equivalent(this.x0,e.x0,t)&&c.equivalent(this.y0,e.y0,t)&&c.equivalent(this.x1,e.x1,t)&&c.equivalent(this.y1,e.y1,t)&&c.equivalent(this.x2,e.x2,t)&&c.equivalent(this.y2,e.y2,t)&&c.equivalent(this.x3,e.x3,t)&&c.equivalent(this.y3,e.y3,t))}equals(e){return this===e||e instanceof Ia&&(this.x0===e.x0&&this.y0===e.y0&&this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2&&this.x3===e.x3&&this.y3===e.y3)}debug(e){return e=e.write("R2Curve").write(46).write("cubic").write(40).debug(this.x0).write(", ").debug(this.y0).write(", ").debug(this.x1).write(", ").debug(this.y1).write(", ").debug(this.x2).write(", ").debug(this.y2).write(", ").debug(this.x3).write(", ").debug(this.y3).write(41)}toString(){return Oe.debug(this)}}class Ma extends Le{constructor(e,t,r,i,n,s,o,a,u,h){super(),this.x0Parser=e,this.y0Parser=t,this.x1Parser=r,this.y1Parser=i,this.x2Parser=n,this.y2Parser=s,this.x3Parser=o,this.y3Parser=a,this.command=u,this.step=h}feed(e){return Ma.parse(e,this.x0Parser,this.y0Parser,this.x1Parser,this.y1Parser,this.x2Parser,this.y2Parser,this.x3Parser,this.y3Parser,this.command,this.step)}static parse(e,t,r,i,n,s,o,a,u,h,l=1){let c=0;if(1===l){for(;e.isCont()&&(c=e.head(),Se.isSpace(c));)e=e.step();if(e.isCont())switch(c){case 67:case 99:e=e.step(),h=c,l=2;break;case 83:case 115:e=e.step(),h=c,l=6;break;default:return Le.error(Ae.expected("curveto",e))}else if(!e.isEmpty())return Le.error(Ae.unexpected(e))}if(2===l){if(void 0===i){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(i=Ee.parseDecimal(e))}else i=i.feed(e);if(void 0!==i)if(i.isDone())l=3;else if(i.isError())return i.asError()}if(3===l){for(;e.isCont()&&(c=e.head(),Se.isSpace(c));)e=e.step();e.isCont()?(44===c&&(e=e.step()),l=4):e.isEmpty()||(l=4)}if(4===l){if(void 0===n){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(n=Ee.parseDecimal(e))}else n=n.feed(e);if(void 0!==n)if(n.isDone())l=5;else if(n.isError())return n.asError()}if(5===l){for(;e.isCont()&&(c=e.head(),Se.isSpace(c));)e=e.step();e.isCont()?(44===c&&(e=e.step()),l=6):e.isEmpty()||(l=6)}if(6===l){if(void 0===s){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(s=Ee.parseDecimal(e))}else s=s.feed(e);if(void 0!==s)if(s.isDone())l=7;else if(s.isError())return s.asError()}if(7===l){for(;e.isCont()&&(c=e.head(),Se.isSpace(c));)e=e.step();e.isCont()?(44===c&&(e=e.step()),l=8):e.isEmpty()||(l=8)}if(8===l){if(void 0===o){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(o=Ee.parseDecimal(e))}else o=o.feed(e);if(void 0!==o)if(o.isDone())l=9;else if(o.isError())return o.asError()}if(9===l){for(;e.isCont()&&(c=e.head(),Se.isSpace(c));)e=e.step();e.isCont()?(44===c&&(e=e.step()),l=10):e.isEmpty()||(l=10)}if(10===l){if(void 0===a){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(a=Ee.parseDecimal(e))}else a=a.feed(e);if(void 0!==a)if(a.isDone())l=11;else if(a.isError())return a.asError()}if(11===l){for(;e.isCont()&&(c=e.head(),Se.isSpace(c));)e=e.step();e.isCont()?(44===c&&(e=e.step()),l=12):e.isEmpty()||(l=12)}if(12===l){if(void 0===u){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(u=Ee.parseDecimal(e))}else u=u.feed(e);if(void 0!==u){if(u.isDone()){const e=t.bind(),l=r.bind();let c=i.bind(),d=n.bind(),p=s.bind(),f=o.bind(),m=a.bind(),y=u.bind();return 99!==h&&115!==h||(c+=e,d+=l,p+=e,f+=l,m+=e,y+=l),Le.done(new Ia(e,l,c,d,p,f,m,y))}if(u.isError())return u.asError()}}return new Ma(t,r,i,n,s,o,a,u,h,l)}static parseRest(e,t,r,i,n,s){const o=83===t||115===t?6:2;return Ma.parse(e,r,i,n,s,void 0,void 0,void 0,void 0,t,o)}}class Va extends Sa{constructor(e,t,r,i,n,s,o){super(),this.cx=e,this.cy=t,this.rx=r,this.ry=i,this.phi=n,this.a0=s,this.da=o}get xMin(){return this.cx-Math.max(this.rx,this.ry)}get yMin(){return this.cy-Math.max(this.rx,this.ry)}get xMax(){return this.cx+Math.max(this.rx,this.ry)}get yMax(){return this.cy+Math.max(this.rx,this.ry)}interpolateX(e){const t=this.a0+e*this.da,r=this.rx*Math.cos(t),i=this.ry*Math.sin(t),n=this.phi;return 0===n?this.cx+r:this.cx+r*Math.cos(n)-i*Math.sin(n)}interpolateY(e){const t=this.a0+e*this.da,r=this.rx*Math.cos(t),i=this.ry*Math.sin(t),n=this.phi;return 0===n?this.cy+i:this.cy+r*Math.sin(n)+i*Math.cos(n)}interpolate(e){const t=this.a0+e*this.da,r=this.rx*Math.cos(t),i=this.ry*Math.sin(t),n=this.phi;return 0===n?new xa(this.cx+r,this.cy+i):new xa(this.cx+r*Math.cos(n)-i*Math.sin(n),this.cy+r*Math.sin(n)+i*Math.cos(n))}contains(e,t){return!1}intersects(e){return!1}split(e){const t=this.a0,r=this.da,i=t+e*r;return[new Va(this.cx,this.cy,this.rx,this.ry,this.phi,t,i-t),new Va(this.cx,this.cy,this.rx,this.ry,this.phi,i,t+r-i)]}transform(e){const t=e.transformX(this.cx,this.cy),r=e.transformY(this.cx,this.cy),i=e.transformX(this.cx+this.rx,this.cy+this.ry)-t,n=e.transformY(this.cx+this.rx,this.cy+this.ry)-r,s=this.a0,o=this.da,a=s+o,u=Math.cos(s),h=Math.sin(s),l=Math.cos(a),c=Math.sin(a),d=e.transformX(this.cx+u,this.cy-h)-t,p=e.transformY(this.cx+u,this.cy-h)-r,f=e.transformX(this.cx+l,this.cy-c)-t,m=e.transformY(this.cx+l,this.cy-c)-r,y=Math.atan2(p,d);let w=Math.atan2(m,f);Math.abs(o)>Math.PI&&(w>0?w=-2*Math.PI+w:w<0&&(w=2*Math.PI-w));const g=w-y;return new Va(t,r,i,n,this.phi,y,g)}drawMove(e){const{x0:t,y0:r}=this.toEndpoints();e.moveTo(t,r)}drawRest(e){e.ellipse(this.cx,this.cy,this.rx,this.ry,this.phi,this.a0,this.a0+this.da,this.da<0)}transformDrawMove(e,t){const{x0:r,y0:i}=this.toEndpoints();e.moveTo(t.transformX(r,i),t.transformY(r,i))}transformDrawRest(e,t){const r=t.transformX(this.cx,this.cy),i=t.transformY(this.cx,this.cy),n=t.transformX(this.cx+this.rx,this.cy+this.ry)-r,s=t.transformY(this.cx+this.rx,this.cy+this.ry)-i,o=this.a0,a=this.da,u=o+a,h=Math.cos(o),l=Math.sin(o),c=Math.cos(u),d=Math.sin(u),p=t.transformX(this.cx+h,this.cy-l)-r,f=t.transformY(this.cx+h,this.cy-l)-i,m=t.transformX(this.cx+c,this.cy-d)-r,y=t.transformY(this.cx+c,this.cy-d)-i,w=Math.atan2(f,p);let g=Math.atan2(y,m);Math.abs(a)>Math.PI&&(g>0?g=-2*Math.PI+g:g<0&&(g=2*Math.PI-g));const v=g<w;e.ellipse(r,i,n,s,this.phi,w,g,v)}writeMove(e){const{x0:t,y0:r}=this.toEndpoints();return e=e.write(77),e=(e=Oe.displayNumber(e,t)).write(44),e=Oe.displayNumber(e,r)}writeRest(e){const{rx:t,ry:r,phi:i,large:n,sweep:s,x1:o,y1:a}=this.toEndpoints();return e=e.write(65),e=(e=Oe.displayNumber(e,t)).write(44),e=(e=Oe.displayNumber(e,r)).write(32),e=(e=(e=(e=(e=(e=Oe.displayNumber(e,i)).write(32)).write(n?49:48)).write(44)).write(s?49:48)).write(32),e=(e=Oe.displayNumber(e,o)).write(44),e=Oe.displayNumber(e,a)}toEndpoints(){const e=this.cx,t=this.cy,r=this.rx,i=this.ry,n=this.phi,s=this.a0,o=this.da,a=s+o,u=Math.cos(n),h=Math.sin(n),l=Math.cos(s),c=Math.sin(s),d=Math.cos(a),p=Math.sin(a),f=u*r*d-h*i*p+e,m=h*r*d+u*i*p+t;return{x0:u*r*l-h*i*c+e,y0:h*r*l+u*i*c+t,rx:r,ry:i,phi:n,large:Math.abs(o)>Math.PI,sweep:o>0,x1:f,y1:m}}equivalentTo(e,t){return this===e||e instanceof Va&&(c.equivalent(this.cx,e.cx,t)&&c.equivalent(this.cy,e.cy,t)&&c.equivalent(this.rx,e.rx,t)&&c.equivalent(this.ry,e.ry,t)&&c.equivalent(this.phi,e.phi,t)&&c.equivalent(this.a0,e.a0,t)&&c.equivalent(this.da,e.da,t))}equals(e){return this===e||e instanceof Va&&(this.cx===e.cx&&this.cy===e.cy&&this.rx===e.rx&&this.ry===e.ry&&this.phi===e.phi&&this.a0===e.a0&&this.da===e.da)}debug(e){return e=e.write("R2Curve").write(46).write("elliptic").write(40).debug(this.cx).write(", ").debug(this.cy).write(", ").debug(this.rx).write(", ").debug(this.ry).write(", ").debug(this.phi).write(", ").debug(this.a0).write(", ").debug(this.da).write(41)}toString(){return Oe.debug(this)}static fromEndpoints(e,t,r,i,n,s,o,a,u){const h=Math.cos(n),l=Math.sin(n),c=h*((e-a)/2)+l*((t-u)/2),d=(e-a)/2*-l+h*((t-u)/2),p=r*r,f=i*i,m=c*c,y=d*d;let w=Math.sqrt((p*f-p*y-f*m)/(p*y+f*m));s===o&&(w=-w);const g=w*r*d/i,v=-w*i*c/r,b=h*g-l*v+(e+a)/2,x=l*g+h*v+(t+u)/2;function C(e,t,r,i){const n=e*r+t*i,s=e*e+t*t,o=r*r+i*i;let a=Math.acos(n/(Math.sqrt(s)*Math.sqrt(o)));return e*i-t*r<0&&(a=-a),a}const S=C(1,0,(c-g)/r,(d-v)/i);let O=C((c-g)/r,(d-v)/i,(-c-g)/r,(-d-v)/i)%(2*Math.PI);return o&&O<0?O+=2*Math.PI:!o&&O>0&&(O-=2*Math.PI),new Va(b,x,r,i,n,S,O)}}class qa extends Le{constructor(e,t,r,i,n,s,o,a,u,h,l){super(),this.x0Parser=e,this.y0Parser=t,this.rxParser=r,this.ryParser=i,this.phiParser=n,this.large=s,this.sweep=o,this.x1Parser=a,this.y1Parser=u,this.command=h,this.step=l}feed(e){return qa.parse(e,this.x0Parser,this.y0Parser,this.rxParser,this.ryParser,this.phiParser,this.large,this.sweep,this.x1Parser,this.y1Parser,this.command,this.step)}static parse(e,t,r,i,n,s,o,a,u,h,l,c=1){let d=0;if(1===c){for(;e.isCont()&&(d=e.head(),Se.isSpace(d));)e=e.step();if(e.isCont())switch(d){case 65:case 97:e=e.step(),l=d,c=2;break;default:return Le.error(Ae.expected("arcto",e))}else if(!e.isEmpty())return Le.error(Ae.unexpected(e))}if(2===c){if(void 0===i){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(i=Ee.parseDecimal(e))}else i=i.feed(e);if(void 0!==i)if(i.isDone())c=3;else if(i.isError())return i.asError()}if(3===c){for(;e.isCont()&&(d=e.head(),Se.isSpace(d));)e=e.step();e.isCont()?(44===d&&(e=e.step()),c=4):e.isEmpty()||(c=4)}if(4===c){if(void 0===n){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(n=Ee.parseDecimal(e))}else n=n.feed(e);if(void 0!==n)if(n.isDone())c=5;else if(n.isError())return n.asError()}if(5===c){for(;e.isCont()&&(d=e.head(),Se.isSpace(d));)e=e.step();e.isCont()?(44===d&&(e=e.step()),c=6):e.isEmpty()||(c=6)}if(6===c){if(void 0===s){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(s=Ee.parseDecimal(e))}else s=s.feed(e);if(void 0!==s)if(s.isDone())c=7;else if(s.isError())return s.asError()}if(7===c){for(;e.isCont()&&(d=e.head(),Se.isSpace(d));)e=e.step();e.isCont()?(44===d&&(e=e.step()),c=8):e.isEmpty()||(c=8)}if(8===c){for(;e.isCont()&&(d=e.head(),Se.isSpace(d));)e=e.step();if(e.isCont())if(48===d)e=e.step(),o=!1,c=9;else{if(49!==d)return Le.error(Ae.expected("flag",e));e=e.step(),o=!0,c=9}else if(!e.isEmpty())return Le.error(Ae.unexpected(e))}if(9===c){for(;e.isCont()&&(d=e.head(),Se.isSpace(d));)e=e.step();e.isCont()?(44===d&&(e=e.step()),c=10):e.isEmpty()||(c=10)}if(10===c){for(;e.isCont()&&(d=e.head(),Se.isSpace(d));)e=e.step();if(e.isCont())if(48===d)e=e.step(),a=!1,c=11;else{if(49!==d)return Le.error(Ae.expected("flag",e));e=e.step(),a=!0,c=11}else if(!e.isEmpty())return Le.error(Ae.unexpected(e))}if(11===c){for(;e.isCont()&&(d=e.head(),Se.isSpace(d));)e=e.step();e.isCont()?(44===d&&(e=e.step()),c=12):e.isEmpty()||(c=12)}if(12===c){if(void 0===u){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(u=Ee.parseDecimal(e))}else u=u.feed(e);if(void 0!==u)if(u.isDone())c=13;else if(u.isError())return u.asError()}if(13===c){for(;e.isCont()&&(d=e.head(),Se.isSpace(d));)e=e.step();e.isCont()?(44===d&&(e=e.step()),c=14):e.isEmpty()||(c=14)}if(14===c){if(void 0===h){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(h=Ee.parseDecimal(e))}else h=h.feed(e);if(void 0!==h){if(h.isDone()){const e=t.bind(),c=r.bind(),d=i.bind(),p=n.bind(),f=s.bind()*Math.PI/180;let m=u.bind(),y=h.bind();return 97===l&&(m+=e,y+=c),Le.done(Va.fromEndpoints(e,c,d,p,f,o,a,m,y))}if(h.isError())return h.asError()}}return new qa(t,r,i,n,s,o,a,u,h,l,c)}static parseRest(e,t,r,i){return qa.parse(e,r,i,void 0,void 0,void 0,void 0,void 0,void 0,void 0,t,2)}}class Fa extends Sa{constructor(e,t){super(),this.curves=e,this.closed=t,this.boundingBox=null,this.pathString=void 0}isDefined(){return 0!==this.curves.length}isClosed(){return this.closed}get xMin(){return this.bounds.xMin}get yMin(){return this.bounds.yMin}get xMax(){return this.bounds.xMax}get yMax(){return this.bounds.yMax}interpolateX(e){const t=this.curves,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r-1),s=r*(e-n*i);return t[n].interpolateX(s)}return NaN}interpolateY(e){const t=this.curves,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r-1),s=r*(e-n*i);return t[n].interpolateY(s)}return NaN}interpolate(e){const t=this.curves,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r-1),s=r*(e-n*i);return t[n].interpolate(s)}return new xa(NaN,NaN)}contains(e,t){return!1}intersects(e){return!1}split(e){const t=this.curves,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r-1),s=r*(e-n*i),[o,a]=t[n].split(s),u=new Array(n+1),h=new Array(r-n);for(let e=0;e<n;e+=1)u[e]=t[e];u[n]=o,h[0]=a;for(let e=n+1;e<r;e+=1)h[e-n]=t[e];return[new Fa(u,!1),new Fa(h,!1)]}return[Fa.empty(),Fa.empty()]}subdivide(e){const t=this.curves,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r-1),s=r*(e-n*i),[o,a]=t[n].split(s),u=new Array(r+1);for(let e=0;e<n;e+=1)u[e]=t[e];u[n]=o,u[n+1]=a;for(let e=n+1;e<r;e+=1)u[e+1]=t[e];return new Fa(u,this.closed)}return Fa.empty()}transform(e){const t=this.curves,r=t.length;if(r>0){const i=new Array(r);for(let n=0;n<r;n+=1)i[n]=t[n].transform(e);return new Fa(i,this.closed)}return Fa.empty()}get bounds(){let e=this.boundingBox;if(null===e){let t=1/0,r=1/0,i=-1/0,n=-1/0;const s=this.curves;for(let e=0,o=s.length;e<o;e+=1){const o=s[e];t=Math.min(t,o.xMin),r=Math.min(r,o.yMin),i=Math.max(o.xMax,i),n=Math.max(o.yMax,n)}e=new Ba(t,r,i,n),this.boundingBox=e}return e}drawMove(e){const t=this.curves;0!==t.length&&t[0].drawMove(e)}drawRest(e){const t=this.curves,r=this.closed,i=t.length-(r&&void 0!==e.closePath?1:0);for(let r=0;r<i;r+=1)t[r].drawRest(e);r&&void 0!==e.closePath&&e.closePath()}transformDrawMove(e,t){const r=this.curves;0!==r.length&&r[0].transformDrawMove(e,t)}transformDrawRest(e,t){const r=this.curves,i=this.closed,n=r.length-(i&&void 0!==e.closePath?1:0);for(let i=0;i<n;i+=1)r[i].transformDrawRest(e,t);i&&void 0!==e.closePath&&e.closePath()}writeMove(e){const t=this.curves;return 0!==t.length&&(e=t[0].writeMove(e)),e}writeRest(e){const t=this.curves,r=this.closed,i=t.length-(r?1:0);for(let r=0;r<i;r+=1)e=t[r].writeRest(e);return r&&(e=e.write(90)),e}toPathString(e){let t;if(void 0!==e||(t=this.pathString,void 0===t)){const r=Se.stringOutput(e);this.writePath(r),t=r.bind(),void 0===e&&(this.pathString=t)}return t}equivalentTo(e,t){return this===e||e instanceof Fa&&(x.equivalent(this.curves,e.curves,t)&&this.closed===e.closed)}equals(e){return this===e||e instanceof Fa&&(x.equal(this.curves,e.curves)&&this.closed===e.closed)}debug(e){const t=this.curves,r=t.length;if(e=e.write("R2Spline").write(46),0===r)e=e.write("empty").write(40);else if(0!==r){e=(e=e.write(this.closed?"closed":"open").write(40)).debug(t[0]);for(let i=1;i<r;i+=1)e=e.write(", ").debug(t[i])}return e=e.write(41)}toString(){return Oe.debug(this)}static empty(){return new Fa([],!1)}static open(...e){return new Fa(e,!1)}static closed(...e){return new Fa(e,!0)}static builder(){return new Na}static parse(e){let t=Se.stringInput(e);for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();let r=za.parse(t);if(r.isDone())for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}}class Na{constructor(){this.curves=[],this.closed=!1,this.aliased=!1,this.x0=0,this.y0=0,this.x=0,this.y=0}dealias(){this.aliased&&(this.curves=this.curves.slice(0),this.aliased=!1)}moveTo(e,t){this.aliased?(this.curves=[],this.aliased=!1):this.curves.length=0,this.closed=!1,this.x0=e,this.y0=t,this.x=e,this.y=t}closePath(){this.dealias(),this.curves.push(new Aa(this.x,this.y,this.x0,this.y0)),this.closed=!0,this.x=this.x0,this.y=this.y0}lineTo(e,t){this.dealias(),this.curves.push(new Aa(this.x,this.y,e,t)),this.x=e,this.y=t}quadraticCurveTo(e,t,r,i){this.dealias(),this.curves.push(new Pa(this.x,this.y,e,t,r,i)),this.x=r,this.y=i}bezierCurveTo(e,t,r,i,n,s){this.dealias(),this.curves.push(new Ia(this.x,this.y,e,t,r,i,n,s)),this.x=n,this.y=s}arcTo(e,t,r,i,n){this.dealias();const s=this.x,o=this.y,a=e-s,u=t-o,h=r-e,l=i-t,c=Math.atan2(u,a)-Math.PI/2,d=Math.atan2(l,h)-Math.PI/2,p=d-c,f=Math.cos(c),m=Math.sin(c),y=Math.cos(d),w=Math.sin(d),g=s-f,v=o-m,b=e-f,x=t-m,C=e-y,S=t-w,O=r-y,E=i-w,A=Na.intersection(g,v,b-g,x-v,C,S,O-C,E-S),k=g+A*(b-g),D=v+A*(x-v);this.curves.push(new Va(k,D,n,n,0,c,p)),this.x=r,this.y=i}static intersection(e,t,r,i,n,s,o,a){const u=n-e,h=s-t,l=u*i-h*r,c=r*a-i*o;if(0===l&&0===c){const e=r*r+i*i,t=o*r+a*i,n=(u*r+h*i)/e,s=n+t/e;return(t>=0?0<s&&n<1:0<n&&s<1)?n:NaN}if(0===c)return NaN;{const e=(u*a-h*o)/c,t=l/c;return 0<=e&&e<=1&&0<=t&&t<=1?e:NaN}}arc(e,t,r,i,n,s=!1){this.dealias();let o=n-i;!0===s&&o>0?o-=2*Math.PI:!1===s&&o<0&&(o+=2*Math.PI);const a=new Va(e,t,r,r,0,i,o);this.curves.push(a);const{x:u,y:h}=a.interpolate(1);this.x=u,this.y=h}ellipse(e,t,r,i,n,s,o,a){this.dealias();let u=o-s;!0===a&&u>0?u-=2*Math.PI:!1===a&&u<0&&(u+=2*Math.PI);const h=new Va(e,t,r,i,n,s,u);this.curves.push(h);const{x:l,y:c}=h.interpolate(1);this.x=l,this.y=c}rect(e,t,r,i){this.dealias(),this.curves.push(new Aa(e,t,e+r,t),new Aa(e+r,t,e+r,t+i),new Aa(e+r,t+i,e,t+i),new Aa(e,t+i,e,t)),this.x=e,this.y=t}bind(){return this.aliased=!0,new Fa(this.curves,this.closed)}}class za extends Le{constructor(e,t,r,i,n,s,o,a){super(),this.xParser=e,this.yParser=t,this.x0Parser=r,this.y0Parser=i,this.curveParser=n,this.curves=s,this.command=o,this.step=a}feed(e){return za.parse(e,this.xParser,this.yParser,this.x0Parser,this.y0Parser,this.curveParser,this.curves,this.command,this.step)}static parse(e,t,r,i,n,s,o,a,u=1){let h=0;if(1===u){for(;e.isCont()&&(h=e.head(),Se.isSpace(h));)e=e.step();if(e.isCont()){if(77!==h&&109!==h)return Le.error(Ae.expected("moveto",e));e=e.step(),a=h,u=2}else if(!e.isEmpty())return Le.error(Ae.unexpected(e))}if(2===u){if(void 0===i){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(i=Ee.parseDecimal(e))}else i=i.feed(e);if(void 0!==i)if(i.isDone())109===a&&void 0!==t&&(i=Le.done(t.bind()+i.bind())),t=i,u=3;else if(i.isError())return i.asError()}if(3===u){for(;e.isCont()&&(h=e.head(),Se.isSpace(h));)e=e.step();e.isCont()?(44===h&&(e=e.step()),u=4):e.isEmpty()||(u=4)}if(4===u){if(void 0===n){for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();e.isEmpty()||(n=Ee.parseDecimal(e))}else n=n.feed(e);if(void 0!==n)if(n.isDone())109===a&&void 0!==r&&(n=Le.done(r.bind()+n.bind())),r=n,u=5;else if(n.isError())return n.asError()}for(;;){if(5===u){if(void 0===s){for(;e.isCont()&&(h=e.head(),Se.isSpace(h));)e=e.step();if(e.isCont()){const u=void 0!==o&&0!==o.length?o[o.length-1]:null;switch(h){case 76:case 108:case 72:case 104:case 86:case 118:s=Da.parse(e,t,r),a=h;break;case 81:case 113:s=Ta.parse(e,t,r),a=h;break;case 84:if(u instanceof Pa){const i=u.x2-u.x1,n=u.y2-u.y1,o=t.bind()+i,a=r.bind()+n;s=Ta.parse(e,t,r,Le.done(o),Le.done(a))}else s=Ta.parse(e,t,r,t,r);a=h;break;case 116:if(u instanceof Pa){const i=u.x2-u.x1,n=u.y2-u.y1;s=Ta.parse(e,t,r,Le.done(i),Le.done(n))}else s=Ta.parse(e,t,r,Le.done(0),Le.done(0));a=h;break;case 67:case 99:s=Ma.parse(e,t,r),a=h;break;case 83:if(u instanceof Ia){const i=u.x3-u.x2,n=u.y3-u.y2,o=t.bind()+i,a=r.bind()+n;s=Ma.parse(e,t,r,Le.done(o),Le.done(a))}else s=Ma.parse(e,t,r,t,r);a=h;break;case 115:if(u instanceof Ia){const i=u.x3-u.x2,n=u.y3-u.y2;s=Ma.parse(e,t,r,Le.done(i),Le.done(n))}else s=Ma.parse(e,t,r,Le.done(0),Le.done(0));a=h;break;case 65:case 97:s=qa.parse(e,t,r),a=h;break;case 90:case 122:return e=e.step(),void 0===o&&(o=[]),o.push(new Aa(t.bind(),r.bind(),i.bind(),n.bind())),Le.done(new Fa(o,!0));case 44:e=e.step();case 43:case 45:case 46:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:switch(a){case 77:case 109:case 76:case 108:case 72:case 104:case 86:case 118:s=Da.parseRest(e,a,t,r);break;case 81:case 113:s=Ta.parseRest(e,a,t,r);break;case 84:if(u instanceof Pa){const i=u.x2-u.x1,n=u.y2-u.y1,o=t.bind()+i,h=r.bind()+n;s=Ta.parseRest(e,a,t,r,Le.done(o),Le.done(h))}else s=Ta.parseRest(e,a,t,r,t,r);break;case 116:if(u instanceof Pa){const i=u.x2-u.x1,n=u.y2-u.y1;s=Ta.parseRest(e,a,t,r,Le.done(i),Le.done(n))}else s=Ta.parseRest(e,a,t,r,Le.done(0),Le.done(0));break;case 67:case 99:s=Ma.parseRest(e,a,t,r);break;case 83:if(u instanceof Ia){const i=u.x3-u.x2,n=u.y3-u.y2,o=t.bind()+i,h=r.bind()+n;s=Ma.parseRest(e,a,t,r,Le.done(o),Le.done(h))}else s=Ma.parseRest(e,a,t,r,t,r);break;case 115:if(u instanceof Ia){const i=u.x3-u.x2,n=u.y3-u.y2;s=Ma.parseRest(e,a,t,r,Le.done(i),Le.done(n))}else s=Ma.parseRest(e,a,t,r,Le.done(0),Le.done(0));break;case 65:case 97:s=qa.parseRest(e,a,t,r);break;default:return void 0!==o?Le.done(new Fa(o,!1)):Le.done(Fa.empty())}break;default:return void 0!==o?Le.done(new Fa(o,!1)):Le.done(Fa.empty())}}else if(!e.isEmpty())return void 0!==o?Le.done(new Fa(o,!1)):Le.done(Fa.empty())}else s=s.feed(e);if(void 0!==s){if(s.isDone()){const e=s.bind();s=void 0,void 0===o&&(o=[]),o.push(e),t=Le.done(e.interpolateX(1)),r=Le.done(e.interpolateY(1));continue}if(s.isError())return s.asError()}}break}return new za(t,r,i,n,s,o,a,u)}}class Ua extends ba{constructor(e){super(),this.splines=e,this.boundingBox=null,this.pathString=void 0}isDefined(){return 0!==this.splines.length}get xMin(){return this.bounds.xMin}get yMin(){return this.bounds.yMin}get xMax(){return this.bounds.xMax}get yMax(){return this.bounds.yMax}interpolateX(e){const t=this.splines,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i;return t[n].interpolateX(s)}return NaN}interpolateY(e){const t=this.splines,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i;return t[n].interpolateY(s)}return NaN}interpolate(e){const t=this.splines,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i;return t[n].interpolate(s)}return new xa(NaN,NaN)}contains(e,t){return!1}intersects(e){return!1}split(e){const t=this.splines,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i,[o,a]=t[n].split(s),u=new Array(n+1),h=new Array(r-n);for(let e=0;e<n;e+=1)u[e]=t[e];u[n]=o,h[0]=a;for(let e=n+1;e<r;e+=1)h[e-n]=t[e];return[new Ua(u),new Ua(h)]}return[Ua.empty(),Ua.empty()]}subdivide(e){const t=this.splines,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i,o=new Array(r);for(let e=0;e<n;e+=1)o[e]=t[e];o[n]=t[n].subdivide(s);for(let e=n+1;e<r;e+=1)o[e]=t[e];return new Ua(o)}return Ua.empty()}transform(e){const t=this.splines,r=t.length;if(r>0){const i=new Array(r);for(let n=0;n<r;n+=1)i[n]=t[n].transform(e);return new Ua(i)}return Ua.empty()}get bounds(){let e=this.boundingBox;if(null===e){let t=1/0,r=1/0,i=-1/0,n=-1/0;const s=this.splines;for(let e=0,o=s.length;e<o;e+=1){const o=s[e];t=Math.min(t,o.xMin),r=Math.min(r,o.yMin),i=Math.max(o.xMax,i),n=Math.max(o.yMax,n)}e=new Ba(t,r,i,n),this.boundingBox=e}return e}draw(e){const t=this.splines;for(let r=0,i=t.length;r<i;r+=1)t[r].draw(e)}transformDraw(e,t){const r=this.splines;for(let i=0,n=r.length;i<n;i+=1)r[i].transformDraw(e,t)}writePath(e){const t=this.splines,r=t.length;if(e.settings===ce.standard())for(let i=0;i<r;i+=1)e=e.write(t[i].toPathString());else for(let i=0;i<r;i+=1)e=t[i].writePath(e);return e}toPathString(e){let t;if(void 0!==e||(t=this.pathString,void 0===t)){const r=Se.stringOutput(e);this.writePath(r),t=r.bind(),void 0===e&&(this.pathString=t)}return t}equivalentTo(e,t){return this===e||e instanceof Ua&&x.equivalent(this.splines,e.splines,t)}equals(e){return this===e||e instanceof Ua&&x.equal(this.splines,e.splines)}debug(e){const t=this.splines,r=t.length;if(e=e.write("R2Path").write(46),0===r)e=e.write("empty").write(40);else if(1===r){const r=t[0];e=e.write(r.closed?"closed":"open").write(40);const i=r.curves,n=i.length;if(0!==n){e=e.debug(i[0]);for(let t=1;t<n;t+=1)e=e.write(", ").debug(i[t])}}else{e=(e=e.write("of").write(40)).debug(t[0]);for(let i=1;i<r;i+=1)e=e.write(", ").debug(t[i])}return e=e.write(41)}toAttributeString(){return this.toPathString()}toString(){return Oe.debug(this)}static empty(){return new Ua([])}static of(...e){return new Ua(e)}static open(...e){return new Ua([new Fa(e,!1)])}static closed(...e){return new Ua([new Fa(e,!0)])}static fromAny(e){if(null==e||e instanceof Ua)return e;if("string"==typeof e)return Ua.parse(e);throw new TypeError(""+e)}static builder(){return new Ra}static parse(e){let t=Se.stringInput(e);for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();let r=ja.parse(t);if(r.isDone())for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}}class Ra{constructor(){this.splines=[],this.builder=null}moveTo(e,t){let r=this.builder;if(null!==r){const e=r.bind();e.isDefined()&&this.splines.push(e)}r=new Na,this.builder=r,r.moveTo(e,t)}closePath(){const e=this.builder;if(null===e)throw new Error;e.closePath()}lineTo(e,t){const r=this.builder;if(null===r)throw new Error;r.lineTo(e,t)}quadraticCurveTo(e,t,r,i){const n=this.builder;if(null===n)throw new Error;n.quadraticCurveTo(e,t,r,i)}bezierCurveTo(e,t,r,i,n,s){const o=this.builder;if(null===o)throw new Error;o.bezierCurveTo(e,t,r,i,n,s)}arcTo(e,t,r,i,n){const s=this.builder;if(null===s)throw new Error;s.arcTo(e,t,r,i,n)}arc(e,t,r,i,n,s){const o=this.builder;if(null===o)throw new Error;o.arc(e,t,r,i,n,s)}ellipse(e,t,r,i,n,s,o,a){const u=this.builder;if(null===u)throw new Error;u.ellipse(e,t,r,i,n,s,o,a)}rect(e,t,r,i){const n=this.builder;if(null===n)throw new Error;n.rect(e,t,r,i)}bind(){const e=this.splines.slice(0),t=this.builder;if(null!==t){const r=t.bind();r.isDefined()&&e.push(r)}return new Ua(e)}}class ja extends Le{constructor(e,t,r){super(),this.splineParser=e,this.splines=t,this.step=r}feed(e){return ja.parse(e,this.splineParser,this.splines,this.step)}static parse(e,t,r,i=1){let n=0;for(;;){if(1===i){if(void 0===t){for(;e.isCont()&&(n=e.head(),Se.isSpace(n));)e=e.step();if(e.isCont())switch(n){case 77:t=za.parse(e);break;case 109:{let i,n;if(void 0!==r&&0!==r.length){const e=r[r.length-1];i=Le.done(e.interpolateX(1)),n=Le.done(e.interpolateY(1))}t=za.parse(e,i,n);break}case 110:i=2;break;default:return void 0!==r?Le.done(new Ua(r)):Le.done(Ua.empty())}else if(!e.isEmpty())return void 0!==r?Le.done(new Ua(r)):Le.done(Ua.empty())}else t=t.feed(e);if(void 0!==t){if(t.isDone()){const e=t.bind();t=void 0,e.isDefined()&&(void 0===r&&(r=[]),r.push(e));continue}if(t.isError())return t.asError()}}break}if(i>=2&&i<=5)for(;;){if(e.isCont()){if(e.head()==="none".charCodeAt(i-2)){if(e=e.step(),i<5){i+=1;continue}return Le.done(Ua.empty())}return Le.error(Ae.expected("none",e))}if(!e.isEmpty())return Le.error(Ae.unexpected(e));break}return new ja(t,r,i)}}class La extends ba{constructor(e,t,r){super(),this.cx=e,this.cy=t,this.r=r}isDefined(){return isFinite(this.cx)&&isFinite(this.cy)&&isFinite(this.r)}get xMin(){return this.cx-this.r}get yMin(){return this.cy-this.r}get xMax(){return this.cx+this.r}get yMax(){return this.cy+this.r}contains(e,t){if("number"==typeof e){const r=e-this.cx,i=t-this.cy;return r*r+i*i<=this.r*this.r}return(e=ba.fromAny(e))instanceof xa?this.containsPoint(e):e instanceof Aa?this.containsSegment(e):e instanceof Ba?this.containsBox(e):e instanceof La&&this.containsCircle(e)}containsPoint(e){const t=e.x-this.cx,r=e.y-this.cy;return t*t+r*r<=this.r*this.r}containsSegment(e){const t=e.x0-this.cx,r=e.y0-this.cy,i=e.x1-this.cx,n=e.y1-this.cy,s=this.r*this.r;return t*t+r*r<=s&&i*i+n*n<=s}containsBox(e){const t=e.xMin-this.cx,r=e.yMin-this.cy,i=e.xMax-this.cx,n=e.yMax-this.cy,s=this.r*this.r;return t*t+r*r<=s&&t*t+n*n<=s&&i*i+r*r<=s&&i*i+n*n<=s}containsCircle(e){const t=e.cx-this.cx,r=e.cy-this.cy;return t*t+r*r+e.r*e.r<=this.r*this.r}intersects(e){return(e=ba.fromAny(e))instanceof xa?this.intersectsPoint(e):e instanceof Aa?this.intersectsSegment(e):e instanceof Ba?this.intersectsBox(e):e instanceof La?this.intersectsCircle(e):e.intersects(this)}intersectsPoint(e){const t=e.x-this.cx,r=e.y-this.cy;return t*t+r*r<=this.r*this.r}intersectsSegment(e){const t=this.cx,r=this.cy,i=this.r,n=e.x0,s=e.y0,o=e.x1,a=e.y1,u=o-n,h=a-s,l=Math.sqrt(u*u+h*h),c=u/l,d=h/l,p=(t-n)*d-(r-s)*c;if(p<-i||i<p)return!1;{const e=n-t,u=s-r,h=o-t,l=a-r,p=i*i;if(e*e+u*u<=p||h*h+l*l<=p)return!0;{const e=c*t+d*r,i=c*n+d*s,u=c*o+d*a;return i<e&&e<=u||u<e&&e<=i}}}intersectsBox(e){const t=(this.cx<e.xMin?e.xMin:e.xMax<this.cx?e.xMax:this.cx)-this.cx,r=(this.cy<e.yMin?e.yMin:e.yMax<this.cy?e.yMax:this.cy)-this.cy;return t*t+r*r<=this.r*this.r}intersectsCircle(e){const t=e.cx-this.cx,r=e.cy-this.cy,i=this.r+e.r;return t*t+r*r<=i*i}transform(e){const t=e.transformX(this.cx,this.cy),r=e.transformY(this.cx,this.cy),i=e.transformX(this.cx+this.r,this.cy)-t,n=e.transformY(this.cx+this.r,this.cy)-r,s=Math.sqrt(i*i+n*n);return new La(t,r,s)}toAny(){return{cx:this.cx,cy:this.cy,r:this.r}}interpolateTo(e){return e instanceof La?Wa(this,e):null}equivalentTo(e,t){return this===e||e instanceof La&&(c.equivalent(this.cx,e.cx,t)&&c.equivalent(this.cy,e.cy,t)&&c.equivalent(this.r,e.r,t))}equals(e){return this===e||e instanceof La&&(this.cx===e.cx&&this.cy===e.cy&&this.r===e.r)}hashCode(){return o.mash(o.mix(o.mix(o.mix(m.hash(La),c.hash(this.cx)),c.hash(this.cy)),c.hash(this.r)))}debug(e){return e=e.write("R2Circle").write(46).write("of").write(40).debug(this.cx).write(", ").debug(this.cy).write(", ").debug(this.r).write(41)}toString(){return Oe.debug(this)}static of(e,t,r){return new La(e,t,r)}static fromInit(e){return new La(e.cx,e.cy,e.r)}static fromAny(e){if(null==e||e instanceof La)return e;if(La.isInit(e))return La.fromInit(e);throw new TypeError(""+e)}static isInit(e){if("object"==typeof e&&null!==e){const t=e;return"number"==typeof t.cx&&"number"==typeof t.cy&&"number"==typeof t.r}return!1}static isAny(e){return e instanceof La||La.isInit(e)}}class Ba extends ba{constructor(e,t,r,i){super(),this.xMin=e,this.yMin=t,this.xMax=r,this.yMax=i}isDefined(){return isFinite(this.xMin)&&isFinite(this.yMin)&&isFinite(this.xMax)&&isFinite(this.yMax)}get x(){return this.xMin}get y(){return this.yMin}get width(){return this.xMax-this.xMin}get height(){return this.yMax-this.yMin}get top(){return this.yMin}get right(){return this.xMax}get bottom(){return this.yMax}get left(){return this.xMin}get center(){return new xa((this.xMin+this.xMax)/2,(this.yMin+this.yMax)/2)}contains(e,t){return"number"==typeof e?this.xMin<=e&&e<=this.xMax&&this.yMin<=t&&t<=this.yMax:(e=ba.fromAny(e))instanceof ba&&(e instanceof xa?this.containsPoint(e):e instanceof Aa?this.containsSegment(e):e instanceof Ba?this.containsBox(e):e instanceof La?this.containsCircle(e):this.xMin<=e.xMin&&e.xMax<=this.xMax&&this.yMin<=e.yMin&&e.yMax<=this.yMax)}containsPoint(e){return this.xMin<=e.x&&e.x<=this.xMax&&this.yMin<=e.y&&e.y<=this.yMax}containsSegment(e){return this.xMin<=e.x0&&e.x0<=this.xMax&&this.yMin<=e.y0&&e.y0<=this.yMax&&this.xMin<=e.x1&&e.x1<=this.xMax&&this.yMin<=e.y1&&e.y1<=this.yMax}containsBox(e){return this.xMin<=e.xMin&&e.xMax<=this.xMax&&this.yMin<=e.yMin&&e.yMax<=this.yMax}containsCircle(e){return this.xMin<=e.cx-e.r&&e.cx+e.r<=this.xMax&&this.yMin<=e.cy-e.r&&e.cy+e.r<=this.yMax}intersects(e){return(e=ba.fromAny(e))instanceof xa?this.intersectsPoint(e):e instanceof Aa?this.intersectsSegment(e):e instanceof Ba?this.intersectsBox(e):e instanceof La?this.intersectsCircle(e):e.intersects(this)}intersectsPoint(e){return this.xMin<=e.x&&e.x<=this.xMax&&this.yMin<=e.y&&e.y<=this.yMax}intersectsSegment(e){const t=this.xMin,r=this.yMin,i=this.xMax,n=this.yMax,s=e.x0,o=e.y0,a=e.x1,u=e.y1;return!(s<t&&a<t||s>i&&a>i||o<r&&u<r||o>n&&u>n)&&(s>t&&s<i&&o>r&&o<n||!!(Ba.intersectsSegment(s-t,a-t,s,o,a,u)&&Ba.hitY>r&&Ba.hitY<n||Ba.intersectsSegment(o-r,u-r,s,o,a,u)&&Ba.hitX>t&&Ba.hitX<i||Ba.intersectsSegment(s-i,a-i,s,o,a,u)&&Ba.hitY>r&&Ba.hitY<n||Ba.intersectsSegment(o-n,u-n,s,o,a,u)&&Ba.hitX>t&&Ba.hitX<i))}static intersectsSegment(e,t,r,i,n,s){if(e!==t||e*t<0){const o=-e/(t-e);return Ba.hitX=r+(n-r)*o,Ba.hitY=i+(s-i)*o,!0}return!1}intersectsBox(e){return this.xMin<=e.xMax&&e.xMin<=this.xMax&&this.yMin<=e.yMax&&e.yMin<=this.yMax}intersectsCircle(e){const t=(e.cx<this.xMin?this.xMin:this.xMax<e.cx?this.xMax:e.cx)-e.cx,r=(e.cy<this.yMin?this.yMin:this.yMax<e.cy?this.yMax:e.cy)-e.cy;return t*t+r*r<=e.r*e.r}union(e){return super.union(e)}transform(e){return new Ba(e.transformX(this.xMin,this.yMin),e.transformY(this.xMin,this.yMin),e.transformX(this.xMax,this.yMax),e.transformY(this.xMax,this.yMax))}get bounds(){return this}toAny(){return{xMin:this.xMin,yMin:this.yMin,xMax:this.xMax,yMax:this.yMax}}interpolateTo(e){return e instanceof Ba?Ka(this,e):null}equivalentTo(e,t){return this===e||e instanceof Ba&&(c.equivalent(this.xMin,e.xMin,t)&&c.equivalent(this.yMin,e.yMin,t)&&c.equivalent(this.xMax,e.xMax,t)&&c.equivalent(this.yMax,e.yMax,t))}equals(e){return this===e||e instanceof Ba&&(this.xMin===e.xMin&&this.yMin===e.yMin&&this.xMax===e.xMax&&this.yMax===e.yMax)}hashCode(){return o.mash(o.mix(o.mix(o.mix(o.mix(m.hash(Ba),c.hash(this.xMin)),c.hash(this.yMin)),c.hash(this.xMax)),c.hash(this.yMax)))}debug(e){return e=e.write("R2Box").write(46).write("of").write(40).debug(this.xMin).write(", ").debug(this.yMin).write(", ").debug(this.xMax).write(", ").debug(this.yMax).write(41)}toString(){return Oe.debug(this)}static undefined(){return new Ba(1/0,1/0,-1/0,-1/0)}static of(e,t,r,i){return void 0===r&&(r=e),void 0===i&&(i=t),new Ba(e,t,r,i)}static fromInit(e){return new Ba(e.xMin,e.yMin,e.xMax,e.yMax)}static fromAny(e){if(null==e||e instanceof Ba)return e;if(Ba.isInit(e))return Ba.fromInit(e);throw new TypeError(""+e)}static isInit(e){if("object"==typeof e&&null!==e){const t=e;return"number"==typeof t.xMin&&"number"==typeof t.yMin&&"number"==typeof t.xMax&&"number"==typeof t.yMax}return!1}static isAny(e){return e instanceof Ba||Ba.isInit(e)}}Ba.hitX=0,Ba.hitY=0,i([a],Ba,"undefined",null);const Ka=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=t.xMin+e*(r.xMin-t.xMin),s=t.yMin+e*(r.yMin-t.yMin),o=t.xMax+e*(r.xMax-t.xMax),a=t.yMax+e*(r.yMax-t.yMax);return new Ba(n,s,o,a)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D),Wa=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=t.cx+e*(r.cx-t.cx),s=t.cy+e*(r.cy-t.cy),o=t.r+e*(r.r-t.r);return new La(n,s,o)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class Ha extends ba{constructor(e){super(),this.shapes=e,this.boundingBox=null}isDefined(){return 0!==this.shapes.length}get xMin(){return this.bounds.xMin}get yMin(){return this.bounds.yMin}get xMax(){return this.bounds.xMax}get yMax(){return this.bounds.yMax}contains(e,t){return!1}intersects(e){return!1}transform(e){const t=this.shapes,r=t.length;if(r>0){const i=new Array(r);for(let n=0;n<r;n+=1)i[n]=t[n].transform(e);return new Ha(i)}return Ha.empty()}get bounds(){let e=this.boundingBox;if(null===e){let t=1/0,r=1/0,i=-1/0,n=-1/0;const s=this.shapes;for(let e=0,o=s.length;e<o;e+=1){const o=s[e];t=Math.min(t,o.xMin),r=Math.min(r,o.yMin),i=Math.max(o.xMax,i),n=Math.max(o.yMax,n)}e=new Ba(t,r,i,n),this.boundingBox=e}return e}equivalentTo(e,t){return this===e||e instanceof Ha&&x.equivalent(this.shapes,e.shapes,t)}equals(e){return this===e||e instanceof Ha&&x.equal(this.shapes,e.shapes)}debug(e){const t=this.shapes,r=t.length;if(e=e.write("R2Group").write(46),0===r)e=e.write("empty").write(40);else{e=(e=e.write("of").write(40)).debug(t[0]);for(let i=1;i<r;i+=1)e=e.write(", ").debug(t[i])}return e=e.write(41)}toString(){return Oe.debug(this)}static empty(){return new Ha(x.empty)}static of(...e){return new Ha(e)}}i([a],Ha,"empty",null);class Xa{translate(e,t){return this.transform(Xa.translate(e,t))}translateX(e){return this.transform(Xa.translateX(e))}translateY(e){return this.transform(Xa.translateY(e))}scale(e,t){return this.transform(Xa.scale(e,t))}scaleX(e){return this.transform(Xa.scaleX(e))}scaleY(e){return this.transform(Xa.scaleY(e))}rotate(e){return this.transform(Xa.rotate(e))}skew(e,t){return this.transform(Xa.skew(e,t))}skewX(e){return this.transform(Xa.skewX(e))}skewY(e){return this.transform(Xa.skewY(e))}toMatrix(){return this.toAffine().toMatrix()}toCssTransformComponent(){return null}toCssValue(){if("undefined"!=typeof CSSTransformValue){const e=this.toCssTransformComponent();if(null!==e)return new CSSTransformValue([e])}return null}interpolateTo(e){return e instanceof Xa?hu(this.toAffine(),e.toAffine()):null}toAttributeString(){return this.toString()}static identity(){return new Ya}static translate(e,t){return e=ta.fromAny(e),t=ta.fromAny(t),new Za(e,t)}static translateX(e){return e=ta.fromAny(e),new Za(e,ra.zero())}static translateY(e){return e=ta.fromAny(e),new Za(ra.zero(),e)}static scale(e,t){return new Ja(e,t)}static scaleX(e){return new Ja(e,1)}static scaleY(e){return new Ja(1,e)}static rotate(e){return e=la.fromAny(e,"deg"),new ru(e)}static skew(e,t){return e=la.fromAny(e,"deg"),t=la.fromAny(t,"deg"),new su(e,t)}static skewX(e){return e=la.fromAny(e,"deg"),new su(e,ca.zero())}static skewY(e){return e=la.fromAny(e,"deg"),new su(ca.zero(),e)}static affine(e=1,t=0,r=0,i=1,n=0,s=0){return new uu(e,t,r,i,n,s)}static list(...e){const t=[];for(let r=0;r<e.length;r+=1){const i=Xa.fromAny(e[r]);i instanceof cu?t.push(...i.transforms):i instanceof Ya||t.push(i)}return new cu(t)}static fromCssValue(e){if(e instanceof CSSTransformValue)return Xa.fromCssTransform(e);throw new TypeError(""+e)}static fromCssTransform(e){const t=e.length;if(1===t)return Xa.fromCssTransformComponent(e[0]);{const r=new Array(t);for(let i=0;i<t;i+=1)r[i]=Xa.fromCssTransformComponent(e[i]);return new cu(r)}}static fromCssTransformComponent(e){if(e instanceof CSSTranslate)return Za.fromCssTransformComponent(e);if(e instanceof CSSRotate)return ru.fromCssTransformComponent(e);if(e instanceof CSSScale)return Ja.fromCssTransformComponent(e);if(e instanceof CSSSkew)return su.fromCssTransformComponent(e);if(e instanceof CSSMatrixComponent)return uu.fromCssTransformComponent(e);throw new TypeError(""+e)}static fromAny(e){if(null==e||e instanceof Xa)return e;if("string"==typeof e)return Xa.parse(e);throw new TypeError(""+e)}static fromValue(e){switch(e.tag){case"identity":return Ya.fromValue(e);case"translate":return Za.fromValue(e);case"scale":return Ja.fromValue(e);case"rotate":return ru.fromValue(e);case"skew":return su.fromValue(e);case"matrix":return uu.fromValue(e);default:return cu.fromValue(e)}}static parse(e){let t=Se.stringInput(e);for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();let r=pu.parse(t);if(r.isDone())for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}static form(){return new _a(Xa.identity())}static isAny(e){return e instanceof Xa||"string"==typeof e}}i([a],Xa,"identity",null),i([a],Xa,"form",null);class _a extends Mi{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new _a(e):this}mold(e){return(e=Xa.fromAny(e)).toValue()}cast(e){const t=e.toValue();try{if(t instanceof Cr){const e=Xa.fromValue(t);return null!==e?e:void 0}{const e=t.stringValue(void 0);if(void 0!==e)return Xa.parse(e)}}catch(e){}}}class Ga extends Le{constructor(e){super(),this.identOutput=e}feed(e){return Ga.parse(e,this.identOutput)}static parse(e,t){let r=0;for(t=t||Se.stringOutput();e.isCont()&&(r=e.head(),Se.isAlpha(r)||Se.isDigit(r)||45===r);)e=e.step(),t.write(r);if(!e.isEmpty()){const r=t.bind();switch(r){case"translate3d":case"translateX":case"translateY":case"translate":return $a.parseRest(e,t);case"scaleX":case"scaleY":case"scale":return tu.parseRest(e,t);case"rotate":return nu.parseRest(e,t);case"skewX":case"skewY":case"skew":return au.parseRest(e,t);case"matrix":return lu.parseRest(e,t);case"none":return Le.done(Xa.identity());default:return Le.error(Ae.message("unknown transform function: "+r,e))}}return new Ga(t)}}class Ya extends Xa{transform(e,t){return 1===arguments.length?e:new xa(e,t)}transformX(e,t){return e}transformY(e,t){return t}inverse(){return this}toAffine(){return new uu(1,0,0,1,0,0)}toCssValue(){return new CSSKeywordValue("identity")}toValue(){return Cr.create(1).attr("identity")}interpolateTo(e){return e instanceof Ya?T(this):super.interpolateTo(e)}conformsTo(e){return e instanceof Ya}equivalentTo(e,t){return e instanceof Ya}equals(e){return e instanceof Ya}hashCode(){return m.hash(Ya)}debug(e){return e=e.write("Transform").write(46).write("identity").write(40).write(41)}toString(){return"none"}static fromValue(e){return"identity"===e.tag?Xa.identity():null}}class Za extends Xa{constructor(e,t){super(),this.x=e,this.y=t,this.stringValue=void 0}transform(e,t){return 1===arguments.length?e instanceof Ya?this:e instanceof Za?new Za(this.x.plus(e.x),this.y.plus(e.y)):Xa.list(this,e):new xa(this.x.pxValue()+e,this.y.pxValue()+t)}transformX(e,t){return this.x.pxValue()+e}transformY(e,t){return this.y.pxValue()+t}inverse(){return new Za(this.x.negative(),this.y.negative())}toAffine(){return new uu(1,0,0,1,this.x.pxValue(),this.y.pxValue())}toCssTransformComponent(){if("undefined"!=typeof CSSTranslate){const e=this.x.toCssValue(),t=this.y.toCssValue();return new CSSTranslate(e,t)}return null}toValue(){return Cr.create(1).attr("translate",Cr.create(2).slot("x",this.x.toValue()).slot("y",this.y.toValue()))}interpolateTo(e){return e instanceof Za?Qa(this,e):super.interpolateTo(e)}conformsTo(e){return e instanceof Za}equivalentTo(e,t){return e instanceof Za&&(this.x.equivalentTo(e.x,t)&&this.y.equivalentTo(e.y,t))}equals(e){return e instanceof Za&&(this.x.equals(e.x)&&this.y.equals(e.y))}hashCode(){return o.mash(o.mix(o.mix(m.hash(Za),this.x.hashCode()),this.y.hashCode()))}debug(e){return e=e.write("Transform").write(46).write("translate"),e=(e=this.x.isDefined()&&!this.y.isDefined()?e.write("X").write(40).debug(this.x):!this.x.isDefined()&&this.y.isDefined()?e.write("Y").write(40).debug(this.y):e.write(40).debug(this.x).write(", ").debug(this.y)).write(41)}toString(){let e=this.stringValue;return void 0===e&&(e=this.x.isDefined()&&!this.y.isDefined()?"translate("+this.x+",0)":!this.x.isDefined()&&this.y.isDefined()?"translate(0,"+this.y+")":"translate("+this.x+","+this.y+")",this.stringValue=e),e}toAttributeString(){return this.x.isDefined()&&!this.y.isDefined()?"translate("+this.x.pxValue()+",0)":!this.x.isDefined()&&this.y.isDefined()?"translate(0,"+this.y.pxValue()+")":"translate("+this.x.pxValue()+","+this.y.pxValue()+")"}static fromCssTransformComponent(e){const t="number"==typeof e.x?ta.px(e.x):ta.fromCssValue(e.x),r="number"==typeof e.y?ta.px(e.y):ta.fromCssValue(e.y);return new Za(t,r)}static fromAny(e){if(null==e||e instanceof Za)return e;if("string"==typeof e)return Za.parse(e);throw new TypeError(""+e)}static fromValue(e){const t=e.header("translate");if(t.isDefined()){let e=ta.zero(),r=ta.zero();return t.forEach((function(t,i){const n=t.key.stringValue();void 0!==n?"x"===n?e=t.toValue().cast(ta.form(),e):"y"===n&&(r=t.toValue().cast(ta.form(),r)):t instanceof xr&&(0===i?e=t.cast(ta.form(),e):1===i&&(r=t.cast(ta.form(),r)))}),this),new Za(e,r)}return null}static parse(e){let t=Se.stringInput(e);for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();let r=$a.parse(t);if(r.isDone())for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}}const Qa=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=ta.create(t.x.value+e*(r.x.value-t.x.value),r.x.units),s=ta.create(t.y.value+e*(r.y.value-t.y.value),r.y.units);return new Za(n,s)};return Object.setPrototypeOf(i,t.prototype),i[0]=e.x.units===r.x.units&&e.y.units===r.y.units?e:new Za(e.x.to(r.x.units),e.y.to(r.y.units)),i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class $a extends Le{constructor(e,t,r,i,n){super(),this.identOutput=e,this.xParser=t,this.yParser=r,this.zParser=i,this.step=n}feed(e){return $a.parse(e,this.identOutput,this.xParser,this.yParser,this.zParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s){for(t=t||Se.stringOutput();e.isCont()&&(o=e.head(),Se.isAlpha(o)||Se.isDigit(o)||45===o);)e=e.step(),t.write(o);if(!e.isEmpty()){const r=t.bind();switch(r){case"translate3d":case"translateX":case"translateY":case"translate":s=2;break;default:return Le.error(Ae.message("unknown transform function: "+r,e))}}}if(2===s){for(;e.isCont()&&(o=e.head(),Se.isSpace(o));)e=e.step();if(e.isCont()&&40===o)e.step(),s=3;else if(!e.isEmpty())return Le.error(Ae.expected("(",e))}if(3===s){if(void 0===r){for(;e.isCont()&&Se.isSpace(e.head());)e.step();e.isEmpty()||(r=ha.parse(e,"px"))}else r=r.feed(e);if(void 0!==r)if(r.isDone())s=4;else if(r.isError())return r.asError()}if(4===s){for(;e.isCont()&&Se.isSpace(e.head());)e.step();if(e.isCont())if(o=e.head(),41===o){e.step();const i=t.bind();switch(i){case"translateX":return Le.done(new Za(r.bind(),ra.zero()));case"translateY":return Le.done(new Za(ra.zero(),r.bind()));default:return Le.error(Ae.message("unknown transform function: "+i,e))}}else{if(44!==o)return Le.error(Ae.expected(",",e));e.step(),s=5}else if(e.isDone())return Le.error(Ae.unexpected(e))}if(5===s){if(void 0===i){for(;e.isCont()&&Se.isSpace(e.head());)e.step();e.isEmpty()||(i=ha.parse(e,"px"))}else i=i.feed(e);if(void 0!==i)if(i.isDone())s=6;else if(i.isError())return i.asError()}if(6===s){for(;e.isCont()&&Se.isSpace(e.head());)e.step();if(e.isCont()){if(o=e.head(),41===o){e.step();const n=t.bind();return"translate"===n?Le.done(new Za(r.bind(),i.bind())):Le.error(Ae.message("unknown transform function: "+n,e))}if(44!==o)return Le.error(Ae.expected(",",e));e.step(),s=7}else if(e.isDone())return Le.error(Ae.unexpected(e))}if(7===s){if(void 0===n){for(;e.isCont()&&Se.isSpace(e.head());)e.step();e.isEmpty()||(n=ha.parse(e,"px"))}else n=n.feed(e);if(void 0!==n)if(n.isDone())s=8;else if(n.isError())return n.asError()}if(8===s){for(;e.isCont()&&Se.isSpace(e.head());)e.step();if(e.isCont()&&41===e.head()){e.step();const s=t.bind();return"translate3d"===s&&0===n.bind().value?Le.done(new Za(r.bind(),i.bind())):Le.error(Ae.message("unknown transform function: "+s,e))}if(!e.isEmpty())return Le.error(Ae.expected(")",e))}return new $a(t,r,i,n,s)}static parseRest(e,t){return $a.parse(e,t,void 0,void 0,void 0,2)}}class Ja extends Xa{constructor(e,t){super(),this.x=e,this.y=t,this.stringValue=void 0}transform(e,t){return 1===arguments.length?e instanceof Ya?this:Xa.list(this,e):new xa(this.x*e,this.y*t)}transformX(e,t){return this.x*e}transformY(e,t){return this.y*t}inverse(){return new Ja(1/(this.x||1),1/(this.y||1))}toAffine(){return new uu(this.x,0,0,this.y,0,0)}toCssTransformComponent(){return"undefined"!=typeof CSSTranslate?new CSSScale(this.x,this.y):null}toValue(){return Cr.create(1).attr("scale",Cr.create(2).slot("x",this.x).slot("y",this.y))}interpolateTo(e){return e instanceof Ja?eu(this,e):super.interpolateTo(e)}conformsTo(e){return e instanceof Ja}equivalentTo(e,t){return e instanceof Ja&&(c.equivalent(this.x,e.x,t)&&c.equivalent(this.y,e.y,t))}equals(e){return e instanceof Ja&&(this.x===e.x&&this.y===e.y)}hashCode(){return o.mash(o.mix(o.mix(m.hash(Ja),c.hash(this.x)),c.hash(this.y)))}debug(e){return e=e.write("Transform").write(46).write("scale"),e=(e=0!==this.x&&0===this.y?e.write("X").write(40).debug(this.x):0===this.x&&0!==this.y?e.write("Y").write(40).debug(this.y):e.write(40).debug(this.x).write(", ").debug(this.y)).write(41)}toString(){let e=this.stringValue;return void 0===e&&(e=0!==this.x&&0===this.y?"scaleX("+this.x+")":0===this.x&&0!==this.y?"scaleY("+this.y+")":"scale("+this.x+","+this.y+")",this.stringValue=e),e}static fromCssTransformComponent(e){const t="number"==typeof e.x?e.x:e.x.to("number").value,r="number"==typeof e.y?e.y:e.y.to("number").value;return new Ja(t,r)}static fromAny(e){if(null==e||e instanceof Ja)return e;if("string"==typeof e)return Ja.parse(e);throw new TypeError(""+e)}static fromValue(e){const t=e.header("scale");if(t.isDefined()){let e=0,r=0;return t.forEach((function(t,i){const n=t.key.stringValue();void 0!==n?"x"===n?e=t.toValue().numberValue(e):"y"===n&&(r=t.toValue().numberValue(r)):t instanceof xr&&(0===i?e=t.numberValue(e):1===i&&(r=t.numberValue(r)))}),this),new Ja(e,r)}return null}static parse(e){let t=Se.stringInput(e);for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();let r=tu.parse(t);if(r.isDone())for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}}const eu=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=t.x+e*(r.x-t.x),s=t.y+e*(r.y-t.y);return new Ja(n,s)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=D,t}(D);class tu extends Le{constructor(e,t,r,i){super(),this.identOutput=e,this.xParser=t,this.yParser=r,this.step=i}feed(e){return tu.parse(e,this.identOutput,this.xParser,this.yParser,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n){for(t=t||Se.stringOutput();e.isCont()&&(s=e.head(),Se.isAlpha(s));)e=e.step(),t.write(s);if(!e.isEmpty()){const r=t.bind();switch(r){case"scaleX":case"scaleY":case"scale":n=2;break;default:return Le.error(Ae.message("unknown transform function: "+r,e))}}}if(2===n){for(;e.isCont()&&(s=e.head(),Se.isSpace(s));)e=e.step();if(e.isCont()&&40===s)e.step(),n=3;else if(!e.isEmpty())return Le.error(Ae.expected("(",e))}if(3===n){if(void 0===r){for(;e.isCont()&&Se.isSpace(e.head());)e.step();e.isEmpty()||(r=Ee.parseNumber(e))}else r=r.feed(e);if(void 0!==r)if(r.isDone())n=4;else if(r.isError())return r.asError()}if(4===n){for(;e.isCont()&&Se.isSpace(e.head());)e.step();if(e.isCont())if(s=e.head(),41===s){e.step();const i=t.bind();switch(i){case"scaleX":return Le.done(new Ja(r.bind(),1));case"scaleY":return Le.done(new Ja(1,r.bind()));default:return Le.error(Ae.message("unknown transform function: "+i,e))}}else{if(44!==s)return Le.error(Ae.expected(",",e));e.step(),n=5}else if(e.isDone())return Le.error(Ae.unexpected(e))}if(5===n){if(void 0===i){for(;e.isCont()&&Se.isSpace(e.head());)e.step();e.isEmpty()||(i=Ee.parseNumber(e))}else i=i.feed(e);if(void 0!==i)if(i.isDone())n=6;else if(i.isError())return i.asError()}if(6===n){for(;e.isCont()&&Se.isSpace(e.head());)e.step();if(e.isCont()&&41===e.head()){e.step();const n=t.bind();return"scale"===n?Le.done(new Ja(r.bind(),i.bind())):Le.error(Ae.message("unknown transform function: "+n,e))}if(!e.isEmpty())return Le.error(Ae.expected(")",e))}return new tu(t,r,i,n)}static parseRest(e,t){return tu.parse(e,t,void 0,void 0,2)}}class ru extends Xa{constructor(e){super(),this.angle=e,this.stringValue=void 0}transform(e,t){if(1===arguments.length)return e instanceof Ya?this:Xa.list(this,e);{const r=this.angle.radValue(),i=Math.cos(r),n=Math.sin(r);return new xa(e*i-t*n,e*n+t*i)}}transformX(e,t){const r=this.angle.radValue();return e*Math.cos(r)-t*Math.sin(r)}transformY(e,t){const r=this.angle.radValue();return e*Math.sin(r)+t*Math.cos(r)}inverse(){return new ru(this.angle.negative())}toAffine(){const e=this.angle.radValue();return new uu(Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0)}toCssTransformComponent(){if("undefined"!=typeof CSSTranslate){const e=this.angle.toCssValue();return new CSSRotate(e)}return null}toValue(){return Cr.create(1).attr("rotate",this.angle.toString())}interpolateTo(e){return e instanceof ru?iu(this,e):super.interpolateTo(e)}conformsTo(e){return e instanceof ru}equivalentTo(e,t){return e instanceof ru&&this.angle.equivalentTo(e.angle,t)}equals(e){return e instanceof ru&&this.angle.equals(e.angle)}hashCode(){return o.mash(o.mix(m.hash(ru),this.angle.hashCode()))}debug(e){return e=e.write("Transform").write(46).write("rotate").write(40).debug(this.angle).write(41)}toString(){let e=this.stringValue;return void 0===e&&(e="rotate("+this.angle+")",this.stringValue=e),e}toAttributeString(){return"rotate("+this.angle.degValue()+")"}static fromCssTransformComponent(e){const t=la.fromCssValue(e.angle);return new ru(t)}static fromAny(e){if(null==e||e instanceof ru)return e;if("string"==typeof e)return ru.parse(e);throw new TypeError(""+e)}static fromValue(e){const t=e.header("rotate");if(t.isDefined()){let e=la.zero();return t.forEach((function(t,r){"angle"===t.key.stringValue()?e=t.toValue().cast(la.form(),e):t instanceof xr&&0===r&&(e=t.cast(la.form(),e))}),this),new ru(e)}return null}static parse(e){let t=Se.stringInput(e);for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();let r=nu.parse(t);if(r.isDone())for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}}const iu=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=la.create(t.angle.value+e*(r.angle.value-t.angle.value),r.angle.units);return new ru(n)};return Object.setPrototypeOf(i,t.prototype),i[0]=e.angle.units===r.angle.units?e:new ru(e.angle.to(r.angle.units)),i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class nu extends Le{constructor(e,t,r){super(),this.identOutput=e,this.angleParser=t,this.step=r}feed(e){return nu.parse(e,this.identOutput,this.angleParser,this.step)}static parse(e,t,r,i=1){let n=0;if(1===i){for(t=t||Se.stringOutput();e.isCont()&&(n=e.head(),Se.isAlpha(n));)e=e.step(),t.write(n);if(!e.isEmpty()){const r=t.bind();if("rotate"!==r)return Le.error(Ae.message("unknown transform function: "+r,e));i=2}}if(2===i){for(;e.isCont()&&(n=e.head(),Se.isSpace(n));)e=e.step();if(e.isCont()&&40===n)e.step(),i=3;else if(!e.isEmpty())return Le.error(Ae.expected("(",e))}if(3===i){if(void 0===r){for(;e.isCont()&&Se.isSpace(e.head());)e.step();e.isEmpty()||(r=wa.parse(e,"deg"))}else r=r.feed(e);if(void 0!==r)if(r.isDone())i=4;else if(r.isError())return r.asError()}if(4===i){for(;e.isCont()&&Se.isSpace(e.head());)e.step();if(e.isCont()&&41===e.head()){e.step();const i=t.bind();return"rotate"===i?Le.done(new ru(r.bind())):Le.error(Ae.message("unknown transform function: "+i,e))}if(!e.isEmpty())return Le.error(Ae.expected(")",e))}return new nu(t,r,i)}static parseRest(e,t){return nu.parse(e,t,void 0,2)}}class su extends Xa{constructor(e,t){super(),this.x=e,this.y=t,this.stringValue=void 0}transform(e,t){return 1===arguments.length?e instanceof Ya?this:Xa.list(this,e):new xa(Math.tan(this.x.radValue())*t+e,Math.tan(this.y.radValue())*e+t)}transformX(e,t){return Math.tan(this.x.radValue())*t+e}transformY(e,t){return Math.tan(this.y.radValue())*e+t}inverse(){return new su(this.x.negative(),this.y.negative())}toAffine(){const e=this.x.radValue(),t=this.y.radValue();return new uu(1,Math.tan(t),Math.tan(e),1,0,0)}toCssTransformComponent(){if("undefined"!=typeof CSSTranslate){const e=this.x.toCssValue(),t=this.y.toCssValue();return new CSSSkew(e,t)}return null}toValue(){return Cr.create(1).attr("skew",Cr.create(2).slot("x",this.x.toValue()).slot("y",this.y.toValue()))}interpolateTo(e){return e instanceof su?ou(this,e):super.interpolateTo(e)}conformsTo(e){return e instanceof su}equivalentTo(e,t){return e instanceof su&&(this.x.equivalentTo(e.x,t)&&this.y.equivalentTo(e.y,t))}equals(e){return e instanceof su&&(this.x.equals(e.x)&&this.y.equals(e.y))}hashCode(){return o.mash(o.mix(o.mix(m.hash(su),this.x.hashCode()),this.y.hashCode()))}debug(e){return e=e.write("Transform").write(46).write("skew"),e=(e=this.x.isDefined()&&!this.y.isDefined()?e.write("X").write(40).debug(this.x):!this.x.isDefined()&&this.y.isDefined()?e.write("Y").write(40).debug(this.y):e.write(40).debug(this.x).write(", ").debug(this.y)).write(41)}toString(){let e=this.stringValue;return void 0===e&&(e=this.x.isDefined()&&!this.y.isDefined()?"skewX("+this.x+")":!this.x.isDefined()&&this.y.isDefined()?"skewY("+this.y+")":"skew("+this.x+","+this.y+")",this.stringValue=e),e}toAttributeString(){return this.x.isDefined()&&!this.y.isDefined()?"skewX("+this.x.degValue()+")":!this.x.isDefined()&&this.y.isDefined()?"skewY("+this.y.degValue()+")":"skew("+this.x.degValue()+","+this.y.degValue()+")"}static fromCssTransformComponent(e){const t="number"==typeof e.ax?la.rad(e.ax):la.fromCssValue(e.ax),r="number"==typeof e.ay?la.rad(e.ay):la.fromCssValue(e.ay);return new su(t,r)}static fromAny(e){if(null==e||e instanceof su)return e;if("string"==typeof e)return su.parse(e);throw new TypeError(""+e)}static fromValue(e){const t=e.header("skew");if(t.isDefined()){let e=la.zero(),r=la.zero();return t.forEach((function(t,i){const n=t.key.stringValue();void 0!==n?"x"===n?e=t.toValue().cast(la.form(),e):"y"===n&&(r=t.toValue().cast(la.form(),r)):t instanceof xr&&(0===i?e=t.cast(la.form(),e):1===i&&(r=t.cast(la.form(),r)))}),this),new su(e,r)}return null}static parse(e){let t=Se.stringInput(e);for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();let r=au.parse(t);if(r.isDone())for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}}const ou=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=la.create(t.x.value+e*(r.x.value-t.x.value),r.x.units),s=la.create(t.y.value+e*(r.y.value-t.y.value),r.y.units);return new su(n,s)};return Object.setPrototypeOf(i,t.prototype),i[0]=e.x.units===r.x.units&&e.y.units===r.y.units?e:new su(e.x.to(r.x.units),e.y.to(r.y.units)),i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class au extends Le{constructor(e,t,r,i){super(),this.identOutput=e,this.xParser=t,this.yParser=r,this.step=i}feed(e){return au.parse(e,this.identOutput,this.xParser,this.yParser,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n){for(t=t||Se.stringOutput();e.isCont()&&(s=e.head(),Se.isAlpha(s));)e=e.step(),t.write(s);if(!e.isEmpty()){const r=t.bind();switch(r){case"skewX":case"skewY":case"skew":n=2;break;default:return Le.error(Ae.message("unknown transform function: "+r,e))}}}if(2===n){for(;e.isCont()&&(s=e.head(),Se.isSpace(s));)e=e.step();if(e.isCont()&&40===s)e.step(),n=3;else if(!e.isEmpty())return Le.error(Ae.expected("(",e))}if(3===n){if(void 0===r){for(;e.isCont()&&Se.isSpace(e.head());)e.step();e.isEmpty()||(r=wa.parse(e,"deg"))}else r=r.feed(e);if(void 0!==r)if(r.isDone())n=4;else if(r.isError())return r.asError()}if(4===n){for(;e.isCont()&&Se.isSpace(e.head());)e.step();if(e.isCont())if(s=e.head(),41===s){e.step();const i=t.bind();switch(i){case"skewX":return Le.done(new su(r.bind(),ca.zero()));case"skewY":return Le.done(new su(ca.zero(),r.bind()));default:return Le.error(Ae.message("unknown transform function: "+i,e))}}else{if(44!==s)return Le.error(Ae.expected(",",e));e.step(),n=5}else if(e.isDone())return Le.error(Ae.unexpected(e))}if(5===n){if(void 0===i){for(;e.isCont()&&Se.isSpace(e.head());)e.step();e.isEmpty()||(i=wa.parse(e,"deg"))}else i=i.feed(e);if(void 0!==i)if(i.isDone())n=6;else if(i.isError())return i.asError()}if(6===n){for(;e.isCont()&&Se.isSpace(e.head());)e.step();if(e.isCont()&&41===e.head()){e.step();const n=t.bind();return"skew"===n?Le.done(new su(r.bind(),i.bind())):Le.error(Ae.message("unknown transform function: "+n,e))}if(!e.isEmpty())return Le.error(Ae.expected(")",e))}return new au(t,r,i,n)}static parseRest(e,t){return au.parse(e,t,void 0,void 0,2)}}class uu extends Xa{constructor(e,t,r,i,n,s){super(),this.x0=e,this.y0=t,this.x1=r,this.y1=i,this.tx=n,this.ty=s,this.stringValue=void 0}transform(e,t){return 1===arguments.length?e instanceof Ya?this:this.multiply(e.toAffine()):new xa(this.x0*e+this.x1*t+this.tx,this.y0*e+this.y1*t+this.ty)}transformX(e,t){return this.x0*e+this.x1*t+this.tx}transformY(e,t){return this.y0*e+this.y1*t+this.ty}inverse(){const e=this.x0,t=this.y0,r=this.x1,i=this.y1,n=this.tx,s=this.ty,o=e*i-r*t;if(Math.abs(o)>=Number.MIN_VALUE)return new uu(i/o,-t/o,-r/o,e/o,(r*s-i*n)/o,(t*n-e*s)/o);throw new Error("non-invertible affine transform with determinant "+o)}multiply(e){const t=this.x0*e.x0+this.x1*e.y0,r=this.y0*e.x0+this.y1*e.y0,i=this.x0*e.x1+this.x1*e.y1,n=this.y0*e.x1+this.y1*e.y1,s=this.x0*e.tx+this.x1*e.ty,o=this.y0*e.tx+this.y1*e.ty;return new uu(t,r,i,n,s,o)}toAffine(){return this}toMatrix(){return new DOMMatrix([this.x0,this.y0,this.x1,this.y1,this.tx,this.ty])}toCssTransformComponent(){return"undefined"!=typeof CSSTranslate?new CSSMatrixComponent(this.toMatrix()):null}toValue(){return Cr.create(1).attr("matrix",Cr.create(6).item(this.x0).item(this.y0).item(this.x1).item(this.y1).item(this.tx).item(this.ty))}interpolateTo(e){return e instanceof uu?hu(this,e):super.interpolateTo(e)}conformsTo(e){return e instanceof uu}equivalentTo(e,t){return e instanceof uu&&(c.equivalent(this.x0,e.x0,t)&&c.equivalent(this.y0,e.y0,t)&&c.equivalent(this.x1,e.x1,t)&&c.equivalent(this.y1,e.y1,t)&&c.equivalent(this.tx,e.tx,t)&&c.equivalent(this.ty,e.ty,t))}equals(e){return e instanceof uu&&(this.x0===e.x0&&this.y0===e.y0&&this.x1===e.x1&&this.y1===e.y1&&this.tx===e.tx&&this.ty===e.ty)}hashCode(){return o.mash(o.mix(o.mix(o.mix(o.mix(o.mix(o.mix(m.hash(uu),c.hash(this.x0)),c.hash(this.y0)),c.hash(this.x1)),c.hash(this.y1)),c.hash(this.tx)),c.hash(this.ty)))}debug(e){return e=e.write("Transform").write(46).write("affine").write(40).debug(this.x0).write(", ").debug(this.y0).write(", ").debug(this.x1).write(", ").debug(this.y1).write(", ").debug(this.tx).write(", ").debug(this.ty).write(41)}toString(){let e=this.stringValue;return void 0===e&&(e="matrix("+this.x0+","+this.y0+","+this.x1+","+this.y1+","+this.tx+","+this.ty+")",this.stringValue=e),e}static identity(){return new uu(1,0,0,1,0,0)}static fromAny(e){if(null==e||e instanceof uu)return e;if("string"==typeof e)return uu.parse(e);throw new TypeError(""+e)}static fromMatrix(e){return new uu(e.a,e.b,e.c,e.d,e.e,e.f)}static fromCssTransformComponent(e){return uu.fromMatrix(e.matrix)}static fromValue(e){const t=e.header("matrix");if(t.isDefined()){let e=0,r=0,i=0,n=0,s=0,o=0;return t.forEach((function(t,a){const u=t.key.stringValue();if(void 0!==u)"x0"===u?e=t.toValue().numberValue(e):"y0"===u?r=t.toValue().numberValue(r):"x1"===u?i=t.toValue().numberValue(i):"y1"===u?n=t.toValue().numberValue(n):"tx"===u?s=t.toValue().numberValue(s):"ty"===u&&(o=t.toValue().numberValue(o));else if(t instanceof xr)switch(a){case 0:e=t.numberValue(e);break;case 1:r=t.numberValue(r);break;case 2:i=t.numberValue(i);break;case 3:n=t.numberValue(n);break;case 4:s=t.numberValue(s);break;case 5:o=t.numberValue(o)}}),this),new uu(e,r,i,n,s,o)}return null}static parse(e){let t=Se.stringInput(e);for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();let r=lu.parse(t);if(r.isDone())for(;t.isCont()&&Se.isWhitespace(t.head());)t=t.step();return t.isCont()&&!r.isError()&&(r=Le.error(Ae.unexpected(t))),r.bind()}}i([a],uu,"identity",null);const hu=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=t.x0+e*(r.x0-t.x0),s=t.y0+e*(r.y0-t.y0),o=t.x1+e*(r.x1-t.x1),a=t.y1+e*(r.y1-t.y1),u=t.tx+e*(r.tx-t.tx),h=t.ty+e*(r.ty-t.ty);return new uu(n,s,o,a,u,h)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class lu extends Le{constructor(e,t,r,i){super(),this.identOutput=e,this.entries=t,this.entryParser=r,this.step=i}feed(e){return lu.parse(e,this.identOutput,this.entries,this.entryParser,this.step)}static parse(e,t,r=[],i,n=1){let s=0;if(1===n){for(t=t||Se.stringOutput();e.isCont()&&(s=e.head(),Se.isAlpha(s));)e=e.step(),t.write(s);if(!e.isEmpty()){const r=t.bind();if("matrix"!==r)return Le.error(Ae.message("unknown transform function: "+r,e));n=2}}if(2===n){for(;e.isCont()&&(s=e.head(),Se.isSpace(s));)e=e.step();if(e.isCont()&&40===s)e.step(),n=3;else if(!e.isEmpty())return Le.error(Ae.expected("(",e))}for(;;){if(3===n){if(void 0===i){for(;e.isCont()&&Se.isSpace(e.head());)e.step();e.isEmpty()||(i=Ee.parseNumber(e))}else i=i.feed(e);if(void 0!==i)if(i.isDone())r.push(i.bind()),i=void 0,n=4;else if(i.isError())return i.asError()}if(4===n){for(;e.isCont()&&Se.isSpace(e.head());)e.step();if(e.isCont()){if(s=e.head(),41===s){e.step();const i=t.bind();return"matrix"===i?Le.done(Xa.affine(...r)):Le.error(Ae.message("unknown transform function: "+i,e))}if(r.length>=6)return Le.error(Ae.expected(")",e));if(44===s){e.step(),n=3;continue}return Le.error(Ae.expected(",",e))}if(e.isDone())return Le.error(Ae.unexpected(e))}break}return new lu(t,r,i,n)}static parseRest(e,t){return lu.parse(e,t,void 0,void 0,2)}}class cu extends Xa{constructor(e){super(),this.transforms=e,this.stringValue=void 0}transform(e,t){if(1===arguments.length)return e instanceof Ya?this:Xa.list(this,e);{const r=this.transforms;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=n.transformX(e,t),o=n.transformY(e,t);e=s,t=o}return new xa(e,t)}}transformX(e,t){const r=this.transforms;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=n.transformX(e,t),o=n.transformY(e,t);e=s,t=o}return e}transformY(e,t){const r=this.transforms;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=n.transformX(e,t),o=n.transformY(e,t);e=s,t=o}return t}inverse(){const e=this.transforms,t=e.length,r=new Array(t);for(let i=0;i<t;i+=1)r[i]=e[t-i-1].inverse();return new cu(r)}toAffine(){let e=uu.identity();const t=this.transforms;for(let r=0,i=t.length;r<i;r+=1)e=e.multiply(t[r].toAffine());return e}toCssTransformComponent(){return"undefined"!=typeof CSSTranslate?new CSSMatrixComponent(this.toMatrix()):null}toCssValue(){if("undefined"!=typeof CSSTransformValue){const e=this.transforms,t=e.length,r=new Array(t);for(let t=0,i=e.length;t<i;t+=1){const i=e[t].toCssTransformComponent();if(null===i)return null;r[t]=i}return new CSSTransformValue(r)}return null}toValue(){const e=this.transforms,t=e.length,r=Cr.create(t);for(let i=0;i<t;i+=1)r.push(e[i].toValue());return r}interpolateTo(e){return e instanceof cu?du(this,e):super.interpolateTo(e)}conformsTo(e){if(e instanceof cu){const t=this.transforms.length;if(t===e.transforms.length){for(let r=0;r<t;r+=1)if(!this.transforms[r].conformsTo(e.transforms[r]))return!1;return!0}}return!1}equivalentTo(e,t){if(e instanceof cu){const r=this.transforms.length;if(r===e.transforms.length){for(let i=0;i<r;i+=1)if(!this.transforms[i].equivalentTo(e.transforms[i],t))return!1;return!0}}return!1}equals(e){if(e instanceof cu){const t=this.transforms.length;if(t===e.transforms.length){for(let r=0;r<t;r+=1)if(!this.transforms[r].equals(e.transforms[r]))return!1;return!0}}return!1}hashCode(){let e=m.hash(cu);const t=this.transforms;for(let r=0,i=t.length;r<i;r+=1)e=o.mix(e,t[r].hashCode());return o.mash(e)}debug(e){e=e.write("Transform").write(46).write("list").write(40);const t=this.transforms,r=t.length;if(r>0){e=e.debug(t[0]);for(let i=1;i<r;i+=1)e=e.write(", ").debug(t[i])}return e=e.write(41)}toString(){let e=this.stringValue;if(void 0===e){const t=this.transforms,r=t.length;if(r>0){e=t[0].toString();for(let i=1;i<r;i+=1)e+=" ",e+=t[i].toString()}else e="none";this.stringValue=e}return e}toAttributeString(){const e=this.transforms,t=e.length;if(t>0){let r=e[0].toAttributeString();for(let i=1;i<t;i+=1)r+=" ",r+=e[i].toAttributeString();return r}return""}static fromAny(e){if(null==e||e instanceof cu)return e;if("string"==typeof e)return cu.parse(e);throw new TypeError(""+e)}static fromValue(e){const t=[];return e.forEach((function(e){const r=Xa.fromValue(e.toValue());null!==r&&t.push(r)}),this),0!==t.length?new cu(t):null}static parse(e){const t=Xa.parse(e);return t instanceof cu?t:new cu([t])}}const du=function(e){const t=function(e,r){const i=function(e){const t=i.interpolators,r=t.length,n=new Array(r);for(let i=0;i<r;i+=1)n[i]=t[i](e);return new cu(n)};Object.setPrototypeOf(i,t.prototype);const n=e.transforms,s=r.transforms,o=Math.min(n.length,s.length),a=new Array(o);for(let e=0;e<o;e+=1)a[e]=n[e].interpolateTo(s[e]);return i.interpolators=a,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.interpolators,t=e.length,r=new Array(t);for(let i=0;i<t;i+=1)r[i]=e[i][0];return new cu(r)},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.interpolators,t=e.length,r=new Array(t);for(let i=0;i<t;i+=1)r[i]=e[i][1];return new cu(r)},configurable:!0}),t.prototype.equals=function(e){if(this===e)return!0;if(e instanceof t){const t=this.interpolators.length;if(t===e.interpolators.length){for(let r=0;r<t;r+=1)if(!this.interpolators[r].equals(e.interpolators[r]))return!1;return!0}}return!1},t}(D);class pu extends Le{constructor(e,t){super(),this.transform=e,this.transformParser=t}feed(e){return pu.parse(e,this.transform,this.transformParser)}static parse(e,t=Xa.identity(),r){for(;;){if(void 0===r){for(;e.isCont()&&Se.isSpace(e.head());)e.step();if(e.isCont())r=Ga.parse(e);else if(e.isDone())return Le.done(t)}if(void 0!==r){if((r=r.feed(e)).isDone()){t=t.transform(r.bind()),r=void 0;continue}if(r.isError())return r.asError()}break}return new pu(t,r)}}const fu=function(){const e={is:function(e){if(null!=e){const t=e;return"function"==typeof t.project&&"function"==typeof t.unproject}return!1}};return e}();class mu{union(e){return e=mu.fromAny(e),new Eu(Math.min(this.lngMin,e.lngMin),Math.min(this.latMin,e.latMin),Math.max(this.lngMax,e.lngMax),Math.max(this.latMax,e.latMax))}get bounds(){return new Eu(this.lngMin,this.latMin,this.lngMax,this.latMax)}static fromAny(e){if(null==e||e instanceof mu)return e;if(yu.isInit(e))return yu.fromInit(e);if(yu.isTuple(e))return yu.fromTuple(e);if(vu.isInit(e))return vu.fromInit(e);if(Au.isInit(e))return Au.fromInit(e);if(Au.isTuple(e))return Au.fromTuple(e);if(Eu.isInit(e))return Eu.fromInit(e);throw new TypeError(""+e)}static isAny(e){return e instanceof mu||yu.isInit(e)||yu.isTuple(e)||vu.isInit(e)||Au.isInit(e)||Eu.isInit(e)}}class yu extends mu{constructor(e,t){super(),this.lng=e,this.lat=t}isDefined(){return isFinite(this.lng)&&isFinite(this.lat)}get lngMin(){return this.lng}get latMin(){return this.lat}get lngMax(){return this.lng}get latMax(){return this.lat}contains(e,t){return"number"==typeof e?this.lng===e&&this.lat===t:(e=mu.fromAny(e))instanceof yu?this.lng===e.lng&&this.lat===e.lat:e instanceof mu&&(this.lng<=e.lngMin&&e.lngMax<=this.lng&&this.lat<=e.latMin&&e.latMax<=this.lat)}intersects(e){return(e=mu.fromAny(e)).intersects(this)}project(e){return e.project(this)}normalized(){const e=this.lng,t=this.lat,r=yu.normalizeLng(e),i=yu.normalizeLat(t);return e===r&&t===i?this:new yu(r,i)}toAny(){return{lng:this.lng,lat:this.lat}}interpolateTo(e){return e instanceof yu?wu(this,e):null}equivalentTo(e,t){return this===e||e instanceof yu&&(c.equivalent(this.lng,e.lng,t)&&c.equivalent(this.lat,e.lat,t))}equals(e){return this===e||e instanceof yu&&(this.lng===e.lng&&this.lat===e.lat)}hashCode(){return o.mash(o.mix(o.mix(m.hash(yu),c.hash(this.lng)),c.hash(this.lat)))}debug(e){return e=e.write("GeoPoint").write(46).write("of").write(40).debug(this.lng).write(", ").debug(this.lat).write(41)}toString(){return Oe.debug(this)}static origin(){return new yu(0,0)}static undefined(){return new yu(NaN,NaN)}static of(e,t){return new yu(e,t)}static fromInit(e){return new yu(e.lng,e.lat)}static fromTuple(e){return new yu(e[0],e[1])}static fromAny(e){if(null==e||e instanceof yu)return e;if(yu.isInit(e))return yu.fromInit(e);if(yu.isTuple(e))return yu.fromTuple(e);throw new TypeError(""+e)}static normalized(e,t){return e=yu.normalizeLng(e),t=yu.normalizeLat(t),new yu(e,t)}static normalizeLng(e){return e<-180?e=180-(180-e)%360:e>180&&(e=(e-180)%360-180),e}static normalizeLat(e){return e=Math.min(Math.max(-90+l.Epsilon,e),90-l.Epsilon)}static isInit(e){if("object"==typeof e&&null!==e){const t=e;return"number"==typeof t.lng&&"number"==typeof t.lat}return!1}static isTuple(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}static isAny(e){return e instanceof yu||yu.isInit(e)||yu.isTuple(e)}}i([a],yu,"origin",null),i([a],yu,"undefined",null);const wu=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=t.lng,n=t.lat,s=i[1],o=s.lng,a=s.lat;let u;if(r>0&&o<0&&r-o>180){const t=180-r,i=180+o,n=t/(t+i);if(e<n)u=r+e/n*t;else{u=(e-n)/(1-n)*i-180}}else if(r<0&&o>0&&o-r>180){const t=180+r,i=180-o,n=t/(t+i);if(e<n)u=r-e/n*t;else{u=180-(e-n)/(1-n)*i}}else u=r+e*(o-r);return new yu(u,n+e*(a-n))};return Object.setPrototypeOf(i,t.prototype),i[0]=e.normalized(),i[1]=r.normalized(),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class gu extends mu{}class vu extends gu{constructor(e,t,r,i){super(),this.lng0=e,this.lat0=t,this.lng1=r,this.lat1=i}isDefined(){return isFinite(this.lng0)&&isFinite(this.lat0)&&isFinite(this.lng1)&&isFinite(this.lat1)}get lngMin(){return Math.min(this.lng0,this.lng1)}get latMin(){return Math.min(this.lat0,this.lat1)}get lngMax(){return Math.max(this.lng0,this.lng1)}get latMax(){return Math.max(this.lat0,this.lat1)}interpolateLng(e){return(1-e)*this.lng0+e*this.lng1}interpolateLat(e){return(1-e)*this.lat0+e*this.lat1}interpolate(e){const t=1-e,r=t*this.lng0+e*this.lng1,i=t*this.lat0+e*this.lat1;return new yu(r,i)}contains(e,t){return"number"==typeof e?Aa.contains(this.lng0,this.lat0,this.lng1,this.lat1,e,t):(e=mu.fromAny(e))instanceof yu?this.containsPoint(e):e instanceof vu&&this.containsSegment(e)}containsPoint(e){return Aa.contains(this.lng0,this.lat0,this.lng1,this.lat1,e.lng,e.lat)}containsSegment(e){return Aa.contains(this.lng0,this.lat0,this.lng1,this.lat1,e.lng0,e.lat0)&&Aa.contains(this.lng0,this.lat0,this.lng1,this.lat1,e.lng1,e.lat1)}intersects(e){return(e=mu.fromAny(e))instanceof yu?this.intersectsPoint(e):e instanceof vu?this.intersectsSegment(e):e.intersects(this)}intersectsPoint(e){return Aa.contains(this.lng0,this.lat0,this.lng1,this.lat1,e.lng,e.lat)}intersectsSegment(e){return Aa.intersects(this.lng0,this.lat0,this.lng1-this.lat0,this.lng1-this.lat0,e.lng0,e.lat0,e.lng1-e.lat0,e.lng1-e.lat0)}split(e){const t=1-e,r=t*this.lng0+e*this.lng1,i=t*this.lat0+e*this.lat1;return[new vu(this.lng0,this.lat0,r,i),new vu(r,i,this.lng1,this.lat1)]}project(e){const t=e.project(this.lng0,this.lat0),r=e.project(this.lng1,this.lat1);return new Aa(t.x,t.y,r.x,r.y)}forEachCoord(e,t){let r;return r=e.call(t,this.lng0,this.lat0),void 0!==r?r:(r=e.call(t,this.lng1,this.lat1),void 0!==r?r:void 0)}forEachCoordRest(e,t){const r=e.call(t,this.lng1,this.lat1);if(void 0!==r)return r}toAny(){return{lng0:this.lng0,lat0:this.lat0,lng1:this.lng1,lat1:this.lat1}}interpolateTo(e){return e instanceof vu?bu(this,e):null}equivalentTo(e,t){return this===e||e instanceof vu&&(c.equivalent(this.lng0,e.lng0,t)&&c.equivalent(this.lat0,e.lat0,t)&&c.equivalent(this.lng1,e.lng1,t)&&c.equivalent(this.lat1,e.lat1,t))}equals(e){return this===e||e instanceof vu&&(this.lng0===e.lng0&&this.lat0===e.lat0&&this.lng1===e.lng1&&this.lat1===e.lat1)}hashCode(){return o.mash(o.mix(o.mix(o.mix(o.mix(m.hash(vu),c.hash(this.lng0)),c.hash(this.lat0)),c.hash(this.lng1)),c.hash(this.lat1)))}debug(e){return e=e.write("GeoSegment").write(46).write("of").write(40).debug(this.lng0).write(", ").debug(this.lat0).write(", ").debug(this.lng1).write(", ").debug(this.lat1).write(41)}toString(){return Oe.debug(this)}static of(e,t,r,i){return new vu(e,t,r,i)}static fromInit(e){return new vu(e.lng0,e.lat0,e.lng1,e.lat1)}static fromAny(e){if(null==e||e instanceof vu)return e;if(vu.isInit(e))return vu.fromInit(e);throw new TypeError(""+e)}static isInit(e){if("object"==typeof e&&null!==e){const t=e;return"number"==typeof t.lng0&&"number"==typeof t.lat0&&"number"==typeof t.lng1&&"number"==typeof t.lat1}return!1}static isAny(e){return e instanceof vu||vu.isInit(e)}}const bu=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=t.lng0+e*(r.lng0-t.lng0),s=t.lat0+e*(r.lat0-t.lat0),o=t.lng1+e*(r.lng1-t.lng1),a=t.lat1+e*(r.lat1-t.lat1);return new vu(n,s,o,a)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class xu extends gu{constructor(e,t){super(),this.curves=e,this.closed=t,this.boundingBox=null}isDefined(){return 0!==this.curves.length}isClosed(){return this.closed}get lngMin(){return this.bounds.lngMin}get latMin(){return this.bounds.latMin}get lngMax(){return this.bounds.lngMax}get latMax(){return this.bounds.latMax}interpolateLng(e){const t=this.curves,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i;return t[n].interpolateLng(s)}return NaN}interpolateLat(e){const t=this.curves,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i;return t[n].interpolateLat(s)}return NaN}interpolate(e){const t=this.curves,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i;return t[n].interpolate(s)}return new yu(NaN,NaN)}contains(e,t){return!1}intersects(e){return!1}split(e){const t=this.curves,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i,[o,a]=t[n].split(s),u=new Array(n+1),h=new Array(r-n);for(let e=0;e<n;e+=1)u[e]=t[e];u[n]=o,h[0]=a;for(let e=n+1;e<r;e+=1)h[e-n]=t[e];return[new xu(u,!1),new xu(h,!1)]}return[xu.empty(),xu.empty()]}subdivide(e){const t=this.curves,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i,[o,a]=t[n].split(s),u=new Array(r+1);for(let e=0;e<n;e+=1)u[e]=t[e];u[n]=o,u[n+1]=a;for(let e=n+1;e<r;e+=1)u[e+1]=t[e];return new xu(u,this.closed)}return xu.empty()}project(e){const t=this.curves,r=t.length;if(r>0){let i=0;const n=new Array(r);let s=t[0];if(s instanceof vu){let o=e.project(s.lng0,s.lat0);for(;i<r&&(s=t[i],s instanceof vu);){const t=e.project(s.lng1,s.lat1);n[i]=new Aa(o.x,o.y,t.x,t.y),o=t,i+=1}}for(;i<r;)s=t[i],n[i]=s.project(e),i+=1;return new Fa(n,this.closed)}return Fa.empty()}get bounds(){let e=this.boundingBox;if(null===e){let t=1/0,r=1/0,i=-1/0,n=-1/0;const s=this.curves;for(let e=0,o=s.length;e<o;e+=1){const o=s[e];t=Math.min(t,o.lngMin),r=Math.min(r,o.latMin),i=Math.max(o.lngMax,i),n=Math.max(o.latMax,n)}e=new Eu(t,r,i,n),this.boundingBox=e}return e}forEachCoord(e,t){const r=this.curves,i=r.length;if(i>0){let n=r[0],s=n.forEachCoord(e,t);if(void 0!==s)return s;for(let o=1;o<i;o+=1)if(n=r[o],s=n.forEachCoordRest(e,t),void 0!==s)return s}}forEachCoordRest(e,t){const r=this.curves;for(let i=0,n=r.length;i<n;i+=1){const n=r[i].forEachCoordRest(e,t);if(void 0!==n)return n}}equivalentTo(e,t){return this===e||e instanceof xu&&(x.equivalent(this.curves,e.curves,t)&&this.closed===e.closed)}equals(e){return this===e||e instanceof xu&&(x.equal(this.curves,e.curves)&&this.closed===e.closed)}debug(e){const t=this.curves,r=t.length;if(e=e.write("GeoSpline").write(46),0===r)e=e.write("empty").write(40);else if(0!==r){e=(e=e.write(this.closed?"closed":"open").write(40)).debug(t[0]);for(let i=1;i<r;i+=1)e=e.write(", ").debug(t[i])}return e=e.write(41)}toString(){return Oe.debug(this)}static empty(){return new xu([],!1)}static open(...e){return new xu(e,!1)}static closed(...e){return new xu(e,!0)}static fromPoints(e){const t=e.length;if(t>1){const r=new Array(t-1),i=yu.fromAny(e[0]);let n=i;for(let i=1;i<t;i+=1){const t=yu.fromAny(e[i]);r[i-1]=new vu(n.lng,n.lat,t.lng,t.lat),n=t}const s=i.equals(n);return new xu(r,s)}return xu.empty()}static fromAny(e){return null==e||e instanceof xu?e:xu.isPoints(e)?xu.fromPoints(e):mu.fromAny(e)}static builder(){return new Cu}static isPoints(e){return Array.isArray(e)&&e.length>=2&&yu.isAny(e[0])}static isAnySpline(e){return e instanceof xu||xu.isPoints(e)}}class Cu{constructor(){this.curves=[],this.closed=!1,this.aliased=!1,this.lng0=0,this.lat0=0,this.lng=0,this.lat=0}dealias(){this.aliased&&(this.curves=this.curves.slice(0),this.aliased=!1)}moveTo(e,t){this.aliased?(this.curves=[],this.aliased=!1):this.curves.length=0,this.closed=!1,this.lng0=e,this.lat0=t,this.lng=e,this.lat=t}closePath(){this.dealias(),this.curves.push(new vu(this.lng,this.lat,this.lng0,this.lat0)),this.closed=!0,this.lng=this.lng0,this.lat=this.lat0}lineTo(e,t){this.dealias(),this.curves.push(new vu(this.lng,this.lat,e,t)),this.lng=e,this.lat=t}bind(){return this.aliased=!0,new xu(this.curves,this.closed)}}class Su extends mu{constructor(e){super(),this.splines=e,this.boundingBox=null}isDefined(){return 0!==this.splines.length}get lngMin(){return this.bounds.lngMin}get latMin(){return this.bounds.latMin}get lngMax(){return this.bounds.lngMax}get latMax(){return this.bounds.latMax}interpolateLng(e){const t=this.splines,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i;return t[n].interpolateLng(s)}return NaN}interpolateLat(e){const t=this.splines,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i;return t[n].interpolateLat(s)}return NaN}interpolate(e){const t=this.splines,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i;return t[n].interpolate(s)}return new yu(NaN,NaN)}contains(e,t){return!1}intersects(e){return!1}split(e){const t=this.splines,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i,[o,a]=t[n].split(s),u=new Array(n+1),h=new Array(r-n);for(let e=0;e<n;e+=1)u[e]=t[e];u[n]=o,h[0]=a;for(let e=n+1;e<r;e+=1)h[e-n]=t[e];return[new Su(u),new Su(h)]}return[Su.empty(),Su.empty()]}subdivide(e){const t=this.splines,r=t.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(e/i)),r),s=e*r-n*i,o=new Array(r);for(let e=0;e<n;e+=1)o[e]=t[e];o[n]=t[n].subdivide(s);for(let e=n+1;e<r;e+=1)o[e]=t[e];return new Su(o)}return Su.empty()}project(e){const t=this.splines,r=t.length;if(r>0){const i=new Array(r);for(let n=0;n<r;n+=1)i[n]=t[n].project(e);return new Ua(i)}return Ua.empty()}get bounds(){let e=this.boundingBox;if(null===e){let t=1/0,r=1/0,i=-1/0,n=-1/0;const s=this.splines;for(let e=0,o=s.length;e<o;e+=1){const o=s[e];t=Math.min(t,o.lngMin),r=Math.min(r,o.latMin),i=Math.max(o.lngMax,i),n=Math.max(o.latMax,n)}e=new Eu(t,r,i,n),this.boundingBox=e}return e}centroid(){let e=0,t=0,r=0;return this.forEachCoord((function(i,n){e+=i,t+=n,r+=1}),this),0!==r?new yu(e/r,t/r):yu.undefined()}forEachCoord(e,t){const r=this.splines;for(let i=0,n=r.length;i<n;i+=1){const n=r[i].forEachCoord(e,t);if(void 0!==n)return n}}equivalentTo(e,t){return this===e||e instanceof Su&&x.equivalent(this.splines,e.splines,t)}equals(e){return this===e||e instanceof Su&&x.equal(this.splines,e.splines)}debug(e){const t=this.splines,r=t.length;if(e=e.write("GeoPath").write(46),0===r)e=e.write("empty").write(40);else if(1===r){const r=t[0];e=e.write(r.closed?"closed":"open").write(40);const i=r.curves,n=i.length;if(0!==n){e=e.debug(i[0]);for(let t=1;t<n;t+=1)e=e.write(", ").debug(i[t])}}else{e=(e=e.write("of").write(40)).debug(t[0]);for(let i=1;i<r;i+=1)e=e.write(", ").debug(t[i])}return e=e.write(41)}toString(){return Oe.debug(this)}static empty(){return new Su([])}static of(...e){return new Su(e)}static open(...e){return new Su([new xu(e,!1)])}static closed(...e){return new Su([new xu(e,!0)])}static fromPoints(e){return new Su([xu.fromPoints(e)])}static fromSplines(e){const t=e.length,r=new Array(t);for(let i=0;i<t;i+=1)r[i]=xu.fromAny(e[i]);return new Su(r)}static fromAny(e){return null==e||e instanceof Su?e:Su.isSplines(e)?Su.fromSplines(e):xu.isAnySpline(e)?Su.of(xu.fromAny(e)):mu.fromAny(e)}static builder(){return new Ou}static isSplines(e){return Array.isArray(e)&&e.length>0&&xu.isAnySpline(e[0])}static isAnyPath(e){return e instanceof Su||Su.isSplines(e)}}class Ou{constructor(){this.splines=[],this.builder=null}moveTo(e,t){let r=this.builder;if(null!==r){const e=r.bind();e.isDefined()&&this.splines.push(e)}r=new Cu,this.builder=r,r.moveTo(e,t)}closePath(){const e=this.builder;if(null===e)throw new Error;e.closePath()}lineTo(e,t){const r=this.builder;if(null===r)throw new Error;r.lineTo(e,t)}bind(){const e=this.splines.slice(0),t=this.builder;if(null!==t){const r=t.bind();r.isDefined()&&e.push(r)}return new Su(e)}}class Eu extends mu{constructor(e,t,r,i){super(),this.lngMin=e,this.latMin=t,this.lngMax=r,this.latMax=i}isDefined(){return isFinite(this.lngMin)&&isFinite(this.latMin)&&isFinite(this.lngMax)&&isFinite(this.latMax)}get west(){return this.lngMin}get south(){return this.latMin}get east(){return this.lngMax}get north(){return this.latMax}get southWest(){return new yu(this.lngMin,this.latMin)}get northWest(){return new yu(this.lngMin,this.latMax)}get southEast(){return new yu(this.lngMax,this.latMin)}get northEast(){return new yu(this.lngMax,this.latMax)}get center(){return new yu((this.lngMin+this.lngMax)/2,(this.latMin+this.latMax)/2)}contains(e,t){if("number"==typeof e)return this.lngMin<=e&&e<=this.lngMax&&this.latMin<=t&&t<=this.latMax;if(yu.isAny(e))return this.containsPoint(yu.fromAny(e));if(vu.isAny(e))return this.containsSegment(vu.fromAny(e));if(Au.isAny(e))return this.containsTile(Au.fromAny(e));if(Eu.isAny(e))return this.containsBox(Eu.fromAny(e));throw new TypeError(""+e)}containsPoint(e){return this.lngMin<=e.lng&&e.lng<=this.lngMax&&this.latMin<=e.lat&&e.lat<=this.latMax}containsSegment(e){return this.lngMin<=e.lng0&&e.lng0<=this.lngMax&&this.latMin<=e.lat0&&e.lat0<=this.latMax&&this.lngMin<=e.lng1&&e.lng1<=this.lngMax&&this.latMin<=e.lat1&&e.lat1<=this.latMax}containsTile(e){return this.lngMin<=e.lngMin&&e.lngMax<=this.lngMax&&this.latMin<=e.latMin&&e.latMax<=this.latMax}containsBox(e){return this.lngMin<=e.lngMin&&e.lngMax<=this.lngMax&&this.latMin<=e.latMin&&e.latMax<=this.latMax}intersects(e){if(yu.isAny(e))return this.intersectsPoint(yu.fromAny(e));if(vu.isAny(e))return this.intersectsSegment(vu.fromAny(e));if(Au.isAny(e))return this.intersectsTile(Au.fromAny(e));if(Eu.isAny(e))return this.intersectsBox(Eu.fromAny(e));throw new TypeError(""+e)}intersectsPoint(e){return this.lngMin<=e.lng&&e.lng<=this.lngMax&&this.latMin<=e.lat&&e.lat<=this.latMax}intersectsSegment(e){const t=this.lngMin,r=this.latMin,i=this.lngMax,n=this.latMax,s=e.lng0,o=e.lat0,a=e.lng1,u=e.lat1;return!(s<t&&a<t||s>i&&a>i||o<r&&u<r||o>n&&u>n)&&(s>t&&s<i&&o>r&&o<n||!!(Ba.intersectsSegment(s-t,a-t,s,o,a,u)&&Ba.hitY>r&&Ba.hitY<n||Ba.intersectsSegment(o-r,u-r,s,o,a,u)&&Ba.hitX>t&&Ba.hitX<i||Ba.intersectsSegment(s-i,a-i,s,o,a,u)&&Ba.hitY>r&&Ba.hitY<n||Ba.intersectsSegment(o-n,u-n,s,o,a,u)&&Ba.hitX>t&&Ba.hitX<i))}intersectsTile(e){return this.lngMin<=e.lngMax&&e.lngMin<=this.lngMax&&this.latMin<=e.latMax&&e.latMin<=this.latMax}intersectsBox(e){return this.lngMin<=e.lngMax&&e.lngMin<=this.lngMax&&this.latMin<=e.latMax&&e.latMin<=this.latMax}union(e){return super.union(e)}project(e){const t=e.project(this.lngMin,this.latMin),r=e.project(this.lngMax,this.latMax);let i=t.x,n=t.y,s=r.x,o=r.y;if(i>s){const e=i;i=s,s=e}if(n>o){const e=n;n=o,o=e}return isFinite(i)||(i=-1/0),isFinite(n)||(n=-1/0),isFinite(s)||(s=1/0),isFinite(o)||(o=1/0),new Ba(i,n,s,o)}get bounds(){return this}toAny(){return{lngMin:this.lngMin,latMin:this.latMin,lngMax:this.lngMax,latMax:this.latMax}}interpolateTo(e){return e instanceof Eu?ku(this,e):null}equivalentTo(e,t){return this===e||e instanceof Eu&&(c.equivalent(this.lngMin,e.lngMin,t)&&c.equivalent(this.latMin,e.latMin,t)&&c.equivalent(this.lngMax,e.lngMax,t)&&c.equivalent(this.latMax,e.latMax,t))}equals(e){return this===e||e instanceof Eu&&(this.lngMin===e.lngMin&&this.latMin===e.latMin&&this.lngMax===e.lngMax&&this.latMax===e.latMax)}hashCode(){return o.mash(o.mix(o.mix(o.mix(o.mix(m.hash(Eu),c.hash(this.lngMin)),c.hash(this.latMin)),c.hash(this.lngMax)),c.hash(this.latMax)))}debug(e){return e=e.write("GeoBox").write(46).write("of").write(40).debug(this.lngMin).write(", ").debug(this.latMin).write(", ").debug(this.lngMax).write(", ").debug(this.latMax).write(41)}toString(){return Oe.debug(this)}static undefined(){return new Eu(1/0,1/0,-1/0,-1/0)}static globe(){return new Eu(-180,-90,180,90)}static of(e,t,r,i){return void 0===r&&(r=e),void 0===i&&(i=t),new Eu(e,t,r,i)}static fromInit(e){return new Eu(e.lngMin,e.latMin,e.lngMax,e.latMax)}static fromAny(e){if(null==e||e instanceof Eu)return e;if(Eu.isInit(e))return Eu.fromInit(e);throw new TypeError(""+e)}static isInit(e){if("object"==typeof e&&null!==e){const t=e;return"number"==typeof t.lngMin&&"number"==typeof t.latMin&&"number"==typeof t.lngMax&&"number"==typeof t.latMax}return!1}static isAny(e){return e instanceof Eu||Eu.isInit(e)}}i([a],Eu,"undefined",null),i([a],Eu,"globe",null);class Au extends mu{constructor(e,t,r){super(),this.x=e,this.y=t,this.z=r}get lngMin(){return Au.unprojectX(this.x/(1<<this.z))}get latMin(){return Au.unprojectY(this.y/(1<<this.z))}get lngMax(){return Au.unprojectX((this.x+1)/(1<<this.z))}get latMax(){return Au.unprojectY((this.y+1)/(1<<this.z))}get west(){return this.lngMin}get south(){return this.latMin}get east(){return this.lngMax}get north(){return this.latMax}get southWest(){return new yu(this.lngMin,this.latMin)}get northWest(){return new yu(this.lngMin,this.latMax)}get southEast(){return new yu(this.lngMax,this.latMin)}get northEast(){return new yu(this.lngMax,this.latMax)}get center(){return new yu((this.lngMin+this.lngMax)/2,(this.latMin+this.latMax)/2)}get southWestTile(){return new Au(2*this.x,2*this.y,this.z+1)}get northWestTile(){return new Au(2*this.x,2*this.y+1,this.z+1)}get southEastTile(){return new Au(2*this.x+1,2*this.y,this.z+1)}get northEastTile(){return new Au(2*this.x+1,2*this.y+1,this.z+1)}get parentTile(){return new Au(this.x>>1,this.y>>1,this.z-1)}contains(e,t){if("number"==typeof e)return this.lngMin<=e&&e<=this.lngMax&&this.latMin<=t&&t<=this.latMax;if(yu.isAny(e))return this.containsPoint(yu.fromAny(e));if(vu.isAny(e))return this.containsSegment(vu.fromAny(e));if(Au.isAny(e))return this.containsTile(Au.fromAny(e));if(Eu.isAny(e))return this.containsBox(Eu.fromAny(e));throw new TypeError(""+e)}containsPoint(e){return this.lngMin<=e.lng&&e.lng<=this.lngMax&&this.latMin<=e.lat&&e.lat<=this.latMax}containsSegment(e){return this.lngMin<=e.lng0&&e.lng0<=this.lngMax&&this.latMin<=e.lat0&&e.lat0<=this.latMax&&this.lngMin<=e.lng1&&e.lng1<=this.lngMax&&this.latMin<=e.lat1&&e.lat1<=this.latMax}containsTile(e){return this.lngMin<=e.lngMin&&e.lngMax<=this.lngMax&&this.latMin<=e.latMin&&e.latMax<=this.latMax}containsBox(e){return this.lngMin<=e.lngMin&&e.lngMax<=this.lngMax&&this.latMin<=e.latMin&&e.latMax<=this.latMax}intersects(e){if(yu.isAny(e))return this.intersectsPoint(yu.fromAny(e));if(vu.isAny(e))return this.intersectsSegment(vu.fromAny(e));if(Au.isAny(e))return this.intersectsTile(Au.fromAny(e));if(Eu.isAny(e))return this.intersectsBox(Eu.fromAny(e));throw new TypeError(""+e)}intersectsPoint(e){return this.lngMin<=e.lng&&e.lng<=this.lngMax&&this.latMin<=e.lat&&e.lat<=this.latMax}intersectsSegment(e){const t=this.lngMin,r=this.latMin,i=this.lngMax,n=this.latMax,s=e.lng0,o=e.lat0,a=e.lng1,u=e.lat1;return!(s<t&&a<t||s>i&&a>i||o<r&&u<r||o>n&&u>n)&&(s>t&&s<i&&o>r&&o<n||!!(Ba.intersectsSegment(s-t,a-t,s,o,a,u)&&Ba.hitY>r&&Ba.hitY<n||Ba.intersectsSegment(o-r,u-r,s,o,a,u)&&Ba.hitX>t&&Ba.hitX<i||Ba.intersectsSegment(s-i,a-i,s,o,a,u)&&Ba.hitY>r&&Ba.hitY<n||Ba.intersectsSegment(o-n,u-n,s,o,a,u)&&Ba.hitX>t&&Ba.hitX<i))}intersectsTile(e){return this.lngMin<=e.lngMax&&e.lngMin<=this.lngMax&&this.latMin<=e.latMax&&e.latMin<=this.latMax}intersectsBox(e){return this.lngMin<=e.lngMax&&e.lngMin<=this.lngMax&&this.latMin<=e.latMax&&e.latMin<=this.latMax}project(e){const t=e.project(this.lngMin,this.latMin),r=e.project(this.lngMax,this.latMax);let i=t.x,n=t.y,s=r.x,o=r.y;if(i>s){const e=i;i=s,s=e}if(n>o){const e=n;n=o,o=e}return isFinite(i)||(i=-1/0),isFinite(n)||(n=-1/0),isFinite(s)||(s=1/0),isFinite(o)||(o=1/0),new Ba(i,n,s,o)}toAny(){return{x:this.x,y:this.y,z:this.z}}equivalentTo(e,t){return this===e||e instanceof Au&&(c.equivalent(this.x,e.x,t)&&c.equivalent(this.y,e.y,t)&&c.equivalent(this.z,e.z,t))}equals(e){return this===e||e instanceof Au&&(this.x===e.x&&this.y===e.y&&this.z===e.z)}hashCode(){return o.mash(o.mix(o.mix(o.mix(m.hash(Au),c.hash(this.x)),c.hash(this.y)),c.hash(this.z)))}debug(e){return e=e.write("GeoTile").write(46).write("of").write(40).debug(this.x).write(", ").debug(this.y).write(", ").debug(this.z).write(41)}toString(){return Oe.debug(this)}static root(){return new Au(0,0,0)}static of(e,t,r){return new Au(e,t,r)}static fromInit(e){return new Au(e.x,e.y,e.z)}static fromTuple(e){return new Au(e[0],e[1],e[2])}static fromAny(e){if(null==e||e instanceof Au)return e;if(Au.isInit(e))return Au.fromInit(e);if(Au.isTuple(e))return Au.fromTuple(e);throw new TypeError(""+e)}static isInit(e){if("object"==typeof e&&null!==e){const t=e;return"number"==typeof t.x&&"number"==typeof t.y&&"number"==typeof t.z}return!1}static isTuple(e){return Array.isArray(e)&&3===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&"number"==typeof e[2]}static isAny(e){return e instanceof Au||Au.isInit(e)||Au.isTuple(e)}static unprojectX(e){return(e*Math.PI*2-Math.PI)*(180/Math.PI)}static unprojectY(e){return(2*Math.atan(Math.exp(e*Math.PI*2-Math.PI))-Math.PI/2)*(180/Math.PI)}}i([a],Au,"root",null);const ku=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=t.lngMin+e*(r.lngMin-t.lngMin),s=t.latMin+e*(r.latMin-t.latMin),o=t.lngMax+e*(r.lngMax-t.lngMax),a=t.latMax+e*(r.latMax-t.latMax);return new Eu(n,s,o,a)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class Du extends mu{constructor(e){super(),this.shapes=e,this.boundingBox=null}isDefined(){return 0!==this.shapes.length}get lngMin(){return this.bounds.lngMin}get latMin(){return this.bounds.latMin}get lngMax(){return this.bounds.lngMax}get latMax(){return this.bounds.latMax}contains(e,t){return!1}intersects(e){return!1}project(e){const t=this.shapes,r=t.length;if(r>0){const i=new Array(r);for(let n=0;n<r;n+=1)i[n]=t[n].project(e);return new Ha(i)}return Ha.empty()}get bounds(){let e=this.boundingBox;if(null===e){let t=1/0,r=1/0,i=-1/0,n=-1/0;const s=this.shapes;for(let e=0,o=s.length;e<o;e+=1){const o=s[e];t=Math.min(t,o.lngMin),r=Math.min(r,o.latMin),i=Math.max(o.lngMax,i),n=Math.max(o.latMax,n)}e=new Eu(t,r,i,n),this.boundingBox=e}return e}equivalentTo(e,t){return this===e||e instanceof Du&&x.equivalent(this.shapes,e.shapes,t)}equals(e){return this===e||e instanceof Du&&x.equal(this.shapes,e.shapes)}debug(e){const t=this.shapes,r=t.length;if(e=e.write("GeoGroup").write(46),0===r)e=e.write("empty").write(40);else{e=(e=e.write("of").write(40)).debug(t[0]);for(let i=1;i<r;i+=1)e=e.write(", ").debug(t[i])}return e=e.write(41)}toString(){return Oe.debug(this)}static empty(){return new Du(x.empty)}static of(...e){return new Du(e)}}i([a],Du,"empty",null);const Pu=function(){const e={is:function(e){return Tu.is(e)||Uu.is(e)||Ru.is(e)},toShape:function(e){return"Feature"===e.type?Uu.toShape(e):"FeatureCollection"===e.type?Ru.toShapes(e):Tu.toShape(e)}};return e}(),Tu=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return("Point"===t.type||"MultiPoint"===t.type||"LineString"===t.type||"MultiLineString"===t.type||"Polygon"===t.type||"MultiPolygon"===t.type)&&Array.isArray(t.coordinates)||"GeometryCollection"===t.type&&Array.isArray(t.geometries)}return!1},toShape:function(e){if("Point"===e.type)return Iu.toShape(e);if("MultiPoint"===e.type)return Mu.toShape(e);if("LineString"===e.type)return Vu.toShape(e);if("MultiLineString"===e.type)return qu.toShape(e);if("Polygon"===e.type)return Fu.toShape(e);if("MultiPolygon"===e.type)return Nu.toShape(e);if("GeometryCollection"===e.type)return zu.toShape(e);throw new TypeError(""+e)}};return e}(),Iu=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return"Point"===t.type&&Array.isArray(t.coordinates)}return!1},toShape:function(e){const t=e.coordinates;return new yu(t[0],t[1])}};return e}(),Mu=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return"MultiPoint"===t.type&&Array.isArray(t.coordinates)}return!1},toShape:function(e){const t=e.coordinates,r=t.length,i=new Array(r);for(let e=0;e<r;e+=1){const r=t[e];i[e]=new yu(r[0],r[1])}return new Du(i)}};return e}(),Vu=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return"LineString"===t.type&&Array.isArray(t.coordinates)}return!1},toShape:function(e){const t=e.coordinates,r=t.length;if(r>0){const e=new Array(r-1);let i=t[0],n=i[0],s=i[1];for(let o=1;o<r;o+=1)i=t[o],e[o-1]=new vu(n,s,(n=i[0],n),(s=i[1],s));return new xu(e,!1)}return xu.empty()}};return e}(),qu=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return"MultiLineString"===t.type&&Array.isArray(t.coordinates)}return!1},toShape:function(e){const t=e.coordinates,r=t.length,i=new Array(r);for(let e=0;e<r;e+=1){const r=t[e],n=r.length;if(n>0){const t=new Array(n-1);let s=r[0],o=s[0],a=s[1];for(let e=1;e<n;e+=1)s=r[e],t[e-1]=new vu(o,a,(o=s[0],o),(a=s[1],a));i[e]=new xu(t,!1)}else i[e]=xu.empty()}return new Du(i)}};return e}(),Fu=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return"Polygon"===t.type&&Array.isArray(t.coordinates)}return!1},toShape:function(e){const t=e.coordinates,r=t.length,i=new Array(r);for(let e=0;e<r;e+=1){const r=t[e],n=r.length;if(n>0){const t=new Array(n-1);let s=r[0],o=s[0],a=s[1];for(let e=1;e<n;e+=1)s=r[e],t[e-1]=new vu(o,a,(o=s[0],o),(a=s[1],a));i[e]=new xu(t,!0)}else i[e]=xu.empty()}return new Su(i)}};return e}(),Nu=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return"MultiPolygon"===t.type&&Array.isArray(t.coordinates)}return!1},toShape:function(e){const t=e.coordinates,r=t.length,i=new Array(r);for(let e=0;e<r;e+=1){const r=t[e],n=r.length,s=new Array(n);for(let e=0;e<n;e+=1){const t=r[e],i=t.length;if(i>0){const r=new Array(i-1);let n=t[0],o=n[0],a=n[1];for(let e=1;e<i;e+=1)n=t[e],r[e-1]=new vu(o,a,(o=n[0],o),(a=n[1],a));s[e]=new xu(r,!0)}else s[e]=xu.empty()}i[e]=new Su(s)}return new Du(i)}};return e}(),zu=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return"GeometryCollection"===t.type&&Array.isArray(t.geometries)}return!1},toShape:function(e){const t=e.geometries,r=t.length,i=new Array(r);for(let e=0;e<r;e+=1)i[e]=Tu.toShape(t[e]);return new Du(i)}};return e}(),Uu=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return"Feature"===t.type&&Tu.is(t.geometry)&&"object"==typeof t.properties}return!1},toShape:function(e){const t=e.geometry;return null!==t?Tu.toShape(t):null}};return e}(),Ru=function(){const e={is:function(e){if("object"==typeof e&&null!==e){const t=e;return"FeatureCollection"===t.type&&Array.isArray(t.features)}return!1},toShapes:function(e){const t=e.features,r=t.length,i=new Array(r);for(let e=0;e<r;e+=1)i[e]=Uu.toShape(t[e]);return i}};return e}();class ju{constructor(e,t){this.name=e,this.offset=t}isUTC(){return 0===this.offset}isLocal(){return this.offset===-(new Date).getTimezoneOffset()}equals(e){return this===e||e instanceof ju&&this.offset===e.offset}hashCode(){return o.mash(o.mix(m.hash(ju),c.hash(this.offset)))}debug(e){return e=e.write("TimeZone").write(46),e=(e="UTC"===this.name&&0===this.offset?e.write("utc").write(40):void 0===this.name?e.write("forOffset").write(40).debug(this.offset):e.write("create").write(40).debug(this.name).write(", ").debug(this.offset)).write(41)}toString(){return Oe.debug(this)}static get utc(){return new ju("UTC",0)}static get local(){return ju.forOffset(-(new Date).getTimezoneOffset())}static create(e,t){return"UTC"===e&&0===t?ju.utc:new ju(e,t)}static forName(e){return"UTC"===e?ju.utc:null}static forOffset(e){return 0===e?ju.utc:new ju(void 0,e)}static fromAny(e){if(null==e||e instanceof ju)return e;if("string"==typeof e){const t=ju.forName(e);if(null!==t)return t}else if("number"==typeof e)return ju.forOffset(e);throw new TypeError(""+e)}static fromValue(e){const t=e.stringValue(void 0);if(void 0!==t)return ju.forName(t);const r=e.numberValue(void 0);return void 0!==r?ju.forOffset(r):null}static isAny(e){return e instanceof ju||"string"==typeof e||"number"==typeof e}static form(){return new Lu(ju.utc)}}i([a],ju,"utc",null),i([a],ju,"local",null),i([a],ju,"form",null);class Lu extends Mi{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new Lu(e):this}mold(e){const t=(e=ju.fromAny(e)).name;return void 0!==t?Tr.from(t):Mr.from(e.offset)}cast(e){const t=e.toValue(),r=ju.fromValue(t);return null!==r?r:void 0}}class Bu{constructor(e,t=ju.utc){this.time=e,this.zone=t}isDefined(){return isFinite(new Date(this.time).getTime())}get year(){return this.toUTCLocalDate().getUTCFullYear()}withYear(e,t,r,i,n,s,o){const a=this.toUTCLocalDate();return a.setUTCFullYear(e),void 0!==t&&a.setUTCMonth(t),void 0!==r&&a.setUTCDate(r),void 0!==i&&a.setUTCHours(i),void 0!==n&&a.setUTCMinutes(n),void 0!==s&&a.setUTCSeconds(s),void 0!==o&&a.setUTCMilliseconds(o),Bu.fromUTCLocalDate(a,this.zone)}get month(){return this.toUTCLocalDate().getUTCMonth()}withMonth(e,t,r,i,n,s){const o=this.toUTCLocalDate();return o.setUTCMonth(e),void 0!==t&&o.setUTCDate(t),void 0!==r&&o.setUTCHours(r),void 0!==i&&o.setUTCMinutes(i),void 0!==n&&o.setUTCSeconds(n),void 0!==s&&o.setUTCMilliseconds(s),Bu.fromUTCLocalDate(o,this.zone)}get day(){return this.toUTCLocalDate().getUTCDate()}withDay(e,t,r,i,n){const s=this.toUTCLocalDate();return s.setUTCDate(e),void 0!==t&&s.setUTCHours(t),void 0!==r&&s.setUTCMinutes(r),void 0!==i&&s.setUTCSeconds(i),void 0!==n&&s.setUTCMilliseconds(n),Bu.fromUTCLocalDate(s,this.zone)}get hour(){return this.toUTCLocalDate().getUTCHours()}withHour(e,t,r,i){const n=this.toUTCLocalDate();return n.setUTCHours(e),void 0!==t&&n.setUTCMinutes(t),void 0!==r&&n.setUTCSeconds(r),void 0!==i&&n.setUTCMilliseconds(i),Bu.fromUTCLocalDate(n,this.zone)}get minute(){return this.toUTCLocalDate().getUTCMinutes()}withMinute(e,t,r){const i=this.toUTCLocalDate();return i.setUTCMinutes(e),void 0!==t&&i.setUTCSeconds(t),void 0!==r&&i.setUTCMilliseconds(r),Bu.fromUTCLocalDate(i,this.zone)}get second(){return this.toUTCLocalDate().getUTCSeconds()}withSecond(e,t){const r=this.toUTCLocalDate();return r.setUTCSeconds(e),void 0!==t&&r.setUTCMilliseconds(t),Bu.fromUTCLocalDate(r,this.zone)}get millisecond(){return this.toUTCLocalDate().getUTCMilliseconds()}withMillisecond(e){const t=this.toUTCLocalDate();return t.setUTCMilliseconds(e),Bu.fromUTCLocalDate(t,this.zone)}get weekday(){return this.toUTCLocalDate().getUTCDay()}toUTCLocalDate(){return new Date(this.time+6e4*this.zone.offset)}toDate(){return new Date(this.time)}valueOf(){return this.time}interpolateTo(e){return e instanceof Bu?Ku(this,e):null}compareTo(e){if(e instanceof Bu){const t=this.time,r=e.time;return t<r?-1:t>r?1:t===r?0:NaN}return NaN}equivalentTo(e,t){return this===e||e instanceof Bu&&c.equivalent(this.time,e.time,t)}equals(e){return this===e||e instanceof Bu&&(this.time===e.time&&this.zone.equals(e.zone))}hashCode(){return o.mash(o.mix(o.mix(m.hash(Bu),c.hash(this.time)),this.zone.hashCode()))}display(e,t=Gu.iso8601){return e=t.writeDate(e,this)}toString(e=Gu.iso8601){return e.format(this)}static current(e){return e=void 0!==e?ju.fromAny(e):ju.local,new Bu(Date.now(),e)}static fromUTCLocalDate(e,t){return new Bu(e.getTime()-6e4*t.offset,t)}static fromInit(e,t){let r=Date.UTC(void 0!==e.year?e.year:1970,void 0!==e.month?e.month:0,void 0!==e.day?e.day:1,void 0!==e.hour?e.hour:0,void 0!==e.minute?e.minute:0,void 0!==e.second?e.second:0,void 0!==e.millisecond?e.millisecond:0);return void 0!==e.zone&&(t=ju.fromAny(e.zone)),void 0!==t?r+=6e4*(t=ju.fromAny(t)).offset:t=ju.utc,new Bu(r,t)}static fromAny(e,t){if(null==e||e instanceof Bu)return e;if(e instanceof Date)return t=void 0!==t?ju.fromAny(t):ju.utc,new Bu(e.getTime(),t);if("number"==typeof e)return t=void 0!==t?ju.fromAny(t):ju.utc,new Bu(e,t);if("string"==typeof e)return Bu.parse(e,t);if(Bu.isInit(e))return Bu.fromInit(e,t);throw new TypeError(""+e)}static fromValue(e){let t;const r=e.header("date");r.isDefined()?(e=r,t=!0):t=!1;const i={};return e.forEach((function(e,r){const n=e.key.stringValue(void 0);void 0!==n?"year"===n?i.year=e.toValue().numberValue(i.year):"month"===n?i.month=e.toValue().numberValue(i.month):"day"===n?i.day=e.toValue().numberValue(i.day):"hour"===n?i.hour=e.toValue().numberValue(i.hour):"minute"===n?i.minute=e.toValue().numberValue(i.minute):"second"===n?i.second=e.toValue().numberValue(i.second):"millisecond"===n?i.millisecond=e.toValue().numberValue(i.millisecond):"zone"===n&&(i.zone=e.toValue().cast(ju.form(),i.zone)):e instanceof xr&&t&&(0===r?i.year=e.numberValue(i.year):1===r?i.month=e.numberValue(i.month):2===r?i.day=e.numberValue(i.day):3===r?i.hour=e.numberValue(i.hour):4===r?i.minute=e.numberValue(i.minute):5===r?i.second=e.numberValue(i.second):6===r?i.millisecond=e.numberValue(i.millisecond):7===r&&(i.zone=e.cast(ju.form(),i.zone)))})),Bu.isInit(i)?Bu.fromInit(i):null}static parse(e,t){return Gu.iso8601.parse(e)}static time(e){if(e instanceof Bu)return e.time;if(e instanceof Date)return e.getTime();if("number"==typeof e)return e;if("string"==typeof e)return Bu.parse(e).time;if(Bu.isInit(e))return Bu.fromInit(e).time;throw new TypeError(""+e)}static zone(e){return e instanceof Bu?e.zone:ju.utc}static isInit(e){if("object"==typeof e&&null!==e){const t=e;return(void 0===t.year||"number"==typeof t.year)&&(void 0===t.month||"number"==typeof t.month)&&(void 0===t.day||"number"==typeof t.day)&&(void 0===t.hour||"number"==typeof t.hour)&&(void 0===t.minute||"number"==typeof t.minute)&&(void 0===t.second||"number"==typeof t.second)&&(void 0===t.millisecond||"number"==typeof t.millisecond)&&(void 0===t.zone||ju.isAny(t.zone))&&("number"==typeof t.year||"number"==typeof t.month||"number"==typeof t.day||"number"==typeof t.hour||"number"==typeof t.minute||"number"==typeof t.second||"number"==typeof t.millisecond)}return!1}static isAny(e){return e instanceof Bu||e instanceof Date||"number"==typeof e||"string"==typeof e||Bu.isInit(e)}static form(){return new Wu(new Bu(0))}}i([a],Bu,"form",null);const Ku=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1];return new Bu(t.time+e*(r.time-t.time),r.zone)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class Wu extends Mi{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new Wu(e):this}mold(e){return e=Bu.fromAny(e),Tr.from(e.toString())}cast(e){let t=null;try{if(t=Bu.fromValue(e),void 0===t){const r=e.numberValue(void 0);if(void 0!==r)t=new Bu(r);else{const r=e.stringValue(void 0);void 0!==r&&(t=Bu.parse(r))}}}catch(e){}return null!==t?t:void 0}}class Hu extends Le{constructor(e){super(),this.dateParser=e}feed(e){return Hu.parse(e,this.dateParser)}static parse(e,t){return(t=t.feed(e)).isDone()?Le.done(Bu.fromAny(t.bind())):t.isError()?t.asError():new Hu(t)}}class Xu{constructor(e=Xu.Periods,t=Xu.Weekdays,r=Xu.ShortWeekdays,i=Xu.Months,n=Xu.ShortMonths){this.periods=e,this.weekdays=t,this.shortWeekdays=r,this.months=i,this.shortMonths=n}static standard(){return new Xu}}Xu.Periods=["AM","PM"],Xu.Weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Xu.ShortWeekdays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Xu.Months=["January","February","March","April","May","June","July","August","September","October","November","December"],Xu.ShortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i([a],Xu,"standard",null);const _u=function(){const e={};let t=null;return e.standard=function(e){let r=null;return void 0===e&&(e=Xu.standard()),e===Xu.standard()&&(r=t),null===r&&(r={Y:Gu.year,m:Gu.monthOfYear,B:Gu.month.withLocale(e),b:Gu.shortMonth.withLocale(e),d:Gu.dayOfMonth,A:Gu.weekday.withLocale(e),a:Gu.shortWeekday.withLocale(e),H:Gu.hour24,I:Gu.hour12,p:Gu.period.withLocale(e),M:Gu.minute,S:Gu.second,L:Gu.millisecond},e===Xu.standard()&&(t=r)),r},e}();class Gu{withLocale(e){return this}format(e){e=Bu.fromAny(e);let t=Se.stringOutput();return t=this.writeDate(t,e),t.bind()}parse(e){for("string"==typeof e&&(e=Se.stringInput(e));e.isCont()&&Se.isSpace(e.head());)e=e.step();let t=this.parseDate(e,{});if(t.isDone())for(;e.isCont()&&Se.isSpace(e.head());)e=e.step();return e.isCont()&&!t.isError()&&(t=Le.error(Ae.unexpected(e))),t.bind()}parseDate(e,t){const r=this.parseDateTime(e,t);return r.isDone()?Le.done(Bu.fromAny(r.bind())):r.isError()?r.asError():new Hu(r)}static get year(){return new Yu}static get monthOfYear(){return new Zu}static get month(){return new Qu(Xu.standard())}static get shortMonth(){return new $u(Xu.standard())}static get dayOfMonth(){return new Ju}static get weekday(){return new eh(Xu.standard())}static get shortWeekday(){return new th(Xu.standard())}static get hour24(){return new rh}static get hour12(){return new ih}static get period(){return new nh(Xu.standard())}static get minute(){return new sh}static get second(){return new oh}static get millisecond(){return new ah}static pattern(e,t){return(void 0===t||t instanceof Xu)&&(t=_u.standard(t)),new uh(e,t)}static get iso8601(){return new uh("%Y-%m-%dT%H:%M:%S.%LZ",_u.standard())}static parseDateNumber(e,t,r,i,n,s,o=0,a=0){let u=0;for(;a<n&&e.isCont()&&(u=e.head(),Ee.isDigit(u));)e.step(),o=10*o+Ee.decodeDigit(u),a+=1;return e.isEmpty()?t.cont(void 0!==s?s:{},o,a,e):a>=i?t.term(o,s||{},e):Le.error(Ae.expected(r,e))}static parseDateString(e,t,r,i,n){let s=0;for(n=void 0!==n?n:Se.stringOutput();;){if(!e.isCont()||(s=e.head(),!Se.isAlpha(s))){if(!e.isEmpty())return t.term(r,n.bind(),void 0!==i?i:{},e);break}e.step(),n.write(s)}return t.cont(r,void 0!==i?i:{},n,e)}static writeDateNumber2(e,t){const r=48+t%10,i=48+(t/=10)%10;return e=e.write(i).write(r)}static writeDateNumber3(e,t){const r=48+t%10,i=48+(t/=10)%10,n=48+(t/=10)%10;return e=e.write(n).write(i).write(r)}static writeDateNumber4(e,t){const r=48+t%10,i=48+(t/=10)%10,n=48+(t/=10)%10,s=48+(t/=10)%10;return e=e.write(s).write(n).write(i).write(r)}}i([a],Gu,"year",null),i([a],Gu,"monthOfYear",null),i([a],Gu,"month",null),i([a],Gu,"shortMonth",null),i([a],Gu,"dayOfMonth",null),i([a],Gu,"weekday",null),i([a],Gu,"shortWeekday",null),i([a],Gu,"hour24",null),i([a],Gu,"hour12",null),i([a],Gu,"period",null),i([a],Gu,"minute",null),i([a],Gu,"second",null),i([a],Gu,"millisecond",null),i([a],Gu,"iso8601",null);class Yu extends Gu{writeDate(e,t){return e=Gu.writeDateNumber4(e,t.year)}parseDateTime(e,t){return hh.parse(e,t)}}class Zu extends Gu{writeDate(e,t){return e=Gu.writeDateNumber2(e,t.month+1)}parseDateTime(e,t){return lh.parse(e,t)}}class Qu extends Gu{constructor(e){super(),this.locale=e}withLocale(e){return e!==this.locale?new Qu(e):this}writeDate(e,t){return e=e.write(this.locale.months[t.month])}parseDateTime(e,t){return ch.parse(e,this.locale,t)}}class $u extends Gu{constructor(e){super(),this.locale=e}withLocale(e){return e!==this.locale?new $u(e):this}writeDate(e,t){return e=e.write(this.locale.shortMonths[t.month])}parseDateTime(e,t){return dh.parse(e,this.locale,t)}}class Ju extends Gu{writeDate(e,t){return e=Gu.writeDateNumber2(e,t.day)}parseDateTime(e,t){return ph.parse(e,t)}}class eh extends Gu{constructor(e){super(),this.locale=e}withLocale(e){return e!==this.locale?new eh(e):this}writeDate(e,t){return e=e.write(this.locale.weekdays[t.weekday])}parseDateTime(e,t){return fh.parse(e,this.locale,t)}}class th extends Gu{constructor(e){super(),this.locale=e}withLocale(e){return e!==this.locale?new th(e):this}writeDate(e,t){return e=e.write(this.locale.shortWeekdays[t.weekday])}parseDateTime(e,t){return mh.parse(e,this.locale,t)}}class rh extends Gu{writeDate(e,t){return e=Gu.writeDateNumber2(e,t.hour)}parseDateTime(e,t){return yh.parse(e,t)}}class ih extends Gu{writeDate(e,t){let r=t.hour%12;return 0===r&&(r=12),e=Gu.writeDateNumber2(e,r)}parseDateTime(e,t){return wh.parse(e,t)}}class nh extends Gu{constructor(e){super(),this.locale=e}withLocale(e){return e!==this.locale?new nh(e):this}writeDate(e,t){return e=e.write(this.locale.periods[t.hour>=12?1:0])}parseDateTime(e,t){return gh.parse(e,this.locale,t)}}class sh extends Gu{writeDate(e,t){return e=Gu.writeDateNumber2(e,t.minute)}parseDateTime(e,t){return vh.parse(e,t)}}class oh extends Gu{writeDate(e,t){return e=Gu.writeDateNumber2(e,t.second)}parseDateTime(e,t){return bh.parse(e,t)}}class ah extends Gu{writeDate(e,t){return e=Gu.writeDateNumber3(e,t.millisecond)}parseDateTime(e,t){return xh.parse(e,t)}}class uh extends Gu{constructor(e,t){super(),this.pattern=e,this.specifiers=t}writeDate(e,t){const r=this.pattern,i=this.specifiers;let n=0,s=0;const o=r.length;for(;s<o;)if(37===r.charCodeAt(s)){n!==s&&(e=e.write(r.slice(n,s)));const o=i[r.charAt(s+1)];void 0!==o&&(e=o.writeDate(e,t)),s+=2,n=s}else s+=1;return n!==s&&(e=e.write(r.slice(n,s))),e}parseDateTime(e,t){return Ch.parse(e,this.pattern,this.specifiers,t)}}class hh extends Le{constructor(e,t,r){super(),this.date=e,this.year=t,this.step=r}feed(e){return hh.parse(e,this.date,this.year,this.step)}static parse(e,t,r,i){return Gu.parseDateNumber(e,hh,"full year",4,4,t,r,i)}static term(e,t){return t.year=e,Le.done(t)}static cont(e,t,r){return new hh(e,t,r)}}class lh extends Le{constructor(e,t,r){super(),this.date=e,this.month=t,this.step=r}feed(e){return lh.parse(e,this.date,this.month,this.step)}static parse(e,t,r,i){return Gu.parseDateNumber(e,lh,"month number",2,2,t,r,i)}static term(e,t){return t.month=e-1,Le.done(t)}static cont(e,t,r){return new lh(e,t,r)}}class ch extends Le{constructor(e,t,r){super(),this.locale=e,this.date=t,this.output=r}feed(e){return ch.parse(e,this.locale,this.date,this.output)}static parse(e,t,r,i){return Gu.parseDateString(e,ch,t,r,i)}static term(e,t,r,i){const n=e.months.indexOf(t);return n>=0?(r.month=n,Le.done(r)):Le.error(Ae.message("expected month, but found "+t,i))}static cont(e,t,r){return new ch(e,t,r)}}class dh extends Le{constructor(e,t,r){super(),this.locale=e,this.date=t,this.output=r}feed(e){return dh.parse(e,this.locale,this.date,this.output)}static parse(e,t,r,i){return Gu.parseDateString(e,dh,t,r,i)}static term(e,t,r,i){const n=e.shortMonths.indexOf(t);return n>=0?(r.month=n,Le.done(r)):Le.error(Ae.message("expected short month, but found "+t,i))}static cont(e,t,r){return new dh(e,t,r)}}class ph extends Le{constructor(e,t,r){super(),this.date=e,this.day=t,this.step=r}feed(e){return ph.parse(e,this.date,this.day,this.step)}static parse(e,t,r,i){return Gu.parseDateNumber(e,ph,"day of month",2,2,t,r,i)}static term(e,t){return t.day=e,Le.done(t)}static cont(e,t,r){return new ph(e,t,r)}}class fh extends Le{constructor(e,t,r){super(),this.locale=e,this.date=t,this.output=r}feed(e){return fh.parse(e,this.locale,this.date,this.output)}static parse(e,t,r,i){return Gu.parseDateString(e,fh,t,r,i)}static term(e,t,r,i){return e.weekdays.indexOf(t)>=0?Le.done(r):Le.error(Ae.message("expected weekday, but found "+t,i))}static cont(e,t,r){return new fh(e,t,r)}}class mh extends Le{constructor(e,t,r){super(),this.locale=e,this.date=t,this.output=r}feed(e){return mh.parse(e,this.locale,this.date,this.output)}static parse(e,t,r,i){return Gu.parseDateString(e,mh,t,r,i)}static term(e,t,r,i){return e.shortWeekdays.indexOf(t)>=0?Le.done(r):Le.error(Ae.message("expected short weekday, but found "+t,i))}static cont(e,t,r){return new mh(e,t,r)}}class yh extends Le{constructor(e,t,r){super(),this.date=e,this.hour=t,this.step=r}feed(e){return yh.parse(e,this.date,this.hour,this.step)}static parse(e,t,r,i){return Gu.parseDateNumber(e,yh,"hour (24)",2,2,t,r,i)}static term(e,t){return t.hour=e,Le.done(t)}static cont(e,t,r){return new yh(e,t,r)}}class wh extends Le{constructor(e,t,r){super(),this.date=e,this.hour=t,this.step=r}feed(e){return wh.parse(e,this.date,this.hour,this.step)}static parse(e,t,r,i){return Gu.parseDateNumber(e,wh,"hour (12)",2,2,t,r,i)}static term(e,t){return t.hour=(void 0!==t.hour?t.hour:0)+e,Le.done(t)}static cont(e,t,r){return new wh(e,t,r)}}class gh extends Le{constructor(e,t,r){super(),this.locale=e,this.date=t,this.output=r}feed(e){return gh.parse(e,this.locale,this.date,this.output)}static parse(e,t,r,i){return Gu.parseDateString(e,gh,t,r,i)}static term(e,t,r,i){const n=e.months.indexOf(t);return n>=0?(r.hour=(r.hour||0)+12*n,Le.done(r)):Le.error(Ae.message("expected period of day, but found "+t,i))}static cont(e,t,r){return new gh(e,t,r)}}class vh extends Le{constructor(e,t,r){super(),this.date=e,this.minute=t,this.step=r}feed(e){return vh.parse(e,this.date,this.minute,this.step)}static parse(e,t,r,i){return Gu.parseDateNumber(e,vh,"minute",2,2,t,r,i)}static term(e,t){return t.minute=e,Le.done(t)}static cont(e,t,r){return new vh(e,t,r)}}class bh extends Le{constructor(e,t,r){super(),this.date=e,this.second=t,this.step=r}feed(e){return bh.parse(e,this.date,this.second,this.step)}static parse(e,t,r,i){return Gu.parseDateNumber(e,bh,"second",2,2,t,r,i)}static term(e,t){return t.second=e,Le.done(t)}static cont(e,t,r){return new bh(e,t,r)}}class xh extends Le{constructor(e,t,r){super(),this.date=e,this.millisecond=t,this.step=r}feed(e){return xh.parse(e,this.date,this.millisecond,this.step)}static parse(e,t,r,i){return Gu.parseDateNumber(e,xh,"millisecond",1,3,t,r,i)}static term(e,t){return t.millisecond=e,Le.done(t)}static cont(e,t,r){return new xh(e,t,r)}}class Ch extends Le{constructor(e,t,r,i,n){super(),this.pattern=e,this.specifiers=t,this.date=r,this.dateParser=i,this.step=n}feed(e){return Ch.parse(e,this.pattern,this.specifiers,this.date,this.dateParser,this.step)}static parse(e,t,r,i={},n,s=0){let o=0;const a=t.length;for(;s<a;){const a=t.charCodeAt(s);if(37===a){if(void 0===n){const o=t.charAt(s+1),a=r[o];if(void 0===a)return Le.error(Ae.message("unknown format specifier: "+o,e));n=a.parseDateTime(e,i)}else n=n.feed(e);if(n.isDone()){i=n.bind(),n=void 0,s+=2;continue}if(n.isError())return n.asError()}else{if(e.isCont()){if(o=e.head(),o===a){e.step(),s+=1;continue}return Le.error(Ae.expected(a,e))}if(!e.isEmpty())return Le.error(Ae.unexpected(e))}break}return s===a?Le.done(i):new Ch(t,r,i,n,s)}}class Sh{next(e,t){return this.floor(this.offset(e,t))}ceil(e){return e=e instanceof Bu?new Bu(e.time-1,e.zone):Bu.time(e)-1,this.next(this.floor(e),1)}round(e){const t=Bu.fromAny(e),r=this.floor(t),i=this.ceil(t);return t.time-r.time<i.time-t.time?r:i}range(e,t,r){let i=this.ceil(e);const n=Bu.time(t),s=[];if((r="number"==typeof r?Math.floor(r):1)>0)for(;i.isDefined()&&i.time<n;)s.push(i),i=this.next(i,r);return s}filter(e){return new Eh(this,e)}static get year(){return new Ah}static get month(){return new Dh}static get week(){return new Ph}static get day(){return new Th}static get hour(){return new Ih}static get minute(){return new Mh}static get second(){return new Vh}static get millisecond(){return new qh}static years(e,t,r){return Sh.year.range(e,t,r)}static months(e,t,r){return Sh.month.range(e,t,r)}static weeks(e,t,r){return Sh.week.range(e,t,r)}static days(e,t,r){return Sh.day.range(e,t,r)}static hours(e,t,r){return Sh.hour.range(e,t,r)}static minutes(e,t,r){return Sh.minute.range(e,t,r)}static seconds(e,t,r){return Sh.second.range(e,t,r)}static milliseconds(e,t,r){return Sh.millisecond.range(e,t,r)}}Sh.MillisPerSecond=1e3,Sh.MillisPerMinute=60*Sh.MillisPerSecond,Sh.MillisPerHour=60*Sh.MillisPerMinute,i([a],Sh,"year",null),i([a],Sh,"month",null),i([a],Sh,"week",null),i([a],Sh,"day",null),i([a],Sh,"hour",null),i([a],Sh,"minute",null),i([a],Sh,"second",null),i([a],Sh,"millisecond",null);class Oh extends Sh{}class Eh extends Sh{constructor(e,t){super(),this.unit=e,this.predicate=t}offset(e,t){let r=Bu.fromAny(e);for(t=Math.max(1,"number"==typeof t?Math.floor(t):1);t<0;){do{r=this.unit.offset(r,-1)}while(r.isDefined()&&!this.predicate(r));t+=1}for(;t>0;){do{r=this.unit.offset(r,1)}while(r.isDefined()&&!this.predicate(r));t-=1}return r}floor(e){let t=Bu.fromAny(e);for(;t=this.unit.floor(t),t.isDefined()&&!this.predicate(t);)t=new Bu(t.time-1,t.zone);return t}}class Ah extends Oh{offset(e,t){let r=Bu.fromAny(e);return t=Math.max(1,"number"==typeof t?Math.floor(t):1),r=r.withYear(r.year+t),r}next(e,t){const r=Bu.fromAny(e);return t=Math.max(1,"number"==typeof t?Math.floor(t):1),r.withYear(r.year+t).withMonth(0,1).withHour(0,0,0,0)}floor(e){return Bu.fromAny(e).withMonth(0,1).withHour(0,0,0,0)}ceil(e){let t=Bu.fromAny(e);return t=new Bu(t.time-1,t.zone),t=t.withMonth(0,1).withHour(0,0,0,0),t=t.withYear(t.year+1),t.withMonth(0,1).withHour(0,0,0,0)}every(e){if(1===e)return this;if(isFinite(e)&&e>=1)return new kh(e);throw new Error(""+e)}}class kh extends Sh{constructor(e){super(),this.stride=e}offset(e,t){const r=Bu.fromAny(e);return t=Math.max(1,"number"==typeof t?Math.floor(t):1),r.withYear(r.year+t*this.stride)}next(e,t){let r=Bu.fromAny(e);return t=Math.max(1,"number"==typeof t?Math.floor(t):1),r=r.withYear(Math.floor((r.year+t*this.stride)/this.stride)*this.stride),r.withMonth(0,1).withHour(0,0,0,0)}floor(e){let t=Bu.fromAny(e);return t=t.withYear(Math.floor(t.year/this.stride)*this.stride),t.withMonth(0,1).withHour(0,0,0,0)}ceil(e){let t=Bu.fromAny(e);return t=new Bu(t.time-1,t.zone),t=t.withYear(Math.floor(t.year/this.stride)*this.stride),t=t.withMonth(0,1).withHour(0,0,0,0),t=t.withYear(Math.floor((t.year+this.stride)/this.stride)*this.stride),t.withMonth(0,1).withHour(0,0,0,0)}}class Dh extends Oh{offset(e,t){const r=Bu.fromAny(e);return t=Math.max(1,"number"==typeof t?Math.floor(t):1),r.withMonth(r.month+t)}next(e,t){let r=Bu.fromAny(e);return t=Math.max(1,"number"==typeof t?Math.floor(t):1),r=r.withMonth(r.month+t),r.withDay(1).withHour(0,0,0,0)}floor(e){return Bu.fromAny(e).withDay(1).withHour(0,0,0,0)}ceil(e){let t=Bu.fromAny(e);return t=new Bu(t.time-1,t.zone),t=t.withDay(1).withHour(0,0,0,0),t=t.withMonth(t.month+1),t.withDay(1).withHour(0,0,0,0)}every(e){if(1===e)return this;if(isFinite(e)&&e>=1)return new Eh(this,Dh.modulo.bind(void 0,e));throw new Error(""+e)}static modulo(e,t){const r=t.month;return isFinite(r)&&r%e==0}}class Ph extends Sh{constructor(e=0){super(),this.day=e}offset(e,t){const r=Bu.fromAny(e);return t=Math.max(1,"number"==typeof t?Math.floor(t):1),r.withDay(r.day+7*t)}next(e,t){let r=Bu.fromAny(e);return t=Math.max(1,"number"==typeof t?Math.floor(t):1),r=r.withDay(r.day+7*t),r=r.withDay(r.day-(r.weekday+7-this.day)%7),r.withHour(0,0,0,0)}floor(e){let t=Bu.fromAny(e);return t=t.withDay(t.day-(t.weekday+7-this.day)%7),t.withHour(0,0,0,0)}ceil(e){let t=Bu.fromAny(e);return t=new Bu(t.time-1,t.zone),t=t.withDay(t.day-(t.weekday+7-this.day)%7),t=t.withHour(0,0,0,0),t=t.withDay(t.day+7),t.withHour(0,0,0,0)}}class Th extends Oh{offset(e,t){const r=Bu.fromAny(e);return t=Math.max(1,"number"==typeof t?Math.floor(t):1),r.withDay(r.day+t)}next(e,t){let r=Bu.fromAny(e);return t=Math.max(1,"number"==typeof t?Math.floor(t):1),r=r.withDay(r.day+t),r.withHour(0,0,0,0)}floor(e){return Bu.fromAny(e).withHour(0,0,0,0)}ceil(e){let t=Bu.fromAny(e);return t=new Bu(t.time-1,t.zone),t=t.withHour(0,0,0,0),t=t.withDay(t.day+1),t.withHour(0,0,0,0)}every(e){if(1===e)return this;if(isFinite(e)&&e>=1)return new Eh(this,Th.modulo.bind(void 0,e));throw new Error(""+e)}static modulo(e,t){const r=t.day;return isFinite(r)&&r%e==0}}class Ih extends Oh{offset(e,t){const r=Bu.zone(e);return e=Bu.time(e),e+=(t=Math.max(1,"number"==typeof t?Math.floor(t):1))*Sh.MillisPerHour,new Bu(e,r)}next(e,t){const r=Bu.zone(e);e=Bu.time(e),e+=(t=Math.max(1,"number"==typeof t?Math.floor(t):1))*Sh.MillisPerHour;let i=r.offset*Sh.MillisPerMinute%Sh.MillisPerHour;return i<0&&(i+=Sh.MillisPerHour),e=Math.floor((e-i)/Sh.MillisPerHour)*Sh.MillisPerHour+i,new Bu(e,r)}floor(e){const t=Bu.zone(e);e=Bu.time(e);let r=t.offset*Sh.MillisPerMinute%Sh.MillisPerHour;return r<0&&(r+=Sh.MillisPerHour),e=Math.floor((e-r)/Sh.MillisPerHour)*Sh.MillisPerHour+r,new Bu(e,t)}ceil(e){const t=Bu.zone(e);e=Bu.time(e),e-=1;let r=t.offset*Sh.MillisPerMinute%Sh.MillisPerHour;return r<0&&(r+=Sh.MillisPerHour),e=Math.floor((e-r)/Sh.MillisPerHour)*Sh.MillisPerHour+r+Sh.MillisPerHour,e=Math.floor((e-r)/Sh.MillisPerHour)*Sh.MillisPerHour+r,new Bu(e,t)}every(e){if(1===e)return this;if(isFinite(e)&&e>=1)return new Eh(this,Ih.modulo.bind(void 0,e));throw new Error(""+e)}static modulo(e,t){const r=t.hour;return isFinite(r)&&r%e==0}}class Mh extends Oh{offset(e,t){const r=Bu.zone(e);return e=Bu.time(e),e+=(t=Math.max(1,"number"==typeof t?Math.floor(t):1))*Sh.MillisPerMinute,new Bu(e,r)}next(e,t){const r=Bu.zone(e);return e=Bu.time(e),t=Math.max(1,"number"==typeof t?Math.floor(t):1),e=Math.floor((e+t*Sh.MillisPerMinute)/Sh.MillisPerMinute)*Sh.MillisPerMinute,new Bu(e,r)}floor(e){const t=Bu.zone(e);return e=Bu.time(e),e=Math.floor(e/Sh.MillisPerMinute)*Sh.MillisPerMinute,new Bu(e,t)}ceil(e){const t=Bu.zone(e);return e=Bu.time(e),e=Math.floor((Math.floor((e-1)/Sh.MillisPerMinute)*Sh.MillisPerMinute+Sh.MillisPerMinute)/Sh.MillisPerMinute)*Sh.MillisPerMinute,new Bu(e,t)}every(e){if(1===e)return this;if(isFinite(e)&&e>=1)return new Eh(this,Mh.modulo.bind(void 0,e));throw new Error(""+e)}static modulo(e,t){const r=t.minute;return isFinite(r)&&r%e==0}}class Vh extends Oh{offset(e,t){const r=Bu.zone(e);return e=Bu.time(e),e+=(t=Math.max(1,"number"==typeof t?Math.floor(t):1))*Sh.MillisPerSecond,new Bu(e,r)}next(e,t){const r=Bu.zone(e);return e=Bu.time(e),e+=(t=Math.max(1,"number"==typeof t?Math.floor(t):1))*Sh.MillisPerSecond,e=Math.floor(e/Sh.MillisPerSecond)*Sh.MillisPerSecond,new Bu(e,r)}floor(e){const t=Bu.zone(e);return e=Bu.time(e),e=Math.floor(e/Sh.MillisPerSecond)*Sh.MillisPerSecond,new Bu(e,t)}ceil(e){const t=Bu.zone(e);return e=Bu.time(e),e=Math.floor((Math.floor((e-1)/Sh.MillisPerSecond)*Sh.MillisPerSecond+Sh.MillisPerSecond)/Sh.MillisPerSecond)*Sh.MillisPerSecond,new Bu(e,t)}every(e){if(1===e)return this;if(isFinite(e)&&e>=1)return new Eh(this,Vh.modulo.bind(void 0,e));throw new Error(""+e)}static modulo(e,t){const r=t.second;return isFinite(r)&&r%e==0}}class qh extends Oh{offset(e,t){const r=Bu.zone(e);return e=Bu.time(e),t=Math.max(1,"number"==typeof t?Math.floor(t):1),new Bu(e+=t,r)}next(e,t){const r=Bu.zone(e);return e=Bu.time(e),t=Math.max(1,"number"==typeof t?Math.floor(t):1),new Bu(e+=t,r)}floor(e){return Bu.fromAny(e)}ceil(e){return Bu.fromAny(e)}every(e){if(1===e)return this;if(isFinite(e)&&e>=1)return new Fh(e);throw new Error(""+e)}}class Fh extends Sh{constructor(e){super(),isFinite(e)||(e=1),this.stride=e}offset(e,t){const r=Bu.zone(e);return e=Bu.time(e),e+=(t=Math.max(1,"number"==typeof t?Math.floor(t):1))*this.stride,new Bu(e,r)}next(e,t){const r=Bu.zone(e);e=Bu.time(e),t=Math.max(1,"number"==typeof t?Math.floor(t):1);const i=this.stride;return e=Math.floor((e+t*i)/i)*i,new Bu(e,r)}floor(e){const t=Bu.zone(e);e=Bu.time(e);const r=this.stride;return e=Math.floor(e/r)*r,new Bu(e,t)}ceil(e){const t=Bu.zone(e);e=Bu.time(e);const r=this.stride;return e=Math.floor((Math.floor((e-1)/r)*r+r)/r)*r,new Bu(e,t)}}const Nh=function(e){const t=function(e,r){const i=function(e){const t=i[0].time,r=i[1].time-t;return 0!==r?(e.time-t)/r:0};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"inverse",{get(){return Uh(this[0],this[1])},configurable:!0}),t.prototype.contains=function(e){return e=Bu.time(e),this[0].time<=e&&e<=this[1].time},t.prototype.interpolateTo=function(e){return e instanceof t?zh(this,e):null},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this[0].equals(e[0])&&this[1].equals(e[1]))},t.prototype.toString=function(){return"TimeDomain("+this[0]+", "+this[1]+")"},t}(E),zh=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=t[0],n=t[1],s=i[1],o=s[0],a=s[1];return Nh(new Bu(r.time+e*(o.time-r.time),0===e?r.zone:o.zone),new Bu(n.time+e*(a.time-n.time),0===e?n.zone:a.zone))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D),Uh=function(e){const t=function(e,r){const i=function(e){const t=i[0].time,r=i[1].time;return new Bu(t+e*(r-t),0===e?i[0].zone:i[1].zone)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"inverse",{get(){return Nh(this[0],this[1])},configurable:!0}),t.prototype.interpolateTo=function(e){return e instanceof t?Rh(this,e):null},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this[0].equals(e[0])&&this[1].equals(e[1]))},t.prototype.toString=function(){return"TimeRange("+this[0]+", "+this[1]+")"},t}(A),Rh=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=t[0],n=t[1],s=i[1],o=s[0],a=s[1];return Uh(new Bu(r.time+e*(o.time-r.time),0===e?r.zone:o.zone),new Bu(n.time+e*(a.time-n.time),0===e?n.zone:a.zone))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D),jh=function(e){const t=function(e,r){const i=function(e){return i.range(i.domain(e))};return Object.setPrototypeOf(i,t.prototype),i.domain=e,i.range=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"inverse",{get(){return O(this.range.inverse,this.domain.inverse)},configurable:!0}),t.prototype.withDomain=function(e,r){let i;return 1===arguments.length?i=e:(e=Bu.fromAny(e),r=Bu.fromAny(r),i=Nh(e,r)),t(i,this.range)},t.prototype.overRange=function(e,r){let i;return i=1===arguments.length?e:j(e,r),t(this.domain,i)},t.prototype.clampDomain=function(e,r,i,n,s){void 0===s&&(s=l.Epsilon);const o=this.domain[0],a=this.domain[1];let u=o.time,h=a.time;const c=void 0!==e?e.time:void 0,d=void 0!==r?r.time:void 0;void 0!==c&&void 0!==d&&Math.abs(h-u)>d-c?u<h?(u=c,h=d):(h=c,u=d):(void 0!==c&&(u<h&&u<c?(h+=c-u,u=c):h<u&&h<c&&(u+=c-h,h=c)),void 0!==d&&(u<h&&h>d?(u-=h-d,h=d):h<u&&u>d&&(h-=u-d,u=d)));const p=this(o),f=this(a),m=p<f?f-p:p-f,y=Math.abs(m/(h-u));if(void 0!==i&&y<1/i){const e=m*i,t=u+h;u=(t-e)/2,h=(t+e)/2}else if(void 0!==n&&y>1/n){const e=m*n,t=u+h;u=(t-e)/2,h=(t+e)/2}return Math.abs(u-o.time)<s&&Math.abs(h-a.time)<s?this:t(Nh(new Bu(u,o.zone),new Bu(h,a.zone)),this.range)},t.prototype.solveDomain=function(e,r,i,n,s,o){void 0===o&&(o=l.Epsilon);const a=this.domain[1].time-this.domain[0].time,u=this.range[0],h=this.range[1],c=e.time,d=void 0!==i?i.time:void 0;let p;void 0===d||void 0===n||Math.abs(d-c)<o||Math.abs(n-r)<o?p=(h-u)/(0!==a?a:o):(p=(n-r)/(d-c),void 0!==s&&s||p<0==(h-u)/a<0||(p=-p));const f=r-p*c,m=(u-f)/p,y=(h-f)/p;return Math.abs(m-this.domain[0].time)<o&&Math.abs(y-this.domain[1].time)<o?this:t(Nh(new Bu(m,this.domain[0].zone),new Bu(y,this.domain[1].zone)),this.range)},t.prototype.interpolateTo=function(e){return e instanceof t?Lh(this,e):null},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"TimeScale("+this.domain+", "+this.range+")"},t}(K),Lh=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=t.domain,s=n[0].time,o=n[1].time,a=r.domain,u=a[0].time,h=a[1].time,l=Nh(new Bu(s+e*(u-s),0===e?n[0].zone:a[0].zone),new Bu(o+e*(h-o),0===e?n[1].zone:a[1].zone)),c=t.range,d=c[0],p=c[1],f=r.range,m=f[0],y=f[1],w=j(d+e*(m-d),p+e*(y-p));return jh(l,w)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class Bh{get tag(){return this.constructor.tag}toAny(){return this.toValue().toAny()}toRecon(){return ms.toString(this.toValue())}toString(){return Oe.debug(this)}static fromValue(e){switch(e.tag){case"open":return Hh.fromValue(e);case"opened":return Xh.fromValue(e);case"close":return _h.fromValue(e);case"closed":return Gh.fromValue(e);case"connect":return Yh.fromValue(e);case"connected":return Zh.fromValue(e);case"disconnect":return Qh.fromValue(e);case"disconnected":return $h.fromValue(e);case"error":return Jh.fromValue(e);case"event":return nl.fromValue(e);case"command":return sl.fromValue(e);case"link":return ol.fromValue(e);case"linked":return al.fromValue(e);case"sync":return ul.fromValue(e);case"synced":return hl.fromValue(e);case"unlink":return ll.fromValue(e);case"unlinked":return cl.fromValue(e);case"auth":return dl.fromValue(e);case"authed":return pl.fromValue(e);case"deauth":return fl.fromValue(e);case"deauthed":return ml.fromValue(e);default:return null}}static parseRecon(e){return this.fromValue(ms.parse(e))}}class Kh extends Bh{static fromValue(e){switch(e.tag){case"open":return Hh.fromValue(e);case"opened":return Xh.fromValue(e);case"close":return _h.fromValue(e);case"closed":return Gh.fromValue(e);case"connect":return Yh.fromValue(e);case"connected":return Zh.fromValue(e);case"disconnect":return Qh.fromValue(e);case"disconnected":return $h.fromValue(e);case"error":return Jh.fromValue(e);default:return null}}static parseRecon(e){return this.fromValue(ms.parse(e))}}class Wh extends Kh{constructor(e,t){super(),this.host=e,this.body=t}withHost(e){return e=vo.fromAny(e),this.copy(e,this.body)}withBody(e){return e=xr.fromAny(e),this.copy(this.host,e)}copy(e,t){return new this.constructor(e,t)}equals(e){return this===e||e instanceof Wh&&(this.constructor===e.constructor&&this.host.equals(e.host)&&this.body.equals(e.body))}hashCode(){return o.mash(o.mix(o.mix(m.hash(this.constructor),this.host.hashCode()),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40).debug(this.host.toString()),this.body.isDefined()&&(e=e.write(", ").debug(this.body)),e=e.write(41)}toValue(){const e=Cr.create(1).slot("host",this.host.toString());return gr.of(this.tag,e).concat(this.body)}static fromValue(e){let t;if(e.header(this.tag).forEach((function(e,r){const i=e.key.stringValue(void 0);void 0!==i?"host"===i&&(t=vo.parse(e.toValue().stringValue(""))):e instanceof xr&&0===r&&(t=vo.parse(e.stringValue("")))})),void 0!==t){const r=e.body();return new this(t,r)}return null}static create(e,t){return new this(e=vo.fromAny(e),t=void 0===t?xr.absent():xr.fromAny(t))}}class Hh extends Wh{}Hh.tag="open";class Xh extends Wh{}Xh.tag="opened";class _h extends Wh{}_h.tag="close";class Gh extends Wh{}Gh.tag="closed";class Yh extends Wh{}Yh.tag="connect";class Zh extends Wh{}Zh.tag="connected";class Qh extends Wh{}Qh.tag="disconnect";class $h extends Wh{}$h.tag="disconnected";class Jh extends Wh{}Jh.tag="error";class el extends Bh{withPrio(e){return this}withRate(e){return this}static fromValue(e){switch(e.tag){case"event":return nl.fromValue(e);case"command":return sl.fromValue(e);case"link":return ol.fromValue(e);case"linked":return al.fromValue(e);case"sync":return ul.fromValue(e);case"synced":return hl.fromValue(e);case"unlink":return ll.fromValue(e);case"unlinked":return cl.fromValue(e);case"auth":return dl.fromValue(e);case"authed":return pl.fromValue(e);case"deauth":return fl.fromValue(e);case"deauthed":return ml.fromValue(e);default:return null}}static parseRecon(e){return this.fromValue(ms.parse(e))}}Object.defineProperty(el.prototype,"prio",{get:()=>0,configurable:!0}),Object.defineProperty(el.prototype,"rate",{get:()=>0,configurable:!0});class tl extends el{constructor(e){super(),this.body=e}get node(){return vo.empty()}withNode(e){return this}get lane(){return vo.empty()}withLane(e){return this}withBody(e){return e=xr.fromAny(e),this.copy(e)}copy(e){return new this.constructor(e)}equals(e){return this===e||e instanceof tl&&(this.constructor===e.constructor&&this.body.equals(e.body))}hashCode(){return o.mash(o.mix(m.hash(this.constructor),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40),this.body.isDefined()&&(e=e.debug(this.body)),e=e.write(41)}toValue(){return gr.of(this.tag).concat(this.body)}static fromValue(e){if(e.header(this.tag).isDefined()){return new this(e.body())}return null}static create(e){return new this(e=void 0===e?xr.absent():xr.fromAny(e))}}class rl extends el{constructor(e,t,r){super(),this.node=e,this.lane=t,this.body=r}withNode(e){return e=vo.fromAny(e),this.copy(e,this.lane,this.body)}withLane(e){return e=vo.fromAny(e),this.copy(this.node,e,this.body)}withBody(e){return e=xr.fromAny(e),this.copy(this.node,this.lane,e)}copy(e,t,r){return new this.constructor(e,t,r)}equals(e){return this===e||e instanceof rl&&(this.constructor===e.constructor&&this.node.equals(e.node)&&this.lane.equals(e.lane)&&this.body.equals(e.body))}hashCode(){return o.mash(o.mix(o.mix(o.mix(m.hash(this.constructor),this.node.hashCode()),this.lane.hashCode()),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40).debug(this.node.toString()).write(", ").debug(this.lane.toString()),this.body.isDefined()&&(e=e.write(", ").debug(this.body)),e=e.write(41)}toValue(){const e=Cr.create(2).slot("node",this.node.toString()).slot("lane",this.lane.toString());return gr.of(this.tag,e).concat(this.body)}static fromValue(e){let t,r;if(e.header(this.tag).forEach((function(e,i){const n=e.key.stringValue(void 0);void 0!==n?"node"===n?t=vo.parse(e.toValue().stringValue("")):"lane"===n&&(r=vo.parse(e.toValue().stringValue(""))):e instanceof xr&&(0===i?t=vo.parse(e.stringValue("")):1===i&&(r=vo.parse(e.stringValue(""))))})),void 0!==t&&void 0!==r){const i=e.body();return new this(t,r,i)}return null}static create(e,t,r){return new this(e=vo.fromAny(e),t=vo.fromAny(t),r=void 0===r?xr.absent():xr.fromAny(r))}}class il extends el{constructor(e,t,r,i,n){super(),this.node=e,this.lane=t,Object.defineProperty(this,"prio",{value:r,writable:!0,enumerable:!0,configurable:!0}),Object.defineProperty(this,"rate",{value:i,writable:!0,enumerable:!0,configurable:!0}),this.body=n}withNode(e){return e=vo.fromAny(e),this.copy(e,this.lane,this.prio,this.rate,this.body)}withLane(e){return e=vo.fromAny(e),this.copy(this.node,e,this.prio,this.rate,this.body)}withPrio(e){return this.copy(this.node,this.lane,e,this.rate,this.body)}withRate(e){return this.copy(this.node,this.lane,this.prio,e,this.body)}withBody(e){return e=xr.fromAny(e),this.copy(this.node,this.lane,this.prio,this.rate,e)}copy(e,t,r,i,n){return new this.constructor(e,t,r,i,n)}equals(e){return this===e||e instanceof il&&(this.constructor===e.constructor&&this.node.equals(e.node)&&this.lane.equals(e.lane)&&this.prio===e.prio&&this.rate===e.rate&&this.body.equals(e.body))}hashCode(){return o.mash(o.mix(o.mix(o.mix(o.mix(o.mix(m.hash(this.constructor),this.node.hashCode()),this.lane.hashCode()),c.hash(this.prio)),c.hash(this.rate)),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40).debug(this.node.toString()).write(", ").debug(this.lane.toString()),0===this.prio&&0===this.rate||(e=e.write(", ").debug(this.prio).write(", ").debug(this.rate)),this.body.isDefined()&&(e=e.write(", ").debug(this.body)),e=e.write(41)}toValue(){const e=Cr.create(4).slot("node",this.node.toString()).slot("lane",this.lane.toString());return 0!==this.prio&&e.slot("prio",this.prio),0!==this.rate&&e.slot("rate",this.rate),gr.of(this.tag,e).concat(this.body)}static fromValue(e){let t,r,i=0,n=0;if(e.header(this.tag).forEach((function(e,s){const o=e.key.stringValue(void 0);void 0!==o?"node"===o?t=vo.parse(e.toValue().stringValue("")):"lane"===o?r=vo.parse(e.toValue().stringValue("")):"prio"===o?i=e.numberValue(i):"rate"===o&&(n=e.numberValue(n)):e instanceof xr&&(0===s?t=vo.parse(e.stringValue("")):1===s&&(r=vo.parse(e.stringValue(""))))})),void 0!==t&&void 0!==r){const s=e.body();return new this(t,r,i,n,s)}return null}static create(e,t,r,i,n){return void 0===r&&(r=0),void 0===i&&(i=0),new this(e=vo.fromAny(e),t=vo.fromAny(t),r,i,n=void 0===n?xr.absent():xr.fromAny(n))}}class nl extends rl{}nl.tag="event";class sl extends rl{}sl.tag="command";class ol extends il{}ol.tag="link";class al extends il{}al.tag="linked";class ul extends il{}ul.tag="sync";class hl extends rl{}hl.tag="synced";class ll extends rl{}ll.tag="unlink";class cl extends rl{}cl.tag="unlinked";class dl extends tl{}dl.tag="auth";class pl extends tl{}pl.tag="authed";class fl extends tl{}fl.tag="deauth";class ml extends tl{}ml.tag="deauthed";class yl{}class wl extends yl{constructor(e,t,r){super(),this.context=e,this.hostUri=t,this.options=r,this.authenticated=!1,this.session=xr.absent(),this.sendBuffer=[],this.downlinks=new Ut,this.downlinkCount=0,this.uriCache=new Lo(t),this.reconnectTimer=0,this.reconnectTimeout=0,this.idleTimer=0}get credentials(){var e;return null!==(e=this.options.credentials)&&void 0!==e?e:xr.absent()}get unlinkDelay(){var e;return null!==(e=this.options.unlinkDelay)&&void 0!==e?e:wl.UnlinkDelay}get maxReconnectTimeout(){var e;return null!==(e=this.options.maxReconnectTimeout)&&void 0!==e?e:wl.MaxReconnectTimeout}get idleTimeout(){var e;return null!==(e=this.options.idleTimeout)&&void 0!==e?e:wl.IdleTimeout}get sendBufferSize(){var e;return null!==(e=this.options.sendBufferSize)&&void 0!==e?e:wl.SendBufferSize}get idle(){return 0===this.sendBuffer.length&&0===this.downlinkCount}resolve(e){return this.uriCache.resolve(e)}unresolve(e){return this.uriCache.unresolve(e)}authenticate(e){if(!(e=xr.fromAny(e)).equals(this.options.credentials))if(this.options.credentials=e,this.connected){const t=new dl(e);this.push(t)}else this.open()}openDownlink(e){this.clearIdle();const t=this.resolve(e.nodeUri),r=e.laneUri;0===this.downlinkCount&&this.open();let i=this.downlinks.get(t);if(void 0===i&&(i=new Ut,this.downlinks.set(t,i)),void 0!==i.get(r))throw new Error("duplicate downlink");i.set(r,e),this.downlinkCount+=1,e.openUp(this),this.connected&&e.hostDidConnect(this)}unlinkDownlink(e){const t=this.resolve(e.nodeUri),r=e.laneUri,i=this.downlinks.get(t);if(void 0!==i&&i.get(r)&&this.connected){const i=new ll(this.unresolve(t),r,xr.absent());e.onUnlinkRequest(i,this),this.push(i)}}closeDownlink(e){const t=this.resolve(e.nodeUri),r=e.laneUri,i=this.downlinks.get(t);void 0!==i&&i.get(r)&&(this.downlinkCount-=1,i.delete(r),i.isEmpty()&&this.downlinks.delete(t),0===this.downlinkCount&&this.watchIdle(),e.closeUp(this))}command(e,t,r){e=vo.fromAny(e),e=this.resolve(e),t=vo.fromAny(t),r=xr.fromAny(r);const i=new sl(this.unresolve(e),t,r);this.push(i)}onEnvelope(e){e instanceof nl?this.onEventMessage(e):e instanceof sl?this.onCommandMessage(e):e instanceof ol?this.onLinkRequest(e):e instanceof al?this.onLinkedResponse(e):e instanceof ul?this.onSyncRequest(e):e instanceof hl?this.onSyncedResponse(e):e instanceof ll?this.onUnlinkRequest(e):e instanceof cl?this.onUnlinkedResponse(e):e instanceof dl?this.onAuthRequest(e):e instanceof pl?this.onAuthedResponse(e):e instanceof fl?this.onDeauthRequest(e):e instanceof ml?this.onDeauthedResponse(e):this.onUnknownEnvelope(e)}onEventMessage(e){const t=this.resolve(e.node),r=e.lane,i=this.downlinks.get(t);if(void 0!==i){const n=i.get(r);if(void 0!==n){const r=e.withNode(t);n.onEventMessage(r,this)}}}onCommandMessage(e){}onLinkRequest(e){}onLinkedResponse(e){const t=this.resolve(e.node),r=e.lane,i=this.downlinks.get(t);if(void 0!==i){const n=i.get(r);if(void 0!==n){const r=e.withNode(t);n.onLinkedResponse(r,this)}}}onSyncRequest(e){}onSyncedResponse(e){const t=this.resolve(e.node),r=e.lane,i=this.downlinks.get(t);if(void 0!==i){const n=i.get(r);if(void 0!==n){const r=e.withNode(t);n.onSyncedResponse(r,this)}}}onUnlinkRequest(e){}onUnlinkedResponse(e){const t=this.resolve(e.node),r=e.lane,i=this.downlinks.get(t);if(void 0!==i){const n=i.get(r);if(void 0!==n){const r=e.withNode(t);n.onUnlinkedResponse(r,this)}}}onAuthRequest(e){}onAuthedResponse(e){this.authenticated=!0,this.session=e.body,this.context.hostDidAuthenticate(e.body,this)}onDeauthRequest(e){}onDeauthedResponse(e){this.authenticated=!1,this.session=xr.absent(),this.context.hostDidDeauthenticate(e.body,this)}onUnknownEnvelope(e){}onConnect(){this.reconnectTimeout=0,this.context.hostDidConnect(this),this.downlinks.forEach((function(e,t){t.forEach((function(e,t){t.hostDidConnect(this)}),this)}),this)}onDisconnect(){this.authenticated=!1,this.session=xr.absent(),this.context.hostDidDisconnect(this),this.downlinks.forEach((function(e,t){t.forEach((function(e,t){t.hostDidDisconnect(this)}),this)}),this)}onError(e){this.context.hostDidFail(e,this),this.downlinks.forEach((function(t,r){r.forEach((function(t,r){r.hostDidFail(e,this)}),this)}),this)}reconnect(){0===this.reconnectTimer&&(0===this.reconnectTimeout?this.reconnectTimeout=Math.floor(500+1e3*Math.random()):this.reconnectTimeout=Math.min(Math.floor(1.8*this.reconnectTimeout),this.maxReconnectTimeout),this.reconnectTimer=setTimeout(this.open.bind(this),this.reconnectTimeout))}clearReconnect(){0!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=0)}watchIdle(){0===this.idleTimer&&this.connected&&this.idle&&(this.idleTimer=setTimeout(this.checkIdle.bind(this),this.idleTimeout))}clearIdle(){0!==this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=0)}checkIdle(){this.connected&&this.idle&&this.close()}close(){this.context.closeHost(this)}closeUp(){this.downlinks.forEach((function(e,t){t.forEach((function(e,t){t.closeUp(this)}),this)}),this)}}wl.UnlinkDelay=0,wl.MaxReconnectTimeout=3e4,wl.IdleTimeout=1e3,wl.SendBufferSize=1024;class gl extends wl{constructor(e,t,r){super(e,t,r),this.socket=null}get connected(){return null!==this.socket&&this.socket.readyState===this.socket.OPEN}open(){this.clearReconnect();let e=this.socket;if(null===e){let t;if(void 0!==this.options.WebSocket)t=this.options.WebSocket;else if("undefined"!=typeof WebSocket)t=WebSocket;else{if(null===gl.WebSocket)throw new Error("Missing WebSocket implementation");t=gl.WebSocket}let r=this.hostUri;const i=r.schemeName;"warp"===i||"swim"===i?r=r.withSchemeName("ws"):"warps"!==i&&"swims"!==i||(r=r.withSchemeName("wss")),e=void 0!==this.options.protocols?new t(r.toString(),this.options.protocols):new t(r.toString()),this.socket=e,e.onopen=this.onWebSocketOpen.bind(this),e.onmessage=this.onWebSocketMessage.bind(this),e.onclose=this.onWebSocketClose.bind(this),e.onerror=this.onWebSocketError.bind(this)}}close(){this.clearReconnect(),this.clearIdle(),null!==this.socket?(this.socket.close(),this.context.online||this.onWebSocketClose()):super.close()}push(e){if(this.connected){this.clearIdle();const t=e.toRecon();this.socket.send(t),this.watchIdle()}else if(e instanceof sl){if(!(this.sendBuffer.length<this.sendBufferSize))throw new Error("send buffer overflow");this.sendBuffer.push(e),this.open()}}onWebSocketOpen(){if(this.connected){const e=this.credentials;if(e.isDefined()){const t=new dl(e);this.push(t)}let t;for(this.onConnect();(t=this.sendBuffer.shift())&&this.connected;)this.push(t);this.watchIdle()}else this.close()}onWebSocketMessage(e){const t=e.data;if("string"==typeof t){const e=el.parseRecon(t);null!==e?this.onEnvelope(e):this.onUnknownEnvelope(t)}}onWebSocketClose(){const e=this.socket;null!==e&&(e.onopen=null,e.onmessage=null,e.onclose=null,e.onerror=null,this.socket=null),this.onDisconnect(),this.clearIdle(),this.idle?this.close():this.context.online&&this.reconnect()}onWebSocketError(){null!==this.socket&&(this.socket.close(),this.context.online?this.onError():this.onWebSocketClose())}}gl.WebSocket=null,"undefined"!=typeof WebSocket?gl.WebSocket=WebSocket:void 0!==r&&void 0!==r.WebSocket&&(gl.WebSocket=r.WebSocket);class vl extends wl{constructor(e,t,r,i){super(e,t,r),this.worker=i,this.port=null,this.connected=!1,this.onWorkerReceive=this.onWorkerReceive.bind(this),this.onPortReceive=this.onPortReceive.bind(this),this.worker.addEventListener("message",this.onWorkerReceive),this.worker.postMessage(Hh.create(this.hostUri).toAny())}open(){const e=this.port;null!==e&&e.postMessage(Yh.create(this.hostUri).toAny())}close(){this.clearIdle(),null!==this.port?(this.worker.postMessage(_h.create(this.hostUri).toAny()),this.context.online||this.closeDown()):super.close()}push(e){if(this.connected)this.clearIdle(),this.port.postMessage(e.toAny()),this.watchIdle();else if(e instanceof sl){if(!(this.sendBuffer.length<this.sendBufferSize))throw new Error("send buffer overflow");this.sendBuffer.push(e)}}onWorkerReceive(e){const t=xr.fromAny(e.data),r=Kh.fromValue(t);null!==r&&r.host.equals(this.hostUri)&&this.onSignal(r,e)}onPortReceive(e){const t=xr.fromAny(e.data),r=Bh.fromValue(t);null!==r?this.onMessage(r,e):this.onUnknownMessage(t)}onMessage(e,t){e instanceof Kh?this.onSignal(e,t):e instanceof el?this.onEnvelope(e):this.onUnknownMessage(e)}onSignal(e,t){e instanceof Xh?this.onOpenedSignal(e,t):e instanceof Gh?this.onClosedSignal(e):e instanceof Zh?this.onConnectedSignal(e):e instanceof $h?this.onDisconnectedSignal(e):e instanceof Jh?this.onErrorSignal(e):this.onUnexpectedSignal(e)}onOpenedSignal(e,t){const r=t.ports[0];void 0!==r&&(this.port=r,r.addEventListener("message",this.onPortReceive),r.start())}onClosedSignal(e){const t=this.port;null!==t&&(this.port=null,t.removeEventListener("message",this.onPortReceive)),this.closeDown()}onConnectedSignal(e){this.connected=!0;const t=this.credentials;if(t.isDefined()){const e=new dl(t);this.push(e)}let r;for(this.onConnect();(r=this.sendBuffer.shift())&&this.connected;)this.push(r);this.watchIdle()}onDisconnectedSignal(e){this.connected=!1,this.onDisconnect(),this.clearIdle(),this.idle?this.close():this.context.online&&this.reconnect()}onErrorSignal(e){}onUnexpectedSignal(e){throw new Error("unexpected warp host signal: "+e)}onUnknownMessage(e){throw new Error("unknown warp host message: "+e)}closeDown(){this.onDisconnect(),this.clearIdle(),this.idle?this.close():this.context.online&&this.reconnect()}static create(e,t,r){try{if(!1!==r.worker&&void 0!==this.webworker&&"undefined"!=typeof Blob){let i=this.webworkerUrl;if(void 0===i){const e=new Blob([this.webworker],{type:"text/javascript"});i=URL.createObjectURL(e),this.webworkerUrl=i}const n=new Worker(i,{name:t.toString(),type:"classic",credentials:"same-origin"});return new vl(e,t,r,n)}}catch(e){}return null}}vl.webworker='// @swim/client/webworker v4.0.0-dev.20210927.1 (c) 2015-2021 Swim.inc\n!function(){"use strict";function e(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}const t=function(){const e={};return"undefined"!=typeof window&&void 0!==window.crypto?e.fillBytes=function(e){window.crypto.getRandomValues(e)}:"undefined"!=typeof window&&void 0!==window.msCrypto?e.fillBytes=function(e){window.msCrypto.getRandomValues(e)}:e.fillBytes=function(e){if(e instanceof Int8Array)for(let t=0;t<e.length;t+=1)e[t]=128-Math.round(256*Math.random());else if(e instanceof Uint8Array)for(let t=0;t<e.length;t+=1)e[t]=Math.round(256*Math.random());else if(e instanceof Int16Array)for(let t=0;t<e.length;t+=1)e[t]=32768-Math.round(65536*Math.random());else if(e instanceof Uint16Array)for(let t=0;t<e.length;t+=1)e[t]=Math.round(65536*Math.random());else if(e instanceof Int32Array)for(let t=0;t<e.length;t+=1)e[t]=2147483648-Math.round(4294967296*Math.random());else{if(!(e instanceof Uint32Array))throw new TypeError(""+e);for(let t=0;t<e.length;t+=1)e[t]=Math.round(4294967296*Math.random())}},e}(),r=function(){const e={};return Object.defineProperty(e,"BigEndian",{value:"BE",enumerable:!0}),Object.defineProperty(e,"LittleEndian",{value:"LE",enumerable:!0}),Object.defineProperty(e,"NativeOrder",{get(){let t;const r=new ArrayBuffer(2);new Uint16Array(r)[0]=65279;const i=new Uint8Array(r);if(254===i[0]&&255===i[1])t=e.BigEndian;else{if(255!==i[0]||254!==i[1])throw new Error;t=e.LittleEndian}return Object.defineProperty(e,"NativeOrder",{value:t,enumerable:!0}),t},configurable:!0,enumerable:!0}),e}(),i=function(){const e={mix:function(t,r){return r=3432918353*(65535&r)+((3432918353*(r>>>16)&65535)<<16)&4294967295,t^=r=461845907*(65535&(r=e.rotl(r,15)))+((461845907*(r>>>16)&65535)<<16)&4294967295,t=27492+(65535&(t=5*(65535&(t=e.rotl(t,13)))+((5*(t>>>16)&65535)<<16)&4294967295))+((58964+(t>>>16)&65535)<<16)},mixUint8Array:function(t,i){if(r.NativeOrder===r.BigEndian)return e.mixUint8ArrayBE(t,i);if(r.NativeOrder===r.LittleEndian)return e.mixUInt8ArrayLE(t,i);throw new Error},mixUint8ArrayBE:function(t,r){let i=0;const n=r.length;for(;i+3<n;){const n=(255&r[i])<<24|(255&r[i+1])<<16|(255&r[i+2])<<8|255&r[i+3];t=e.mix(t,n),i+=4}if(i<n){let s=(255&r[i])<<24;i+1<n&&(s|=(255&r[i+1])<<16,i+2<n&&(s|=(255&r[i+2])<<8)),s=3432918353*(65535&s)+((3432918353*(s>>>16)&65535)<<16)&4294967295,s=e.rotl(s,15),s=461845907*(65535&s)+((461845907*(s>>>16)&65535)<<16)&4294967295,t^=s}return t^n},mixUInt8ArrayLE:function(t,r){let i=0;const n=r.length;for(;i+3<n;){const n=255&r[i]|(255&r[i+1])<<8|(255&r[i+2])<<16|(255&r[i+3])<<24;t=e.mix(t,n),i+=4}if(i<n){let s=255&r[i];i+1<n&&(s|=(255&r[i+1])<<8,i+2<n&&(s|=(255&r[i+2])<<16)),s=3432918353*(65535&s)+((3432918353*(s>>>16)&65535)<<16)&4294967295,s=e.rotl(s,15),s=461845907*(65535&s)+((461845907*(s>>>16)&65535)<<16)&4294967295,t^=s}return t^n},mixString:function(t,i){if(r.NativeOrder===r.BigEndian)return e.mixStringBE(t,i);if(r.NativeOrder===r.LittleEndian)return e.mixStringLE(t,i);throw new Error},mixStringBE:function(t,r){let i=0,n=32,s=0;const o=r.length;let a=0;for(;s<o;){let o=r.codePointAt(s);void 0===o&&(o=r.charCodeAt(s)),o>=0&&o<=127?(n-=8,i|=o<<n,0===n&&(t=e.mix(t,i),i=0,n=32),a+=1):o>=128&&o<=2047?(n-=8,i|=(192|o>>>6)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=(128|63&o)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),a+=2):o>=2048&&o<=65535||o>=57344&&o<=65535?(n-=8,i|=(224|o>>>12)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=(128|o>>>6&63)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=(128|63&o)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),a+=3):o>=65536&&o<=1114111?(n-=8,i|=(240|o>>>18)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=(128|o>>>12&63)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=(128|o>>>6&63)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=(128|63&o)<<n,0===n&&(t=e.mix(t,i),i=0,n=32),a+=4):(n-=8,i|=239<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=191<<n,0===n&&(t=e.mix(t,i),i=0,n=32),n-=8,i|=189<<n,0===n&&(t=e.mix(t,i),i=0,n=32),a+=3),s=u.offsetByCodePoints(r,s,1)}return 32!==n&&(i=3432918353*(65535&i)+((3432918353*(i>>>16)&65535)<<16)&4294967295,i=e.rotl(i,15),i=461845907*(65535&i)+((461845907*(i>>>16)&65535)<<16)&4294967295,t^=i),t^a},mixStringLE:function(t,r){let i=0,n=0,s=0;const o=r.length;let a=0;for(;s<o;){let o=r.codePointAt(s);void 0===o&&(o=r.charCodeAt(s)),o>=0&&o<=127?(i|=o<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),a+=1):o>=128&&o<=2047?(i|=(192|o>>>6)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=(128|63&o)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),a+=2):o>=2048&&o<=65535||o>=57344&&o<=65535?(i|=(224|o>>>12)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=(128|o>>>6&63)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=(128|63&o)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),a+=3):o>=65536&&o<=1114111?(i|=(240|o>>>18)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=(128|o>>>12&63)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=(128|o>>>6&63)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=(128|63&o)<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),a+=4):(i|=239<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=191<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),i|=189<<n,n+=8,32===n&&(t=e.mix(t,i),i=0,n=0),a+=3),s=u.offsetByCodePoints(r,s,1)}return 32!==n&&(i=3432918353*(65535&i)+((3432918353*(i>>>16)&65535)<<16)&4294967295,i=e.rotl(i,15),i=461845907*(65535&i)+((461845907*(i>>>16)&65535)<<16)&4294967295,t^=i),t^a},mash:function(e){return e=2246822507*(65535&(e^=e>>>16))+((2246822507*(e>>>16)&65535)<<16)&4294967295,e=3266489909*(65535&(e^=e>>>13))+((3266489909*(e>>>16)&65535)<<16)&4294967295,(e^=e>>>16)>>>0},rotl:function(e,t){return e<<t|e>>>32-t}};return e}(),n=function(e,t,r){const i=r.writable,n=r.enumerable,s=r.configurable;if(void 0!==r.get){const o=r.get;r.get=function(){const r=o.call(this);return Object.defineProperty(e,t,{value:r,writable:i,enumerable:n,configurable:s}),r}}else{if(void 0===r.value)throw new Error("invalid lazy property descriptor");{const o=r.value;r.value=function(){const r=o.call(this);return Object.defineProperty(e,t,{value:function(){return r},writable:i,enumerable:n,configurable:s}),r}}}},s=function(){const e={compare:function(e,t){return"boolean"==typeof e?"boolean"==typeof t?e&&!t?-1:!e&&t?1:0:-1:null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN},hash:function(e){if(!0===e)return 3;if(!1===e)return 2;if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)}};return e}(),o=function(){const e=function(e,t,r){return e===t||null!=e&&"function"==typeof e.equivalentTo&&e.equivalentTo(t,r)};return e.is=function(e){return null!=e&&"function"==typeof e.equivalentTo},e.Epsilon=1e-8,e}(),a=function(){const e={equal:function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},equivalent:function(e,t,r){return e===t||"number"==typeof e&&"number"==typeof t&&(isNaN(e)&&isNaN(t)||Math.abs(t-e)<(void 0!==r?r:o.Epsilon))},compare:function(e,t){return"number"==typeof e?"number"==typeof t?e<t?-1:e>t?1:isNaN(t)?isNaN(e)?0:-1:isNaN(e)?1:0:-1:null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN}},t=new ArrayBuffer(8),r=new Float64Array(t),i=new Int32Array(t);return e.hash=function(e){if("number"==typeof e)return e===~~e?~~e:(r[0]=e,i[0]^i[1]);if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)},e}(),u=function(){const e={compare:function(e,t){return"string"==typeof e?"string"==typeof t?e<t?-1:e>t?1:0:-1:null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN},hash:function(e){if("string"==typeof e)return i.mash(i.mixString(0,e));if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)},codePointAt:function(e,t){const r=e.length;if((t=t?Number(t):0)!=t&&(t=0),t>=0&&t<r){const i=e.charCodeAt(t);if(i<=55295||i>=57344)return i;if(i<=56319&&t+1<r){const r=e.charCodeAt(t+1);if(r>=56320&&r<=57343)return 65536+((1023&i)<<10+r&1023)}}},offsetByCodePoints:function(e,t,r){if(r>0){const i=e.length;for(;r>0&&t<i;){const n=e.charCodeAt(t);if(n<=55295||n>=57344)t+=1;else if(n<=56319&&t+1<i){const r=e.charCodeAt(t+1);t+=r>=56320&&r<=57343?2:1}else t+=1;r-=1}}else if(r<0)for(;r<0&&t>0;){const i=e.charCodeAt(t-1);if(i<=55295||i>=57344)t-=1;else if(i>=56320&&i<=57343&&t-1>0){const r=e.charCodeAt(t-2);t-=r>=55296&&r<=57343?2:1}else t-=1;r-=1}return t}};return e}(),h=function(){const e={compare:function(t,r){if("function"==typeof t){if("function"==typeof r){const i=e.hash(t),n=e.hash(r);return i<n?-1:i>n?1:0}return-1}return null===t?void 0===r?-1:null===r?0:1:void 0===t?void 0===r?0:1:NaN}};let t=-1;return e.hash=function(e){if("function"==typeof e){let r=e._hashCode;return void 0===r&&(r=~~t,t-=1,Object.defineProperty(e,"_hashCode",{value:r,configurable:!0})),r}if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)},e}(),l=function(){const e={compare:function(t,r){if("function"==typeof t){if("function"==typeof r){const i=e.hash(t),n=e.hash(r);return i<n?-1:i>n?1:0}return-1}return null===t?void 0===r?-1:null===r?0:1:void 0===t?void 0===r?0:1:NaN},hash:function(e){if("function"==typeof e){let t=e._hashCode;return void 0===t&&(t=i.mash(i.mixString(0,e.name)),Object.defineProperty(e,"_hashCode",{value:t,configurable:!0})),t}if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)}};return e}(),c=function(){const e=function(e,t){return e===t||null!=e&&"function"==typeof e.equals&&e.equals(t)};return e.is=function(e){return null!=e&&"function"==typeof e.equals},e}(),d=function(){const e=function(e){return void 0===e?0:null===e?1:e.hashCode()};return e.is=function(e){return null!=e&&"function"==typeof e.hashCode},e}(),p=function(){const e=function(e,t){return void 0===e?void 0===t?0:1:null===e?void 0===t?-1:null===t?0:1:"function"==typeof e.compareTo?null==t?-1:e.compareTo(t):NaN};return e.is=function(e){return null!=e&&"function"==typeof e.compareTo},e}(),f=function(){const e={equal:function(e,t){if(e===t)return!0;if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t){const r=Object.keys(e),i=Object.keys(t),n=r.length;if(n!==i.length)return!1;for(let s=0;s<n;s+=1){const n=r[s];if(n!==i[s]||!w.equal(e[n],t[n]))return!1}return!0}return!1},equivalent:function(e,t,r){if(e===t)return!0;if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t){const i=Object.keys(e),n=Object.keys(t),s=i.length;if(s!==n.length)return!1;for(let o=0;o<s;o+=1){const s=i[o];if(s!==n[o]||!w.equivalent(e[s],t[s],r))return!1}return!0}return!1},compare:function(e,t){if("object"==typeof e&&null!==e){if("object"==typeof t&&null!==t){if(e!==t){const r=Object.keys(e),i=Object.keys(t),n=r.length,s=i.length,o=Math.min(n,s);let a=0;for(let n=0;n<o&&0===a;n+=1){const s=r[n],o=i[n];a=u.compare(s,o),0===a&&(a=w.compare(e[s],t[o]))}return 0!==a?a:n>s?1:n<s?-1:0}return 0}return-1}return null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN},hash:function(e){if("object"==typeof e&&null!==e){let t=0;const r=Object.keys(e);for(let n=0,s=r.length;n<s;n+=1){const s=r[n];t=i.mix(i.mix(t,u.hash(s)),w.hash(e[s]))}return i.mash(t)}if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)}};return e}(),w=function(){const e={equal:function(e,t){if(e instanceof Date&&(e=e.getTime()),t instanceof Date&&(t=t.getTime()),e===t)return!0;if("number"==typeof e){if("number"==typeof t)return isNaN(e)&&isNaN(t)}else{if(c.is(e))return e.equals(t);if(Array.isArray(e)){if(Array.isArray(t))return m.equal(e,t)}else if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t)return f.equal(e,t)}return!1},hash:function(e){if(void 0===e)return 0;if(null===e)return 1;if(!1===e)return 2;if(!0===e)return 3;if("number"==typeof e)return a.hash(e);if("string"==typeof e)return u.hash(e);if(d.is(e))return e.hashCode();if("function"==typeof e)return h.hash(e);if(Array.isArray(e))return m.hash(e);if("object"==typeof e)return f.hash(e);throw new TypeError(""+e)},equivalent:function(e,t,r=o.Epsilon){if(e instanceof Date&&(e=e.getTime()),t instanceof Date&&(t=t.getTime()),e===t)return!0;if("number"==typeof e){if("number"==typeof t)return isNaN(e)&&isNaN(t)||Math.abs(t-e)<r}else{if(o.is(e))return e.equivalentTo(t,r);if(Array.isArray(e)){if(Array.isArray(t))return m.equivalent(e,t,r)}else if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t)return f.equivalent(e,t,r)}return!1},compare:function(e,t){return e instanceof Date&&(e=e.getTime()),t instanceof Date&&(t=t.getTime()),void 0===e?void 0===t?0:1:null===e?void 0===t?-1:null===t?0:1:"boolean"==typeof e?null==t?-1:"boolean"==typeof t?e&&!t?-1:!e&&t?1:0:1:"number"==typeof e?null==t||"boolean"==typeof t?-1:"number"==typeof t?e<t?-1:e>t?1:isNaN(t)?isNaN(e)?0:-1:isNaN(e)?1:0:1:"string"==typeof e?null==t||"boolean"==typeof t||"number"==typeof t?-1:"string"==typeof t?e<t?-1:e>t?1:0:1:p.is(e)?e.compareTo(t):"function"==typeof e?null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t?-1:"function"==typeof t?h.compare(e,t):1:Array.isArray(e)?null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"function"==typeof t?-1:Array.isArray(t)?m.compare(e,t):1:"object"==typeof e?null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"function"==typeof t||Array.isArray(t)?-1:"object"==typeof t?f.compare(e,t):1:NaN}};return e}(),m=function(){const e={};return Object.defineProperty(e,"empty",{value:Object.freeze([]),enumerable:!0,configurable:!0}),e.inserted=function(e,t){const r=null!=t?t.length:0,i=new Array(r+1);for(let n=0;n<r;n+=1){const r=t[n];if(r===e)return t;i[n]=r}return i[r]=e,i},e.removed=function(t,r){const i=null!=r?r.length:0;if(0===i)return null!=r?r:e.empty;if(1===i)return r[0]!==t?r:e.empty;{const e=new Array(i-1);let n=0;for(;n<i;){const s=r[n];if(s===t){for(n+=1;n<i;)e[n-1]=r[n],n+=1;return e}e[n]=s,n+=1}return r}},e.equal=function(e,t){if(e===t)return!0;if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t){const r=e.length;if(r!==t.length)return!1;for(let i=0;i<r;i+=1)if(!w.equal(e[i],t[i]))return!1;return!0}return!1},e.equivalent=function(e,t,r){if(e===t)return!0;if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t){const i=e.length;if(i!==t.length)return!1;for(let n=0;n<i;n+=1)if(!w.equivalent(e[n],t[n],r))return!1;return!0}return!1},e.compare=function(e,t){if("object"==typeof e&&null!==e){if("object"==typeof t&&null!==t){if(e!==t){const r=e.length,i=t.length;let n=0;for(let s=0,o=Math.min(r,i);s<o&&0===n;s+=1)n=w.compare(e[s],t[s]);return 0!==n?n:r>i?1:r<i?-1:0}return 0}return-1}return null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN},e.hash=function(e){if("object"==typeof e&&null!==e){let t=0;for(let r=0,n=e.length;r<n;r+=1)t=i.mix(t,w.hash(e[r]));return i.mash(t)}if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)},e}(),g=function(e){const t=function(e,r){const i=function(e){return i.range(i.domain(e))};return Object.setPrototypeOf(i,t.prototype),i.domain=e,i.range=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.equivalentTo=function(e,r){return this===e||e instanceof t&&(this.domain.equivalentTo(e.domain,r)&&this.range.equivalentTo(e.range,r))},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"Mapping("+this.domain+", "+this.range+")"},t}(Function),y=function(e){const t=function(e,r){const i=function(e){return w.equal(e,i[1])?1:0};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"domain",{get(){return this},configurable:!0}),Object.defineProperty(t.prototype,"range",{get:()=>b.unit,configurable:!0}),t.prototype.contains=function(e){return w.compare(this[0],e)<=0&&w.compare(e,this[1])<=0},t.prototype.equivalentTo=function(e,r){return this===e||e instanceof t&&(w.equivalent(this[0],e[0],r)&&w.equivalent(this[1],e[1],r))},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&w.equal(this[0],e[0])&&w.equal(this[1],e[1]))},t.prototype.toString=function(){return"Domain("+this[0]+", "+this[1]+")"},Object.defineProperty(t,"unit",{get(){const e=q(0,1);return Object.defineProperty(t,"unit",{value:e,enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),t}(g),b=function(e){const t=function(e,r){const i=function(e){return e<1?i[0]:i[1]};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"domain",{get:()=>y.unit,configurable:!0}),Object.defineProperty(t.prototype,"range",{get(){return this},configurable:!0}),t.prototype.equivalentTo=function(e,r){return this===e||e instanceof t&&(w.equivalent(this[0],e[0],r)&&w.equivalent(this[1],e[1],r))},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&w.equal(this[0],e[0])&&w.equal(this[1],e[1]))},t.prototype.toString=function(){return"Range("+this[0]+", "+this[1]+")"},Object.defineProperty(t,"unit",{get(){const e=V(0,1);return Object.defineProperty(t,"unit",{value:e,enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),t}(g),v=function(){const e=function(e,t){return null!=e&&"function"==typeof e.interpolateTo?e.interpolateTo(t):null};return e.is=function(e){return null!=e&&"function"==typeof e.interpolateTo},e}(),x=function(e){const t=function(e,t){let r;return e===t?r=E(e):"number"==typeof e&&"number"==typeof t?r=A(e,t):Array.isArray(e)&&Array.isArray(t)?r=S(e,t):(r=v(e,t),null===r&&(r=C(e,t))),r};return(t.prototype=Object.create(e.prototype)).constructor=t,t.prototype.map=function(e){return O(this,e)},t.prototype.interpolateTo=function(e){return e instanceof t?k(this,e):null},t.prototype.canEqual=function(e){return e instanceof this.constructor},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&w.equal(this[0],e[0])&&w.equal(this[1],e[1]))},t.prototype.toString=function(){return"Interpolator("+this[0]+", "+this[1]+")"},t}(b),O=function(e){const t=function(e,r){const i=function(e){return i.transform(i.interpolator(e))};return Object.setPrototypeOf(i,t.prototype),i.interpolator=e,i.transform=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return this.transform(this.interpolator[0])},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return this.transform(this.interpolator[1])},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.interpolator.equals(e.interpolator)&&this.transform===e.transform)},t}(x),E=function(e){const t=function(e){const r=function(e){return r.value};return Object.setPrototypeOf(r,t.prototype),r.value=e,r};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return this.value},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return this.value},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&this.value===e.value},t}(x),C=function(e){const t=function(e,r){const i=function(e){return e<1?i[0]:i[1]};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(x),A=function(e){const t=function(e,r){const i=function(e){const t=i[0];return t+e*(i[1]-t)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(x),S=function(e){const t=function(e,r){const i=function(e){const t=i.interpolators,r=t.length,n=new Array(r);for(let i=0;i<r;i+=1)n[i]=t[i](e);return n};Object.setPrototypeOf(i,t.prototype);const n=Math.min(e.length,r.length),s=new Array(n);for(let t=0;t<n;t+=1)s[t]=x(e[t],r[t]);return i.interpolators=s,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.interpolators,t=e.length,r=new Array(t);for(let i=0;i<t;i+=1)r[i]=e[i][0];return r},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.interpolators,t=e.length,r=new Array(t);for(let i=0;i<t;i+=1)r[i]=e[i][1];return r},configurable:!0}),t.prototype.equals=function(e){if(this===e)return!0;if(e instanceof t){const t=this.interpolators.length;if(t===e.interpolators.length){for(let r=0;r<t;r+=1)if(!this.interpolators[r].equals(e.interpolators[r]))return!1;return!0}}return!1},t}(x),k=function(e){const t=function(e,r){const i=function(e){return 0===e?i[0]:1===e?i[1]:x(i[0](e),i[1](e))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(x),T=function(e){const t=function(e,r,i){const n=function(e){const t=n[0],r=n[1];return n.easing(Math.min(Math.max(0,(e-t)/(r-t)),1))};return Object.setPrototypeOf(n,t.prototype),n.easing=e,n[0]=r,n[1]=i,n};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"duration",{get(){return this[1]-this[0]},configurable:!0}),t.prototype.contains=function(e){return this[0]<=e&&e<=this[1]},t.prototype.withDomain=function(e,r){return t(this.easing,e,r)},t.prototype.withDuration=function(e){const r=this[0];return t(this.easing,r,r+e)},t.prototype.overRange=function(e,t){let r;return r=1===arguments.length?e:x(e,t),D(this,r)},t.prototype.equivalentTo=function(e,r){return this===e||e instanceof t&&(this.easing.equivalentTo(e.easing,r)&&w.equivalent(this[0],e[0],r)&&w.equivalent(this[1],e[1],r))},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this.easing.equals(e.easing)&&w.equal(this[0],e[0])&&w.equal(this[1],e[1]))},t.prototype.toString=function(){return"Timing("+this.easing+", "+this[0]+", "+this[1]+")"},t.fromInit=function(e){let r=e.easing;void 0===r?r=P.linear:"string"==typeof r&&(r=P(r));let i=e.t0;void 0===i&&(i=0);let n=e.t1;if(void 0===n){const t=e.dt;n=void 0!==t?i+t:i}return t(r,i,n)},t.fromAny=function(e){if(null==e)return!1;if(e instanceof t||"boolean"==typeof e)return e;if("object"==typeof e)return t.fromInit(e);throw new TypeError(""+e)},t}(y),P=function(e){const t=function(e){switch(e){case"linear":return t.linear;case"quad-in":return t.quadIn;case"quad-out":return t.quadOut;case"quad-in-out":return t.quadInOut;case"cubic-in":return t.cubicIn;case"cubic-out":return t.cubicOut;case"cubic-in-out":return t.cubicInOut;case"quart-in":return t.quartIn;case"quart-out":return t.quartOut;case"quart-in-out":return t.quartInOut;case"expo-in":return t.expoIn;case"expo-out":return t.expoOut;case"expo-in-out":return t.expoInOut;case"circ-in":return t.circIn;case"circ-out":return t.circOut;case"circ-in-out":return t.circInOut;case"back-in":return t.backIn;case"back-out":return t.backOut;case"back-in-out":return t.backInOut;case"elastic-in":return t.elasticIn;case"elastic-out":return t.elasticOut;case"elastic-in-out":return t.elasticInOut;case"bounce-in":return t.bounceIn;case"bounce-out":return t.bounceOut;case"bounce-in-out":return t.bounceInOut;default:throw new Error("unknown easing: "+e)}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{value:0}),Object.defineProperty(t.prototype,1,{value:1}),Object.defineProperty(t.prototype,"easing",{get(){return this}}),t.prototype.equivalentTo=function(e,t){return this===e},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e},t.prototype.toString=function(){return\'Easing("\'+this.type+\'")\'},t.fromAny=function(e){if(e instanceof t)return e;if("string"==typeof e)return t(e);throw new TypeError(""+e)},t.linear=function(e){return e},Object.setPrototypeOf(t.linear,t.prototype),t.linear.type="linear",t.quadIn=function(e){return e*e},Object.setPrototypeOf(t.quadIn,t.prototype),t.quadIn.type="quad-in",t.quadOut=function(e){return e*(2-e)},Object.setPrototypeOf(t.quadOut,t.prototype),t.quadOut.type="quad-out",t.quadInOut=function(e){return(e*=2)<=1?e*=e:(e-=1,e*=2-e,e+=1),e/=2},Object.setPrototypeOf(t.quadInOut,t.prototype),t.quadInOut.type="quad-in-out",t.cubicIn=function(e){return e*e*e},Object.setPrototypeOf(t.cubicIn,t.prototype),t.cubicIn.type="cubic-in",t.cubicOut=function(e){return e-=1,e*=e*e,e+=1},Object.setPrototypeOf(t.cubicOut,t.prototype),t.cubicOut.type="cubic-out",t.cubicInOut=function(e){return(e*=2)<=1?e*=e*e:(e-=2,e*=e*e,e+=2),e/=2},Object.setPrototypeOf(t.cubicInOut,t.prototype),t.cubicInOut.type="cubic-in-out",t.quartIn=function(e){return e*e*e*e},Object.setPrototypeOf(t.quartIn,t.prototype),t.quartIn.type="quart-in",t.quartOut=function(e){return 1-(e-=1)*e*e*e},Object.setPrototypeOf(t.quartOut,t.prototype),t.quartOut.type="quart-out",t.quartInOut=function(e){const t=e-1;return e<.5?8*e*e*e*e:1-8*t*t*t*t},Object.setPrototypeOf(t.quartInOut,t.prototype),t.quartInOut.type="quart-in-out",t.expoIn=function(e){return 0===e?0:Math.pow(2,10*(e-1))},Object.setPrototypeOf(t.expoIn,t.prototype),t.expoIn.type="expo-in",t.expoOut=function(e){return 1===e?1:1-Math.pow(2,-10*e)},Object.setPrototypeOf(t.expoOut,t.prototype),t.expoOut.type="expo-out",t.expoInOut=function(e){return 1===e||0===e?e:(e*=2)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*(e-1)))},Object.setPrototypeOf(t.expoInOut,t.prototype),t.expoInOut.type="expo-in-out",t.circIn=function(e){return-1*(Math.sqrt(1-e/1*e)-1)},Object.setPrototypeOf(t.circIn,t.prototype),t.circIn.type="circ-in",t.circOut=function(e){return e-=1,Math.sqrt(1-e*e)},Object.setPrototypeOf(t.circOut,t.prototype),t.circOut.type="circ-out",t.circInOut=function(e){if((e*=2)<1)return-.5*(Math.sqrt(1-e*e)-1);const t=e-2;return.5*(Math.sqrt(1-t*t)+1)},Object.setPrototypeOf(t.circInOut,t.prototype),t.circInOut.type="circ-in-out",t.backIn=function(e){const t=1.70158;return e*e*((t+1)*e-t)},Object.setPrototypeOf(t.backIn,t.prototype),t.backIn.type="back-in",t.backOut=function(e){const t=1.70158,r=e/1-1;return r*r*((t+1)*t+t)+1},Object.setPrototypeOf(t.backOut,t.prototype),t.backOut.type="back-out",t.backInOut=function(e){const t=2.5949095;if((e*=2)<1)return.5*e*e*((t+1)*e-t);const r=e-2;return.5*(r*r*((t+1)*r+t)+2)},Object.setPrototypeOf(t.backInOut,t.prototype),t.backInOut.type="back-in-out",t.elasticIn=function(e){if(0===e||1===e)return e;const t=e/1-1,r=(1-.7)/2*Math.PI*Math.asin(1);return-Math.pow(2,10*t)*Math.sin(2*(t-r)*Math.PI/(1-.7))},Object.setPrototypeOf(t.elasticIn,t.prototype),t.elasticIn.type="elastic-in",t.elasticOut=function(e){if(0===e||1===e)return e;const t=(1-.7)/(2*Math.PI)*Math.asin(1);return e*=2,Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/(1-.7))+1},Object.setPrototypeOf(t.elasticOut,t.prototype),t.elasticOut.type="elastic-out",t.elasticInOut=function(e){if(0===e||1===e)return e;const t=.65,r=(1-t)/(2*Math.PI)*Math.asin(1),i=2*e,n=i-1;return i<1?Math.pow(2,10*n)*Math.sin(2*(n-r)*Math.PI/(1-t))*-.5:Math.pow(2,-10*n)*Math.sin(2*(n-r)*Math.PI/(1-t))*.5+1},Object.setPrototypeOf(t.elasticInOut,t.prototype),t.elasticInOut.type="elastic-in-out",t.bounceIn=function(e){const t=7.5625;return(e=1-e)<1/2.75?1-t*e*e:e<2/2.75?1-(t*(e-=1.5/2.75)*e+.75):e<2.5/2.75?1-(t*(e-=2.25/2.75)*e+.9375):1-(t*(e-=2.625/2.75)*e+.984375)},Object.setPrototypeOf(t.bounceIn,t.prototype),t.bounceIn.type="bounce-in",t.bounceOut=function(e){const t=7.5625;return e<1/2.75?t*e*e:e<2/2.75?t*(e-=1.5/2.75)*e+.75:e<2.5/2.75?t*(e-=2.25/2.75)*e+.9375:t*(e-=2.625/2.75)*e+.984375},Object.setPrototypeOf(t.bounceOut,t.prototype),t.bounceOut.type="bounce-out",t.bounceInOut=function(e){const t=e<.5,r=7.5625;return(e=t?1-2*e:2*e-1)<1/2.75?e*=r*e:e=e<2/2.75?r*(e-=1.5/2.75)*e+.75:e<2.5/2.75?r*(e-=2.25/2.75)*e+.9375:r*(e-=2.625/2.75)*e+.984375,t?.5*(1-e):.5*e+.5},Object.setPrototypeOf(t.bounceInOut,t.prototype),t.bounceInOut.type="bounce-in-out",t}(T),D=function(e){const t=function(e,r){const i=function(e){return i.range(i.domain(e))};return Object.setPrototypeOf(i,t.prototype),i.domain=e,i.range=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.withDomain=function(e,t){return this.domain.withDomain(e,t).overRange(this.range)},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"Tweening("+this.domain+", "+this.range+")"},t}(g),q=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1]-t;return 0!==r?(e-t)/r:0};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"inverse",{get(){return V(this[0],this[1])},configurable:!0}),t.prototype.contains=function(e){return this[0]<=e&&e<=this[1]},t.prototype.interpolateTo=function(e){return e instanceof t?I(this,e):null},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this[0]===e[0]&&this[1]===e[1])},t.prototype.toString=function(){return"LinearDomain("+this[0]+", "+this[1]+")"},t}(y),I=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=t[0],n=t[1],s=i[1],o=s[0],a=s[1];return q(r+e*(o-r),n+e*(a-n))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(x),V=function(e){const t=function(e,r){const i=function(e){const t=i[0];return t+e*(i[1]-t)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"inverse",{get(){return q(this[0],this[1])},configurable:!0}),t.prototype.interpolateTo=function(e){return e instanceof t?N(this,e):null},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this[0]===e[0]&&this[1]===e[1])},t.prototype.toString=function(){return"LinearRange("+this[0]+", "+this[1]+")"},t}(b),N=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=t[0],n=t[1],s=i[1],o=s[0],a=s[1];return V(r+e*(o-r),n+e*(a-n))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(x),z=function(e){const t=function(e,r){const i=function(e){return i.range(i.domain(e))};return Object.setPrototypeOf(i,t.prototype),i.domain=e,i.range=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"inverse",{get(){return t(this.range.inverse,this.domain.inverse)},configurable:!0}),t.prototype.withDomain=function(e,r){let i;return i=1===arguments.length?e:q(e,r),t(i,this.range)},t.prototype.overRange=function(e,r){let i;return i=1===arguments.length?e:V(e,r),t(this.domain,i)},t.prototype.clampDomain=function(e,r,i,n,s){void 0===s&&(s=o.Epsilon);let a=this.domain[0],u=this.domain[1];void 0!==e&&void 0!==r&&Math.abs(u-a)>r-e?a<u?(a=e,u=r):(u=e,a=r):(void 0!==e&&(a<u&&a<e?(u+=e-a,a=e):u<a&&u<e&&(a+=e-u,u=e)),void 0!==r&&(a<u&&u>r?(a-=u-r,u=r):u<a&&a>r&&(u-=a-r,a=r)));const h=this(a),l=this(u),c=h<l?l-h:h-l,d=Math.abs(c/(u-a));if(void 0!==i&&d<1/i){const e=c*i,t=a+u;a=(t-e)/2,u=(t+e)/2}else if(void 0!==n&&d>1/n){const e=c*n,t=a+u;a=(t-e)/2,u=(t+e)/2}return Math.abs(a-this.domain[0])<s&&Math.abs(u-this.domain[1])<s?this:t(q(a,u),this.range)},t.prototype.solveDomain=function(e,r,i,n,s,a){void 0===a&&(a=o.Epsilon);const u=this.domain[1]-this.domain[0],h=this.range[0],l=this.range[1];let c;void 0===i||void 0===n||Math.abs(i-e)<a||Math.abs(n-r)<a?c=(l-h)/(0!==u?u:a):(c=(n-r)/(i-e),void 0!==s&&s||c<0==(l-h)/u<0||(c=-c));const d=r-c*e,p=(h-d)/c,f=(l-d)/c;return Math.abs(p-this.domain[0])<a&&Math.abs(f-this.domain[1])<a?this:t(q(p,f),this.range)},t.prototype.interpolateTo=function(e){return e instanceof t?M(this,e):null},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"LinearScale("+this.domain+", "+this.range+")"},t}(function(e){const t=function(){throw new Error};return(t.prototype=Object.create(e.prototype)).constructor=t,t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"ContinuousScale("+this.domain+", "+this.range+")"},t}(function(e){const t=function(){throw new Error};return(t.prototype=Object.create(e.prototype)).constructor=t,t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"Scale("+this.domain+", "+this.range+")"},t}(g))),M=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=t.domain,s=n[0],o=n[1],a=r.domain,u=a[0],h=a[1],l=q(s+e*(u-s),o+e*(h-o)),c=t.range,d=c[0],p=c[1],f=r.range,w=f[0],m=f[1],g=V(d+e*(w-d),p+e*(m-p));return z(l,g)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(x);class j{set(e){throw new Error("immutable")}delete(){throw new Error("immutable")}static empty(){return new L}static unary(e){return new F(e)}static array(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.length),new B(e,t,r)}}e([n],j,"empty",null);class L extends j{isEmpty(){return!0}head(){throw new Error("empty")}step(){throw new Error("empty")}skip(e){}hasNext(){return!1}nextIndex(){return 0}next(){return{done:!0}}hasPrevious(){return!1}previousIndex(){return-1}previous(){return{done:!0}}}class F extends j{constructor(e){super(),this.value=e,this.index=0}isEmpty(){return 0!==this.index}head(){if(0===this.index)return this.value;throw new Error("empty")}step(){if(0!==this.index)throw new Error("empty");this.index=1}skip(e){this.index=Math.min(Math.max(0,this.index+e),1)}hasNext(){return 0===this.index}nextIndex(){return this.index}next(){return 0===this.index?(this.index=1,{value:this.value,done:!0}):{done:!0}}hasPrevious(){return 1===this.index}previousIndex(){return this.index-1}previous(){return 1===this.index?(this.index=0,{value:this.value,done:!0}):{done:!0}}}class B extends j{constructor(e,t,r){super(),this.array=e,this.index=t,this.limit=r}isEmpty(){return this.index>=this.limit}head(){if(this.index<this.limit)return this.array[this.index];throw new Error("empty")}step(){if(!(this.index<this.limit))throw new Error("empty");this.index+=1}skip(e){this.index=Math.min(this.index+e,this.limit)}hasNext(){return this.index<this.limit}nextIndex(){return this.index}next(){const e=this.index;return e<this.limit?(this.index+=1,{value:this.array[e],done:this.index===this.limit}):(this.index=this.limit,{done:!0})}hasPrevious(){return this.index>0}previousIndex(){return this.index-1}previous(){const e=this.index-1;return e>=0?(this.index=e,{value:this.array[e],done:0===e}):(this.index=0,{done:!0})}}class U{constructor(e){this.buckets=new Array(e),this.gen4Hits=0,this.gen3Hits=0,this.gen2Hits=0,this.gen1Hits=0,this.misses=0}get(e){if(0===this.buckets.length)return;const t=Math.abs(w.hash(e))%this.buckets.length,r=this.buckets[t];if(void 0===r)return;const i=r.gen4Key;if(void 0!==i&&w.equal(e,i)){const e=r.gen4Val;if(void 0!==e)return this.gen4Hits+=1,r.gen4Weight++,e;r.gen4Key=void 0}const n=r.gen3Key;if(void 0!==n&&w.equal(e,n)){const e=r.gen3Val;if(void 0!==e)return this.gen3Hits+=1,r.gen3Weight++>r.gen4Weight&&(this.buckets[t]=new W(r.gen3Key,r.gen3Val,r.gen3Weight,r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight)),e;r.gen3Key=void 0}const s=r.gen2Key;if(void 0!==s&&w.equal(e,s)){const e=r.gen2Val;if(void 0!==e)return this.gen2Hits+=1,r.gen2Weight++>r.gen3Weight&&(this.buckets[t]=new W(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight)),e;r.gen2Key=void 0}const o=r.gen1Key;if(void 0!==o&&w.equal(e,o)){const e=r.gen1Val;if(void 0!==e)return this.gen1Hits+=1,r.gen1Weight++>r.gen2Weight&&(this.buckets[t]=new W(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight,r.gen2Key,r.gen2Val,r.gen2Weight)),e;r.gen1Key=void 0}this.misses+=1}put(e,t){if(0===this.buckets.length)return t;const r=Math.abs(w.hash(e))%this.buckets.length,i=this.buckets[r]||new W;let n=i.gen4Key;if(void 0!==n&&w.equal(e,n)){const e=i.gen4Val;if(void 0!==e)return this.gen4Hits+=1,i.gen4Weight++,e;i.gen4Key=void 0,n=void 0}let s=i.gen3Key;if(void 0!==s&&w.equal(e,s)){const e=i.gen3Val;if(void 0!==e)return this.gen3Hits+=1,i.gen3Weight++>i.gen4Weight&&(this.buckets[r]=new W(i.gen3Key,i.gen3Val,i.gen3Weight,i.gen4Key,i.gen4Val,i.gen4Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen1Key,i.gen1Val,i.gen1Weight)),e;i.gen3Key=void 0,s=void 0}let o=i.gen2Key;if(void 0!==o&&w.equal(e,o)){const e=i.gen2Val;if(void 0!==e)return this.gen2Hits+=1,i.gen2Weight++>i.gen3Weight&&(this.buckets[r]=new W(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen1Key,i.gen1Val,i.gen1Weight)),e;i.gen2Key=void 0,o=void 0}let a=i.gen1Key;if(void 0!==a&&w.equal(e,a)){const e=i.gen1Val;if(void 0!==e)return this.gen1Hits+=1,i.gen1Weight++>i.gen2Weight&&(this.buckets[r]=new W(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen1Key,i.gen1Val,i.gen1Weight,i.gen2Key,i.gen2Val,i.gen2Weight)),e;i.gen1Key=void 0,a=void 0}return this.misses+=1,this.buckets[r]=void 0===n?new W(i.gen3Key,i.gen3Val,i.gen3Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen1Key,i.gen1Val,i.gen1Weight,e,t,1):void 0===s?new W(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen1Key,i.gen1Val,i.gen1Weight,e,t,1):void 0===o?new W(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen1Key,i.gen1Val,i.gen1Weight,e,t,1):void 0===a?new W(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen2Key,i.gen2Val,i.gen2Weight,e,t,1):new W(i.gen4Key,i.gen4Val,i.gen4Weight-1,i.gen3Key,i.gen3Val,i.gen3Weight-1,i.gen1Key,i.gen1Val,i.gen1Weight,e,t,1),t}remove(e){if(0===this.buckets.length)return;const t=Math.abs(w.hash(e))%this.buckets.length,r=this.buckets[t];if(void 0===r)return;const i=r.gen4Key;if(void 0!==i&&w.equal(e,i)){const e=r.gen4Val;return this.buckets[t]=new W(r.gen3Key,r.gen3Val,r.gen3Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight,void 0,void 0,0),e}const n=r.gen3Key;if(void 0!==n&&w.equal(e,n)){const e=r.gen3Val;return this.buckets[t]=new W(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight,void 0,void 0,0),e}const s=r.gen2Key;if(void 0!==s&&w.equal(e,s)){const e=r.gen2Val;return this.buckets[t]=new W(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight,void 0,void 0,0),e}const o=r.gen1Key;if(void 0!==o&&w.equal(e,o)){const e=r.gen1Val;return this.buckets[t]=new W(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen2Key,r.gen2Val,r.gen2Weight,void 0,void 0,0),e}}clear(){for(let e=0;e<this.buckets.length;e+=1)this.buckets[e]=void 0}hits(){return this.gen4Hits+this.gen3Hits+this.gen2Hits+this.gen1Hits}hitRatio(){const e=this.hits();return e/(e+this.misses)}}class W{constructor(e,t,r=0,i,n,s=0,o,a,u=0,h,l,c=0){this.gen4Key=e,this.gen4Val=t,this.gen4Weight=r,this.gen3Key=i,this.gen3Val=n,this.gen3Weight=s,this.gen2Key=o,this.gen2Val=a,this.gen2Weight=u,this.gen1Key=h,this.gen1Val=l,this.gen1Weight=c}}class R{constructor(e){this.buckets=new Array(e),this.gen4Hits=0,this.gen3Hits=0,this.gen2Hits=0,this.gen1Hits=0,this.misses=0}put(e){if(0===this.buckets.length)return e;const t=Math.abs(w.hash(e))%this.buckets.length,r=this.buckets[t]||new H,i=r.gen4Val;if(void 0!==i&&w.equal(e,i))return this.gen4Hits+=1,r.gen4Weight++,i;const n=r.gen3Val;if(void 0!==n&&w.equal(e,n))return this.gen3Hits+=1,r.gen3Weight++>r.gen4Weight&&(this.buckets[t]=new H(r.gen3Val,r.gen3Weight,r.gen4Val,r.gen4Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight)),n;const s=r.gen2Val;if(void 0!==s&&w.equal(e,s))return this.gen2Hits+=1,r.gen2Weight++>r.gen3Weight&&(this.buckets[t]=new H(r.gen4Val,r.gen4Weight,r.gen2Val,r.gen2Weight,r.gen3Val,r.gen3Weight,r.gen1Val,r.gen1Weight)),s;const o=r.gen1Val;return void 0!==o&&w.equal(e,o)?(this.gen1Hits+=1,r.gen1Weight++>r.gen2Weight&&(this.buckets[t]=new H(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen1Val,r.gen1Weight,r.gen2Val,r.gen2Weight)),o):(this.misses+=1,this.buckets[t]=void 0===i?new H(r.gen3Val,r.gen3Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight,e,1):void 0===n?new H(r.gen4Val,r.gen4Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight,e,1):void 0===s?new H(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen1Val,r.gen1Weight,e,1):void 0===o?new H(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen2Val,r.gen2Weight,e,1):new H(r.gen4Val,r.gen4Weight-1,r.gen3Val,r.gen3Weight-1,r.gen1Val,r.gen1Weight,e,1),e)}remove(e){if(0===this.buckets.length)return!1;const t=Math.abs(w.hash(e))%this.buckets.length,r=this.buckets[t];if(void 0===r)return!1;const i=r.gen4Val;if(void 0!==i&&w.equal(e,i))return this.buckets[t]=new H(r.gen3Val,r.gen3Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight,void 0,0),!0;const n=r.gen3Val;if(void 0!==n&&w.equal(e,n))return this.buckets[t]=new H(r.gen4Val,r.gen4Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight,void 0,0),!0;const s=r.gen2Val;if(void 0!==s&&w.equal(e,s))return this.buckets[t]=new H(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen1Val,r.gen1Weight,void 0,0),!0;const o=r.gen1Val;return!(void 0===o||!w.equal(e,o))&&(this.buckets[t]=new H(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen2Val,r.gen2Weight,void 0,0),!0)}clear(){for(let e=0;e<this.buckets.length;e+=1)this.buckets[e]=void 0}get hits(){return this.gen4Hits+this.gen3Hits+this.gen2Hits+this.gen1Hits}get hitRatio(){const e=this.hits;return e/(e+this.misses)}}class H{constructor(e,t=0,r,i=0,n,s=0,o,a=0){this.gen4Val=e,this.gen4Weight=t,this.gen3Val=r,this.gen3Weight=i,this.gen2Val=n,this.gen2Weight=s,this.gen1Val=o,this.gen1Weight=a}}class K{constructor(e,t){this.level=e,this.label=t}isTrace(){return this.level===K.TRACE_LEVEL}isDebug(){return this.level===K.DEBUG_LEVEL}isInfo(){return this.level===K.INFO_LEVEL}isNote(){return this.level===K.NOTE_LEVEL}isWarning(){return this.level===K.WARNING_LEVEL}isError(){return this.level===K.ERROR_LEVEL}isAlert(){return this.level===K.ALERT_LEVEL}isFatal(){return this.level===K.FATAL_LEVEL}compareTo(e){return this===e?0:e instanceof K?this.level<e.level?-1:this.level>e.level?1:this.label.localeCompare(e.label):NaN}equals(e){return this===e||e instanceof K&&(this.level===e.level&&this.label===e.label)}hashCode(){return i.mash(i.mix(i.mix(l.hash(K),a.hash(this.level)),u.hash(this.label)))}toString(){return this.label}static create(e,t){switch(e){case K.TRACE_LEVEL:return K.trace(t);case K.DEBUG_LEVEL:return K.debug(t);case K.INFO_LEVEL:return K.info(t);case K.NOTE_LEVEL:return K.note(t);case K.WARNING_LEVEL:return K.warning(t);case K.ERROR_LEVEL:return K.error(t);case K.ALERT_LEVEL:return K.alert(t);case K.FATAL_LEVEL:return K.fatal(t);default:throw new Error(""+e)}}static trace(e="trace"){return"trace"===e?(void 0===K._trace&&(K._trace=new K(K.TRACE_LEVEL,e)),K._trace):new K(K.TRACE_LEVEL,e)}static debug(e="debug"){return"debug"===e?(void 0===K._debug&&(K._debug=new K(K.DEBUG_LEVEL,e)),K._debug):new K(K.DEBUG_LEVEL,e)}static info(e="info"){return"info"===e?(void 0===K._info&&(K._info=new K(K.INFO_LEVEL,e)),K._info):new K(K.INFO_LEVEL,e)}static note(e="note"){return"note"===e?(void 0===K._note&&(K._note=new K(K.NOTE_LEVEL,e)),K._note):new K(K.NOTE_LEVEL,e)}static warning(e="warning"){return"warning"===e?(void 0===K._warning&&(K._warning=new K(K.WARNING_LEVEL,e)),K._warning):new K(K.WARNING_LEVEL,e)}static error(e="error"){return"error"===e?(void 0===K._error&&(K._error=new K(K.ERROR_LEVEL,e)),K._error):new K(K.ERROR_LEVEL,e)}static alert(e="alert"){return"alert"===e?(void 0===K._alert&&(K._alert=new K(K.ALERT_LEVEL,e)),K._alert):new K(K.ALERT_LEVEL,e)}static fatal(e="fatal"){return"fatal"===e?(void 0===K._fatal&&(K._fatal=new K(K.FATAL_LEVEL,e)),K._fatal):new K(K.FATAL_LEVEL,e)}}K.TRACE_LEVEL=0,K.DEBUG_LEVEL=1,K.INFO_LEVEL=2,K.NOTE_LEVEL=3,K.WARNING_LEVEL=4,K.ERROR_LEVEL=5,K.ALERT_LEVEL=6,K.FATAL_LEVEL=7;class _{}class G extends _{constructor(e,t,r,i){super(),this.offset=e,this.line=t,this.column=r,this.note=i}withNote(e){return this.note!==e?G.at(this.offset,this.line,this.column,e):this}min(e){return this.offset<=e.offset?this:e}max(e){return this.offset>=e.offset?this:e}get start(){return this}get end(){return this}union(e){if(e instanceof G)return this.offset===e.offset&&this.line===e.line&&this.column===e.column?this:Q.from(this,e);if(e instanceof Q){const t=this.min(e.start),r=this.max(e.end);return t===e.start&&r===e.end?e:Q.from(t,r)}throw new Error(e.toString())}shift(e){const t=this.offset+(this.offset-e.offset),r=this.line+(this.line-e.line);let i=this.column;return 1===r&&(i+=this.column-e.column),t===this.offset&&r===this.line&&i===this.column?this:G.at(t,r,i,this.note)}equals(e){return this===e||e instanceof G&&(this.offset===e.offset&&this.line===e.line&&this.column===e.column&&this.note===e.note)}hashCode(){return i.mash(i.mix(i.mix(i.mix(i.mix(l.hash(G),a.hash(this.offset)),a.hash(this.line)),a.hash(this.column)),u.hash(this.note)))}display(e){return e=(e=he.displayNumber(e,this.line)).write(58),e=he.displayNumber(e,this.column),void 0!==this.note&&(e=e.write(58).write(32).write(this.note)),e}debug(e){return e=e.write("Mark").write(".").write("at").write("("),e=(e=he.debugNumber(e,this.offset)).write(", "),e=(e=he.debugNumber(e,this.line)).write(", "),e=he.debugNumber(e,this.column),void 0!==this.note&&(e=e.write(", "),e=he.debugString(e,this.note)),e=e.write(")")}toString(){return he.display(this)}static get zero(){return new G(0,1,1,void 0)}static at(e,t,r,i){return new G(e,t,r,i)}}e([n],G,"zero",null);class Q extends _{constructor(e,t){super(),this.start=e,this.end=t}union(e){if(e instanceof G){const t=this.start.min(e),r=this.end.max(e);return t===this.start&&r===this.end?this:Q.from(t,r)}if(e instanceof Q){const t=this.start.min(e.start),r=this.end.max(e.end);return t===this.start&&r===this.end?this:Q.from(t,r)}throw new Error(e.toString())}shift(e){const t=this.start.shift(e),r=this.end.shift(e);return t===this.start&&r===this.end?this:Q.from(t,r)}equals(e){return this===e||e instanceof Q&&(this.start.equals(e.start)&&this.end.equals(e.end))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Q),this.start.hashCode()),this.end.hashCode()))}display(e){return void 0!==this.start.note&&(e=e.write(this.start.note).write(58).write(32)),e=(e=he.displayNumber(e,this.start.line)).write(58),e=(e=he.displayNumber(e,this.start.column)).write(45),e=(e=he.displayNumber(e,this.end.line)).write(58),e=he.displayNumber(e,this.end.column),void 0!==this.end.note&&(e=e.write(58).write(32).write(this.end.note)),e}debug(e){return e=e.write("Span").write(".").write("from").write("("),e=(e=this.start.debug(e)).write(", "),e=(e=this.end.debug(e)).write(")")}toString(){return he.display(this)}static from(e,t){if(e.offset>t.offset){const r=e;e=t,t=r}return new Q(e,t)}}const Z=function(){const e={reset:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(109)),e},bold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(109)),e},faint:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(50).write(109)),e},black:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(48).write(109)),e},red:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(49).write(109)),e},green:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(50).write(109)),e},yellow:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(51).write(109)),e},blue:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(52).write(109)),e},magenta:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(53).write(109)),e},cyan:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(54).write(109)),e},gray:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(55).write(109)),e},blackBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(48).write(109)),e},redBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(49).write(109)),e},greenBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(50).write(109)),e},yellowBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(51).write(109)),e},blueBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(52).write(109)),e},magentaBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(53).write(109)),e},cyanBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(54).write(109)),e},grayBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(55).write(109)),e}};return e}();class X{constructor(e,t,r,i){Object.defineProperty(this,"lineSeparator",{value:e,enumerable:!0}),Object.defineProperty(this,"pretty",{value:t,enumerable:!0}),Object.defineProperty(this,"styled",{value:r,enumerable:!0}),Object.defineProperty(this,"precision",{value:i,enumerable:!0})}withLineSeparator(e){return this.copy(e,this.pretty,this.styled,this.precision)}isPretty(){return this.pretty}asPretty(e){return this.copy(this.lineSeparator,e,this.styled,this.precision)}isStyled(){return this.styled}asStyled(e){return this.copy(this.lineSeparator,this.pretty,e,this.precision)}withPrecision(e){return this.copy(this.lineSeparator,this.pretty,this.styled,e)}copy(e,t,r,i){return X.create(e,t,r,i)}canEqual(e){return e instanceof X}equals(e){return this===e||e instanceof X&&(e.canEqual(this)&&this.lineSeparator===e.lineSeparator&&this.pretty===e.pretty&&this.styled===e.styled&&this.precision===e.precision)}hashCode(){return i.mash(i.mix(i.mix(i.mix(i.mix(l.hash(X),u.hash(this.lineSeparator)),s.hash(this.pretty)),s.hash(this.styled)),a.hash(this.precision)))}debug(e){return e=e.write("OutputSettings").write(46),e=(e=this.pretty||this.styled?this.pretty&&!this.styled?e.write("pretty"):!this.pretty&&this.styled?e.write("styled"):e.write("prettyStyled"):e.write("standard")).write(40).write(41),this.lineSeparator!==he.lineSeparator&&(e=e.write(46).write("lineSeparator").write(40).display(this.lineSeparator).write(41)),-1!==this.precision&&(e=e.write(46).write("precision").write(40).display(this.precision).write(41)),e}toString(){return he.debug(this)}static standard(){return new X(he.lineSeparator,!1,!1,-1)}static pretty(){return new X(he.lineSeparator,!0,!1,-1)}static styled(){return new X(he.lineSeparator,!1,!0,-1)}static prettyStyled(){return new X(he.lineSeparator,!0,!0,-1)}static create(e,t,r,i){return"string"!=typeof e&&(e=he.lineSeparator),"boolean"!=typeof t&&(t=!1),"boolean"!=typeof r&&(r=!1),"number"!=typeof i&&(i=-1),e===he.lineSeparator&&-1===i?t||r?t&&!r?X.pretty():!t&&r?X.styled():X.prettyStyled():X.standard():new X(e,t,r,i)}static fromInit(e){return X.create(e.lineSeparator,e.isPretty,e.isStyled,e.precision)}static fromAny(e){return e instanceof X?e:"object"==typeof e&&null!==e?X.fromInit(e):X.standard()}}e([n],X,"standard",null),e([n],X,"pretty",null),e([n],X,"styled",null),e([n],X,"prettyStyled",null);class $ extends Error{constructor(e){super(e),Object.setPrototypeOf(this,$.prototype)}}class Y{constructor(e){Object.defineProperty(this,"stripped",{value:e,enumerable:!0})}isStripped(){return this.stripped}asStripped(e){return this.copy(e)}copy(e){return Y.create(e)}canEqual(e){return e instanceof Y}equals(e){return this===e||e instanceof Y&&(e.canEqual(this)&&this.stripped===e.stripped)}hashCode(){return i.mash(i.mix(l.hash(Y),s.hash(this.stripped)))}debug(e){return e=e.write("InputSettings").write(46),e=(e=this.stripped?e.write("stripped"):e.write("standard")).write(40).write(41)}toString(){return he.debug(this)}static standard(){return new Y(!1)}static stripped(){return new Y(!0)}static create(e){return e?Y.stripped():Y.standard()}static fromAny(e){return e instanceof Y?e:"object"==typeof e&&null!==e?Y.create(e.isStripped):Y.standard()}}e([n],Y,"standard",null),e([n],Y,"stripped",null);class J{trap(){throw new $}static empty(){return new de(void 0,G.zero,Y.standard())}static done(){return new pe(void 0,G.zero,Y.standard())}static error(e){return new ee(e,void 0,G.zero,Y.standard())}}e([n],J,"empty",null),e([n],J,"done",null);class ee extends J{constructor(e,t,r,i){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0}),Object.defineProperty(this,"id",{value:t,enumerable:!0}),Object.defineProperty(this,"mark",{value:r,enumerable:!0}),Object.defineProperty(this,"settings",{value:i,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(e){return this}head(){throw new $}step(){const e=new $("error step");return new ee(e,this.id,this.mark,this.settings)}trap(){return this.error}seek(e){const t=new $("error seek");return new ee(t,this.id,this.mark,this.settings)}withId(e){return new ee(this.error,e,this.mark,this.settings)}withMark(e){return new ee(this.error,this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=Y.fromAny(e),new ee(this.error,this.id,this.mark,e)}clone(){return this}}class te extends J{constructor(e,t,r,i,n,s,o,a){super(),this.string=e,this.index=o,this.part=a,this.id=t,this.offset=r,this.line=i,this.column=n,this.settings=s}isCont(){return this.index<this.string.length}isEmpty(){return this.part&&this.index>=this.string.length}isDone(){return!this.part&&this.index>=this.string.length}isError(){return!1}isPart(){return this.part}asPart(e){return this.part=e,this}head(){const e=this.string,t=this.index;if(t<e.length){const r=e.codePointAt(t);return void 0!==r?r:e.charCodeAt(t)}throw new $}step(){const e=this.string,t=this.index;if(t<e.length){const r=e.codePointAt(t);return this.index=u.offsetByCodePoints(e,t,1),this.offset+=this.index-t,10===r?(this.line+=1,this.column=1):this.column+=1,this}{const e=new $("invalid step");return new ee(e,this.id,this.mark,this.settings)}}seek(e){if(void 0!==e){const t=this.index+(e.offset-this.offset);if(0<=t&&t<=this.string.length)return this.index=t,this.offset=e.offset,this.line=e.line,this.column=e.column,this;{const t=new $("invalid seek to "+e);return new ee(t,this.id,this.mark,this.settings)}}return this.index=0,this.offset=0,this.line=1,this.column=1,this}withId(e){return this.id=e,this}get mark(){return G.at(this.offset,this.line,this.column)}withMark(e){return this.offset=e.offset,this.line=e.line,this.column=e.column,this}withSettings(e){return e=Y.fromAny(e),this.settings=e,this}clone(){return new te(this.string,this.id,this.offset,this.line,this.column,this.settings,this.index,this.part)}static create(e){return new te(e,void 0,0,1,1,Y.standard(),0,!1)}}class re extends Error{constructor(e){super(e),Object.setPrototypeOf(this,re.prototype)}}class ie{writeln(e){return"string"==typeof e&&this.write(e),this.write(this.settings.lineSeparator)}display(e){return he.displayAny(this,e)}debug(e){return he.debugAny(this,e)}flush(){return this}push(...e){const t=e.length;for(let r=0;r<t;r+=1)this.write(e[r])}trap(){throw new re}clone(){throw new Error}static full(){return new ye(X.standard())}static done(){return new be(X.standard())}static error(e){return new ve(e,X.standard())}}e([n],ie,"full",null),e([n],ie,"done",null);class ne extends ie{constructor(e,t){super(),this.string=e,this.settings=t}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(e){return this}write(e){if("number"==typeof e)if(e>=0&&e<=55295||e>=57344&&e<=65535)e=String.fromCharCode(e);else if(e>=65536&&e<=1114111){const t=e-65536;e=String.fromCharCode(55296|t>>>10,56320|1023&t)}else e="�";return this.string+=e,this}writeln(e){return void 0!==e&&(this.string=this.string.concat(e)),this.string=this.string.concat(this.settings.lineSeparator),this}withSettings(e){return e=X.fromAny(e),this.settings=e,this}bind(){return this.string}clone(){return new ne(this.string,this.settings)}toString(){return this.string}}class se extends Error{constructor(e){super(e),Object.setPrototypeOf(this,se.prototype)}}class oe{isCont(){return!0}isDone(){return!1}isError(){return!1}feed(e){throw new se}fork(e){return this}bind(){throw new se}trap(){throw new se}asDone(){throw new se}asError(){throw new se}andThen(e){return new Ie(this,e)}static end(){return new Pe}static done(e){return new De(e)}static error(e){return new qe(e)}}e([n],oe,"end",null);class ae extends oe{constructor(e,t,r=0){super(),this.value=e,this.input=t,this.index=r}feed(e){return new ae(e,""+e)}pull(e){return ae.write(e,this.value,this.input,this.index)}static write(e,t,r,i=0){const n=r.length;for(;i<n&&e.isCont();){let t=r.codePointAt(i);void 0===t&&(t=r.charCodeAt(i)),e=e.write(t),i=u.offsetByCodePoints(r,i,1)}return i===n?oe.done(t):e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new ae(t,r,i)}}const ue=function(){const e={stringInput:function(e){return te.create(e)},stringOutput:function(e,t){return void 0===t&&"string"!=typeof e?(t=e,e=""):"string"!=typeof e&&(e=""),t=X.fromAny(t),new ne(e,t)},stringWriter:function(e){return void 0===e?new ae(void 0,""):new ae(e,""+e)},writeString:function(e,t){return ae.write(e,void 0,""+t)},isAlpha:function(e){return e>=65&&e<=90||e>=97&&e<=122},isDigit:function(e){return e>=48&&e<=57},isSpace:function(e){return 32===e||9===e},isNewline:function(e){return 10===e||13===e},isWhitespace:function(t){return e.isSpace(t)||e.isNewline(t)}};return e}(),he=function(){const e={};return Object.defineProperty(e,"lineSeparator",{value:"\\n",enumerable:!0,configurable:!0}),e.display=function(e,t){if(void 0===e)return"undefined";if(null===e)return"null";if("number"==typeof e)return""+e;if("string"==typeof e)return e;if("function"==typeof e.display){let r=ue.stringOutput(t);return r=e.display(r),r.bind()}return""+e},e.debug=function(t,r){if(void 0===t)return"undefined";if(null===t)return"null";if("number"==typeof t)return""+t;if("string"==typeof t){let i=ue.stringOutput(r);return i=e.debugString(i,t),i.bind()}if("function"==typeof t.debug){let e=ue.stringOutput(r);return e=t.debug(e),e.bind()}return""+t},e.displayAny=function(t,r){return t=void 0===r?t.write("undefined"):null===r?t.write("null"):"number"==typeof r?e.displayNumber(t,r):"string"==typeof r?t.write(r):"function"==typeof r.display?r.display(t):t.write(""+r)},e.debugAny=function(t,r){return t=void 0===r?t.write("undefined"):null===r?t.write("null"):"number"==typeof r?e.debugNumber(t,r):"string"==typeof r?e.debugString(t,r):"function"==typeof r.debug?r.debug(t):t.write(""+r)},e.displayNumber=function(t,r){if(isFinite(r)&&Math.floor(r)===r&&Math.abs(r)<2147483648)if(r<0&&(t=t.write(45)),r>-10&&r<10)t=t.write(48+Math.abs(r));else{const e=new Array(19);let i=r,n=18;for(;0!==i;)e[n]=Math.abs(i%10|0),i=i/10|0,n-=1;for(n+=1;n<19;)t=t.write(48+e[n]),n+=1}else t=t.write(e.decimal(r,t.settings.precision));return t},e.debugNumber=function(t,r){return e.displayNumber(t,r)},e.debugChar=function(t,r){switch(t=t.write(39),r){case 8:t.write(92).write(98);break;case 9:t.write(92).write(116);break;case 10:t.write(92).write(110);break;case 12:t.write(92).write(102);break;case 13:t.write(92).write(114);break;case 34:t.write(92).write(34);break;case 39:t.write(92).write(39);break;case 92:t.write(92).write(92);break;default:t=r>=0&&r<=31||r>=127&&r<=159?t.write(92).write(117).write(e.encodeHex(r>>>12&15)).write(e.encodeHex(r>>>8&15)).write(e.encodeHex(r>>>4&15)).write(e.encodeHex(15&r)):t.write(r)}return t=t.write(39)},e.debugString=function(t,r){t=t.write(34);let i=ue.stringInput(r);for(;i.isCont();){const r=i.head();switch(r){case 8:t.write(92).write(98);break;case 9:t.write(92).write(116);break;case 10:t.write(92).write(110);break;case 12:t.write(92).write(102);break;case 13:t.write(92).write(114);break;case 34:t.write(92).write(34);break;case 92:t.write(92).write(92);break;default:t=r>=0&&r<=31||r>=127&&r<=159?t.write(92).write(117).write(e.encodeHex(r>>>12&15)).write(e.encodeHex(r>>>8&15)).write(e.encodeHex(r>>>4&15)).write(e.encodeHex(15&r)):t.write(r)}i=i.step()}return t=t.write(34)},e.encodeHex=function(e){return e<10?48+e:e-10+65},e.prefix=function(){const t=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E"," Z","Y"];return function(r,i=1){if(isFinite(r)){const n=Math.abs(r).toExponential(),s=n.indexOf("e"),o=s>=0?+n.slice(s+1):NaN,a=3*Math.min(Math.max(-8,Math.floor(o/3)),8),u=Math.pow(10,-a)*r;let h=e.trimTrailingZeros(Math.abs(u).toFixed(i));return u<0&&0!=+h&&(h="-"+h),h+=t[8+a/3],h}return""+r}}(),e.decimal=function(t,r=-1){if(r>=0){let i=e.trimTrailingZeros(Math.abs(t).toFixed(r));return t<0&&0!=+i&&(i="-"+i),i}return""+t},e.trimTrailingZeros=function(e){let t,r=-1;for(let i=1,n=e.length;i<n;i+=1){const n=e.charCodeAt(i);if(46===n)r=i,t=i;else if(48===n)0===r&&(r=i),t=i;else if(n>=49&&n<=57)r>0&&(r=0);else if(r>0)break}return r>0&&(e=e.slice(0,r)+e.slice(t+1)),e},e.duration=function(e,t=" "){if(isFinite(e)){const r=1e3,i=60*r,n=60*i,s=24*n,o=7*s;let a,u,h,l,c;e>o&&(a=Math.floor(e/o),e%=o),e>s&&(u=Math.floor(e/s),e%=s),e>n&&(h=Math.floor(e/n),e%=n),e>i&&(l=Math.floor(e/i),e%=i),e>r&&(c=Math.floor(e/r),e%=r);let d="";return void 0!==a&&(d+=a+"w"),void 0!==u&&(d+=(0!==d.length?t:"")+u+"d"),void 0!==h&&(d+=(0!==d.length?t:"")+h+"h"),void 0!==l&&(d+=(0!==d.length?t:"")+l+"m"),void 0===c&&0!==e||(d+=(0!==d.length?t:"")+(void 0!==c?c:0)+"s"),0!==e&&0===d.length&&(d+=e+"ms"),d}return""+e},e}(),le=function(){const e={isDigit:function(e){return e>=48&&e<=57},decodeDigit:function(e){if(e>=48&&e<=57)return e-48;{let t=ue.stringOutput();throw t=t.write("Invalid base-10 digit: "),t=he.debugChar(t,e),new Error(t.bind())}},encodeDigit:function(e){if(e>=0&&e<=9)return 48+e;throw new Error(""+e)},countDigits:function(e){let t=0;do{t+=1,e=e/10|0}while(0!==e);return t},integerParser:function(){return new He(void 0,void 0,0)},parseInteger:function(e){return He.parse(e,void 0,void 0,0)},decimalParser:function(){return new He(void 0,void 0,1)},parseDecimal:function(e){return He.parse(e,void 0,void 0,1)},numberParser:function(){return new He},parseNumber:function(e){return He.parse(e)},integerWriter:function(e){return new _e(void 0,void 0===e?0:e)},writeInteger:function(e,t){return _e.write(e,void 0,t)}};return e}();class ce{constructor(e,t,r,i,n,s){this.input=e,this.tag=t,this.severity=r,this.message=i,this.note=n,this.cause=s}lineDigits(){let e=le.countDigits(this.tag.end.line);return null!==this.cause&&(e=Math.max(e,this.cause.lineDigits())),e}display(e){const t=this.input.clone(),r=this.tag.start,i=this.tag.end,n=this.severity,s=this.message,o=this.note,a=this.cause,u=this.lineDigits();return e=ce.display(e,t,r,i,n,s,o,a,2,u)}static display(e,t,r,i,n,s,o,a,u,h){for(;;){void 0!==s&&(e=(e=ce.displayMessage(e,n,s)).writeln()),e=(e=ce.displayAnchor(e,t,r,h)).writeln();const l=ce.displayContext(e,t,r,i,n,o,a,u,h),c=l[0];if(e=l[1],null===c)break;e=e.writeln(),t=c.input.clone(),r=c.tag.start,i=c.tag.end,n=c.severity,s=c.message,o=c.note,a=c.cause}return e}static displayMessage(e,t,r){return e=(e=ce.formatSeverity(e,t)).write(t.label),e=Z.reset(e),e=(e=Z.bold(e)).write(58),void 0!==r&&(e=e.write(32).write(r)),e=Z.reset(e)}static displayAnchor(e,t,r,i){e=(e=ce.displayLineLeadArrow(e,i)).write(32);const n=t.id;return void 0!==n&&(e=he.displayAny(e,n)),e=e.write(58),e=(e=he.displayNumber(e,r.line)).write(58),e=(e=he.displayNumber(e,r.column)).writeln(),e=ce.displayLineLead(e,i)}static displayContext(e,t,r,i,n,s,o,a,u){let h=o;const l=null!==o&&void 0===o.message&&w.equal(t.id,o.input.id)?r.offset<=o.tag.start.offset?-1:1:0;if(1===l){const t=ce.displayContext(e,o.input.clone(),o.tag.start,o.tag.end,o.severity,o.note,o.cause,a,u);h=t[0],e=(e=t[1]).writeln(),e=(e=ce.displayLineLeadEllipsis(e,u)).writeln()}if(e=ce.displayLines(e,t,r,i,n,a,u),void 0!==s&&(e=ce.displayNote(e,s,u)),-1===l){e=e.writeln(),e=(e=ce.displayLineLeadEllipsis(e,u)).writeln();const t=ce.displayContext(e,o.input.clone(),o.tag.start,o.tag.end,o.severity,o.note,o.cause,a,u);h=t[0],e=t[1]}return[h,e]}static displayLines(e,t,r,i,n,s,o){const a=r.line,u=i.line;let h=t.line;for(;h<a;)ce.consumeLineText(t,h),h+=1;if(u-a>2*s+2){for(;h<=a+s;)e=ce.displayLine(e,t,r,i,n,h,o),h+=1;for(e=(e=ce.displayLineLeadEllipsis(e,o)).write(32),e=(e=ce.formatSeverity(e,n)).write(124),e=(e=Z.reset(e)).writeln();h<u-s;)ce.consumeLineText(t,h),h+=1}for(;h<=u;)e=ce.displayLine(e,t,r,i,n,h,o),h+=1;return e}static displayNote(e,t,r){return e=e.writeln(),e=(e=ce.displayLineLead(e,r)).writeln(),e=ce.displayLineComment(e,"note",t,r)}static displayLine(e,t,r,i,n,s,o){return e=r.line===s&&i.line===s?ce.displaySingleLine(e,t,r,i,n,s,o):r.line===s?ce.displayStartLine(e,t,r,n,s,o):i.line===s?ce.displayEndLine(e,t,i,n,s,o):ce.displayMidLine(e,t,n,s,o)}static displaySingleLine(e,t,r,i,n,s,o){e=(e=ce.displayLineLeadNumber(e,s,o)).write(32);for(let r=1;r<t.column;r+=1)e=e.write(32);e=ce.displayLineText(e,t,s),e=(e=ce.displayLineLead(e,o)).write(32);let a=1;for(;a<r.column;)e=e.write(32),a+=1;for(e=ce.formatSeverity(e,n);a<=i.column;)e=e.write(94),a+=1;return void 0!==i.note&&(e=e.write(32).write(i.note)),e=Z.reset(e)}static displayStartLine(e,t,r,i,n,s){e=(e=ce.displayLineLeadNumber(e,n,s)).write(32).write(32).write(32);for(let r=1;r<t.column;r+=1)e=e.write(32);e=ce.displayLineText(e,t,n),e=(e=ce.displayLineLead(e,s)).write(32).write(32),e=(e=ce.formatSeverity(e,i)).write(95);let o=1;for(;o<r.column;)e=e.write(95),o+=1;return e=e.write(94),void 0!==r.note&&(e=e.write(32).write(r.note)),e=(e=Z.reset(e)).writeln()}static displayEndLine(e,t,r,i,n,s){e=(e=ce.displayLineLeadNumber(e,n,s)).write(32),e=(e=ce.formatSeverity(e,i)).write(124),e=(e=Z.reset(e)).write(32),e=ce.displayLineText(e,t,n),e=(e=ce.displayLineLead(e,s)).write(32),e=(e=ce.formatSeverity(e,i)).write(124).write(95);let o=1;for(;o<r.column;)e=e.write(95),o+=1;return e=e.write(94),void 0!==r.note&&(e=e.write(32).write(r.note)),e=Z.reset(e)}static displayMidLine(e,t,r,i,n){return e=(e=ce.displayLineLeadNumber(e,i,n)).write(32),e=(e=ce.formatSeverity(e,r)).write(124),e=(e=Z.reset(e)).write(32),e=ce.displayLineText(e,t,i)}static displayLineComment(e,t,r,i){return e=(e=ce.displayLineLeadComment(e,i)).write(32),e=(e=Z.bold(e)).write(t).write(58),e=Z.reset(e),void 0!==r&&(e=e.write(32).write(r)),e}static displayLineLead(e,t){e=Z.blueBold(e);const r=1+t;for(let t=0;t<r;t+=1)e=e.write(32);return e=e.write(124),e=Z.reset(e)}static displayLineLeadComment(e,t){e=Z.blueBold(e);const r=1+t;for(let t=0;t<r;t+=1)e=e.write(32);return e=e.write(61),e=Z.reset(e)}static displayLineLeadArrow(e,t){for(let r=0;r<t;r+=1)e=e.write(32);return e=(e=Z.blueBold(e)).write(45).write(45).write(62),e=Z.reset(e)}static displayLineLeadEllipsis(e,t){e=Z.blueBold(e);for(let r=0;r<t;r+=1)e=e.write(46);return e=(e=Z.reset(e)).write(32).write(32)}static displayLineLeadNumber(e,t,r){const i=r-le.countDigits(t);for(let t=0;t<i;t+=1)e=e.write(32);return e=Z.blueBold(e),e=(e=he.displayNumber(e,t)).write(32).write(124),e=Z.reset(e)}static displayLineText(e,t,r){for(;t.isCont()&&t.line===r;)e=e.write(t.head()),t=t.step();return t.line===r&&(e=e.writeln()),e}static consumeLineText(e,t){for(;e.isCont()&&e.line===t;)e=e.step()}static formatSeverity(e,t){switch(t.level){case K.FATAL_LEVEL:case K.ALERT_LEVEL:case K.ERROR_LEVEL:e=Z.redBold(e);break;case K.WARNING_LEVEL:e=Z.yellowBold(e);break;case K.NOTE_LEVEL:e=Z.greenBold(e);break;case K.INFO_LEVEL:e=Z.cyanBold(e);break;case K.DEBUG_LEVEL:case K.TRACE_LEVEL:default:e=Z.magentaBold(e)}return e}toString(e){return he.display(this,e)}static create(e,t,r,i,n,s){return 3===arguments.length?(s=null,n=void 0,i=void 0):4===arguments.length?null===i||i instanceof ce?(s=i,i=void 0):s=null:5===arguments.length?null===n||n instanceof ce?(s=n,n=void 0):s=null:void 0===s&&(s=null),new ce(e.clone(),t,r,i,n,s)}static message(e,t,r,i,n){2===arguments.length?(n=null,i=void 0,r=K.error()):3===arguments.length?null===r||r instanceof ce?(n=r,r=K.error()):"string"==typeof r?(n=null,i=r,r=K.error()):n=null:4===arguments.length?"string"==typeof r?(n=i,i=r,r=K.error()):null===i||i instanceof ce?(n=i,i=void 0):n=null:void 0===n&&(n=null);const s=t.mark,o=t.clone();return o.seek(),new ce(o,s,r,e,i,n)}static unexpected(e,t,r,i){let n;if(1===arguments.length?(i=null,t=K.error()):2===arguments.length?null===t||t instanceof ce?(i=t,t=K.error()):"string"==typeof t?(i=null,r=t,t=K.error()):i=null:3===arguments.length?"string"==typeof t?(i=r,r=t,t=K.error()):null===r||r instanceof ce?(i=r,r=void 0):i=null:void 0===i&&(i=null),e.isCont()){let t=ue.stringOutput().write("unexpected").write(32);t=he.debugChar(t,e.head()),n=t.bind()}else n="unexpected end of input";const s=e.mark,o=e.clone();return o.seek(),new ce(o,s,t,n,r,i)}static expected(e,t,r,i,n){2===arguments.length?(n=null,r=K.error()):3===arguments.length?null===r||r instanceof ce?(n=r,r=K.error()):"string"==typeof r?(n=null,i=r,r=K.error()):n=null:4===arguments.length?"string"==typeof r?(n=i,i=r,r=K.error()):null===i||i instanceof ce?(n=i,i=void 0):n=null:void 0===n&&(n=null);let s=ue.stringOutput().write("expected").write(32);s="number"==typeof e?he.debugChar(s,e):s.write(e),s=s.write(44).write(32).write("but found").write(32),s=t.isCont()?he.debugChar(s,t.head()):s.write("end of input");const o=s.bind(),a=t.mark,u=t.clone();return u.seek(),new ce(u,a,r,o,i,n)}}class de extends J{constructor(e,t,r){super(),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(e){return e?this:new pe(this.id,this.mark,this.settings)}head(){throw new $}step(){const e=new $("empty step");return new ee(e,this.id,this.mark,this.settings)}seek(e){const t=new $("empty seek");return new ee(t,this.id,this.mark,this.settings)}withId(e){return new de(e,this.mark,this.settings)}withMark(e){return new de(this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=Y.fromAny(e),new de(this.id,this.mark,e)}clone(){return this}}class pe extends J{constructor(e,t,r){super(),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(e){return e?new de(this.id,this.mark,this.settings):this}head(){throw new $}step(){const e=new $("done step");return new ee(e,this.id,this.mark,this.settings)}seek(e){const t=new $("empty seek");return new ee(t,this.id,this.mark,this.settings)}withId(e){return new pe(e,this.mark,this.settings)}withMark(e){return new pe(this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=Y.fromAny(e),new pe(this.id,this.mark,e)}clone(){return this}}class fe extends J{static empty(){return new we(void 0,G.zero,Y.standard())}static done(){return new me(void 0,G.zero,Y.standard())}static error(e){return new ge(e,void 0,G.zero,Y.standard())}}e([n],fe,"empty",null),e([n],fe,"done",null);class we extends fe{constructor(e,t,r){super(),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(e){return e?this:new me(this.id,this.mark,this.settings)}get index(){return 0}withIndex(e){if(0===e)return this;{const e=new $("invalid index");return new ge(e,this.id,this.mark,this.settings)}}get limit(){return 0}withLimit(e){if(0===e)return this;{const e=new $("invalid limit");return new ge(e,this.id,this.mark,this.settings)}}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new $}set(e,t){throw new $}head(){throw new $}step(e){const t=new $("empty step");return new ge(t,this.id,this.mark,this.settings)}seek(e){const t=new $("empty seek");return new ge(t,this.id,this.mark,this.settings)}withId(e){return new we(e,this.mark,this.settings)}withMark(e){return new we(this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=Y.fromAny(e),new we(this.id,this.mark,e)}clone(){return this}}class me extends fe{constructor(e,t,r){super(),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(e){return e?new we(this.id,this.mark,this.settings):this}get index(){return 0}withIndex(e){if(0===e)return this;{const e=new $("invalid index");return new ge(e,this.id,this.mark,this.settings)}}get limit(){return 0}withLimit(e){if(0===e)return this;{const e=new $("invalid limit");return new ge(e,this.id,this.mark,this.settings)}}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new $}set(e,t){throw new $}head(){throw new $}step(e){const t=new $("done step");return new ge(t,this.id,this.mark,this.settings)}seek(e){const t=new $("done seek");return new ge(t,this.id,this.mark,this.settings)}withId(e){return new me(e,this.mark,this.settings)}withMark(e){return new me(this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=Y.fromAny(e),new me(this.id,this.mark,e)}clone(){return this}}class ge extends fe{constructor(e,t,r,i){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0}),Object.defineProperty(this,"id",{value:t,enumerable:!0}),Object.defineProperty(this,"mark",{value:r,enumerable:!0}),Object.defineProperty(this,"settings",{value:i,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(e){return this}get index(){return 0}withIndex(e){if(0===e)return this;{const e=new $("invalid index");return new ge(e,this.id,this.mark,this.settings)}}get limit(){return 0}withLimit(e){if(0===e)return this;{const e=new $("invalid limit");return new ge(e,this.id,this.mark,this.settings)}}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new $}set(e,t){throw new $}head(){throw new $}step(e){const t=new $("error step");return new ge(t,this.id,this.mark,this.settings)}trap(){return this.error}seek(e){const t=new $("error seek");return new ge(t,this.id,this.mark,this.settings)}withId(e){return new ge(this.error,e,this.mark,this.settings)}withMark(e){return new ge(this.error,this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=Y.fromAny(e),new ge(this.error,this.id,this.mark,e)}clone(){return this}}class ye extends ie{constructor(e){super(),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(e){return e?this:new be(this.settings)}write(e){return new ve(new re("full"),this.settings)}writeln(e){return new ve(new re("full"),this.settings)}bind(){throw new re}withSettings(e){return e=X.fromAny(e),new ye(e)}clone(){return this}}class be extends ie{constructor(e){super(),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(e){return e?new ye(this.settings):this}write(e){return new ve(new re("done"),this.settings)}writeln(e){return new ve(new re("done"),this.settings)}bind(){throw new re}withSettings(e){return e=X.fromAny(e),new be(e)}clone(){return this}}class ve extends ie{constructor(e,t){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0}),Object.defineProperty(this,"settings",{value:t,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(e){return this}write(e){return this}writeln(e){return this}bind(){throw new re}trap(){return this.error}withSettings(e){return e=X.fromAny(e),new ve(this.error,e)}clone(){return this}}class xe extends ie{writeln(e){return"string"==typeof e&&this.write(e),this.write(this.settings.lineSeparator)}flush(){return this}clone(){throw new Error}static full(){return new Oe(X.standard())}static done(){return new Ee(X.standard())}static error(e){return new Ce(e,X.standard())}}e([n],xe,"full",null),e([n],xe,"done",null);class Oe extends xe{constructor(e){super(),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(e){return e?this:new Ee(this.settings)}get index(){return 0}withIndex(e){return 0===e?this:new Ce(new re("invalid index"),this.settings)}get limit(){return 0}withLimit(e){return 0===e?this:new Ce(new re("invalid limit"),this.settings)}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new re}set(e,t){throw new re}write(e){return new Ce(new re("full"),this.settings)}writeln(e){return new Ce(new re("full"),this.settings)}step(e=1){return 0===e?this:new Ce(new re("invalid step"),this.settings)}bind(){throw new re}withSettings(e){return e=X.fromAny(e),new Oe(e)}clone(){return this}}class Ee extends xe{constructor(e){super(),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(e){return e?new Oe(this.settings):this}get index(){return 0}withIndex(e){return 0===e?this:new Ce(new re("invalid index"),this.settings)}get limit(){return 0}withLimit(e){return 0===e?this:new Ce(new re("invalid limit"),this.settings)}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new re}set(e,t){throw new re}write(e){return new Ce(new re("done"),this.settings)}writeln(e){return new Ce(new re("done"),this.settings)}step(e=1){return 0===e?this:new Ce(new re("invalid step"),this.settings)}bind(){throw new re}withSettings(e){return e=X.fromAny(e),new Ee(e)}clone(){return this}}class Ce extends xe{constructor(e,t){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0}),Object.defineProperty(this,"settings",{value:t,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(e){return this}get index(){return 0}withIndex(e){return 0===e?this:new Ce(new re("invalid index"),this.settings)}get limit(){return 0}withLimit(e){return 0===e?this:new Ce(new re("invalid limit"),this.settings)}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new re}set(e,t){throw new re}write(e){return this}writeln(e){return this}step(e=1){return 0===e?this:new Ce(new re("invalid step"),this.settings)}bind(){throw new re}trap(){return this.error}withSettings(e){return e=X.fromAny(e),new Ce(this.error,e)}clone(){return this}}class Ae extends Error{constructor(e){super(e instanceof ce?e.message:e),Object.setPrototypeOf(this,Ae.prototype),this.diagnostic=e instanceof ce?e:null}toString(){return null!==this.diagnostic?this.diagnostic.toString():super.toString()}}class Se{isCont(){return!0}isDone(){return!1}isError(){return!1}fork(e){return this}bind(){throw new Ae}trap(){throw new Ae}asError(){throw new Ae}static done(e){return new ke(e)}static error(e){return e instanceof Error?new Te(e):new Te(new Ae(e))}}class ke extends Se{constructor(e){super(),Object.defineProperty(this,"value",{value:e,enumerable:!0})}isCont(){return!1}isDone(){return!0}feed(e){return this}bind(){return this.value}}class Te extends Se{constructor(e){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0})}isCont(){return!1}isError(){return!0}feed(e){return this}bind(){throw this.error}trap(){return this.error}asError(){return this}}class Pe extends oe{constructor(){super()}isCont(){return!1}isDone(){return!0}pull(e){return this}bind(){throw new se}asDone(){return this}andThen(e){return e}}class De extends oe{constructor(e){super(),Object.defineProperty(this,"value",{value:e,enumerable:!0})}isCont(){return!1}isDone(){return!0}pull(e){return this}bind(){return this.value}asDone(){return this}andThen(e){return e}}class qe extends oe{constructor(e){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0})}isCont(){return!1}isError(){return!0}pull(e){return this}bind(){throw this.error}trap(){return this.error}asError(){return this}andThen(e){return this}}class Ie extends oe{constructor(e,t){super(),this.head=e,this.tail=t}pull(e){let t=this.head;return t.isCont()&&(t=t.pull(e)),t.isError()?t.asError():t.isDone()?this.tail.pull(e):new Ie(t,this.tail)}}class Ve extends ie{constructor(e,t,r){super(),this.array=e,this.size=t,this.settings=r}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(e){return this}write(e){if("number"==typeof e){const t=this.size,r=this.array;let i;return null===r||t+1>r.length?(i=new Uint8Array(Ve.expand(t+1)),null!==r&&i.set(r,0),this.array=i):i=r,i[t]=e,this.size=t+1,this}throw new TypeError(""+e)}writeln(e){throw new TypeError(""+e)}toUint8Array(){const e=this.size,t=this.array;if(null!==t&&e===t.length)return t;{const r=new Uint8Array(e);return null!==t&&r.set(t.slice(0,e),0),this.array=r,r}}cloneArray(){const e=this.array;return null!==e?e.slice(0,this.size):null}withSettings(e){return e=X.fromAny(e),this.settings=e,this}static expand(e){return e=Math.max(32,e)-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}}class Ne extends Ve{constructor(e,t,r){super(e,t,r)}bind(){return this.toUint8Array()}clone(){return new Ne(this.cloneArray(),this.size,this.settings)}}class ze extends xe{constructor(e,t,r,i,n){super(),this.array=e,this.index=t,this.limit=r,this.part=i,this.settings=n}isCont(){return this.index<this.limit}isFull(){return this.part&&this.index>=this.limit}isDone(){return!this.part&&this.index>=this.limit}isError(){return!1}isPart(){return this.part}asPart(e){return this.part=e,this}withIndex(e){return 0<=e&&e<=this.limit?(this.index=e,this):new Ce(new re("invalid index"),this.settings)}withLimit(e){return 0<=e&&e<=this.array.length?(this.limit=e,this):new Ce(new re("invalid limit"),this.settings)}get capacity(){return this.array.length}get remaining(){return this.limit-this.index}has(e){return 0<=e&&e<this.limit}get(e){if(0<=e&&e<this.limit)return this.array[e];throw new re}set(e,t){if(!(0<=e&&e<this.limit))throw new re;this.array[e]=t}write(e){if("number"==typeof e){const t=this.index;return t<this.limit?(this.array[t]=e,this.index+=1,this):new Ce(new re("full"),this.settings)}return new Ce(new re("binary output"),this.settings)}writeln(e){return new Ce(new re("binary output"),this.settings)}step(e){const t=this.index+e;return 0<=t&&t<=this.limit?(this.index=t,this):new Ce(new re("invalid step"),this.settings)}bind(){return new Uint8Array(this.array.buffer,0,this.index)}withSettings(e){return e=X.fromAny(e),this.settings=e,this}clone(){return new ze(this.array,this.index,this.limit,this.part,this.settings)}static create(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.length),new ze(e,t,t+r,!1,X.standard())}}const Me=function(){const e={output:function(e,t){let r;return void 0===t&&"number"!=typeof e?(t=e,e=void 0):"number"!=typeof e&&(e=void 0),r="number"==typeof e?new Uint8Array(e):null,t=X.fromAny(t),new Ne(r,0,t)},outputBuffer:function(e,t,r){return ze.create(e,t,r)}};return e}();class je{isFatal(){return!1}isReplacement(){return!1}toString(){return he.debug(this)}static fatal(){return new Le(!1)}static fatalNonZero(){return new Le(!0)}static replacement(){return new Fe(65533,!1)}static replacementNonZero(){return new Fe(65533,!0)}}e([n],je,"fatal",null),e([n],je,"fatalNonZero",null),e([n],je,"replacement",null),e([n],je,"replacementNonZero",null);class Le extends je{constructor(e){super(),Object.defineProperty(this,"nonZero",{value:e,enumerable:!0})}isFatal(){return!0}get replacementChar(){return 65533}isNonZero(){return this.nonZero}asNonZero(e){return e?je.fatalNonZero():je.fatal()}equals(e){return this===e||e instanceof Le&&this.nonZero===e.nonZero}hashCode(){return i.mash(i.mix(l.hash(Le),s.hash(this.nonZero)))}debug(e){return e=e.write("UtfErrorMode").write(46).write(this.nonZero?"fatalNonZero":"fatal").write(40).write(41)}}class Fe extends je{constructor(e,t){super(),Object.defineProperty(this,"replacementChar",{value:e,enumerable:!0}),Object.defineProperty(this,"nonZero",{value:t,enumerable:!0})}isReplacement(){return!0}isNonZero(){return this.nonZero}asNonZero(e){return 65533===this.replacementChar?e?je.replacementNonZero():je.replacement():new Fe(this.replacementChar,e)}equals(e){return this===e||e instanceof Fe&&(this.replacementChar===e.replacementChar&&this.nonZero===e.nonZero)}hashCode(){return i.mash(i.mix(i.mix(l.hash(Fe),a.hash(this.replacementChar)),s.hash(this.nonZero)))}debug(e){return e=e.write("UtfErrorMode").write(46).write(this.nonZero?"replacementNonZero":"replacement").write(40).write(41)}}class Be{constructor(e){Object.defineProperty(this,"alphabet",{value:e,enumerable:!0})}encodeDigit(e){return this.alphabet.charCodeAt(e)}uint8ArrayWriter(e){return void 0===e?new Qe(this,void 0,null):new Qe(this,e,e)}writeUint8Array(e,t){return Qe.write(e,this,void 0,t)}writeInteger(e,t,r=0){return Ze.write(e,this,void 0,t,r)}writeIntegerLiteral(e,t,r=0){return Ze.writeLiteral(e,this,void 0,t,r)}static get lowercase(){return new Be("0123456789abcdef")}static get uppercase(){return new Be("0123456789ABCDEF")}static isDigit(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}static decodeDigit(e){if(e>=48&&e<=57)return e-48;if(e>=65&&e<=70)return e-65+10;if(e>=97&&e<=102)return e-97+10;{let t=ue.stringOutput();throw t=t.write("Invalid base-16 digit: "),t=he.debugChar(t,e),new Error(t.bind())}}static writeQuantum(e,t,r){const i=Be.decodeDigit(t),n=Be.decodeDigit(r);return e=e.write(i<<4|n)}static parser(e){return new Ge(e)}static parse(e,t){return Ge.parse(e,t)}static parseUint8Array(e){return Ge.parse(e,Me.output())}}e([n],Be,"lowercase",null),e([n],Be,"uppercase",null);class Ue extends ie{constructor(e,t,r,i,n,s){super(),this.output=e,this.errorMode=t,this.c1=r,this.c2=i,this.c3=n,this.have=s}isCont(){return this.output.isCont()}isFull(){return this.output.isFull()}isDone(){return this.output.isDone()}isError(){return this.output.isError()}isPart(){return this.output.isPart()}asPart(e){return this.output=this.output.asPart(e),this}write(e){if("number"==typeof e){let t=this.c1,r=this.c2,i=this.c3,n=-1,s=this.have;if(e>=0)switch(s){case 0:t=255&e,s=1;break;case 1:r=255&e,s=2;break;case 2:i=255&e,s=3;break;case 3:n=255&e,s=4;break;default:throw new Error("unreachable")}if(0===t&&this.errorMode.isNonZero())return ie.error(new re("unexpected NUL byte"));if(t>=0&&t<=127)this.output=this.output.write(t),this.have=0;else if(t>=194&&t<=244)if(t>=194&&t<=223&&r>=128&&r<=191)this.output=this.output.write((31&t)<<6|63&r),this.c1=-1,this.have=0;else if(224===t&&r>=160&&r<=191||t>=225&&t<=236&&r>=128&&r<=191||237===t&&r>=128&&r<=159||t>=238&&t<=239&&r>=128&&r<=191)if(i>=128&&i<=191)this.output=this.output.write((15&t)<<12|(63&r)<<6|63&i),this.c1=-1,this.c2=-1,this.have=0;else if(i>=0){if(this.errorMode.isFatal())return ie.error(new re(Ue.invalid(t,r,i)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=i,this.c2=-1,this.have=1}else{if(e<0||this.output.isDone())return ie.error(new re(Ue.invalid(t,r)));this.c2=r,this.have=2}else if(240===t&&r>=144&&r<=191||t>=241&&t<=243&&r>=128&&r<=191||244===t&&r>=128&&r<=143)if(i>=128&&i<=191)if(n>=128&&n<=191)this.have=4,this.output=this.output.write((7&t)<<18|(63&r)<<12|(63&i)<<6|63&n),this.c1=-1,this.c2=-1,this.c3=-1,this.have=0;else if(n>=0){if(this.errorMode.isFatal())return ie.error(new re(Ue.invalid(t,r,i,n)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=n,this.c2=-1,this.c3=-1,this.have=1}else{if(e<0||this.output.isDone())return ie.error(new re(Ue.invalid(t,r,i)));this.c3=i,this.have=3}else if(i>=0){if(this.errorMode.isFatal())return ie.error(new re(Ue.invalid(t,r,i)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=i,this.c2=-1,this.have=1}else{if(e<0||this.output.isDone())return ie.error(new re(Ue.invalid(t,r)));this.c2=r,this.have=2}else if(r>=0){if(this.errorMode.isFatal())return ie.error(new re(Ue.invalid(t,r)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=r,this.have=1}else{if(e<0||this.output.isDone())return ie.error(new re(Ue.invalid(t)));this.c1=t,this.have=1}else if(t>=0){if(this.errorMode.isFatal())return ie.error(new re(Ue.invalid(t)));this.output=this.output.write(this.errorMode.replacementChar),this.have=0}return this.output.isError()?this.output:this}if("string"==typeof e)return this.output=this.output.write(e),this;throw new TypeError(""+e)}static invalid(e,t,r,i){let n=ue.stringOutput();n=n.write("invalid UTF-8 code unit sequence: ");const s=Be.uppercase;return s.writeIntegerLiteral(n,e,2),void 0!==t&&(n=n.write(" "),s.writeIntegerLiteral(n,t,2),void 0!==r&&(n=n.write(" "),s.writeIntegerLiteral(n,r,2),void 0!==i&&(n=n.write(" "),s.writeIntegerLiteral(n,i,2)))),n.bind()}get settings(){return this.output.settings}withSettings(e){return this.output=this.output.withSettings(e),this}bind(){return 0===this.have?this.output.bind():this.write(-1).bind()}trap(){return this.output.trap()}clone(){return new Ue(this.output.clone(),this.errorMode,this.c1,this.c2,this.c3,this.have)}static create(e,t){return void 0===t&&(t=je.fatal()),new Ue(e,t,-1,-1,-1,0)}}class We extends ie{constructor(e,t,r,i,n,s){super(),this.output=e,this.errorMode=t,this.c2=r,this.c3=i,this.c4=n,this.index=s}isCont(){return this.output.isCont()}isFull(){return this.output.isFull()}isDone(){return this.output.isDone()}isError(){return!1}isPart(){return this.output.isPart()}asPart(e){return this.output=this.output.asPart(e),this}write(e){if("number"==typeof e){let t=0,r=this.c2,i=this.c3,n=this.c4,s=this.output,o=this.index;for(;o<4;){if(!s.isCont())return ie.error(new re("unable to flush buffered code units"));switch(o){case 1:s=s.write(r),this.c2=0;break;case 2:s=s.write(i),this.c3=0;break;case 3:s=s.write(n),this.c4=0;break;default:throw new Error("unreachable")}o+=1}if(e>=0&&e<=127)n=e,o=3;else if(e>=128&&e<=2047)i=192|e>>>6,n=128|63&e,o=2;else if(e>=2048&&e<=65535||e>=57344&&e<=65535)r=224|e>>>12,i=128|e>>>6&63,n=128|63&e,o=1;else{if(!(e>=65536&&e<=1114111))return this.errorMode.isFatal()?ie.error(new re("invalid code point: "+e)):this.write(this.errorMode.replacementChar);t=240|e>>>18,r=128|e>>>12&63,i=128|e>>>6&63,n=128|63&e,o=0}do{switch(o){case 0:s=s.write(t);break;case 1:s=s.write(r),this.c2=0;break;case 2:s=s.write(i),this.c3=0;break;case 3:s=s.write(n),this.c4=0;break;default:throw new Error("unreachable")}this.output=s,o+=1}while(o<4&&s.isCont());return o<4&&(o<3&&(o<2&&(this.c2=r),this.c3=i),this.c4=n),this.output=s,this.index=o,this}if("string"==typeof e)return this.output=this.output.write(e),this;throw new TypeError(""+e)}flush(){let e=this.output,t=this.index;for(;t<4;){if(!e.isCont())return ie.error(new re("unable to flush buffered code units"));switch(t){case 1:e=e.write(this.c2),this.c2=0;break;case 2:e=e.write(this.c3),this.c3=0;break;case 3:e=e.write(this.c4),this.c4=0;break;default:throw new Error("unreachable")}t+=1}return this.output=e,this.index=t,this}get settings(){return this.output.settings}withSettings(e){return this.output=this.output.withSettings(e),this}bind(){return this.output.bind()}clone(){return new We(this.output.clone(),this.errorMode,this.c2,this.c3,this.c4,this.index)}static create(e,t){return void 0===t&&(t=je.fatal()),new We(e,t,0,0,0,4)}}const Re=function(){const e={sizeOf:function(t,r){if("number"==typeof t||void 0===t){if("number"==typeof t){if(0===t&&void 0!==r&&r.isNonZero())return 2;if(t>=0&&t<=127)return 1;if(t>=128&&t<=2047)return 2;if(t>=2048&&t<=65535||t>=57344&&t<=65535)return 3;if(t>=65536&&t<=1114111)return 4}return void 0===r?3:r.isReplacement()?e.sizeOf(r.replacementChar):0}if("string"==typeof t){let i=0;for(let n=0,s=t.length;n<s;n=u.offsetByCodePoints(t,n,1))i+=e.sizeOf(t.charCodeAt(n),r);return i}throw new TypeError(""+t)},decodedOutput:function(e,t){return Ue.create(e,t)},encodedOutput:function(e,t){return We.create(e,t)},decodedString:function(){return e.decodedOutput(ue.stringOutput())}};return e}();class He extends Se{constructor(e=1,t=0,r=2,i=1){super(),this.sign=e,this.value=t,this.mode=r,this.step=i}feed(e){return He.parse(e,this.sign,this.value,this.mode,this.step)}static parse(e,t=1,r=0,i=2,n=1){let s=0;if(1===n)if(e.isCont())s=e.head(),45===s?(e=e.step(),t=-1):43===s&&(e=e.step(),t=1),n=2;else if(e.isDone())return Se.error(ce.expected("number",e));if(2===n)if(e.isCont())if(s=e.head(),48===s)e=e.step(),n=4;else{if(!(s>=49&&s<=57)){if(i>0&&46===s){let r=ue.stringOutput();return t<0&&(r=r.write(45)),Ke.parse(e,r,i)}return Se.error(ce.expected("number",e))}e=e.step(),r=t*(s-48),n=3}else if(e.isDone())return Se.error(ce.expected("number",e));if(3===n){for(;e.isCont()&&(s=e.head(),s>=48&&s<=57);){const i=10*r+t*(s-48);if(!(-9007199254740991<=i&&i<=9007199254740992))return Se.error(ce.message("integer overflow",e));r=i,e=e.step()}if(e.isCont())n=4;else if(e.isDone())return Se.done(r)}if(4===n){if(e.isCont()){if(s=e.head(),i>0&&46===s||i>1&&(69===s||101===s)){let n=ue.stringOutput();return n=t<0&&0===r?n.write(45).write(48):n.write(""+r),Ke.parse(e,n,i)}return Se.done(r)}if(e.isDone())return Se.done(r)}return new He(t,r,i,n)}}class Ke extends Se{constructor(e,t=2,r=1){super(),this.output=e,this.mode=t,this.step=r}feed(e){return Ke.parse(e,this.output,this.mode,this.step)}static parse(e,t,r=2,i=1){let n=0;if(1===i)if(e.isCont())if(n=e.head(),46===n)e=e.step(),t=t.write(n),i=2;else{if(!(r>1)||69!==n&&101!==n)return Se.error(ce.expected("decimal or exponent",e));e=e.step(),t=t.write(n),i=5}else if(e.isDone())return Se.error(ce.expected("decimal or exponent",e));if(2===i)if(e.isCont()){if(n=e.head(),!(n>=48&&n<=57))return Se.error(ce.expected("digit",e));e=e.step(),t=t.write(n),i=3}else if(e.isDone())return Se.error(ce.expected("digit",e));if(3===i){for(;e.isCont()&&(n=e.head(),n>=48&&n<=57);)e=e.step(),t=t.write(n);if(e.isCont()){if(!(r>1))return Se.done(+t.bind());i=4}else if(e.isDone())return Se.done(+t.bind())}if(4===i){if(n=e.head(),69!==n&&101!==n)return Se.done(+t.bind());e=e.step(),t=t.write(n),i=5}if(5===i)if(e.isCont())n=e.head(),43!==n&&45!==n||(e=e.step(),t=t.write(n)),i=6;else if(e.isDone())return Se.error(ce.unexpected(e));if(6===i)if(e.isCont()){if(n=e.head(),!(n>=48&&n<=57))return Se.error(ce.expected("digit",e));e=e.step(),t=t.write(n),i=7}else if(e.isDone())return Se.error(ce.expected("digit",e));if(7===i){for(;e.isCont()&&(n=e.head(),n>=48&&n<=57);)e=e.step(),t=t.write(n);if(!e.isEmpty())return Se.done(+t.bind())}return new Ke(t,r,i)}}class _e extends oe{constructor(e,t,r=0,i=1){super(),this.value=e,this.input=t,this.index=r,this.step=i}pull(e){return _e.write(e,this.value,this.input,this.index,this.step)}static write(e,t,r,i=0,n=1){if(0===n)return oe.end();if(1===n&&(r<0?e.isCont()&&(e=e.write(45),n=2):n=2),2===n)if(r>-10&&r<10){if(e.isCont())return e=e.write(le.encodeDigit(Math.abs(0|r))),oe.done(t)}else{const n=new Array(19);let s=r,o=18;for(;0!==s;)n[o]=Math.abs(s%10|0),s=s/10|0,o-=1;for(o+=1+i;o<19&&e.isCont();)e=e.write(le.encodeDigit(n[o])),i+=1,o+=1;if(19===o)return oe.done(t)}return e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new _e(t,r,i,n)}}class Ge extends Se{constructor(e,t=0,r=1){super(),this.output=e,this.p=t,this.step=r}feed(e){return Ge.parse(e,this.output.clone(),this.p,this.step)}static parse(e,t,r=0,i=1){let n=0;for(;!e.isEmpty();){if(1===i)if(e.isCont()&&(n=e.head(),Be.isDigit(n)))e=e.step(),r=n,i=2;else if(!e.isEmpty())return Se.done(t.bind());if(2===i)if(e.isCont()&&(n=e.head(),Be.isDigit(n)))e=e.step(),t=Be.writeQuantum(t,r,n),r=0,i=1;else if(!e.isEmpty())return Se.error(ce.expected("base16 digit",e))}return new Ge(t,r,i)}}class Qe extends oe{constructor(e,t,r,i=0,n=1){super(),this.base16=e,this.value=t,this.input=r,this.index=i,this.step=n}feed(e){if(e instanceof Uint8Array)return new Qe(this.base16,void 0,e);throw new TypeError(""+e)}pull(e){if(null===this.input)throw new se;return Qe.write(e,this.base16,this.value,this.input,this.index,this.step)}static write(e,t,r,i,n=0,s=1){for(;n<i.length;){const r=i[n];1===s&&e.isCont()&&(e=e.write(t.encodeDigit(r>>>4)),s=2),2===s&&e.isCont()&&(e=e.write(t.encodeDigit(15&r)),n+=1,s=1)}return n===i.length?oe.done(r):e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new Qe(t,r,i,n,s)}}class Ze extends oe{constructor(e,t,r,i,n=0,s=3){super(),this.base16=e,this.value=t,this.input=r,this.width=i,this.index=n,this.step=s}pull(e){return Ze.write(e,this.base16,this.value,this.input,this.width,this.index,this.step)}static write(e,t,r,i,n,s=0,o=3){if(o<=0)return oe.end();if(1===o&&e.isCont()&&(e=e.write(48),o=2),2===o&&e.isCont()&&(e=e.write(120),o=3),3===o)if(i>=0&&i<16&&n<=1){if(e.isCont())return e=e.write(t.encodeDigit(i)),oe.done(r)}else{let o=15;const a=new Array(16);let u=i;for(;0!==u||o>=16-n;)a[o]=15&u,u>>>=4,o-=1;for(o+=1+s;o<16&&e.isCont();)e=e.write(t.encodeDigit(a[o])),s+=1,o+=1;if(16===o)return oe.done(r)}return e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new Ze(t,r,i,n,s,o)}static writeLiteral(e,t,r,i,n){return Ze.write(e,t,r,i,n,0,1)}}class Xe{decodeDigit(e){if(e>=65&&e<=90)return e-65;if(e>=97&&e<=122)return e+-71;if(e>=48&&e<=57)return e+4;if(43===e||45===e)return 62;if(47===e||95===e)return 63;{let t=ue.stringOutput();throw t=t.write("Invalid base-64 digit: "),t=he.debugChar(t,e),new Error(t.bind())}}encodeDigit(e){return this.alphabet.charCodeAt(e)}writeQuantum(e,t,r,i,n){const s=this.decodeDigit(t),o=this.decodeDigit(r);if(61!==i){const t=this.decodeDigit(i);if(61!==n){const r=this.decodeDigit(n);e=(e=(e=e.write(s<<2|o>>>4)).write(o<<4|t>>>2)).write(t<<6|r)}else e=(e=e.write(s<<2|o>>>4)).write(o<<4|t>>>2)}else{if(61!==n)return ie.error(new Error("Improperly padded base-64"));e=e.write(s<<2|o>>>4)}return e}parser(e){return new Je(this,e)}parse(e,t){return Je.parse(e,this,t)}parseUint8Array(e){return Je.parse(e,this,Me.output())}uint8ArrayWriter(e){return void 0===e?new et(this,void 0,null):new et(this,e,e)}writeUint8Array(e,t){return et.write(e,this,void 0,t)}static get standardPadded(){return new $e(!0)}static get standardUnpadded(){return new $e(!1)}static standard(e=!0){return e?Xe.standardPadded:Xe.standardUnpadded}static get urlPadded(){return new Ye(!0)}static get urlUnpadded(){return new Ye(!1)}static url(e=!0){return e?Xe.urlPadded:Xe.urlUnpadded}}e([n],Xe,"standardPadded",null),e([n],Xe,"standardUnpadded",null),e([n],Xe,"urlPadded",null),e([n],Xe,"urlUnpadded",null);class $e extends Xe{constructor(e){super(),Object.defineProperty(this,"padded",{value:e,enumerable:!0})}get alphabet(){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}isPadded(){return this.padded}asPadded(e){return e===this.padded?this:Xe.standard(e)}isDigit(e){return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||43===e||47===e}}class Ye extends Xe{constructor(e){super(),Object.defineProperty(this,"padded",{value:e,enumerable:!0})}get alphabet(){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}isPadded(){return this.padded}asPadded(e){return e===this.padded?this:Xe.url(e)}isDigit(e){return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||45===e||95===e}}class Je extends Se{constructor(e,t,r=0,i=0,n=0,s=1){super(),this.base64=e,this.output=t,this.p=r,this.q=i,this.r=n,this.step=s}feed(e){return Je.parse(e,this.base64,this.output.clone(),this.p,this.q,this.r,this.step)}static parse(e,t,r,i=0,n=0,s=0,o=1){let a=0;for(;!e.isEmpty();){if(1===o)if(e.isCont()&&(a=e.head(),t.isDigit(a)))e=e.step(),i=a,o=2;else if(!e.isEmpty())return Se.done(r.bind());if(2===o)if(e.isCont()&&(a=e.head(),t.isDigit(a)))e=e.step(),n=a,o=3;else if(!e.isEmpty())return Se.error(ce.expected("base64 digit",e));if(3===o)if(e.isCont()&&(a=e.head(),t.isDigit(a)||61===a))e=e.step(),s=a,o=61!==a?4:5;else if(!e.isEmpty())return t.isPadded()?Se.error(ce.unexpected(e)):(r=t.writeQuantum(r,i,n,61,61),Se.done(r.bind()));if(4===o){if(e.isCont()&&(a=e.head(),t.isDigit(a)||61===a)){if(e=e.step(),r=t.writeQuantum(r,i,n,s,a),s=0,n=0,i=0,61===a)return Se.done(r.bind());o=1}else if(!e.isEmpty())return t.isPadded()?Se.error(ce.unexpected(e)):(r=t.writeQuantum(r,i,n,s,61),Se.done(r.bind()))}else if(5===o){if(e.isCont()&&(a=e.head(),61===a))return e=e.step(),r=t.writeQuantum(r,i,n,s,a),s=0,n=0,i=0,Se.done(r.bind());if(!e.isEmpty())return Se.error(ce.expected(61,e))}}return new Je(t,r,i,n,s,o)}}class et extends oe{constructor(e,t,r,i=0,n=1){super(),this.base64=e,this.value=t,this.input=r,this.index=i,this.step=n}feed(e){if(e instanceof Uint8Array)return new et(this.base64,null,e);throw new TypeError(""+e)}pull(e){if(null===this.input)throw new se;return et.write(e,this.base64,this.value,this.input,this.index,this.step)}static write(e,t,r,i,n=0,s=1){for(;n+2<i.length&&e.isCont();){const r=i[n],o=i[n+1],a=i[n+2];1===s&&e.isCont()&&(e=e.write(t.encodeDigit(r>>>2)),s=2),2===s&&e.isCont()&&(e=e.write(t.encodeDigit(63&(r<<4|o>>>4))),s=3),3===s&&e.isCont()&&(e=e.write(t.encodeDigit(63&(o<<2|a>>>6))),s=4),4===s&&e.isCont()&&(e=e.write(t.encodeDigit(63&a)),n+=3,s=1)}if(n+1<i.length&&e.isCont()){const r=i[n],o=i[n+1];1===s&&e.isCont()&&(e=e.write(t.encodeDigit(r>>>2)),s=2),2===s&&e.isCont()&&(e=e.write(t.encodeDigit(63&(r<<4|o>>>4))),s=3),3===s&&e.isCont()&&(e=e.write(t.encodeDigit(o<<2&63)),s=4),4===s&&(t.isPadded()?e.isCont()&&(e=e.write(61),n+=2):n+=2)}else if(n<i.length&&e.isCont()){const r=i[n];1===s&&e.isCont()&&(e=e.write(t.encodeDigit(r>>>2)),s=2),2===s&&e.isCont()&&(e=e.write(t.encodeDigit(r<<4&63)),s=3),3===s&&(t.isPadded()?e.isCont()&&(e=e.write(61),s=4):n+=1),4===s&&e.isCont()&&(e=e.write(61),n+=1)}return n===i.length?oe.done(r):e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new et(t,r,i,n,s)}}class tt{constructor(){}updated(e,t){const r=lt.create(2);return r.push(this),r.set(e,t),r}updatedAttr(e,t){const r=lt.create(2);return r.push(this),r.setAttr(e,t),r}updatedSlot(e,t){const r=lt.create(2);return r.push(this),r.setSlot(e,t),r}appended(...e){const t=lt.create(1+arguments.length);return t.push(this),t.push(...e),t}prepended(...e){const t=lt.create(arguments.length+1);return t.push(...e),t.push(this),t}concat(...e){const t=lt.create();t.push(this);for(let r=0,i=e.length;r<i;r+=1)tt.fromAny(e[r]).forEach((function(e){t.push(e)}));return t}lt(e){return e=tt.fromAny(e),this.compareTo(e)<0?Ot.from(!0):tt.absent()}le(e){return e=tt.fromAny(e),this.compareTo(e)<=0?Ot.from(!0):tt.absent()}eq(e){return e=tt.fromAny(e),this.equals(e)?Ot.from(!0):tt.absent()}ne(e){return e=tt.fromAny(e),this.equals(e)?tt.absent():Ot.from(!0)}ge(e){return e=tt.fromAny(e),this.compareTo(e)>=0?Ot.from(!0):tt.absent()}gt(e){return e=tt.fromAny(e),this.compareTo(e)>0?Ot.from(!0):tt.absent()}invoke(e){return tt.absent()}filter(e){const t=nr.literal(this);return 0===arguments.length?t.filter():t.filter(e)}max(e){return this.compareTo(e)>=0?this:e}min(e){return this.compareTo(e)<=0?this:e}evaluate(e){return this}substitute(e){return this}cast(e,t){let r=e.cast(this);return void 0===r&&(r=t),r}coerce(e,t){let r=e.cast(this);return void 0===r&&(r=e.unit),void 0===r&&(r=t),r}get precedence(){return 11}forEach(e,t){return e.call(t,this,0)}iterator(){return j.unary(this)}interpolateTo(e){return e instanceof tt?rt(this,e):null}display(e){return this.debug(e)}toString(){return he.debug(this)}static empty(){return lt.empty()}static extant(){return Et.extant()}static absent(){return Ct.absent()}static fromAny(e){return e instanceof tt?e:ht.fromAny(e)}static globalScope(){return lt.create(1).slot("math",yr.scope).commit()}}e([n],tt,"globalScope",null);const rt=function(e){const t=function(e,r){const i=function(e){return e<1?i[0]:i[1]};return Object.setPrototypeOf(i,t.prototype),i[0]=e.commit(),i[1]=r.commit(),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(x);class it extends tt{constructor(){super()}isDefined(){return!0}isDistinct(){return!0}isDefinite(){return!0}toValue(){return this.value}get tag(){}get target(){return this.value}flattened(){return ht.absent()}unflattened(){return lt.of(this)}header(e){return ht.absent()}headers(e){}head(){return tt.absent()}tail(){return lt.empty()}body(){return ht.absent()}get length(){return 0}has(e){return!1}get(e){return ht.absent()}getAttr(e){return ht.absent()}getSlot(e){return ht.absent()}getField(e){}getItem(e){return tt.absent()}deleted(e){return this}conditional(e,t){return e=tt.fromAny(e)}or(e){return this}and(e){return e=tt.fromAny(e)}lambda(e){return ht.absent()}stringValue(e){return this.value.stringValue(e)}numberValue(e){return this.value.numberValue(e)}booleanValue(e){return this.value.booleanValue(e)}interpolateTo(e){return e instanceof it?st(this,e):super.interpolateTo(e)}static of(e,t){let r;return"string"==typeof e?r=e:e instanceof yt&&(r=e.value),void 0!==r&&64===r.charCodeAt(0)?(r=r.slice(1),1===arguments.length?ot.of(r):ot.of(r,t)):1===arguments.length?nt.of(e):nt.of(e,t)}static fromAny(e){if(e instanceof it)return e;if("object"==typeof e&&null!==e){if(void 0!==e.$key)return it.of(e.$key,e.$value);for(const t in e)return it.of(t,e[t])}throw new TypeError(""+e)}}it.ImmutableFlag=1;class nt extends it{constructor(e,t,r){super(),this.key=e.commit(),this.value=t,this.flags=void 0!==r?r:0}isConstant(){return this.key.isConstant()&&this.value.isConstant()}setValue(e){if(0!=(this.flags&it.ImmutableFlag))throw new Error("immutable");const t=this.value;return this.value=e,t}updatedValue(e){return new nt(this.key,e)}bitwiseOr(e){if((e=tt.fromAny(e))instanceof At)return new Lt(this,e);let t;return t=e instanceof nt&&this.key.equals(e.key)?this.value.bitwiseOr(e.value):e instanceof ht?this.value.bitwiseOr(e):ht.absent(),t.isDefined()?new nt(this.key,t):tt.absent()}bitwiseXor(e){if((e=tt.fromAny(e))instanceof At)return new Ft(this,e);let t;return t=e instanceof nt&&this.key.equals(e.key)?this.value.bitwiseXor(e.value):e instanceof ht?this.value.bitwiseXor(e):ht.absent(),t.isDefined()?new nt(this.key,t):tt.absent()}bitwiseAnd(e){if((e=tt.fromAny(e))instanceof At)return new Bt(this,e);let t;return t=e instanceof nt&&this.key.equals(e.key)?this.value.bitwiseAnd(e.value):e instanceof ht?this.value.bitwiseAnd(e):ht.absent(),t.isDefined()?new nt(this.key,t):tt.absent()}plus(e){if((e=tt.fromAny(e))instanceof At)return new Gt(this,e);let t;return t=e instanceof nt&&this.key.equals(e.key)?this.value.plus(e.value):e instanceof ht?this.value.plus(e):ht.absent(),t.isDefined()?new nt(this.key,t):tt.absent()}minus(e){if((e=tt.fromAny(e))instanceof At)return new Qt(this,e);let t;return t=e instanceof nt&&this.key.equals(e.key)?this.value.minus(e.value):e instanceof ht?this.value.minus(e):ht.absent(),t.isDefined()?new nt(this.key,t):tt.absent()}times(e){if((e=tt.fromAny(e))instanceof At)return new Zt(this,e);let t;return t=e instanceof nt&&this.key.equals(e.key)?this.value.times(e.value):e instanceof ht?this.value.times(e):ht.absent(),t.isDefined()?new nt(this.key,t):tt.absent()}divide(e){if((e=tt.fromAny(e))instanceof At)return new Xt(this,e);let t;return t=e instanceof nt&&this.key.equals(e.key)?this.value.divide(e.value):e instanceof ht?this.value.divide(e):ht.absent(),t.isDefined()?new nt(this.key,t):tt.absent()}modulo(e){if((e=tt.fromAny(e))instanceof At)return new $t(this,e);let t;return t=e instanceof nt&&this.key.equals(e.key)?this.value.modulo(e.value):e instanceof ht?this.value.modulo(e):ht.absent(),t.isDefined()?new nt(this.key,t):tt.absent()}not(){const e=this.value.not();return e.isDefined()?new nt(this.key,e):tt.absent()}bitwiseNot(){const e=this.value.bitwiseNot();return e.isDefined()?new nt(this.key,e):tt.absent()}negative(){const e=this.value.negative();return e.isDefined()?new nt(this.key,e):tt.absent()}positive(){const e=this.value.positive();return e.isDefined()?new nt(this.key,e):tt.absent()}inverse(){const e=this.value.inverse();return e.isDefined()?new nt(this.key,e):tt.absent()}evaluate(e){e=zt.fromAny(e);const t=this.key.evaluate(e).toValue(),r=this.value.evaluate(e).toValue();return t===this.key&&r===this.value?this:t.isDefined()&&r.isDefined()?new nt(t,r):tt.absent()}substitute(e){e=zt.fromAny(e);const t=this.key.substitute(e).toValue(),r=this.value.substitute(e).toValue();return t===this.key&&r===this.value?this:t.isDefined()&&r.isDefined()?new nt(t,r):tt.absent()}toAny(){const e={};return this.key instanceof yt?e[this.key.value]=this.value.toAny():(e.$key=this.key.toAny(),e.$value=this.value.toAny()),e}isAliased(){return!1}isMutable(){return 0==(this.flags&it.ImmutableFlag)}alias(){this.flags|=it.ImmutableFlag}branch(){return 0!=(this.flags&it.ImmutableFlag)?new nt(this.key,this.value,this.flags&~it.ImmutableFlag):this}clone(){return new nt(this.key.clone(),this.value.clone())}commit(){return this.flags|=it.ImmutableFlag,this.value.commit(),this}interpolateTo(e){return e instanceof nt?ut(this,e):super.interpolateTo(e)}get typeOrder(){return 2}compareTo(e){if(e instanceof nt){let t=this.key.compareTo(e.key);return 0===t&&(t=this.value.compareTo(e.value)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof nt&&(this.key.equals(e.key)&&this.value.equivalentTo(e.value,t))}keyEquals(e){return"string"==typeof e&&this.key instanceof yt?this.key.value===e:e instanceof it?this.key.equals(e.key):this.key.equals(e)}equals(e){return this===e||e instanceof nt&&(this.key.equals(e.key)&&this.value.equals(e.value))}hashCode(){return i.mash(i.mix(i.mix(l.hash(nt),this.key.hashCode()),this.value.hashCode()))}debug(e){return e=e.write("Slot").write(46).write("of").write(40).display(this.key),this.value instanceof Et||(e=e.write(44).write(32).display(this.value)),e=e.write(41)}static of(e,t){return e=ht.fromAny(e),t=1===arguments.length?ht.extant():ht.fromAny(t),new nt(e,t)}}const st=function(e){const t=function(e,r){const i=function(e){const t=i.keyInterpolator(e),r=i.valueInterpolator(e);return nt.of(t,r)};return Object.setPrototypeOf(i,t.prototype),i.keyInterpolator=e.key.interpolateTo(r.key),i.valueInterpolator=e.value.interpolateTo(r.value),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return nt.of(this.keyInterpolator[0],this.valueInterpolator[0])},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return nt.of(this.keyInterpolator[1],this.valueInterpolator[1])},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.keyInterpolator.equals(e.keyInterpolator)&&this.valueInterpolator.equals(e.valueInterpolator))},t}(x);class ot extends it{constructor(e,t,r){super(),this.key=e,this.value=t,this.flags=void 0!==r?r:0}isConstant(){return this.key.isConstant()&&this.value.isConstant()}get name(){return this.key.value}setValue(e){if(0!=(this.flags&it.ImmutableFlag))throw new Error("immutable");const t=this.value;return this.value=e,t}updatedValue(e){return new ot(this.key,e)}bitwiseOr(e){if((e=tt.fromAny(e))instanceof At)return new Lt(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.bitwiseOr(e.value):e instanceof ht?this.value.bitwiseOr(e):ht.absent(),t.isDefined()?new ot(this.key,t):tt.absent()}bitwiseXor(e){if((e=tt.fromAny(e))instanceof At)return new Ft(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.bitwiseXor(e.value):e instanceof ht?this.value.bitwiseXor(e):ht.absent(),t.isDefined()?new ot(this.key,t):tt.absent()}bitwiseAnd(e){if((e=tt.fromAny(e))instanceof At)return new Bt(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.bitwiseAnd(e.value):e instanceof ht?this.value.bitwiseAnd(e):ht.absent(),t.isDefined()?new ot(this.key,t):tt.absent()}plus(e){if((e=tt.fromAny(e))instanceof At)return new Gt(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.plus(e.value):e instanceof ht?this.value.plus(e):ht.absent(),t.isDefined()?new ot(this.key,t):tt.absent()}minus(e){if((e=tt.fromAny(e))instanceof At)return new Qt(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.minus(e.value):e instanceof ht?this.value.minus(e):ht.absent(),t.isDefined()?new ot(this.key,t):tt.absent()}times(e){if((e=tt.fromAny(e))instanceof At)return new Zt(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.times(e.value):e instanceof ht?this.value.times(e):ht.absent(),t.isDefined()?new ot(this.key,t):tt.absent()}divide(e){if((e=tt.fromAny(e))instanceof At)return new Xt(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.divide(e.value):e instanceof ht?this.value.divide(e):ht.absent(),t.isDefined()?new ot(this.key,t):tt.absent()}modulo(e){if((e=tt.fromAny(e))instanceof At)return new $t(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.modulo(e.value):e instanceof ht?this.value.modulo(e):ht.absent(),t.isDefined()?new ot(this.key,t):tt.absent()}not(){const e=this.value.not();return e.isDefined()?new ot(this.key,e):tt.absent()}bitwiseNot(){const e=this.value.bitwiseNot();return e.isDefined()?new ot(this.key,e):tt.absent()}negative(){const e=this.value.negative();return e.isDefined()?new ot(this.key,e):tt.absent()}positive(){const e=this.value.positive();return e.isDefined()?new ot(this.key,e):tt.absent()}inverse(){const e=this.value.inverse();return e.isDefined()?new ot(this.key,e):tt.absent()}evaluate(e){e=zt.fromAny(e);const t=this.key.evaluate(e).toValue(),r=this.value.evaluate(e).toValue();return t===this.key&&r===this.value?this:t.isDefined()&&r.isDefined()?t instanceof yt?new ot(t,r):new nt(t,r):tt.absent()}substitute(e){e=zt.fromAny(e);const t=this.key.substitute(e).toValue(),r=this.value.substitute(e).toValue();return t===this.key&&r===this.value?this:t.isDefined()&&r.isDefined()?t instanceof yt?new ot(t,r):new nt(t,r):tt.absent()}toAny(){const e={};return e["@"+this.key.value]=this.value.toAny(),e}isAliased(){return!1}isMutable(){return 0==(this.flags&it.ImmutableFlag)}alias(){this.flags|=it.ImmutableFlag}branch(){return 0!=(this.flags&it.ImmutableFlag)?new ot(this.key,this.value,this.flags&~it.ImmutableFlag):this}clone(){return new ot(this.key.clone(),this.value.clone())}commit(){return this.flags|=it.ImmutableFlag,this.value.commit(),this}interpolateTo(e){return e instanceof ot?at(this,e):super.interpolateTo(e)}get typeOrder(){return 1}compareTo(e){if(e instanceof ot){let t=this.key.compareTo(e.key);return 0===t&&(t=this.value.compareTo(e.value)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ot&&(this.key.equals(e.key)&&this.value.equivalentTo(e.value,t))}keyEquals(e){return"string"==typeof e?this.key.value===e:e instanceof it?this.key.equals(e.key):this.key.equals(e)}equals(e){return this===e||e instanceof ot&&(this.key.equals(e.key)&&this.value.equals(e.value))}hashCode(){return i.mash(i.mix(i.mix(l.hash(ot),this.key.hashCode()),this.value.hashCode()))}debug(e){return e=e.write("Attr").write(46).write("of").write(40).display(this.key),this.value instanceof Et||(e=e.write(44).write(32).display(this.value)),e=e.write(41)}static of(e,t){return e=yt.fromAny(e),t=1===arguments.length?ht.extant():ht.fromAny(t),new ot(e,t)}}const at=function(e){const t=function(e,r){const i=function(e){const t=i.keyInterpolator(e),r=i.valueInterpolator(e);return ot.of(t,r)};return Object.setPrototypeOf(i,t.prototype),i.keyInterpolator=e.key.interpolateTo(r.key),i.valueInterpolator=e.value.interpolateTo(r.value),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return ot.of(this.keyInterpolator[0],this.valueInterpolator[0])},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return ot.of(this.keyInterpolator[1],this.valueInterpolator[1])},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.keyInterpolator.equals(e.keyInterpolator)&&this.valueInterpolator.equals(e.valueInterpolator))},t}(x),ut=function(e){const t=function(e,r){const i=function(e){const t=i.keyInterpolator(e),r=i.valueInterpolator(e);return nt.of(t,r)};return Object.setPrototypeOf(i,t.prototype),i.keyInterpolator=e.key.interpolateTo(r.key),i.valueInterpolator=e.value.interpolateTo(r.value),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return nt.of(this.keyInterpolator[0],this.valueInterpolator[0])},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return nt.of(this.keyInterpolator[1],this.valueInterpolator[1])},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.keyInterpolator.equals(e.keyInterpolator)&&this.valueInterpolator.equals(e.valueInterpolator))},t}(x);class ht extends tt{constructor(){super()}isDefined(){return!0}isDistinct(){return!0}isDefinite(){return!0}get key(){return ht.absent()}toValue(){return this}get tag(){}get target(){return this}flattened(){return this}unflattened(){return lt.of(this)}header(e){return ht.absent()}headers(e){}head(){return tt.absent()}tail(){return lt.empty()}body(){return ht.extant()}get length(){return 0}has(e){return!1}get(e){return ht.absent()}getAttr(e){return ht.absent()}getSlot(e){return ht.absent()}getField(e){}getItem(e){return tt.absent()}deleted(e){return this}conditional(e,t){return e=tt.fromAny(e)}or(e){return this}and(e){return e=tt.fromAny(e)}bitwiseOr(e){if((e=tt.fromAny(e))instanceof At)return new Lt(this,e);if(e instanceof ot){const t=this.bitwiseOr(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof nt){const t=this.bitwiseOr(e.value);if(t.isDefined())return new nt(e.key,t)}return tt.absent()}bitwiseXor(e){if((e=tt.fromAny(e))instanceof At)return new Ft(this,e);if(e instanceof ot){const t=this.bitwiseXor(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof nt){const t=this.bitwiseXor(e.value);if(t.isDefined())return new nt(e.key,t)}return tt.absent()}bitwiseAnd(e){if((e=tt.fromAny(e))instanceof At)return new Bt(this,e);if(e instanceof ot){const t=this.bitwiseAnd(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof nt){const t=this.bitwiseAnd(e.value);if(t.isDefined())return new nt(e.key,t)}return tt.absent()}lt(e){return(e=tt.fromAny(e))instanceof At?new Ut(this,e):super.lt(e)}le(e){return(e=tt.fromAny(e))instanceof At?new Wt(this,e):super.le(e)}eq(e){return(e=tt.fromAny(e))instanceof At?new Rt(this,e):super.eq(e)}ne(e){return(e=tt.fromAny(e))instanceof At?new Ht(this,e):super.ne(e)}ge(e){return(e=tt.fromAny(e))instanceof At?new Kt(this,e):super.ge(e)}gt(e){return(e=tt.fromAny(e))instanceof At?new _t(this,e):super.gt(e)}plus(e){if((e=tt.fromAny(e))instanceof At)return new Gt(this,e);if(e instanceof ot){const t=this.plus(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof nt){const t=this.plus(e.value);if(t.isDefined())return new nt(e.key,t)}return tt.absent()}minus(e){if((e=tt.fromAny(e))instanceof At)return new Qt(this,e);if(e instanceof ot){const t=this.minus(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof nt){const t=this.minus(e.value);if(t.isDefined())return new nt(e.key,t)}return tt.absent()}times(e){if((e=tt.fromAny(e))instanceof At)return new Zt(this,e);if(e instanceof ot){const t=this.times(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof nt){const t=this.times(e.value);if(t.isDefined())return new nt(e.key,t)}return tt.absent()}divide(e){if((e=tt.fromAny(e))instanceof At)return new Xt(this,e);if(e instanceof ot){const t=this.divide(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof nt){const t=this.divide(e.value);if(t.isDefined())return new nt(e.key,t)}return tt.absent()}modulo(e){if((e=tt.fromAny(e))instanceof At)return new $t(this,e);if(e instanceof ot){const t=this.modulo(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof nt){const t=this.modulo(e.value);if(t.isDefined())return new nt(e.key,t)}return tt.absent()}not(){return ht.absent()}bitwiseNot(){return ht.absent()}negative(){return ht.absent()}positive(){return ht.absent()}inverse(){return ht.absent()}lambda(e){return new mr(this,e)}stringValue(e){return e}numberValue(e){return e}booleanValue(e){return e}isAliased(){return!1}isMutable(){return!1}alias(){}branch(){return this}clone(){return this}commit(){return this}interpolateTo(e){return super.interpolateTo(e)}keyEquals(e){return!1}static builder(){return new ct}static empty(){return lt.empty()}static extant(){return Et.extant()}static absent(){return Ct.absent()}static fromAny(e){if(e instanceof ht)return e;if(void 0===e)return Ct.absent();if(null===e)return Et.extant();if("boolean"==typeof e)return Ot.from(e);if("number"==typeof e)return vt.from(e);if("string"==typeof e)return yt.from(e);if(e instanceof Uint8Array)return mt.wrap(e);if(Array.isArray(e))return lt.fromArray(e);if("object"==typeof e)return lt.fromObject(e);throw new TypeError(""+e)}}class lt extends ht{constructor(){super()}isDefinite(){return!this.isEmpty()}isArray(){return 0===this.fieldCount}isObject(){return 0===this.valueCount}get valueCount(){let e=0;return this.forEach((function(t){t instanceof ht&&(e+=1)}),this),e}isConstant(){return void 0===this.forEach((function(e){return!!e.isConstant()&&void 0}),this)}get tag(){const e=this.head();if(e instanceof ot)return e.key.value}get target(){let e,t,r=!1;return this.forEach((function(i){i instanceof ot?r=!0:void 0===e&&i instanceof ht?e=i:(void 0===t&&(t=lt.create(),void 0!==e&&t.push(e)),t.push(i))}),this),void 0===e?ht.extant():void 0===t?e:r?t:this}flattened(){if(this.isEmpty())return ht.extant();{const e=this.iterator(),t=e.head();return e.step(),e.isEmpty()&&t instanceof ht?t:this.branch()}}unflattened(){return this}header(e){const t=this.head();return t instanceof ot&&t.key.value===e?t.value:ht.absent()}headers(e){const t=this.head();if(t instanceof ot&&t.key.value===e){const e=t.value;return e instanceof lt?e:lt.of(e)}}head(){return this.forEach((function(e){return e}),this)||tt.absent()}tail(){const e=lt.create();return this.forEach((function(t,r){r>0&&e.push(t)}),this),e}body(){const e=this.tail();return e.isEmpty()?ht.absent():e.flattened()}has(e){return e=ht.fromAny(e),this.forEach((function(t){return!!(t instanceof it&&t.key.equals(e))||void 0}),this)||!1}indexOf(e,t=0){e=tt.fromAny(e),t<0&&(t=Math.max(0,this.length+t));const r=this.forEach((function(r,i){return i>=t&&e.equals(r)?i:void 0}),this);return void 0!==r?r:-1}lastIndexOf(e,t){e=tt.fromAny(e);const r=this.length;for(void 0===t?t=r-1:t<0&&(t=r+t),t=Math.min(t,r-1);t>=0;){if(e.equals(this.getItem(t)))return t;t-=1}return-1}get(e){return e=ht.fromAny(e),this.forEach((function(t){return t instanceof it&&t.key.equals(e)?t.value:void 0}),this)||ht.absent()}getAttr(e){return e=yt.fromAny(e),this.forEach((function(t){return t instanceof ot&&t.key.equals(e)?t.value:void 0}),this)||ht.absent()}getSlot(e){return e=ht.fromAny(e),this.forEach((function(t){return t instanceof nt&&t.key.equals(e)?t.value:void 0}),this)||ht.absent()}getField(e){return e=ht.fromAny(e),this.forEach((function(t){return t instanceof it&&t.key.equals(e)?t:void 0}),this)}set(e,t){e=ht.fromAny(e),t=ht.fromAny(t);const r=this.iterator();for(;!r.isEmpty();){const i=r.head();if(i instanceof it&&i.key.equals(e))return i.isMutable()?i.setValue(t):r.set(i.updatedValue(t)),this;r.step()}return this.push(new nt(e,t)),this}setAttr(e,t){e=yt.fromAny(e),t=ht.fromAny(t);const r=this.iterator();for(;!r.isEmpty();){const i=r.head();if(i instanceof it&&i.key.equals(e))return i instanceof ot&&i.isMutable()?i.setValue(t):r.set(new ot(e,t)),this;r.step()}return this.push(new ot(e,t)),this}setSlot(e,t){e=ht.fromAny(e),t=ht.fromAny(t);const r=this.iterator();for(;!r.isEmpty();){const i=r.head();if(i instanceof it&&i.key.equals(e))return i instanceof nt&&i.isMutable()?i.setValue(t):r.set(new nt(e,t)),this;r.step()}return this.push(new nt(e,t)),this}updated(e,t){e=ht.fromAny(e),t=ht.fromAny(t);const r=this.isMutable()?this:this.branch(),i=r.iterator();for(;!i.isEmpty();){const n=i.head();if(n.key.equals(e))return n instanceof it&&n.isMutable()?n.setValue(t):i.set(new nt(e,t)),r;i.step()}return r.push(new nt(e,t)),r}updatedAttr(e,t){e=yt.fromAny(e),t=ht.fromAny(t);const r=this.isMutable()?this:this.branch(),i=r.iterator();for(;!i.isEmpty();){const n=i.head();if(n.key.equals(e))return n instanceof ot&&n.isMutable()?n.setValue(t):i.set(new ot(e,t)),r;i.step()}return r.push(new ot(e,t)),r}updatedSlot(e,t){e=ht.fromAny(e),t=ht.fromAny(t);const r=this.isMutable()?this:this.branch(),i=r.iterator();for(;!i.isEmpty();){const n=i.head();if(n.key.equals(e))return n instanceof nt&&n.isMutable()?n.setValue(t):i.set(new nt(e,t)),r;i.step()}return r.push(new nt(e,t)),r}appended(...e){const t=this.isMutable()?this:this.branch();return t.push(...e),t}prepended(...e){const t=this.isMutable()?this:this.branch();return t.splice(0,0,...e),t}deleted(e){const t=this.isMutable()?this:this.branch();return t.delete(e),t}concat(...e){const t=this.isMutable()?this:this.branch();for(let r=0,i=e.length;r<i;r+=1)tt.fromAny(e[r]).forEach((function(e){t.push(e)}));return t}slice(e,t){return this.subRecord(e,t).branch()}attr(e,t){let r;return r=1===arguments.length?ot.of(e):ot.of(e,t),this.push(r),this}slot(e,t){let r;return r=1===arguments.length?nt.of(e):nt.of(e,t),this.push(r),this}item(e){return this.push(e),this}items(...e){return this.push(this,...e),this}evaluate(e){e=zt.fromAny(e);const t=lt.create();e.pushScope(t);let r=!1;return this.forEach((function(i){const n=i.evaluate(e);n.isDefined()&&t.push(n),i!==n&&(r=!0)}),this),e.popScope(),r?t:this}substitute(e){e=zt.fromAny(e);const t=lt.create();e.pushScope(t);let r=!1;return this.forEach((function(i){const n=i.substitute(e);n.isDefined()&&t.push(n),i!==n&&(r=!0)}),this),e.popScope(),r?t:this}stringValue(e){let t="";return void 0===this.forEach((function(e){if(e instanceof ht){const r=e.stringValue();if(void 0!==r)return void(t+=r)}return null}),this)?t:void 0}toAny(){return!this.isEmpty()&&this.isArray()?this.toArray():this.toObject()}toArray(){const e=new Array(this.length);return this.forEach((function(t,r){t instanceof ht?e[r]=t.toAny():t instanceof it&&(e[r]={$key:t.key.toAny(),$value:t.value.toAny()})}),this),e}toObject(){const e={};return this.forEach((function(t,r){t instanceof ot?e["@"+t.key.value]=t.value.toAny():t instanceof nt?t.key instanceof yt?e[t.key.value]=t.value.toAny():e["$"+r]={$key:t.key.toAny(),$value:t.value.toAny()}:t instanceof ht&&(e["$"+r]=t.toAny())}),this),e}isAliased(){return!1}isMutable(){return!0}alias(){}branch(){const e=lt.create();return this.forEach((function(t){e.push(t)}),this),e}clone(){const e=lt.create();return this.forEach((function(t){e.push(t.clone())}),this),e}commit(){return this}bind(){return this}subRecord(e,t){const r=this.length;void 0===e?e=0:e<0&&(e=r+e),e=Math.min(Math.max(0,e),r),void 0===t?t=r:t<0&&(t=r+t);const i=lt.create();return this.forEach((function(r,n){return n<e?void 0:n<t?void i.push(r):null}),this),i}iterator(){return new pt(this)}interpolateTo(e){return e instanceof lt?dt(this,e):super.interpolateTo(e)}get typeOrder(){return 3}compareTo(e){if(e instanceof lt){const t=this.iterator(),r=e.iterator();let i=0;do{if(t.isEmpty()||r.isEmpty())break;i=t.head().compareTo(r.head()),t.step(),r.step()}while(0===i);return 0!==i?i:t.isEmpty()&&!r.isEmpty()?-1:!t.isEmpty()&&r.isEmpty()?1:0}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){if(this===e)return!0;if(e instanceof lt){const r=this.iterator(),i=e.iterator();for(;!r.isEmpty()&&!i.isEmpty();){if(!r.head().equivalentTo(i.head(),t))return!1;r.step(),i.step()}return r.isEmpty()&&i.isEmpty()}return!1}equals(e){if(this===e)return!0;if(e instanceof lt){const t=this.iterator(),r=e.iterator();for(;!t.isEmpty()&&!r.isEmpty();){if(!t.head().equals(r.head()))return!1;t.step(),r.step()}return t.isEmpty()&&r.isEmpty()}return!1}hashCode(){let e=l.hash(lt);return this.forEach((function(t){e=i.mix(e,t.hashCode())}),this),e}debug(e){return e=e.write("Record").write(46),this.isEmpty()?e=e.write("empty").write(40).write(41):(e=e.write("of").write(40),this.forEach((function(t,r){0!==r&&(e=e.write(44).write(32)),e=e.display(t)}),this),e=e.write(41)),e}static empty(){return ft.empty()}static create(e){return ft.create(e)}static of(...e){return ft.of(...e)}static fromAny(e){if(e instanceof lt)return e;if(Array.isArray(e))return lt.fromArray(e);if("object"==typeof e&&null!==e)return lt.fromObject(e);throw new TypeError(""+e)}static fromArray(e){const t=e.length||0,r=lt.create(t);for(let i=0;i<t;i+=1)r.push(tt.fromAny(e[i]));return r}static fromObject(e){const t=lt.create();for(const r in e){const i=e[r];36===r.charCodeAt(0)?i&&"object"==typeof i&&Object.prototype.hasOwnProperty.call(i,"$key")?t.push(it.of(i.$key,i.$value)):t.push(ht.fromAny(i)):t.push(it.of(r,i))}return t}static expand(e){return e=Math.max(8,e)-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}}lt.AliasedFlag=1,lt.ImmutableFlag=2,Object.defineProperty(lt.prototype,"fieldCount",{get(){let e=0;return this.forEach((function(t){t instanceof it&&(e+=1)}),this),e},configurable:!0});class ct{constructor(){this.record=null,this.value=null}push(...e){for(let t=0,r=e.length;t<r;t+=1){const r=e[t];if(r instanceof it)return this.pushField(r);if(r instanceof ht)return this.pushValue(r);throw new TypeError(""+r)}}pushField(e){null===this.record&&(this.record=lt.create(),null!==this.value&&(this.record.push(this.value),this.value=null)),this.record.push(e)}pushValue(e){null!==this.record?this.record.push(e):null===this.value?this.value=e:(this.record=lt.create(),this.record.push(this.value),this.value=null,this.record.push(e))}bind(){return null!==this.record?this.record:null!==this.value?this.value:ht.absent()}}const dt=function(e){const t=function(e,r){const i=function(e){const t=i.interpolators,r=t.length,n=lt.create(r);for(let i=0;i<r;i+=1)n.push(t[i](e));return n};Object.setPrototypeOf(i,t.prototype);const n=Math.min(e.length,r.length),s=new Array(n);for(let t=0;t<n;t+=1)s[t]=e.getItem(t).interpolateTo(r.getItem(t));return i.interpolators=s,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.interpolators,t=e.length,r=lt.create(t);for(let i=0;i<t;i+=1)r.push(e[i][0]);return r},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.interpolators,t=e.length,r=lt.create(t);for(let i=0;i<t;i+=1)r.push(e[i][1]);return r},configurable:!0}),t.prototype.equals=function(e){if(this===e)return!0;if(e instanceof t){const t=this.interpolators.length;if(t===e.interpolators.length){for(let r=0;r<t;r+=1)if(!this.interpolators[r].equals(e.interpolators[r]))return!1;return!0}}return!1},t}(x);class pt extends j{constructor(e,t,r,i){super(),void 0===t&&(t=0),void 0===r&&(r=e.length),void 0===i&&(i=t),this.record=e,this.lower=t,this.upper=r,this.index=i,this.direction=0}isEmpty(){return this.index>=this.upper}head(){if(this.direction=0,this.index<this.upper)return this.record.getItem(this.index);throw new Error("empty")}step(){this.direction=0;const e=this.index;if(!(e<this.upper))throw new Error("empty");this.index=e+1}skip(e){this.index=Math.min(Math.max(this.lower,this.index+e,this.upper))}hasNext(){return this.index<this.upper}nextIndex(){return this.index-this.lower}next(){this.direction=1;const e=this.index;return e<this.upper?(this.index=e+1,{value:this.record.getItem(e),done:this.index===this.upper}):(this.index=this.upper,{done:!0})}hasPrevious(){return this.index>this.lower}previousIndex(){return this.index-this.lower-1}previous(){this.direction=-1;const e=this.index-1;return e>=this.lower?(this.index=e,{value:this.record.getItem(e),done:e===this.lower}):(this.index=0,{done:!0})}set(e){this.direction>0?this.record.setItem(this.index-1,e):this.record.setItem(this.index,e)}delete(){let e=this.index;this.direction>0&&(e-=1,this.index=e),this.record.splice(e,1),this.direction=0}}class ft extends lt{constructor(e,t,r,i,n){super(),this.array=e,this.table=t,Object.defineProperty(this,"length",{value:r,writable:!0,enumerable:!0,configurable:!0}),Object.defineProperty(this,"fieldCount",{value:i,writable:!0,enumerable:!0,configurable:!0}),this.flags=n}isEmpty(){return 0===this.length}get valueCount(){return this.length-this.fieldCount}isConstant(){const e=this.array;for(let t=0,r=this.length;t<r;t+=1)if(!e[t].isConstant())return!1;return!0}get tag(){if(this.fieldCount>0){const e=this.array[0];if(e instanceof ot)return e.key.value}}get target(){let e,t,r=!1;const i=this.array;for(let n=0,s=this.length;n<s;n+=1){const s=i[n];s instanceof ot?r=!0:void 0===e&&s instanceof ht?e=s:(void 0===t&&(t=lt.create(),void 0!==e&&t.push(e)),t.push(s))}return void 0===e?ht.extant():void 0===t?e:r?t:this}head(){return this.length>0?this.array[0]:tt.absent()}tail(){const e=this.length;return e>0?new wt(this,1,e):lt.empty()}body(){const e=this.length;if(e>2)return new wt(this,1,e).branch();if(2===e){const e=this.array[1];return e instanceof ht?e:lt.of(e)}return ht.absent()}has(e){if(0!==this.fieldCount){e=ht.fromAny(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i.key.equals(e))return!0;n=(n+1)%r}while(n!==i)}return!1}indexOf(e,t=0){e=tt.fromAny(e);const r=this.array,i=this.length;for(t<0&&(t=Math.max(0,i+t));t<i;){if(e.equals(r[t]))return t;t+=1}return-1}lastIndexOf(e,t){e=tt.fromAny(e);const r=this.array,i=this.length;for(void 0===t?t=i-1:t<0&&(t=i+t),t=Math.min(t,i-1);t>=0;){if(e.equals(r[t]))return t;t-=1}return-1}get(e){if(this.fieldCount>0){e=ht.fromAny(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i.key.equals(e))return i.value;n=(n+1)%r}while(n!==i)}return ht.absent()}getAttr(e){if(this.fieldCount>0){e=yt.fromAny(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i instanceof ot&&i.key.equals(e))return i.value;n=(n+1)%r}while(n!==i)}return ht.absent()}getSlot(e){if(this.fieldCount>0){e=ht.fromAny(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i instanceof nt&&i.key.equals(e))return i.value;n=(n+1)%r}while(n!==i)}return ht.absent()}getField(e){if(this.fieldCount>0){e=ht.fromAny(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i.key.equals(e))return i;n=(n+1)%r}while(n!==i)}}getItem(e){e instanceof vt&&(e=e.value);const t=this.length;return e<0&&(e=t+e),e>=0&&e<t?this.array[e]:tt.absent()}set(e,t){if(0!=(this.flags&lt.ImmutableFlag))throw new Error("immutable");return e=ht.fromAny(e),t=ht.fromAny(t),0!=(this.flags&lt.AliasedFlag)?this.fieldCount>0?this.setAliased(e,t):this.pushAliased(new nt(e,t)):this.fieldCount>0?null!==this.table?this.setMutable(e,t):this.updateMutable(e,t):this.pushMutable(new nt(e,t)),this}setAliased(e,t){const r=this.length,i=this.array,n=new Array(lt.expand(r+1));for(let s=0;s<r;s+=1){const o=i[s];if(o instanceof it&&o.key.equals(e)){for(n[s]=o.updatedValue(t),s+=1;s<r;)n[s]=i[s],s+=1;return this.array=n,this.table=null,void(this.flags&=~lt.AliasedFlag)}n[s]=o}n[r]=new nt(e,t),this.array=n,this.table=null,this.length=r+1,this.fieldCount+=1,this.flags&=~lt.AliasedFlag}setMutable(e,t){const r=this.table,i=r.length,n=Math.abs(e.hashCode()%i);let s=n;do{const n=r[s];if(void 0===n)break;if(n.key.equals(e))return n.isMutable()?void n.setValue(t):void this.updateMutable(e,t);s=(s+1)%i}while(s!==n);const o=new nt(e,t);this.pushMutable(o),ft.put(r,o)}updateMutable(e,t){const r=this.array;for(let i=0,n=this.length;i<n;i+=1){const n=r[i];if(n instanceof it&&n.key.equals(e))return r[i]=n.updatedValue(t),void(this.table=null)}const i=new nt(e,t);this.pushMutable(i),ft.put(this.table,i)}setAttr(e,t){if(0!=(this.flags&lt.ImmutableFlag))throw new Error("immutable");return e=yt.fromAny(e),t=ht.fromAny(t),0!=(this.flags&lt.AliasedFlag)?this.fieldCount>0?this.setAttrAliased(e,t):this.pushAliased(new ot(e,t)):this.fieldCount>0?null!==this.table?this.setAttrMutable(e,t):this.updateAttrMutable(e,t):this.pushMutable(new ot(e,t)),this}setAttrAliased(e,t){const r=this.length,i=this.array,n=new Array(lt.expand(r+1));for(let s=0;s<r;s+=1){const o=i[s];if(o instanceof it&&o.key.equals(e)){for(n[s]=new ot(e,t),s+=1;s<r;)n[s]=i[s],s+=1;return this.array=n,this.table=null,void(this.flags&=~lt.AliasedFlag)}n[s]=o}n[r]=new ot(e,t),this.array=n,this.table=null,this.length=r+1,this.fieldCount+=1,this.flags&=~lt.AliasedFlag}setAttrMutable(e,t){const r=this.table,i=r.length,n=Math.abs(e.hashCode()%i);let s=n;do{const n=r[s];if(void 0===n)break;if(n.key.equals(e))return void(n instanceof ot&&n.isMutable()?n.setValue(t):this.updateAttrMutable(e,t));s=(s+1)%i}while(s!==n);const o=new ot(e,t);this.push(o),ft.put(r,o)}updateAttrMutable(e,t){const r=this.array;for(let i=0,n=this.length;i<n;i+=1){const n=r[i];if(n instanceof it&&n.key.equals(e))return r[i]=new ot(e,t),void(this.table=null)}const i=new ot(e,t);this.push(i),ft.put(this.table,i)}setSlot(e,t){if(0!=(this.flags&lt.ImmutableFlag))throw new Error("immutable");return e=ht.fromAny(e),t=ht.fromAny(t),0!=(this.flags&lt.AliasedFlag)?this.fieldCount>0?this.setSlotAliased(e,t):this.pushAliased(new nt(e,t)):this.fieldCount>0?null!==this.table?this.setSlotMutable(e,t):this.updateSlotMutable(e,t):this.pushMutable(new nt(e,t)),this}setSlotAliased(e,t){const r=this.length,i=this.array,n=new Array(lt.expand(r+1));for(let s=0;s<r;s+=1){const o=i[s];if(o instanceof it&&o.key.equals(e)){for(n[s]=new nt(e,t),s+=1;s<r;)n[s]=i[s],s+=1;return this.array=n,this.table=null,void(this.flags&=~lt.AliasedFlag)}n[s]=o}n[r]=new nt(e,t),this.array=n,this.table=null,this.length=r+1,this.fieldCount+=1,this.flags&=~lt.AliasedFlag}setSlotMutable(e,t){const r=this.table,i=r.length,n=Math.abs(e.hashCode()%i);let s=n;do{const n=r[s];if(void 0===n)break;if(n.key.equals(e))return void(n instanceof nt&&n.isMutable()?n.setValue(t):this.updateSlotMutable(e,t));s=(s+1)%i}while(s!==n);const o=new nt(e,t);this.push(o),ft.put(r,o)}updateSlotMutable(e,t){const r=this.array;for(let i=0,n=this.length;i<n;i+=1){const n=r[i];if(n instanceof it&&n.key.equals(e))return r[i]=new nt(e,t),void(this.table=null)}const i=new nt(e,t);this.push(i),ft.put(this.table,i)}setItem(e,t){if(0!=(this.flags&lt.ImmutableFlag))throw new Error("immutable");t=tt.fromAny(t);const r=this.length;if(e<0&&(e=r+e),e<0||e>r)throw new RangeError(""+e);return 0!=(this.flags&lt.AliasedFlag)?this.setItemAliased(e,t):this.setItemMutable(e,t),this}setItemAliased(e,t){const r=this.length,i=this.array,n=new Array(lt.expand(r));for(let e=0;e<r;e+=1)n[e]=i[e];const s=i[e];n[e]=t,this.array=n,this.table=null,t instanceof it?s instanceof it||(this.fieldCount+=1):s instanceof it&&(this.fieldCount-=1),this.flags&=~lt.AliasedFlag}setItemMutable(e,t){const r=this.array,i=r[e];r[e]=t,t instanceof it?(this.table=null,i instanceof it||(this.fieldCount+=1)):i instanceof it&&(this.table=null,this.fieldCount-=1)}updated(e,t){e=ht.fromAny(e),t=ht.fromAny(t);const r=0==(this.flags&lt.ImmutableFlag)?this:this.branch();return 0!=(r.flags&lt.AliasedFlag)?r.fieldCount>0?r.setAliased(e,t):r.pushAliased(new nt(e,t)):r.fieldCount>0?null!==r.table?r.setMutable(e,t):r.updateMutable(e,t):r.pushMutable(new nt(e,t)),r}updatedAttr(e,t){e=yt.fromAny(e),t=ht.fromAny(t);const r=0==(this.flags&lt.ImmutableFlag)?this:this.branch();return 0!=(r.flags&lt.AliasedFlag)?r.fieldCount>0?r.setAttrAliased(e,t):r.pushAliased(new ot(e,t)):r.fieldCount>0?null!==r.table?r.setAttrMutable(e,t):r.updateAttrMutable(e,t):r.pushMutable(new ot(e,t)),r}updatedSlot(e,t){e=ht.fromAny(e),t=ht.fromAny(t);const r=0==(this.flags&lt.ImmutableFlag)?this:this.branch();return 0!=(r.flags&lt.AliasedFlag)?r.fieldCount>0?r.setSlotAliased(e,t):r.pushAliased(new nt(e,t)):r.fieldCount>0?null!==r.table?r.setSlotMutable(e,t):r.updateSlotMutable(e,t):r.pushMutable(new nt(e,t)),r}push(...e){if(0!=(this.flags&lt.ImmutableFlag))throw new Error("immutable");return 0!=(this.flags&lt.AliasedFlag)?this.pushAliased(...e):this.pushMutable(...e),this.length}pushAliased(...e){const t=e.length;let r=this.length,i=this.fieldCount;const n=this.array,s=new Array(lt.expand(r+t));if(null!==n)for(let e=0;e<r;e+=1)s[e]=n[e];for(let n=0;n<t;n+=1){const t=tt.fromAny(e[n]);s[r]=t,r+=1,t instanceof it&&(i+=1)}this.array=s,this.table=null,this.length=r,this.fieldCount=i,this.flags&=~lt.AliasedFlag}pushMutable(...e){const t=e.length;let r=this.length,i=this.fieldCount;const n=this.array;let s;if(null===n||r+t>n.length){if(s=new Array(lt.expand(r+t)),null!==n)for(let e=0;e<r;e+=1)s[e]=n[e]}else s=n;for(let n=0;n<t;n+=1){const t=tt.fromAny(e[n]);s[r]=t,r+=1,t instanceof it&&(i+=1,this.table=null)}this.array=s,this.length=r,this.fieldCount=i}splice(e,t=0,...r){if(0!=(this.flags&lt.ImmutableFlag))throw new Error("immutable");const i=this.length;return e<0&&(e=i+e),e=Math.min(Math.max(0,e),i),t=Math.min(Math.max(0,t),i-e),0!=(this.flags&lt.AliasedFlag)?this.spliceAliased(e,t,...r):this.spliceMutable(e,t,...r)}spliceAliased(e,t,...r){const i=r.length;let n=this.length,s=this.fieldCount;const o=this.array,a=new Array(lt.expand(n-t+i));for(let t=0;t<e;t+=1)a[t]=o[t];const u=[];for(let r=e;r<e+t;r+=1){const e=o[r];u.push(e),n-=1,e instanceof it&&(s-=1)}for(let r=e;r<n;r+=1)a[r+i]=o[r+t];for(let t=0;t<i;t+=1){const i=tt.fromAny(r[t]);a[t+e]=i,n+=1,i instanceof it&&(s+=1)}return this.array=a,this.table=null,this.length=n,this.fieldCount=s,this.flags&=~lt.AliasedFlag,u}spliceMutable(e,t,...r){const i=r.length;let n=this.length,s=this.fieldCount;const o=this.array;let a;if(null===o||n-t+i>o.length){if(a=new Array(lt.expand(n-t+i)),null!==o)for(let t=0;t<e;t+=1)a[t]=o[t]}else a=o;const u=[];for(let r=e;r<e+t;r+=1){const e=o[r];u.push(e),n-=1,e instanceof it&&(s-=1)}if(i>t)for(let r=n-1;r>=e;r-=1)a[r+i]=o[r+t];else for(let r=e;r<n;r+=1)a[r+i]=o[r+t];for(let t=0;t<i;t+=1){const i=tt.fromAny(r[t]);a[t+e]=i,n+=1,i instanceof it&&(s+=1)}return this.array=a,this.length=n,this.fieldCount=s,u}delete(e){if(0!=(this.flags&lt.ImmutableFlag))throw new Error("immutable");return e=ht.fromAny(e),0!=(this.flags&lt.AliasedFlag)?this.deleteAliased(e):this.deleteMutable(e)}deleteAliased(e){const t=this.length,r=this.array,i=new Array(lt.expand(t));for(let n=0;n<t;n+=1){const s=r[n];if(s instanceof it&&s.key.equals(e)){for(let e=n+1;e<t;e+=1,n+=1)i[n]=r[e];return this.array=i,this.table=null,this.length=t-1,this.fieldCount-=1,this.flags&=~lt.AliasedFlag,s}i[n]=s}return tt.absent()}deleteMutable(e){const t=this.length,r=this.array;for(let i=0;i<t;i+=1){const n=r[i];if(n instanceof it&&n.key.equals(e)){for(let e=i+1;e<t;e+=1,i+=1)r[i]=r[e];return r[t-1]=void 0,this.table=null,this.length=t-1,this.fieldCount-=1,n}}return tt.absent()}clear(){if(0!=(this.flags&lt.ImmutableFlag))throw new Error("immutable");this.array=null,this.table=null,this.length=0,this.fieldCount=0,this.flags=0}isAliased(){return 0!=(this.flags&lt.AliasedFlag)}isMutable(){return 0==(this.flags&lt.ImmutableFlag)}alias(){this.flags|=lt.AliasedFlag}branch(){if(0==(this.flags&(lt.AliasedFlag|lt.ImmutableFlag))){const e=this.array;for(let t=0,r=this.length;t<r;t+=1)e[t].alias()}return this.flags|=lt.AliasedFlag,new ft(this.array,this.table,this.length,this.fieldCount,lt.AliasedFlag)}clone(){const e=this.length,t=this.array,r=new Array(e);for(let i=0;i<e;i+=1)r[i]=t[i].clone();return new ft(r,null,e,this.fieldCount,0)}commit(){if(0==(this.flags&lt.ImmutableFlag)){this.flags|=lt.ImmutableFlag;const e=this.array;for(let t=0,r=this.length;t<r;t+=1)e[t].commit()}return this}hashTable(){const e=this.fieldCount;let t=this.table;if(0!==e&&null===t){t=new Array(lt.expand(Math.max(e,10*e/7)));const r=this.array;for(let e=0,i=this.length;e<i;e+=1){const i=r[e];i instanceof it&&ft.put(t,i)}this.table=t}return t}static put(e,t){if(null!==e){const r=e.length,i=Math.abs(t.key.hashCode()%r);let n=i;do{const i=e[n];if(void 0===i)return void(e[n]=t);if(t.key.equals(i.key))return void(e[n]=t);n=(n+1)%r}while(n!==i);throw new Error}}evaluate(e){e=zt.fromAny(e);const t=this.array,r=this.length,i=lt.create(r);e.pushScope(i);let n=!1;for(let s=0;s<r;s+=1){const r=t[s],o=r.evaluate(e);o.isDefined()&&i.push(o),r!==o&&(n=!0)}return e.popScope(),n?i:this}substitute(e){e=zt.fromAny(e);const t=this.array,r=this.length,i=lt.create(r);e.pushScope(i);let n=!1;for(let s=0;s<r;s+=1){const r=t[s],o=r.substitute(e);o.isDefined()&&i.push(o),r!==o&&(n=!0)}return e.popScope(),n?i:this}subRecord(e,t){const r=this.length;if(void 0===e?e=0:e<0&&(e=r+e),void 0===t?t=r:t<0&&(t=r+t),e<0||t>r||e>t)throw new RangeError(e+", "+t);return new wt(this,e,t)}forEach(e,t){const r=this.array;for(let i=0,n=this.length;i<n;i+=1){const n=e.call(t,r[i],i);if(void 0!==n)return n}}static empty(){return new ft(null,null,0,0,lt.AliasedFlag|lt.ImmutableFlag)}static create(e){return void 0===e?new ft(null,null,0,0,lt.AliasedFlag):new ft(new Array(e),null,0,0,0)}static of(...e){const t=e.length;if(0===t)return new ft(null,null,0,0,lt.AliasedFlag);{const r=new Array(t);let i=0,n=0;for(let s=0;s<t;s+=1){const t=tt.fromAny(e[s]);r[s]=t,i+=1,t instanceof it&&(n+=1)}return new ft(r,null,i,n,0)}}}e([n],ft,"empty",null);class wt extends lt{constructor(e,t,r){super(),this.record=e,this.lower=t,this.upper=r}isEmpty(){return this.lower===this.upper}isArray(){const e=this.record.array;for(let t=this.lower,r=this.upper;t<r;t+=1)if(e[t]instanceof it)return!1;return!0}isObject(){const e=this.record.array;for(let t=this.lower,r=this.upper;t<r;t+=1)if(e[t]instanceof ht)return!1;return!0}get length(){return this.upper-this.lower}get valueCount(){let e=0;const t=this.record.array;for(let r=this.lower,i=this.upper;r<i;r+=1)t[r]instanceof ht&&(e+=1);return e}isConstant(){const e=this.record.array;for(let t=this.lower,r=this.upper;t<r;t+=1)if(!e[t].isConstant())return!1;return!0}get tag(){if(this.length>0){const e=this.record.array[this.lower];if(e instanceof ot)return e.key.value}}get target(){let e,t,r=!1;const i=this.record.array;for(let n=this.lower,s=this.upper;n<s;n+=1){const s=i[n];s instanceof ot?r=!0:void 0===e&&s instanceof ht?e=s:(void 0===t&&(t=lt.create(),void 0!==e&&t.push(e)),t.push(s))}return void 0===e?ht.extant():void 0===t?e:r?t:this}head(){return this.length>0?this.record.array[this.lower]:tt.absent()}tail(){return this.length>0?new wt(this.record,this.lower+1,this.upper):lt.empty()}body(){const e=this.length;if(e>2)return new wt(this.record,this.lower+1,this.upper).branch();if(2===e){const e=this.record.array[this.lower+1];return e instanceof ht?e:lt.of(e)}return ht.absent()}indexOf(e,t=0){e=tt.fromAny(e);const r=this.record.array,i=this.length;for(t<0&&(t=Math.max(0,i+t)),t=this.lower+t;t<this.upper;){if(e.equals(r[t]))return t-this.lower;t+=1}return-1}lastIndexOf(e,t){e=tt.fromAny(e);const r=this.record.array,i=this.length;for(void 0===t?t=i-1:t<0&&(t=i+t),t=this.lower+Math.min(t,i-1);t>=this.lower;){if(e.equals(r[t]))return t-this.lower;t-=1}return-1}getItem(e){e instanceof vt&&(e=e.value);const t=this.length;return e<0&&(e=t+e),e>=0&&e<t?this.record.array[this.lower+e]:tt.absent()}setItem(e,t){if(0!=(this.record.flags&lt.ImmutableFlag))throw new Error("immutable");t=tt.fromAny(t);const r=this.length;if(e<0&&(e=r+e),e<0||e>r)throw new RangeError(""+e);return 0!=(this.record.flags&lt.AliasedFlag)?this.setItemAliased(e,t):this.setItemMutable(e,t),this}setItemAliased(e,t){const r=this.record,i=r.length,n=r.array,s=new Array(lt.expand(i));for(let e=0;e<i;e+=1)s[e]=n[e];const o=null!==n?n[this.lower+e]:null;s[this.lower+e]=t,r.array=s,r.table=null,t instanceof it?o instanceof it||(r.fieldCount+=1):o instanceof it&&(r.fieldCount-=1),r.flags&=~lt.AliasedFlag}setItemMutable(e,t){const r=this.record,i=r.array,n=i[this.lower+e];i[this.lower+e]=t,t instanceof it?(r.table=null,n instanceof it||(r.fieldCount+=1)):n instanceof it&&(r.table=null,r.fieldCount-=1)}push(...e){if(0!=(this.record.flags&lt.ImmutableFlag))throw new Error("immutable");return 0!=(this.record.flags&lt.AliasedFlag)?this.pushAliased(...e):this.pushMutable(...e),this.length}pushAliased(...e){const t=this.record,r=e.length;let i=t.length,n=t.fieldCount;const s=t.array,o=new Array(lt.expand(i+r));if(null!==s){for(let e=0;e<this.upper;e+=1)o[e]=s[e];for(let e=this.upper;e<i;e+=1)o[e+r]=s[e]}for(let t=0;t<r;t+=1){const r=tt.fromAny(e[t]);o[t+this.upper]=r,i+=1,r instanceof it&&(n+=1)}t.array=o,t.table=null,t.length=i,t.fieldCount=n,t.flags&=~lt.AliasedFlag,this.upper+=r}pushMutable(...e){const t=this.record,r=e.length;let i=t.length,n=t.fieldCount;const s=t.array;let o;if(null===s||i+r>s.length){if(o=new Array(lt.expand(i+r)),null!==s)for(let e=0;e<this.upper;e+=1)o[e]=s[e]}else o=s;for(let e=i-1;e>=this.upper;e-=1)o[e+r]=s[e];for(let s=0;s<r;s+=1){const r=tt.fromAny(e[s]);o[s+this.upper]=r,i+=1,r instanceof it&&(n+=1,t.table=null)}t.array=o,t.length=i,t.fieldCount=n,this.upper+=r}splice(e,t=0,...r){if(0!=(this.record.flags&lt.ImmutableFlag))throw new Error("immutable");const i=this.length;let n;return e<0&&(e=i+e),e=Math.min(Math.max(0,e),i),t=Math.min(Math.max(0,t),i-e),n=0!=(this.record.flags&lt.AliasedFlag)?this.record.spliceAliased(this.lower+e,t,...r):this.record.spliceMutable(this.lower+e,t,...r),this.upper+=r.length-n.length,n}delete(e){if(0!=(this.record.flags&lt.ImmutableFlag))throw new Error("immutable");return e=ht.fromAny(e),0!=(this.record.flags&lt.AliasedFlag)?this.deleteAliased(e):this.deleteMutable(e)}deleteAliased(e){const t=this.record,r=t.length,i=t.array,n=new Array(lt.expand(r));for(let s=this.lower;s<this.upper;s+=1){const o=i[s];if(o instanceof it&&o.key.equals(e)){for(let e=s+1;e<r;e+=1,s+=1)n[s]=i[e];return t.array=n,t.table=null,t.length=r-1,t.fieldCount-=1,t.flags&=~lt.AliasedFlag,this.upper-=1,o}n[s]=o}return tt.absent()}deleteMutable(e){const t=this.record,r=t.length,i=t.array;for(let n=this.lower;n<this.upper;n+=1){const s=i[n];if(s instanceof it&&s.key.equals(e)){for(let e=n+1;e<r;e+=1,n+=1)i[n]=i[e];return i[r-1]=void 0,t.table=null,t.length=r-1,t.fieldCount-=1,this.upper-=1,s}}return tt.absent()}clear(){if(0!=(this.record.flags&lt.ImmutableFlag))throw new Error("immutable");0!=(this.record.flags&lt.AliasedFlag)?this.clearAliased():this.clearMutable()}clearAliased(){const e=this.record,t=e.length;let r=e.fieldCount;const i=t-this.length,n=e.array,s=new Array(lt.expand(i));let o=0;for(;o<this.lower;)s[o]=n[o],o+=1;for(;o<this.upper;)n[o]instanceof it&&(r-=1),o+=1;o=this.lower;let a=this.upper;for(;a<t;)s[o]=n[a],o+=1,a+=1;e.array=s,e.table=null,e.length=i,e.fieldCount=r,e.flags&=~lt.AliasedFlag,this.upper=this.lower}clearMutable(){const e=this.record,t=e.length;let r=e.fieldCount;const i=e.array;let n=this.lower;for(;n<this.upper;)i[n]instanceof it&&(r-=1),n+=1;n=this.lower;let s=this.upper;for(;s<t;){const t=i[s];t instanceof it&&(e.table=null),i[n]=t,n+=1,s+=1}for(e.length=n,e.fieldCount=r;n<t;)i[n]=void 0,n+=1;this.upper=this.lower}isAliased(){return 0!=(this.record.flags&lt.AliasedFlag)}isMutable(){return 0==(this.record.flags&lt.ImmutableFlag)}alias(){this.record.flags|=lt.AliasedFlag}branch(){const e=this.length;let t=0;const r=this.record.array,i=new Array(lt.expand(e));let n=this.lower,s=0;for(;s<e;){const e=r[n];i[s]=e,e instanceof it&&(t+=1),n+=1,s+=1}return new ft(i,null,e,t,0)}clone(){const e=this.length;let t=0;const r=this.record.array,i=new Array(lt.expand(e));let n=this.lower,s=0;for(;s<e;){const e=r[n];i[s]=e.clone(),e instanceof it&&(t+=1),n+=1,s+=1}return new ft(i,null,e,t,0)}commit(){return this.record.commit(),this}subRecord(e,t){const r=this.length;if(void 0===e?e=0:e<0&&(e=r+e),void 0===t?t=r:t<0&&(t=r+t),e<0||t>r||e>t)throw new RangeError(e+", "+t);return new wt(this.record,this.lower+e,this.upper+t)}forEach(e,t){const r=this.record.array;for(let i=this.lower,n=this.upper;i<n;i+=1){const n=e.call(t,r[i],i);if(void 0!==n)return n}}}Object.defineProperty(wt.prototype,"fieldCount",{get(){const e=this.record.array;let t=0;for(let r=this.lower,i=this.upper;r<i;r+=1)e[r]instanceof it&&(t+=1);return t},configurable:!0});class mt extends ht{constructor(e,t,r){super(),this.array=e,this.size=t,this.flags=r}isConstant(){return!0}getByte(e){if(e<0||e>=this.size)throw new RangeError(""+e);return this.array[e]}setByte(e,t){const r=this.flags;if(0!=(r&mt.ImmutableFlag))throw new Error("immutable");if(e<0||e>=this.size)throw new RangeError(""+e);return 0!=(r&mt.AliasedFlag)?this.setByteAliased(e,t):this.setByteMutable(e,t)}setByteAliased(e,t){const r=this.size,i=this.array,n=new Uint8Array(mt.expand(r));return n.set(i,0),n[e]=t,this.array=n,this.flags&=~mt.AliasedFlag,this}setByteMutable(e,t){return this.array[e]=t,this}addByte(e){const t=this.flags;if(0!=(t&mt.ImmutableFlag))throw new Error("immutable");return 0!=(t&mt.AliasedFlag)?this.addByteAliased(e):this.addByteMutable(e)}addByteAliased(e){const t=this.size,r=this.array,i=new Uint8Array(mt.expand(t+1));return null!==r&&i.set(r,0),i[t]=e,this.array=i,this.size=t+1,this.flags&=~mt.AliasedFlag,this}addByteMutable(e){const t=this.size,r=this.array;let i;return null===r||t+1>r.length?(i=new Uint8Array(mt.expand(t+1)),null!==r&&i.set(r,0),this.array=i):i=r,i[t]=e,this.size=t+1,this}addData(e){let t=e.array;if(null!==t){const r=e.size;return t.length>r&&(t=t.slice(0,r)),this.addUint8Array(t)}return this}addUint8Array(e){const t=this.flags;if(0!=(t&mt.ImmutableFlag))throw new Error("immutable");return 0!=(t&mt.AliasedFlag)?this.addUint8ArrayAliased(e):this.addUint8ArrayMutable(e)}addUint8ArrayAliased(e){const t=e.length;if(0===t)return this;const r=this.size,i=this.array,n=new Uint8Array(mt.expand(r+t));return null!==i&&n.set(i,0),n.set(e,r),this.array=n,this.size=r+t,this.flags&=~mt.AliasedFlag,this}addUint8ArrayMutable(e){const t=e.length;if(0===t)return this;const r=this.size,i=this.array;let n;return null===i||r+t>i.length?(n=new Uint8Array(mt.expand(r+t)),null!==i&&n.set(i,0),this.array=n):n=i,n.set(e,r),this.size=r+t,this}clear(){if(0!=(this.flags&mt.ImmutableFlag))throw new Error("immutable");this.array=null,this.size=0,this.flags=mt.AliasedFlag}toUint8Array(){const e=this.array,t=this.flags;if(0!=(t&mt.ImmutableFlag))return null!==e?e.slice(0):new Uint8Array(0);if(0!=(t&mt.AliasedFlag)||this.size!==e.length){const t=null!==e?e.slice(0):new Uint8Array(0);return this.array=t,this.flags&=~mt.AliasedFlag,t}return e}asUint8Array(){let e;return null!==this.array&&this.size>0?(e=this.array,e.length!==this.size&&(e=new Uint8Array(e.buffer,e.byteOffset,this.size))):e=void 0,e}toAny(){return this.toUint8Array()}isAliased(){return 0!=(this.flags&mt.AliasedFlag)}isMutable(){return 0==(this.flags&mt.ImmutableFlag)}branch(){return this.flags|=mt.AliasedFlag,new mt(this.array,this.size,mt.AliasedFlag)}clone(){return this.branch()}commit(){return this.flags|=mt.ImmutableFlag,this}writeBase16(e,t=Be.uppercase){let r=this.array;const i=this.size;return null!==r&&0!==i?(r.length!==i&&(r=r.slice(0,i)),t.writeUint8Array(e,r)):oe.end()}toBase16(e=Be.uppercase){const t=ue.stringOutput();return this.writeBase16(t,e).bind(),t.bind()}writeBase64(e,t=Xe.standard()){let r=this.array;const i=this.size;return null!==r&&0!==i?(r.length!==i&&(r=r.slice(0,i)),t.writeUint8Array(e,r)):oe.end()}toBase64(e=Xe.standard()){const t=ue.stringOutput();return this.writeBase64(t,e),t.bind()}interpolateTo(e){return super.interpolateTo(e)}get typeOrder(){return 4}compareTo(e){if(e instanceof mt){const t=this.array,r=e.array,i=this.size,n=e.size;let s=0,o=0;do{if(!(o<i&&o<n))break;s=t[o]-r[o],o+=1}while(0===s);return s>0?1:s<0?-1:i>n?1:i<n?-1:0}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this.equals(e)}equals(e){if(this===e)return!0;if(e instanceof mt){const t=this.array,r=e.array,i=this.size;if(i!==e.size)return!1;for(let e=0;e<i;e+=1)if(t[e]!==r[e])return!1;return!0}return!1}hashCode(){return i.mash(i.mixUint8Array(l.hash(mt),null!==this.array?this.array:new Uint8Array(0)))}debug(e){if(e=e.write("Data").write(46),0===this.size)e=e.write("empty").write(40).write(41);else{e=e.write("base16").write(40).write(34);const t=this.writeBase16(e);if(!t.isDone())return ie.error(t.trap());e=e.write(34).write(41)}return e}static empty(){return new mt(null,0,mt.AliasedFlag|mt.ImmutableFlag)}static create(e){return void 0===e?new mt(null,0,mt.AliasedFlag):new mt(new Uint8Array(e),0,0)}static wrap(e){return new mt(e,e.length,mt.AliasedFlag)}static fromBase16(e){return"string"==typeof e&&(e=ue.stringInput(e)),Be.parse(e,mt.output()).bind()}static fromBase64(e,t=Xe.standard()){return"string"==typeof e&&(e=ue.stringInput(e)),t.parse(e,mt.output()).bind()}static fromAny(e){if(e instanceof mt)return e;if(e instanceof Uint8Array)return mt.wrap(e);throw new TypeError(""+e)}static random(e){const r=new Uint8Array(e);return t.fillBytes(r),mt.wrap(r)}static output(e){return e instanceof mt||(e=mt.create(e)),new gt(e,X.standard())}static expand(e){return e=Math.max(32,e)-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}}mt.AliasedFlag=1,mt.ImmutableFlag=2,e([n],mt,"empty",null);class gt extends ie{constructor(e,t){super(),this.data=e,this.settings=t}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(e){return this}write(e){if("number"==typeof e)return this.data.addByte(e),this;throw new TypeError(""+e)}writeln(e){throw new TypeError(""+e)}withSettings(e){return e=X.fromAny(e),this.settings=e,this}bind(){return this.data}clone(){return new gt(this.data.branch(),this.settings)}}class yt extends ht{constructor(e){super(),this.value=e,this.hashValue=void 0}isConstant(){return!0}get size(){return this.value.length}stringValue(e){return this.value}numberValue(e){try{return vt.parse(this.value).numberValue()}catch(t){return e}}booleanValue(e){return"true"===this.value||"false"!==this.value&&e}toAny(){return this.value}valueOf(){return this.value}plus(e){return(e=tt.fromAny(e))instanceof yt?yt.from(this.value+e.value):super.plus(e)}branch(){return this}clone(){return this}commit(){return this}interpolateTo(e){return super.interpolateTo(e)}get typeOrder(){return 5}compareTo(e){return e instanceof yt?this.value.localeCompare(e.value):e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this.equals(e)}equals(e){return this===e||e instanceof yt&&this.value===e.value}hashCode(){let e=this.hashValue;return void 0===e&&(e=u.hash(this.value),this.hashValue=e),e}debug(e){return e=e.write("Text").write(46),e=0===this.value.length?e.write("empty").write(40).write(41):e.write("from").write(40).debug(this.value).write(41)}display(e){return he.debugAny(e,this.value)}toString(){return this.value}static empty(){return new yt("")}static from(e){const t=e.length;if(0===t)return yt.empty();{let r=new yt(e);return t<=64&&(r=yt.cache.put(r)),r}}static fromAny(e){if(e instanceof yt)return e;if("string"==typeof e)return yt.from(e);throw new TypeError(""+e)}static output(e){return void 0===e&&(e=X.standard()),new bt("",e)}static get cache(){return new R(128)}}e([n],yt,"empty",null),e([n],yt,"cache",null);class bt extends ie{constructor(e,t){super(),this.string=e,this.settings=t}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(e){return this}write(e){if("number"==typeof e)if(e>=0&&e<=55295||e>=57344&&e<=65535)e=String.fromCharCode(e);else if(e>=65536&&e<=1114111){const t=e-65536;e=String.fromCharCode(55296|t>>>10,56320|1023&t)}else e="�";return this.string+=e,this}withSettings(e){return e=X.fromAny(e),this.settings=e,this}bind(){return yt.from(this.string)}clone(){return new bt(this.string,this.settings)}toString(){return this.string}}class vt extends ht{constructor(e,t){super(),this.value=e,this.flags=void 0!==t?t:0}isConstant(){return!0}isNaN(){return isNaN(this.value)}isInfinite(){return!isNaN(this.value)&&!isFinite(this.value)}isUint32(){return 0!=(this.flags&vt.Uint32Flag)}isUint64(){return 0!=(this.flags&vt.Uint64Flag)}stringValue(e){return""+this.value}numberValue(e){return this.value}booleanValue(e){return!!this.value}toAny(){return this.value}valueOf(){return this.value}bitwiseOr(e){return(e=tt.fromAny(e))instanceof vt?vt.from((this.value|e.value)>>>0):super.bitwiseOr(e)}bitwiseXor(e){return(e=tt.fromAny(e))instanceof vt?vt.from((this.value^e.value)>>>0):super.bitwiseXor(e)}bitwiseAnd(e){return(e=tt.fromAny(e))instanceof vt?vt.from((this.value&e.value)>>>0):super.bitwiseAnd(e)}plus(e){return(e=tt.fromAny(e))instanceof vt?vt.from(this.value+e.value):super.plus(e)}minus(e){return(e=tt.fromAny(e))instanceof vt?vt.from(this.value-e.value):super.minus(e)}times(e){return(e=tt.fromAny(e))instanceof vt?vt.from(this.value*e.value):super.times(e)}divide(e){return(e=tt.fromAny(e))instanceof vt?vt.from(this.value/e.value):super.divide(e)}modulo(e){return(e=tt.fromAny(e))instanceof vt?vt.from(this.value%e.value):super.modulo(e)}bitwiseNot(){return vt.from(~this.value>>>0)}negative(){return vt.from(-this.value)}positive(){return this}inverse(){return vt.from(1/this.value)}abs(){return vt.from(Math.abs(this.value))}ceil(){return vt.from(Math.ceil(this.value))}floor(){return vt.from(Math.floor(this.value))}round(){return vt.from(Math.round(this.value))}sqrt(){return vt.from(Math.sqrt(this.value))}pow(e){return e=vt.fromAny(e),vt.from(Math.pow(this.value,e.value))}max(e){return this.compareTo(e)>=0?this:e}min(e){return this.compareTo(e)<=0?this:e}interpolateTo(e){return e instanceof vt?xt(this,e):super.interpolateTo(e)}get typeOrder(){return 6}compareTo(e){if(e instanceof vt){const t=this.value,r=e.value;return t<r?-1:t>r?1:isNaN(r)?isNaN(t)?0:-1:isNaN(t)?1:0}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){if(this===e)return!0;if(e instanceof vt){const r=this.value,i=e.value;return r===i||isNaN(r)&&isNaN(i)||Math.abs(i-r)<(void 0!==t?t:o.Epsilon)}return!1}equals(e){if(this===e)return!0;if(e instanceof vt){const t=this.value,r=e.value;return t===r||isNaN(t)&&isNaN(r)}return!1}hashCode(){return a.hash(this.value)}debug(e){return e=e.write("Num").write(46).write("from").write(40).display(this).write(41)}display(e){return he.displayNumber(e,this.value)}static get zero(){return new vt(0)}static get negativeZero(){return new vt(-0)}static get one(){return new vt(1)}static get negativeOne(){return new vt(-1)}static get nan(){return new vt(NaN)}static uint32(e){return new vt(e,vt.Uint32Flag)}static uint64(e){return new vt(e,vt.Uint64Flag)}static from(e){return 0===e?1/e==-1/0?vt.negativeZero:vt.zero:1===e?vt.one:-1===e?vt.negativeOne:isNaN(e)?vt.nan:vt.cache.put(new vt(e))}static fromAny(e){if(e instanceof vt)return e;if("number"==typeof e)return vt.from(e);throw new TypeError(""+e)}static parse(e){if("NaN"===e)return vt.nan;{const t=+e;if(isFinite(t))return vt.from(t)}throw new Error(e)}static get cache(){return new R(128)}}vt.Uint32Flag=1,vt.Uint64Flag=2,vt.TypeMask=3,e([n],vt,"zero",null),e([n],vt,"negativeZero",null),e([n],vt,"one",null),e([n],vt,"negativeOne",null),e([n],vt,"nan",null),e([n],vt,"cache",null);const xt=function(e){const t=function(e,r){const i=function(e){const t=i[0].value,r=i[1].value;return vt.from(t+e*(r-t))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(x);class Ot extends ht{constructor(e){super(),Object.defineProperty(this,"value",{value:e,enumerable:!0}),Object.defineProperty(this,"hashValue",{value:u.hash(e?"true":"false")})}isDefinite(){return this.value}isConstant(){return!0}stringValue(e){return this.value?"true":"false"}booleanValue(e){return this.value}toAny(){return this.value}valueOf(){return this.value}conditional(e,t){return this.value?tt.fromAny(e):tt.fromAny(t)}or(e){return this.value?this:tt.fromAny(e)}and(e){return this.value?tt.fromAny(e):this}not(){return Ot.from(!this.value)}get typeOrder(){return 7}compareTo(e){return e instanceof Ot?this.value&&!e.value?-1:!this.value&&e.value?1:0:e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this.equals(e)}equals(e){return this===e||e instanceof Ot&&this.value===e.value}hashCode(){return this.hashValue}debug(e){return e=e.write("Bool").write(46).write("from").write(40).write(this.value?"true":"false").write(41)}display(e){return e=e.write(this.value?"true":"false")}static get true(){return new Ot(!0)}static get false(){return new Ot(!1)}static from(e){return e?Ot.true:Ot.false}static fromAny(e){if(e instanceof Ot)return e;if("boolean"==typeof e)return Ot.from(e);throw new TypeError(""+e)}}e([n],Ot,"true",null),e([n],Ot,"false",null);class Et extends ht{constructor(){super()}isDefined(){return!0}isDistinct(){return!1}isDefinite(){return!1}isConstant(){return!0}unflattened(){return lt.empty()}not(){return ht.absent()}stringValue(e){return""}booleanValue(e){return!0}toAny(){return null}interpolateTo(e){return super.interpolateTo(e)}get typeOrder(){return 98}compareTo(e){return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this===e}equals(e){return this===e}hashCode(){return l.hash(Et)}debug(e){return e=e.write("Value").write(46).write("extant").write(40).write(41)}display(e){return e=e.write("null")}static extant(){return new Et}static fromAny(e){if(e instanceof Et)return e;if(null===e)return Et.extant();throw new TypeError(""+e)}}e([n],Et,"extant",null);class Ct extends ht{constructor(){super()}isDefined(){return!1}isDistinct(){return!1}isDefinite(){return!1}isConstant(){return!0}unflattened(){return lt.empty()}updated(e,t){return lt.of(nt.of(e,t))}updatedAttr(e,t){return lt.of(ot.of(e,t))}updatedSlot(e,t){return lt.of(nt.of(e,t))}appended(...e){return lt.of(e)}prepended(...e){return lt.of(e)}concat(...e){const t=lt.create();for(let r=0,i=e.length;r<i;r+=1)tt.fromAny(e[r]).forEach((function(e){t.push(e)}));return t}conditional(e,t){return tt.fromAny(t)}or(e){return tt.fromAny(e)}and(e){return this}not(){return ht.extant()}booleanValue(e){return!1}toAny(){}forEach(e,t){}iterator(){return j.empty()}interpolateTo(e){return super.interpolateTo(e)}get typeOrder(){return 99}compareTo(e){return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this===e}equals(e){return this===e}hashCode(){return l.hash(Ct)}debug(e){return e=e.write("Value").write(46).write("absent").write(40).write(41)}display(e){return e=e.write("undefined")}static absent(){return new Ct}static fromAny(e){if(e instanceof Ct)return e;if(void 0===e)return Ct.absent();throw new TypeError(""+e)}}e([n],Ct,"absent",null);class At extends ht{constructor(){super()}conditional(e,t){return e=tt.fromAny(e),t=tt.fromAny(t),new qt(this,e,t)}or(e){return e=tt.fromAny(e),new Mt(this,e)}and(e){return e=tt.fromAny(e),new jt(this,e)}bitwiseOr(e){return e=tt.fromAny(e),new Lt(this,e)}bitwiseXor(e){return e=tt.fromAny(e),new Ft(this,e)}bitwiseAnd(e){return e=tt.fromAny(e),new Bt(this,e)}lt(e){return e=tt.fromAny(e),new Ut(this,e)}le(e){return e=tt.fromAny(e),new Wt(this,e)}eq(e){return e=tt.fromAny(e),new Rt(this,e)}ne(e){return e=tt.fromAny(e),new Ht(this,e)}ge(e){return e=tt.fromAny(e),new Kt(this,e)}gt(e){return e=tt.fromAny(e),new _t(this,e)}plus(e){return e=tt.fromAny(e),new Gt(this,e)}minus(e){return e=tt.fromAny(e),new Qt(this,e)}times(e){return e=tt.fromAny(e),new Zt(this,e)}divide(e){return e=tt.fromAny(e),new Xt(this,e)}modulo(e){return e=tt.fromAny(e),new $t(this,e)}not(){return new Yt(this)}bitwiseNot(){return new Jt(this)}negative(){return new er(this)}positive(){return new tr(this)}inverse(){return new Xt(vt.one,this)}toAny(){return this}}class St extends At{constructor(){super()}static binary(e,t,r){switch(t){case"||":return new Mt(e,r);case"&&":return new jt(e,r);case"|":return new Lt(e,r);case"^":return new Ft(e,r);case"&":return new Bt(e,r);case"<":return new Ut(e,r);case"<=":return new Wt(e,r);case"==":return new Rt(e,r);case"!=":return new Ht(e,r);case">=":return new Kt(e,r);case">":return new _t(e,r);case"+":return new Gt(e,r);case"-":return new Qt(e,r);case"*":return new Zt(e,r);case"/":return new Xt(e,r);case"%":return new $t(e,r);default:throw new Error(t)}}static unary(e,t){switch(e){case"!":return new Yt(t);case"~":return new Jt(t);case"-":return new er(t);case"+":return new tr(t);default:throw new Error(e)}}}class kt extends St{constructor(e,t){super(),this.operand1=e,this.operand2=t}isConstant(){return this.operand1.isConstant()&&this.operand2.isConstant()}interpolateTo(e){return e instanceof kt&&this.operator===e.operator?Tt(this,e):super.interpolateTo(e)}}const Tt=function(e){const t=function(e,r){const i=e.operator;if(i!==r.operator)throw new Error;const n=function(e){const t=n.operand1Interpolator(e),r=n.operand2Interpolator(e);return St.binary(t,n.operator,r)};return Object.setPrototypeOf(n,t.prototype),n.operand1Interpolator=e.operand1.interpolateTo(r.operand1),n.operator=i,n.operand2Interpolator=e.operand2.interpolateTo(r.operand2),n};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.operand1Interpolator[0],t=this.operand2Interpolator[0];return St.binary(e,this.operator,t)},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.operand1Interpolator[1],t=this.operand2Interpolator[1];return St.binary(e,this.operator,t)},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.operator===e.operator&&this.operand1Interpolator.equals(e.operand1Interpolator)&&this.operand2Interpolator.equals(e.operand2Interpolator))},t}(x);class Pt extends St{constructor(e){super(),this.operand=e}isConstant(){return this.operand.isConstant()}interpolateTo(e){return e instanceof Pt&&this.operator===e.operator?Dt(this,e):super.interpolateTo(e)}}const Dt=function(e){const t=function(e,r){const i=e.operator;if(i!==r.operator)throw new Error;const n=function(e){const t=n.operandInterpolator(e);return St.unary(n.operator,t)};return Object.setPrototypeOf(n,t.prototype),n.operator=i,n.operandInterpolator=e.operand.interpolateTo(r.operand),n};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.operandInterpolator[0];return St.unary(this.operator,e)},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.operandInterpolator[1];return St.unary(this.operator,e)},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.operator===e.operator&&this.operandInterpolator.equals(e.operandInterpolator))},t}(x);class qt extends St{constructor(e,t,r){super(),this.ifTerm=e.commit(),this.thenTerm=t.commit(),this.elseTerm=r.commit()}isConstant(){return this.ifTerm.isConstant()&&this.thenTerm.isConstant()&&this.elseTerm.isConstant()}get precedence(){return 2}evaluate(e){let t;(e=zt.fromAny(e)).willOperate(this);if(this.ifTerm.evaluate(e).isDefinite()){t=this.thenTerm.evaluate(e)}else{t=this.elseTerm.evaluate(e)}return e.didOperate(this,t),t}substitute(e){e=zt.fromAny(e);const t=this.ifTerm.substitute(e),r=this.thenTerm.substitute(e),i=this.elseTerm.substitute(e);return new qt(t,r,i)}interpolateTo(e){return e instanceof qt?It(this,e):super.interpolateTo(e)}get typeOrder(){return 20}compareTo(e){if(e instanceof qt){let t=this.ifTerm.compareTo(e.ifTerm);return 0===t&&(t=this.thenTerm.compareTo(e.thenTerm),0===t&&(t=this.elseTerm.compareTo(e.elseTerm))),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof qt&&(this.ifTerm.equivalentTo(e.ifTerm,t)&&this.thenTerm.equivalentTo(e.thenTerm,t)&&this.elseTerm.equivalentTo(e.elseTerm,t))}equals(e){return this===e||e instanceof qt&&(this.ifTerm.equals(e.ifTerm)&&this.thenTerm.equals(e.thenTerm)&&this.elseTerm.equals(e.elseTerm))}hashCode(){return i.mash(i.mix(i.mix(i.mix(l.hash(qt),this.ifTerm.hashCode()),this.thenTerm.hashCode()),this.elseTerm.hashCode()))}debug(e){return e=e.debug(this.ifTerm).write(46).write("conditional").write(40).debug(this.thenTerm).write(44).write(32).debug(this.elseTerm).write(41)}clone(){return new qt(this.ifTerm.clone(),this.thenTerm.clone(),this.elseTerm.clone())}}const It=function(e){const t=function(e,r){const i=function(e){const t=i.ifTermInterpolator(e),r=i.thenTermInterpolator(e),n=i.elseTermInterpolator(e);return new qt(t,r,n)};return Object.setPrototypeOf(i,t.prototype),i.ifTermInterpolator=e.ifTerm.interpolateTo(r.ifTerm),i.thenTermInterpolator=e.thenTerm.interpolateTo(r.thenTerm),i.elseTermInterpolator=e.elseTerm.interpolateTo(r.elseTerm),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.ifTermInterpolator[0],t=this.thenTermInterpolator[0],r=this.elseTermInterpolator[0];return new qt(e,t,r)},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.ifTermInterpolator[1],t=this.thenTermInterpolator[1],r=this.elseTermInterpolator[1];return new qt(e,t,r)},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.ifTermInterpolator.equals(e.ifTermInterpolator)&&this.thenTermInterpolator.equals(e.thenTermInterpolator)&&this.elseTermInterpolator.equals(e.elseTermInterpolator))},t}(x);class Vt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Vt.prototype)}}class Nt{constructor(e){Object.defineProperty(this,"maxScopeDepth",{value:e,enumerable:!0})}withMaxScopeDepth(e){return this.copy(e)}copy(e){return new Nt(e)}canEqual(e){return e instanceof Nt}equals(e){return this===e||e instanceof Nt&&(e.canEqual(this)&&this.maxScopeDepth===e.maxScopeDepth)}hashCode(){return i.mash(i.mix(l.hash(Nt),a.hash(this.maxScopeDepth)))}debug(e){return e=e.write("new").write(32).write("InterpreterSettings").write(40).debug(this.maxScopeDepth).write(41)}toString(){return he.debug(this)}static standard(){return new Nt(1024)}}e([n],Nt,"standard",null);class zt{constructor(e,t,r){this.settings=void 0!==e?e:Nt.standard(),this.scopeStack=void 0!==t?t:null,this.scopeDepth=void 0!==r?r:0}withSettings(e){return this.settings=e,this}peekScope(){const e=this.scopeDepth;if(e<=0)throw new Vt("scope stack empty");return this.scopeStack[e-1]}getScope(e){if(e<0||e>=this.scopeDepth)throw new RangeError(""+e);return this.scopeStack[e]}pushScope(e){const t=this.scopeDepth;if(t>=this.settings.maxScopeDepth)throw new Vt("scope stack overflow");const r=this.scopeStack;let i;if(null===r||t+1>r.length){if(i=new Array(zt.expand(t+1)),null!==r)for(let e=0;e<t;e+=1)i[e]=r[e];this.scopeStack=i}else i=r;i[t]=e,this.scopeDepth+=1}popScope(){const e=this.scopeDepth;if(e<=0)throw new Vt("scope stack empty");const t=this.scopeStack,r=t[e-1];return t[e-1]=void 0,this.scopeDepth-=1,r}swapScope(e){const t=this.scopeDepth;if(t<=0)throw new Vt("scope stack empty");const r=this.scopeStack,i=r[t-1];return r[t-1]=e,i}willOperate(e){}didOperate(e,t){}willSelect(e){}didSelect(e,t){}willTransform(e){}didTransform(e,t){}static of(...e){const t=e.length,r=new Array(zt.expand(t));for(let i=0;i<t;i+=1){const t=tt.fromAny(e[i]);r[i]=t}return new zt(Nt.standard(),r,t)}static fromAny(e,t=tt.globalScope()){if(!(e instanceof zt)){const r=e;e=new zt,void 0!==t&&e.pushScope(t),void 0!==r&&e.pushScope(tt.fromAny(r))}return e}static expand(e){return e=Math.max(32,e)-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}}class Mt extends kt{constructor(e,t){super(e,t)}get operator(){return"||"}get precedence(){return 3}evaluate(e){let t;(e=zt.fromAny(e)).willOperate(this);const r=this.operand1.evaluate(e);if(r.isDefinite())t=r;else{t=this.operand2.evaluate(e)}return e.didOperate(this,t),t}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.or(r)}get typeOrder(){return 21}compareTo(e){if(e instanceof Mt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Mt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Mt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Mt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("or").write(40).debug(this.operand2).write(41)}clone(){return new Mt(this.operand1.clone(),this.operand2.clone())}}class jt extends kt{constructor(e,t){super(e,t)}get operator(){return"&&"}get precedence(){return 4}evaluate(e){let t;(e=zt.fromAny(e)).willOperate(this);const r=this.operand1.evaluate(e);if(r.isDefinite()){t=this.operand2.evaluate(e)}else t=r;return e.didOperate(this,t),t}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.and(r)}get typeOrder(){return 22}compareTo(e){if(e instanceof jt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof jt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof jt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(jt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("and").write(40).debug(this.operand2).write(41)}clone(){return new jt(this.operand1.clone(),this.operand2.clone())}}class Lt extends kt{constructor(e,t){super(e,t)}get operator(){return"|"}get precedence(){return 5}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.bitwiseOr(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.bitwiseOr(r)}get typeOrder(){return 23}compareTo(e){if(e instanceof Lt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Lt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Lt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Lt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("bitwiseOr").write(40).debug(this.operand2).write(41)}clone(){return new Lt(this.operand1.clone(),this.operand2.clone())}}class Ft extends kt{constructor(e,t){super(e,t)}get operator(){return"^"}get precedence(){return 6}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.bitwiseXor(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.bitwiseXor(r)}get typeOrder(){return 24}compareTo(e){if(e instanceof Ft){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Ft&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Ft&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Ft),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("bitwiseXor").write(40).debug(this.operand2).write(41)}clone(){return new Ft(this.operand1.clone(),this.operand2.clone())}}class Bt extends kt{constructor(e,t){super(e,t)}get operator(){return"&"}get precedence(){return 7}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.bitwiseAnd(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.bitwiseAnd(r)}get typeOrder(){return 25}compareTo(e){if(e instanceof Bt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Bt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Bt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Bt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("bitwiseAnd").write(40).debug(this.operand2).write(41)}clone(){return new Bt(this.operand1.clone(),this.operand2.clone())}}class Ut extends kt{constructor(e,t){super(e,t)}get operator(){return"<"}get precedence(){return 0}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.lt(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.lt(r)}get typeOrder(){return 26}compareTo(e){if(e instanceof Ut){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Ut&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Ut&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Ut),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e.debug(this.operand1).write(46).write("lt").write(40).debug(this.operand2).write(41)}clone(){return new Ut(this.operand1.clone(),this.operand2.clone())}}class Wt extends kt{constructor(e,t){super(e,t)}get operator(){return"<="}get precedence(){return 0}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.le(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.le(r)}get typeOrder(){return 27}compareTo(e){if(e instanceof Wt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Wt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Wt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Wt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e.debug(this.operand1).write(46).write("le").write(40).debug(this.operand2).write(41)}clone(){return new Wt(this.operand1.clone(),this.operand2.clone())}}class Rt extends kt{constructor(e,t){super(e,t)}get operator(){return"=="}get precedence(){return 0}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.eq(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.eq(r)}get typeOrder(){return 28}compareTo(e){if(e instanceof Rt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Rt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Rt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Rt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("eq").write(40).debug(this.operand2).write(41)}clone(){return new Rt(this.operand1.clone(),this.operand2.clone())}}class Ht extends kt{constructor(e,t){super(e,t)}get operator(){return"!="}get precedence(){return 0}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.ne(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.ne(r)}get typeOrder(){return 29}compareTo(e){if(e instanceof Ht){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Ht&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Ht&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Ht),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("ne").write(40).debug(this.operand2).write(41)}clone(){return new Ht(this.operand1.clone(),this.operand2.clone())}}class Kt extends kt{constructor(e,t){super(e,t)}get operator(){return">="}get precedence(){return 0}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.ge(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.ge(r)}get typeOrder(){return 30}compareTo(e){if(e instanceof Kt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Kt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Kt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Kt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("ge").write(40).debug(this.operand2).write(41)}clone(){return new Kt(this.operand1.clone(),this.operand2.clone())}}class _t extends kt{constructor(e,t){super(e,t)}get operator(){return">"}get precedence(){return 0}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.gt(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.gt(r)}get typeOrder(){return 31}compareTo(e){if(e instanceof _t){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof _t&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof _t&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(_t),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("gt").write(40).debug(this.operand2).write(41)}clone(){return new _t(this.operand1.clone(),this.operand2.clone())}}class Gt extends kt{constructor(e,t){super(e,t)}get operator(){return"+"}get precedence(){return 8}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.plus(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.plus(r)}get typeOrder(){return 32}compareTo(e){if(e instanceof Gt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Gt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Gt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Gt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("plus").write(40).debug(this.operand2).write(41)}clone(){return new Gt(this.operand1.clone(),this.operand2.clone())}}class Qt extends kt{constructor(e,t){super(e,t)}get operator(){return"-"}get precedence(){return 8}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.minus(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.minus(r)}get typeOrder(){return 33}compareTo(e){if(e instanceof Qt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Qt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Qt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Qt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("minus").write(40).debug(this.operand2).write(41)}clone(){return new Qt(this.operand1.clone(),this.operand2.clone())}}class Zt extends kt{constructor(e,t){super(e,t)}get operator(){return"*"}get precedence(){return 9}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.times(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.times(r)}get typeOrder(){return 34}compareTo(e){if(e instanceof Zt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Zt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Zt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Zt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("times").write(40).debug(this.operand2).write(41)}clone(){return new Zt(this.operand1.clone(),this.operand2.clone())}}class Xt extends kt{constructor(e,t){super(e,t)}get operator(){return"/"}get precedence(){return 9}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.divide(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.divide(r)}get typeOrder(){return 35}compareTo(e){if(e instanceof Xt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Xt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Xt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash(Xt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("divide").write(40).debug(this.operand2).write(41)}clone(){return new Xt(this.operand1.clone(),this.operand2.clone())}}class $t extends kt{constructor(e,t){super(e,t)}get operator(){return"%"}get precedence(){return 9}evaluate(e){(e=zt.fromAny(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.modulo(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.modulo(r)}get typeOrder(){return 36}compareTo(e){if(e instanceof $t){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof $t&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof $t&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return i.mash(i.mix(i.mix(l.hash($t),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("modulo").write(40).debug(this.operand2).write(41)}clone(){return new $t(this.operand1.clone(),this.operand2.clone())}}class Yt extends Pt{constructor(e){super(e)}get operator(){return"!"}get precedence(){return 10}evaluate(e){e=zt.fromAny(e);return this.operand.evaluate(e).not()}substitute(e){e=zt.fromAny(e);return this.operand.substitute(e).not()}get typeOrder(){return 37}compareTo(e){return a.compare(this.typeOrder,e.typeOrder)}equivalentTo(e,t){return this===e||e instanceof Yt&&this.operand.equivalentTo(e.operand,t)}equals(e){return this===e||e instanceof Yt&&this.operand.equals(e.operand)}hashCode(){return i.mash(i.mix(l.hash(Yt),this.operand.hashCode()))}debug(e){return e=e.debug(this.operand).write(46).write("not").write(40).write(41)}clone(){return new Yt(this.operand.clone())}}class Jt extends Pt{constructor(e){super(e)}get operator(){return"~"}get precedence(){return 10}evaluate(e){e=zt.fromAny(e);return this.operand.evaluate(e).bitwiseNot()}substitute(e){e=zt.fromAny(e);return this.operand.substitute(e).bitwiseNot()}get typeOrder(){return 38}compareTo(e){return e instanceof Jt?this.operand.compareTo(e.operand):e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Jt&&this.operand.equivalentTo(e.operand,t)}equals(e){return this===e||e instanceof Jt&&this.operand.equals(e.operand)}hashCode(){return i.mash(i.mix(l.hash(Jt),this.operand.hashCode()))}debug(e){return e=e.debug(this.operand).write(46).write("bitwiseNot").write(40).write(41)}clone(){return new Jt(this.operand.clone())}}class er extends Pt{constructor(e){super(e)}get operator(){return"-"}get precedence(){return 10}evaluate(e){e=zt.fromAny(e);return this.operand.evaluate(e).negative()}substitute(e){e=zt.fromAny(e);return this.operand.substitute(e).negative()}get typeOrder(){return 39}compareTo(e){return e instanceof er?this.operand.compareTo(e.operand):e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof er&&this.operand.equivalentTo(e.operand,t)}equals(e){return this===e||e instanceof er&&this.operand.equals(e.operand)}hashCode(){return i.mash(i.mix(l.hash(er),this.operand.hashCode()))}debug(e){return e=e.debug(this.operand).write(46).write("negative").write(40).write(41)}clone(){return new er(this.operand.clone())}}class tr extends Pt{constructor(e){super(e)}get operator(){return"+"}get precedence(){return 10}evaluate(e){e=zt.fromAny(e);return this.operand.evaluate(e).positive()}substitute(e){e=zt.fromAny(e);return this.operand.substitute(e).positive()}get typeOrder(){return 40}compareTo(e){return e instanceof tr?this.operand.compareTo(e.operand):e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof tr&&this.operand.equivalentTo(e.operand,t)}equals(e){return this===e||e instanceof tr&&this.operand.equals(e.operand)}hashCode(){return i.mash(i.mix(l.hash(tr),this.operand.hashCode()))}debug(e){return e=e.debug(this.operand).write(46).write("positive").write(40).write(41)}clone(){return new tr(this.operand.clone())}}class rr extends St{constructor(e,t){super(),this.func=e,this.args=t.commit(),this.state=void 0}setState(e){this.state=e}isConstant(){return this.func.isConstant()&&this.args.isConstant()}get precedence(){return 11}evaluate(e){e=zt.fromAny(e);const t=this.func.evaluate(e);return t instanceof wr?t.invoke(this.args,e,this):tt.absent()}substitute(e){e=zt.fromAny(e);const t=this.func.evaluate(e);if(t instanceof wr){const r=t.expand(this.args,e,this);if(void 0!==r)return r}const r=this.args.substitute(e).toValue();return new rr(this.func,r)}interpolateTo(e){return e instanceof rr?ir(this,e):super.interpolateTo(e)}get typeOrder(){return 41}compareTo(e){if(e instanceof rr){let t=this.func.compareTo(e.func);return 0===t&&(t=this.args.compareTo(e.args)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof rr&&(this.func.equals(e.func)&&this.args.equivalentTo(e.args,t))}equals(e){return this===e||e instanceof rr&&(this.func.equals(e.func)&&this.args.equals(e.args))}hashCode(){return i.mash(i.mix(i.mix(l.hash(rr),this.func.hashCode()),this.args.hashCode()))}debug(e){return e=e.debug(this.func).write(46).write("invoke").write(40).debug(this.args).write(41)}clone(){return new rr(this.func.clone(),this.args.clone())}}const ir=function(e){const t=function(e,r){const i=function(e){const t=i.funcInterpolator(e),r=i.argsInterpolator(e);return new rr(t,r)};return Object.setPrototypeOf(i,t.prototype),i.funcInterpolator=e.func.interpolateTo(r.func),i.argsInterpolator=e.args.interpolateTo(r.args),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.funcInterpolator[0],t=this.argsInterpolator[0];return new rr(e,t)},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.funcInterpolator[1],t=this.argsInterpolator[1];return new rr(e,t)},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.funcInterpolator.equals(e.funcInterpolator)&&this.argsInterpolator.equals(e.argsInterpolator))},t}(x);class nr extends At{constructor(){super()}isConstant(){return!1}evaluate(e){e=zt.fromAny(e);const t=lt.create();return this.forSelected(e,(function(e){const r=e.peekScope();void 0!==r&&t.push(r)}),this),t.isEmpty()?tt.absent():t.flattened()}get(e){return e=ht.fromAny(e),this.andThen(new or(e,nr.identity()))}getAttr(e){return e=yt.fromAny(e),this.andThen(new ar(e,nr.identity()))}getItem(e){return e=vt.fromAny(e),this.andThen(new ur(e,nr.identity()))}keys(){return this.andThen(nr.keys())}values(){return this.andThen(nr.values())}children(){return this.andThen(nr.children())}descendants(){return this.andThen(nr.descendants())}filter(e){return 0===arguments.length?new pr(this,nr.identity()):(e=tt.fromAny(e),this.andThen(e.filter()))}invoke(e){return new rr(this,e)}get precedence(){return 11}debug(e){return e=e.write("Selector").write(46).write("identity").write(40).write(41),e=this.debugThen(e)}static identity(){return new sr}static get(e){return e=ht.fromAny(e),new or(e,nr.identity())}static getAttr(e){return e=yt.fromAny(e),new ar(e,nr.identity())}static getItem(e){return e=vt.fromAny(e),new ur(e,nr.identity())}static keys(){return new hr(nr.identity())}static values(){return new lr(nr.identity())}static children(){return new cr(nr.identity())}static descendants(){return new dr(nr.identity())}static literal(e){return(e=tt.fromAny(e))instanceof nr||(e=new fr(e,nr.identity())),e}}e([n],nr,"identity",null),e([n],nr,"keys",null),e([n],nr,"values",null),e([n],nr,"children",null),e([n],nr,"descendants",null);class sr extends nr{get then(){return this}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope(),s=n.evaluate(e);e.pushScope(s),i=t.call(r,e),e.swapScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){return t.call(r,e)}substitute(e){return(e=zt.fromAny(e)).peekScope().substitute(e)}get(e){return e=ht.fromAny(e),new or(e,this)}getAttr(e){return e=yt.fromAny(e),new ar(e,this)}getItem(e){return e=vt.fromAny(e),new ur(e,this)}andThen(e){return e}keys(){return nr.keys()}values(){return nr.values()}children(){return nr.children()}descendants(){return nr.descendants()}filter(e){return 0===arguments.length?new pr(this,this):(e=tt.fromAny(e)).filter()}get typeOrder(){return 10}compareTo(e){return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this===e}equals(e){return this===e}hashCode(){return l.hash(sr)}debugThen(e){return e}clone(){return this}}class or extends nr{constructor(e,t){super(),this.item=e.commit(),this.then=t}forSelected(e,t,r){e.willSelect(this);const i=this.item.evaluate(e).toValue(),n=or.forSelected(i,this.then,e,t,r);return e.didSelect(this,n),n}static forSelected(e,t,r,i,n){let s;if(0!==r.scopeDepth){const o=r.popScope().toValue();let a;o instanceof lt&&(a=o.getField(e),void 0!==a&&(r.pushScope(a.toValue()),s=t.forSelected(r,i,n),r.popScope())),void 0===a&&void 0===s&&or.forSelected(e,t,r,i,n),r.pushScope(o)}return s}mapSelected(e,t,r){let i;e.willTransform(this);const n=this.item.evaluate(e).toValue();if(0!==e.scopeDepth){const s=e.popScope().toValue();if(s instanceof lt){const i=s.getField(n);if(void 0!==i){e.pushScope(i.toValue());const o=this.then.mapSelected(e,t,r);e.popScope(),o instanceof it?n.equals(o.key)?s.set(n,o.toValue()):(s.delete(n),s.push(o)):o.isDefined()?s.set(n,o.toValue()):s.delete(n)}}e.pushScope(s),i=s}else i=tt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.item.evaluate(e).toValue(),r=or.substitute(t,this.then,e);if(void 0!==r)return r;let i=this.then.substitute(e);return i instanceof nr||(i=this.then),new or(this.item,i)}static substitute(e,t,r){let i;if(0!==r.scopeDepth){const n=r.popScope().toValue();let s;n instanceof lt&&(s=n.getField(e),void 0!==s&&(i=s.toValue().substitute(r))),void 0===s&&void 0===i&&or.substitute(e,t,r),r.pushScope(n)}return i}andThen(e){return new or(this.item,this.then.andThen(e))}get typeOrder(){return 12}compareTo(e){if(e instanceof or){let t=this.item.compareTo(e.item);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof or&&(this.item.equals(e.item)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof or&&(this.item.equals(e.item)&&this.then.equals(e.then))}hashCode(){return i.mash(i.mix(i.mix(l.hash(or),this.item.hashCode()),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("get").write(40).debug(this.item).write(41),e=this.then.debugThen(e)}clone(){return new or(this.item.clone(),this.then.clone())}}class ar extends nr{constructor(e,t){super(),this.item=e,this.then=t}forSelected(e,t,r){e.willSelect(this);const i=this.item,n=ar.forSelected(i,this.then,e,t);return e.didSelect(this,n),n}static forSelected(e,t,r,i,n){let s;if(0!==r.scopeDepth){const o=r.popScope().toValue();let a;o instanceof lt&&(a=o.getField(e),a instanceof ot&&(r.pushScope(a.toValue()),s=t.forSelected(r,i,n),r.popScope())),void 0===a&&void 0===s&&ar.forSelected(e,t,r,i,n),r.pushScope(o)}return s}mapSelected(e,t,r){let i;e.willTransform(this);const n=this.item;if(0!==e.scopeDepth){const s=e.popScope().toValue();if(s instanceof lt){const i=s.getField(n);if(i instanceof ot){e.pushScope(i.toValue());const o=this.then.mapSelected(e,t,r);e.popScope(),o instanceof it?n.equals(o.key)?s.setAttr(n,o.toValue()):(s.delete(n),s.push(o)):o.isDefined()?s.setAttr(n,o.toValue()):s.delete(n)}}e.pushScope(s),i=s}else i=tt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.item,r=ar.substitute(t,this.then,e);if(void 0!==r)return r;let i=this.then.substitute(e);return i instanceof nr||(i=this.then),new ar(this.item,i)}static substitute(e,t,r){let i;if(0!==r.scopeDepth){const n=r.popScope().toValue();let s;n instanceof lt&&(s=n.getField(e),s instanceof ot&&(i=s.toValue().substitute(r))),void 0===s&&void 0===i&&ar.substitute(e,t,r),r.pushScope(n)}return i}andThen(e){return new ar(this.item,this.then.andThen(e))}get typeOrder(){return 13}compareTo(e){if(e instanceof ar){let t=this.item.compareTo(e.item);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ar&&(this.item.equals(e.item)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof ar&&(this.item.equals(e.item)&&this.then.equals(e.then))}hashCode(){return i.mash(i.mix(i.mix(l.hash(ar),this.item.hashCode()),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("getAttr").write(40).debug(this.item).write(41),e=this.then.debugThen(e)}clone(){return new ar(this.item.clone(),this.then.clone())}}class ur extends nr{constructor(e,t){super(),this.item=e,this.then=t}forSelected(e,t,r){let i;e.willSelect(this);const n=this.item.numberValue();if(0!==e.scopeDepth){const s=e.popScope().toValue();if(s instanceof lt&&n<s.length){const o=s.getItem(n);e.pushScope(o),i=this.then.forSelected(e,t,r),e.popScope()}e.pushScope(s)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){const n=e.popScope().toValue(),s=this.item.numberValue();if(n instanceof lt&&s<n.length){const i=n.getItem(s);e.pushScope(i);const o=this.then.mapSelected(e,t,r);e.popScope(),o.isDefined()?n.setItem(s,o):n.splice(s,1)}e.pushScope(n),i=n}else i=tt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.item.numberValue();if(0!==e.scopeDepth){const r=e.popScope().toValue();let i;if(r instanceof lt&&t<r.length){i=r.getItem(t).substitute(e)}if(e.pushScope(r),void 0!==i)return i}let r=this.then.substitute(e);return r instanceof nr||(r=this.then),new ur(this.item,r)}andThen(e){return new ur(this.item,this.then.andThen(e))}get typeOrder(){return 14}compareTo(e){if(e instanceof ur){let t=this.item.compareTo(e.item);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ur&&(this.item.equals(e.item)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof ur&&(this.item.equals(e.item)&&this.then.equals(e.then))}hashCode(){return i.mash(i.mix(i.mix(l.hash(ur),this.item.hashCode()),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("getItem").write(40).debug(this.item).write(41),e=this.then.debugThen(e)}clone(){return new ur(this.item,this.then.clone())}}class hr extends nr{constructor(e){super(),this.then=e}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope();if(n instanceof lt){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;n instanceof it&&(e.pushScope(n.key),i=this.then.forSelected(e,t,r),e.popScope())}}else n instanceof it&&(e.pushScope(n.key),i=this.then.forSelected(e,t,r),e.popScope());e.pushScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){let n=e.popScope();if(n instanceof lt){const i=n.iterator();for(;i.hasNext();){const s=i.next().value;if(s instanceof it){const o=s.key;e.pushScope(o);const a=this.then.mapSelected(e,t,r).toValue();e.popScope(),a.isDefined()?o!==a&&(n instanceof ot&&a instanceof yt?i.set(ot.of(a,n.toValue())):i.set(nt.of(a,n.toValue()))):i.delete()}}}else if(n instanceof it){const i=n.key;e.pushScope(i);const s=this.then.mapSelected(e,t,r).toValue();e.popScope(),s.isDefined()?i!==s&&(n=n instanceof ot&&s instanceof yt?ot.of(s,n.toValue()):nt.of(s,n.toValue())):n=tt.absent()}e.pushScope(n),i=n}else i=tt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromAny(e);let t=this.then.substitute(e);return t instanceof nr||(t=this.then),new hr(t)}andThen(e){return new hr(this.then.andThen(e))}get typeOrder(){return 15}compareTo(e){return e instanceof hr?this.then.compareTo(e.then):e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof hr&&this.then.equivalentTo(e.then,t)}equals(e){return this===e||e instanceof hr&&this.then.equals(e.then)}hashCode(){return i.mash(i.mix(l.hash(hr),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("keys").write(40).write(41),e=this.then.debugThen(e)}clone(){return new hr(this.then.clone())}}class lr extends nr{constructor(e){super(),this.then=e}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope();if(n instanceof lt){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;e.pushScope(n.toValue()),i=this.then.forSelected(e,t,r),e.popScope()}}else e.pushScope(n.toValue()),i=this.then.forSelected(e,t,r),e.popScope();e.pushScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){let n=e.popScope();if(n instanceof lt){const i=n.iterator();for(;i.hasNext();){const n=i.next().value;if(n instanceof it){const s=n.toValue();e.pushScope(s);const o=this.then.mapSelected(e,t,r);e.popScope(),o.isDefined()?o instanceof it?i.set(o):o!==s&&i.set(n.updatedValue(o.toValue())):i.delete()}else{e.pushScope(n.toValue());const s=this.then.mapSelected(e,t,r);e.popScope(),s.isDefined()?n!==s&&i.set(s):i.delete()}}}else if(n instanceof it){const i=n.toValue();e.pushScope(i);const s=this.then.mapSelected(e,t,r);e.popScope(),s.isDefined()?s instanceof it?n=s:s!==i&&(n=n.updatedValue(s.toValue())):n=tt.absent()}else e.pushScope(n),n=this.then.mapSelected(e,t,r),e.popScope();e.pushScope(n),i=n}else i=tt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromAny(e);let t=this.then.substitute(e);return t instanceof nr||(t=this.then),new lr(t)}andThen(e){return new lr(this.then.andThen(e))}get typeOrder(){return 16}compareTo(e){return e instanceof lr?this.then.compareTo(e.then):e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof lr&&this.then.equivalentTo(e.then,t)}equals(e){return this===e||e instanceof lr&&this.then.equals(e.then)}hashCode(){return i.mash(i.mix(l.hash(lr),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("values").write(40).write(41),e=this.then.debugThen(e)}clone(){return new lr(this.then.clone())}}class cr extends nr{constructor(e){super(),this.then=e}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope().toValue();if(n instanceof lt){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;e.pushScope(n),i=this.then.forSelected(e,t,r),e.popScope()}}e.pushScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){const r=e.popScope().toValue();if(r instanceof lt){const i=r.iterator();for(;i.hasNext();){const r=i.next().value;e.pushScope(r);const n=this.then.mapSelected(e,t);e.popScope(),n.isDefined()?n!==r&&i.set(n):i.delete()}}e.pushScope(r),i=r}else i=tt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromAny(e);let t=this.then.substitute(e);return t instanceof nr||(t=this.then),new cr(t)}andThen(e){return new cr(this.then.andThen(e))}get typeOrder(){return 17}compareTo(e){return e instanceof cr?this.then.compareTo(e.then):e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof cr&&this.then.equivalentTo(e.then,t)}equals(e){return this===e||e instanceof cr&&this.then.equals(e.then)}hashCode(){return i.mash(i.mix(l.hash(cr),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("children").write(40).write(41),e=this.then.debugThen(e)}clone(){return new cr(this.then.clone())}}class dr extends nr{constructor(e){super(),this.then=e}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope().toValue();if(n instanceof lt){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;e.pushScope(n),i=this.then.forSelected(e,t,r),void 0===i&&this.forSelected(e,t,r),e.popScope()}}e.pushScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){const n=e.popScope().toValue();if(n instanceof lt){const i=n.iterator();for(;i.hasNext();){const n=i.next().value;e.pushScope(n);let s=this.then.mapSelected(e,t,r);s.isDefined()&&(s=this.mapSelected(e,t,r)),e.popScope(),s.isDefined()?s!==n&&i.set(s):i.delete()}}e.pushScope(n),i=n}else i=tt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromAny(e);let t=this.then.substitute(e);return t instanceof nr||(t=this.then),new dr(t)}andThen(e){return new dr(this.then.andThen(e))}get typeOrder(){return 18}compareTo(e){return e instanceof dr?this.then.compareTo(e.then):e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof dr&&this.then.equivalentTo(e.then,t)}equals(e){return this===e||e instanceof dr&&this.then.equals(e.then)}hashCode(){return i.mash(i.mix(l.hash(dr),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("descendants").write(40).write(41),e=this.then.debugThen(e)}clone(){return new dr(this.then.clone())}}class pr extends nr{constructor(e,t){super(),this.predicate=e,this.then=t}forSelected(e,t,r){let i;return e.willSelect(this),0!==e.scopeDepth&&this.filterSelected(e)&&(i=this.then.forSelected(e,t,r)),e.didSelect(this,i),i}mapSelected(e,t,r){let i;return e.willTransform(this),i=0!==e.scopeDepth?this.filterSelected(e)?this.then.mapSelected(e,t,r):e.peekScope().toValue():tt.absent(),e.didTransform(this,i),i}substitute(e){e=zt.fromAny(e);let t=this.predicate.substitute(e);t instanceof nr||(t=this.predicate);let r=this.then.substitute(e);return r instanceof nr||(r=this.then),new pr(t,r)}filterSelected(e){return void 0!==this.predicate.forSelected(e,this.selected,this)}selected(e){return null}andThen(e){return new pr(this.predicate,this.then.andThen(e))}filter(e){return 0===arguments.length?this:(e=tt.fromAny(e),this.andThen(e.filter()))}get typeOrder(){return 19}compareTo(e){if(e instanceof pr){let t=this.predicate.compareTo(e.predicate);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof pr&&(this.predicate.equivalentTo(e.predicate,t)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof pr&&(this.predicate.equals(e.predicate)&&this.then.equals(e.then))}hashCode(){return i.mash(i.mix(i.mix(l.hash(pr),this.predicate.hashCode()),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("filter").write(40).debug(this.predicate).write(41),e=this.then.debugThen(e)}clone(){return new pr(this.predicate.clone(),this.then.clone())}}class fr extends nr{constructor(e,t){super(),this.item=e.commit(),this.then=t}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=this.item.evaluate(e);n.isDefined()&&(e.pushScope(n),i=this.then.forSelected(e,t,r),e.popScope())}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){let n=this.item.evaluate(e);n.isDefined()&&(e.pushScope(n),n=this.then.mapSelected(e,t,r),e.popScope()),i=n}else i=tt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromAny(e);const t=this.item.substitute(e);let r=this.then.substitute(e);return r instanceof nr||(r=this.then),new fr(t,r)}andThen(e){return new fr(this.item,this.then.andThen(e))}get precedence(){return this.item.precedence}get typeOrder(){return 11}compareTo(e){if(e instanceof fr){let t=this.item.compareTo(e.item);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof fr&&(this.item.equivalentTo(e.item,t)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof fr&&(this.item.equals(e.item)&&this.then.equals(e.then))}hashCode(){return i.mash(i.mix(i.mix(l.hash(fr),this.item.hashCode()),this.then.hashCode()))}debug(e){return e=e.write("Selector").write(46).write("literal").write(40).debug(this.item).write(41),e=this.then.debugThen(e)}debugThen(e){return e}clone(){return new fr(this.item.clone(),this.then.clone())}}class wr extends At{constructor(){super()}isConstant(){return!1}expand(e,t,r){}}class mr extends wr{constructor(e,t){super(),this.bindings=e,this.template=t}get precedence(){return 1}invoke(e,t,r){t=zt.fromAny(t);const i=this.bindings,n=Math.max(1,i.length),s=lt.create(n);let o=0,a=0;for(;o<n;){const t=i instanceof lt?i.getItem(o):0===o?i:tt.absent(),r=e instanceof lt?e.getItem(a).toValue():0===a?e:ht.absent();t instanceof yt&&r.isDistinct()?(s.push(nt.of(t,r)),a+=1):t instanceof nt&&(r.isDistinct()?s.push(t.updatedValue(r)):s.push(t),a+=1),o+=1}t.pushScope(s);const u=this.template.evaluate(t);return t.popScope(),u}get typeOrder(){return 50}compareTo(e){if(e instanceof mr){let t=this.bindings.compareTo(e.bindings);return 0===t&&(t=this.template.compareTo(e.template)),t}return e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof mr&&(this.bindings.equivalentTo(e.bindings,t)&&this.template.equivalentTo(e.template,t))}equals(e){return this===e||e instanceof mr&&(this.bindings.equals(e.bindings)&&this.template.equals(e.template))}hashCode(){return i.mash(i.mix(i.mix(l.hash(mr),this.bindings.hashCode()),this.template.hashCode()))}debug(e){return e=e.debug(this.bindings).write(46).write("lambda").write(40).debug(this.template).write(41)}}class gr extends wr{get typeOrder(){return 51}compareTo(e){return e instanceof gr?l.compare(this.constructor,e.constructor):e instanceof tt?a.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this===e}equals(e){return this===e}hashCode(){return l.hash(this.constructor)}debug(e){return e=e.write(this.constructor.name)}}const yr=function(){const e={};Object.defineProperty(e,"max",{get(){const r=new t;return Object.defineProperty(e,"max",{value:r,enumerable:!0,configurable:!0}),r},enumerable:!0,configurable:!0}),Object.defineProperty(e,"min",{get(){const t=new r;return Object.defineProperty(e,"min",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"abs",{get(){const t=new i;return Object.defineProperty(e,"abs",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ceil",{get(){const t=new n;return Object.defineProperty(e,"ceil",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"floor",{get(){const t=new s;return Object.defineProperty(e,"floor",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"round",{get(){const t=new o;return Object.defineProperty(e,"round",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"sqrt",{get(){const t=new a;return Object.defineProperty(e,"sqrt",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"pow",{get(){const t=new u;return Object.defineProperty(e,"pow",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"rate",{get(){const t=new h;return Object.defineProperty(e,"rate",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"random",{get(){const t=new l;return Object.defineProperty(e,"random",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"scope",{get(){const t=lt.create(10).slot("max",e.max).slot("min",e.min).slot("abs",e.abs).slot("ceil",e.ceil).slot("floor",e.floor).slot("round",e.round).slot("pow",e.pow).slot("sqrt",e.sqrt).slot("rate",e.rate).slot("random",e.random).commit();return Object.defineProperty(e,"scope",{value:t,configurable:!0,enumerable:!0}),t},enumerable:!0,configurable:!0});class t extends gr{invoke(e,t,r){let i,n;if(t=zt.fromAny(t),e.length>=2?(i=e.getItem(0).evaluate(t),n=e.getItem(1).evaluate(t)):i=e.evaluate(t),void 0!==n)return i.max(n);if(void 0!==r){n=r.state;const e=void 0!==n?i.max(n):i;return r.setState(e),e}return tt.absent()}expand(e,t,r){if(1===e.length)return e=e.evaluate(t).toValue(),this.invoke(e,t,r)}}class r extends gr{invoke(e,t,r){let i,n;if(t=zt.fromAny(t),e.length>=2?(i=e.getItem(0).evaluate(t),n=e.getItem(1).evaluate(t)):i=e.evaluate(t),void 0!==n)return i.min(n);if(void 0!==r){n=r.state;const e=void 0!==n?i.min(n):i;return r.setState(e),e}return tt.absent()}expand(e,t,r){if(1===e.length)return e=e.evaluate(t).toValue(),this.invoke(e,t,r)}}class i extends gr{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof vt?e.abs():tt.absent()}}class n extends gr{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof vt?e.ceil():tt.absent()}}class s extends gr{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof vt?e.floor():tt.absent()}}class o extends gr{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof vt?e.round():tt.absent()}}class a extends gr{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof vt?e.sqrt():tt.absent()}}class u extends gr{invoke(e,t,r){t=zt.fromAny(t);const i=e.getItem(0).evaluate(t),n=e.getItem(1).evaluate(t);return i instanceof vt&&n instanceof vt?i.pow(n):tt.absent()}}class h extends gr{invoke(e,t,r){let i,n;if(t=zt.fromAny(t),e.length>=2?(i=e.getItem(0).evaluate(t).numberValue(NaN),n=e.getItem(1).evaluate(t).numberValue(1e3)):(i=e.evaluate(t).numberValue(NaN),n=1e3),isFinite(i)&&void 0!==r){let e=r.state;if(void 0===e)e={v0:i,t0:Date.now(),dv:0,dt:0},r.setState(e);else{const t=Date.now(),s=t-e.t0;if(s>n&&t>e.t0||s>2*n){const r=i-e.v0;e.v0=i,e.t0=t,e.dv=r,e.dt=s}if(r.setState(e),0!==e.dt){const t=n*e.dv/e.dt;return vt.from(t)}}}return tt.absent()}expand(e,t,r){return e=e.evaluate(t).toValue(),this.invoke(e,t,r)}}class l extends gr{invoke(e,t,r){const i=(e=e.evaluate(t).toValue()).length>=1?e.getItem(0).numberValue(0):0,n=e.length>=2?e.getItem(1).numberValue(i+1):i+1,s=i+Math.random()*(n-i);return vt.from(s)}}return e}();class br{withTag(e){return void 0!==e&&e!==this.tag?new vr(this,e):this}withUnit(e){return e!==this.unit?new xr(this,e):this}static forString(){return new Or("")}static forNumber(){return new Er(0)}static forBoolean(){return new Cr(!1)}static forAny(){return new Ar(void 0)}static forItem(){return new Sr(tt.absent())}static forValue(){return new kr(ht.absent())}}e([n],br,"forString",null),e([n],br,"forNumber",null),e([n],br,"forBoolean",null),e([n],br,"forAny",null),e([n],br,"forItem",null),e([n],br,"forValue",null),Object.defineProperty(br.prototype,"tag",{get(){},configurable:!0}),Object.defineProperty(br.prototype,"unit",{get(){},configurable:!0});class vr extends br{constructor(e,t){super(),this.form=e,this.tag=t}withTag(e){return void 0!==e&&e!==this.tag?new vr(this.form,e):void 0===e?this.form:this}withUnit(e){return e!==this.unit?new vr(this.form.withUnit(e),this.tag):this}mold(e,t){return(t=this.form.mold(e,t)).header(this.tag).isDefined()||(t=t.prepended(ot.of(this.tag))),t}cast(e,t){return e.header(this.tag).isDefined()?this.form.cast(e,t):e.keyEquals(this.tag)?this.form.cast(e.toValue(),t):void 0}}Object.defineProperty(vr.prototype,"unit",{get(){return this.form.unit},configurable:!0});class xr extends br{constructor(e,t){super(),this.form=e,Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withTag(e){return e!==this.tag?new xr(this.form.withTag(e),this.unit):this}withUnit(e){return e!==this.unit?new xr(this.form,e):e===this.form.unit?this.form:this}mold(e,t){return 1===arguments.length?this.form.mold(e):this.form.mold(e,t)}cast(e,t){return 1===arguments.length?this.form.cast(e):this.form.cast(e,t)}}Object.defineProperty(xr.prototype,"tag",{get(){return this.form.tag},configurable:!0});class Or extends br{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new Or(e):this}mold(e,t){return void 0===t?yt.from(e):t.concat(yt.from(e))}cast(e,t){const r=e.target;try{return r.stringValue()}catch(e){return}}}class Er extends br{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new Er(e):this}mold(e,t){return void 0===t?vt.from(e):t.concat(vt.from(e))}cast(e,t){const r=e.target;try{return r.numberValue()}catch(e){return}}}class Cr extends br{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new Cr(e):this}mold(e,t){return void 0===t?Ot.from(e):t.concat(Ot.from(e))}cast(e,t){const r=e.target;try{return r.booleanValue()}catch(e){return}}}class Ar extends br{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new Ar(e):this}mold(e,t){return e=tt.fromAny(e),void 0!==t&&(e=t.concat(e)),e}cast(e,t){return e.toAny()}}class Sr extends br{constructor(e){super(),Object.defineProperty(this,"unit",{value:void 0!==e?e.commit():void 0,enumerable:!0})}withUnit(e){return e!==this.unit?new Sr(e):this}mold(e,t){return e=tt.fromAny(e),void 0!==t&&(e=t.concat(e)),e}cast(e,t){return e}}class kr extends br{constructor(e){super(),Object.defineProperty(this,"unit",{value:void 0!==e?e.commit():void 0,enumerable:!0})}withUnit(e){return e!==this.unit?new kr(e):this}mold(e,t){return e=ht.fromAny(e),void 0!==t&&(e=t.concat(e)),e}cast(e,t){return e.toValue()}}const Tr=function(){const e={};return Object.defineProperty(e,"structureParser",{value:function(){const t=new ni;return Object.defineProperty(e,"structureParser",{value:function(){return t},enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"structureWriter",{value:function(){const t=new ki;return Object.defineProperty(e,"structureWriter",{value:function(){return t},enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),e.parse=function(t){return e.structureParser().parseBlockString(t)},e.parser=function(){return e.structureParser().blockParser()},e.sizeOf=function(t){return e.structureWriter().sizeOfItem(t)},e.sizeOfBlock=function(t){return e.structureWriter().sizeOfBlockItem(t)},e.write=function(t,r){return e.structureWriter().writeItem(t,r)},e.writeBlock=function(t,r){return e.structureWriter().writeBlockItem(t,r)},e.toString=function(t){let r=ue.stringOutput();const i=e.write(r,t);return i.isDone()||(r=ie.error(i.trap())),r.bind()},e.toBlockString=function(t){let r=ue.stringOutput();const i=e.writeBlock(r,t);return i.isDone()||(r=ie.error(i.trap())),r.bind()},e.toData=function(t){let r=Re.encodedOutput(mt.output());const i=e.write(r,t);return i.isDone()||(r=ie.error(i.trap())),r.bind()},e.toBlockData=function(t){let r=Re.encodedOutput(mt.output());const i=e.writeBlock(r,t);return i.isDone()||(r=ie.error(i.trap())),r.bind()},e.isSpace=function(e){return 32===e||9===e},e.isNewline=function(e){return 10===e||13===e},e.isWhitespace=function(t){return e.isSpace(t)||e.isNewline(t)},e.isIdentStartChar=function(e){return e>=65&&e<=90||95===e||e>=97&&e<=122||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=767||e>=880&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039},e.isIdentChar=function(e){return 45===e||e>=48&&e<=57||e>=65&&e<=90||95===e||e>=97&&e<=122||183===e||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8255&&e<=8256||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039},tt.prototype.toRecon=function(){return e.toString(this)},tt.prototype.toReconBlock=function(){return e.toBlockString(this)},e}();ht.parseRecon=function(e){return Tr.parse(e)};class Pr extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.keyParser=r,this.valueParser=i,this.step=n}feed(e){return Pr.parse(e,this.recon,this.builder,this.keyParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;e:for(;;){if(1===s){for(;e.isCont()&&(o=e.head(),Tr.isWhitespace(o));)e=e.step();if(e.isCont())if(33===o||34===o||36===o||37===o||39===o||40===o||43===o||45===o||o>=48&&o<=57||64===o||91===o||96===o||123===o||126===o||Tr.isIdentStartChar(o))r=r||t.valueBuilder(),s=2;else{if(35!==o)return void 0!==r?Se.done(r.bind()):Se.done(t.absent());e=e.step(),s=7}else if(e.isDone())return void 0!==r?Se.done(r.bind()):Se.done(t.absent())}if(2===s){for(void 0===i&&(i=t.parseBlockExpression(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=3;else if(i.isError())return i}if(3===s){for(;e.isCont()&&(o=e.head(),Tr.isSpace(o));)e=e.step();if(e.isCont())58===o?(e=e.step(),s=4):(r.push(t.item(i.bind())),i=void 0,s=6);else if(e.isDone())return r.push(t.item(i.bind())),Se.done(r.bind())}if(4===s){for(;e.isCont()&&Tr.isSpace(e.head());)e=e.step();if(e.isCont())s=5;else if(e.isDone())return r.push(t.slot(i.bind())),Se.done(r.bind())}if(5===s){for(void 0===n&&(n=t.parseBlockExpression(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())r.push(t.slot(i.bind(),n.bind())),i=void 0,n=void 0,s=6;else if(n.isError())return n}if(6===s){for(;e.isCont()&&(o=e.head(),Tr.isSpace(o));)e=e.step();if(e.isCont()){if(44===o||59===o||Tr.isNewline(o)){e=e.step(),s=1;continue}if(35!==o)return Se.done(r.bind());e=e.step(),s=7}else if(e.isDone())return Se.done(r.bind())}if(7===s){for(;e.isCont();){if(o=e.head(),Tr.isNewline(o)){s=1;continue e}e=e.step()}if(e.isDone()){s=1;continue}}break}return new Pr(t,r,i,n,s)}}class Dr extends Se{constructor(e,t,r,i){super(),this.recon=e,this.keyParser=t,this.valueParser=r,this.step=i}feed(e){return Dr.parse(e,this.recon,this.keyParser,this.valueParser,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n)if(e.isCont()){if(s=e.head(),64!==s)return Se.error(ce.expected(64,e));e=e.step(),n=2}else if(e.isDone())return Se.error(ce.expected(64,e));if(2===n){if(void 0===r){if(e.isCont())if(s=e.head(),34===s||39===s)r=t.parseString(e);else{if(!Tr.isIdentStartChar(s))return Se.error(ce.expected("attribute name",e));r=t.parseIdent(e)}else if(e.isDone())return Se.error(ce.expected("attribute name",e))}else r=r.feed(e);if(void 0!==r)if(r.isDone())n=3;else if(r.isError())return r.asError()}if(3===n)if(e.isCont()&&40===e.head())e=e.step(),n=4;else if(!e.isEmpty())return Se.done(t.attr(r.bind()));if(4===n){for(;e.isCont()&&(s=e.head(),Tr.isWhitespace(s));)e=e.step();if(e.isCont()){if(41===s)return e=e.step(),Se.done(t.attr(r.bind()));n=5}else if(e.isDone())return Se.error(ce.expected(")",e))}if(5===n){for(void 0===i&&(i=t.parseBlock(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())n=6;else if(i.isError())return i.asError()}if(6===n){for(;e.isCont()&&(s=e.head(),Tr.isWhitespace(s));)e=e.step();if(e.isCont())return 41===s?(e=e.step(),Se.done(t.attr(r.bind(),i.bind()))):Se.error(ce.expected(")",e));if(e.isDone())return Se.error(ce.expected(")",e))}return new Dr(t,r,i,n)}}class qr extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.fieldParser=r,this.valueParser=i,this.step=n}feed(e){return qr.parse(e,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s)if(e.isCont())if(o=e.head(),64===o)i=t.parseAttr(e),s=2;else if(123===o)r=r||t.recordBuilder(),n=t.parseRecord(e,r),s=5;else if(91===o)r=r||t.recordBuilder(),n=t.parseMarkup(e,r),s=5;else if(Tr.isIdentStartChar(o))n=t.parseIdent(e),s=4;else if(34===o||39===o)n=t.parseString(e),s=4;else if(96===o)n=t.parseRawString(e),s=4;else if(45===o||o>=48&&o<=57)n=t.parseNumber(e),s=4;else if(37===o)n=t.parseData(e),s=4;else{if(36!==o)return void 0===r?Se.done(t.extant()):Se.done(r.bind());n=t.parseSelector(e),s=4}else if(e.isDone())return void 0===r?Se.done(t.extant()):Se.done(r.bind());if(2===s){for(;i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())(r=r||t.valueBuilder()).push(i.bind()),i=void 0,s=3;else if(i.isError())return i.asError()}if(3===s){for(;e.isCont()&&Tr.isSpace(e.head());)e=e.step();if(e.isCont()){s=1;continue}if(e.isDone())return Se.done(r.bind())}if(4===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())(r=r||t.valueBuilder()).push(t.item(n.bind())),n=void 0,s=6;else if(n.isError())return n}if(5===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())n=void 0,s=6;else if(n.isError())return n}if(6===s){for(;e.isCont()&&Tr.isSpace(e.head());)e=e.step();if(e.isCont()){if(64!==e.head())return Se.done(r.bind());s=1}else if(e.isDone())return Se.done(r.bind())}break}return new qr(t,r,i,n,s)}}class Ir extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.fieldParser=r,this.valueParser=i,this.step=n}feed(e){return Ir.parse(e,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s)if(e.isCont())if(o=e.head(),64===o)i=t.parseAttr(e),s=2;else if(123===o)void 0!==r?(n=t.parseRecord(e,r),s=5):(n=t.parseRecord(e),s=4);else{if(91!==o)return void 0===r?Se.done(t.extant()):Se.done(r.bind());void 0!==r?(n=t.parseMarkup(e,r),s=5):(n=t.parseMarkup(e),s=4)}else if(e.isDone())return void 0===r?Se.done(t.extant()):Se.done(r.bind());if(2===s){for(;i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())(r=r||t.valueBuilder()).push(i.bind()),i=void 0,s=3;else if(i.isError())return i.asError()}if(3===s)if(e.isCont())if(o=e.head(),123===o)n=t.parseRecord(e,r),s=5;else{if(91!==o)return Se.done(r.bind());n=t.parseMarkup(e,r),s=5}else if(e.isDone())return Se.done(r.bind());if(4===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())return(r=r||t.valueBuilder()).push(t.item(n.bind())),Se.done(r.bind());if(n.isError())return n}if(5===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())return Se.done(r.bind());if(n.isError())return n}return new Ir(t,r,i,n,s)}}class Vr extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.keyParser=r,this.valueParser=i,this.step=n}feed(e){return Vr.parse(e,this.recon,this.builder,this.keyParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s)if(e.isCont()){if(o=e.head(),123!==o)return Se.error(ce.expected(123,e));e=e.step(),s=2}else if(e.isDone())return Se.error(ce.expected(123,e));e:for(;;){if(2===s){for(;e.isCont()&&(o=e.head(),Tr.isWhitespace(o));)e=e.step();if(e.isCont()){if(r=r||t.recordBuilder(),125===o)return e=e.step(),Se.done(r.bind());35===o?(e=e.step(),s=8):s=3}else if(e.isDone())return Se.error(ce.expected(125,e))}if(3===s){for(void 0===i&&(i=t.parseBlockExpression(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=4;else if(i.isError())return i}if(4===s){for(;e.isCont()&&(o=e.head(),Tr.isSpace(o));)e=e.step();if(e.isCont())58===o?(e=e.step(),s=5):(r.push(t.item(i.bind())),i=void 0,s=7);else if(e.isDone())return Se.error(ce.expected(125,e))}if(5===s){for(;e.isCont()&&Tr.isSpace(e.head());)e=e.step();if(e.isCont())s=6;else if(e.isDone())return r.push(t.slot(i.bind())),Se.done(r.bind())}if(6===s){for(void 0===n&&(n=t.parseBlockExpression(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())r.push(t.slot(i.bind(),n.bind())),i=void 0,n=void 0,s=7;else if(n.isError())return n}if(7===s){for(;e.isCont()&&(o=e.head(),Tr.isSpace(o));)e=e.step();if(e.isCont()){if(44===o||59===o||Tr.isNewline(o)){e=e.step(),s=2;continue}if(35!==o)return 125===o?(e=e.step(),Se.done(r.bind())):Se.error(ce.expected("\'}\', \';\', \',\', or newline",e));e=e.step(),s=8}else if(e.isDone())return Se.error(ce.expected(125,e))}if(8===s){for(;e.isCont();){if(o=e.head(),Tr.isNewline(o)){s=2;continue e}e=e.step()}if(e.isDone()){s=2;continue}}break}return new Vr(t,r,i,n,s)}}class Nr extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.textOutput=r,this.valueParser=i,this.step=n}feed(e){return Nr.parse(e,this.recon,this.builder,this.textOutput,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s)if(e.isCont()){if(o=e.head(),91!==o)return Se.error(ce.expected(91,e));e=e.step(),s=2}else if(e.isDone())return Se.error(ce.expected(91,e));for(;;){if(2===s){for(;e.isCont()&&(o=e.head(),64!==o&&91!==o&&92!==o&&93!==o&&123!==o&&125!==o);)e=e.step(),(i=i||t.textOutput()).write(o);if(e.isCont()){if(93===o)return e=e.step(),r=r||t.recordBuilder(),void 0!==i&&r.push(t.item(i.bind())),Se.done(r.bind());if(64===o)r=r||t.recordBuilder(),void 0!==i&&(r.push(t.item(i.bind())),i=void 0),n=t.parseInlineItem(e),s=3;else if(123===o)r=r||t.recordBuilder(),void 0!==i&&(r.push(t.item(i.bind())),i=void 0),n=t.parseRecord(e,r),s=4;else if(91===o)r=r||t.recordBuilder(),void 0!==i&&(r.push(t.item(i.bind())),i=void 0),n=t.parseMarkup(e,r),s=4;else{if(92!==o)return Se.error(ce.unexpected(e));e=e.step(),s=5}}else if(e.isDone())return Se.error(ce.unexpected(e))}if(3===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){r.push(t.item(n.bind())),n=void 0,s=2;continue}if(n.isError())return n}if(4===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){n=void 0,s=2;continue}if(n.isError())return n}if(5===s){if(e.isCont()){if(o=e.head(),i=i||t.textOutput(),34===o||36===o||39===o||47===o||64===o||91===o||92===o||93===o||123===o||125===o)e=e.step(),i.write(o),s=2;else if(98===o)e=e.step(),i.write(8),s=2;else if(102===o)e=e.step(),i.write(12),s=2;else if(110===o)e=e.step(),i.write(10),s=2;else if(114===o)e=e.step(),i.write(13),s=2;else{if(116!==o)return Se.error(ce.expected("escape character",e));e=e.step(),i.write(9),s=2}continue}if(e.isDone())return Se.error(ce.expected("escape character",e))}break}return new Nr(t,r,i,n,s)}}class zr extends Se{constructor(e,t,r){super(),this.recon=e,this.base64Parser=t,this.step=r}feed(e){return zr.parse(e,this.recon,this.base64Parser,this.step)}static parse(e,t,r,i=1){let n=0;if(1===i)if(e.isCont()){if(n=e.head(),37!==n)return Se.error(ce.expected(37,e));e=e.step(),i=2}else if(e.isDone())return Se.error(ce.expected(37,e));if(2===i){for(void 0===r&&(r=Xe.standard().parse(e,t.dataOutput()));r.isCont()&&!e.isEmpty();)r=r.feed(e);if(r.isDone())return r;if(r.isError())return r}return new zr(t,r,i)}}class Mr extends Se{constructor(e,t,r){super(),this.recon=e,this.output=t,this.step=r}feed(e){return Mr.parse(e,this.recon,this.output,this.step)}static parse(e,t,r,i=1){let n=0;if(1===i)if(e.isCont()){if(n=e.head(),!Tr.isIdentStartChar(n))return Se.error(ce.expected("identifier",e));e=e.step(),r=(r=r||t.textOutput()).write(n),i=2}else if(e.isDone())return Se.error(ce.expected("identifier",e));if(2===i){for(;e.isCont()&&(n=e.head(),Tr.isIdentChar(n));)e=e.step(),r.write(n);if(!e.isEmpty())return Se.done(t.ident(r.bind()))}return new Mr(t,r,i)}}class jr extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.output=t,this.quote=r,this.code=i,this.step=n}feed(e){return jr.parse(e,this.recon,this.output,this.quote,this.code,this.step)}static parse(e,t,r,i=0,n=0,s=1){let o=0;if(1===s){for(;e.isCont()&&(o=e.head(),Tr.isWhitespace(o));)e=e.step();if(e.isCont()){if(34!==o&&39!==o||i!==o&&0!==i)return Se.error(ce.expected("string",e));e=e.step(),r=r||t.textOutput(),i=o,s=2}else if(e.isDone())return Se.error(ce.expected("string",e))}e:for(;;){if(2===s){for(;e.isCont()&&(o=e.head(),o>=32&&o!==i&&92!==o);)e=e.step(),r=r.write(o);if(e.isCont()){if(o===i)return e=e.step(),Se.done(r.bind());if(92!==o)return Se.error(ce.expected(i,e));e=e.step(),s=3}else if(e.isDone())return Se.error(ce.expected(i,e))}if(3===s)if(e.isCont()){if(o=e.head(),34===o||36===o||39===o||47===o||64===o||91===o||92===o||93===o||123===o||125===o){e=e.step(),r=r.write(o),s=2;continue}if(98===o){e=e.step(),r=r.write(8),s=2;continue}if(102===o){e=e.step(),r=r.write(12),s=2;continue}if(110===o){e=e.step(),r=r.write(10),s=2;continue}if(114===o){e=e.step(),r=r.write(13),s=2;continue}if(116===o){e=e.step(),r=r.write(9),s=2;continue}if(117!==o)return Se.error(ce.expected("escape character",e));e=e.step(),s=4}else if(e.isDone())return Se.error(ce.expected("escape character",e));if(s>=4)for(;;){if(e.isCont()){if(o=e.head(),Be.isDigit(o)){if(e=e.step(),n=16*n+Be.decodeDigit(o),s<=6){s+=1;continue}r=r.write(n),n=0,s=2;continue e}return Se.error(ce.expected("hex digit",e))}if(e.isDone())return Se.error(ce.expected("hex digit",e));break}break}return new jr(t,r,i,n,s)}}class Lr extends Se{constructor(e,t,r,i){super(),this.recon=e,this.output=t,this.count=r,this.step=i}feed(e){return Lr.parse(e,this.recon,this.output,this.count,this.step)}static parse(e,t,r,i=0,n=1){let s=0;if(1===n){for(;e.isCont()&&(s=e.head(),Tr.isWhitespace(s));)e=e.step();if(e.isCont()&&96===s)e=e.step(),i=1,n=2;else if(e.isDone())return Se.error(ce.expected("raw string",e))}if(2===n)if(e.isCont())96===e.head()?(e=e.step(),i=2,n=3):(r=r||t.textOutput(),n=4);else if(e.isDone())return Se.error(ce.expected("raw string",e));if(3===n)if(e.isCont()){if(96!==e.head())return r=r||t.textOutput(),Se.done(r.bind());e=e.step(),r=r||t.textOutput(),i=3,n=4}else if(e.isDone())return r=r||t.textOutput(),Se.done(r.bind());for(;;){if(4===n){for(;e.isCont()&&(s=e.head(),(1!==i||s>=32)&&96!==s&&92!==s);)e=e.step(),r=r.write(s);if(e.isCont())if(92===s)e=e.step(),n=5;else{if(96!==s)return Se.error(ce.expected(96,e));if(e=e.step(),1===i)return Se.done(r.bind());n=6}else if(e.isDone())return Se.error(ce.expected(96,e))}if(5===n){if(e.isCont()){s=e.head(),e=e.step(),92!==s&&96!==s&&(r=r.write(92)),r=r.write(s),n=4;continue}if(e.isDone())return Se.error(ce.expected("escape character",e))}if(6===n)if(e.isCont()){if(96!==e.head()){r=r.write(96),n=4;continue}e=e.step(),n=7}else if(e.isDone())return Se.error(ce.message("unclosed raw string",e));if(7===n){if(e.isCont()){if(96===e.head())return e=e.step(),Se.done(r.bind());r=(r=r.write(96)).write(96),n=4;continue}if(e.isDone())return Se.error(ce.message("unclosed raw string",e))}break}return new Lr(t,r,i,n)}}class Fr extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.sign=t,this.value=r,this.mode=i,this.step=n}feed(e){return Fr.parse(e,this.recon,this.sign,this.value,this.mode,this.step)}static parse(e,t,r=1,i=0,n=2,s=1){let o=0;if(1===s){for(;e.isCont()&&(o=e.head(),Tr.isWhitespace(o));)e=e.step();if(e.isCont())45===o&&(e=e.step(),r=-1),s=2;else if(e.isDone())return Se.error(ce.expected("number",e))}if(2===s)if(e.isCont())if(o=e.head(),48===o)e=e.step(),s=4;else{if(!(o>=49&&o<=57))return Se.error(ce.expected("digit",e));e=e.step(),i=r*(o-48),s=3}else if(e.isDone())return Se.error(ce.expected("digit",e));if(3===s){for(;e.isCont()&&(o=e.head(),o>=48&&o<=57);){const t=10*i+r*(o-48);if(!(-9007199254740991<=t&&t<=9007199254740992))return Se.error(ce.message("integer overflow",e));i=t,e=e.step()}if(e.isCont())s=4;else if(e.isDone())return Se.done(t.num(i))}if(4===s){if(e.isCont()){if(o=e.head(),n>0&&46===o||n>1&&(69===o||101===o)){let s=ue.stringOutput();return s=r<0&&0===i?s.write(45).write(48):s.write(""+i),Br.parse(e,t,s,n)}return 120===o&&r>0&&0===i?(e=e.step(),Ur.parse(e,t)):Se.done(t.num(i))}if(e.isDone())return Se.done(t.num(i))}return new Fr(t,r,i,n,s)}static parseInteger(e,t){return Fr.parse(e,t,void 0,void 0,0)}static parseDecimal(e,t){return Fr.parse(e,t,void 0,void 0,1)}}class Br extends Se{constructor(e,t,r,i){super(),this.recon=e,this.output=t,this.mode=r,this.step=i}feed(e){return Br.parse(e,this.recon,this.output,this.mode,this.step)}static parse(e,t,r,i=2,n=1){let s=0;if(1===n)if(e.isCont())if(s=e.head(),46===s)e=e.step(),r=r.write(s),n=2;else{if(!(i>1)||69!==s&&101!==s)return Se.error(ce.expected("decimal or exponent",e));e=e.step(),r=r.write(s),n=5}else if(e.isDone())return Se.error(ce.expected("decimal or exponent",e));if(2===n)if(e.isCont()){if(s=e.head(),!(s>=48&&s<=57))return Se.error(ce.expected("digit",e));e=e.step(),r=r.write(s),n=3}else if(e.isDone())return Se.error(ce.expected("digit",e));if(3===n){for(;e.isCont()&&(s=e.head(),s>=48&&s<=57);)e=e.step(),r=r.write(s);if(e.isCont()){if(!(i>1))return Se.done(t.num(r.bind()));n=4}else if(e.isDone())return Se.done(t.num(r.bind()))}if(4===n){if(s=e.head(),69!==s&&101!==s)return Se.done(t.num(r.bind()));e=e.step(),r=r.write(s),n=5}if(5===n)if(e.isCont())s=e.head(),43!==s&&45!==s||(e=e.step(),r=r.write(s)),n=6;else if(e.isDone())return Se.error(ce.unexpected(e));if(6===n)if(e.isCont()){if(s=e.head(),!(s>=48&&s<=57))return Se.error(ce.expected("digit",e));e=e.step(),r=r.write(s),n=7}else if(e.isDone())return Se.error(ce.expected("digit",e));if(7===n){for(;e.isCont()&&(s=e.head(),s>=48&&s<=57);)e=e.step(),r=r.write(s);if(!e.isEmpty())return Se.done(t.num(r.bind()))}return new Br(t,r,i,n)}}class Ur extends Se{constructor(e,t,r){super(),this.recon=e,this.value=t,this.size=r}feed(e){return Ur.parse(e,this.recon,this.value,this.size)}static parse(e,t,r=0,i=0){let n=0;for(;e.isCont()&&(n=e.head(),Be.isDigit(n));)e=e.step(),r=16*r+Be.decodeDigit(n),i+=1;return e.isEmpty()?new Ur(t,r,i):i>0?i<=8?Se.done(t.uint32(r)):Se.done(t.uint64(r)):Se.error(ce.expected("hex digit",e))}}class Wr extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.bindingsParser=r,this.templateParser=i,this.step=n}feed(e){return Wr.parse(e,this.recon,this.builder,this.bindingsParser,this.templateParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s){for(void 0===i&&(i=t.parseConditionalOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(e.isCont()){if(o=e.head(),62!==o)return i;e=e.step(),s=3}else if(e.isDone())return i;if(3===s){for(void 0===n&&(n=t.parseConditionalOperator(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();return Se.done(t.lambda(e,r))}if(n.isError())return n.asError()}return new Wr(t,r,i,n,s)}}class Rr extends Se{constructor(e,t,r,i,n,s){super(),this.recon=e,this.builder=t,this.ifParser=r,this.thenParser=i,this.elseParser=n,this.step=s}feed(e){return Rr.parse(e,this.recon,this.builder,this.ifParser,this.thenParser,this.elseParser,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;if(1===o){for(void 0===i&&(i=t.parseOrOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;e.isCont()&&(a=e.head(),Tr.isSpace(a));)e=e.step();if(e.isCont()){if(63!==a)return i;e=e.step(),o=3}else if(e.isDone())return i}if(3===o){for(void 0===n&&(n=t.parseConditionalOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())o=4;else if(n.isError())return n.asError()}if(4===o){for(;e.isCont()&&(a=e.head(),Tr.isSpace(a));)e=e.step();if(e.isCont()){if(58!==a)return Se.error(ce.expected(58,e));e=e.step(),o=5}else if(e.isDone())return Se.error(ce.expected(58,e))}if(5===o){for(void 0===s&&(s=t.parseConditionalOperator(e,r));s.isCont()&&!e.isEmpty();)s=s.feed(e);if(s.isDone()){const e=i.bind(),r=n.bind(),o=s.bind();return Se.done(t.conditional(e,r,o))}if(s.isError())return s.asError()}return new Rr(t,r,i,n,s,o)}}class Hr extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return Hr.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseAndOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(e.isCont()){if(o=e.head(),124!==o)return i;e=e.step(),s=3}else if(e.isDone())return i;if(3===s){for(void 0===n&&(n=t.parseAndOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Se.done(t.or(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Hr(t,r,i,n,s)}}class Kr extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return Kr.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseBitwiseOrOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(e.isCont()){if(o=e.head(),38!==o)return i;e=e.step(),s=3}else if(e.isDone())return i;if(3===s){for(void 0===n&&(n=t.parseBitwiseOrOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Se.done(t.and(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Kr(t,r,i,n,s)}}class _r extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return _r.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseBitwiseXorOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;e.isCont()&&(o=e.head(),Tr.isSpace(o));)e=e.step();if(e.isCont()){if(124!==o)return i;e=e.step(),s=3}else if(e.isDone())return i}if(3===s)if(e.isCont()){if(o=e.head(),124===o)return i;s=4}else if(e.isDone())return Se.error(ce.unexpected(e));if(4===s){for(void 0===n&&(n=t.parseBitwiseXorOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Se.done(t.bitwiseOr(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new _r(t,r,i,n,s)}}class Gr extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return Gr.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseBitwiseAndOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;e.isCont()&&(o=e.head(),Tr.isSpace(o));)e=e.step();if(e.isCont()){if(94!==o)return i;e=e.step(),s=3}else if(e.isDone())return i}if(3===s){for(void 0===n&&(n=t.parseBitwiseAndOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Se.done(t.bitwiseXor(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Gr(t,r,i,n,s)}}class Qr extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return Qr.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseComparisonOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;e.isCont()&&(o=e.head(),Tr.isSpace(o));)e=e.step();if(e.isCont()){if(38!==o)return i;e=e.step(),s=3}else if(e.isDone())return i}if(3===s)if(e.isCont()){if(o=e.head(),38===o)return i;s=4}else if(e.isDone())return Se.error(ce.unexpected(e));if(4===s){for(void 0===n&&(n=t.parseComparisonOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Se.done(t.bitwiseAnd(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Qr(t,r,i,n,s)}}class Zr extends Se{constructor(e,t,r,i,n,s){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.operator=i,this.rhsParser=n,this.step=s}feed(e){return Zr.parse(e,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;if(1===o){for(void 0===i&&(i=t.parseAttrExpression(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;e.isCont()&&(a=e.head(),Tr.isSpace(a));)e=e.step();if(e.isCont())if(33===a)e=e.step(),o=3;else if(60===a)e=e.step(),o=4;else if(62===a)e=e.step(),o=5;else{if(61!==a)return i;e=e.step(),o=6}else if(e.isDone())return i}if(3===o)if(e.isCont())a=e.head(),61===a?(e=e.step(),n="!=",o=7):(n="!",o=7);else if(e.isDone())return Se.error(ce.unexpected(e));if(4===o)if(e.isCont())a=e.head(),61===a?(e=e.step(),n="<=",o=7):(n="<",o=7);else if(e.isDone())return Se.error(ce.unexpected(e));if(5===o)if(e.isCont())a=e.head(),61===a?(e=e.step(),n=">=",o=7):(n=">",o=7);else if(e.isDone())return Se.error(ce.unexpected(e));if(6===o)if(e.isCont())if(a=e.head(),61===a)e=e.step(),n="==",o=7;else{if(62===a)return i;n="=",o=7}else if(e.isDone())return Se.error(ce.unexpected(e));if(7===o){for(void 0===s&&(s=t.parseAttrExpression(e,r));s.isCont()&&!e.isEmpty();)s=s.feed(e);if(s.isDone()){const r=i.bind(),o=s.bind();return"<"===n?Se.done(t.lt(r,o)):"<="===n?Se.done(t.le(r,o)):"=="===n?Se.done(t.eq(r,o)):"!="===n?Se.done(t.ne(r,o)):">="===n?Se.done(t.ge(r,o)):">"===n?Se.done(t.gt(r,o)):Se.error(ce.message(n,e))}if(s.isError())return s.asError()}return new Zr(t,r,i,n,s,o)}}class Xr extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.fieldParser=r,this.valueParser=i,this.step=n}feed(e){return Xr.parse(e,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(;e.isCont()&&(o=e.head(),Tr.isSpace(o));)e=e.step();if(e.isCont())if(64===o)s=2;else if(123===o||91===o)r=r||t.recordBuilder(),s=5;else if(40===o)s=4;else{if(!(33===o||34===o||36===o||37===o||39===o||43===o||45===o||o>=48&&o<=57||96===o||126===o||Tr.isIdentStartChar(o)))return void 0===r?Se.done(t.extant()):Se.done(r.bind());s=3}else if(e.isDone())return void 0===r?Se.done(t.extant()):Se.done(r.bind())}if(2===s){for(void 0===i&&(i=t.parseAttr(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone()){(r=r||t.recordBuilder()).push(i.bind()),i=void 0,s=1;continue}if(i.isError())return i.asError()}if(3===s){for(void 0===n&&(n=t.parseAdditiveOperator(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())(r=r||t.valueBuilder()).push(t.item(n.bind())),n=void 0,s=6;else if(n.isError())return n.asError()}if(4===s){for(void 0===n&&(n=t.parseAdditiveOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())void 0===r&&(r=t.valueBuilder()).push(t.item(n.bind())),n=void 0,s=6;else if(n.isError())return n.asError()}if(5===s){for(void 0===n&&(n=t.parseAdditiveOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())n=void 0,s=6;else if(n.isError())return n.asError()}if(6===s){for(;e.isCont()&&(o=e.head(),Tr.isSpace(o));)e=e.step();if(e.isCont()){if(64===o){s=1;continue}return Se.done(r.bind())}if(e.isDone())return Se.done(r.bind())}break}return new Xr(t,r,i,n,s)}}class $r extends Se{constructor(e,t,r,i,n,s){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.operator=i,this.rhsParser=n,this.step=s}feed(e){return $r.parse(e,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;for(;;){if(1===o){for(void 0===i&&(i=t.parseMultiplicativeOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;e.isCont()&&(a=e.head(),Tr.isSpace(a));)e=e.step();if(e.isCont())if(43===a)e=e.step(),n="+",o=3;else{if(45!==a)return i;e=e.step(),n="-",o=3}else if(e.isDone())return i}if(3===o){for(void 0===s&&(s=t.parseMultiplicativeOperator(e,r));s.isCont()&&!e.isEmpty();)s=s.feed(e);if(s.isDone()){const r=i.bind(),a=s.bind();if("+"===n)i=Se.done(t.plus(r,a));else{if("-"!==n)return Se.error(ce.message(n,e));i=Se.done(t.minus(r,a))}s=void 0,n=void 0,o=2;continue}if(s.isError())return s.asError()}break}return new $r(t,r,i,n,s,o)}}class Yr extends Se{constructor(e,t,r,i,n,s){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.operator=i,this.rhsParser=n,this.step=s}feed(e){return Yr.parse(e,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;for(;;){if(1===o){for(void 0===i&&(i=t.parsePrefixOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;e.isCont()&&(a=e.head(),Tr.isSpace(a));)e=e.step();if(e.isCont())if(42===a)e=e.step(),n="*",o=3;else if(47===a)e=e.step(),n="/",o=3;else{if(37!==a)return i;e=e.step(),n="%",o=3}else if(e.isDone())return i}if(3===o){for(void 0===s&&(s=t.parsePrefixOperator(e,r));s.isCont()&&!e.isEmpty();)s=s.feed(e);if(s.isDone()){const r=i.bind(),a=s.bind();if("*"===n)i=Se.done(t.times(r,a));else if("/"===n)i=Se.done(t.divide(r,a));else{if("%"!==n)return Se.error(ce.message(n,e));i=Se.done(t.modulo(r,a))}s=void 0,n=void 0,o=2;continue}if(s.isError())return s.asError()}break}return new Yr(t,r,i,n,s,o)}}class Jr extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.operator=r,this.operandParser=i,this.step=n}feed(e){return Jr.parse(e,this.recon,this.builder,this.operator,this.operandParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s){for(;e.isCont()&&(o=e.head(),Tr.isSpace(o));)e=e.step();if(e.isCont()){if(33===o)e=e.step(),i="!";else if(126===o)e=e.step(),i="~";else if(45===o)e=e.step(),i="-";else{if(43!==o)return t.parseInvokeOperator(e,r);e=e.step(),i="+"}s=2}else if(e.isDone())return t.parseInvokeOperator(e,r)}if(2===s){for(void 0===n&&(n=t.parsePrefixOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const r=n.bind();return t.isDistinct(r)?"!"===i?Se.done(t.not(r)):"~"===i?Se.done(t.bitwiseNot(r)):"-"===i?Se.done(t.negative(r)):"+"===i?Se.done(t.positive(r)):Se.error(ce.message(i,e)):Se.error(ce.expected("value",e))}if(n.isError())return n.asError()}return new Jr(t,r,i,n,s)}}class ei extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.exprParser=r,this.argsParser=i,this.step=n}feed(e){return ei.parse(e,this.recon,this.builder,this.exprParser,this.argsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s){for(void 0===i&&(i=t.parsePrimary(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}for(;;){if(2===s){for(;e.isCont()&&(o=e.head(),Tr.isSpace(o));)e=e.step();if(e.isCont()){if(40!==o)return i;e=e.step(),s=3}else if(e.isDone())return i}if(3===s){for(;e.isCont()&&(o=e.head(),Tr.isWhitespace(o));)e=e.step();if(e.isCont()){if(41===o){e=e.step();const r=i.bind();i=Se.done(t.invoke(r,t.extant())),s=2;continue}s=4}else if(e.isDone())return Se.error(ce.expected(41,e))}if(4===s){for(void 0===n&&(n=t.parseBlock(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())s=5;else if(n.isError())return n.asError()}if(5===s){for(;e.isCont()&&(o=e.head(),Tr.isWhitespace(o));)e=e.step();if(e.isCont()){if(41===o){e=e.step();const r=i.bind(),o=n.bind();i=Se.done(t.invoke(r,o)),n=void 0,s=2;continue}return Se.error(ce.expected(41,e))}if(e.isDone())return Se.error(ce.expected(41,e))}break}return new ei(t,r,i,n,s)}}class ti extends Se{constructor(e,t,r,i){super(),this.recon=e,this.builder=t,this.exprParser=r,this.step=i}feed(e){return ti.parse(e,this.recon,this.builder,this.exprParser,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n){for(;e.isCont()&&(s=e.head(),Tr.isSpace(s));)e=e.step();e.isCont()?40===s?(e=e.step(),n=3):n=2:e.isDone()&&(n=2)}if(2===n){for(void 0===i&&(i=t.parseLiteral(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())return i;if(i.isError())return i.asError()}if(3===n){for(void 0===i&&(i=t.parseBlockExpression(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())n=4;else if(i.isError())return i.asError()}for(;;){if(4===n){for(;e.isCont()&&(s=e.head(),Tr.isSpace(s));)e=e.step();if(e.isCont()){if(44!==s)return 41===s?(e=e.step(),void 0!==i?i:Se.done(r.bind())):Se.error(ce.expected(41,e));e=e.step(),void 0!==i&&(void 0===r&&(r=t.recordBuilder()).push(t.item(i.bind())),i=void 0),n=5}else if(e.isDone())return Se.error(ce.expected(41,e))}if(5===n){for(void 0===i&&(i=t.parseBlockExpression(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone()){i=void 0,n=4;continue}if(i.isError())return i.asError()}break}return new ti(t,r,i,n)}}class ri extends Se{constructor(e,t,r,i){super(),this.recon=e,this.builder=t,this.valueParser=r,this.step=i}feed(e){return ri.parse(e,this.recon,this.builder,this.valueParser,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n){for(;e.isCont()&&(s=e.head(),Tr.isSpace(s));)e=e.step();if(e.isCont())if(40===s)e=e.step(),n=4;else if(123===s)r=r||t.recordBuilder(),i=t.parseRecord(e,r),n=3;else if(91===s)r=r||t.recordBuilder(),i=t.parseMarkup(e,r),n=3;else if(Tr.isIdentStartChar(s))i=t.parseIdent(e),n=2;else if(34===s||39===s)i=t.parseString(e),n=2;else if(96===s)i=t.parseRawString(e),n=2;else if(45===s||s>=48&&s<=57)i=t.parseNumber(e),n=2;else if(37===s)i=t.parseData(e),n=2;else{if(36!==s)return void 0===r?Se.done(t.extant()):Se.done(r.bind());i=t.parseSelector(e),n=2}else if(e.isDone())return void 0===r?Se.done(t.extant()):Se.done(r.bind())}if(2===n){for(;i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())return(r=r||t.valueBuilder()).push(t.item(i.bind())),Se.done(r.bind());if(i.isError())return i.asError()}if(3===n){for(;i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())return Se.done(r.bind());if(i.isError())return i.asError()}if(4===n){for(void 0===i&&(i=t.parseBlockExpression(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())n=5;else if(i.isError())return i.asError()}if(5===n){for(;e.isCont()&&(s=e.head(),Tr.isWhitespace(s));)e=e.step();if(e.isCont())return 41===s?(e=e.step(),(r=r||t.valueBuilder()).push(t.item(i.bind())),Se.done(r.bind())):Se.error(ce.expected(41,e));if(e.isDone())return Se.error(ce.expected(41,e))}return new ri(t,r,i,n)}}class ii extends Se{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.selector=r,this.valueParser=i,this.step=n}feed(e){return ii.parse(e,this.recon,this.builder,this.selector,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s){for(;e.isCont()&&(o=e.head(),Tr.isSpace(o));)e=e.step();if(e.isCont()&&36===o)e=e.step(),i=i||t.selector(),s=2;else if(e.isDone())return Se.error(ce.expected(36,e))}if(2===s)if(e.isCont())o=e.head(),91===o?(e=e.step(),s=8):64===o?(e=e.step(),s=7):58===o?(e=e.step(),s=6):42===o?(e=e.step(),s=5):35===o?(e=e.step(),s=4):s=3;else if(e.isDone())return Se.error(ce.unexpected(e));for(;;){if(3===s){for(void 0===n&&(n=t.parseLiteral(e,t.valueBuilder()));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())i=t.get(i,n.bind()),n=void 0,s=10;else if(n.isError())return n.asError()}if(4===s){for(void 0===n&&(n=t.parseInteger(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())i=t.value(t.getItem(i,n.bind())),n=void 0,s=10;else if(n.isError())return n.asError()}if(5===s&&(e.isCont()?(o=e.head(),58===o?(e=e.step(),i=t.keys(i),s=10):42===o?(e=e.step(),i=t.descendants(i),s=10):(i=t.children(i),s=10)):e.isDone()&&(i=t.children(i),s=10)),6===s)if(e.isCont()){if(o=e.head(),42!==o)return Se.error(ce.expected(42,e));e=e.step(),i=t.values(i),s=10}else if(e.isDone())return Se.error(ce.expected(42,e));if(7===s){for(void 0===n&&(n=t.parseIdent(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())i=t.getAttr(i,n.bind()),n=void 0,s=10;else if(n.isError())return n.asError()}if(8===s){for(void 0===n&&(n=t.parseBlockExpression(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())s=9;else if(n.isError())return n.asError()}if(9===s){for(;e.isCont()&&(o=e.head(),Tr.isSpace(o));)e=e.step();if(e.isCont()){if(93!==o)return Se.error(ce.expected(93,e));e=e.step(),i=t.filter(i,n.bind()),n=void 0,s=10}else if(e.isDone())return Se.error(ce.expected(93,e))}if(10===s)if(e.isCont()){if(o=e.head(),91===o){e=e.step(),s=8;continue}if(35===o){e=e.step(),s=4;continue}if(46!==o)return void 0!==r?(r.push(t.item(i)),Se.done(r.bind())):Se.done(i);e=e.step(),s=11}else if(e.isDone())return void 0!==r?(r.push(t.item(i)),Se.done(r.bind())):Se.done(i);if(11===s){if(e.isCont()){if(o=e.head(),64===o){e=e.step(),s=7;continue}if(58===o){e=e.step(),s=6;continue}if(42===o){e=e.step(),s=5;continue}s=3;continue}if(e.isDone())return Se.error(ce.unexpected(e))}break}return new ii(t,r,i,n,s)}}class ni extends class{parseBlock(e){return Pr.parse(e,this)}parseAttr(e){return Dr.parse(e,this)}parseBlockItem(e){return qr.parse(e,this)}parseInlineItem(e){return Ir.parse(e,this)}parseRecord(e,t){return Vr.parse(e,this,t)}parseMarkup(e,t){return Nr.parse(e,this,t)}parseData(e){return zr.parse(e,this)}parseIdent(e){return Mr.parse(e,this)}parseString(e){return jr.parse(e,this)}parseRawString(e){return Lr.parse(e,this)}parseNumber(e){return Fr.parse(e,this)}parseInteger(e){return Fr.parseInteger(e,this)}parseBlockExpression(e,t){return this.parseLambdaFunc(e,t)}parseLambdaFunc(e,t){return Wr.parse(e,this,t)}parseConditionalOperator(e,t){return Rr.parse(e,this,t)}parseOrOperator(e,t){return Hr.parse(e,this,t)}parseAndOperator(e,t){return Kr.parse(e,this,t)}parseBitwiseOrOperator(e,t){return _r.parse(e,this,t)}parseBitwiseXorOperator(e,t){return Gr.parse(e,this,t)}parseBitwiseAndOperator(e,t){return Qr.parse(e,this,t)}parseComparisonOperator(e,t){return Zr.parse(e,this,t)}parseAttrExpression(e,t){return Xr.parse(e,this,t)}parseAdditiveOperator(e,t){return $r.parse(e,this,t)}parseMultiplicativeOperator(e,t){return Yr.parse(e,this,t)}parsePrefixOperator(e,t){return Jr.parse(e,this,t)}parseInvokeOperator(e,t){return ei.parse(e,this,t)}parsePrimary(e,t){return ti.parse(e,this,t)}parseLiteral(e,t){return ri.parse(e,this,t)}parseSelector(e,t){return ii.parse(e,this,t)}blockParser(){return new Pr(this)}parseBlockString(e){let t=ue.stringInput(e);for(;t.isCont()&&Tr.isWhitespace(t.head());)t=t.step();let r=this.parseBlock(t);if(r.isDone())for(;t.isCont()&&Tr.isWhitespace(t.head());)t=t.step();return t.isCont()&&!r.isError()&&(r=Se.error(ce.unexpected(t))),r.bind()}}{isDistinct(e){return e.isDistinct()}item(e){return e}value(e){return e.toValue()}attr(e,t){return 1===arguments.length?ot.of(e):ot.of(e,t)}slot(e,t){return 1===arguments.length?nt.of(e):nt.of(e,t)}valueBuilder(){return ht.builder()}recordBuilder(){return lt.create()}dataOutput(){return mt.output()}textOutput(){return yt.output()}ident(e){if(e instanceof yt){const t=e.stringValue();if("true"===t)return Ot.from(!0);if("false"===t)return Ot.from(!1)}return e}num(e){if("number"==typeof e)return vt.from(e);if("string"==typeof e)return vt.from(+e);throw new TypeError(""+e)}uint32(e){return vt.uint32(e)}uint64(e){return vt.uint64(e)}bool(e){return Ot.from(e)}selector(){return nr.identity()}extant(){return ht.extant()}absent(){return ht.absent()}conditional(e,t,r){return e.conditional(t,r)}or(e,t){return new Mt(e,t)}and(e,t){return new jt(e,t)}bitwiseOr(e,t){return new Lt(e,t)}bitwiseXor(e,t){return new Ft(e,t)}bitwiseAnd(e,t){return new Bt(e,t)}lt(e,t){return new Ut(e,t)}le(e,t){return new Wt(e,t)}eq(e,t){return new Rt(e,t)}ne(e,t){return new Ht(e,t)}ge(e,t){return new Kt(e,t)}gt(e,t){return new _t(e,t)}plus(e,t){return new Gt(e,t)}minus(e,t){return new Qt(e,t)}times(e,t){return new Zt(e,t)}divide(e,t){return new Xt(e,t)}modulo(e,t){return new $t(e,t)}not(e){return new Yt(e)}bitwiseNot(e){return new Jt(e)}negative(e){return e instanceof vt?e.negative():new er(e)}positive(e){return new tr(e)}invoke(e,t){return new rr(e,t)}lambda(e,t){return e.lambda(t)}get(e,t){return e.get(t)}getAttr(e,t){return e.getAttr(t)}getItem(e,t){return e.getItem(t)}children(e){return nr.literal(e).children()}descendants(e){return nr.literal(e).descendants()}keys(e){return nr.literal(e).keys()}values(e){return nr.literal(e).values()}filter(e,t){return e.filter(t)}}class si extends oe{constructor(e,t,r,i,n){super(),this.recon=e,this.key=t,this.value=r,this.part=i,this.step=n}pull(e){return si.write(e,this.recon,this.key,this.value,this.part,this.step)}static sizeOf(e,t,r){let i=0;return i+=1,i+=e.sizeOfValue(t),e.isExtant(e.item(r))||(i+=1,i+=e.sizeOfBlockValue(r),i+=1),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()&&(e=e.write(64),s=2),2===s)if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone()){if(n=void 0,t.isExtant(t.item(i)))return oe.end();s=3}else if(n.isError())return n.asError();if(3===s&&e.isCont()&&(e=e.write(40),s=4),4===s)if((n=void 0===n?t.writeBlockValue(e,i):n.pull(e)).isDone())n=void 0,s=5;else if(n.isError())return n.asError();return 5===s&&e.isCont()?(e=e.write(41),oe.end()):e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new si(t,r,i,n,s)}}class oi extends oe{constructor(e,t,r,i,n){super(),this.recon=e,this.key=t,this.value=r,this.part=i,this.step=n}pull(e){return oi.write(e,this.recon,this.key,this.value,this.part,this.step)}static sizeOf(e,t,r){let i=0;return i+=e.sizeOfValue(t),i+=1,e.isExtant(e.item(r))||(i+=e.sizeOfValue(r)),i}static write(e,t,r,i,n,s=1){if(1===s)if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())n=void 0,s=2;else if(n.isError())return n.asError();if(2===s&&e.isCont()){if(e=e.write(58),t.isExtant(t.item(i)))return oe.end();s=3}if(3===s){if((n=void 0===n?t.writeValue(e,i):n.pull(e)).isDone())return oe.end();if(n.isError())return n.asError()}return e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new oi(t,r,i,n,s)}}class ai extends oe{constructor(e,t,r,i,n,s,o,a,u,h,l,c){super(),this.recon=e,this.items=t,this.inBlock=r,this.inMarkup=i,this.inBraces=n,this.inBrackets=s,this.first=o,this.markupSafe=a,this.item=u,this.next=h,this.part=l,this.step=c}pull(e){return ai.write(e,this.recon,this.items,this.inBlock,this.inMarkup,this.inBraces,this.inBrackets,this.first,this.markupSafe,this.item,this.next,this.part,this.step)}static sizeOf(e,t,r,i){let n,s=0,o=!1,a=!1,u=!0,h=!0;for(;void 0!==n||t.hasNext();){let l;void 0===n?l=t.next().value:(l=n,n=void 0),t.hasNext()&&(n=t.next().value),e.isExpression(l)&&(h=!1),a&&e.isAttr(l)&&(o&&(s+=1,o=!1),s+=1,a=!1),e.isAttr(l)?(o?(s+=1,o=!1):a&&(s+=1,a=!1),s+=e.sizeOfItem(l),u=!1):a&&e.isText(l)?(o&&(s+=1,o=!1),s+=e.sizeOfMarkupText(l)):o?(u?u=!1:s+=1,s+=ai.sizeOfBlockItem(e,l)):a?e.isRecord(l)&&e.isMarkupSafe(e.items(l))?(s+=e.sizeOfBlock(e.items(l),!1,!0),void 0!==n&&e.isText(n)?(s+=e.sizeOfMarkupText(n),n=void 0):void 0===n||e.isAttr(n)?(s+=1,a=!1):(s+=1,o=!0,u=!0)):(s+=1,s+=e.sizeOfItem(l),o=!0,u=!1):!h||!e.isText(l)||void 0===n||e.isField(n)||e.isText(n)||e.isBool(n)?r&&!o?(u?u=!1:s+=1,s+=ai.sizeOfBlockItem(e,l)):i&&e.isText(l)&&void 0===n?(s+=1,s+=e.sizeOfMarkupText(l),s+=1):!i&&e.isValue(l)&&!e.isRecord(l)&&(!u&&void 0===n||void 0!==n&&e.isAttr(n))?(!u&&(e.isText(l)&&e.isIdent(l)||e.isNum(l)||e.isBool(l))&&(s+=1),s+=e.sizeOfItem(l)):(s+=1,s+=e.sizeOfItem(l),o=!0,u=!1):(s+=1,s+=e.sizeOfMarkupText(l),a=!0)}return o&&(s+=1),a&&(s+=1),s}static sizeOfBlockItem(e,t){let r=0;return e.isField(t)?r+=e.sizeOfSlot(e.key(t),e.value(t)):r+=e.sizeOfItem(t),r}static write(e,t,r,i,n,s=!1,o=!1,a=!0,u=!0,h,l,c,d=1){for(;;){if(1===d){if(void 0===l&&!r.hasNext()){d=10;break}void 0===l?h=r.next().value:(h=l,l=void 0),r.hasNext()&&(l=r.next().value),t.isExpression(h)&&(u=!1),d=2}if(2===d&&e.isCont()&&(o&&t.isAttr(h)?(s&&(e=e.write(125),s=!1),d=3):d=4),3===d&&e.isCont()&&(e=e.write(93),o=!1,d=4),4===d&&e.isCont()&&(t.isAttr(h)?(s?(e=e.write(125),s=!1):o&&(e=e.write(93),o=!1),c=t.writeItem(e,h),a=!1,d=7):o&&t.isText(h)?(s&&(e=e.write(125),s=!1),c=t.writeMarkupText(e,h),d=7):s?(a?a=!1:e=e.write(44),c=ai.writeBlockItem(e,t,h),d=7):o?t.isRecord(h)&&t.isMarkupSafe(t.items(h))?(c=t.writeBlock(e,t.items(h),!1,!0),d=5):(e=e.write(123),c=t.writeItem(e,h),s=!0,a=!1,d=7):!u||!t.isText(h)||void 0===l||t.isField(l)||t.isText(l)||t.isBool(l)?i&&!s?(a?a=!1:e=e.write(44),c=ai.writeBlockItem(e,t,h),d=7):n&&t.isText(h)&&void 0===l?(e=e.write(91),c=t.writeMarkupText(e,h),d=8):!n&&t.isValue(h)&&!t.isRecord(h)&&(!a&&void 0===l||void 0!==l&&t.isAttr(l))?(!a&&(t.isText(h)&&t.isIdent(h)||t.isNum(h)||t.isBool(h))&&(e=e.write(32)),c=t.writeItem(e,h),d=7):(e=e.write(123),c=t.writeItem(e,h),s=!0,a=!1,d=7):(e=e.write(91),c=t.writeMarkupText(e,h),o=!0,d=7)),5===d)if((c=c.pull(e)).isDone())c=void 0,d=6;else if(c.isError())return c.asError();if(6===d&&e.isCont()){if(void 0===l||!t.isText(l)){if(void 0===l||t.isAttr(l)){e=e.write(93),o=!1,d=1;continue}e=e.write(123),s=!0,a=!0,d=1;continue}c=t.writeMarkupText(e,l),l=void 0,d=7}if(7===d){if((c=c.pull(e)).isDone()){c=void 0,d=1;continue}if(c.isError())return c.asError()}if(8===d)if((c=c.pull(e)).isDone())c=void 0,d=9;else if(c.isError())return c.asError();if(9!==d||!e.isCont())break;e=e.write(93),d=1}if(10===d&&(s?e.isCont()&&(e=e.write(125),d=11):d=11),11===d){if(!o)return oe.end();if(e.isCont())return e=e.write(93),oe.end()}return e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new ai(t,r,i,n,s,o,a,u,h,l,c,d)}static writeBlockItem(e,t,r){return t.isField(r)?t.writeSlot(e,t.key(r),t.value(r)):t.writeItem(e,r)}}class ui extends oe{constructor(e,t,r,i,n,s,o,a){super(),this.recon=e,this.items=t,this.inParens=r,this.first=i,this.item=n,this.next=s,this.part=o,this.step=a}pull(e){return ui.write(e,this.recon,this.items,this.inParens,this.first,this.item,this.next,this.part,this.step)}static sizeOf(e,t){let r,i=0,n=!1,s=!0;for(;void 0!==r||t.hasNext();){let o;void 0===r?o=t.next().value:(o=r,r=void 0),t.hasNext()&&(r=t.next().value),n||s||(i+=1),e.isAttr(o)?(n&&(i+=1,n=!1),i+=e.sizeOfItem(o),s=!1):n?(s?s=!1:i+=1,i+=e.sizeOfBlockItem(o)):e.isValue(o)&&!e.isRecord(o)&&(!s&&void 0===r||void 0!==r&&e.isAttr(r))?i+=e.sizeOfItem(o):(i+=1,i+=e.sizeOfItem(o),n=!0,s=!1)}return n&&(i+=1),i}static write(e,t,r,i=!1,n=!0,s,o,a,u=1){for(;;){if(1===u){if(void 0===o&&!r.hasNext()){u=5;break}void 0===o?s=r.next().value:(s=o,o=void 0),r.hasNext()&&(o=r.next().value),u=2}if(2===u&&e.isCont()&&(i||n||(e=e.write(32)),u=3),3===u&&e.isCont()&&(t.isAttr(s)?(i&&(e=e.write(41),i=!1),a=t.writeItem(e,s),n=!1,u=4):i?(n?n=!1:e=e.write(44),a=t.writeBlockItem(e,s),u=4):t.isValue(s)&&!t.isRecord(s)&&(!n&&void 0===o||void 0!==o&&t.isAttr(o))?(a=t.writeItem(e,s),u=4):(e=e.write(40),a=t.writeItem(e,s),i=!0,n=!1,u=4)),4===u){if((a=a.pull(e)).isDone()){a=void 0,u=1;continue}if(a.isError())return a.asError()}break}if(5===u){if(!i)return oe.end();if(e.isCont())return e=e.write(41),oe.end()}return e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new ui(t,r,i,n,s,o,a,u)}}class hi extends oe{constructor(e,t,r,i){super(),this.text=e,this.index=t,this.escape=r,this.step=i}pull(e){return hi.write(e,this.text,this.index,this.escape,this.step)}static sizeOf(e){let t=0;for(let r=0,i=e.length;r<i;r=u.offsetByCodePoints(e,r,1)){let i=e.codePointAt(r);void 0===i&&(i=e.charCodeAt(r)),t+=36===i||64===i||91===i||92===i||93===i||123===i||125===i||8===i||12===i||10===i||13===i||9===i?2:i<32?6:Re.sizeOf(i)}return t}static write(e,t,r=0,i=0,n=1){const s=t.length;for(;e.isCont();)if(1===n){if(!(r<s))return oe.end();{let s=t.codePointAt(r);void 0===s&&(s=t.charCodeAt(r)),r=u.offsetByCodePoints(t,r,1),36===s||64===s||91===s||92===s||93===s||123===s||125===s?(e=e.write(92),i=s,n=2):8===s?(e=e.write(92),i=98,n=2):12===s?(e=e.write(92),i=102,n=2):10===s?(e=e.write(92),i=110,n=2):13===s?(e=e.write(92),i=114,n=2):9===s?(e=e.write(92),i=116,n=2):s<32?(e=e.write(92),i=s,n=3):e=e.write(s)}}else 2===n?(e=e.write(i),i=0,n=1):3===n?(e=e.write(117),n=4):4===n?(e=e.write(Be.uppercase.encodeDigit(i>>>12&15)),n=5):5===n?(e=e.write(Be.uppercase.encodeDigit(i>>>8&15)),n=6):6===n?(e=e.write(Be.uppercase.encodeDigit(i>>>4&15)),n=7):7===n&&(e=e.write(Be.uppercase.encodeDigit(15&i)),i=0,n=1);return e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new hi(t,r,i,n)}}class li extends oe{constructor(e,t,r){super(),this.array=e,this.part=t,this.step=r}pull(e){return li.write(e,this.array,this.part,this.step)}static sizeOf(e){return 1+(Math.floor(4*e/3)+3&-4)}static write(e,t,r,i=1){if(1===i&&e.isCont()&&(e=e.write(37),i=2),2===i){if((r=void 0===r?Xe.standard().writeUint8Array(e,t):r.pull(e)).isDone())return r=void 0,oe.end();if(r.isError())return r.asError()}return e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new li(t,r,i)}}class ci extends oe{constructor(e,t){super(),this.ident=e,this.index=t}pull(e){return ci.write(e,this.ident,this.index)}static sizeOf(e){return Re.sizeOf(e)}static write(e,t,r=0){let i;const n=t.length;if(0===n)return oe.error(new se("empty identifier"));for(0===r&&e.isCont()&&(i=t.codePointAt(0),void 0===i&&(i=t.charCodeAt(0)),Tr.isIdentStartChar(i)&&(e=e.write(i),r=u.offsetByCodePoints(t,0,1)));r<n&&e.isCont();){if(i=t.codePointAt(r),void 0===i&&(i=t.charCodeAt(r)),!Tr.isIdentChar(i))return oe.error(new se("invalid identifier"));e=e.write(i),r=u.offsetByCodePoints(t,r,1)}return r>=n?oe.end():e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new ci(t,r)}}class di extends oe{constructor(e,t,r,i){super(),this.string=e,this.index=t,this.escape=r,this.step=i}pull(e){return di.write(e,this.string,this.index,this.escape,this.step)}static sizeOf(e){let t=0;t+=1;for(let r=0,i=e.length;r<i;r=u.offsetByCodePoints(e,r,1)){let i=e.codePointAt(r);void 0===i&&(i=e.charCodeAt(r)),t+=34===i||92===i||8===i||12===i||10===i||13===i||9===i?2:i<32?6:Re.sizeOf(i)}return t+=1,t}static write(e,t,r=0,i=0,n=1){1===n&&e.isCont()&&(e=e.write(34),n=2);const s=t.length;for(;n>=2&&n<=8&&e.isCont();)if(2===n){if(!(r<s)){n=9;break}{let s=t.codePointAt(r);void 0===s&&(s=t.charCodeAt(r)),r=u.offsetByCodePoints(t,r,1),34===s||92===s?(e=e.write(92),i=s,n=3):8===s?(e=e.write(92),i=98,n=3):12===s?(e=e.write(92),i=102,n=3):10===s?(e=e.write(92),i=110,n=3):13===s?(e=e.write(92),i=114,n=3):9===s?(e=e.write(92),i=116,n=3):s<32?(e=e.write("\\\\"),i=s,n=4):e=e.write(s)}}else 3===n?(e=e.write(i),i=0,n=2):4===n?(e=e.write(117),n=5):5===n?(e=e.write(Be.uppercase.encodeDigit(i>>>12&15)),n=6):6===n?(e=e.write(Be.uppercase.encodeDigit(i>>>8&15)),n=7):7===n?(e=e.write(Be.uppercase.encodeDigit(i>>>4&15)),n=8):8===n&&(e=e.write(Be.uppercase.encodeDigit(15&i)),i=0,n=2);return 9===n&&e.isCont()?(e=e.write(34),oe.end()):e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new di(t,r,i,n)}}class pi extends oe{constructor(e,t,r,i,n){super(),this.recon=e,this.bindings=t,this.template=r,this.part=i,this.step=n}pull(e){return pi.write(e,this.recon,this.bindings,this.template,this.part,this.step)}static sizeOf(e,t,r){let i=0;return i+=e.sizeOfPrimary(t),i+=4,i+=e.sizeOfValue(r),i}static write(e,t,r,i,n,s=1){if(1===s)if((n=void 0===n?t.writePrimary(e,r):n.pull(e)).isDone())n=void 0,s=2;else if(n.isError())return n.asError();if(2===s&&e.isCont()&&(e=e.write(32),s=3),3===s&&e.isCont()&&(e=e.write(61),s=4),4===s&&e.isCont()&&(e=e.write(62),s=5),5===s&&e.isCont()&&(e=e.write(32),s=6),6===s){if((n=void 0===n?t.writeValue(e,i):n.pull(e)).isDone())return oe.end();if(n.isError())return n.asError()}return e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new pi(t,r,i,n,s)}}class fi extends oe{constructor(e,t,r,i,n,s,o){super(),this.recon=e,this.ifTerm=t,this.thenTerm=r,this.elseTerm=i,this.precedence=n,this.part=s,this.step=o}pull(e){return fi.write(e,this.recon,this.ifTerm,this.thenTerm,this.elseTerm,this.precedence,this.part,this.step)}static sizeOf(e,t,r,i,n){let s=0;return e.precedence(t)>0&&e.precedence(t)<=n?(s+=1,s+=e.sizeOfItem(t),s+=1):s+=e.sizeOfItem(t),s+=3,s+=e.sizeOfItem(r),s+=3,s+=e.sizeOfItem(i),s}static write(e,t,r,i,n,s,o,a=1){if(1===a&&(t.precedence(r)>0&&t.precedence(r)<=s?e.isCont()&&(e=e.write(40),a=2):a=2),2===a)if((o=void 0===o?t.writeItem(e,r):o.pull(e)).isDone())o=void 0,a=3;else if(o.isError())return o.asError();if(3===a&&(t.precedence(r)>0&&t.precedence(r)<=s?e.isCont()&&(e=e.write(41),a=4):a=4),4===a&&e.isCont()&&(e=e.write(32),a=5),5===a&&e.isCont()&&(e=e.write(63),a=6),6===a&&e.isCont()&&(e=e.write(32),a=7),7===a)if((o=void 0===o?t.writeItem(e,i):o.pull(e)).isDone())o=void 0,a=8;else if(o.isError())return o.asError();if(8===a&&e.isCont()&&(e=e.write(32),a=9),9===a&&e.isCont()&&(e=e.write(58),a=10),10===a&&e.isCont()&&(e=e.write(32),a=11),11===a){if((o=void 0===o?t.writeItem(e,n):o.pull(e)).isDone())return oe.end();if(o.isError())return o.asError()}return e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new fi(t,r,i,n,s,o,a)}}class wi extends oe{constructor(e,t,r,i,n,s,o){super(),this.recon=e,this.lhs=t,this.operator=r,this.rhs=i,this.precedence=n,this.part=s,this.step=o}pull(e){return wi.write(e,this.recon,this.lhs,this.operator,this.rhs,this.precedence,this.part,this.step)}static sizeOf(e,t,r,i,n){let s=0;return e.precedence(t)<n?(s+=1,s+=e.sizeOfItem(t),s+=1):s+=e.sizeOfItem(t),s+=1,s+=Re.sizeOf(r),s+=1,e.precedence(i)<n?(s+=1,s+=e.sizeOfItem(i),s+=1):s+=e.sizeOfItem(i),s}static write(e,t,r,i,n,s,o,a=1){if(1===a&&(t.precedence(r)<s?e.isCont()&&(e=e.write(40),a=2):a=2),2===a)if((o=void 0===o?t.writeItem(e,r):o.pull(e)).isDone())o=void 0,a=3;else if(o.isError())return o.asError();if(3===a&&(t.precedence(r)<s?e.isCont()&&(e=e.write(41),a=4):a=4),4===a&&e.isCont()&&(e=e.write(32),a=5),5===a)if((o=void 0===o?ue.writeString(e,i):o.pull(e)).isDone())o=void 0,a=6;else if(o.isError())return o.asError();if(6===a&&e.isCont()&&(e=e.write(32),a=7),7===a&&(t.precedence(n)<s?e.isCont()&&(e=e.write(40),a=8):a=8),8===a)if((o=void 0===o?t.writeItem(e,n):o.pull(e)).isDone())o=void 0,a=9;else if(o.isError())return o.asError();if(9===a){if(!(t.precedence(n)<s))return oe.end();if(e.isCont())return e=e.write(41),oe.end()}return e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new wi(t,r,i,n,s,o,a)}}class mi extends oe{constructor(e,t,r,i,n,s){super(),this.recon=e,this.operator=t,this.rhs=r,this.precedence=i,this.part=n,this.step=s}pull(e){return mi.write(e,this.recon,this.operator,this.rhs,this.precedence,this.part,this.step)}static sizeOf(e,t,r,i){let n=0;return n+=Re.sizeOf(t),e.precedence(r)<i?(n+=1,n+=e.sizeOfItem(r),n+=1):n+=e.sizeOfItem(r),n}static write(e,t,r,i,n,s,o=1){if(1===o)if((s=void 0===s?ue.writeString(e,r):s.pull(e)).isDone())s=void 0,o=2;else if(s.isError())return s.asError();if(2===o&&(t.precedence(i)<n?e.isCont()&&(e=e.write(40),o=3):o=3),3===o)if((s=void 0===s?t.writeItem(e,i):s.pull(e)).isDone())s=void 0,o=4;else if(s.isError())return s.asError();if(4===o){if(!(t.precedence(i)<n))return oe.end();if(e.isCont())return e=e.write(41),oe.end()}return e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new mi(t,r,i,n,s,o)}}class gi extends oe{constructor(e,t,r,i,n){super(),this.recon=e,this.func=t,this.args=r,this.part=i,this.step=n}pull(e){return gi.write(e,this.recon,this.func,this.args,this.part,this.step)}static sizeOf(e,t,r){let i=0;return i+=e.sizeOfValue(t),i+=1,i+=e.sizeOfBlockValue(r),i+=1,i}static write(e,t,r,i,n,s=1){if(1===s)if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())n=void 0,s=2;else if(n.isError())return n.asError();if(2===s&&e.isCont()&&(e=e.write(40),s=3),3===s)if((n=void 0===n?t.writeBlockValue(e,i):n.pull(e)).isDone())n=void 0,s=4;else if(n.isError())return n.asError();return 4===s&&e.isCont()?(e=e.write(41),oe.end()):e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new gi(t,r,i,n,s)}}class yi extends oe{constructor(e,t,r,i,n){super(),this.recon=e,this.item=t,this.then=r,this.part=i,this.step=n}pull(e){return yi.write(e,this.recon,this.item,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=0;return e.precedence(t)<e.precedence(e.item(r))?(i+=1,i+=e.sizeOfItem(t),i+=1):i+=e.sizeOfItem(t),i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&(t.precedence(r)<t.precedence(t.item(i))?e.isCont()&&(e=e.write(40),s=2):s=2),2===s)if((n=void 0===n?t.writeItem(e,r):n.pull(e)).isDone())n=void 0,s=3;else if(n.isError())return n.asError();return 3===s&&(t.precedence(r)<t.precedence(t.item(i))?e.isCont()&&(e=e.write(41),s=4):s=4),4===s?t.writeThen(e,i):e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new yi(t,r,i,n,s)}}class bi extends oe{constructor(e,t,r,i,n){super(),this.recon=e,this.key=t,this.then=r,this.part=i,this.step=n}pull(e){return bi.write(e,this.recon,this.key,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=1;return e.isRecord(e.item(t))?(i+=1,i+=e.sizeOfBlockValue(t),i+=1):i+=e.sizeOfValue(t),i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()?(e=e.write(36),s=3):2===s&&e.isCont()&&(e=e.write(46),s=3),3===s&&(t.isRecord(t.item(r))?e.isCont()&&(e=e.write(123),s=4):s=4),4===s)if((n=void 0===n?t.isRecord(t.item(r))?t.writeBlockValue(e,r):t.writeValue(e,r):n.pull(e)).isDone())n=void 0,s=5;else if(n.isError())return n.asError();return 5===s&&(t.isRecord(t.item(r))?e.isCont()&&(e=e.write(125),s=6):s=6),6===s?t.writeThen(e,i):e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new bi(t,r,i,n,s)}static writeThen(e,t,r,i){return bi.write(e,t,r,i,void 0,2)}}class vi extends oe{constructor(e,t,r,i,n){super(),this.recon=e,this.key=t,this.then=r,this.part=i,this.step=n}pull(e){return vi.write(e,this.recon,this.key,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=2;return i+=e.sizeOfValue(t),i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()?(e=e.write(36),s=3):2===s&&e.isCont()&&(e=e.write(46),s=3),3===s&&e.isCont()&&(e=e.write(64),s=4),4===s){if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())return t.writeThen(e,i);if(n.isError())return n.asError()}return e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new vi(t,r,i,n,s)}static writeThen(e,t,r,i){return vi.write(e,t,r,i,void 0,2)}}class xi extends oe{constructor(e,t,r,i,n){super(),this.recon=e,this.index=t,this.then=r,this.part=i,this.step=n}pull(e){return xi.write(e,this.recon,this.index,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=2;return i+=e.sizeOfValue(t),i+=e.sizeOfThen(r),i}static sizeOfThen(e,t,r){let i=1;return i+=e.sizeOfValue(t),i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()&&(e=e.write(36),s=2),2===s&&e.isCont()&&(e=e.write(35),s=3),3===s){if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())return t.writeThen(e,i);if(n.isError())return n.asError()}return e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new xi(t,r,i,n,s)}static writeThen(e,t,r,i){return xi.write(e,t,r,i,void 0,2)}}class Oi extends oe{constructor(e,t,r){super(),this.recon=e,this.then=t,this.step=r}pull(e){return Oi.write(e,this.recon,this.then,this.step)}static sizeOf(e,t){let r=3;return r+=e.sizeOfThen(t),r}static write(e,t,r,i=1){return 1===i&&e.isCont()?(e=e.write(36),i=3):2===i&&e.isCont()&&(e=e.write(46),i=3),3===i&&e.isCont()&&(e=e.write(42),i=4),4===i&&e.isCont()?(e=e.write(58),t.writeThen(e,r)):e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new Oi(t,r,i)}static writeThen(e,t,r){return Oi.write(e,t,r,2)}}class Ei extends oe{constructor(e,t,r){super(),this.recon=e,this.then=t,this.step=r}pull(e){return Ei.write(e,this.recon,this.then,this.step)}static sizeOf(e,t){let r=3;return r+=e.sizeOfThen(t),r}static write(e,t,r,i=1){return 1===i&&e.isCont()?(e=e.write(36),i=3):2===i&&e.isCont()&&(e=e.write(46),i=3),3===i&&e.isCont()&&(e=e.write(58),i=4),4===i&&e.isCont()?(e=e.write(42),t.writeThen(e,r)):e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new Ei(t,r,i)}static writeThen(e,t,r){return Ei.write(e,t,r,2)}}class Ci extends oe{constructor(e,t,r){super(),this.recon=e,this.then=t,this.step=r}pull(e){return Ci.write(e,this.recon,this.then,this.step)}static sizeOf(e,t){let r=2;return r+=e.sizeOfThen(t),r}static write(e,t,r,i=1){return 1===i&&e.isCont()?(e=e.write(36),i=3):2===i&&e.isCont()&&(e=e.write(46),i=3),3===i&&e.isCont()?(e=e.write(42),t.writeThen(e,r)):e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new Ci(t,r,i)}static writeThen(e,t,r){return Ci.write(e,t,r,2)}}class Ai extends oe{constructor(e,t,r){super(),this.recon=e,this.then=t,this.step=r}pull(e){return Ai.write(e,this.recon,this.then,this.step)}static sizeOf(e,t){let r=3;return r+=e.sizeOfThen(t),r}static write(e,t,r,i=1){return 1===i&&e.isCont()?(e=e.write(36),i=3):2===i&&e.isCont()&&(e=e.write(46),i=3),3===i&&e.isCont()&&(e=e.write(42),i=4),4===i&&e.isCont()?(e=e.write(42),t.writeThen(e,r)):e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new Ai(t,r,i)}static writeThen(e,t,r){return Ai.write(e,t,r,2)}}class Si extends oe{constructor(e,t,r,i,n){super(),this.recon=e,this.predicate=t,this.then=r,this.part=i,this.step=n}pull(e){return Si.write(e,this.recon,this.predicate,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=2;return i+=e.sizeOfValue(t),i+=1,i+=e.sizeOfThen(r),i}static sizeOfThen(e,t,r){let i=1;return i+=e.sizeOfValue(t),i+=1,i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()&&(e=e.write(36),s=2),2===s&&e.isCont()&&(e=e.write(91),s=3),3===s)if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())n=void 0,s=4;else if(n.isError())return n.asError();return 4===s&&e.isCont()?(e=e.write(93),t.writeThen(e,i)):e.isDone()?oe.error(new se("truncated")):e.isError()?oe.error(e.trap()):new Si(t,r,i,n,s)}static writeThen(e,t,r,i){return Si.write(e,t,r,i,void 0,2)}}class ki extends class{sizeOfAttr(e,t){return si.sizeOf(this,e,t)}writeAttr(e,t,r){return si.write(e,this,t,r)}sizeOfSlot(e,t){return oi.sizeOf(this,e,t)}writeSlot(e,t,r){return oi.write(e,this,t,r)}sizeOfBlock(e,t,r){if(3===arguments.length)return ai.sizeOf(this,e,t,r);{const t=this.items(e);return t.hasNext()?ai.sizeOf(this,t,this.isBlockSafe(this.items(e)),!1):2}}writeBlock(e,t,r,i){if(4===arguments.length)return ai.write(e,this,t,r,i);{const r=this.items(t);return r.hasNext()?ai.write(e,this,r,this.isBlockSafe(this.items(t)),!1):ue.writeString(e,"{}")}}sizeOfRecord(e){const t=this.items(e);return t.hasNext()?ai.sizeOf(this,t,!1,!1):2}writeRecord(e,t){const r=this.items(t);return r.hasNext()?ai.write(e,this,r,!1,!1):ue.writeString(e,"{}")}sizeOfPrimary(e){if(this.isRecord(this.item(e))){const t=this.items(this.item(e));if(t.hasNext())return ui.sizeOf(this,t)}else if(!this.isExtant(this.item(e)))return this.sizeOfValue(e);return 2}writePrimary(e,t){if(this.isRecord(this.item(t))){const r=this.items(this.item(t));if(r.hasNext())return ui.write(e,this,r)}else if(!this.isExtant(this.item(t)))return this.writeValue(e,t);return ue.writeString(e,"()")}isBlockSafe(e){for(;e.hasNext();)if(this.isAttr(e.next().value))return!1;return!0}isMarkupSafe(e){if(!e.hasNext()||!this.isAttr(e.next().value))return!1;for(;e.hasNext();)if(this.isAttr(e.next().value))return!1;return!0}sizeOfMarkupText(e){return"string"!=typeof e&&(e=this.string(e)),hi.sizeOf(e)}writeMarkupText(e,t){return"string"!=typeof t&&(t=this.string(t)),hi.write(e,t)}sizeOfData(e){return li.sizeOf(e)}writeData(e,t){return void 0!==t?li.write(e,t):ue.writeString(e,"%")}isIdent(e){"string"!=typeof e&&(e=this.string(e));const t=e.length;let r;if(0===t||(r=e.codePointAt(0),void 0!==r&&!Tr.isIdentStartChar(r)))return!1;for(let i=u.offsetByCodePoints(e,0,1);i<t;i=u.offsetByCodePoints(e,i,1))if(r=e.codePointAt(i),void 0===r||!Tr.isIdentChar(r))return!1;return!0}sizeOfText(e){return this.isIdent(e)?ci.sizeOf(e):di.sizeOf(e)}writeText(e,t){return this.isIdent(t)?ci.write(e,t):di.write(e,t)}sizeOfNum(e){if(isFinite(e)&&Math.floor(e)===e&&Math.abs(e)<2147483648){let t=le.countDigits(e);return e<0&&(t+=1),t}return(""+e).length}writeNum(e,t){return isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<2147483648?le.writeInteger(e,t):ue.writeString(e,""+t)}sizeOfUint32(e){return 10}writeUint32(e,t){return Be.lowercase.writeIntegerLiteral(e,t,8)}sizeOfUint64(e){return 18}writeUint64(e,t){return Be.lowercase.writeIntegerLiteral(e,t,16)}sizeOfBool(e){return e?4:5}writeBool(e,t){return ue.writeString(e,t?"true":"false")}sizeOfLambdaFunc(e,t){return pi.sizeOf(this,e,t)}writeLambdaFunc(e,t,r){return pi.write(e,this,t,r)}sizeOfConditionalOperator(e,t,r,i){return fi.sizeOf(this,e,t,r,i)}writeConditionalOperator(e,t,r,i,n){return fi.write(e,this,t,r,i,n)}sizeOfInfixOperator(e,t,r,i){return wi.sizeOf(this,e,t,r,i)}writeInfixOperator(e,t,r,i,n){return wi.write(e,this,t,r,i,n)}sizeOfPrefixOperator(e,t,r){return mi.sizeOf(this,e,t,r)}writePrefixOperator(e,t,r,i){return mi.write(e,this,t,r,i)}sizeOfInvokeOperator(e,t){return gi.sizeOf(this,e,t)}writeInvokeOperator(e,t,r){return gi.write(e,this,t,r)}sizeOfIdentitySelector(){return 0}writeIdentitySelector(e){return oe.end()}sizeOfThenIdentitySelector(){return 0}writeThenIdentitySelector(e){return oe.end()}sizeOfLiteralSelector(e,t){return yi.sizeOf(this,e,t)}writeLiteralSelector(e,t,r){return yi.write(e,this,t,r)}sizeOfThenLiteralSelector(e,t){return 0}writeThenLiteralSelector(e,t,r){return oe.end()}sizeOfGetSelector(e,t){return bi.sizeOf(this,e,t)}writeGetSelector(e,t,r){return bi.write(e,this,t,r)}sizeOfThenGetSelector(e,t){return bi.sizeOf(this,e,t)}writeThenGetSelector(e,t,r){return bi.writeThen(e,this,t,r)}sizeOfGetAttrSelector(e,t){return vi.sizeOf(this,e,t)}writeGetAttrSelector(e,t,r){return vi.write(e,this,t,r)}sizeOfThenGetAttrSelector(e,t){return vi.sizeOf(this,e,t)}writeThenGetAttrSelector(e,t,r){return vi.writeThen(e,this,t,r)}sizeOfGetItemSelector(e,t){return xi.sizeOf(this,e,t)}writeGetItemSelector(e,t,r){return xi.write(e,this,t,r)}sizeOfThenGetItemSelector(e,t){return xi.sizeOfThen(this,e,t)}writeThenGetItemSelector(e,t,r){return xi.writeThen(e,this,t,r)}sizeOfKeysSelector(e){return Oi.sizeOf(this,e)}writeKeysSelector(e,t){return Oi.write(e,this,t)}sizeOfThenKeysSelector(e){return Oi.sizeOf(this,e)}writeThenKeysSelector(e,t){return Oi.writeThen(e,this,t)}sizeOfValuesSelector(e){return Ei.sizeOf(this,e)}writeValuesSelector(e,t){return Ei.write(e,this,t)}sizeOfThenValuesSelector(e){return Ei.sizeOf(this,e)}writeThenValuesSelector(e,t){return Ei.writeThen(e,this,t)}sizeOfChildrenSelector(e){return Ci.sizeOf(this,e)}writeChildrenSelector(e,t){return Ci.write(e,this,t)}sizeOfThenChildrenSelector(e){return Ci.sizeOf(this,e)}writeThenChildrenSelector(e,t){return Ci.writeThen(e,this,t)}sizeOfDescendantsSelector(e){return Ai.sizeOf(this,e)}writeDescendantsSelector(e,t){return Ai.write(e,this,t)}sizeOfThenDescendantsSelector(e){return Ai.sizeOf(this,e)}writeThenDescendantsSelector(e,t){return Ai.writeThen(e,this,t)}sizeOfFilterSelector(e,t){return Si.sizeOf(this,e,t)}writeFilterSelector(e,t,r){return Si.write(e,this,t,r)}sizeOfThenFilterSelector(e,t){return Si.sizeOfThen(this,e,t)}writeThenFilterSelector(e,t,r){return Si.writeThen(e,this,t,r)}sizeOfExtant(){return 0}writeExtant(e){return oe.end()}sizeOfAbsent(){return 0}writeAbsent(e){return oe.end()}}{isField(e){return e instanceof it}isAttr(e){return e instanceof ot}isSlot(e){return e instanceof nt}isValue(e){return e instanceof ht}isRecord(e){return e instanceof lt}isText(e){return e instanceof yt}isNum(e){return e instanceof vt}isBool(e){return e instanceof Ot}isExpression(e){return e instanceof At}isExtant(e){return e instanceof Et}items(e){return e.iterator()}item(e){return e}key(e){return e.key}value(e){return e.toValue()}string(e){return e.stringValue("")}precedence(e){return e.precedence}sizeOfItem(e){if(e instanceof it){if(e instanceof ot)return this.sizeOfAttr(e.key,e.value);if(e instanceof nt)return this.sizeOfSlot(e.key,e.value)}else if(e instanceof ht)return this.sizeOfValue(e);throw new se("No Recon serialization for "+e)}writeItem(e,t){if(t instanceof it){if(t instanceof ot)return this.writeAttr(e,t.key,t.value);if(t instanceof nt)return this.writeSlot(e,t.key,t.value)}else if(t instanceof ht)return this.writeValue(e,t);return oe.error(new se("No Recon serialization for "+t))}sizeOfValue(e){if(e instanceof lt)return this.sizeOfRecord(e);if(e instanceof mt)return this.sizeOfData(e.size);if(e instanceof yt)return this.sizeOfText(e.value);if(e instanceof vt)return e.isUint32()?this.sizeOfUint32(e.value):e.isUint64()?this.sizeOfUint64(e.value):this.sizeOfNum(e.value);if(e instanceof Ot)return this.sizeOfBool(e.value);if(e instanceof nr)return this.sizeOfSelector(e);if(e instanceof St)return this.sizeOfOperator(e);if(e instanceof wr)return this.sizeOfFunc(e);if(e instanceof Et)return this.sizeOfExtant();if(e instanceof Ct)return this.sizeOfAbsent();throw new se("No Recon serialization for "+e)}writeValue(e,t){return t instanceof lt?this.writeRecord(e,t):t instanceof mt?this.writeData(e,t.asUint8Array()):t instanceof yt?this.writeText(e,t.value):t instanceof vt?t.isUint32()?this.writeUint32(e,t.value):t.isUint64()?this.writeUint64(e,t.value):this.writeNum(e,t.value):t instanceof Ot?this.writeBool(e,t.value):t instanceof nr?this.writeSelector(e,t):t instanceof St?this.writeOperator(e,t):t instanceof wr?this.writeFunc(e,t):t instanceof Et?this.writeExtant(e):t instanceof Ct?this.writeAbsent(e):oe.error(new se("No Recon serialization for "+t))}sizeOfSelector(e){if(e instanceof sr)return this.sizeOfIdentitySelector();if(e instanceof fr)return this.sizeOfLiteralSelector(e.item,e.then);if(e instanceof or)return this.sizeOfGetSelector(e.item,e.then);if(e instanceof ar)return this.sizeOfGetAttrSelector(e.item,e.then);if(e instanceof ur)return this.sizeOfGetItemSelector(e.item,e.then);if(e instanceof hr)return this.sizeOfKeysSelector(e.then);if(e instanceof lr)return this.sizeOfValuesSelector(e.then);if(e instanceof cr)return this.sizeOfChildrenSelector(e.then);if(e instanceof dr)return this.sizeOfDescendantsSelector(e.then);if(e instanceof pr)return this.sizeOfFilterSelector(e.predicate,e.then);throw new se("No Recon serialization for "+e)}writeSelector(e,t){return t instanceof sr?this.writeIdentitySelector(e):t instanceof fr?this.writeLiteralSelector(e,t.item,t.then):t instanceof or?this.writeGetSelector(e,t.item,t.then):t instanceof ar?this.writeGetAttrSelector(e,t.item,t.then):t instanceof ur?this.writeGetItemSelector(e,t.item,t.then):t instanceof hr?this.writeKeysSelector(e,t.then):t instanceof lr?this.writeValuesSelector(e,t.then):t instanceof cr?this.writeChildrenSelector(e,t.then):t instanceof dr?this.writeDescendantsSelector(e,t.then):t instanceof pr?this.writeFilterSelector(e,t.predicate,t.then):oe.error(new se("No Recon serialization for "+t))}sizeOfOperator(e){if(e instanceof kt)return this.sizeOfInfixOperator(e.operand1,e.operator,e.operand2,e.precedence);if(e instanceof Pt)return this.sizeOfPrefixOperator(e.operator,e.operand,e.precedence);if(e instanceof rr)return this.sizeOfInvokeOperator(e.func,e.args);if(e instanceof qt)return this.sizeOfConditionalOperator(e.ifTerm,e.thenTerm,e.elseTerm,e.precedence);throw new se("No Recon serialization for "+e)}writeOperator(e,t){return t instanceof kt?this.writeInfixOperator(e,t.operand1,t.operator,t.operand2,t.precedence):t instanceof Pt?this.writePrefixOperator(e,t.operator,t.operand,t.precedence):t instanceof rr?this.writeInvokeOperator(e,t.func,t.args):t instanceof qt?this.writeConditionalOperator(e,t.ifTerm,t.thenTerm,t.elseTerm,t.precedence):oe.error(new se("No Recon serialization for "+t))}sizeOfFunc(e){if(e instanceof mr)return this.sizeOfLambdaFunc(e.bindings,e.template);if(e instanceof gr)return 0;throw new se("No Recon serialization for "+e)}writeFunc(e,t){return t instanceof mr?this.writeLambdaFunc(e,t.bindings,t.template):t instanceof gr?oe.end():oe.error(new se("No Recon serialization for "+t))}sizeOfBlockItem(e){if(e instanceof it)return this.sizeOfItem(e);if(e instanceof ht)return this.sizeOfBlockValue(e);throw new se("No Recon serialization for "+e)}writeBlockItem(e,t){return t instanceof it?this.writeItem(e,t):t instanceof ht?this.writeBlockValue(e,t):oe.error(new se("No Recon serialization for "+t))}sizeOfBlockValue(e){return e instanceof lt?this.sizeOfBlock(e):this.sizeOfValue(e)}writeBlockValue(e,t){return t instanceof lt?this.writeBlock(e,t):this.writeValue(e,t)}sizeOfThen(e){if(e instanceof nr){if(e instanceof sr)return this.sizeOfThenIdentitySelector();if(e instanceof fr)return this.sizeOfThenLiteralSelector(e.item,e.then);if(e instanceof or)return this.sizeOfThenGetSelector(e.item,e.then);if(e instanceof ar)return this.sizeOfThenGetAttrSelector(e.item,e.then);if(e instanceof ur)return this.sizeOfThenGetItemSelector(e.item,e.then);if(e instanceof hr)return this.sizeOfThenKeysSelector(e.then);if(e instanceof lr)return this.sizeOfThenValuesSelector(e.then);if(e instanceof cr)return this.sizeOfThenChildrenSelector(e.then);if(e instanceof dr)return this.sizeOfThenDescendantsSelector(e.then);if(e instanceof pr)return this.sizeOfThenFilterSelector(e.predicate,e.then)}throw new se("No Recon serialization for "+e)}writeThen(e,t){if(t instanceof nr){if(t instanceof sr)return this.writeThenIdentitySelector(e);if(t instanceof fr)return this.writeThenLiteralSelector(e,t.item,t.then);if(t instanceof or)return this.writeThenGetSelector(e,t.item,t.then);if(t instanceof ar)return this.writeThenGetAttrSelector(e,t.item,t.then);if(t instanceof ur)return this.writeThenGetItemSelector(e,t.item,t.then);if(t instanceof hr)return this.writeThenKeysSelector(e,t.then);if(t instanceof lr)return this.writeThenValuesSelector(e,t.then);if(t instanceof cr)return this.writeThenChildrenSelector(e,t.then);if(t instanceof dr)return this.writeThenDescendantsSelector(e,t.then);if(t instanceof pr)return this.writeThenFilterSelector(e,t.predicate,t.then)}return oe.error(new se("No Recon serialization for "+t))}}class Ti extends Error{constructor(e){super(e instanceof ce?e.message:e),Object.setPrototypeOf(this,Ti.prototype),this.diagnostic=e instanceof ce?e:null}toString(){return null!==this.diagnostic?this.diagnostic.toString():super.toString()}}class Pi{constructor(e,t,r,i,n){this.scheme=e,this.authority=t,this.path=r,this.query=i,this.fragment=n,this.hashValue=void 0,this.stringValue=void 0}isDefined(){return this.scheme.isDefined()||this.authority.isDefined()||this.path.isDefined()||this.query.isDefined()||this.fragment.isDefined()}isEmpty(){return!this.scheme.isDefined()&&!this.authority.isDefined()&&this.path.isEmpty()&&!this.query.isDefined()&&!this.fragment.isDefined()}withScheme(e){return(e=Di.fromAny(e))!==this.scheme?this.copy(e,this.authority,this.path,this.query,this.fragment):this}get schemePart(){return this.scheme.toString()}withSchemePart(e){return this.withScheme(Di.parse(e))}get schemeName(){return this.scheme.name}withSchemeName(e){return this.withScheme(Di.create(e))}withAuthority(e){return(e=qi.fromAny(e))!==this.authority?this.copy(this.scheme,e,this.path,this.query,this.fragment):this}get authorityPart(){return this.authority.toString()}withAuthorityPart(e){return this.withAuthority(qi.parse(e))}get user(){return this.authority.user}withUser(e){return this.withAuthority(this.authority.withUser(e))}get userPart(){return this.authority.userPart}withUserPart(e){return this.withAuthority(this.authority.withUserPart(e))}get username(){return this.authority.username}withUsername(e,t){return 1===arguments.length?this.withAuthority(this.authority.withUsername(e)):this.withAuthority(this.authority.withUsername(e,t))}get password(){return this.authority.password}withPassword(e){return this.withAuthority(this.authority.withPassword(e))}get host(){return this.authority.host}withHost(e){return this.withAuthority(this.authority.withHost(e))}get hostPart(){return this.authority.hostPart}withHostPart(e){return this.withAuthority(this.authority.withHostPart(e))}get hostAddress(){return this.authority.hostAddress}get hostName(){return this.authority.hostName}withHostName(e){return this.withAuthority(this.authority.withHostName(e))}get hostIPv4(){return this.authority.hostIPv4}withHostIPv4(e){return this.withAuthority(this.authority.withHostIPv4(e))}get hostIPv6(){return this.authority.hostIPv6}withHostIPv6(e){return this.withAuthority(this.authority.withHostIPv6(e))}get port(){return this.authority.port}withPort(e){return this.withAuthority(this.authority.withPort(e))}get portPart(){return this.authority.portPart}withPortPart(e){return this.withAuthority(this.authority.withPortPart(e))}get portNumber(){return this.authority.portNumber}withPortNumber(e){return this.withAuthority(this.authority.withPortNumber(e))}withPath(...e){const t=Fi.of(...e);return t!==this.path?this.copy(this.scheme,this.authority,t,this.query,this.fragment):this}get pathPart(){return this.path.toString()}withPathPart(e){return this.withPath(Fi.parse(e))}get pathName(){return this.path.name}withPathName(e){return this.withPath(this.path.withName(e))}parentPath(){return this.path.parent()}basePath(){return this.path.base()}parent(){return Pi.create(this.scheme,this.authority,this.path.parent())}base(){return Pi.create(this.scheme,this.authority,this.path.base())}appendedPath(...e){return this.withPath(this.path.appended(...e))}appendedSlash(){return this.withPath(this.path.appendedSlash())}appendedSegment(e){return this.withPath(this.path.appendedSegment(e))}prependedPath(...e){return this.withPath(this.path.prepended(...e))}prependedSlash(){return this.withPath(this.path.prependedSlash())}prependedSegment(e){return this.withPath(this.path.prependedSegment(e))}withQuery(e){return(e=Ki.fromAny(e))!==this.query?this.copy(this.scheme,this.authority,this.path,e,this.fragment):this}get queryPart(){return this.query.toString()}withQueryPart(e){return this.withQuery(Ki.parse(e))}updatedQuery(e,t){return this.withQuery(this.query.updated(e,t))}removedQuery(e){return this.withQuery(this.query.removed(e))}appendedQuery(e,t){return this.withQuery(this.query.appended(e,t))}prependedQuery(e,t){return this.withQuery(this.query.prepended(e,t))}withFragment(e){return(e=Zi.fromAny(e))!==this.fragment?Pi.create(this.scheme,this.authority,this.path,this.query,e):this}get fragmentPart(){return this.fragment.toString()}withFragmentPart(e){return this.withFragment(Zi.parse(e))}get fragmentIdentifier(){return this.fragment.identifier}withFragmentIdentifier(e){return this.withFragment(Zi.create(e))}endpoint(){return this.path.isDefined()||this.query.isDefined()||this.fragment.isDefined()?Pi.create(this.scheme,this.authority):this}resolve(e){const t=Pi.fromAny(e);return t.scheme.isDefined()?this.copy(t.scheme,t.authority,t.path.removeDotSegments(),t.query,t.fragment):t.authority.isDefined()?this.copy(this.scheme,t.authority,t.path.removeDotSegments(),t.query,t.fragment):t.path.isEmpty()?this.copy(this.scheme,this.authority,this.path,t.query.isDefined()?t.query:this.query,t.fragment):t.path.isAbsolute()?this.copy(this.scheme,this.authority,t.path.removeDotSegments(),t.query,t.fragment):this.copy(this.scheme,this.authority,this.merge(t.path).removeDotSegments(),t.query,t.fragment)}merge(e){return this.authority.isDefined()&&this.path.isEmpty()?e.prependedSlash():this.path.isEmpty()?e:this.path.merge(e)}unresolve(e){const t=Pi.fromAny(e);return this.scheme.equals(t.scheme)&&this.authority.equals(t.authority)?Pi.create(Di.undefined(),qi.undefined(),this.path.unmerge(t.path),t.query,t.fragment):t}copy(e,t,r,i,n){return Pi.create(e,t,r,i,n)}toAny(){const e={};return e.scheme=this.scheme.toAny(),this.authority.toAny(e),e.path=this.path.toAny(),e.query=this.query.toAny(),e.fragment=this.fragment.toAny(),e}compareTo(e){return e instanceof Pi?this.toString().localeCompare(e.toString()):NaN}equals(e){return this===e||e instanceof Pi&&this.toString()===e.toString()}hashCode(){let e=this.hashValue;return void 0===e&&(e=u.hash(this.toString()),this.hashValue=e),e}debug(e){return e=e.write("Uri").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("empty").write(40).write(41)}display(e){const t=this.stringValue;return void 0!==t?e=e.write(t):(this.scheme.isDefined()&&(e=e.display(this.scheme).write(58)),this.authority.isDefined()&&(e=e.write(47).write(47).display(this.authority)),e=e.display(this.path),this.query.isDefined()&&(e=e.write(63).display(this.query)),this.fragment.isDefined()&&(e=e.write(35).display(this.fragment))),e}toString(){let e=this.stringValue;return void 0===e&&(e=he.display(this),this.stringValue=e),e}static empty(){return new Pi(Di.undefined(),qi.undefined(),Fi.empty(),Ki.undefined(),Zi.undefined())}static create(e=Di.undefined(),t=qi.undefined(),r=Fi.empty(),i=Ki.undefined(),n=Zi.undefined()){return e.isDefined()||t.isDefined()||r.isDefined()||i.isDefined()||n.isDefined()?new Pi(e,t,r,i,n):Pi.empty()}static fromInit(e){const t=Di.fromAny(e.scheme),r=qi.fromAny(void 0!==e.authority?e.authority:e),i=Fi.fromAny(e.path),n=Ki.fromAny(e.query),s=Zi.fromAny(e.fragment);return t.isDefined()||r.isDefined()||i.isDefined()||n.isDefined()||s.isDefined()?new Pi(t,r,i,n,s):Pi.empty()}static fromAny(e){if(null==e)return Pi.empty();if(e instanceof Pi)return e;if("object"==typeof e)return Pi.fromInit(e);if("string"==typeof e)return Pi.parse(e);throw new TypeError(""+e)}static scheme(e){return e=Di.fromAny(e),Pi.create(e,void 0,void 0,void 0,void 0)}static schemePart(e){const t=Di.parse(e);return Pi.create(t,void 0,void 0,void 0,void 0)}static schemeName(e){const t=Di.create(e);return Pi.create(t,void 0,void 0,void 0,void 0)}static authority(e){return e=qi.fromAny(e),Pi.create(void 0,e,void 0,void 0,void 0)}static authorityPart(e){const t=qi.parse(e);return Pi.create(void 0,t,void 0,void 0,void 0)}static user(e){const t=qi.user(e);return Pi.create(void 0,t,void 0,void 0,void 0)}static userPart(e){const t=qi.userPart(e);return Pi.create(void 0,t,void 0,void 0,void 0)}static username(e,t){const r=qi.username(e,t);return Pi.create(void 0,r,void 0,void 0,void 0)}static password(e){const t=qi.password(e);return Pi.create(void 0,t,void 0,void 0,void 0)}static host(e){const t=qi.host(e);return Pi.create(void 0,t,void 0,void 0,void 0)}static hostPart(e){const t=qi.hostPart(e);return Pi.create(void 0,t,void 0,void 0,void 0)}static hostName(e){const t=qi.hostName(e);return Pi.create(void 0,t,void 0,void 0,void 0)}static hostIPv4(e){const t=qi.hostIPv4(e);return Pi.create(void 0,t,void 0,void 0,void 0)}static hostIPv6(e){const t=qi.hostIPv6(e);return Pi.create(void 0,t,void 0,void 0,void 0)}static port(e){const t=qi.port(e);return Pi.create(void 0,t,void 0,void 0,void 0)}static portPart(e){const t=qi.portPart(e);return Pi.create(void 0,t,void 0,void 0,void 0)}static portNumber(e){const t=qi.portNumber(e);return Pi.create(void 0,t,void 0,void 0,void 0)}static path(...e){const t=Fi.of(...e);return Pi.create(void 0,void 0,t,void 0,void 0)}static pathPart(e){const t=Fi.parse(e);return Pi.create(void 0,void 0,t,void 0,void 0)}static query(e){return e=Ki.fromAny(e),Pi.create(void 0,void 0,void 0,e,void 0)}static queryPart(e){const t=Ki.parse(e);return Pi.create(void 0,void 0,void 0,t,void 0)}static fragment(e){return e=Zi.fromAny(e),Pi.create(void 0,void 0,void 0,void 0,e)}static fragmentPart(e){const t=Zi.parse(e);return Pi.create(void 0,void 0,void 0,void 0,t)}static fragmentIdentifier(e){const t=Zi.create(e);return Pi.create(void 0,void 0,void 0,void 0,t)}static get standardParser(){return new $i}static parse(e){return Pi.standardParser.parseAbsoluteString(e)}static pathBuilder(){return new Ri}static queryBuilder(){return new Qi}static form(){return new Xi(Pi.empty())}static isUnreservedChar(e){return e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||45===e||46===e||95===e||126===e}static isSubDelimChar(e){return 33===e||36===e||38===e||40===e||41===e||42===e||43===e||44===e||59===e||61===e||39===e}static isSchemeChar(e){return e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||43===e||45===e||46===e}static isUserInfoChar(e){return Pi.isUnreservedChar(e)||Pi.isSubDelimChar(e)||58===e}static isUserChar(e){return Pi.isUnreservedChar(e)||Pi.isSubDelimChar(e)}static isHostChar(e){return Pi.isUnreservedChar(e)||Pi.isSubDelimChar(e)}static isPathChar(e){return Pi.isUnreservedChar(e)||Pi.isSubDelimChar(e)||58===e||64===e}static isQueryChar(e){return Pi.isUnreservedChar(e)||Pi.isSubDelimChar(e)||47===e||58===e||63===e||64===e}static isParamChar(e){return Pi.isUnreservedChar(e)||33===e||36===e||40===e||41===e||42===e||43===e||44===e||47===e||58===e||59===e||63===e||64===e||39===e}static isFragmentChar(e){return Pi.isUnreservedChar(e)||Pi.isSubDelimChar(e)||47===e||58===e||63===e||64===e}static isAlpha(e){return e>=65&&e<=90||e>=97&&e<=122}static toLowerCase(e){return e>=65&&e<=90?e+32:e}static writeScheme(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=r>0&&Pi.isSchemeChar(i)||0===r&&Pi.isAlpha(i)?e.write(i):ie.error(new Ti("Invalid scheme: "+t))}return e}static writeUserInfo(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=Pi.isUserInfoChar(i)?e.write(i):Pi.writeEncoded(e,i)}return e}static writeUser(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=Pi.isUserChar(i)?e.write(i):Pi.writeEncoded(e,i)}return e}static writeHost(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=Pi.isHostChar(i)?e.write(i):Pi.writeEncoded(e,i)}return e}static writeHostLiteral(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=Pi.isHostChar(i)||58===i?e.write(i):Pi.writeEncoded(e,i)}return e}static writePathSegment(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=Pi.isPathChar(i)?e.write(i):Pi.writeEncoded(e,i)}return e}static writeQuery(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=Pi.isQueryChar(i)?e.write(i):Pi.writeEncoded(e,i)}return e}static writeParam(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=Pi.isParamChar(i)?e.write(i):Pi.writeEncoded(e,i)}return e}static writeFragment(e,t){for(let r=0,i=t.length;r<i;r+=1){const i=t.charCodeAt(r);e=Pi.isFragmentChar(i)?e.write(i):Pi.writeEncoded(e,i)}return e}static writeEncoded(e,t){return 0===t?(e=Pi.writePctEncoded(e,192),e=Pi.writePctEncoded(e,128)):t>=0&&t<=127?e=Pi.writePctEncoded(e,t):t>=128&&t<=2047?(e=Pi.writePctEncoded(e,192|t>>>6),e=Pi.writePctEncoded(e,128|63&t)):t>=2048&&t<=65535?(e=Pi.writePctEncoded(e,224|t>>>12),e=Pi.writePctEncoded(e,128|t>>>6&63),e=Pi.writePctEncoded(e,128|63&t)):t>=65536&&t<=1114111?(e=Pi.writePctEncoded(e,240|t>>>18),e=Pi.writePctEncoded(e,128|t>>>12&63),e=Pi.writePctEncoded(e,128|t>>>6&63),e=Pi.writePctEncoded(e,128|63&t)):(e=Pi.writePctEncoded(e,239),e=Pi.writePctEncoded(e,191),e=Pi.writePctEncoded(e,189)),e}static writePctEncoded(e,t){const r=Be.lowercase;return e=e.write(37).write(r.encodeDigit(t>>>4&15)).write(r.encodeDigit(15&t))}}e([n],Pi,"empty",null),e([n],Pi,"standardParser",null),e([n],Pi,"form",null);class Di{constructor(e){this.name=e}isDefined(){return 0!==this.name.length}toAny(){return 0!==this.name.length?this.name:void 0}compareTo(e){return e instanceof Di?this.name.localeCompare(e.name):NaN}equals(e){return this===e||e instanceof Di&&this.name===e.name}hashCode(){return u.hash(this.name)}debug(e){return e=e.write("UriScheme").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("undefined").write(40).write(41)}display(e){return e=Pi.writeScheme(e,this.name)}toString(){return this.name}static undefined(){return new Di("")}static create(e){const t=Di.cache,r=t.get(e);return void 0!==r?r:t.put(e,new Di(e))}static fromAny(e){if(null==e)return Di.undefined();if(e instanceof Di)return e;if("string"==typeof e)return Di.parse(e);throw new TypeError(""+e)}static parse(e){return Pi.standardParser.parseSchemeString(e)}static get cache(){return new U(4)}}e([n],Di,"undefined",null),e([n],Di,"cache",null);class qi{constructor(e,t,r){this.user=e,this.host=t,this.port=r,this.hashValue=void 0,this.stringValue=void 0}isDefined(){return this.user.isDefined()||this.host.isDefined()||this.port.isDefined()}withUser(e){return(e=Ii.fromAny(e))!==this.user?this.copy(e,this.host,this.port):this}get userPart(){return this.user.toString()}withUserPart(e){return this.withUser(Ii.parse(e))}get username(){return this.user.username}withUsername(e,t){return 1===arguments.length?this.withUser(this.user.withUsername(e)):this.withUser(Ii.create(e,t))}get password(){return this.user.password}withPassword(e){return this.withUser(this.user.withPassword(e))}withHost(e){return(e=Vi.fromAny(e))!==this.host?this.copy(this.user,e,this.port):this}get hostPart(){return this.host.toString()}withHostPart(e){return this.withHost(Vi.parse(e))}get hostAddress(){return this.host.address}get hostName(){return this.host.name}withHostName(e){return this.withHost(Vi.hostname(e))}get hostIPv4(){return this.host.ipv4}withHostIPv4(e){return this.withHost(Vi.ipv4(e))}get hostIPv6(){return this.host.ipv6}withHostIPv6(e){return this.withHost(Vi.ipv6(e))}withPort(e){return(e=Li.fromAny(e))!==this.port?this.copy(this.user,this.host,e):this}get portPart(){return this.port.toString()}withPortPart(e){return this.withPort(Li.parse(e))}get portNumber(){return this.port.number}withPortNumber(e){return this.withPort(Li.create(e))}copy(e,t,r){return qi.create(e,t,r)}toAny(e){return this.isDefined()&&(void 0===e&&(e={}),this.user.toAny(e),this.host.isDefined()&&(e.host=this.host.toAny()),this.port.isDefined()&&(e.port=this.port.toAny())),e}compareTo(e){return e instanceof qi?this.toString().localeCompare(e.toString()):NaN}equals(e){return this===e||e instanceof qi&&this.toString()===e.toString()}hashCode(){let e=this.hashValue;return void 0===e&&(e=u.hash(this.toString()),this.hashValue=e),e}debug(e){return e=e.write("UriAuthority").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("undefined").write(40).write(41)}display(e){const t=this.stringValue;if(void 0!==t)e=e.write(t);else{const t=this.user;t.isDefined()&&(e=e.display(t).write(64)),e=e.display(this.host);const r=this.port;r.isDefined()&&(e=e.write(58).display(r))}return e}toString(){let e=this.stringValue;return void 0===e&&(e=he.display(this),this.stringValue=e),e}static undefined(){return new qi(Ii.undefined(),Vi.undefined(),Li.undefined())}static create(e=Ii.undefined(),t=Vi.undefined(),r=Li.undefined()){return e.isDefined()||t.isDefined()||r.isDefined()?new qi(e,t,r):qi.undefined()}static fromInit(e){const t=Ii.fromAny(void 0!==e.user?e.user:e),r=Vi.fromAny(e.host),i=Li.fromAny(e.port);return qi.create(t,r,i)}static fromAny(e){if(null==e)return qi.undefined();if(e instanceof qi)return e;if("object"==typeof e)return qi.fromInit(e);if("string"==typeof e)return qi.parse(e);throw new TypeError(""+e)}static user(e){return e=Ii.fromAny(e),qi.create(e,void 0,void 0)}static userPart(e){const t=Ii.parse(e);return qi.create(t,void 0,void 0)}static username(e,t){const r=Ii.create(e,t);return qi.create(r,void 0,void 0)}static password(e){const t=Ii.create("",e);return qi.create(t,void 0,void 0)}static host(e){return e=Vi.fromAny(e),qi.create(void 0,e,void 0)}static hostPart(e){const t=Vi.parse(e);return qi.create(void 0,t,void 0)}static hostName(e){const t=Vi.hostname(e);return qi.create(void 0,t,void 0)}static hostIPv4(e){const t=Vi.ipv4(e);return qi.create(void 0,t,void 0)}static hostIPv6(e){const t=Vi.ipv6(e);return qi.create(void 0,t,void 0)}static port(e){return e=Li.fromAny(e),qi.create(void 0,void 0,e)}static portPart(e){const t=Li.parse(e);return qi.create(void 0,void 0,t)}static portNumber(e){const t=Li.create(e);return qi.create(void 0,void 0,t)}static parse(e){return Pi.standardParser.parseAuthorityString(e)}}e([n],qi,"undefined",null);class Ii{constructor(e,t){this.username=e,this.password=t}isDefined(){return void 0!==this.username}withUsername(e){return e!==this.username?this.copy(e,this.password):this}withPassword(e){return e!==this.password?this.copy(this.username,e):this}copy(e,t){return Ii.create(e,t)}toAny(e){return void 0!==this.username&&(void 0===e&&(e={}),e.username=this.username,void 0!==this.password&&(e.password=this.password)),e}equals(e){return this===e||e instanceof Ii&&(this.username===e.username&&this.password===e.password)}hashCode(){return u.hash(this.toString())}debug(e){return e=e.write("UriUser").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("undefined").write(40).write(41)}display(e){return void 0!==this.username&&(e=Pi.writeUser(e,this.username),void 0!==this.password&&(e=e.write(58),e=Pi.writeUser(e,this.password))),e}toString(){return he.display(this)}static undefined(){return new Ii(void 0,void 0)}static create(e,t){return void 0!==e||void 0!==t?new Ii(e,t):Ii.undefined()}static fromInit(e){return Ii.create(e.username,e.password)}static fromAny(e){if(null==e)return Ii.undefined();if(e instanceof Ii)return e;if("object"==typeof e)return Ii.fromInit(e);if("string"==typeof e)return Ii.parse(e);throw new TypeError(""+e)}static parse(e){return Pi.standardParser.parseUserString(e)}}e([n],Ii,"undefined",null);class Vi{constructor(){}isDefined(){return!0}get name(){}get ipv4(){}get ipv6(){}toAny(){return this.toString()}compareTo(e){return e instanceof Vi?this.toString().localeCompare(e.toString()):NaN}equals(e){return this===e||e instanceof Vi&&this.toString()===e.toString()}hashCode(){return u.hash(this.toString())}static undefined(){return new ji}static hostname(e){const t=Vi.cache,r=t.get(e);return r instanceof Ni?r:t.put(e,new Ni(e))}static ipv4(e){const t=Vi.cache,r=t.get(e);return r instanceof zi?r:t.put(e,new zi(e))}static ipv6(e){const t=Vi.cache,r=t.get(e);return r instanceof Mi?r:t.put(e,new Mi(e))}static fromAny(e){if(null==e)return Vi.undefined();if(e instanceof Vi)return e;if("string"==typeof e)return Vi.parse(e);throw new TypeError(""+e)}static parse(e){return Pi.standardParser.parseHostString(e)}static get cache(){return new U(16)}}e([n],Vi,"undefined",null),e([n],Vi,"cache",null);class Ni extends Vi{constructor(e){super(),this.address=e}get name(){return this.address}debug(e){return e=e.write("UriHost").write(46).write("hostname").write(40).debug(this.address).write(41)}display(e){return e=Pi.writeHost(e,this.address)}toString(){return this.address}}class zi extends Vi{constructor(e){super(),this.address=e}get ipv4(){return this.address}debug(e){return e=e.write("UriHost").write(46).write("ipv4").write(40).debug(this.address).write(41)}display(e){return e=Pi.writeHost(e,this.address)}toString(){return this.address}}class Mi extends Vi{constructor(e){super(),this.address=e}get ipv6(){return this.address}debug(e){return e=e.write("UriHost").write(46).write("ipv6").write(40).debug(this.address).write(41)}display(e){return e=e.write(91),e=(e=Pi.writeHostLiteral(e,this.address)).write(93)}toString(){return"["+this.address+"]"}}class ji extends Vi{constructor(){super()}isDefined(){return!1}get address(){return""}debug(e){return e=e.write("UriHost").write(46).write("undefined").write(40).write(41)}display(e){return e}toString(){return""}}class Li{constructor(e){this.number=e}isDefined(){return 0!==this.number}valueOf(){return this.number}toAny(){return this.number}compareTo(e){return e instanceof Li?this.number<e.number?-1:this.number>e.number?1:0:NaN}equals(e){return this===e||e instanceof Li&&this.number===e.number}hashCode(){return u.hash(this.toString())}debug(e){return e=e.write("UriPort").write(46),this.isDefined()?(e=e.write("create").write(40),e=he.displayNumber(e,this.number)):e=e.write("undefined").write(40),e=e.write(41)}display(e){return e=he.displayNumber(e,this.number)}toString(){return""+this.number}static undefined(){return new Li(0)}static create(e){if(0===e)return Li.undefined();if(e>0){const t=Li.cache,r=t.get(e);return void 0!==r?r:t.put(e,new Li(e))}throw new TypeError(""+e)}static fromAny(e){if(null==e)return Li.undefined();if(e instanceof Li)return e;if("number"==typeof e)return Li.create(e);if("string"==typeof e)return Li.parse(e);throw new TypeError(""+e)}static parse(e){return Pi.standardParser.parsePortString(e)}static get cache(){return new U(16)}}e([n],Li,"undefined",null),e([n],Li,"cache",null);class Fi{constructor(){}get length(){let e=0,t=this;for(;!t.isEmpty();)e+=1,t=t.tail();return e}get(e){let t=0,r=this;for(;!r.isEmpty();){if(!(t<e))return r.head();t+=1,r=r.tail()}}get name(){if(this.isEmpty())return"";let e=this;for(;;){const t=e.tail();if(t.isEmpty())return e.isRelative()?e.head():"";e=t}}withName(e){const t=new Ri;return t.addPath(this.base()),t.addSegment(e),t.bind()}foot(){if(this.isEmpty())return this;let e=this;for(;;){const t=e.tail();if(t.isEmpty())return e;e=t}}isSubpathOf(e){e=Fi.fromAny(e);let t=this;for(;!t.isEmpty()&&!e.isEmpty();){if(t.head()!==e.head())return!1;t=t.tail(),e=e.tail()}return e.isEmpty()}appended(...e){if(arguments.length>0){const t=new Ri;return t.addPath(this),t.push(...e),t.bind()}return this}appendedSlash(){const e=new Ri;return e.addPath(this),e.addSlash(),e.bind()}appendedSegment(e){const t=new Ri;return t.addPath(this),t.addSegment(e),t.bind()}prepended(...e){if(arguments.length>0){const t=new Ri;return t.push(...e),t.addPath(this),t.bind()}return this}prependedSlash(){return new Ui(this)}prependedSegment(e){return this.isEmpty()||this.isAbsolute()?Fi.segment(e,this):Fi.segment(e,this.prependedSlash())}resolve(e){return e.isEmpty()?this:e.isAbsolute()||this.isEmpty()?e.removeDotSegments():this.merge(e).removeDotSegments()}removeDotSegments(){let e=this;const t=new Ri;for(;!e.isEmpty();){const r=e.head();if("."===r||".."===r)e=e.tail(),e.isEmpty()||(e=e.tail());else if(e.isAbsolute()){const i=e.tail();if(i.isEmpty())t.push(e.head()),e=e.tail();else{const n=i.head();"."===n?(e=i.tail(),e.isEmpty()&&(e=Fi.slash())):".."===n?(e=i.tail(),e.isEmpty()&&(e=Fi.slash()),t.isEmpty()||t.pop().isAbsolute()||t.isEmpty()||t.pop()):(t.push(r,n),e=i.tail())}}else t.push(e.head()),e=e.tail()}return t.bind()}merge(e){if(this.isEmpty())return e;{const t=new Ri;let r=this;for(;;){const e=r.tail();if(e.isEmpty()){r.isAbsolute()&&t.addSlash();break}r.isAbsolute()?t.addSlash():t.addSegment(r.head()),r=e}return t.addPath(e),t.bind()}}unmerge(e,t=e){let r=this;for(;;){if(r.isEmpty())return e.isEmpty()||e.tail().isEmpty()?e:e.tail();if(r.isRelative())return e;if(e.isRelative())return e.prependedSlash();{let i=r.tail(),n=e.tail();if(!i.isEmpty()&&n.isEmpty())return Fi.slash();if(i.isEmpty()||n.isEmpty()||i.head()!==n.head())return n;if(i=i.tail(),n=n.tail(),!i.isEmpty()&&n.isEmpty())return t;r=i,e=n}}}toAny(){const e=[];let t=this;for(;!t.isEmpty();)e.push(t.head()),t=t.tail();return e}compareTo(e){return e instanceof Fi?this.toString().localeCompare(e.toString()):NaN}equals(e){return this===e||e instanceof Fi&&this.toString()===e.toString()}hashCode(){return u.hash(this.toString())}display(e){let t=this;for(;!t.isEmpty();)e=t.isAbsolute()?e.write(47):Pi.writePathSegment(e,t.head()),t=t.tail();return e}static empty(){return new Wi}static slash(){return new Ui(Fi.empty())}static segment(e,t){return void 0===t&&(t=Fi.empty()),e=this.cacheSegment(e),new Bi(e,t)}static of(...e){const t=new Ri;return t.push(...e),t.bind()}static fromAny(e){if(null==e)return Fi.empty();if(e instanceof Fi)return e;if(Array.isArray(e))return Fi.of(...e);if("string"==typeof e)return Fi.parse(e);throw new TypeError(""+e)}static parse(e){return Pi.standardParser.parsePathString(e)}static builder(){return new Ri}static pathForm(){return new Hi(Fi.empty())}static get segmentCache(){return new R(64)}static cacheSegment(e){return e.length<=32?this.segmentCache.put(e):e}}e([n],Fi,"empty",null),e([n],Fi,"slash",null),e([n],Fi,"pathForm",null),e([n],Fi,"segmentCache",null);class Bi extends Fi{constructor(e,t){super(),this.segment=e,this.rest=t,this.stringValue=void 0}isDefined(){return!0}isAbsolute(){return!1}isRelative(){return!0}isEmpty(){return!1}head(){return this.segment}tail(){return this.rest}setTail(e){if(e instanceof Bi)throw new Error("adjacent path segments");this.rest=e}dealias(){return new Bi(this.segment,this.rest)}parent(){const e=this.rest;if(e.isEmpty())return Fi.empty();return e.tail().isEmpty()?Fi.empty():new Bi(this.segment,e.parent())}base(){const e=this.rest;return e.isEmpty()?Fi.empty():new Bi(this.segment,e.base())}prependedSegment(e){return Fi.segment(e,this.prependedSlash())}debug(e){return e=e.write("UriPath").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)}display(e){const t=this.stringValue;return e=void 0!==t?e.write(t):super.display(e)}toString(){let e=this.stringValue;return void 0===e&&(e=he.display(this),this.stringValue=e),e}}class Ui extends Fi{constructor(e){super(),this.rest=e,this.stringValue=void 0}isDefined(){return!0}isAbsolute(){return!0}isRelative(){return!1}isEmpty(){return!1}head(){return"/"}tail(){return this.rest}setTail(e){this.rest=e}dealias(){return new Ui(this.rest)}parent(){const e=this.rest;if(e.isEmpty())return Fi.empty();return e.tail().isEmpty()?Fi.slash():new Ui(e.parent())}base(){const e=this.rest;return e.isEmpty()?this:new Ui(e.base())}prependedSegment(e){return Fi.segment(e,this)}debug(e){return e=e.write("UriPath").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)}display(e){const t=this.stringValue;return e=void 0!==t?e.write(t):super.display(e)}toString(){let e=this.stringValue;return void 0===e&&(e=he.display(this),this.stringValue=e),e}}class Wi extends Fi{constructor(){super()}isDefined(){return!1}isAbsolute(){return!1}isRelative(){return!0}isEmpty(){return!0}head(){throw new Error("empty path")}tail(){throw new Error("empty path")}setTail(e){throw new Error("empty path")}dealias(){return this}parent(){return this}base(){return this}appended(...e){return Fi.of(...e)}appendedSlash(){return Fi.slash()}appendedSegment(e){return Fi.segment(e)}prepended(...e){return Fi.of(...e)}prependedSlash(){return Fi.slash()}prependedSegment(e){return Fi.segment(e)}merge(e){return e}debug(e){return e=e.write("UriPath").write(46).write("empty").write(40).write(41)}display(e){return e}toString(){return""}}class Ri{constructor(){this.first=Fi.empty(),this.last=null,this.size=0,this.aliased=0}isEmpty(){return 0===this.size}push(...e){for(let t=0;t<e.length;t+=1){const r=e[t];r instanceof Fi?this.addPath(r):Array.isArray(r)?this.push(...r):"/"===r?this.addSlash():this.addSegment(r)}}bind(){return this.aliased=0,this.first}addSlash(){const e=Fi.slash().dealias(),t=this.size;0===t?this.first=e:this.dealias(t-1).setTail(e),this.last=e,this.size=t+1,this.aliased+=1}addSegment(e){const t=Fi.segment(e,Fi.empty());let r=this.size;if(0===r)this.first=t;else{const e=this.dealias(r-1);e.isAbsolute()?e.setTail(t):(e.setTail(t.prependedSlash()),r+=1,this.aliased+=1)}this.last=t,this.size=r+1,this.aliased+=1}addPath(e){if(!e.isEmpty()){let t=this.size;if(0===t)this.first=e;else{const r=this.dealias(t-1);r.isAbsolute()||e.isAbsolute()?r.setTail(e):(r.setTail(e.prependedSlash()),t+=1,this.aliased+=1)}for(t+=1;;){const r=e.tail();if(r.isEmpty())break;e=r,t+=1}this.last=e,this.size=t}}pop(){const e=this.size,t=this.aliased;if(0===e)throw new Error("Empty UriPath");if(1===e){const r=this.first;return this.first=r.tail(),r.tail().isEmpty()&&(this.last=null),this.size=e-1,t>0&&(this.aliased=t-1),r}{const r=this.dealias(e-2);return r.setTail(Fi.empty()),this.last=r,this.size=e-1,this.aliased=t-1,r.tail()}}dealias(e){let t=0,r=null,i=this.first;if(this.aliased<=e){for(;t<this.aliased;)r=i,i=i.tail(),t+=1;for(;t<=e;){const e=i.dealias();0===t?this.first=e:r.setTail(e),r=e,i=i.tail(),t+=1}t===this.size&&(this.last=r),this.aliased=t}else if(0===e)r=this.first;else if(e===this.size-1)r=this.last;else for(;t<=e;)r=i,i=i.tail(),t+=1;return r}}class Hi extends br{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new Hi(e):this}mold(e,t){return e=Fi.fromAny(e),void 0===t?yt.from(e.toString()):t.concat(yt.from(e.toString()))}cast(e,t){const r=e.target;try{const e=r.stringValue();if("string"==typeof e)return Fi.parse(e)}catch(e){}}}class Ki{get length(){let e=0,t=this;for(;!t.isEmpty();)e+=1,t=t.tail();return e}has(e){let t=this;for(;!t.isEmpty();){if(e===t.key)return!0;t=t.tail()}return!1}get(e){let t=this;for(;!t.isEmpty();){if(e===t.key)return t.value;t=t.tail()}}updated(e,t){let r=this;const i=new Qi;let n=!1;for(;!r.isEmpty();)e===r.key?(i.addParam(e,t),n=!0):i.addParam(r.key,r.value),r=r.tail();return n||i.addParam(e,t),i.bind()}removed(e){let t=this;const r=new Qi;let i=!1;for(;!t.isEmpty();)e===t.key?i=!0:r.addParam(t.key,t.value),t=t.tail();return i?r.bind():this}appended(e,t){const r=new Qi;return r.addQuery(this),r.add(e,t),r.bind()}prepended(e,t){const r=new Qi;return r.add(e,t),r.addQuery(this),r.bind()}toAny(e){if(this.isDefined()){e=e||{};let t=this,r=0;for(;!t.isEmpty();){const i=t.key;void 0!==i?e[i]=t.value:e["$"+r]=t.value,t=t.tail(),r+=1}}return e}compareTo(e){return e instanceof Ki?this.toString().localeCompare(e.toString()):NaN}equals(e){return this===e||e instanceof Ki&&this.toString()===e.toString()}hashCode(){return u.hash(this.toString())}display(e){let t=this,r=!0;for(;!t.isEmpty();){r?r=!1:e=e.write(38);const i=t.key;void 0!==i&&(e=(e=Pi.writeParam(e,i)).write(61)),e=Pi.writeQuery(e,t.value),t=t.tail()}return e}static undefined(){return new Gi}static param(e,t,r){return void 0===r?(r=t,t=e,e=void 0):void 0!==e&&(e=this.cacheKey(e)),void 0===r&&(r=Ki.undefined()),new _i(e,t,r)}static fromAny(e){if(null==e)return Ki.undefined();if(e instanceof Ki)return e;if("object"==typeof e){const t=new Qi;return t.add(e),t.bind()}if("string"==typeof e)return Ki.parse(e);throw new TypeError(""+e)}static parse(e){return Pi.standardParser.parseQueryString(e)}static builder(){return new Qi}static get keyCache(){return new R(64)}static cacheKey(e){return e.length<=32?Ki.keyCache.put(e):e}}e([n],Ki,"undefined",null),e([n],Ki,"keyCache",null);class _i extends Ki{constructor(e,t,r){super(),this.key=e,this.value=t,this.rest=r,this.stringValue=void 0}isDefined(){return!0}isEmpty(){return!1}head(){return[this.key,this.value]}tail(){return this.rest}setTail(e){this.rest=e}dealias(){return new _i(this.key,this.value,this.rest)}debug(e){return e=e.write("UriQuery").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)}display(e){const t=this.stringValue;return e=void 0!==t?e.write(t):super.display(e)}toString(){let e=this.stringValue;return void 0===e&&(e=he.display(this),this.stringValue=e),e}}class Gi extends Ki{isDefined(){return!1}isEmpty(){return!0}head(){throw new Error("undefined query")}get key(){throw new Error("undefined query")}get value(){throw new Error("undefined query")}tail(){throw new Error("undefined query")}setTail(e){throw new Error("undefined query")}dealias(){return this}updated(e,t){return Ki.param(e,t,this)}removed(e){return this}appended(e,t){const r=new Qi;return r.add(e,t),r.bind()}prepended(e,t){const r=new Qi;return r.add(e,t),r.bind()}debug(e){return e=e.write("UriQuery").write(46).write("undefined").write(40).write(41)}display(e){return e}toString(){return""}}class Qi{constructor(){this.first=Ki.undefined(),this.last=null,this.size=0,this.aliased=0}isEmpty(){return 0===this.size}add(e,t){if(void 0!==t)this.addParam(e,t);else if("string"==typeof e)this.addParam(void 0,e);else if(e instanceof Ki)this.addQuery(e);else{const t=e;for(const e in t){let r=e;const i=t[e];36===e.charCodeAt(0)&&(r=void 0),this.addParam(r,i)}}}bind(){return this.aliased=0,this.first}addParam(e,t){void 0===t&&(t=e,e=void 0);const r=Ki.param(e,t,Ki.undefined()),i=this.size;0===i?this.first=r:this.dealias(i-1).setTail(r),this.last=r,this.size=i+1,this.aliased+=1}addQuery(e){if(!e.isEmpty()){let t=this.size;for(0===t?this.first=e:this.dealias(t-1).setTail(e),t+=1;;){const r=e.tail();if(r.isEmpty())break;e=r,t+=1}this.last=e,this.size=t}}dealias(e){let t=0,r=null,i=this.first;if(this.aliased<=e){for(;t<this.aliased;)r=i,i=i.tail(),t+=1;for(;t<=e;){const e=i.dealias();0===t?this.first=e:r.setTail(e),r=e,i=i.tail(),t+=1}t===this.size&&(this.last=r),this.aliased=t}else if(0===e)r=this.first;else if(e===this.size-1)r=this.last;else for(;t<=e;)r=i,i=i.tail(),t+=1;return r}}class Zi{constructor(e){this.identifier=e,this.stringValue=void 0}isDefined(){return void 0!==this.identifier}toAny(){return this.identifier}compareTo(e){return e instanceof Zi?this.toString().localeCompare(e.toString()):NaN}equals(e){return this===e||e instanceof Zi&&this.identifier===e.identifier}hashCode(){return u.hash(this.identifier)}debug(e){return e=e.write("UriFragment").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("undefined").write(40).write(41)}display(e){const t=this.stringValue;return void 0!==t?e=e.write(t):void 0!==this.identifier&&(e=Pi.writeFragment(e,this.identifier)),e}toString(){let e=this.stringValue;return void 0===e&&(e=he.display(this),this.stringValue=e),e}static undefined(){return new Zi(void 0)}static create(e){if(void 0!==e){const t=Zi.cache,r=t.get(e);return void 0!==r?r:t.put(e,new Zi(e))}return Zi.undefined()}static fromAny(e){if(null==e)return Zi.undefined();if(e instanceof Zi)return e;if("string"==typeof e)return Zi.parse(e);throw new TypeError(""+e)}static parse(e){return Pi.standardParser.parseFragmentString(e)}static get cache(){return new U(32)}}e([n],Zi,"undefined",null),e([n],Zi,"cache",null);class Xi extends br{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(e){return e!==this.unit?new Xi(e):this}mold(e,t){return e=Pi.fromAny(e),void 0===t?yt.from(e.toString()):t.concat(yt.from(e.toString()))}cast(e,t){const r=e.target;try{const e=r.stringValue();if("string"==typeof e)return Pi.parse(e)}catch(e){}}}class $i{absolute(e,t,r,i,n){return Pi.create(e,t,r,i,n)}scheme(e){return Di.create(e)}authority(e,t,r){return qi.create(e,t,r)}user(e,t){return Ii.create(e,t)}hostName(e){return Vi.hostname(e)}hostIPv4(e){return Vi.ipv4(e)}hostIPv6(e){return Vi.ipv6(e)}port(e){return Li.create(e)}pathEmpty(){return Fi.empty()}pathBuilder(){return new Ri}queryBuilder(){return new Qi}fragment(e){return Zi.create(e)}absoluteParser(){return new Yi(this)}parseAbsolute(e){return Yi.parse(e,this)}parseAbsoluteString(e){const t=ue.stringInput(e);let r=this.parseAbsolute(t);return t.isCont()&&!r.isError()&&(r=Se.error(ce.unexpected(t))),r.bind()}schemeParser(){return new Ji(this)}parseScheme(e){return Ji.parse(e,this)}parseSchemeString(e){const t=ue.stringInput(e);let r=this.parseScheme(t);return t.isCont()&&!r.isError()&&(r=Se.error(ce.unexpected(t))),r.bind()}authorityParser(){return new en(this)}parseAuthority(e){return en.parse(e,this)}parseAuthorityString(e){const t=ue.stringInput(e);let r=this.parseAuthority(t);return t.isCont()&&!r.isError()&&(r=Se.error(ce.unexpected(t))),r.bind()}userParser(){return new tn(this)}parseUser(e){return tn.parse(e,this)}parseUserString(e){const t=ue.stringInput(e);let r=this.parseUser(t);return t.isCont()&&!r.isError()&&(r=Se.error(ce.unexpected(t))),r.bind()}hostParser(){return new rn(this)}parseHost(e){return rn.parse(e,this)}parseHostString(e){const t=ue.stringInput(e);let r=this.parseHost(t);return t.isCont()&&!r.isError()&&(r=Se.error(ce.unexpected(t))),r.bind()}hostAddressParser(){return new nn(this)}parseHostAddress(e){return nn.parse(e,this)}hostLiteralParser(){return new sn(this)}parseHostLiteral(e){return sn.parse(e,this)}portParser(){return new on(this)}parsePort(e){return on.parse(e,this)}parsePortString(e){const t=ue.stringInput(e);let r=this.parsePort(t);return t.isCont()&&!r.isError()&&(r=Se.error(ce.unexpected(t))),r.bind()}pathParser(e){return new an(this,e)}parsePath(e,t){return an.parse(e,this,t)}parsePathString(e){const t=ue.stringInput(e);let r=this.parsePath(t);return t.isCont()&&!r.isError()&&(r=Se.error(ce.unexpected(t))),r.bind()}queryParser(e){return new un(this,e)}parseQuery(e,t){return un.parse(e,this,t)}parseQueryString(e){const t=ue.stringInput(e);let r=this.parseQuery(t);return t.isCont()&&!r.isError()&&(r=Se.error(ce.unexpected(t))),r.bind()}fragmentParser(){return new hn(this)}parseFragment(e){return hn.parse(e,this)}parseFragmentString(e){const t=ue.stringInput(e);let r=this.parseFragment(t);return t.isCont()&&!r.isError()&&(r=Se.error(ce.unexpected(t))),r.bind()}}class Yi extends Se{constructor(e,t,r,i,n,s,o){super(),this.uri=e,this.schemeParser=t,this.authorityParser=r,this.pathParser=i,this.queryParser=n,this.fragmentParser=s,this.step=o}feed(e){return Yi.parse(e,this.uri,this.schemeParser,this.authorityParser,this.pathParser,this.queryParser,this.fragmentParser,this.step)}static parse(e,t,r,i,n,s,o,a=1){let u=0;if(1===a)if(e.isCont()){const t=e.clone();for(;t.isCont()&&(u=t.head(),Pi.isSchemeChar(u));)t.step();a=t.isCont()&&58===u?2:3}else e.isDone()&&(a=3);if(2===a)if((r=void 0===r?t.parseScheme(e):r.feed(e)).isDone()){if(e.isCont()&&58===e.head())e=e.step(),a=3;else if(!e.isEmpty())return Se.error(ce.expected(58,e))}else if(r.isError())return r.asError();if(3===a)if(e.isCont())u=e.head(),47===u?(e=e.step(),a=4):63===u?(e=e.step(),a=7):35===u?(e=e.step(),a=8):a=6;else if(e.isDone())return Se.done(t.absolute(void 0!==r?r.bind():void 0));if(4===a)if(e.isCont()&&47===e.head())e=e.step(),a=5;else if(e.isCont()){const r=t.pathBuilder();r.addSlash(),n=t.parsePath(e,r),a=6}else if(e.isDone())return Se.done(t.absolute(void 0!==r?r.bind():void 0,void 0,Fi.slash()));if(5===a)if((i=void 0===i?t.parseAuthority(e):i.feed(e)).isDone()){if(e.isCont())u=e.head(),63===u?(e=e.step(),a=7):35===u?(e=e.step(),a=8):a=6;else if(e.isDone())return Se.done(t.absolute(void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0))}else if(i.isError())return i.asError();if(6===a)if((n=void 0===n?t.parsePath(e):n.feed(e)).isDone()){if(e.isCont()&&63===e.head())e=e.step(),a=7;else if(e.isCont()&&35===e.head())e=e.step(),a=8;else if(!e.isEmpty())return Se.done(t.absolute(void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0,n.bind()))}else if(n.isError())return n.asError();if(7===a)if((s=void 0===s?t.parseQuery(e):s.feed(e)).isDone()){if(e.isCont()&&35===e.head())e=e.step(),a=8;else if(!e.isEmpty())return Se.done(t.absolute(void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0,void 0!==n?n.bind():void 0,s.bind()))}else if(s.isError())return s.asError();if(8===a){if((o=void 0===o?t.parseFragment(e):o.feed(e)).isDone())return Se.done(t.absolute(void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0,void 0!==n?n.bind():void 0,void 0!==s?s.bind():void 0,o.bind()));if(o.isError())return o.asError()}return new Yi(t,r,i,n,s,o,a)}}class Ji extends Se{constructor(e,t,r){super(),this.uri=e,this.output=t,this.step=r}feed(e){return Ji.parse(e,this.uri,this.output,this.step)}static parse(e,t,r,i=1){let n=0;if(1===i)if(e.isCont()&&(n=e.head(),Pi.isAlpha(n)))e=e.step(),r=(r=r||Re.decodedString()).write(Pi.toLowerCase(n)),i=2;else if(!e.isEmpty())return Se.error(ce.expected("scheme",e));if(2===i){for(;e.isCont()&&(n=e.head(),Pi.isSchemeChar(n));)e=e.step(),r.write(Pi.toLowerCase(n));if(!e.isEmpty())return Se.done(t.scheme(r.bind()))}return new Ji(t,r,i)}}class en extends Se{constructor(e,t,r,i,n){super(),this.uri=e,this.userParser=t,this.hostParser=r,this.portParser=i,this.step=n}feed(e){return en.parse(e,this.uri,this.userParser,this.hostParser,this.portParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s)if(e.isCont()){const t=e.clone();for(;t.isCont()&&(o=t.head(),64!==o&&47!==o);)t.step();s=t.isCont()&&64===o?2:3}else e.isDone()&&(s=3);if(2===s)if((r=void 0===r?t.parseUser(e):r.feed(e)).isDone()){if(e.isCont()&&64===e.head())e=e.step(),s=3;else if(!e.isEmpty())return Se.error(ce.expected(64,e))}else if(r.isError())return r.asError();if(3===s)if((i=void 0===i?t.parseHost(e):i.feed(e)).isDone()){if(e.isCont()&&58===e.head())e=e.step(),s=4;else if(!e.isEmpty())return Se.done(t.authority(void 0!==r?r.bind():void 0,i.bind()))}else if(i.isError())return i.asError();if(4===s){if((n=void 0===n?t.parsePort(e):n.feed(e)).isDone())return Se.done(t.authority(void 0!==r?r.bind():void 0,i.bind(),n.bind()));if(n.isError())return n.asError()}return new en(t,r,i,n,s)}}class tn extends Se{constructor(e,t,r,i,n){super(),this.uri=e,this.usernameOutput=t,this.passwordOutput=r,this.c1=i,this.step=n}feed(e){return tn.parse(e,this.uri,this.usernameOutput,this.passwordOutput,this.c1,this.step)}static parse(e,t,r,i,n=0,s=1){let o=0;for(;;){if(1===s){for(r=r||Re.decodedString();e.isCont()&&(o=e.head(),Pi.isUserChar(o));)e=e.step(),r.write(o);if(e.isCont()&&58===o)e=e.step(),s=4;else if(e.isCont()&&37===o)e=e.step(),s=2;else if(!e.isEmpty())return Se.done(t.user(r.bind()))}if(2===s)if(e.isCont()&&(o=e.head(),Be.isDigit(o)))e=e.step(),n=o,s=3;else if(!e.isEmpty())return Se.error(ce.expected("hex digit",e));if(3===s){if(e.isCont()&&(o=e.head(),Be.isDigit(o))){e=e.step(),r.write(Be.decodeDigit(n)<<4|Be.decodeDigit(o)),n=0,s=1;continue}if(!e.isEmpty())return Se.error(ce.expected("hex digit",e))}if(4===s){for(i=i||Re.decodedString();e.isCont()&&(o=e.head(),Pi.isUserInfoChar(o));)e=e.step(),i.write(o);if(e.isCont()&&37===o)e=e.step(),s=5;else if(!e.isEmpty())return Se.done(t.user(r.bind(),i.bind()))}if(5===s)if(e.isCont()&&(o=e.head(),Be.isDigit(o)))e=e.step(),n=o,s=6;else if(!e.isEmpty())return Se.error(ce.expected("hex digit",e));if(6===s){if(e.isCont()&&(o=e.head(),Be.isDigit(o))){e=e.step(),i.write(Be.decodeDigit(n)<<4|Be.decodeDigit(o)),n=0,s=4;continue}if(!e.isEmpty())return Se.error(ce.expected("hex digit",e))}break}return new tn(t,r,i,n,s)}}class rn extends Se{constructor(e){super(),this.uri=e}feed(e){return rn.parse(e,this.uri)}static parse(e,t){if(e.isCont()){return 91===e.head()?t.parseHostLiteral(e):t.parseHostAddress(e)}return e.isDone()?Se.done(t.hostName("")):new rn(t)}}class nn extends Se{constructor(e,t,r,i,n){super(),this.uri=e,this.output=t,this.c1=r,this.x=i,this.step=n}feed(e){return nn.parse(e,this.uri,this.output,this.c1,this.x,this.step)}static parse(e,t,r,i=0,n=0,s=1){let o=0;for(r=r||Re.decodedString();s<=4;){for(;e.isCont()&&(o=e.head(),le.isDigit(o));)e=e.step(),r=r.write(o),n=10*n+le.decodeDigit(o);if(!e.isCont()){if(e.isEmpty())break;return 4===s&&n<=255?Se.done(t.hostIPv4(r.bind())):Se.done(t.hostName(r.bind()))}if(!(46===o&&s<4&&n<=255)){if(!Pi.isHostChar(o)&&37!==o&&4===s&&n<=255)return Se.done(t.hostIPv4(r.bind()));n=0,s=5;break}e=e.step(),r=r.write(o),n=0,s+=1}for(;;){if(5===s){for(;e.isCont()&&(o=e.head(),Pi.isHostChar(o));)e=e.step(),r.write(Pi.toLowerCase(o));if(e.isCont()&&37===o)e=e.step(),s=6;else if(!e.isEmpty())return Se.done(t.hostName(r.bind()))}if(6===s)if(e.isCont()&&(o=e.head(),Be.isDigit(o)))e=e.step(),i=o,s=7;else if(!e.isEmpty())return Se.error(ce.expected("hex digit",e));if(7===s){if(e.isCont()&&(o=e.head(),Be.isDigit(o))){e=e.step(),r.write(Be.decodeDigit(i)<<4|Be.decodeDigit(o)),i=0,s=5;continue}if(!e.isEmpty())return Se.error(ce.expected("hex digit",e))}break}return new nn(t,r,i,n,s)}}class sn extends Se{constructor(e,t,r){super(),this.uri=e,this.output=t,this.step=r}feed(e){return sn.parse(e,this.uri,this.output,this.step)}static parse(e,t,r,i=1){let n=0;if(1===i)if(e.isCont()&&91===e.head())e=e.step(),i=2;else if(!e.isEmpty())return Se.error(ce.expected(91,e));if(2===i){for(r=r||Re.decodedString();e.isCont()&&(n=e.head(),Pi.isHostChar(n)||58===n);)e=e.step(),r=r.write(Pi.toLowerCase(n));if(e.isCont()&&93===n)return e=e.step(),Se.done(t.hostIPv6(r.bind()));if(!e.isEmpty())return Se.error(ce.expected(93,e))}return new sn(t,r,i)}}class on extends Se{constructor(e,t){super(),this.uri=e,this.number=t}feed(e){return on.parse(e,this.uri,this.number)}static parse(e,t,r=0){let i=0;for(;e.isCont()&&(i=e.head(),le.isDigit(i));)e=e.step(),r=10*r+le.decodeDigit(i);return e.isEmpty()?new on(t,r):Se.done(t.port(r))}}class an extends Se{constructor(e,t,r,i,n){super(),this.uri=e,this.builder=t,this.output=r,this.c1=i,this.step=n}feed(e){return an.parse(e,this.uri,this.builder,this.output,this.c1,this.step)}static parse(e,t,r,i,n=0,s=1){let o=0;for(;;){if(1===s){for(;e.isCont()&&(o=e.head(),Pi.isPathChar(o));)i=i||Re.decodedString(),e=e.step(),i=i.write(o);if(e.isCont()&&47===o){e=e.step(),r=r||t.pathBuilder(),void 0!==i&&(r.addSegment(i.bind()),i=void 0),r.addSlash();continue}if(e.isCont()&&37===o)e=e.step(),s=2;else if(!e.isEmpty())return void 0!==i&&(r=r||t.pathBuilder()).addSegment(i.bind()),void 0!==r?Se.done(r.bind()):Se.done(t.pathEmpty())}if(2===s)if(e.isCont()&&(o=e.head(),Be.isDigit(o)))e=e.step(),n=o,s=3;else if(!e.isEmpty())return Se.error(ce.expected("hex digit",e));if(3===s){if(e.isCont()&&(o=e.head(),Be.isDigit(o))){i=i||Re.decodedString(),e=e.step(),i=i.write(Be.decodeDigit(n)<<4|Be.decodeDigit(o)),n=0,s=1;continue}if(!e.isEmpty())return Se.error(ce.expected("hex digit",e))}break}return new an(t,r,i,n,s)}}class un extends Se{constructor(e,t,r,i,n,s){super(),this.uri=e,this.builder=t,this.keyOutput=r,this.valueOutput=i,this.c1=n,this.step=s}feed(e){return un.parse(e,this.uri,this.builder,this.keyOutput,this.valueOutput,this.c1,this.step)}static parse(e,t,r,i,n,s=0,o=1){let a=0;for(;;){if(1===o){for(i=i||Re.decodedString();e.isCont()&&(a=e.head(),Pi.isParamChar(a));)e=e.step(),i.write(a);if(e.isCont()&&61===a)e=e.step(),o=4;else{if(e.isCont()&&38===a){e=e.step(),(r=r||t.queryBuilder()).addParam(i.bind()),i=void 0;continue}if(e.isCont()&&37===a)e=e.step(),o=2;else if(!e.isEmpty())return(r=r||t.queryBuilder()).addParam(i.bind()),Se.done(r.bind())}}if(2===o)if(e.isCont()&&(a=e.head(),Be.isDigit(a)))e=e.step(),s=a,o=3;else if(!e.isEmpty())return Se.error(ce.expected("hex digit",e));if(3===o){if(e.isCont()&&(a=e.head(),Be.isDigit(a))){e=e.step(),i.write(Be.decodeDigit(s)<<4|Be.decodeDigit(a)),s=0,o=1;continue}if(!e.isEmpty())return Se.error(ce.expected("hex digit",e))}if(4===o){for(n=n||Re.decodedString();e.isCont()&&(a=e.head(),Pi.isParamChar(a)||61===a);)e=e.step(),n.write(a);if(e.isCont()&&38===a){e=e.step(),(r=r||t.queryBuilder()).addParam(i.bind(),n.bind()),i=void 0,n=void 0,o=1;continue}if(e.isCont()&&37===a)e=e.step(),o=5;else if(!e.isEmpty())return(r=r||t.queryBuilder()).addParam(i.bind(),n.bind()),Se.done(r.bind())}if(5===o)if(e.isCont()&&(a=e.head(),Be.isDigit(a)))e=e.step(),s=a,o=6;else if(!e.isEmpty())return Se.error(ce.expected("hex digit",e));if(6===o){if(e.isCont()&&(a=e.head(),Be.isDigit(a))){e=e.step(),n.write(Be.decodeDigit(s)<<4|Be.decodeDigit(a)),s=0,o=4;continue}if(!e.isEmpty())return Se.error(ce.expected("hex digit",e))}break}return new un(t,r,i,n,s,o)}}class hn extends Se{constructor(e,t,r,i){super(),this.uri=e,this.output=t,this.c1=r,this.step=i}feed(e){return hn.parse(e,this.uri,this.output,this.c1,this.step)}static parse(e,t,r,i=0,n=1){let s=0;for(r=r||Re.decodedString();;){if(1===n){for(;e.isCont()&&(s=e.head(),Pi.isFragmentChar(s));)e=e.step(),r=r.write(s);if(e.isCont()&&37===s)e=e.step(),n=2;else if(!e.isEmpty())return Se.done(t.fragment(r.bind()))}if(2===n)if(e.isCont()&&(s=e.head(),Be.isDigit(s)))e=e.step(),i=s,n=3;else if(!e.isEmpty())return Se.error(ce.expected("hex digit",e));if(3===n){if(e.isCont()&&(s=e.head(),Be.isDigit(s))){e=e.step(),r=r.write(Be.decodeDigit(i)<<4|Be.decodeDigit(s)),i=0,n=1;continue}if(!e.isEmpty())return Se.error(ce.expected("hex digit",e))}break}return new hn(t,r,i,n)}}class ln{get tag(){return this.constructor.tag}toAny(){return this.toValue().toAny()}toRecon(){return Tr.toString(this.toValue())}toString(){return he.debug(this)}static fromValue(e){switch(e.tag){case"open":return pn.fromValue(e);case"opened":return fn.fromValue(e);case"close":return wn.fromValue(e);case"closed":return mn.fromValue(e);case"connect":return gn.fromValue(e);case"connected":return yn.fromValue(e);case"disconnect":return bn.fromValue(e);case"disconnected":return vn.fromValue(e);case"error":return xn.fromValue(e);case"event":return Sn.fromValue(e);case"command":return kn.fromValue(e);case"link":return Tn.fromValue(e);case"linked":return Pn.fromValue(e);case"sync":return Dn.fromValue(e);case"synced":return qn.fromValue(e);case"unlink":return In.fromValue(e);case"unlinked":return Vn.fromValue(e);case"auth":return Nn.fromValue(e);case"authed":return zn.fromValue(e);case"deauth":return Mn.fromValue(e);case"deauthed":return jn.fromValue(e);default:return null}}static parseRecon(e){return this.fromValue(Tr.parse(e))}}class cn extends ln{static fromValue(e){switch(e.tag){case"open":return pn.fromValue(e);case"opened":return fn.fromValue(e);case"close":return wn.fromValue(e);case"closed":return mn.fromValue(e);case"connect":return gn.fromValue(e);case"connected":return yn.fromValue(e);case"disconnect":return bn.fromValue(e);case"disconnected":return vn.fromValue(e);case"error":return xn.fromValue(e);default:return null}}static parseRecon(e){return this.fromValue(Tr.parse(e))}}class dn extends cn{constructor(e,t){super(),this.host=e,this.body=t}withHost(e){return e=Pi.fromAny(e),this.copy(e,this.body)}withBody(e){return e=ht.fromAny(e),this.copy(this.host,e)}copy(e,t){return new this.constructor(e,t)}equals(e){return this===e||e instanceof dn&&(this.constructor===e.constructor&&this.host.equals(e.host)&&this.body.equals(e.body))}hashCode(){return i.mash(i.mix(i.mix(l.hash(this.constructor),this.host.hashCode()),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40).debug(this.host.toString()),this.body.isDefined()&&(e=e.write(", ").debug(this.body)),e=e.write(41)}toValue(){const e=lt.create(1).slot("host",this.host.toString());return ot.of(this.tag,e).concat(this.body)}static fromValue(e){let t;if(e.header(this.tag).forEach((function(e,r){const i=e.key.stringValue(void 0);void 0!==i?"host"===i&&(t=Pi.parse(e.toValue().stringValue(""))):e instanceof ht&&0===r&&(t=Pi.parse(e.stringValue("")))})),void 0!==t){const r=e.body();return new this(t,r)}return null}static create(e,t){return new this(e=Pi.fromAny(e),t=void 0===t?ht.absent():ht.fromAny(t))}}class pn extends dn{}pn.tag="open";class fn extends dn{}fn.tag="opened";class wn extends dn{}wn.tag="close";class mn extends dn{}mn.tag="closed";class gn extends dn{}gn.tag="connect";class yn extends dn{}yn.tag="connected";class bn extends dn{}bn.tag="disconnect";class vn extends dn{}vn.tag="disconnected";class xn extends dn{}xn.tag="error";class On extends ln{withPrio(e){return this}withRate(e){return this}static fromValue(e){switch(e.tag){case"event":return Sn.fromValue(e);case"command":return kn.fromValue(e);case"link":return Tn.fromValue(e);case"linked":return Pn.fromValue(e);case"sync":return Dn.fromValue(e);case"synced":return qn.fromValue(e);case"unlink":return In.fromValue(e);case"unlinked":return Vn.fromValue(e);case"auth":return Nn.fromValue(e);case"authed":return zn.fromValue(e);case"deauth":return Mn.fromValue(e);case"deauthed":return jn.fromValue(e);default:return null}}static parseRecon(e){return this.fromValue(Tr.parse(e))}}Object.defineProperty(On.prototype,"prio",{get:()=>0,configurable:!0}),Object.defineProperty(On.prototype,"rate",{get:()=>0,configurable:!0});class En extends On{constructor(e){super(),this.body=e}get node(){return Pi.empty()}withNode(e){return this}get lane(){return Pi.empty()}withLane(e){return this}withBody(e){return e=ht.fromAny(e),this.copy(e)}copy(e){return new this.constructor(e)}equals(e){return this===e||e instanceof En&&(this.constructor===e.constructor&&this.body.equals(e.body))}hashCode(){return i.mash(i.mix(l.hash(this.constructor),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40),this.body.isDefined()&&(e=e.debug(this.body)),e=e.write(41)}toValue(){return ot.of(this.tag).concat(this.body)}static fromValue(e){if(e.header(this.tag).isDefined()){return new this(e.body())}return null}static create(e){return new this(e=void 0===e?ht.absent():ht.fromAny(e))}}class Cn extends On{constructor(e,t,r){super(),this.node=e,this.lane=t,this.body=r}withNode(e){return e=Pi.fromAny(e),this.copy(e,this.lane,this.body)}withLane(e){return e=Pi.fromAny(e),this.copy(this.node,e,this.body)}withBody(e){return e=ht.fromAny(e),this.copy(this.node,this.lane,e)}copy(e,t,r){return new this.constructor(e,t,r)}equals(e){return this===e||e instanceof Cn&&(this.constructor===e.constructor&&this.node.equals(e.node)&&this.lane.equals(e.lane)&&this.body.equals(e.body))}hashCode(){return i.mash(i.mix(i.mix(i.mix(l.hash(this.constructor),this.node.hashCode()),this.lane.hashCode()),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40).debug(this.node.toString()).write(", ").debug(this.lane.toString()),this.body.isDefined()&&(e=e.write(", ").debug(this.body)),e=e.write(41)}toValue(){const e=lt.create(2).slot("node",this.node.toString()).slot("lane",this.lane.toString());return ot.of(this.tag,e).concat(this.body)}static fromValue(e){let t,r;if(e.header(this.tag).forEach((function(e,i){const n=e.key.stringValue(void 0);void 0!==n?"node"===n?t=Pi.parse(e.toValue().stringValue("")):"lane"===n&&(r=Pi.parse(e.toValue().stringValue(""))):e instanceof ht&&(0===i?t=Pi.parse(e.stringValue("")):1===i&&(r=Pi.parse(e.stringValue(""))))})),void 0!==t&&void 0!==r){const i=e.body();return new this(t,r,i)}return null}static create(e,t,r){return new this(e=Pi.fromAny(e),t=Pi.fromAny(t),r=void 0===r?ht.absent():ht.fromAny(r))}}class An extends On{constructor(e,t,r,i,n){super(),this.node=e,this.lane=t,Object.defineProperty(this,"prio",{value:r,writable:!0,enumerable:!0,configurable:!0}),Object.defineProperty(this,"rate",{value:i,writable:!0,enumerable:!0,configurable:!0}),this.body=n}withNode(e){return e=Pi.fromAny(e),this.copy(e,this.lane,this.prio,this.rate,this.body)}withLane(e){return e=Pi.fromAny(e),this.copy(this.node,e,this.prio,this.rate,this.body)}withPrio(e){return this.copy(this.node,this.lane,e,this.rate,this.body)}withRate(e){return this.copy(this.node,this.lane,this.prio,e,this.body)}withBody(e){return e=ht.fromAny(e),this.copy(this.node,this.lane,this.prio,this.rate,e)}copy(e,t,r,i,n){return new this.constructor(e,t,r,i,n)}equals(e){return this===e||e instanceof An&&(this.constructor===e.constructor&&this.node.equals(e.node)&&this.lane.equals(e.lane)&&this.prio===e.prio&&this.rate===e.rate&&this.body.equals(e.body))}hashCode(){return i.mash(i.mix(i.mix(i.mix(i.mix(i.mix(l.hash(this.constructor),this.node.hashCode()),this.lane.hashCode()),a.hash(this.prio)),a.hash(this.rate)),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40).debug(this.node.toString()).write(", ").debug(this.lane.toString()),0===this.prio&&0===this.rate||(e=e.write(", ").debug(this.prio).write(", ").debug(this.rate)),this.body.isDefined()&&(e=e.write(", ").debug(this.body)),e=e.write(41)}toValue(){const e=lt.create(4).slot("node",this.node.toString()).slot("lane",this.lane.toString());return 0!==this.prio&&e.slot("prio",this.prio),0!==this.rate&&e.slot("rate",this.rate),ot.of(this.tag,e).concat(this.body)}static fromValue(e){let t,r,i=0,n=0;if(e.header(this.tag).forEach((function(e,s){const o=e.key.stringValue(void 0);void 0!==o?"node"===o?t=Pi.parse(e.toValue().stringValue("")):"lane"===o?r=Pi.parse(e.toValue().stringValue("")):"prio"===o?i=e.numberValue(i):"rate"===o&&(n=e.numberValue(n)):e instanceof ht&&(0===s?t=Pi.parse(e.stringValue("")):1===s&&(r=Pi.parse(e.stringValue(""))))})),void 0!==t&&void 0!==r){const s=e.body();return new this(t,r,i,n,s)}return null}static create(e,t,r,i,n){return void 0===r&&(r=0),void 0===i&&(i=0),new this(e=Pi.fromAny(e),t=Pi.fromAny(t),r,i,n=void 0===n?ht.absent():ht.fromAny(n))}}class Sn extends Cn{}Sn.tag="event";class kn extends Cn{}kn.tag="command";class Tn extends An{}Tn.tag="link";class Pn extends An{}Pn.tag="linked";class Dn extends An{}Dn.tag="sync";class qn extends Cn{}qn.tag="synced";class In extends Cn{}In.tag="unlink";class Vn extends Cn{}Vn.tag="unlinked";class Nn extends En{}Nn.tag="auth";class zn extends En{}zn.tag="authed";class Mn extends En{}Mn.tag="deauth";class jn extends En{}jn.tag="deauthed";class Ln{constructor(e,t){this.hostUri=e,this.options=t,this.sendBuffer=[],this.channel=new MessageChannel,this.socket=null,this.onPortReceive=this.onPortReceive.bind(this),this.channel.port1.addEventListener("message",this.onPortReceive),this.channel.port1.start()}get sendBufferSize(){var e;return null!==(e=this.options.sendBufferSize)&&void 0!==e?e:Ln.SendBufferSize}onPortReceive(e){const t=ht.fromAny(e.data),r=ln.fromValue(t);null!==r?this.onReceiveMessage(r):this.onReceiveUnknownMessage(t)}onReceiveMessage(e){e instanceof cn?this.onReceiveSignal(e):e instanceof On?this.onReceiveEnvelope(e):this.onReceiveUnknownMessage(e)}onReceiveEnvelope(e){this.push(e)}onReceiveSignal(e){e instanceof gn?this.onConnectSignal(e):e instanceof bn?this.onDisconnectSignal(e):this.onReceiveUnexpectedSignal(e)}onConnectSignal(e){this.open()}onDisconnectSignal(e){null!==this.socket&&this.socket.close()}onReceiveUnexpectedSignal(e){throw new Error("unexpected warp host signal: "+e)}onReceiveUnknownMessage(e){throw new Error("unknown warp host message: "+e)}onReceiveUnknownEnvelope(e){throw new Error("unknown warp host envelope: "+e)}get connected(){return null!==this.socket&&this.socket.readyState===this.socket.OPEN}open(){let e=this.socket;if(null===e){let t;if(void 0!==this.options.WebSocket)t=this.options.WebSocket;else if("undefined"!=typeof WebSocket)t=WebSocket;else{if(null===Ln.WebSocket)throw new Error("Missing WebSocket implementation");t=Ln.WebSocket}let r=this.hostUri;const i=r.schemeName;"warp"===i||"swim"===i?r=r.withSchemeName("ws"):"warps"!==i&&"swims"!==i||(r=r.withSchemeName("wss")),e=void 0!==this.options.protocols?new t(r.toString(),this.options.protocols):new t(r.toString()),this.socket=e,e.onopen=this.onWebSocketOpen.bind(this),e.onmessage=this.onWebSocketMessage.bind(this),e.onclose=this.onWebSocketClose.bind(this),e.onerror=this.onWebSocketError.bind(this)}}close(){null!==this.socket&&this.socket.close()}closeUp(){null!==this.socket&&this.socket.close()}onConnect(){this.channel.port1.postMessage(yn.create(this.hostUri).toAny())}onDisconnect(){this.channel.port1.postMessage(vn.create(this.hostUri).toAny())}onError(e){this.channel.port1.postMessage(xn.create(this.hostUri).toAny())}onEnvelope(e){this.channel.port1.postMessage(e.toAny())}push(e){if(this.connected){const t=e.toRecon();this.socket.send(t)}else{if(!(this.sendBuffer.length<this.sendBufferSize))throw new Error("send buffer overflow");this.sendBuffer.push(e),this.open()}}onWebSocketOpen(){if(this.connected){let e;for(this.onConnect();(e=this.sendBuffer.shift())&&this.connected;)this.push(e)}else this.close()}onWebSocketMessage(e){const t=e.data;if("string"==typeof t){const e=On.parseRecon(t);null!==e?this.onEnvelope(e):this.onReceiveUnknownEnvelope(t)}}onWebSocketClose(){const e=this.socket;null!==e&&(e.onopen=null,e.onmessage=null,e.onclose=null,e.onerror=null,this.socket=null),this.onDisconnect()}onWebSocketError(){null!==this.socket&&(this.socket.close(),this.onError())}}Ln.SendBufferSize=1024,Ln.WebSocket=null,"undefined"!=typeof WebSocket&&(Ln.WebSocket=WebSocket);new class{constructor(e,t={}){this.scope=e,this.options=t,this.hosts={},this.onWorkerReceive=this.onWorkerReceive.bind(this),this.scope.addEventListener("message",this.onWorkerReceive)}getHost(e){e=Pi.fromAny(e);const t=this.hosts[e.toString()];return void 0!==t?t:null}openHost(e,t){e=Pi.fromAny(e);const r=this.hosts;let i=r[e.toString()];return void 0===i&&(i=new Ln(e,t),r[e.toString()]=i),i}closeHost(e){const t=this.hosts;void 0!==t[e.hostUri.toString()]&&(delete t[e.hostUri.toString()],e.closeUp())}onWorkerReceive(e){const t=ht.fromAny(e.data),r=ln.fromValue(t);null!==r?this.onMessage(r):this.onUnknownMessage(t)}onMessage(e){e instanceof cn?this.onSignal(e):e instanceof On?this.onEnvelope(e):this.onUnknownMessage(e)}onSignal(e){e instanceof pn?this.onOpenSignal(e):e instanceof wn?this.onCloseSignal(e):this.onUnexpectedSignal(e)}onOpenSignal(e){const t=e.host,r=this.openHost(t,{});r instanceof Ln&&(this.scope.postMessage(fn.create(t).toAny(),[r.channel.port2]),r.open())}onCloseSignal(e){const t=e.host,r=this.getHost(t);r instanceof Ln&&(this.closeHost(r),this.scope.postMessage(mn.create(t).toAny()))}onUnexpectedSignal(e){throw new Error("unexpected warp signal: "+e)}onEnvelope(e){throw new Error("unexpected warp envelope: "+e)}onUnknownMessage(e){throw new Error("unknown warp message: "+e)}}(self)}();',vl.webworkerUrl=void 0;class bl{constructor(e,t,r,i,n=0,s=0,o=xr.absent()){this.context=e,this.hostUri=t,this.nodeUri=r,this.laneUri=i,this.prio=n,this.rate=s,this.body=o,this.views=x.empty,this.host=null,this.status=0}keepLinked(){const e=this.views;for(let t=0,r=e.length;t<r;t+=1)if(e[t].keepLinked())return!0;return!1}keepSynced(){for(let e=0,t=this.views.length;e<t;e+=1)if(this.views[e].keepSynced())return!0;return!1}get unlinkDelay(){const e=this.host;return null!==e?e.unlinkDelay:0}get connected(){const e=this.host;return null!==e&&e.connected}get authenticated(){const e=this.host;return null!==e&&e.authenticated}get linked(){return 0!=(this.status&bl.Linked)}get synced(){return 0!=(this.status&bl.Synced)}get session(){const e=this.host;return null!==e?e.session:xr.absent()}addDownlink(e){this.views=x.inserted(e,this.views)}removeDownlink(e){const t=this.views,r=x.removed(e,t);if(t!==r&&(this.views=r,e.closeUp(),0===r.length)){const e=this.unlinkDelay;e<0?this.unlink():setTimeout(this.doUnlink.bind(this),e)}}onEventMessage(e,t){const r=this.views;for(let t=0,i=r.length;t<i;t+=1)r[t].onEventMessage(e)}onCommandMessage(e){const t=this.views;for(let r=0,i=t.length;r<i;r+=1)t[r].onCommandMessage(e)}onLinkRequest(e){this.status|=bl.Linking;const t=this.views;for(let r=0,i=t.length;r<i;r+=1)t[r].onLinkRequest(e)}onLinkedResponse(e,t){this.status=this.status&~bl.Linking|bl.Linked;const r=this.views;for(let t=0,i=r.length;t<i;t+=1)r[t].onLinkedResponse(e)}onSyncRequest(e){this.status|=bl.Syncing;const t=this.views;for(let r=0,i=t.length;r<i;r+=1)t[r].onSyncRequest(e)}onSyncedResponse(e,t){this.status=this.status&~bl.Syncing|bl.Synced;const r=this.views;for(let t=0,i=r.length;t<i;t+=1)r[t].onSyncedResponse(e)}onUnlinkRequest(e,t){this.status=this.status&~(bl.Linking|bl.Syncing)|bl.Unlinking;const r=this.views;for(let t=0,i=r.length;t<i;t+=1)r[t].onUnlinkRequest(e)}onUnlinkedResponse(e,t){this.status&=~bl.Unlinking;const r=this.views;if(0===r.length||0!==this.status){for(let t=0,i=r.length;t<i;t+=1)r[t].onUnlinkedResponse(e);this.close()}else this.keepSynced()?this.sync():this.link()}hostDidConnect(e){const t=this.views;for(let e=0,r=t.length;e<r;e+=1)t[e].hostDidConnect();this.keepSynced()?this.sync():this.link()}hostDidDisconnect(e){this.status=0;let t=!1;const r=this.views;for(let e=0,i=r.length;e<i;e+=1){const i=r[e];i.hostDidDisconnect(),t=t||i.keepLinked()}t||this.close()}hostDidFail(e,t){const r=this.views;for(let t=0,i=r.length;t<i;t+=1)r[t].hostDidFail(e)}command(e){e=xr.fromAny(e),this.onCommandMessage(e),this.host.command(this.nodeUri,this.laneUri,e)}sync(){const e=this.host.unresolve(this.nodeUri),t=new ul(e,this.laneUri,this.prio,this.rate,this.body);this.onSyncRequest(t),this.host.push(t)}link(){const e=this.host.unresolve(this.nodeUri),t=new ol(e,this.laneUri,this.prio,this.rate,this.body);this.onLinkRequest(t),this.host.push(t)}unlink(){this.status=bl.Unlinking,this.context.unlinkDownlink(this)}doUnlink(){0===this.views.length&&this.unlink()}close(){this.context.closeDownlink(this)}openUp(e){this.host=e;for(let t=0,r=this.views.length;t<r;t+=1)this.views[t].openUp(e)}closeUp(){const e=this.views;this.views=x.empty;for(let t=0,r=e.length;t<r;t+=1)e[t].closeUp()}}var xl;bl.Linking=1,bl.Linked=2,bl.Syncing=4,bl.Synced=8,bl.Unlinking=16,e.DownlinkFlags=void 0,(xl=e.DownlinkFlags||(e.DownlinkFlags={}))[xl.KeepLinked=1]="KeepLinked",xl[xl.KeepSynced=2]="KeepSynced",xl[xl.KeepLinkedSynced=3]="KeepLinkedSynced";class Cl{constructor(e,t,r,i=vo.empty(),n=vo.empty(),s=vo.empty(),o=0,a=0,u=xr.absent(),h=0,l){var c,d,p,f,m,y,w,g,v,b,C,S;let O;void 0===l?l=x.empty:Array.isArray(l)||(O=l,l=[O]),void 0!==r&&(i=void 0!==r.hostUri?vo.fromAny(r.hostUri):i,n=void 0!==r.nodeUri?vo.fromAny(r.nodeUri):n,s=void 0!==r.laneUri?vo.fromAny(r.laneUri):s,o=void 0!==r.prio?r.prio:o,a=void 0!==r.rate?r.rate:a,u=void 0!==r.body?xr.fromAny(r.body):u,O=null!=O?O:{},l=x.inserted(O,l),O.onEvent=null!==(c=r.onEvent)&&void 0!==c?c:O.onEvent,O.onCommand=null!==(d=r.onCommand)&&void 0!==d?d:O.onCommand,O.willLink=null!==(p=r.willLink)&&void 0!==p?p:O.willLink,O.didLink=null!==(f=r.didLink)&&void 0!==f?f:O.didLink,O.willSync=null!==(m=r.willSync)&&void 0!==m?m:O.willSync,O.didSync=null!==(y=r.didSync)&&void 0!==y?y:O.didSync,O.willUnlink=null!==(w=r.willUnlink)&&void 0!==w?w:O.willUnlink,O.didUnlink=null!==(g=r.didUnlink)&&void 0!==g?g:O.didUnlink,O.didConnect=null!==(v=r.didConnect)&&void 0!==v?v:O.didConnect,O.didDisconnect=null!==(b=r.didDisconnect)&&void 0!==b?b:O.didDisconnect,O.didClose=null!==(C=r.didClose)&&void 0!==C?C:O.didClose,O.didFail=null!==(S=r.didFail)&&void 0!==S?S:O.didFail),this.context=e,this.owner=t,this.ownHostUri=i,this.ownNodeUri=n,this.ownLaneUri=s,this.ownPrio=o,this.ownRate=a,this.ownBody=u,this.flags=h,this.model=null,this.observers=l}hostUri(e){return void 0===e?this.ownHostUri:(e=vo.fromAny(e),this.copy(this.context,this.owner,e,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers))}nodeUri(e){return void 0===e?this.ownNodeUri:(e=vo.fromAny(e),this.copy(this.context,this.owner,this.ownHostUri,e,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers))}laneUri(e){return void 0===e?this.ownLaneUri:(e=vo.fromAny(e),this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,e,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers))}prio(e){return void 0===e?this.ownPrio:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,e,this.ownRate,this.ownBody,this.flags,this.observers)}rate(e){return void 0===e?this.ownRate:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,e,this.ownBody,this.flags,this.observers)}body(e){return void 0===e?this.ownBody:(e=xr.fromAny(e),this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,e,this.flags,this.observers))}keepLinked(e){if(void 0===e)return 0!=(1&this.flags);{const t=e?1|this.flags:-2&this.flags;return this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,t,this.observers)}}keepSynced(e){if(void 0===e)return 0!=(2&this.flags);{const t=e?2|this.flags:-3&this.flags;return this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,t,this.observers)}}observe(e){return this.observers=x.inserted(e,this.observers),this}unobserve(e){const t=this.observers,r=t.length;for(let i=0;i<r;i+=1){const n=t[i];let s=n===e;if(!s)for(const t in n)if(n[t]===e){s=!0;break}if(s){if(r>1){const e=new Array(r-1);for(let r=0;r<i;r+=1)e[r]=t[r];for(let n=i+1;n<r;n+=1)e[n-1]=t[n];this.observers=e}else this.observers=x.empty;break}}return this}onEvent(e){return this.observe({onEvent:e})}onCommand(e){return this.observe({onCommand:e})}willLink(e){return this.observe({willLink:e})}didLink(e){return this.observe({didLink:e})}willSync(e){return this.observe({willSync:e})}didSync(e){return this.observe({didSync:e})}willUnlink(e){return this.observe({willUnlink:e})}didUnlink(e){return this.observe({didUnlink:e})}didConnect(e){return this.observe({didConnect:e})}didDisconnect(e){return this.observe({didDisconnect:e})}didClose(e){return this.observe({didClose:e})}didFail(e){return this.observe({didFail:e})}get connected(){const e=this.model;return null!==e&&e.connected}get authenticated(){const e=this.model;return null!==e&&e.authenticated}get linked(){const e=this.model;return null!==e&&e.linked}get synced(){const e=this.model;return null!==e&&e.synced}get session(){const e=this.model;return null!==e?e.session:xr.absent()}onEventMessage(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.onEvent&&i.onEvent(e.body,this)}}onCommandMessage(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.onCommand&&i.onCommand(e,this)}}onLinkRequest(e){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.willLink&&r.willLink(this)}}onLinkedResponse(e){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.didLink&&r.didLink(this)}}onSyncRequest(e){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.willSync&&r.willSync(this)}}onSyncedResponse(e){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.didSync&&r.didSync(this)}}onUnlinkRequest(e){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.willUnlink&&r.willUnlink(this)}}onUnlinkedResponse(e){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.didUnlink&&r.didUnlink(this)}}hostDidConnect(){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.didConnect&&r.didConnect(this)}}hostDidDisconnect(){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.didDisconnect&&r.didDisconnect(this)}}hostDidFail(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.didFail&&i.didFail(e,this)}}command(e){this.model.command(e)}close(){const e=this.owner;null!==e&&e.removeDownlink(this);const t=this.model;null!==t&&t.removeDownlink(this)}openUp(e){}closeUp(){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.didClose&&r.didClose(this)}}static initForm(){return new Sl}}i([a],Cl,"initForm",null);class Sl extends Mi{mold(e){if(void 0!==e){const t=Cr.create();return void 0!==e.hostUri&&t.slot("host",vo.fromAny(e.hostUri).toString()),void 0!==e.nodeUri&&t.slot("node",vo.fromAny(e.nodeUri).toString()),void 0!==e.laneUri&&t.slot("lane",vo.fromAny(e.laneUri).toString()),void 0!==e.prio&&t.slot("prio",e.prio),void 0!==e.rate&&t.slot("rate",e.rate),void 0!==e.body&&t.slot("body",e.body),void 0!==e.type&&t.slot("type",e.type),Cr.of(gr.of("link",t))}return pr.extant()}cast(e){const t=e.toValue().get("link");if(t.isDefined()){const e={},r=t.get("host");r.isDefined()&&(e.hostUri=r.cast(vo.form()));const i=t.get("node");i.isDefined()&&(e.nodeUri=i.cast(vo.form()));const n=t.get("lane");n.isDefined()&&(e.laneUri=n.cast(vo.form()));const s=t.get("prio");s.isDefined()&&(e.prio=s.numberValue());const o=t.get("rate");o.isDefined()&&(e.rate=o.numberValue());const a=t.get("body");a.isDefined()&&(e.body=a);const u=t.get("type");return u.isDefined()&&(e.type=u.stringValue()),e}}}Object.defineProperty(Sl.prototype,"tag",{get:()=>"link",configurable:!0});class Ol extends bl{constructor(e,t,r,i,n,s,o){super(e,t,r,i,n,s,o)}get type(){return"event"}}class El extends Cl{constructor(e,t,r,i,n,s,o,a,u,h=1,l){super(e,t,r,i,n,s,o,a,u,h,l)}get type(){return"event"}copy(e,t,r,i,n,s,o,a,u,h){return new El(e,t,void 0,r,i,n,s,o,a,u,h)}observe(e){return super.observe(e)}open(){const e=this.ownLaneUri;if(e.isEmpty())throw new Error("no lane");let t=this.ownNodeUri;if(t.isEmpty())throw new Error("no node");let r=this.ownHostUri;r.isEmpty()&&(r=t.endpoint(),t=r.unresolve(t));let i=this.context.getDownlink(r,t,e);if(void 0!==i){if(!(i instanceof Ol))throw new Error("downlink type mismatch");i.addDownlink(this)}else i=new Ol(this.context,r,t,e,this.ownPrio,this.ownRate,this.ownBody),i.addDownlink(this),this.context.openDownlink(i);return this.model=i,null!==this.owner&&this.owner.addDownlink(this),this}}class Al extends bl{constructor(e,t,r,i,n,s,o,a=new Wt){super(e,t,r,i,n,s,o),this.state=a}get type(){return"list"}get length(){return this.state.length}isEmpty(){return this.state.isEmpty()}get(e,t){return this.state.get(e,t)||xr.absent()}getEntry(e,t){return this.state.getEntry(e,t)}set(e,t,r){if(void 0!==r&&(e=this.state.lookup(r,e))<0)throw new RangeError(""+r);if(e<0||e>=this.state.length)throw new RangeError(""+e);t=this.listWillUpdate(e,t);const i=this.state.getEntry(e);this.state.set(e,t),this.listDidUpdate(e,t,i[1]);const n=Cr.create(2).slot("key",i[0]).slot("index",e);return this.command(gr.of("update",n).concat(t)),this}insert(e,t,r){if(e<0||e>this.state.length)throw new RangeError(""+e);t=this.listWillUpdate(e,t),this.state.insert(e,t,r);const i=this.state.getEntry(e);this.listDidUpdate(e,t,xr.absent());const n=Cr.create(2).slot("key",i[0]).slot("index",e);return this.command(gr.of("update",n).concat(t)),this}remove(e,t){if(void 0!==t&&(e=this.state.lookup(t,e))<0)throw new RangeError(""+t);if(e<0||e>this.state.length)throw new RangeError(""+e);this.listWillRemove(e);const r=this.state.getEntry(e);this.state.remove(e),this.listDidRemove(e,r[1]);const i=Cr.create(2).slot("key",r[0]).slot("index",e);return this.command(Cr.create(1).attr("remove",i)),this}push(...e){for(let t=0;t<e.length;t+=1){const r=this.state.length+t,i=this.listWillUpdate(r,e[t]);this.state.insert(r,i);const n=this.state.getEntry(r);this.listDidUpdate(r,i,xr.absent());const s=Cr.create(2).slot("key",n[0]).slot("index",r);this.command(gr.of("update",s).concat(i))}return this.state.length}pop(){const e=this.state.length-1;if(e>=0){this.listWillRemove(e);const t=this.state.getEntry(e);this.state.remove(e),this.listDidRemove(e,t[1]);const r=Cr.create(2).slot("key",t[0]).slot("index",e);return this.command(Cr.create(1).attr("remove",r)),t[1]}return xr.absent()}unshift(...e){for(let t=e.length-1;t>=0;t-=1){const r=this.listWillUpdate(0,e[t]);this.state.insert(0,r);const i=this.state.getEntry(0);this.listDidUpdate(0,r,xr.absent());const n=Cr.create(2).slot("key",i[0]).slot("index",0);this.command(gr.of("update",n).concat(r))}return this.state.length}shift(){if(this.state.length>0){this.listWillRemove(0);const e=this.state.getEntry(0);this.state.remove(0),this.listDidRemove(0,e[1]);const t=Cr.create(2).slot("key",e[0]).slot("index",0);return this.command(Cr.create(1).attr("remove",t)),e[1]}return xr.absent()}move(e,t,r){if(void 0!==r&&(e=this.state.lookup(r,e))<0)throw new RangeError(""+r);if(e<0||e>=this.state.length)throw new RangeError(""+e);if(t<0||t>=this.state.length)throw new RangeError(""+t);if(e!==t){const r=this.state.getEntry(e);this.listWillMove(e,t,r[1]),this.state.remove(e).insert(t,r[1],r[0]),this.listDidMove(e,t,r[1]);const i=Cr.create(2).slot("key",r[0]).slot("from",e).slot("to",t);this.command(Cr.create(1).attr("move",i))}return this}splice(e,t,...r){e<0&&(e=this.state.length+e),e=Math.min(Math.max(0,e),this.state.length),void 0===t&&(t=this.state.length-e);const i=[];for(let r=e,n=e+t;r<n;r+=1){this.listWillRemove(e);const t=this.state.getEntry(e);i.push(t[1]),this.state.remove(e),this.listDidRemove(e,t[1]);const r=Cr.create(2).slot("key",t[0]).slot("index",e);this.command(Cr.create(1).attr("remove",r))}for(let t=0;t<r.length;t+=1){const i=e+t,n=this.listWillUpdate(i,r[t]);this.state.insert(i,n);const s=this.state.getEntry(i);this.listDidUpdate(i,n,xr.absent());const o=Cr.create(2).slot("key",s[0]).slot("index",i);this.command(gr.of("update",o).concat(n))}return i}clear(){this.listWillClear(),this.state.clear(),this.listDidClear(),this.command(Cr.create(1).attr("clear"))}forEach(e,t){return this.state.forEach(e,t)}values(){return this.state.values()}keys(){return this.state.keys()}entries(){return this.state.entries()}snapshot(){return this.state.clone()}setState(e){this.state=e}onEventMessage(e,t){super.onEventMessage(e,t);const r=e.body,i=r.tag;if("update"===i){const e=r.head().toValue(),t=this.state.lookup(e.get("key"),e.get("index").numberValue());t>=0?this.onUpdateEvent(t,r.body(),e.get("key")):this.onInsertEvent(e.get("index").numberValue(0),r.body(),e.get("key"))}else if("move"===i){const e=r.head().toValue(),t=this.state.lookup(e.get("key"),e.get("from").numberValue());t>=0&&this.onMoveEvent(t,e.get("to").numberValue(0),e.get("key"))}else if("remove"===i){const e=r.head().toValue(),t=this.state.lookup(e.get("key"),e.get("index").numberValue());t>=0&&this.onRemoveEvent(t,e.get("key"))}else if("drop"===i){const e=r.head();this.onDropEvent(e.numberValue(0))}else if("take"===i){const e=r.head();this.onTakeEvent(e.numberValue(0))}else"clear"===i&&this.onClearEvent()}onInsertEvent(e,t,r){t=this.listWillUpdate(e,t),this.state.insert(e,t,r),this.listDidUpdate(e,t,xr.absent())}onUpdateEvent(e,t,r){t=this.listWillUpdate(e,t);const i=this.state.get(e)||xr.absent();this.state.set(e,t),this.listDidUpdate(e,t,i)}onMoveEvent(e,t,r){if(e!==(t=Math.min(Math.max(0,t),this.state.length))){const i=this.state.get(e)||xr.absent();this.listWillMove(e,t,i),this.state.remove(e).insert(t,i,r),this.listDidMove(e,t,i)}}onRemoveEvent(e,t){this.listWillRemove(e);const r=this.state.get(e)||xr.absent();this.state.remove(e),this.listDidRemove(e,r)}onDropEvent(e){this.listWillDrop(e),this.state.drop(e),this.listDidDrop(e)}onTakeEvent(e){this.listWillTake(e),this.state.take(e),this.listDidTake(e)}onClearEvent(){this.listWillClear(),this.state.clear(),this.listDidClear()}listWillUpdate(e,t){const r=this.views;for(let i=0,n=r.length;i<n;i+=1)t=r[i].listWillUpdate(e,t);return t}listDidUpdate(e,t,r){const i=this.views;for(let n=0,s=i.length;n<s;n+=1)i[n].listDidUpdate(e,t,r)}listWillMove(e,t,r){const i=this.views;for(let n=0,s=i.length;n<s;n+=1)i[n].listWillMove(e,t,r)}listDidMove(e,t,r){const i=this.views;for(let n=0,s=i.length;n<s;n+=1)i[n].listDidMove(e,t,r)}listWillRemove(e){const t=this.views;for(let r=0,i=t.length;r<i;r+=1)t[r].listWillRemove(e)}listDidRemove(e,t){const r=this.views;for(let i=0,n=r.length;i<n;i+=1)r[i].listDidRemove(e,t)}listWillDrop(e){const t=this.views;for(let r=0,i=t.length;r<i;r+=1)t[r].listWillDrop(e)}listDidDrop(e){const t=this.views;for(let r=0,i=t.length;r<i;r+=1)t[r].listDidDrop(e)}listWillTake(e){const t=this.views;for(let r=0,i=t.length;r<i;r+=1)t[r].listWillTake(e)}listDidTake(e){const t=this.views;for(let r=0,i=t.length;r<i;r+=1)t[r].listDidTake(e)}listWillClear(){const e=this.views;for(let t=0,r=e.length;t<r;t+=1)e[t].listWillClear()}listDidClear(){const e=this.views;for(let t=0,r=e.length;t<r;t+=1)e[t].listDidClear()}}class kl extends Cl{constructor(e,t,r,i,n,s,o,a,u,h=3,l,c,d=null){var p,f,m,y,w,g,v,b,x,C,S,O;if(super(e,t,r,i,n,s,o,a,u,h,l),void 0!==r){const e=this.observers[this.observers.length-1];e.willUpdate=null!==(p=r.willUpdate)&&void 0!==p?p:e.willUpdate,e.didUpdate=null!==(f=r.didUpdate)&&void 0!==f?f:e.didUpdate,e.willMove=null!==(m=r.willMove)&&void 0!==m?m:e.willMove,e.didMove=null!==(y=r.didMove)&&void 0!==y?y:e.didMove,e.willRemove=null!==(w=r.willRemove)&&void 0!==w?w:e.willRemove,e.didRemove=null!==(g=r.didRemove)&&void 0!==g?g:e.didRemove,e.willDrop=null!==(v=r.willDrop)&&void 0!==v?v:e.willDrop,e.didDrop=null!==(b=r.didDrop)&&void 0!==b?b:e.didDrop,e.willTake=null!==(x=r.willTake)&&void 0!==x?x:e.willTake,e.didTake=null!==(C=r.didTake)&&void 0!==C?C:e.didTake,e.willClear=null!==(S=r.willClear)&&void 0!==S?S:e.willClear,e.didClear=null!==(O=r.didClear)&&void 0!==O?O:e.didClear,c=void 0!==r.valueForm?r.valueForm:c}this.ownValueForm=void 0!==c?c:Mi.forValue(),this.state0=d}get type(){return"list"}copy(e,t,r,i,n,s,o,a,u,h,l,c){return 10===arguments.length&&(l=this.ownValueForm,c=this.state0),new kl(e,t,void 0,r,i,n,s,o,a,u,h,l,c)}valueForm(e){return void 0===e?this.ownValueForm:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,e,this.state0)}get length(){return this.model.length}isEmpty(){return this.model.isEmpty()}get(e,t){return this.model.get(e,t).coerce(this.ownValueForm)}getEntry(e,t){const r=this.model.getEntry(e,t);if(void 0!==r)return[r[0].coerce(this.ownValueForm),r[1]]}set(e,t,r){const i=this.ownValueForm.mold(t);return this.model.set(e,i,r),this}insert(e,t,r){const i=this.ownValueForm.mold(t);return this.model.insert(e,i,r),this}remove(e,t){return this.model.remove(e,t),this}push(...e){const t=new Array(e.length);for(let r=0;r<e.length;r+=1)t[r]=this.ownValueForm.mold(e[r]);return this.model.push.apply(this.model,t)}pop(){return this.model.pop().coerce(this.ownValueForm)}unshift(...e){const t=new Array(e.length);for(let r=0;r<e.length;r+=1)t[r]=this.ownValueForm.mold(e[r]);return this.model.unshift.apply(this.model,t)}shift(){return this.model.shift().coerce(this.ownValueForm)}move(e,t,r){return this.model.move(e,t,r),this}splice(e,t,...r){const i=new Array(r.length);for(let e=0;e<r.length;e+=1)i[e]=this.ownValueForm.mold(r[e]);const n=this.model.splice(e,t,...i),s=new Array(n.length);for(let e=0;e<n.length;e+=1)s[e]=n[e].coerce(this.ownValueForm);return s}clear(){this.model.clear()}forEach(e,t){return this.ownValueForm===Mi.forValue()?this.model.state.forEach(e,t):this.model.state.forEach((function(r,i,n){const s=r.coerce(this.ownValueForm);return e.call(t,s,i,n)}),this)}values(){const e=this.model.values();return this.ownValueForm===Mi.forValue()?e:new Li(e,this.ownValueForm)}keys(){return this.model.keys()}entries(){const e=this.model.entries();return this.ownValueForm===Mi.forValue()?e:new Bi(e,Mi.forValue(),this.ownValueForm)}snapshot(){return this.model.snapshot()}setState(e){this.model.setState(e)}observe(e){return super.observe(e)}willUpdate(e){return this.observe({willUpdate:e})}didUpdate(e){return this.observe({didUpdate:e})}willMove(e){return this.observe({willMove:e})}didMove(e){return this.observe({didMove:e})}willRemove(e){return this.observe({willRemove:e})}didRemove(e){return this.observe({didRemove:e})}willDrop(e){return this.observe({willDrop:e})}didDrop(e){return this.observe({didDrop:e})}willTake(e){return this.observe({willTake:e})}didTake(e){return this.observe({didTake:e})}willClear(e){return this.observe({willClear:e})}didClear(e){return this.observe({didClear:e})}listWillUpdate(e,t){let r;const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];if(void 0!==s.willUpdate){void 0===r&&(r=t.coerce(this.ownValueForm));const i=s.willUpdate(e,r,this);void 0!==i&&(r=i,t=this.ownValueForm.mold(r))}}return t}listDidUpdate(e,t,r){let i,n;const s=this.observers;for(let o=0,a=s.length;o<a;o+=1){const a=s[o];void 0!==a.didUpdate&&(void 0===i&&(i=t.coerce(this.ownValueForm)),void 0===n&&(n=r.coerce(this.ownValueForm)),a.didUpdate(e,i,n,this))}}listWillMove(e,t,r){let i;const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.willMove&&(void 0===i&&(i=r.coerce(this.ownValueForm)),o.willMove(e,t,i,this))}}listDidMove(e,t,r){let i;const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.didMove&&(void 0===i&&(i=r.coerce(this.ownValueForm)),o.didMove(e,t,i,this))}}listWillRemove(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.willRemove&&i.willRemove(e,this)}}listDidRemove(e,t){let r;const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.didRemove&&(void 0===r&&(r=t.coerce(this.ownValueForm)),s.didRemove(e,r,this))}}listWillDrop(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.willDrop&&i.willDrop(e,this)}}listDidDrop(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.didDrop&&i.didDrop(e,this)}}listWillTake(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.willTake&&i.willTake(e,this)}}listDidTake(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.didTake&&i.didTake(e,this)}}listWillClear(){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.willClear&&r.willClear(this)}}listDidClear(){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.didClear&&r.didClear(this)}}initialState(e){return void 0===e?this.state0:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,this.ownValueForm,e)}didAliasModel(){this.onLinkedResponse(),this.model.state.forEach((function(e,t){this.listDidUpdate(t,e,xr.absent())}),this),this.onSyncedResponse()}open(){var e;const t=this.ownLaneUri;if(t.isEmpty())throw new Error("no lane");let r=this.ownNodeUri;if(r.isEmpty())throw new Error("no node");let i=this.ownHostUri;i.isEmpty()&&(i=r.endpoint(),r=i.unresolve(r));let n=this.context.getDownlink(i,r,t);if(void 0!==n){if(!(n instanceof Al))throw new Error("downlink type mismatch");n.addDownlink(this),this.model=n,setTimeout(this.didAliasModel.bind(this))}else n=new Al(this.context,i,r,t,this.ownPrio,this.ownRate,this.ownBody,null!==(e=this.state0)&&void 0!==e?e:void 0),n.addDownlink(this),this.context.openDownlink(n),this.model=n;return null!==this.owner&&this.owner.addDownlink(this),this}}class Dl extends bl{constructor(e,t,r,i,n,s,o,a=new Ut){super(e,t,r,i,n,s,o),this.state=a}get type(){return"map"}get size(){return this.state.size}isEmpty(){return this.state.isEmpty()}has(e){return this.state.has(e)}get(e){var t;return null!==(t=this.state.get(e))&&void 0!==t?t:xr.absent()}getEntry(e){return this.state.getEntry(e)}set(e,t){var r;t=this.mapWillUpdate(e,t);const i=null!==(r=this.state.get(e))&&void 0!==r?r:xr.absent();this.state.set(e,t),this.mapDidUpdate(e,t,i);const n=Cr.create(1).slot("key",e);return this.command(gr.of("update",n).concat(t)),this}delete(e){var t;if(this.state.has(e)){this.mapWillRemove(e);const r=null!==(t=this.state.get(e))&&void 0!==t?t:xr.absent();this.state.delete(e),this.mapDidRemove(e,r);const i=Cr.create(1).slot("key",e);return this.command(Cr.create(1).attr("remove",i)),!0}return!1}drop(e){return this.mapWillDrop(e),this.state.drop(e),this.mapDidDrop(e),this.command(Cr.create(1).attr("drop",e)),this}take(e){return this.mapWillTake(e),this.state.take(e),this.mapDidTake(e),this.command(Cr.create(1).attr("take",e)),this}clear(){this.mapWillClear(),this.state.clear(),this.mapDidClear(),this.command(Cr.create(1).attr("clear"))}forEach(e,t){return this.state.forEach(e,t)}keys(){return this.state.keys()}values(){return this.state.values()}entries(){return this.state.entries()}snapshot(){return this.state.clone()}setState(e){this.state=e}onEventMessage(e,t){super.onEventMessage(e,t);const r=e.body,i=r.tag;if("update"===i){const e=r.head().toValue();this.onUpdateEvent(e.get("key"),r.body())}else if("remove"===i){const e=r.head().toValue();this.onRemoveEvent(e.get("key"))}else if("drop"===i){const e=r.head().toValue();this.onDropEvent(e.numberValue(0))}else if("take"===i){const e=r.head().toValue();this.onTakeEvent(e.numberValue(0))}else"clear"===i&&this.onClearEvent()}onUpdateEvent(e,t){var r;t=this.mapWillUpdate(e,t);const i=null!==(r=this.state.get(e))&&void 0!==r?r:xr.absent();this.state.set(e,t),this.mapDidUpdate(e,t,i)}onRemoveEvent(e){var t;this.mapWillRemove(e);const r=null!==(t=this.state.get(e))&&void 0!==t?t:xr.absent();this.state.delete(e),this.mapDidRemove(e,r)}onDropEvent(e){this.mapWillDrop(e),this.state.drop(e),this.mapDidDrop(e)}onTakeEvent(e){this.mapWillTake(e),this.state.take(e),this.mapDidTake(e)}onClearEvent(){this.mapWillClear(),this.state.clear(),this.mapDidClear()}mapWillUpdate(e,t){const r=this.views;for(let i=0,n=r.length;i<n;i+=1)t=r[i].mapWillUpdate(e,t);return t}mapDidUpdate(e,t,r){const i=this.views;for(let n=0,s=i.length;n<s;n+=1)i[n].mapDidUpdate(e,t,r)}mapWillRemove(e){const t=this.views;for(let r=0,i=t.length;r<i;r+=1)t[r].mapWillRemove(e)}mapDidRemove(e,t){const r=this.views;for(let i=0,n=r.length;i<n;i+=1)r[i].mapDidRemove(e,t)}mapWillDrop(e){const t=this.views;for(let r=0,i=t.length;r<i;r+=1)t[r].mapWillDrop(e)}mapDidDrop(e){const t=this.views;for(let r=0,i=t.length;r<i;r+=1)t[r].mapDidDrop(e)}mapWillTake(e){const t=this.views;for(let r=0,i=t.length;r<i;r+=1)t[r].mapWillTake(e)}mapDidTake(e){const t=this.views;for(let r=0,i=t.length;r<i;r+=1)t[r].mapDidTake(e)}mapWillClear(){const e=this.views;for(let t=0,r=e.length;t<r;t+=1)e[t].mapWillClear()}mapDidClear(){const e=this.views;for(let t=0,r=e.length;t<r;t+=1)e[t].mapDidClear()}}class Pl extends Cl{constructor(e,t,r,i,n,s,o,a,u,h=3,l,c,d,p=null){var f,m,y,w,g,v,b,C,S,O;if(super(e,t,r,i,n,s,o,a,u,h,l),void 0!==r){const e=this.observers[this.observers.length-1];e.willUpdate=null!==(f=r.willUpdate)&&void 0!==f?f:e.willUpdate,e.didUpdate=null!==(m=r.didUpdate)&&void 0!==m?m:e.didUpdate,e.willRemove=null!==(y=r.willRemove)&&void 0!==y?y:e.willRemove,e.didRemove=null!==(w=r.didRemove)&&void 0!==w?w:e.didRemove,e.willDrop=null!==(g=r.willDrop)&&void 0!==g?g:e.willDrop,e.didDrop=null!==(v=r.didDrop)&&void 0!==v?v:e.didDrop,e.willTake=null!==(b=r.willTake)&&void 0!==b?b:e.willTake,e.didTake=null!==(C=r.didTake)&&void 0!==C?C:e.didTake,e.willClear=null!==(S=r.willClear)&&void 0!==S?S:e.willClear,e.didClear=null!==(O=r.didClear)&&void 0!==O?O:e.didClear,c=void 0!==r.keyForm?r.keyForm:c,d=void 0!==r.valueForm?r.valueForm:d}this.ownKeyForm=void 0!==c?c:Mi.forValue(),this.ownValueForm=void 0!==d?d:Mi.forValue(),this.state0=p,this.input=null,this.effects=new Ut,this.outlets=new Ut,this.outputs=x.empty,this.version=-1}get type(){return"map"}copy(e,t,r,i,n,s,o,a,u,h,l,c,d){return 10===arguments.length&&(d=this.state0,l=this.ownKeyForm,c=this.ownValueForm),new Pl(e,t,void 0,r,i,n,s,o,a,u,h,l,c,d)}keyForm(e){return void 0===e?this.ownKeyForm:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,e,this.ownValueForm,this.state0)}valueForm(e){return void 0===e?this.ownValueForm:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,this.ownKeyForm,e,this.state0)}get size(){return this.model.size}isEmpty(){return this.model.isEmpty()}has(e){const t=this.ownKeyForm.mold(e);return this.model.has(t)}get(e){if(void 0===e)return this;{const t=this.ownKeyForm.mold(e);return this.model.get(t).coerce(this.ownValueForm)}}getEntry(e){const t=this.model.getEntry(e);if(void 0!==t)return[t[0].coerce(this.ownKeyForm),t[1].coerce(this.ownValueForm)]}firstKey(){const e=this.model.state.firstKey();if(void 0!==e){const t=this.ownKeyForm.cast(e);if(void 0!==t)return t}return this.ownKeyForm.unit}firstValue(){const e=this.model.state.firstValue();if(void 0!==e){const t=this.ownValueForm.cast(e);if(void 0!==t)return t}return this.ownValueForm.unit}firstEntry(){const e=this.model.state.firstEntry();if(void 0!==e){return[this.ownKeyForm.cast(e[0]),this.ownValueForm.cast(e[1])]}}lastKey(){const e=this.model.state.lastKey();if(void 0!==e){const t=this.ownKeyForm.cast(e);if(void 0!==t)return t}return this.ownKeyForm.unit}lastValue(){const e=this.model.state.lastValue();if(void 0!==e){const t=this.ownValueForm.cast(e);if(void 0!==t)return t}return this.ownValueForm.unit}lastEntry(){const e=this.model.state.lastEntry();if(void 0!==e){return[this.ownKeyForm.cast(e[0]),this.ownValueForm.cast(e[1])]}}nextKey(e){const t=this.ownKeyForm.mold(e),r=this.model.state.nextKey(t);if(void 0!==r){const e=this.ownKeyForm.cast(r);if(void 0!==e)return e}return this.ownKeyForm.unit}nextValue(e){const t=this.ownKeyForm.mold(e),r=this.model.state.nextValue(t);if(void 0!==r){const e=this.ownValueForm.cast(r);if(void 0!==e)return e}return this.ownValueForm.unit}nextEntry(e){const t=this.ownKeyForm.mold(e),r=this.model.state.nextEntry(t);if(void 0!==r){return[this.ownKeyForm.cast(r[0]),this.ownValueForm.cast(r[1])]}}previousKey(e){const t=this.ownKeyForm.mold(e),r=this.model.state.previousKey(t);if(void 0!==r){const e=this.ownKeyForm.cast(r);if(void 0!==e)return e}return this.ownKeyForm.unit}previousValue(e){const t=this.ownKeyForm.mold(e),r=this.model.state.previousValue(t);if(void 0!==r){const e=this.ownValueForm.cast(r);if(void 0!==e)return e}return this.ownValueForm.unit}previousEntry(e){const t=this.ownKeyForm.mold(e),r=this.model.state.previousEntry(t);if(void 0!==r){return[this.ownKeyForm.cast(r[0]),this.ownValueForm.cast(r[1])]}}set(e,t){const r=this.ownKeyForm.mold(e),i=this.ownValueForm.mold(t);return this.model.set(r,i),this}delete(e){const t=this.ownKeyForm.mold(e);return this.model.delete(t)}drop(e){return this.model.drop(e),this}take(e){return this.model.take(e),this}clear(){this.model.clear()}forEach(e,t){return this.ownKeyForm===Mi.forValue()&&this.ownValueForm===Mi.forValue()?this.model.state.forEach(e,t):this.model.state.forEach((function(r,i){const n=r.coerce(this.ownKeyForm),s=i.coerce(this.ownValueForm);return e.call(t,n,s)}),this)}keys(){const e=this.model.keys();return this.ownKeyForm===Mi.forValue()?e:new Li(e,this.ownKeyForm)}values(){const e=this.model.values();return this.ownValueForm===Mi.forValue()?e:new Li(e,this.ownValueForm)}entries(){const e=this.model.entries();return this.ownKeyForm===Mi.forValue()&&this.ownValueForm===Mi.forValue()?e:new Bi(e,this.ownKeyForm,this.ownValueForm)}snapshot(){return this.model.snapshot()}setState(e){this.model.setState(e)}observe(e){return super.observe(e)}willUpdate(e){return this.observe({willUpdate:e})}didUpdate(e){return this.observe({didUpdate:e})}willRemove(e){return this.observe({willRemove:e})}didRemove(e){return this.observe({didRemove:e})}willDrop(e){return this.observe({willDrop:e})}didDrop(e){return this.observe({didDrop:e})}willTake(e){return this.observe({willTake:e})}didTake(e){return this.observe({didTake:e})}willClear(e){return this.observe({willClear:e})}didClear(e){return this.observe({didClear:e})}mapWillUpdate(e,t){let r,i;const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];if(void 0!==o.willUpdate){void 0===r&&(r=e.coerce(this.ownKeyForm)),void 0===i&&(i=t.coerce(this.ownValueForm));const n=o.willUpdate(r,i,this);void 0!==n&&(i=n,t=this.ownValueForm.mold(i))}}return t}mapDidUpdate(e,t,r){const i=e.coerce(this.ownKeyForm);let n,s;const o=this.observers;for(let e=0,a=o.length;e<a;e+=1){const a=o[e];void 0!==a.didUpdate&&(void 0===n&&(n=t.coerce(this.ownValueForm)),void 0===s&&(s=r.coerce(this.ownValueForm)),a.didUpdate(i,n,s,this))}this.decohereInputKey(i,0),this.recohereInput(0)}mapWillRemove(e){let t;const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.willRemove&&(void 0===t&&(t=e.coerce(this.ownKeyForm)),n.willRemove(t,this))}}mapDidRemove(e,t){const r=e.coerce(this.ownKeyForm);let i;const n=this.observers;for(let e=0,s=n.length;e<s;e+=1){const s=n[e];void 0!==s.didRemove&&(void 0===i&&(i=t.coerce(this.ownValueForm)),s.didRemove(r,i,this))}this.decohereInputKey(r,1),this.recohereInput(0)}mapWillDrop(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.willDrop&&i.willDrop(e,this)}}mapDidDrop(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.didDrop&&i.didDrop(e,this)}}mapWillTake(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.willTake&&i.willTake(e,this)}}mapDidTake(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.didTake&&i.didTake(e,this)}}mapWillClear(){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.willClear&&r.willClear(this)}}mapDidClear(){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.didClear&&r.didClear(this)}}initialState(e){return void 0===e?this.state0:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,this.ownKeyForm,this.ownValueForm,e)}didAliasModel(){this.onLinkedResponse(),this.model.state.forEach((function(e,t){this.mapDidUpdate(e,t,xr.absent())}),this),this.onSyncedResponse()}open(){var e;const t=this.ownLaneUri;if(t.isEmpty())throw new Error("no lane");let r=this.ownNodeUri;if(r.isEmpty())throw new Error("no node");let i=this.ownHostUri;i.isEmpty()&&(i=r.endpoint(),r=i.unresolve(r));let n=this.context.getDownlink(i,r,t);if(void 0!==n){if(!(n instanceof Dl))throw new Error("downlink type mismatch");n.addDownlink(this),this.model=n,setTimeout(this.didAliasModel.bind(this))}else n=new Dl(this.context,i,r,t,this.ownPrio,this.ownRate,this.ownBody,null!==(e=this.state0)&&void 0!==e?e:void 0),n.addDownlink(this),this.context.openDownlink(n),this.model=n;return null!==this.owner&&this.owner.addDownlink(this),this}keyIterator(){return this.keys()}bindInput(e){if(!Gi.is(e))throw new TypeError(""+e);const t=this.input;t!==e&&(null!==t&&t.unbindOutput(this),this.input=e,null!==e&&e.bindOutput(this))}unbindInput(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null)}disconnectInputs(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null,e.disconnectInputs())}outlet(e){const t=this.outlets;let r=t.get(e);return void 0===r&&(r=new rn(this,e),this.outlets=t.updated(e,r)),r}outputIterator(){return Z.array(this.outputs)}bindOutput(e){this.outputs=x.inserted(e,this.outputs)}unbindOutput(e){this.outputs=x.removed(e,this.outputs)}unbindOutputs(){const e=this.outlets;e.isEmpty()&&(this.outlets=new Ut,e.forEach((function(e,t){t.unbindOutputs()}),this));const t=this.outputs;this.outputs=x.empty;for(let e=0,r=t.length;e<r;e+=1){t[e].unbindInput()}}disconnectOutputs(){const e=this.outlets;e.isEmpty()&&(this.outlets=new Ut,e.forEach((function(e,t){t.disconnectOutputs()}),this));const t=this.outputs;this.outputs=x.empty;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];r.unbindInput(),r.disconnectOutputs()}}decohereOutputKey(e,t){this.decohereKey(e,t)}decohereInputKey(e,t){this.decohereKey(e,t)}decohereKey(e,t){const r=this.effects;if(r.get(e)!==t){this.willDecohereKey(e,t),this.effects=r.updated(e,t),this.version=-1,this.onDecohereKey(e,t);const i=this.outputs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];_i.is(n)?n.decohereOutputKey(e,t):n.decohereOutput()}const n=this.outlets.get(e);void 0!==n&&n.decohereInput(),this.didDecohereKey(e,t)}}decohereOutput(){this.decohere()}decohereInput(){this.decohere()}decohere(){if(this.version>=0){this.willDecohere(),this.version=-1,this.onDecohere();const e=this.outputs;for(let t=0,r=e.length;t<r;t+=1){e[t].decohereOutput()}this.outlets.forEach((function(e,t){t.decohereInput()}),this),this.didDecohere()}}recohereOutputKey(e,t){this.recohereKey(e,t)}recohereInputKey(e,t){this.recohereKey(e,t)}recohereKey(e,t){if(this.version<0){const r=this.effects,i=r.get(e);if(void 0!==i){this.willRecohereKey(e,i,t),this.effects=r.removed(e),null!==this.input&&this.input.recohereInputKey(e,t),this.onRecohereKey(e,i,t);const n=this.outputs;for(let r=0,i=n.length;r<i;r+=1){const i=n[r];_i.is(i)&&i.recohereOutputKey(e,t)}const s=this.outlets.get(e);void 0!==s&&s.recohereInput(t),this.didRecohereKey(e,i,t)}}}recohereOutput(e){this.recohere(e)}recohereInput(e){this.recohere(e)}recohere(e){if(this.version<0){this.willRecohere(e),this.effects.forEach((function(t){this.recohereKey(t,e)}),this),this.version=e,this.onRecohere(e);const t=this.outputs;for(let r=0,i=t.length;r<i;r+=1){t[r].recohereOutput(e)}this.didRecohere(e)}}willDecohereKey(e,t){}onDecohereKey(e,t){}didDecohereKey(e,t){}willDecohere(){}onDecohere(){}didDecohere(){}willRecohereKey(e,t,r){}onRecohereKey(e,t,r){if(0===t){const t=this.input;if(null!==t){const r=t.get(e);void 0!==r?this.set(e,r):this.delete(e)}}else 1===t&&this.delete(e)}didRecohereKey(e,t,r){}willRecohere(e){}onRecohere(e){}didRecohere(e){}}Yi.define(Pl.prototype);class Tl extends bl{constructor(e,t,r,i,n,s,o,a=xr.absent()){super(e,t,r,i,n,s,o),this.state=a}get type(){return"value"}get(){return this.state}set(e){e=this.valueWillSet(e);const t=this.state;this.setState(e),this.valueDidSet(e,t),this.command(e)}setState(e){this.state=e}onEventMessage(e,t){super.onEventMessage(e,t),this.onSetEvent(e.body)}onSetEvent(e){e=this.valueWillSet(e);const t=this.state;this.setState(e),this.valueDidSet(e,t)}valueWillSet(e){const t=this.views;for(let r=0,i=t.length;r<i;r+=1)e=t[r].valueWillSet(e);return e}valueDidSet(e,t){const r=this.views;for(let i=0,n=r.length;i<n;i+=1)r[i].valueDidSet(e,t)}}class Il extends Cl{constructor(e,t,r,i,n,s,o,a,u,h=3,l,c,d=xr.absent()){var p,f;if(super(e,t,r,i,n,s,o,a,u,h,l),void 0!==r){const e=this.observers[this.observers.length-1];e.willSet=null!==(p=r.willSet)&&void 0!==p?p:e.willSet,e.didSet=null!==(f=r.didSet)&&void 0!==f?f:e.didSet,c=void 0!==r.valueForm?r.valueForm:c}this.ownValueForm=void 0!==c?c:Mi.forValue(),this.state0=d,this.input=null,this.outputs=x.empty,this.version=-1}get type(){return"value"}copy(e,t,r,i,n,s,o,a,u,h,l,c){return 10===arguments.length&&(c=this.state0,l=this.ownValueForm),new Il(e,t,void 0,r,i,n,s,o,a,u,h,l,c)}valueForm(e){return void 0===e?this.ownValueForm:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,e,this.state0)}get(){return this.model.get().coerce(this.ownValueForm)}set(e){const t=this.ownValueForm.mold(e);this.model.set(t)}setState(e){this.model.setState(e)}observe(e){return super.observe(e)}willSet(e){return this.observe({willSet:e})}didSet(e){return this.observe({didSet:e})}valueWillSet(e){let t;const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];if(void 0!==n.willSet){void 0===t&&(t=e.coerce(this.ownValueForm));const r=n.willSet(t,this);void 0!==r&&(t=r,e=this.ownValueForm.mold(t))}}return e}valueDidSet(e,t){let r,i;const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.didSet&&(void 0===r&&(r=e.coerce(this.ownValueForm)),void 0===i&&(i=t.coerce(this.ownValueForm)),o.didSet(r,i,this))}this.decohere(),this.recohere(0)}initialState(e){return void 0===e?this.state0:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,this.ownValueForm,e)}didAliasModel(){this.onLinkedResponse(),this.valueDidSet(this.model.get(),xr.absent()),this.onSyncedResponse()}open(){const e=this.ownLaneUri;if(e.isEmpty())throw new Error("no lane");let t=this.ownNodeUri;if(t.isEmpty())throw new Error("no node");let r=this.ownHostUri;r.isEmpty()&&(r=t.endpoint(),t=r.unresolve(t));let i=this.context.getDownlink(r,t,e);if(void 0!==i){if(!(i instanceof Tl))throw new Error("downlink type mismatch");i.addDownlink(this),this.model=i,setTimeout(this.didAliasModel.bind(this))}else i=new Tl(this.context,r,t,e,this.ownPrio,this.ownRate,this.ownBody,this.state0),i.addDownlink(this),this.context.openDownlink(i),this.model=i;return null!==this.owner&&this.owner.addDownlink(this),this}bindInput(e){const t=this.input;t!==e&&(null!==t&&t.unbindOutput(this),this.input=e,null!==e&&e.bindOutput(this))}unbindInput(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null)}disconnectInputs(){const e=this.input;null!==e&&(e.unbindOutput(this),this.input=null,e.disconnectInputs())}outputIterator(){return Z.array(this.outputs)}bindOutput(e){this.outputs=x.inserted(e,this.outputs)}unbindOutput(e){this.outputs=x.removed(e,this.outputs)}unbindOutputs(){const e=this.outputs;this.outputs=x.empty;for(let t=0,r=e.length;t<r;t+=1){e[t].unbindInput()}}disconnectOutputs(){const e=this.outputs;this.outputs=x.empty;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];r.unbindInput(),r.disconnectOutputs()}}decohereOutput(){this.decohere()}decohereInput(){this.decohere()}decohere(){if(this.version>=0){this.willDecohere(),this.version=-1,this.onDecohere();const e=this.outputs;for(let t=0,r=e.length;t<r;t+=1)e[t].decohereOutput();this.didDecohere()}}recohereOutput(e){this.recohere(e)}recohereInput(e){this.recohere(e)}recohere(e){if(this.version<0){this.willRecohere(e),this.version=e,null!==this.input&&this.input.recohereInput(e),this.onRecohere(e);const t=this.outputs;for(let r=0,i=t.length;r<i;r+=1)t[r].recohereOutput(e);this.didRecohere(e)}}willDecohere(){}onDecohere(){}didDecohere(){}willRecohere(e){}onRecohere(e){const t=this.input;if(null!==t){const e=t.get();void 0!==e&&this.set(e)}}didRecohere(e){}}Hi.define(Il.prototype);class Ml extends Nn{}class Vl extends Ml{constructor(e){super(),this.downlink=e,e.observe(this)}isEmpty(){return this.downlink.isEmpty()}isArray(){return this.downlink.isEmpty()}isObject(){return!0}get length(){return this.downlink.size}has(e){return this.downlink.has(e)}get(e){return void 0===e?this:this.downlink.get(e)}getAttr(e){return xr.absent()}getSlot(e){return this.get(e)}getItem(e){e instanceof Mr&&(e=e.value);const t=this.downlink.size;if(e<0&&(e=t+e),(e=Math.min(Math.max(0,e),t-1))>=0){const t=this.downlink.getEntry(e);return yr.of(t[0],t[1])}return pr.absent()}set(e,t){return this.downlink.set(e,t),this}setAttr(e,t){throw new Error("unsupported")}setSlot(e,t){return this.set(e,t)}setItem(e,t){throw new Error("unsupported")}push(...e){throw new Error("unsupported")}splice(e,t,...r){throw new Error("unsupported")}delete(e){e=xr.fromAny(e);const t=this.downlink.get(e);return this.downlink.delete(e)?yr.of(e,t):pr.absent()}clear(){this.downlink.clear()}forEach(e,t){let r=0;return this.downlink.forEach((function(i,n){const s=e.call(t,yr.of(i,n),r);return r+=1,s}))}keyIterator(){return this.downlink.keys()}didUpdate(e,t,r){this.decohereInputKey(e,0),this.recohereInput(0)}didRemove(e,t){this.decohereInputKey(e,1),this.recohereInput(0)}didDrop(e){}didTake(e){}didClear(){}}class ql extends Bn{constructor(e=null){super(),this.warp=e}reify(e){return e instanceof mr?this.reifyField(e):this.reifyValue(e)}reifyField(e){const t=e.value,r=this.reifyValue(t);return t!==r?e.updatedValue(r):e}reifyValue(e){return e instanceof jn?this.reifyModel(e):e}reifyModel(e){if("link"===e.tag){const t=new Fl(this.warp,e);return t.compile(),t}return e}}class Fl extends Un{constructor(e=null,t){super(t),this.hostUri=this.inoutlet(),this.nodeUri=this.inoutlet(),this.laneUri=this.inoutlet(),this.prio=this.inoutlet(),this.rate=this.inoutlet(),this.bodyValue=this.inoutlet(),this.type=this.inoutlet(),this.state=this.outlet(),this.warp=e,this.downlink=null,this.downlinkRecord=null,this.inputHostUri=void 0,this.inputNodeUri=void 0,this.inputLaneUri=void 0,this.inputPrio=void 0,this.inputRate=void 0,this.inputBody=void 0,this.inputType=void 0}getOutput(e){if((e=this.outlet(e))===this.state){if(this.downlink instanceof Il)return this.downlink.get();if(null!==this.downlinkRecord)return this.downlinkRecord}}onRecohere(e){var t;const r=this.castInput(this.hostUri,Mi.forString()),i=this.castInput(this.nodeUri,Mi.forString()),n=this.castInput(this.laneUri,Mi.forString()),s=this.castInput(this.prio,Mi.forNumber(),0),o=this.castInput(this.rate,Mi.forNumber(),0),a=this.getInput(this.bodyValue),u=this.castInput(this.type,Mi.forString(),void 0);if(r!==this.inputHostUri||i!==this.inputNodeUri||n!==this.inputLaneUri||s!==this.inputPrio||o!==this.inputRate||(void 0===a?void 0!==this.inputBody:!a.equals(this.inputBody))||u!==this.inputType){null!==this.downlink&&(this.downlink.close(),this.downlink=null,this.downlinkRecord=null),this.inputHostUri=r,this.inputNodeUri=i,this.inputLaneUri=n,this.inputPrio=s,this.inputRate=o,this.inputBody=a,this.inputType=u;const e=null!==(t=this.warp)&&void 0!==t?t:Ll;if("map"===u){let t=e.downlinkMap();void 0!==r&&(t=t.hostUri(r)),void 0!==i&&(t=t.nodeUri(i)),void 0!==n&&(t=t.laneUri(n)),0!==s&&(t=t.prio(s)),0!==o&&(t=t.rate(o)),void 0!==a&&(t=t.body(a)),t=t.open(),this.state=t,this.downlink=t,this.downlinkRecord=new Vl(t)}else if("value"===u){let t=e.downlinkValue();void 0!==r&&(t=t.hostUri(r)),void 0!==i&&(t=t.nodeUri(i)),void 0!==n&&(t=t.laneUri(n)),void 0!==s&&(t=t.prio(s)),void 0!==o&&(t=t.rate(o)),void 0!==a&&(t=t.body(a)),t=t.open(),this.state=t,this.downlink=t}}}static reifier(e){return void 0===e?(void 0===Fl._reifier&&(Fl._reifier=new ql),Fl._reifier):new ql(e)}}i([qn],Fl.prototype,"hostUri",void 0),i([qn],Fl.prototype,"nodeUri",void 0),i([qn],Fl.prototype,"laneUri",void 0),i([qn],Fl.prototype,"prio",void 0),i([qn],Fl.prototype,"rate",void 0),i([qn("body")],Fl.prototype,"bodyValue",void 0),i([qn],Fl.prototype,"type",void 0),i([Vn],Fl.prototype,"state",void 0);class Nl{constructor(e){this.context=e,this.host=null,this.downlinks=[],this.observers=x.empty}get connected(){const e=this.host;return null!==e&&e.connected}get authenticated(){const e=this.host;return null!==e&&e.authenticated}get session(){const e=this.host;return null!==e?e.session:xr.absent()}authenticate(e){this.context.authenticate(this.hostUri,e)}addDownlink(e){const t=this.downlinks;0===t.length&&this.open(),t.push(e)}removeDownlink(e){const t=this.downlinks,r=t.indexOf(e);r>=0&&(t.splice(r,1),0===t.length&&this.close())}open(){this.context.openRef(this)}close(){this.context.closeRef(this)}closeUp(){const e=this.downlinks;this.downlinks=[];for(let t=0,r=e.length;t<r;t+=1)e[t].close()}observe(e){return this.observers=x.inserted(e,this.observers),this}unobserve(e){const t=this.observers,r=t.length;for(let i=0;i<r;i+=1){const n=t[i];let s=n===e;if(!s)for(const t in n)if(n[t]===e){s=!0;break}if(s){if(r>1){const e=new Array(r-1);for(let r=0;r<i;r+=1)e[r]=t[r];for(let n=i+1;n<r;n+=1)e[n-1]=t[n];this.observers=e}else this.observers=x.empty;break}}return this}didConnect(e){return this.observe({didConnect:e})}didAuthenticate(e){return this.observe({didAuthenticate:e})}didDeauthenticate(e){return this.observe({didDeauthenticate:e})}didDisconnect(e){return this.observe({didDisconnect:e})}didFail(e){return this.observe({didFail:e})}hostDidConnect(e){this.host=e;const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.didConnect&&i.didConnect(e,this)}}hostDidAuthenticate(e,t){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.didAuthenticate&&n.didAuthenticate(e,t,this)}}hostDidDeauthenticate(e,t){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.didDeauthenticate&&n.didDeauthenticate(e,t,this)}}hostDidDisconnect(e){this.host=null;const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.didDisconnect&&i.didDisconnect(e,this)}}hostDidFail(e,t){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.didFail&&n.didFail(e,t,this)}}}class zl extends Nl{constructor(e,t,r,i){super(e),this.hostUri=t,this.nodeUri=r,this.laneUri=i}hostRef(e){return e=vo.fromAny(e),new Rl(this.context,e)}nodeRef(e){return e=vo.fromAny(e),new Ul(this.context,this.hostUri,e)}laneRef(e){return e=vo.fromAny(e),new zl(this.context,this.hostUri,this.nodeUri,e)}downlink(e){return new El(this.context,this,e,this.hostUri,this.nodeUri,this.laneUri)}downlinkList(e){return new kl(this.context,this,e,this.hostUri,this.nodeUri,this.laneUri)}downlinkMap(e){return new Pl(this.context,this,e,this.hostUri,this.nodeUri,this.laneUri)}downlinkValue(e){return new Il(this.context,this,e,this.hostUri,this.nodeUri,this.laneUri)}command(e){this.context.command(this.hostUri,this.nodeUri,this.laneUri,e)}}class Ul extends Nl{constructor(e,t,r){super(e),this.hostUri=t,this.nodeUri=r}hostRef(e){return e=vo.fromAny(e),new Rl(this.context,e)}nodeRef(e){return e=vo.fromAny(e),new Ul(this.context,this.hostUri,e)}laneRef(e){return e=vo.fromAny(e),new zl(this.context,this.hostUri,this.nodeUri,e)}downlink(e){return new El(this.context,this,e,this.hostUri,this.nodeUri)}downlinkList(e){return new kl(this.context,this,e,this.hostUri,this.nodeUri)}downlinkMap(e){return new Pl(this.context,this,e,this.hostUri,this.nodeUri)}downlinkValue(e){return new Il(this.context,this,e,this.hostUri,this.nodeUri)}command(e,t){this.context.command(this.hostUri,this.nodeUri,e,t)}}class Rl extends Nl{constructor(e,t){super(e),this.hostUri=t}hostRef(e){return e=vo.fromAny(e),new Rl(this.context,e)}nodeRef(e){return e=vo.fromAny(e),new Ul(this.context,this.hostUri,e)}laneRef(e,t){return e=vo.fromAny(e),t=vo.fromAny(t),new zl(this.context,this.hostUri,e,t)}downlink(e){return new El(this.context,this,e,this.hostUri)}downlinkList(e){return new kl(this.context,this,e,this.hostUri)}downlinkMap(e){return new Pl(this.context,this,e,this.hostUri)}downlinkValue(e){return new Il(this.context,this,e,this.hostUri)}command(e,t,r){this.context.command(this.hostUri,e,t,r)}}class jl{constructor(e={}){void 0===e.keepOnline&&(e.keepOnline=!0),this.options=e,this.hosts=new Ut,this.downlinks=new Ut,this.downlinkCount=0,this.refs=[],this.online=!0,this.observers=x.empty,this.onOnline=this.onOnline.bind(this),this.onOffline=this.onOffline.bind(this),this.watchOnline(!!e.keepOnline)}setOnline(e){this.online!==e&&(this.online=e,e&&this.hosts.forEach((function(e,t){t.open()}),this))}keepOnline(e){return void 0===e?!!this.options.keepOnline:(this.options.keepOnline!==e&&(this.options.keepOnline=e,this.watchOnline(e)),this)}watchOnline(e){"object"==typeof window&&(e?(window.addEventListener("online",this.onOnline),window.addEventListener("offline",this.onOffline)):(window.removeEventListener("online",this.onOnline),window.removeEventListener("offline",this.onOffline)))}onOnline(e){this.setOnline(!0)}onOffline(e){this.setOnline(!1)}getHost(e){return e=vo.fromAny(e),this.hosts.get(e)}openHost(e){e=vo.fromAny(e);let t=this.hosts.get(e);return void 0===t&&(t=vl.create(this,e,this.options),null===t&&(t=new gl(this,e,this.options)),this.hosts.set(e,t)),t}closeHost(e){void 0!==this.hosts.get(e.hostUri)&&(this.hosts.delete(e.hostUri),e.closeUp())}getDownlink(e,t,r){const i=this.downlinks.get(e);if(void 0!==i){const e=i.get(t);if(void 0!==e)return e.get(r)}}openDownlink(e){const t=e.hostUri,r=e.nodeUri,i=e.laneUri;let n=this.downlinks.get(t);void 0===n&&(n=new Ut,this.downlinks.set(t,n));let s=n.get(r);if(void 0===s&&(s=new Ut,n.set(r,s)),s.has(i))throw new Error("duplicate downlink");s.set(i,e),this.downlinkCount+=1;this.openHost(t).openDownlink(e)}unlinkDownlink(e){const t=e.hostUri,r=this.getHost(t);void 0!==r&&r.unlinkDownlink(e)}closeDownlink(e){const t=e.hostUri,r=e.nodeUri,i=e.laneUri,n=this.downlinks.get(t);if(void 0!==n){const s=n.get(r);if(void 0!==s&&s.get(i)){this.downlinkCount-=1,s.delete(i),s.isEmpty()&&(n.delete(r),n.isEmpty()&&this.downlinks.delete(t));const o=this.getHost(t);void 0!==o&&o.closeDownlink(e)}}}downlink(e){return new El(this,null,e)}downlinkList(e){return new kl(this,null,e)}downlinkMap(e){return new Pl(this,null,e)}downlinkValue(e){return new Il(this,null,e)}openRef(e){this.refs.push(e)}closeRef(e){const t=this.refs,r=t.indexOf(e);r>=0&&(t.splice(r,1),e.closeUp())}hostRef(e){return e=vo.fromAny(e),new Rl(this,e)}nodeRef(e,t){return e=vo.fromAny(e),void 0===t?(e=(t=e).endpoint(),t=e.unresolve(t)):t=vo.fromAny(t),new Ul(this,e,t)}laneRef(e,t,r){return e=vo.fromAny(e),t=vo.fromAny(t),void 0===r?(r=t,e=(t=e).endpoint(),t=e.unresolve(t)):r=vo.fromAny(r),new zl(this,e,t,r)}authenticate(e,t){e=vo.fromAny(e),t=xr.fromAny(t);this.openHost(e).authenticate(t)}command(e,t,r,i){e=vo.fromAny(e),t=vo.fromAny(t),3===arguments.length?(i=r,r=t,e=(t=e).endpoint(),t=e.unresolve(t)):r=vo.fromAny(r),i=xr.fromAny(i);this.openHost(e).command(t,r,i)}close(){const e=this.refs;this.refs=[];for(let t=0;t<e.length;t+=1)e[t].closeUp();const t=this.downlinks.clone();this.downlinks.clear(),this.downlinkCount=0,t.forEach((function(e,t){t.forEach((function(t,r){r.forEach((function(t,r){r.closeUp();const i=this.getHost(e);void 0!==i&&i.closeDownlink(r)}),this)}),this)}),this);const r=this.hosts.clone();this.hosts.clear(),r.forEach((function(e,t){t.closeUp()}),this)}observe(e){return this.observers=x.inserted(e,this.observers),this}unobserve(e){const t=this.observers,r=t.length;for(let i=0;i<r;i+=1){const n=t[i];let s=n===e;if(!s)for(const t in n)if(n[t]===e){s=!0;break}if(s){if(r>1){const e=new Array(r-1);for(let r=0;r<i;r+=1)e[r]=t[r];for(let n=i+1;n<r;n+=1)e[n-1]=t[n];this.observers=e}else this.observers=x.empty;break}}return this}didConnect(e){return this.observe({didConnect:e})}didAuthenticate(e){return this.observe({didAuthenticate:e})}didDeauthenticate(e){return this.observe({didDeauthenticate:e})}didDisconnect(e){return this.observe({didDisconnect:e})}didFail(e){return this.observe({didFail:e})}hostDidConnect(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.didConnect&&i.didConnect(e,this)}const r=this.refs;for(let t=0,i=r.length;t<i;t+=1){const i=r[t];i.hostUri.equals(e.hostUri)&&i.hostDidConnect(e)}}hostDidAuthenticate(e,t){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.didAuthenticate&&n.didAuthenticate(e,t,this)}const i=this.refs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];n.hostUri.equals(t.hostUri)&&n.hostDidAuthenticate(e,t)}}hostDidDeauthenticate(e,t){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.didDeauthenticate&&n.didDeauthenticate(e,t,this)}const i=this.refs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];n.hostUri.equals(t.hostUri)&&n.hostDidDeauthenticate(e,t)}}hostDidDisconnect(e){const t=this.observers;for(let r=0,i=t.length;r<i;r+=1){const i=t[r];void 0!==i.didDisconnect&&i.didDisconnect(e,this)}const r=this.refs;for(let t=0,i=r.length;t<i;t+=1){const i=r[t];i.hostUri.equals(e.hostUri)&&i.hostDidDisconnect(e)}}hostDidFail(e,t){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.didFail&&n.didFail(e,t,this)}const i=this.refs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];n.hostUri.equals(t.hostUri)&&n.hostDidFail(e,t)}}}const Ll=new jl,Bl=Ll.downlink.bind(Ll),Kl=Ll.downlinkList.bind(Ll),Wl=Ll.downlinkMap.bind(Ll),Hl=Ll.downlinkValue.bind(Ll),Xl=Ll.hostRef.bind(Ll),_l=Ll.nodeRef.bind(Ll),Gl=Ll.laneRef.bind(Ll),Yl=Ll.authenticate.bind(Ll),Zl=Ll.command.bind(Ll);class Ql extends kt{constructor(e){super(),this.client=e}static global(){return new Ql(Ll)}}i([a],Ql,"global",null);const $l=function(e){const t=e.extend("WarpProvider");return Object.defineProperty(t.prototype,"client",{get(){let e=this.service;return null==e&&(e=Ql.global()),e.client},configurable:!0}),t.prototype.createService=function(){return Ql.global()},t}(Dt),Jl=function(e){const t=e.extend("DownlinkFastener");return Object.defineProperty(t.prototype,"fastenerType",{get:function(){return t},configurable:!0}),t.prototype.onInherit=function(e){},t.prototype.hostUri=function(e){return void 0===e?null!==this.ownHostUri?this.ownHostUri:(null!==(e=void 0!==this.initHostUri?this.initHostUri():null)&&(e=vo.fromAny(e),this.ownHostUri=e),e):(null!==e&&(e=vo.fromAny(e)),y(this.ownHostUri,e)||(this.ownHostUri=e,this.relink()),this)},t.prototype.nodeUri=function(e){return void 0===e?null!==this.ownNodeUri?this.ownNodeUri:(null!==(e=void 0!==this.initNodeUri?this.initNodeUri():null)&&(e=vo.fromAny(e),this.ownNodeUri=e),e):(null!==e&&(e=vo.fromAny(e)),y(this.ownNodeUri,e)||(this.ownNodeUri=e,this.relink()),this)},t.prototype.laneUri=function(e){return void 0===e?null!==this.ownLaneUri?this.ownLaneUri:(null!==(e=void 0!==this.initLaneUri?this.initLaneUri():null)&&(e=vo.fromAny(e),this.ownLaneUri=e),e):(null!==e&&(e=vo.fromAny(e)),y(this.ownLaneUri,e)||(this.ownLaneUri=e,this.relink()),this)},t.prototype.prio=function(e){return 0===arguments.length?void 0!==this.ownPrio?this.ownPrio:(void 0!==(e=void 0!==this.initPrio?this.initPrio():void 0)&&(this.ownPrio=e),e):(this.ownPrio!==e&&(this.ownPrio=e,this.relink()),this)},t.prototype.rate=function(e){return 0===arguments.length?void 0!==this.ownRate?this.ownRate:(void 0!==(e=void 0!==this.initRate?this.initRate():void 0)&&(this.ownRate=e),e):(this.ownRate!==e&&(this.ownRate=e,this.relink()),this)},t.prototype.body=function(e){return void 0===e?null!==this.ownBody?this.ownBody:(null!==(e=void 0!==this.initBody?this.initBody():null)&&(e=xr.fromAny(e),this.ownBody=e),e):(null!==e&&(e=xr.fromAny(e)),y(this.ownBody,e)||(this.ownBody=e,this.relink()),this)},t.prototype.warp=function(e){return void 0===e?this.ownWarp:(this.ownWarp!==e&&(this.ownWarp=e,this.relink()),this)},t.prototype.link=function(){if(null===this.downlink){let e=this.ownWarp;null===e&&(e=this.owner.warpRef.value),null===e&&(e=this.owner.warpProvider.service.client);let r=this.createDownlink(e);r=this.bindDownlink(r),void 0!==this.initDownlink&&(r=this.initDownlink(r)),r=r.observe(this),this.downlink=r.open(),this.setFlags(this.flags&~t.PendingFlag)}},t.prototype.unlink=function(){const e=this.downlink;null!==e&&(e.close(),this.downlink=null,this.setFlags(this.flags|t.PendingFlag))},t.prototype.relink=function(){this.setFlags(this.flags|t.PendingFlag),0!=(this.flags&t.ConsumingFlag)&&(this.setCoherent(!1),this.decohere())},t.prototype.bindDownlink=function(e){const t=this.hostUri();null!==t&&(e=e.hostUri(t));const r=this.nodeUri();null!==r&&(e=e.nodeUri(r));const i=this.laneUri();null!==i&&(e=e.laneUri(i));const n=this.prio();void 0!==n&&(e=e.prio(n));const s=this.rate();void 0!==s&&(e=e.rate(s));const o=this.body();return null!==o&&(e=e.body(o)),e},t.prototype.recohere=function(e){this.setCoherent(!0),null!==this.downlink&&(this.flags&t.RelinkMask)===t.RelinkMask?(this.unlink(),this.link()):null===this.downlink&&0!=(this.flags&t.ConsumingFlag)?this.link():null!==this.downlink&&0==(this.flags&t.ConsumingFlag)&&this.unlink()},t.prototype.consume=function(e){const t=this.consumers,r=x.inserted(e,t);t!==r&&(this.willConsume(e),this.consumers=r,this.onConsume(e),this.didConsume(e),0===t.length&&this.startConsuming())},t.prototype.willConsume=function(e){},t.prototype.onConsume=function(e){},t.prototype.didConsume=function(e){},t.prototype.unconsume=function(e){const t=this.consumers,r=x.removed(e,t);t!==r&&(this.willUnconsume(e),this.consumers=r,this.onUnconsume(e),this.didUnconsume(e),0===r.length&&this.stopConsuming())},t.prototype.willUnconsume=function(e){},t.prototype.onUnconsume=function(e){},t.prototype.didUnconsume=function(e){},Object.defineProperty(t.prototype,"consuming",{get(){return 0!=(this.flags&t.ConsumingFlag)},configurable:!0}),t.prototype.startConsuming=function(){0==(this.flags&t.ConsumingFlag)&&(this.willStartConsuming(),this.setFlags(this.flags|t.ConsumingFlag),this.onStartConsuming(),this.didStartConsuming())},t.prototype.willStartConsuming=function(){},t.prototype.onStartConsuming=function(){this.setCoherent(!1),this.decohere()},t.prototype.didStartConsuming=function(){},t.prototype.stopConsuming=function(){0!=(this.flags&t.ConsumingFlag)&&(this.willStopConsuming(),this.setFlags(this.flags&~t.ConsumingFlag),this.onStopConsuming(),this.didStopConsuming())},t.prototype.willStopConsuming=function(){},t.prototype.onStopConsuming=function(){this.setCoherent(!1),this.decohere()},t.prototype.didStopConsuming=function(){},t.prototype.onMount=function(){e.prototype.onMount.call(this),0!=(this.flags&t.ConsumingFlag)&&(this.setCoherent(!1),this.decohere())},t.prototype.onUnmount=function(){e.prototype.onUnmount.call(this),this.unlink()},Object.defineProperty(t.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(t.prototype,"static",{get:function(){return!0},configurable:!0}),t.construct=function(t,r,i){return(r=e.construct(t,r,i)).ownHostUri=null,r.ownNodeUri=null,r.ownLaneUri=null,r.ownPrio=void 0,r.ownRate=void 0,r.ownBody=null,r.ownWarp=null,r.downlink=null,r.consumers=x.empty,r},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits;let s=t.hostUri,o=t.nodeUri,a=t.laneUri,u=t.prio,h=t.rate,l=t.body;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,delete t.hostUri,delete t.nodeUri,delete t.laneUri,delete t.prio,delete t.rate,delete t.body,null==r&&(r=this);const c=r.extend(e,t);return c.construct=function(e,t,c){return t=r.construct(e,t,c),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),void 0!==s&&(t.ownHostUri=s),void 0!==o&&(t.ownNodeUri=o),void 0!==a&&(t.ownLaneUri=a),void 0!==u&&(t.ownPrio=u),void 0!==h&&(t.ownRate=h),void 0!==l&&(t.ownBody=l),t},"function"==typeof s?(c.prototype.initHostUri=s,s=void 0):void 0!==s&&(s=vo.fromAny(s)),"function"==typeof o?(c.prototype.initNodeUri=o,o=void 0):void 0!==o&&(o=vo.fromAny(o)),"function"==typeof a?(c.prototype.initLaneUri=a,a=void 0):void 0!==a&&(a=vo.fromAny(a)),"function"==typeof u&&(c.prototype.initPrio=u,u=void 0),"function"==typeof h&&(c.prototype.initRate=h,h=void 0),"function"==typeof l?(c.prototype.initBody=l,l=void 0):void 0!==l&&(l=xr.fromAny(l)),c},t.ConsumingFlag=1<<e.FlagShift+0,t.PendingFlag=1<<e.FlagShift+1,t.RelinkMask=t.ConsumingFlag|t.PendingFlag,t.FlagShift=e.FlagShift+2,t.FlagMask=(1<<t.FlagShift)-1,t}(gt),ec=function(e){const t=e.extend("EventDownlinkFastener");return t.prototype.createDownlink=function(e){return e.downlink()},t.construct=function(t,r,i){return r=e.construct(t,r,i)},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits;let s=t.hostUri,o=t.nodeUri,a=t.laneUri,u=t.prio,h=t.rate,l=t.body;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,delete t.hostUri,delete t.nodeUri,delete t.laneUri,delete t.prio,delete t.rate,delete t.body,null==r&&(r=this);const c=r.extend(e,t);return c.construct=function(e,t,c){return t=r.construct(e,t,c),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),void 0!==s&&(t.ownHostUri=s),void 0!==o&&(t.ownNodeUri=o),void 0!==a&&(t.ownLaneUri=a),void 0!==u&&(t.ownPrio=u),void 0!==h&&(t.ownRate=h),void 0!==l&&(t.ownBody=l),t},"function"==typeof s?(c.prototype.initHostUri=s,s=void 0):void 0!==s&&(s=vo.fromAny(s)),"function"==typeof o?(c.prototype.initNodeUri=o,o=void 0):void 0!==o&&(o=vo.fromAny(o)),"function"==typeof a?(c.prototype.initLaneUri=a,a=void 0):void 0!==a&&(a=vo.fromAny(a)),"function"==typeof u&&(c.prototype.initPrio=u,u=void 0),"function"==typeof h&&(c.prototype.initRate=h,h=void 0),"function"==typeof l?(c.prototype.initBody=l,l=void 0):void 0!==l&&(l=xr.fromAny(l)),c},t}(Jl),tc=function(e){const t=e.extend("ListDownlinkFastener");return t.prototype.valueForm=function(e){return void 0===e?this.ownValueForm:(this.ownValueForm!==e&&(this.ownValueForm=e,this.relink()),this)},Object.defineProperty(t.prototype,"length",{get:function(){const e=this.downlink;return null!==e?e.length:0},configurable:!0}),t.prototype.isEmpty=function(){const e=this.downlink;return null===e||e.isEmpty()},t.prototype.get=function(e,t){const r=this.downlink;return null!==r?r.get(e,t):void 0},t.prototype.getEntry=function(e,t){const r=this.downlink;return null!==r?r.getEntry(e,t):void 0},t.prototype.set=function(e,t,r){const i=this.downlink;return null!=i&&i.set(e,t,r),this},t.prototype.insert=function(e,t,r){const i=this.downlink;return null!=i&&i.insert(e,t,r),this},t.prototype.remove=function(e,t){const r=this.downlink;return null!=r&&r.remove(e,t),this},t.prototype.push=function(...e){const t=this.downlink;return null!==t?t.push(...e):0},t.prototype.pop=function(){const e=this.downlink;return null!==e?e.pop():void 0},t.prototype.unshift=function(...e){const t=this.downlink;return null!==t?t.unshift(...e):0},t.prototype.shift=function(){const e=this.downlink;return null!==e?e.shift():void 0},t.prototype.move=function(e,t,r){const i=this.downlink;return null!=i&&i.move(e,t,r),this},t.prototype.splice=function(e,t,...r){const i=this.downlink;return null!==i?i.splice(e,t,...r):[]},t.prototype.clear=function(){const e=this.downlink;null!=e&&e.clear()},t.prototype.forEach=function(e,t){const r=this.downlink;return null!==r?r.forEach(e,t):void 0},t.prototype.values=function(){const e=this.downlink;return null!==e?e.values():Z.empty()},t.prototype.keys=function(){const e=this.downlink;return null!==e?e.keys():Z.empty()},t.prototype.entries=function(){const e=this.downlink;return null!==e?e.entries():Z.empty()},t.prototype.createDownlink=function(e){let t=e.downlinkList();return null!==this.ownValueForm&&(t=t.valueForm(this.ownValueForm)),t},t.construct=function(t,r,i){return null===r&&(r=function(e,t){return 0===arguments.length?r.get(e):(r.set(e,t),r.owner)},delete r.name,Object.setPrototypeOf(r,t.prototype)),(r=e.construct(t,r,i)).ownValueForm=null,r},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits,s=t.valueForm;let o=t.hostUri,a=t.nodeUri,u=t.laneUri,h=t.prio,l=t.rate,c=t.body;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,delete t.valueForm,delete t.hostUri,delete t.nodeUri,delete t.laneUri,delete t.prio,delete t.rate,delete t.body,null==r&&(r=this);const d=r.extend(e,t);return d.construct=function(e,t,d){return t=r.construct(e,t,d),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),void 0!==o&&(t.ownHostUri=o),void 0!==a&&(t.ownNodeUri=a),void 0!==u&&(t.ownLaneUri=u),void 0!==h&&(t.ownPrio=h),void 0!==l&&(t.ownRate=l),void 0!==c&&(t.ownBody=c),void 0!==s&&(t.ownValueForm=s),t},"function"==typeof o?(d.prototype.initHostUri=o,o=void 0):void 0!==o&&(o=vo.fromAny(o)),"function"==typeof a?(d.prototype.initNodeUri=a,a=void 0):void 0!==a&&(a=vo.fromAny(a)),"function"==typeof u?(d.prototype.initLaneUri=u,u=void 0):void 0!==u&&(u=vo.fromAny(u)),"function"==typeof h&&(d.prototype.initPrio=h,h=void 0),"function"==typeof l&&(d.prototype.initRate=l,l=void 0),"function"==typeof c?(d.prototype.initBody=c,c=void 0):void 0!==c&&(c=xr.fromAny(c)),d},t}(Jl),rc=function(e){const t=e.extend("MapDownlinkFastener");return t.prototype.keyForm=function(e){return void 0===e?this.ownKeyForm:(this.ownKeyForm!==e&&(this.ownKeyForm=e,this.relink()),this)},t.prototype.valueForm=function(e){return void 0===e?this.ownValueForm:(this.ownValueForm!==e&&(this.ownValueForm=e,this.relink()),this)},Object.defineProperty(t.prototype,"size",{get:function(){const e=this.downlink;return null!==e?e.size:0},configurable:!0}),t.prototype.isEmpty=function(){const e=this.downlink;return null===e||e.isEmpty()},t.prototype.has=function(e){const t=this.downlink;return null!==t&&t.has(e)},t.prototype.get=function(e){const t=this.downlink;let r;return null!==t&&(r=t.get(e)),void 0===r&&null!==this.ownValueForm&&(r=this.ownValueForm.unit),r},t.prototype.getEntry=function(e){const t=this.downlink;return null!==t?t.getEntry(e):void 0},t.prototype.firstKey=function(){const e=this.downlink;return null!==e?e.firstKey():void 0},t.prototype.firstValue=function(){const e=this.downlink;return null!==e?e.firstValue():void 0},t.prototype.firstEntry=function(){const e=this.downlink;return null!==e?e.firstEntry():void 0},t.prototype.lastKey=function(){const e=this.downlink;return null!==e?e.lastKey():void 0},t.prototype.lastValue=function(){const e=this.downlink;return null!==e?e.lastValue():void 0},t.prototype.lastEntry=function(){const e=this.downlink;return null!==e?e.lastEntry():void 0},t.prototype.nextKey=function(e){const t=this.downlink;return null!==t?t.nextKey(e):void 0},t.prototype.nextValue=function(e){const t=this.downlink;return null!==t?t.nextValue(e):void 0},t.prototype.nextEntry=function(e){const t=this.downlink;return null!==t?t.nextEntry(e):void 0},t.prototype.previousKey=function(e){const t=this.downlink;return null!==t?t.previousKey(e):void 0},t.prototype.previousValue=function(e){const t=this.downlink;return null!==t?t.previousValue(e):void 0},t.prototype.previousEntry=function(e){const t=this.downlink;return null!==t?t.previousEntry(e):void 0},t.prototype.set=function(e,t){const r=this.downlink;return null!==r&&r.set(e,t),this},t.prototype.delete=function(e){const t=this.downlink;return null!==t&&t.delete(e)},t.prototype.drop=function(e){const t=this.downlink;return null!==t&&t.drop(e),this},t.prototype.take=function(e){const t=this.downlink;return null!==t&&t.take(e),this},t.prototype.clear=function(){const e=this.downlink;null!==e&&e.clear()},t.prototype.forEach=function(e,t){const r=this.downlink;return null!==r?r.forEach(e,t):void 0},t.prototype.keys=function(){const e=this.downlink;return null!==e?e.keys():Z.empty()},t.prototype.values=function(){const e=this.downlink;return null!==e?e.values():Z.empty()},t.prototype.entries=function(){const e=this.downlink;return null!==e?e.entries():Z.empty()},t.prototype.createDownlink=function(e){let t=e.downlinkMap();return null!==this.ownKeyForm&&(t=t.keyForm(this.ownKeyForm)),null!==this.ownValueForm&&(t=t.valueForm(this.ownValueForm)),t},t.construct=function(t,r,i){return null===r&&(r=function(e,t){return 1===arguments.length?r.get(e):(r.set(e,t),r.owner)},delete r.name,Object.setPrototypeOf(r,t.prototype)),(r=e.construct(t,r,i)).ownKeyForm=null,r.ownValueForm=null,r},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits,s=t.keyForm,o=t.valueForm;let a=t.hostUri,u=t.nodeUri,h=t.laneUri,l=t.prio,c=t.rate,d=t.body;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,delete t.keyForm,delete t.valueForm,delete t.hostUri,delete t.nodeUri,delete t.laneUri,delete t.prio,delete t.rate,delete t.body,null==r&&(r=this);const p=r.extend(e,t);return p.construct=function(e,t,p){return t=r.construct(e,t,p),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),void 0!==a&&(t.ownHostUri=a),void 0!==u&&(t.ownNodeUri=u),void 0!==h&&(t.ownLaneUri=h),void 0!==l&&(t.ownPrio=l),void 0!==c&&(t.ownRate=c),void 0!==d&&(t.ownBody=d),void 0!==s&&(t.ownKeyForm=s),void 0!==o&&(t.ownValueForm=o),t},"function"==typeof a?(p.prototype.initHostUri=a,a=void 0):void 0!==a&&(a=vo.fromAny(a)),"function"==typeof u?(p.prototype.initNodeUri=u,u=void 0):void 0!==u&&(u=vo.fromAny(u)),"function"==typeof h?(p.prototype.initLaneUri=h,h=void 0):void 0!==h&&(h=vo.fromAny(h)),"function"==typeof l&&(p.prototype.initPrio=l,l=void 0),"function"==typeof c&&(p.prototype.initRate=c,c=void 0),"function"==typeof d?(p.prototype.initBody=d,d=void 0):void 0!==d&&(d=xr.fromAny(d)),p},t}(Jl),ic=function(e){const t=e.extend("ValueDownlinkFastener");return t.prototype.valueForm=function(e){return void 0===e?this.ownValueForm:(this.ownValueForm!==e&&(this.ownValueForm=e,this.relink()),this)},t.prototype.get=function(){const e=this.downlink;return null!==e?e.get():void 0},t.prototype.set=function(e){const t=this.downlink;null!==t&&t.set(e)},t.prototype.createDownlink=function(e){let t=e.downlinkValue();return null!==this.ownValueForm&&(t=t.valueForm(this.ownValueForm)),t},t.construct=function(t,r,i){return null===r&&(r=function(e){return 0===arguments.length?r.get():(r.set(e),r.owner)},delete r.name,Object.setPrototypeOf(r,t.prototype)),(r=e.construct(t,r,i)).ownValueForm=null,r},t.define=function(e,t){let r=t.extends;const i=t.affinity,n=t.inherits,s=t.valueForm;let o=t.hostUri,a=t.nodeUri,u=t.laneUri,h=t.prio,l=t.rate,c=t.body;delete t.extends,delete t.implements,delete t.affinity,delete t.inherits,delete t.valueForm,delete t.hostUri,delete t.nodeUri,delete t.laneUri,delete t.prio,delete t.rate,delete t.body,null==r&&(r=this);const d=r.extend(e,t);return d.construct=function(e,t,d){return t=r.construct(e,t,d),void 0!==i&&t.initAffinity(i),void 0!==n&&t.initInherits(n),void 0!==o&&(t.ownHostUri=o),void 0!==a&&(t.ownNodeUri=a),void 0!==u&&(t.ownLaneUri=u),void 0!==h&&(t.ownPrio=h),void 0!==l&&(t.ownRate=l),void 0!==c&&(t.ownBody=c),void 0!==s&&(t.ownValueForm=s),t},"function"==typeof o?(d.prototype.initHostUri=o,o=void 0):void 0!==o&&(o=vo.fromAny(o)),"function"==typeof a?(d.prototype.initNodeUri=a,a=void 0):void 0!==a&&(a=vo.fromAny(a)),"function"==typeof u?(d.prototype.initLaneUri=u,u=void 0):void 0!==u&&(u=vo.fromAny(u)),"function"==typeof h&&(d.prototype.initPrio=h,h=void 0),"function"==typeof l&&(d.prototype.initRate=l,l=void 0),"function"==typeof c?(d.prototype.initBody=c,c=void 0):void 0!==c&&(c=xr.fromAny(c)),d},t}(Jl);e.Absent=Nr,e.AbstractInlet=Ji,e.AbstractInoutlet=tn,e.AbstractMapInlet=nn,e.AbstractMapInletMapOutlet=un,e.AbstractMapInletOutlet=an,e.AbstractMapInoutlet=on,e.AbstractMapOutlet=sn,e.AbstractOutlet=en,e.AbstractRecordOutlet=Nn,e.AbstractRecordStreamlet=Un,e.AbstractStreamlet=Mn,e.AffineTransform=uu,e.AffineTransformInterpolator=hu,e.AffineTransformParser=lu,e.Affinity=yt,e.AndOperator=Yr,e.AndOutlet=Gn,e.Angle=la,e.AngleForm=ya,e.AngleInterpolator=ma,e.AngleParser=wa,e.Animator=St,e.AnyForm=Ui,e.ArrayInterpolator=V,e.Arrays=x,e.AssertException=ne,e.Attr=gr,e.AttrInterpolator=vr,e.AuthRequest=dl,e.AuthedResponse=pl,e.BTree=Ut,e.BTreeContext=zt,e.BTreeLeaf=jt,e.BTreeNode=Lt,e.BTreeNodeCursor=Bt,e.BTreePage=Rt,e.Base10=Ee,e.Base10IntegerWriter=at,e.Base10NumberParser=st,e.Base16=tt,e.Base16IntegerWriter=lt,e.Base16Parser=ut,e.Base16Writer=ht,e.Base64=ct,e.Base64Parser=ft,e.Base64Writer=mt,e.BaseRef=Nl,e.Binary=Qe,e.BinaryOperator=Rr,e.BinaryOperatorInterpolator=jr,e.BinaryOutlet=Wn,e.BitwiseAndOperator=$r,e.BitwiseAndOutlet=Qn,e.BitwiseNotOperator=ci,e.BitwiseNotOutlet=ls,e.BitwiseOrOperator=Zr,e.BitwiseOrOutlet=Yn,e.BitwiseXorOperator=Qr,e.BitwiseXorOutlet=Zn,e.Bool=qr,e.BooleanAnimator=At,e.BooleanForm=zi,e.BooleanProperty=Ct,e.Booleans=h,e.BridgeFunc=Pi,e.ByteOrder=s,e.ByteOutput=Ge,e.ByteOutputBuffer=Ze,e.ByteOutputUint8Array=Ye,e.ChildrenSelector=Si,e.CloseSignal=_h,e.ClosedSignal=Gh,e.CommandMessage=sl,e.Compare=g,e.Component=Tt,e.ComponentRef=Mt,e.ComponentRelation=It,e.ComponentSet=Vt,e.ConditionalOperator=Kr,e.ConditionalOperatorInterpolator=Wr,e.ConditionalOutlet=Xn,e.ConnectSignal=Yh,e.ConnectedSignal=Zh,e.Constraint=lr,e.ConstraintAnimator=ur,e.ConstraintConstant=or,e.ConstraintDummy=Jt,e.ConstraintError=er,e.ConstraintExpression=rr,e.ConstraintGroup=class{constructor(e){this.scope=e,this.constraints=[],this.constrained=!1}constraint(e,t,r,i){e=rr.fromAny(e),void 0!==r&&(r=rr.fromAny(r));const n=void 0!==r?e.minus(r):e;i=void 0===i?hr.Required:hr.fromAny(i);const s=new lr(this.scope,n,t,i);return this.addConstraint(s),s}hasConstraint(e){return this.constraints.indexOf(e)>=0}addConstraint(e){const t=this.constraints;t.indexOf(e)<0&&(t.push(e),e.constrain(this.constrained))}removeConstraint(e){const t=this.constraints;if(void 0!==t){const r=t.indexOf(e);r>=0&&(t.splice(r,1),e.constrain(!1))}}enableConstraints(){const e=this.constraints;for(let t=0,r=e.length;t<r;t+=1)e[t].constrain(!0)}disableConstraints(){const e=this.constraints;for(let t=0,r=e.length;t<r;t+=1)e[t].constrain(!1)}isConstrained(){return this.constrained}constrain(e=!0){return e&&!this.constrained?(this.constrained=!0,this.enableConstraints()):!e&&this.constrained&&(this.constrained=!1,this.disableConstraints()),this}},e.ConstraintId=Yt,e.ConstraintInvalid=tr,e.ConstraintMap=Zt,e.ConstraintProduct=sr,e.ConstraintProperty=ar,e.ConstraintRow=dr,e.ConstraintScope=cr,e.ConstraintSlack=$t,e.ConstraintSolver=class{constructor(){this.constraints=new Zt,this.constraintVariables=new Zt,this.rows=new Zt,this.infeasible=[],this.objective=new dr(this,null,new Zt,0),this.artificial=null,this.invalidated=new Zt}constraint(e,t,r,i){e=rr.fromAny(e),void 0!==r&&(r=rr.fromAny(r));const n=void 0!==r?e.minus(r):e;i=void 0===i?hr.Required:hr.fromAny(i);const s=new lr(this,n,t,i);return this.addConstraint(s),s}hasConstraint(e){return this.constraints.has(e)}addConstraint(e){if(this.constraints.has(e))return;const t=e.expression.terms;for(let r=0,i=t.size;r<i;r+=1){t.getEntry(r)[0].addConstraintCondition(e,this)}const{row:r,tag:i}=this.createRow(e);this.addConstraintRow(e,r,i)}addConstraintRow(e,t,r){this.willAddConstraint(e);let i=this.chooseSubject(t,r);if(i.isInvalid()&&t.isDummy()){if(!(Math.abs(t.constant)<l.Epsilon))throw new Error("unsatisfiable constraint");i=r.marker}if(i.isInvalid()){if(!this.addWithArtificialVariable(t))throw new Error("unsatisfiable constraint")}else t.setSymbol(i),t.solveFor(i),this.substitute(i,t),this.rows.set(i,t);this.constraints.set(e,r),this.optimize(this.objective),this.didAddConstraint(e),this.updateSolution()}willAddConstraint(e){}didAddConstraint(e){}removeConstraint(e){if(void 0===this.constraints.get(e))return;this.removeConstraintRow(e);const t=e.expression.terms;for(let r=0,i=t.size;r<i;r+=1){t.getEntry(r)[0].removeConstraintCondition(e,this)}}removeConstraintRow(e){const t=this.constraints.get(e);if(void 0===t)return;this.willRemoveConstraint(e),this.constraints.remove(e),this.removeConstraintEffects(e,t);const r=t.marker;if(void 0===this.rows.remove(r)){const e=this.getMarkerLeavingSymbol(r);if(e.isInvalid())throw new Error("failed to find leaving row");const t=this.rows.remove(e);t.solveForEx(e,r),this.substitute(r,t)}this.optimize(this.objective),this.didRemoveConstraint(e),this.updateSolution()}willRemoveConstraint(e){}didRemoveConstraint(e){}constraintVariable(e,t,r){void 0===t&&(t=0),r=void 0!==r?hr.fromAny(r):hr.Strong;const i=ar.create(this);return Object.defineProperty(i,"name",{value:e,configurable:!0}),void 0!==t&&i.setValue(t),i.setStrength(r),i.mount(),i}hasConstraintVariable(e){return this.constraintVariables.has(e)}addConstraintVariable(e){if(this.constraintVariables.has(e))return;const t=hr.clip(e.strength);if(t===hr.Required)throw new Error("invalid variable strength");this.willAddConstraintVariable(e);const r=new lr(this,e,"eq",t),{row:i,tag:n}=this.createRow(r);this.constraintVariables.set(e,{constraint:r,tag:n,state:0}),this.addConstraintRow(r,i,n),this.didAddConstraintVariable(e)}willAddConstraintVariable(e){}didAddConstraintVariable(e){}removeConstraintVariable(e){const t=this.constraintVariables.get(e);void 0!==t&&(this.willRemoveConstraintVariable(e),this.constraintVariables.remove(e),this.removeConstraintRow(t.constraint),this.didRemoveConstraintVariable(e))}willRemoveConstraintVariable(e){}didRemoveConstraintVariable(e){}setConstraintVariable(e,t){const r=this.constraintVariables.get(e);if(void 0===r)throw new Error("unbound variable");const i=r.state;if(i!==t){r.state=t;const n=t-i;this.willSetConstraintVariable(e,t,i);const s=r.tag.marker;let o=this.rows.get(s);if(void 0!==o)return o.add(-n)<0&&this.infeasible.push(s),void this.dualOptimize();const a=r.tag.other;if(o=this.rows.get(a),void 0!==o)return o.add(n)<0&&this.infeasible.push(a),void this.dualOptimize();for(let e=0,t=this.rows.size;e<t;e+=1){const[t,r]=this.rows.getEntry(e),i=r.coefficientFor(s);0!==i&&r.add(n*i)<0&&!t.isExternal()&&this.infeasible.push(t)}this.dualOptimize(),this.didSetConstraintVariable(e,t,i),this.updateSolution()}}willSetConstraintVariable(e,t,r){}didSetConstraintVariable(e,t,r){}invalidate(e,t=null){e.isExternal()&&this.invalidated.set(e,t)}updateSolution(){const e=this.invalidated;if(!e.isEmpty()){this.invalidated=new Zt;for(let t=0,r=e.size;t<r;t+=1){const r=e.getEntry(t)[0],i=this.rows.get(r);void 0!==i&&r.updateConstraintSolution(i.constant)}}}createRow(e){const t=e.expression,r=new dr(this,null,new Zt,t.constant),i=t.terms;for(let e=0,t=i.size;e<t;e+=1){const[t,n]=i.getEntry(e);if(Math.abs(n)>=l.Epsilon){const e=this.rows.get(t);void 0!==e?r.insertRow(e,n):r.insertSymbol(t,n)}}const n=this.objective,s=e.relation,o=e.strength,a={marker:Qt.invalid,other:Qt.invalid};if("le"===s||"ge"===s){const e="le"===s?1:-1,t=new $t;if(a.marker=t,r.insertSymbol(t,e),o<hr.Required){const t=new er;a.other=t,r.insertSymbol(t,-e),n.insertSymbol(t,o)}}else if(o<hr.Required){const e=new er,t=new er;a.marker=e,a.other=t,r.insertSymbol(e,-1),r.insertSymbol(t,1),n.insertSymbol(e,o),n.insertSymbol(t,o)}else{const e=new Jt;a.marker=e,r.insertSymbol(e)}return r.constant<0&&r.negate(),{row:r,tag:a}}chooseSubject(e,t){for(let t=0,r=e.cells.size;t<r;t+=1){const r=e.cells.getEntry(t)[0];if(r.isExternal())return r}return(t.marker instanceof $t||t.marker instanceof er)&&e.coefficientFor(t.marker)<0?t.marker:(t.other instanceof $t||t.other instanceof er)&&e.coefficientFor(t.other)<0?t.other:Qt.invalid}addWithArtificialVariable(e){const t=new $t;this.rows.set(t,e.clone()),this.artificial=e.clone(),this.optimize(this.artificial);const r=Math.abs(this.artificial.constant)<l.Epsilon;this.artificial=null;const i=this.rows.remove(t);if(void 0!==i){if(i.isConstant())return r;const e=this.anyPivotableSymbol(i);if(e.isInvalid())return!1;i.setSymbol(e),i.solveForEx(t,e),this.substitute(e,i),this.rows.set(e,i)}for(let e=0,r=this.rows.size;e<r;e+=1)this.rows.getEntry(e)[1].removeSymbol(t);return this.objective.removeSymbol(t),r}substitute(e,t){for(let r=0,i=this.rows.size;r<i;r+=1){const[i,n]=this.rows.getEntry(r);n.substitute(e,t),n.constant<0&&!i.isExternal()&&this.infeasible.push(i)}this.objective.substitute(e,t),null!==this.artificial&&this.artificial.substitute(e,t)}optimize(e){for(;;){const t=this.getEnteringSymbol(e);if(t.isInvalid())return;const r=this.getLeavingSymbol(t);if(r.isInvalid())throw new Error("objective is unbounded");const i=this.rows.remove(r);i.setSymbol(t),i.solveForEx(r,t),this.substitute(t,i),this.rows.set(t,i)}}dualOptimize(){let e;for(;e=this.infeasible.pop(),void 0!==e;){const t=this.rows.get(e);if(void 0!==t&&t.constant<0){const r=this.getDualEnteringSymbol(t);if(r.isInvalid())throw new Error("dual optimize failed");this.rows.remove(e),t.setSymbol(r),t.solveForEx(e,r),this.substitute(r,t),this.rows.set(r,t)}}}getEnteringSymbol(e){for(let t=0,r=e.cells.size;t<r;t+=1){const[r,i]=e.cells.getEntry(t);if(i<0&&!r.isDummy())return r}return Qt.invalid}getDualEnteringSymbol(e){let t=Number.MAX_VALUE,r=Qt.invalid;for(let i=0,n=e.cells.size;i<n;i+=1){const[n,s]=e.cells.getEntry(i);if(s>0&&!n.isDummy()){const e=this.objective.coefficientFor(n)/s;e<t&&(t=e,r=n)}}return r}getLeavingSymbol(e){let t=Number.MAX_VALUE,r=Qt.invalid;for(let i=0,n=this.rows.size;i<n;i+=1){const[n,s]=this.rows.getEntry(i);if(!n.isExternal()){const i=s.coefficientFor(e);if(i<0){const e=-s.constant/i;e<t&&(t=e,r=n)}}}return r}getMarkerLeavingSymbol(e){let t=Number.MAX_VALUE,r=Number.MAX_VALUE,i=Qt.invalid,n=Qt.invalid,s=Qt.invalid;for(let o=0,a=this.rows.size;o<a;o+=1){const[a,u]=this.rows.getEntry(o),h=u.coefficientFor(e);if(0!==h)if(a.isExternal())s=a;else if(h<0){const e=-u.constant/h;e<t&&(t=e,i=a)}else{const e=u.constant/h;e<r&&(r=e,n=a)}}return i.isInvalid()?n.isInvalid()?s:n:i}removeConstraintEffects(e,t){t.marker instanceof er&&this.removeMarkerEffects(t.marker,e.strength),t.other instanceof er&&this.removeMarkerEffects(t.other,e.strength)}removeMarkerEffects(e,t){const r=this.rows.get(e);void 0!==r?this.objective.insertRow(r,-t):this.objective.insertSymbol(e,-t)}anyPivotableSymbol(e){for(let t=0,r=e.cells.size;t<r;t+=1){const r=e.cells.getEntry(t)[0];if(r instanceof $t||r instanceof er)return r}return Qt.invalid}},e.ConstraintStrength=hr,e.ConstraintSum=ir,e.ConstraintSymbol=Qt,e.ConstraintTerm=nr,e.Constructors=m,e.Consumable=Y,e.ContinuousScale=K,e.Creatable=X,e.Cursor=Z,e.CursorArray=J,e.CursorEmpty=Q,e.CursorUnary=$,e.Data=Dr,e.DataOutput=Pr,e.Dataflow=fs,e.DateTime=Bu,e.DateTimeForm=Wu,e.DateTimeFormat=Gu,e.DateTimeInterpolator=Ku,e.DateTimeLocale=Xu,e.DateTimeParser=Hu,e.DateTimeSpecifiers=_u,e.DayInterval=Th,e.DayOfMonthFormat=Ju,e.DayOfMonthParser=ph,e.DeauthRequest=fl,e.DeauthedResponse=ml,e.DegAngle=ca,e.DescendantsSelector=Oi,e.Diagnostic=Ae,e.DisconnectSignal=Qh,e.DisconnectedSignal=$h,e.DivideOperator=ui,e.DivideOutlet=as,e.Domain=E,e.Downlink=Cl,e.DownlinkFastener=Jl,e.DownlinkModel=bl,e.DownlinkRecord=Ml,e.DownlinkReifier=ql,e.DownlinkStreamlet=Fl,e.Easing=N,e.EmLength=ia,e.Envelope=el,e.EqOperator=ti,e.EqOutlet=es,e.Equals=y,e.Equivalent=l,e.ErrorSignal=Jh,e.EventDownlink=El,e.EventDownlinkFastener=ec,e.EventDownlinkModel=Ol,e.EventMessage=nl,e.Expression=zr,e.Extant=Fr,e.Fastener=gt,e.FastenerContext=wt,e.Field=mr,e.FieldInterpolator=wr,e.FilterFieldsCombinator=mn,e.FilterFieldsOperator=fn,e.FilterSelector=Ei,e.FilterTimeInterval=Eh,e.Form=Mi,e.FormException=Ii,e.Format=Oe,e.FromAny=C,e.Func=ki,e.Functions=f,e.GeOperator=ii,e.GeOutlet=rs,e.GeoBox=Eu,e.GeoBoxInterpolator=ku,e.GeoCurve=gu,e.GeoGroup=Du,e.GeoJson=Pu,e.GeoJsonFeature=Uu,e.GeoJsonFeatureCollection=Ru,e.GeoJsonGeometry=Tu,e.GeoJsonGeometryCollection=zu,e.GeoJsonLineString=Vu,e.GeoJsonMultiLineString=qu,e.GeoJsonMultiPoint=Mu,e.GeoJsonMultiPolygon=Nu,e.GeoJsonPoint=Iu,e.GeoJsonPolygon=Fu,e.GeoPath=Su,e.GeoPathBuilder=Ou,e.GeoPoint=yu,e.GeoPointInterpolator=wu,e.GeoProjection=fu,e.GeoSegment=vu,e.GeoSegmentInterpolator=bu,e.GeoShape=mu,e.GeoSpline=xu,e.GeoSplineBuilder=Cu,e.GeoTile=Au,e.GetAttrSelector=vi,e.GetItemSelector=bi,e.GetOutlet=Kn,e.GetSelector=gi,e.GradAngle=pa,e.GtOperator=ni,e.GtOutlet=is,e.HashCode=w,e.HashGenCacheMap=ee,e.HashGenCacheMapBucket=te,e.HashGenCacheSet=re,e.HashGenCacheSetBucket=ie,e.Host=yl,e.HostAddressed=tl,e.HostRef=Rl,e.Hour12Format=ih,e.Hour12Parser=wh,e.Hour24Format=rh,e.Hour24Parser=yh,e.HourInterval=Ih,e.Identifiers=p,e.Identity=u,e.IdentityInterpolator=T,e.IdentitySelector=wi,e.IdentityTransform=Ya,e.In=function(e,t){if(1===arguments.length)return"string"==typeof e&&(e={name:e}),Mn.decorateInlet.bind(void 0,e);Mn.decorateInlet({},e,t)},e.Initable=_,e.Inlet=Ki,e.InletDescriptor=Pn,e.Inout=qn,e.InoutletDescriptor=In,e.Input=fe,e.InputBuffer=Pe,e.InputBufferDone=Ie,e.InputBufferEmpty=Te,e.InputBufferError=Me,e.InputDone=De,e.InputEmpty=ke,e.InputError=me,e.InputException=de,e.InputSettings=pe,e.Interpolate=k,e.Interpolator=D,e.InterpolatorInterpolator=q,e.InterpolatorMap=P,e.Interpreter=_r,e.InterpreterException=Hr,e.InterpreterSettings=Xr,e.InvokeOperator=fi,e.InvokeOperatorInterpolator=mi,e.InvokeOutlet=ps,e.Item=pr,e.ItemForm=Ri,e.ItemInterpolator=fr,e.KeyOutlet=rn,e.KeysCursor=qt,e.KeysSelector=xi,e.LambdaFunc=Di,e.LaneAddressed=rl,e.LaneRef=zl,e.Lazy=a,e.LeOperator=ei,e.LeOutlet=Jn,e.Length=ta,e.LengthException=ea,e.LengthForm=ua,e.LengthInterpolator=aa,e.LengthParser=ha,e.LinearDomain=U,e.LinearDomainInterpolator=R,e.LinearRange=j,e.LinearRangeInterpolator=L,e.LinearScale=W,e.LinearScaleInterpolator=H,e.LinkAddressed=il,e.LinkRequest=ol,e.LinkedResponse=al,e.ListDownlink=kl,e.ListDownlinkFastener=tc,e.ListDownlinkModel=Al,e.ListDownlinkRecord=class extends Ml{constructor(e){super(),this.downlink=e}isEmpty(){return this.downlink.isEmpty()}isArray(){return!0}isObject(){return this.downlink.isEmpty()}get length(){return this.downlink.length}has(e){return!1}get(e){return void 0===e?this:xr.absent()}getAttr(e){return xr.absent()}getSlot(e){return xr.absent()}getItem(e){e instanceof Mr&&(e=e.value);const t=this.downlink.length;return e<0&&(e=t+e),(e=Math.min(Math.max(0,e),t-1))>=0?this.downlink.get(e):pr.absent()}set(e,t){throw new Error("unsupported")}setAttr(e,t){throw new Error("unsupported")}setSlot(e,t){throw new Error("unsupported")}setItem(e,t){e instanceof Mr&&(e=e.value);const r=this.downlink.length;return e<0&&(e=r+e),(e=Math.min(Math.max(0,e),r-1))>=0&&this.downlink.set(e,xr.fromAny(t)),this}push(...e){return this.downlink.push(...e)}splice(e,t,...r){return this.downlink.splice(e,t,...r)}delete(e){return pr.absent()}clear(){this.downlink.clear()}forEach(e,t){return this.downlink.forEach(e,t)}keyIterator(){return Z.empty()}},e.LiteralSelector=Ai,e.LtOperator=Jr,e.LtOutlet=$n,e.MapDownlink=Pl,e.MapDownlinkFastener=rc,e.MapDownlinkModel=Dl,e.MapDownlinkRecord=Vl,e.MapFieldValuesCombinator=vn,e.MapFieldValuesOperator=gn,e.MapInlet=_i,e.MapInput=class extends sn{constructor(e){super(),void 0===e&&(e=new Ut),this.state=e;let t=this.effects;e.forEach((function(e){t=t.updated(e,0)}),this),this.effects=t}has(e){return this.state.has(e)}get(e){return void 0===e?this.state:this.state.get(e)}set(e,t){const r=this.state,i=r.get(e);return i!==t&&(this.state=r.updated(e,t),this.decohereInputKey(e,0)),i}delete(e){const t=this.state,r=t.removed(e);return t!==r&&(this.state=r,this.decohereInputKey(e,1)),this}keyIterator(){return this.state.keys()}},e.MapOutlet=Gi,e.MapOutletCombinators=Yi,e.MapOutput=class extends nn{constructor(){super(),this.state=new Ut}get(){return this.state}onRecohereOutputKey(e,t,r){if(0===t){const t=this.input;if(null!==t){const r=t.get(e);this.state=void 0!==r?this.state.updated(e,r):this.state.removed(e)}}else 1===t&&(this.state=this.state.removed(e))}},e.MapValueCombinator=wn,e.MapValueOperator=yn,e.Mapping=O,e.Mark=ue,e.MathModule=Ti,e.MemoizeMapCombinator=pn,e.MemoizeValueCombinator=dn,e.Message=Bh,e.MillisecondFormat=ah,e.MillisecondInterval=qh,e.MillisecondParser=xh,e.MillisecondsInterval=Fh,e.MinusOperator=oi,e.MinusOutlet=ss,e.MinuteFormat=sh,e.MinuteInterval=Mh,e.MinuteParser=vh,e.ModuloOperator=hi,e.ModuloOutlet=us,e.MonthFormat=Qu,e.MonthInterval=Dh,e.MonthOfYearFormat=Zu,e.MonthOfYearParser=lh,e.MonthParser=ch,e.Murmur3=o,e.NeOperator=ri,e.NeOutlet=ts,e.NegativeOperator=di,e.NegativeOutlet=cs,e.NodeCursor=Nt,e.NodeRef=Ul,e.NotOperator=li,e.NotOutlet=hs,e.Num=Mr,e.NumInterpolator=Vr,e.NumberAnimator=Et,e.NumberForm=Ni,e.NumberInterpolator=M,e.NumberProperty=xt,e.Numbers=c,e.Objects=v,e.Observable=G,e.OpenSignal=Hh,e.OpenedSignal=Xh,e.Operator=Ur,e.OrOperator=Gr,e.OrOutlet=_n,e.Out=Vn,e.Outlet=Wi,e.OutletCombinators=Hi,e.OutletDescriptor=Tn,e.OutletInlet=hn,e.OutletMapInlet=ln,e.Output=ge,e.OutputBuffer=Ne,e.OutputBufferDone=Ue,e.OutputBufferError=Re,e.OutputBufferFull=ze,e.OutputDone=qe,e.OutputError=Fe,e.OutputException=we,e.OutputFull=Ve,e.OutputSettings=ce,e.OutputStyle=le,e.Parser=Le,e.ParserDone=Be,e.ParserError=Ke,e.ParserException=je,e.PatternFormat=uh,e.PatternParser=Ch,e.PctLength=sa,e.PeriodFormat=nh,e.PeriodParser=gh,e.PlusOperator=si,e.PlusOutlet=ns,e.PositiveOperator=pi,e.PositiveOutlet=ds,e.Property=vt,e.Provider=Dt,e.PxLength=ra,e.R2BezierCurve=Ea,e.R2Box=Ba,e.R2BoxInterpolator=Ka,e.R2Circle=La,e.R2CircleInterpolator=Wa,e.R2CubicCurve=Ia,e.R2CubicCurveParser=Ma,e.R2Curve=Sa,e.R2CurveParser=Oa,e.R2EllipticCurve=Va,e.R2EllipticCurveParser=qa,e.R2Group=Ha,e.R2Path=Ua,e.R2PathBuilder=Ra,e.R2PathParser=ja,e.R2Point=xa,e.R2PointInterpolator=Ca,e.R2QuadraticCurve=Pa,e.R2QuadraticCurveParser=Ta,e.R2Segment=Aa,e.R2SegmentInterpolator=ka,e.R2SegmentParser=Da,e.R2Shape=ba,e.R2Spline=Fa,e.R2SplineBuilder=Na,e.R2SplineParser=za,e.R2Vector=ga,e.R2VectorInterpolator=va,e.RadAngle=da,e.Random=n,e.Range=A,e.Recon=ms,e.ReconParser=Hs,e.ReconStructureParser=Xs,e.ReconStructureWriter=wo,e.ReconWriter=yo,e.Record=Cr,e.RecordCursor=Er,e.RecordFieldUpdater=Rn,e.RecordInterpolator=Or,e.RecordMap=Ar,e.RecordMapView=kr,e.RecordModel=jn,e.RecordOutlet=Fn,e.RecordScope=Ln,e.RecordStreamlet=zn,e.ReduceFieldsCombinator=xn,e.ReduceFieldsOperator=bn,e.Reifier=Bn,e.RemLength=na,e.RemoteHost=wl,e.RotateTransform=ru,e.RotateTransformInterpolator=iu,e.RotateTransformParser=nu,e.STree=Wt,e.STreeContext=Kt,e.STreeLeaf=Xt,e.STreeNode=_t,e.STreeNodeCursor=Gt,e.STreePage=Ht,e.Scale=B,e.ScaleTransform=Ja,e.ScaleTransformInterpolator=eu,e.ScaleTransformParser=tu,e.SecondFormat=oh,e.SecondInterval=Vh,e.SecondParser=bh,e.Selector=yi,e.Service=kt,e.Severity=oe,e.ShortMonthFormat=$u,e.ShortMonthParser=dh,e.ShortWeekdayFormat=th,e.ShortWeekdayParser=mh,e.Signal=Kh,e.SkewTransform=su,e.SkewTransformInterpolator=ou,e.SkewTransformParser=au,e.Slot=yr,e.SlotInterpolator=br,e.Span=he,e.StepInterpolator=I,e.Streamlet=$i,e.StreamletException=Zi,e.StreamletInlet=An,e.StreamletInoutlet=Dn,e.StreamletOutlet=kn,e.StreamletScope=Qi,e.StringAnimator=Ot,e.StringForm=Fi,e.StringInput=ye,e.StringOutput=ve,e.StringProperty=bt,e.StringWriter=Ce,e.Strings=d,e.SyncRequest=ul,e.SyncedResponse=hl,e.Tag=ae,e.TagForm=Vi,e.Text=Tr,e.TextOutput=Ir,e.TimeDomain=Nh,e.TimeDomainInterpolator=zh,e.TimeInterval=Sh,e.TimeRange=Uh,e.TimeRangeInterpolator=Rh,e.TimeScale=jh,e.TimeScaleInterpolator=Lh,e.TimeZone=ju,e.TimeZoneForm=Lu,e.Timer=Pt,e.TimesOperator=ai,e.TimesOutlet=os,e.Timing=F,e.ToAny=S,e.Transform=Xa,e.TransformForm=_a,e.TransformList=cu,e.TransformListInterpolator=du,e.TransformListParser=pu,e.TransformParser=Ga,e.TranslateTransform=Za,e.TranslateTransformInterpolator=Qa,e.TranslateTransformParser=$a,e.TurnAngle=fa,e.Tweening=z,e.UnaryOperator=Lr,e.UnaryOperatorInterpolator=Br,e.UnaryOutlet=Hn,e.Unicode=Se,e.UnitForm=qi,e.UnitTimeInterval=Oh,e.UnitlessLength=oa,e.UnlinkRequest=ll,e.UnlinkedResponse=cl,e.Uri=vo,e.UriAbsoluteParser=Ko,e.UriAuthority=xo,e.UriAuthorityParser=Ho,e.UriCache=Lo,e.UriException=go,e.UriForm=jo,e.UriFragment=Ro,e.UriFragmentParser=Jo,e.UriHost=So,e.UriHostAddressParser=Go,e.UriHostIPv4=Eo,e.UriHostIPv6=Ao,e.UriHostLiteralParser=Yo,e.UriHostName=Oo,e.UriHostParser=_o,e.UriHostUndefined=ko,e.UriParser=Bo,e.UriPath=Po,e.UriPathBuilder=Vo,e.UriPathEmpty=Mo,e.UriPathForm=qo,e.UriPathParser=Qo,e.UriPathSegment=To,e.UriPathSlash=Io,e.UriPort=Do,e.UriPortParser=Zo,e.UriQuery=Fo,e.UriQueryBuilder=Uo,e.UriQueryParam=No,e.UriQueryParser=$o,e.UriQueryUndefined=zo,e.UriScheme=bo,e.UriSchemeParser=Wo,e.UriUser=Co,e.UriUserParser=Xo,e.Utf8=nt,e.Utf8DecodedOutput=rt,e.Utf8EncodedOutput=it,e.UtfErrorMode=$e,e.UtfErrorModeFatal=Je,e.UtfErrorModeReplacement=et,e.Value=xr,e.ValueBuilder=Sr,e.ValueCursor=Li,e.ValueDownlink=Il,e.ValueDownlinkFastener=ic,e.ValueDownlinkModel=Tl,e.ValueDownlinkRecord=class extends Ml{constructor(e){super(),this.downlink=e,e.observe(this)}isEmpty(){const e=this.downlink.get();return e instanceof Cr?e.isEmpty():!e.isDefined()}isArray(){const e=this.downlink.get();return!(e instanceof Cr)||e.isArray()}isObject(){const e=this.downlink.get();return e instanceof Cr?e.isObject():!e.isDefined()}get length(){const e=this.downlink.get();return e instanceof Cr?e.length:e.isDefined()?1:0}has(e){const t=this.downlink.get();return t instanceof Cr&&t.has(e)}get(e){if(void 0===e)return this;{const t=this.downlink.get();return t instanceof Cr?t.get(e):xr.absent()}}getAttr(e){const t=this.downlink.get();return t instanceof Cr?t.getAttr(e):xr.absent()}getSlot(e){const t=this.downlink.get();return t instanceof Cr?t.getSlot(e):xr.absent()}getField(e){const t=this.downlink.get();return t instanceof Cr?t.getField(e):void 0}getItem(e){const t=this.downlink.get();return t instanceof Cr?t.getItem(e):t}set(e,t){const r=this.downlink.get();if(!(r instanceof Cr))throw new Error("unsupported");return r.set(e,t),this}setAttr(e,t){const r=this.downlink.get();if(!(r instanceof Cr))throw new Error("unsupported");return r.setAttr(e,t),this}setSlot(e,t){const r=this.downlink.get();if(!(r instanceof Cr))throw new Error("unsupported");return r.setSlot(e,t),this}setItem(e,t){const r=this.downlink.get();return r instanceof Cr?r.setItem(e,t):this.downlink.set(pr.fromAny(t).toValue()),this}push(...e){const t=this.downlink.get();if(t instanceof Cr)return t.push(...e);throw new Error("unsupported")}splice(e,t,...r){const i=this.downlink.get();if(i instanceof Cr)return i.splice(e,t,...r);throw new Error("unsupported")}delete(e){const t=this.downlink.get();return t instanceof Cr?t.delete(e):xr.absent()}clear(){const e=this.downlink.get();if(!(e instanceof Cr))throw new Error("unsupported");e.clear()}forEach(e,t){return this.downlink.get().forEach(e,t)}keyIterator(){if(this.downlink.get()instanceof Cr)throw new Error;return Z.empty()}didSet(e,t){this.decohereInput(),this.recohereInput(0)}},e.ValueEntryCursor=Bi,e.ValueForm=ji,e.ValueInput=cn,e.ValueOutput=class extends Ji{constructor(e){super(),this.state=e}get(){return this.state}onRecohereOutput(e){const t=this.input;null!==t&&(this.state=t.get())}},e.Values=b,e.ValuesCursor=Ft,e.ValuesSelector=Ci,e.WarpClient=jl,e.WarpProvider=$l,e.WarpService=Ql,e.WarpWorkerHost=vl,e.WatchFieldsCombinator=En,e.WatchFieldsOperator=On,e.WatchValueCombinator=Sn,e.WatchValueOperator=Cn,e.WebSocketHost=gl,e.WeekInterval=Ph,e.WeekdayFormat=eh,e.WeekdayParser=fh,e.WorkerAddressed=Wh,e.Writer=xe,e.WriterDone=He,e.WriterEnd=We,e.WriterError=Xe,e.WriterException=be,e.WriterSequence=_e,e.YearFormat=Yu,e.YearInterval=Ah,e.YearParser=hh,e.YearsInterval=kh,e.assert=se,e.authenticate=Yl,e.client=Ll,e.command=Zl,e.downlink=Bl,e.downlinkList=Kl,e.downlinkMap=Wl,e.downlinkValue=Hl,e.hostRef=Xl,e.laneRef=Gl,e.nodeRef=_l,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=swim-runtime.min.js.map
